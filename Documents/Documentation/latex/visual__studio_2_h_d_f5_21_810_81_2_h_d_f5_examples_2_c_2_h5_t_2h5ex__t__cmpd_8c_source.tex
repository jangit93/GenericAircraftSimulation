\hypertarget{visual__studio_2_h_d_f5_21_810_81_2_h_d_f5_examples_2_c_2_h5_t_2h5ex__t__cmpd_8c_source}{}\section{visual\+\_\+studio/\+H\+D\+F5/1.10.1/\+H\+D\+F5\+Examples/\+C/\+H5\+T/h5ex\+\_\+t\+\_\+cmpd.c}
\label{visual__studio_2_h_d_f5_21_810_81_2_h_d_f5_examples_2_c_2_h5_t_2h5ex__t__cmpd_8c_source}\index{h5ex\+\_\+t\+\_\+cmpd.\+c@{h5ex\+\_\+t\+\_\+cmpd.\+c}}

\begin{DoxyCode}
00001 \textcolor{comment}{/************************************************************}
00002 \textcolor{comment}{}
00003 \textcolor{comment}{  This example shows how to read and write compound}
00004 \textcolor{comment}{  datatypes to a dataset.  The program first writes}
00005 \textcolor{comment}{  compound structures to a dataset with a dataspace of DIM0,}
00006 \textcolor{comment}{  then closes the file.  Next, it reopens the file, reads}
00007 \textcolor{comment}{  back the data, and outputs it to the screen.}
00008 \textcolor{comment}{}
00009 \textcolor{comment}{  This file is intended for use with HDF5 Library version 1.8}
00010 \textcolor{comment}{}
00011 \textcolor{comment}{ ************************************************************/}
00012 
00013 \textcolor{preprocessor}{#include "hdf5.h"}
00014 \textcolor{preprocessor}{#include <stdio.h>}
00015 \textcolor{preprocessor}{#include <stdlib.h>}
00016 
00017 \textcolor{preprocessor}{#define FILE            "h5ex\_t\_cmpd.h5"}
00018 \textcolor{preprocessor}{#define DATASET         "DS1"}
00019 \textcolor{preprocessor}{#define DIM0            4}
00020 
00021 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{
00022     \textcolor{keywordtype}{int}     serial\_no;
00023     \textcolor{keywordtype}{char}    *location;
00024     \textcolor{keywordtype}{double}  temperature;
00025     \textcolor{keywordtype}{double}  pressure;
00026 \} \hyperlink{structsensor__t}{sensor\_t};                                 \textcolor{comment}{/* Compound type */}
00027 
00028 \textcolor{keywordtype}{int}
00029 main (\textcolor{keywordtype}{void})
00030 \{
00031     hid\_t       \hyperlink{structfile}{file}, filetype, memtype, strtype, space, dset;
00032                                             \textcolor{comment}{/* Handles */}
00033     herr\_t      status;
00034     hsize\_t     dims[1] = \{DIM0\};
00035     \hyperlink{structsensor__t}{sensor\_t}    wdata[DIM0],                \textcolor{comment}{/* Write buffer */}
00036                 *rdata;                     \textcolor{comment}{/* Read buffer */}
00037     \textcolor{keywordtype}{int}         ndims,
00038                 i;
00039 
00040     \textcolor{comment}{/*}
00041 \textcolor{comment}{     * Initialize data.}
00042 \textcolor{comment}{     */}
00043     wdata[0].serial\_no = 1153;
00044     wdata[0].location = \textcolor{stringliteral}{"Exterior (static)"};
00045     wdata[0].temperature = 53.23;
00046     wdata[0].pressure = 24.57;
00047     wdata[1].serial\_no = 1184;
00048     wdata[1].location = \textcolor{stringliteral}{"Intake"};
00049     wdata[1].temperature = 55.12;
00050     wdata[1].pressure = 22.95;
00051     wdata[2].serial\_no = 1027;
00052     wdata[2].location = \textcolor{stringliteral}{"Intake manifold"};
00053     wdata[2].temperature = 103.55;
00054     wdata[2].pressure = 31.23;
00055     wdata[3].serial\_no = 1313;
00056     wdata[3].location = \textcolor{stringliteral}{"Exhaust manifold"};
00057     wdata[3].temperature = 1252.89;
00058     wdata[3].pressure = 84.11;
00059 
00060     \textcolor{comment}{/*}
00061 \textcolor{comment}{     * Create a new file using the default properties.}
00062 \textcolor{comment}{     */}
00063     file = H5Fcreate (FILE, H5F\_ACC\_TRUNC, H5P\_DEFAULT, H5P\_DEFAULT);
00064 
00065     \textcolor{comment}{/*}
00066 \textcolor{comment}{     * Create variable-length string datatype.}
00067 \textcolor{comment}{     */}
00068     strtype = H5Tcopy (H5T\_C\_S1);
00069     status = H5Tset\_size (strtype, H5T\_VARIABLE);
00070 
00071     \textcolor{comment}{/*}
00072 \textcolor{comment}{     * Create the compound datatype for memory.}
00073 \textcolor{comment}{     */}
00074     memtype = H5Tcreate (H5T\_COMPOUND, \textcolor{keyword}{sizeof} (\hyperlink{structsensor__t}{sensor\_t}));
00075     status = H5Tinsert (memtype, \textcolor{stringliteral}{"Serial number"},
00076                 HOFFSET (\hyperlink{structsensor__t}{sensor\_t}, serial\_no), H5T\_NATIVE\_INT);
00077     status = H5Tinsert (memtype, \textcolor{stringliteral}{"Location"}, HOFFSET (\hyperlink{structsensor__t}{sensor\_t}, location),
00078                 strtype);
00079     status = H5Tinsert (memtype, \textcolor{stringliteral}{"Temperature (F)"},
00080                 HOFFSET (\hyperlink{structsensor__t}{sensor\_t}, temperature), H5T\_NATIVE\_DOUBLE);
00081     status = H5Tinsert (memtype, \textcolor{stringliteral}{"Pressure (inHg)"},
00082                 HOFFSET (\hyperlink{structsensor__t}{sensor\_t}, pressure), H5T\_NATIVE\_DOUBLE);
00083 
00084     \textcolor{comment}{/*}
00085 \textcolor{comment}{     * Create the compound datatype for the file.  Because the standard}
00086 \textcolor{comment}{     * types we are using for the file may have different sizes than}
00087 \textcolor{comment}{     * the corresponding native types, we must manually calculate the}
00088 \textcolor{comment}{     * offset of each member.}
00089 \textcolor{comment}{     */}
00090     filetype = H5Tcreate (H5T\_COMPOUND, 8 + \textcolor{keyword}{sizeof} (\hyperlink{structhvl__t}{hvl\_t}) + 8 + 8);
00091     status = H5Tinsert (filetype, \textcolor{stringliteral}{"Serial number"}, 0, H5T\_STD\_I64BE);
00092     status = H5Tinsert (filetype, \textcolor{stringliteral}{"Location"}, 8, strtype);
00093     status = H5Tinsert (filetype, \textcolor{stringliteral}{"Temperature (F)"}, 8 + \textcolor{keyword}{sizeof} (\hyperlink{structhvl__t}{hvl\_t}),
00094                 H5T\_IEEE\_F64BE);
00095     status = H5Tinsert (filetype, \textcolor{stringliteral}{"Pressure (inHg)"}, 8 + \textcolor{keyword}{sizeof} (\hyperlink{structhvl__t}{hvl\_t}) + 8,
00096                 H5T\_IEEE\_F64BE);
00097 
00098     \textcolor{comment}{/*}
00099 \textcolor{comment}{     * Create dataspace.  Setting maximum size to NULL sets the maximum}
00100 \textcolor{comment}{     * size to be the current size.}
00101 \textcolor{comment}{     */}
00102     space = H5Screate\_simple (1, dims, NULL);
00103 
00104     \textcolor{comment}{/*}
00105 \textcolor{comment}{     * Create the dataset and write the compound data to it.}
00106 \textcolor{comment}{     */}
00107     dset = H5Dcreate (file, DATASET, filetype, space, H5P\_DEFAULT, H5P\_DEFAULT,
00108                 H5P\_DEFAULT);
00109     status = H5Dwrite (dset, memtype, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, wdata);
00110 
00111     \textcolor{comment}{/*}
00112 \textcolor{comment}{     * Close and release resources.}
00113 \textcolor{comment}{     */}
00114     status = H5Dclose (dset);
00115     status = H5Sclose (space);
00116     status = H5Tclose (filetype);
00117     status = H5Fclose (file);
00118 
00119 
00120     \textcolor{comment}{/*}
00121 \textcolor{comment}{     * Now we begin the read section of this example.  Here we assume}
00122 \textcolor{comment}{     * the dataset has the same name and rank, but can have any size.}
00123 \textcolor{comment}{     * Therefore we must allocate a new array to read in data using}
00124 \textcolor{comment}{     * malloc().  For simplicity, we do not rebuild memtype.}
00125 \textcolor{comment}{     */}
00126 
00127     \textcolor{comment}{/*}
00128 \textcolor{comment}{     * Open file and dataset.}
00129 \textcolor{comment}{     */}
00130     file = H5Fopen (FILE, H5F\_ACC\_RDONLY, H5P\_DEFAULT);
00131     dset = H5Dopen (file, DATASET, H5P\_DEFAULT);
00132 
00133     \textcolor{comment}{/*}
00134 \textcolor{comment}{     * Get dataspace and allocate memory for read buffer.}
00135 \textcolor{comment}{     */}
00136     space = H5Dget\_space (dset);
00137     ndims = H5Sget\_simple\_extent\_dims (space, dims, NULL);
00138     rdata = (\hyperlink{structsensor__t}{sensor\_t} *) malloc (dims[0] * \textcolor{keyword}{sizeof} (\hyperlink{structsensor__t}{sensor\_t}));
00139 
00140     \textcolor{comment}{/*}
00141 \textcolor{comment}{     * Read the data.}
00142 \textcolor{comment}{     */}
00143     status = H5Dread (dset, memtype, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, rdata);
00144 
00145     \textcolor{comment}{/*}
00146 \textcolor{comment}{     * Output the data to the screen.}
00147 \textcolor{comment}{     */}
00148     \textcolor{keywordflow}{for} (i=0; i<dims[0]; i++) \{
00149         printf (\textcolor{stringliteral}{"%s[%d]:\(\backslash\)n"}, DATASET, i);
00150         printf (\textcolor{stringliteral}{"Serial number   : %d\(\backslash\)n"}, rdata[i].serial\_no);
00151         printf (\textcolor{stringliteral}{"Location        : %s\(\backslash\)n"}, rdata[i].location);
00152         printf (\textcolor{stringliteral}{"Temperature (F) : %f\(\backslash\)n"}, rdata[i].temperature);
00153         printf (\textcolor{stringliteral}{"Pressure (inHg) : %f\(\backslash\)n\(\backslash\)n"}, rdata[i].pressure);
00154     \}
00155 
00156     \textcolor{comment}{/*}
00157 \textcolor{comment}{     * Close and release resources.  H5Dvlen\_reclaim will automatically}
00158 \textcolor{comment}{     * traverse the structure and free any vlen data (strings in this}
00159 \textcolor{comment}{     * case).}
00160 \textcolor{comment}{     */}
00161     status = H5Dvlen\_reclaim (memtype, space, H5P\_DEFAULT, rdata);
00162     free (rdata);
00163     status = H5Dclose (dset);
00164     status = H5Sclose (space);
00165     status = H5Tclose (memtype);
00166     status = H5Tclose (strtype);
00167     status = H5Fclose (file);
00168 
00169     \textcolor{keywordflow}{return} 0;
00170 \}
\end{DoxyCode}
