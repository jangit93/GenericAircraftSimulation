\hypertarget{eigen_2test_2visitor_8cpp_source}{}\section{eigen/test/visitor.cpp}
\label{eigen_2test_2visitor_8cpp_source}\index{visitor.\+cpp@{visitor.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2008 Benoit Jacob <jacob.benoit.1@gmail.com>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#include "main.h"}
00011 
00012 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType> \textcolor{keywordtype}{void} matrixVisitor(\textcolor{keyword}{const} MatrixType& p)
00013 \{
00014   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::Scalar Scalar;
00015   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::Index \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index};
00016 
00017   Index rows = p.rows();
00018   Index cols = p.cols();
00019 
00020   \textcolor{comment}{// construct a random matrix where all coefficients are different}
00021   MatrixType m;
00022   m = MatrixType::Random(rows, cols);
00023   \textcolor{keywordflow}{for}(Index i = 0; i < m.size(); i++)
00024     \textcolor{keywordflow}{for}(Index i2 = 0; i2 < i; i2++)
00025       \textcolor{keywordflow}{while}(m(i) == m(i2)) \textcolor{comment}{// yes, ==}
00026         m(i) = internal::random<Scalar>();
00027   
00028   Scalar minc = Scalar(1000), maxc = Scalar(-1000);
00029   Index minrow=0,mincol=0,maxrow=0,maxcol=0;
00030   \textcolor{keywordflow}{for}(Index j = 0; j < cols; j++)
00031   \textcolor{keywordflow}{for}(Index i = 0; i < rows; i++)
00032   \{
00033     \textcolor{keywordflow}{if}(m(i,j) < minc)
00034     \{
00035       minc = m(i,j);
00036       minrow = i;
00037       mincol = j;
00038     \}
00039     \textcolor{keywordflow}{if}(m(i,j) > maxc)
00040     \{
00041       maxc = m(i,j);
00042       maxrow = i;
00043       maxcol = j;
00044     \}
00045   \}
00046   Index eigen\_minrow, eigen\_mincol, eigen\_maxrow, eigen\_maxcol;
00047   Scalar eigen\_minc, eigen\_maxc;
00048   eigen\_minc = m.minCoeff(&eigen\_minrow,&eigen\_mincol);
00049   eigen\_maxc = m.maxCoeff(&eigen\_maxrow,&eigen\_maxcol);
00050   VERIFY(minrow == eigen\_minrow);
00051   VERIFY(maxrow == eigen\_maxrow);
00052   VERIFY(mincol == eigen\_mincol);
00053   VERIFY(maxcol == eigen\_maxcol);
00054   VERIFY\_IS\_APPROX(minc, eigen\_minc);
00055   VERIFY\_IS\_APPROX(maxc, eigen\_maxc);
00056   VERIFY\_IS\_APPROX(minc, m.minCoeff());
00057   VERIFY\_IS\_APPROX(maxc, m.maxCoeff());
00058 
00059   eigen\_maxc = (m.adjoint()*m).maxCoeff(&eigen\_maxrow,&eigen\_maxcol);
00060   eigen\_maxc = (m.adjoint()*m).eval().maxCoeff(&maxrow,&maxcol);
00061   VERIFY(maxrow == eigen\_maxrow);
00062   VERIFY(maxcol == eigen\_maxcol);
00063 \}
00064 
00065 \textcolor{keyword}{template}<\textcolor{keyword}{typename} VectorType> \textcolor{keywordtype}{void} vectorVisitor(\textcolor{keyword}{const} \hyperlink{struct_vector_type}{VectorType}& w)
00066 \{
00067   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} VectorType::Scalar Scalar;
00068   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} VectorType::Index Index;
00069 
00070   Index size = w.size();
00071 
00072   \textcolor{comment}{// construct a random vector where all coefficients are different}
00073   \hyperlink{struct_vector_type}{VectorType} v;
00074   v = VectorType::Random(size);
00075   \textcolor{keywordflow}{for}(Index i = 0; i < size; i++)
00076     \textcolor{keywordflow}{for}(Index i2 = 0; i2 < i; i2++)
00077       \textcolor{keywordflow}{while}(v(i) == v(i2)) \textcolor{comment}{// yes, ==}
00078         v(i) = internal::random<Scalar>();
00079   
00080   Scalar minc = v(0), maxc = v(0);
00081   Index minidx=0, maxidx=0;
00082   \textcolor{keywordflow}{for}(Index i = 0; i < size; i++)
00083   \{
00084     \textcolor{keywordflow}{if}(v(i) < minc)
00085     \{
00086       minc = v(i);
00087       minidx = i;
00088     \}
00089     \textcolor{keywordflow}{if}(v(i) > maxc)
00090     \{
00091       maxc = v(i);
00092       maxidx = i;
00093     \}
00094   \}
00095   Index eigen\_minidx, eigen\_maxidx;
00096   Scalar eigen\_minc, eigen\_maxc;
00097   eigen\_minc = v.minCoeff(&eigen\_minidx);
00098   eigen\_maxc = v.maxCoeff(&eigen\_maxidx);
00099   VERIFY(minidx == eigen\_minidx);
00100   VERIFY(maxidx == eigen\_maxidx);
00101   VERIFY\_IS\_APPROX(minc, eigen\_minc);
00102   VERIFY\_IS\_APPROX(maxc, eigen\_maxc);
00103   VERIFY\_IS\_APPROX(minc, v.minCoeff());
00104   VERIFY\_IS\_APPROX(maxc, v.maxCoeff());
00105   
00106   Index idx0 = internal::random<Index>(0,size-1);
00107   Index idx1 = eigen\_minidx;
00108   Index idx2 = eigen\_maxidx;
00109   \hyperlink{struct_vector_type}{VectorType} v1(v), v2(v);
00110   v1(idx0) = v1(idx1);
00111   v2(idx0) = v2(idx2);
00112   v1.minCoeff(&eigen\_minidx);
00113   v2.maxCoeff(&eigen\_maxidx);
00114   VERIFY(eigen\_minidx == (std::min)(idx0,idx1));
00115   VERIFY(eigen\_maxidx == (std::min)(idx0,idx2));
00116 \}
00117 
00118 \textcolor{keywordtype}{void} test\_visitor()
00119 \{
00120   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 0; i < g\_repeat; i++) \{
00121     CALL\_SUBTEST\_1( matrixVisitor(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<float, 1, 1>}()) );
00122     CALL\_SUBTEST\_2( matrixVisitor(Matrix2f()) );
00123     CALL\_SUBTEST\_3( matrixVisitor(Matrix4d()) );
00124     CALL\_SUBTEST\_4( matrixVisitor(MatrixXd(8, 12)) );
00125     CALL\_SUBTEST\_5( matrixVisitor(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<double,Dynamic,Dynamic,RowMajor>}
      (20, 20)) );
00126     CALL\_SUBTEST\_6( matrixVisitor(MatrixXi(8, 12)) );
00127   \}
00128   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 0; i < g\_repeat; i++) \{
00129     CALL\_SUBTEST\_7( vectorVisitor(Vector4f()) );
00130     CALL\_SUBTEST\_7( vectorVisitor(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<int,12,1>}()) );
00131     CALL\_SUBTEST\_8( vectorVisitor(VectorXd(10)) );
00132     CALL\_SUBTEST\_9( vectorVisitor(RowVectorXd(10)) );
00133     CALL\_SUBTEST\_10( vectorVisitor(VectorXf(33)) );
00134   \}
00135 \}
\end{DoxyCode}
