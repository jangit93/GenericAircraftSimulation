\hypertarget{eigen_2unsupported_2test_2_numerical_diff_8cpp_source}{}\section{eigen/unsupported/test/\+Numerical\+Diff.cpp}
\label{eigen_2unsupported_2test_2_numerical_diff_8cpp_source}\index{Numerical\+Diff.\+cpp@{Numerical\+Diff.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2009 Thomas Capricelli <orzel@freehackers.org>}
00005 
00006 \textcolor{preprocessor}{#include <stdio.h>}
00007 
00008 \textcolor{preprocessor}{#include "main.h"}
00009 \textcolor{preprocessor}{#include <unsupported/Eigen/NumericalDiff>}
00010     
00011 \textcolor{comment}{// Generic functor}
00012 \textcolor{keyword}{template}<\textcolor{keyword}{typename} \_Scalar, \textcolor{keywordtype}{int} NX=Dynamic, \textcolor{keywordtype}{int} NY=Dynamic>
00013 \textcolor{keyword}{struct }\hyperlink{struct_functor}{Functor}
00014 \{
00015   \textcolor{keyword}{typedef} \_Scalar Scalar;
00016   \textcolor{keyword}{enum} \{
00017     InputsAtCompileTime = NX,
00018     ValuesAtCompileTime = NY
00019   \};
00020   \textcolor{keyword}{typedef} Matrix<Scalar,InputsAtCompileTime,1> InputType;
00021   \textcolor{keyword}{typedef} Matrix<Scalar,ValuesAtCompileTime,1> ValueType;
00022   \textcolor{keyword}{typedef} Matrix<Scalar,ValuesAtCompileTime,InputsAtCompileTime> JacobianType;
00023   
00024   \textcolor{keywordtype}{int} m\_inputs, m\_values;
00025   
00026   \hyperlink{struct_functor}{Functor}() : m\_inputs(InputsAtCompileTime), m\_values(ValuesAtCompileTime) \{\}
00027   \hyperlink{struct_functor}{Functor}(\textcolor{keywordtype}{int} inputs, \textcolor{keywordtype}{int} values) : m\_inputs(inputs), m\_values(values) \{\}
00028   
00029   \textcolor{keywordtype}{int} inputs()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_inputs; \}
00030   \textcolor{keywordtype}{int} values()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_values; \}
00031 
00032 \};
00033 
\Hypertarget{eigen_2unsupported_2test_2_numerical_diff_8cpp_source_l00034}\hyperlink{structmy__functor}{00034} \textcolor{keyword}{struct }\hyperlink{structmy__functor}{my\_functor} : \hyperlink{struct_functor}{Functor}<double>
00035 \{
00036     \hyperlink{structmy__functor}{my\_functor}(\textcolor{keywordtype}{void}): \hyperlink{struct_functor}{Functor<double>}(3,15) \{\}
00037     \textcolor{keywordtype}{int} operator()(\textcolor{keyword}{const} VectorXd &x, VectorXd &fvec)\textcolor{keyword}{ const}
00038 \textcolor{keyword}{    }\{
00039         \textcolor{keywordtype}{double} tmp1, tmp2, tmp3;
00040         \textcolor{keywordtype}{double} y[15] = \{1.4e-1, 1.8e-1, 2.2e-1, 2.5e-1, 2.9e-1, 3.2e-1, 3.5e-1,
00041             3.9e-1, 3.7e-1, 5.8e-1, 7.3e-1, 9.6e-1, 1.34, 2.1, 4.39\};
00042 
00043         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < values(); i++)
00044         \{
00045             tmp1 = i+1;
00046             tmp2 = 16 - i - 1;
00047             tmp3 = (i>=8)? tmp2 : tmp1;
00048             fvec[i] = y[i] - (x[0] + tmp1/(x[1]*tmp2 + x[2]*tmp3));
00049         \}
00050         \textcolor{keywordflow}{return} 0;
00051     \}
00052 
00053     \textcolor{keywordtype}{int} actual\_df(\textcolor{keyword}{const} VectorXd &x, MatrixXd &fjac)\textcolor{keyword}{ const}
00054 \textcolor{keyword}{    }\{
00055         \textcolor{keywordtype}{double} tmp1, tmp2, tmp3, tmp4;
00056         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < values(); i++)
00057         \{
00058             tmp1 = i+1;
00059             tmp2 = 16 - i - 1;
00060             tmp3 = (i>=8)? tmp2 : tmp1;
00061             tmp4 = (x[1]*tmp2 + x[2]*tmp3); tmp4 = tmp4*tmp4;
00062             fjac(i,0) = -1;
00063             fjac(i,1) = tmp1*tmp2/tmp4;
00064             fjac(i,2) = tmp1*tmp3/tmp4;
00065         \}
00066         \textcolor{keywordflow}{return} 0;
00067     \}
00068 \};
00069 
00070 \textcolor{keywordtype}{void} test\_forward()
00071 \{
00072     VectorXd x(3);
00073     MatrixXd jac(15,3);
00074     MatrixXd actual\_jac(15,3);
00075     \hyperlink{structmy__functor}{my\_functor} functor;
00076 
00077     x << 0.082, 1.13, 2.35;
00078 
00079     \textcolor{comment}{// real one }
00080     functor.actual\_df(x, actual\_jac);
00081 \textcolor{comment}{//    std::cout << actual\_jac << std::endl << std::endl;}
00082 
00083     \textcolor{comment}{// using NumericalDiff}
00084     NumericalDiff<my\_functor> numDiff(functor);
00085     numDiff.df(x, jac);
00086 \textcolor{comment}{//    std::cout << jac << std::endl;}
00087 
00088     VERIFY\_IS\_APPROX(jac, actual\_jac);
00089 \}
00090 
00091 \textcolor{keywordtype}{void} test\_central()
00092 \{
00093     VectorXd x(3);
00094     MatrixXd jac(15,3);
00095     MatrixXd actual\_jac(15,3);
00096     \hyperlink{structmy__functor}{my\_functor} functor;
00097 
00098     x << 0.082, 1.13, 2.35;
00099 
00100     \textcolor{comment}{// real one }
00101     functor.actual\_df(x, actual\_jac);
00102 
00103     \textcolor{comment}{// using NumericalDiff}
00104     NumericalDiff<my\_functor,Central> numDiff(functor);
00105     numDiff.df(x, jac);
00106 
00107     VERIFY\_IS\_APPROX(jac, actual\_jac);
00108 \}
00109 
00110 \textcolor{keywordtype}{void} test\_NumericalDiff()
00111 \{
00112     CALL\_SUBTEST(test\_forward());
00113     CALL\_SUBTEST(test\_central());
00114 \}
\end{DoxyCode}
