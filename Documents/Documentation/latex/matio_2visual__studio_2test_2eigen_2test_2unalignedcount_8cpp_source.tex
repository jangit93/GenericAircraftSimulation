\hypertarget{matio_2visual__studio_2test_2eigen_2test_2unalignedcount_8cpp_source}{}\section{matio/visual\+\_\+studio/test/eigen/test/unalignedcount.cpp}
\label{matio_2visual__studio_2test_2eigen_2test_2unalignedcount_8cpp_source}\index{unalignedcount.\+cpp@{unalignedcount.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2009 Gael Guennebaud <gael.guennebaud@inria.fr>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{keyword}{static} \textcolor{keywordtype}{int} nb\_load;
00011 \textcolor{keyword}{static} \textcolor{keywordtype}{int} nb\_loadu;
00012 \textcolor{keyword}{static} \textcolor{keywordtype}{int} nb\_store;
00013 \textcolor{keyword}{static} \textcolor{keywordtype}{int} nb\_storeu;
00014 
00015 \textcolor{preprocessor}{#define EIGEN\_DEBUG\_ALIGNED\_LOAD    \{ nb\_load++;    \}}
00016 \textcolor{preprocessor}{#define EIGEN\_DEBUG\_UNALIGNED\_LOAD  \{ nb\_loadu++;   \}}
00017 \textcolor{preprocessor}{#define EIGEN\_DEBUG\_ALIGNED\_STORE   \{ nb\_store++;   \}}
00018 \textcolor{preprocessor}{#define EIGEN\_DEBUG\_UNALIGNED\_STORE \{ nb\_storeu++;  \}}
00019 
00020 \textcolor{preprocessor}{#define VERIFY\_ALIGNED\_UNALIGNED\_COUNT(XPR,AL,UL,AS,US) \{\(\backslash\)}
00021 \textcolor{preprocessor}{    nb\_load = nb\_loadu = nb\_store = nb\_storeu = 0; \(\backslash\)}
00022 \textcolor{preprocessor}{    XPR; \(\backslash\)}
00023 \textcolor{preprocessor}{    if(!(nb\_load==AL && nb\_loadu==UL && nb\_store==AS && nb\_storeu==US)) \(\backslash\)}
00024 \textcolor{preprocessor}{      std::cerr << " >> " << nb\_load << ", " << nb\_loadu << ", " << nb\_store << ", " << nb\_storeu << "\(\backslash\)n"; 
      \(\backslash\)}
00025 \textcolor{preprocessor}{    VERIFY( (#XPR) && nb\_load==AL && nb\_loadu==UL && nb\_store==AS && nb\_storeu==US ); \(\backslash\)}
00026 \textcolor{preprocessor}{  \}}
00027 
00028 
00029 \textcolor{preprocessor}{#include "main.h"}
00030 
00031 \textcolor{keywordtype}{void} test\_unalignedcount()
00032 \{
00033 \textcolor{preprocessor}{  #if defined(EIGEN\_VECTORIZE\_AVX)}
00034   VectorXf a(40), b(40);
00035   VERIFY\_ALIGNED\_UNALIGNED\_COUNT(a += b, 10, 0, 5, 0);
00036   VERIFY\_ALIGNED\_UNALIGNED\_COUNT(a.segment(0,40) += b.segment(0,40), 5, 5, 5, 0);
00037   VERIFY\_ALIGNED\_UNALIGNED\_COUNT(a.segment(0,40) -= b.segment(0,40), 5, 5, 5, 0);
00038   VERIFY\_ALIGNED\_UNALIGNED\_COUNT(a.segment(0,40) *= 3.5, 5, 0, 5, 0);
00039   VERIFY\_ALIGNED\_UNALIGNED\_COUNT(a.segment(0,40) /= 3.5, 5, 0, 5, 0);
00040 \textcolor{preprocessor}{  #elif defined(EIGEN\_VECTORIZE\_SSE)}
00041   VectorXf a(40), b(40);
00042   VERIFY\_ALIGNED\_UNALIGNED\_COUNT(a += b, 20, 0, 10, 0);
00043   VERIFY\_ALIGNED\_UNALIGNED\_COUNT(a.segment(0,40) += b.segment(0,40), 10, 10, 10, 0);
00044   VERIFY\_ALIGNED\_UNALIGNED\_COUNT(a.segment(0,40) -= b.segment(0,40), 10, 10, 10, 0);
00045   VERIFY\_ALIGNED\_UNALIGNED\_COUNT(a.segment(0,40) *= 3.5, 10, 0, 10, 0);
00046   VERIFY\_ALIGNED\_UNALIGNED\_COUNT(a.segment(0,40) /= 3.5, 10, 0, 10, 0);
00047 \textcolor{preprocessor}{  #else}
00048   \textcolor{comment}{// The following line is to eliminate "variable not used" warnings}
00049   nb\_load = nb\_loadu = nb\_store = nb\_storeu = 0;
00050   \textcolor{keywordtype}{int} a(0), b(0);
00051   VERIFY(a==b);
00052 \textcolor{preprocessor}{  #endif}
00053 \}
\end{DoxyCode}
