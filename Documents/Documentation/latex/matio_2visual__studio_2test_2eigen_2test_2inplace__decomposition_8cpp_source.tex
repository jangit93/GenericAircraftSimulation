\hypertarget{matio_2visual__studio_2test_2eigen_2test_2inplace__decomposition_8cpp_source}{}\section{matio/visual\+\_\+studio/test/eigen/test/inplace\+\_\+decomposition.cpp}
\label{matio_2visual__studio_2test_2eigen_2test_2inplace__decomposition_8cpp_source}\index{inplace\+\_\+decomposition.\+cpp@{inplace\+\_\+decomposition.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2016 Gael Guennebaud <gael.guennebaud@inria.fr>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#include "main.h"}
00011 \textcolor{preprocessor}{#include <Eigen/LU>}
00012 \textcolor{preprocessor}{#include <Eigen/Cholesky>}
00013 \textcolor{preprocessor}{#include <Eigen/QR>}
00014 
00015 \textcolor{comment}{// This file test inplace decomposition through Ref<>, as supported by Cholesky, LU, and QR decompositions.}
00016 
00017 \textcolor{keyword}{template}<\textcolor{keyword}{typename} DecType,\textcolor{keyword}{typename} MatrixType> \textcolor{keywordtype}{void} inplace(\textcolor{keywordtype}{bool} square = \textcolor{keyword}{false}, \textcolor{keywordtype}{bool} SPD = \textcolor{keyword}{false})
00018 \{
00019   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::Scalar Scalar;
00020   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar, MatrixType::RowsAtCompileTime, 1>} 
      RhsType;
00021   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar, MatrixType::ColsAtCompileTime, 1>} 
      ResType;
00022 
00023   \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} rows = MatrixType::RowsAtCompileTime==\hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Dynamic} ? internal::random<Index>(2,
      EIGEN\_TEST\_MAX\_SIZE/2) : \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}(MatrixType::RowsAtCompileTime);
00024   \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} cols = MatrixType::ColsAtCompileTime==\hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Dynamic} ? (square?rows:internal::random<Index>(2,
      rows))    : \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}(MatrixType::ColsAtCompileTime);
00025 
00026   MatrixType \hyperlink{group___core___module_class_eigen_1_1_matrix}{A} = MatrixType::Random(rows,cols);
00027   RhsType b = RhsType::Random(rows);
00028   ResType x(cols);
00029 
00030   \textcolor{keywordflow}{if}(SPD)
00031   \{
00032     assert(square);
00033     A.topRows(cols) = A.topRows(cols).adjoint() * A.topRows(cols);
00034     A.diagonal().array() += 1e-3;
00035   \}
00036 
00037   MatrixType A0 = A;
00038   MatrixType A1 = A;
00039 
00040   DecType dec(A);
00041 
00042   \textcolor{comment}{// Check that the content of A has been modified}
00043   VERIFY\_IS\_NOT\_APPROX( A, A0 );
00044 
00045   \textcolor{comment}{// Check that the decomposition is correct:}
00046   \textcolor{keywordflow}{if}(rows==cols)
00047   \{
00048     VERIFY\_IS\_APPROX( A0 * (x = dec.solve(b)), b );
00049   \}
00050   \textcolor{keywordflow}{else}
00051   \{
00052     VERIFY\_IS\_APPROX( A0.transpose() * A0 * (x = dec.solve(b)), A0.transpose() * b );
00053   \}
00054 
00055   \textcolor{comment}{// Check that modifying A breaks the current dec:}
00056   A.setRandom();
00057   \textcolor{keywordflow}{if}(rows==cols)
00058   \{
00059     VERIFY\_IS\_NOT\_APPROX( A0 * (x = dec.solve(b)), b );
00060   \}
00061   \textcolor{keywordflow}{else}
00062   \{
00063     VERIFY\_IS\_NOT\_APPROX( A0.transpose() * A0 * (x = dec.solve(b)), A0.transpose() * b );
00064   \}
00065 
00066   \textcolor{comment}{// Check that calling compute(A1) does not modify A1:}
00067   A = A0;
00068   dec.compute(A1);
00069   VERIFY\_IS\_EQUAL(A0,A1);
00070   VERIFY\_IS\_NOT\_APPROX( A, A0 );
00071   \textcolor{keywordflow}{if}(rows==cols)
00072   \{
00073     VERIFY\_IS\_APPROX( A0 * (x = dec.solve(b)), b );
00074   \}
00075   \textcolor{keywordflow}{else}
00076   \{
00077     VERIFY\_IS\_APPROX( A0.transpose() * A0 * (x = dec.solve(b)), A0.transpose() * b );
00078   \}
00079 \}
00080 
00081 
00082 \textcolor{keywordtype}{void} test\_inplace\_decomposition()
00083 \{
00084   EIGEN\_UNUSED \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<double,4,3>} Matrix43d;
00085   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 0; i < g\_repeat; i++) \{
00086     CALL\_SUBTEST\_1(( inplace<\hyperlink{group___cholesky___module_class_eigen_1_1_l_l_t}{LLT}<\hyperlink{group___core___module_class_eigen_1_1_ref}{Ref<MatrixXd>} >, MatrixXd>(\textcolor{keyword}{true},\textcolor{keyword}{true}) ));
00087     CALL\_SUBTEST\_1(( inplace<\hyperlink{group___cholesky___module_class_eigen_1_1_l_l_t}{LLT}<\hyperlink{group___core___module_class_eigen_1_1_ref}{Ref<Matrix4d>} >, Matrix4d>(\textcolor{keyword}{true},\textcolor{keyword}{true}) ));
00088 
00089     CALL\_SUBTEST\_2(( inplace<\hyperlink{group___cholesky___module_class_eigen_1_1_l_d_l_t}{LDLT}<\hyperlink{group___core___module_class_eigen_1_1_ref}{Ref<MatrixXd>} >, MatrixXd>(\textcolor{keyword}{true},\textcolor{keyword}{true}) ));
00090     CALL\_SUBTEST\_2(( inplace<\hyperlink{group___cholesky___module_class_eigen_1_1_l_d_l_t}{LDLT}<\hyperlink{group___core___module_class_eigen_1_1_ref}{Ref<Matrix4d>} >, Matrix4d>(\textcolor{keyword}{true},\textcolor{keyword}{true}) ));
00091 
00092     CALL\_SUBTEST\_3(( inplace<\hyperlink{group___l_u___module_class_eigen_1_1_partial_piv_l_u}{PartialPivLU}<\hyperlink{group___core___module_class_eigen_1_1_ref}{Ref<MatrixXd>} >, MatrixXd>(\textcolor{keyword}{true},\textcolor{keyword}{false}) )
      );
00093     CALL\_SUBTEST\_3(( inplace<\hyperlink{group___l_u___module_class_eigen_1_1_partial_piv_l_u}{PartialPivLU}<\hyperlink{group___core___module_class_eigen_1_1_ref}{Ref<Matrix4d>} >, Matrix4d>(\textcolor{keyword}{true},\textcolor{keyword}{false}) )
      );
00094 
00095     CALL\_SUBTEST\_4(( inplace<\hyperlink{group___l_u___module_class_eigen_1_1_full_piv_l_u}{FullPivLU}<\hyperlink{group___core___module_class_eigen_1_1_ref}{Ref<MatrixXd>} >, MatrixXd>(\textcolor{keyword}{true},\textcolor{keyword}{false}) ));
00096     CALL\_SUBTEST\_4(( inplace<\hyperlink{group___l_u___module_class_eigen_1_1_full_piv_l_u}{FullPivLU}<\hyperlink{group___core___module_class_eigen_1_1_ref}{Ref<Matrix4d>} >, Matrix4d>(\textcolor{keyword}{true},\textcolor{keyword}{false}) ));
00097 
00098     CALL\_SUBTEST\_5(( inplace<\hyperlink{group___q_r___module_class_eigen_1_1_householder_q_r}{HouseholderQR}<\hyperlink{group___core___module_class_eigen_1_1_ref}{Ref<MatrixXd>} >, MatrixXd>(\textcolor{keyword}{false},\textcolor{keyword}{false}
      ) ));
00099     CALL\_SUBTEST\_5(( inplace<\hyperlink{group___q_r___module_class_eigen_1_1_householder_q_r}{HouseholderQR}<\hyperlink{group___core___module_class_eigen_1_1_ref}{Ref<Matrix43d>} >, Matrix43d>(\textcolor{keyword}{false},\textcolor{keyword}{
      false}) ));
00100 
00101     CALL\_SUBTEST\_6(( inplace<\hyperlink{group___q_r___module_class_eigen_1_1_col_piv_householder_q_r}{ColPivHouseholderQR}<
      \hyperlink{group___core___module_class_eigen_1_1_ref}{Ref<MatrixXd>} >, MatrixXd>(\textcolor{keyword}{false},\textcolor{keyword}{false}) ));
00102     CALL\_SUBTEST\_6(( inplace<\hyperlink{group___q_r___module_class_eigen_1_1_col_piv_householder_q_r}{ColPivHouseholderQR}<
      \hyperlink{group___core___module_class_eigen_1_1_ref}{Ref<Matrix43d>} >, Matrix43d>(\textcolor{keyword}{false},\textcolor{keyword}{false}) ));
00103 
00104     CALL\_SUBTEST\_7(( inplace<\hyperlink{group___q_r___module_class_eigen_1_1_full_piv_householder_q_r}{FullPivHouseholderQR}<
      \hyperlink{group___core___module_class_eigen_1_1_ref}{Ref<MatrixXd>} >, MatrixXd>(\textcolor{keyword}{false},\textcolor{keyword}{false}) ));
00105     CALL\_SUBTEST\_7(( inplace<\hyperlink{group___q_r___module_class_eigen_1_1_full_piv_householder_q_r}{FullPivHouseholderQR}<
      \hyperlink{group___core___module_class_eigen_1_1_ref}{Ref<Matrix43d>} >, Matrix43d>(\textcolor{keyword}{false},\textcolor{keyword}{false}) ));
00106 
00107     CALL\_SUBTEST\_8(( inplace<\hyperlink{group___q_r___module_class_eigen_1_1_complete_orthogonal_decomposition}{CompleteOrthogonalDecomposition}<
      \hyperlink{group___core___module_class_eigen_1_1_ref}{Ref<MatrixXd>} >, MatrixXd>(\textcolor{keyword}{false},\textcolor{keyword}{false}) ));
00108     CALL\_SUBTEST\_8(( inplace<\hyperlink{group___q_r___module_class_eigen_1_1_complete_orthogonal_decomposition}{CompleteOrthogonalDecomposition}<
      \hyperlink{group___core___module_class_eigen_1_1_ref}{Ref<Matrix43d>} >, Matrix43d>(\textcolor{keyword}{false},\textcolor{keyword}{false}) ));
00109   \}
00110 \}
\end{DoxyCode}
