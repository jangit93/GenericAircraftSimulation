\hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_splines_2_spline_8h_source}{}\section{matio/visual\+\_\+studio/test/eigen/unsupported/\+Eigen/src/\+Splines/\+Spline.h}
\label{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_splines_2_spline_8h_source}\index{Spline.\+h@{Spline.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 20010-2011 Hauke Heibel <hauke.heibel@gmail.com>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#ifndef EIGEN\_SPLINE\_H}
00011 \textcolor{preprocessor}{#define EIGEN\_SPLINE\_H}
00012 
00013 \textcolor{preprocessor}{#include "SplineFwd.h"}
00014 
00015 \textcolor{keyword}{namespace }\hyperlink{namespace_eigen}{Eigen}
00016 \{
00034   \textcolor{keyword}{template} <\textcolor{keyword}{typename} \_Scalar, \textcolor{keywordtype}{int} \_Dim, \textcolor{keywordtype}{int} \_Degree>
00035   \textcolor{keyword}{class }Spline
00036   \{
00037   \textcolor{keyword}{public}:
\Hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_splines_2_spline_8h_source_l00038}\hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{00038}     \textcolor{keyword}{typedef} \_Scalar \hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Scalar}; 
00039     \textcolor{keyword}{enum} \{ \hyperlink{group___splines___module_a82c233f1d4719bc52397d64a6c96c5b0a25366e5e79da5355d259a71096d8d8a7}{Dimension} = \_Dim  \};
00040     \textcolor{keyword}{enum} \{ \hyperlink{group___splines___module_a40cd07294408f87d39763e15b331b4d1a7bc38582fb1bae7db67c89b6c5f45f24}{Degree} = \_Degree  \};
00041 
\Hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_splines_2_spline_8h_source_l00043}\hyperlink{group___splines___module_a9ade8a2f81dae6eedb8845cb080672bd}{00043}     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<Spline>::PointType} 
      \hyperlink{group___splines___module_a9ade8a2f81dae6eedb8845cb080672bd}{PointType};
00044     
\Hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_splines_2_spline_8h_source_l00046}\hyperlink{group___splines___module_a066f7a8b120316c9068b559f0790e9ec}{00046}     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<Spline>::KnotVectorType} 
      \hyperlink{group___splines___module_a066f7a8b120316c9068b559f0790e9ec}{KnotVectorType};
00047 
\Hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_splines_2_spline_8h_source_l00049}\hyperlink{group___splines___module_a04bcc878ef5c8316e8cc60b4cf00d77c}{00049}     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<Spline>::ParameterVectorType} 
      \hyperlink{group___splines___module_a04bcc878ef5c8316e8cc60b4cf00d77c}{ParameterVectorType};
00050     
\Hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_splines_2_spline_8h_source_l00052}\hyperlink{group___splines___module_a1d49cef942ea59d85d1711ee32354e6b}{00052}     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<Spline>::BasisVectorType} 
      \hyperlink{group___splines___module_a1d49cef942ea59d85d1711ee32354e6b}{BasisVectorType};
00053 
\Hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_splines_2_spline_8h_source_l00055}\hyperlink{group___splines___module_a9db0b0108353660cd03524f2e67d6b3c}{00055}     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<Spline>::BasisDerivativeType} 
      \hyperlink{group___splines___module_a9db0b0108353660cd03524f2e67d6b3c}{BasisDerivativeType};
00056     
\Hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_splines_2_spline_8h_source_l00058}\hyperlink{group___splines___module_ac42c673462a98ad1779761bebeb450bf}{00058}     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<Spline>::ControlPointVectorType}
       \hyperlink{group___splines___module_ac42c673462a98ad1779761bebeb450bf}{ControlPointVectorType};
00059     
\Hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_splines_2_spline_8h_source_l00064}\hyperlink{group___splines___module_a25ebf3b3621db98ffe60eba3c0d64025}{00064}     \hyperlink{group___splines___module_a25ebf3b3621db98ffe60eba3c0d64025}{Spline}() 
00065     : m\_knots(1, (\hyperlink{group___splines___module_a40cd07294408f87d39763e15b331b4d1a7bc38582fb1bae7db67c89b6c5f45f24}{Degree}==\hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Dynamic} ? 2 : 2*\hyperlink{group___splines___module_a40cd07294408f87d39763e15b331b4d1a7bc38582fb1bae7db67c89b6c5f45f24}{Degree}+2))
00066     , m\_ctrls(ControlPointVectorType::Zero(\hyperlink{group___splines___module_a82c233f1d4719bc52397d64a6c96c5b0a25366e5e79da5355d259a71096d8d8a7}{Dimension},(\hyperlink{group___splines___module_a40cd07294408f87d39763e15b331b4d1a7bc38582fb1bae7db67c89b6c5f45f24}{Degree}==
      \hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Dynamic} ? 1 : \hyperlink{group___splines___module_a40cd07294408f87d39763e15b331b4d1a7bc38582fb1bae7db67c89b6c5f45f24}{Degree}+1))) 
00067     \{
00068       \textcolor{comment}{// in theory this code can go to the initializer list but it will get pretty}
00069       \textcolor{comment}{// much unreadable ...}
00070       \textcolor{keyword}{enum} \{ MinDegree = (\hyperlink{group___splines___module_a40cd07294408f87d39763e15b331b4d1a7bc38582fb1bae7db67c89b6c5f45f24}{Degree}==\hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Dynamic} ? 0 : \hyperlink{group___splines___module_a40cd07294408f87d39763e15b331b4d1a7bc38582fb1bae7db67c89b6c5f45f24}{Degree}) \};
00071       m\_knots.template segment<MinDegree+1>(0) = 
      \hyperlink{group___core___module_class_eigen_1_1_array}{Array<Scalar,1,MinDegree+1>::Zero}();
00072       m\_knots.template segment<MinDegree+1>(MinDegree+1) = 
      \hyperlink{group___core___module_class_eigen_1_1_array}{Array<Scalar,1,MinDegree+1>::Ones}();
00073     \}
00074 
00080     \textcolor{keyword}{template} <\textcolor{keyword}{typename} OtherVectorType, \textcolor{keyword}{typename} OtherArrayType>
\Hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_splines_2_spline_8h_source_l00081}\hyperlink{group___splines___module_ac9dfdbeabf9573642d970e29e92dd2be}{00081}     \hyperlink{group___splines___module_ac9dfdbeabf9573642d970e29e92dd2be}{Spline}(\textcolor{keyword}{const} OtherVectorType& \hyperlink{group___splines___module_ae3eac8af580ad880d8ad3a259d453aa1}{knots}, \textcolor{keyword}{const} OtherArrayType& \hyperlink{group___splines___module_a0fc81e475d3a0ba34da1bd97f2e8fbc7}{ctrls}) : m\_knots(knots), 
      m\_ctrls(ctrls) \{\}
00082 
00087     \textcolor{keyword}{template} <\textcolor{keywordtype}{int} OtherDegree>
\Hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_splines_2_spline_8h_source_l00088}\hyperlink{group___splines___module_a0e6083605acc9f565e8bf4057b3f4bd3}{00088}     \hyperlink{group___splines___module_a0e6083605acc9f565e8bf4057b3f4bd3}{Spline}(\textcolor{keyword}{const} \hyperlink{group___splines___module_class_eigen_1_1_spline}{Spline<Scalar, Dimension, OtherDegree>}& spline
      ) : 
00089     m\_knots(spline.\hyperlink{group___splines___module_ae3eac8af580ad880d8ad3a259d453aa1}{knots}()), m\_ctrls(spline.\hyperlink{group___splines___module_a0fc81e475d3a0ba34da1bd97f2e8fbc7}{ctrls}()) \{\}
00090 
\Hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_splines_2_spline_8h_source_l00094}\hyperlink{group___splines___module_ae3eac8af580ad880d8ad3a259d453aa1}{00094}     \textcolor{keyword}{const} KnotVectorType& \hyperlink{group___splines___module_ae3eac8af580ad880d8ad3a259d453aa1}{knots}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_knots; \}
00095     
\Hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_splines_2_spline_8h_source_l00099}\hyperlink{group___splines___module_a0fc81e475d3a0ba34da1bd97f2e8fbc7}{00099}     \textcolor{keyword}{const} ControlPointVectorType& \hyperlink{group___splines___module_a0fc81e475d3a0ba34da1bd97f2e8fbc7}{ctrls}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_ctrls; \}
00100 
00112     PointType \hyperlink{group___splines___module_a3c7e1838eae4ee7e341ef9d3dbf9ba45}{operator()}(Scalar u) \textcolor{keyword}{const};
00113 
00126     \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<Spline>::DerivativeType}
00127       \hyperlink{group___splines___module_a196730cf190dfa16907db888277e5aed}{derivatives}(Scalar u, DenseIndex order) \textcolor{keyword}{const};
00128 
00134     \textcolor{keyword}{template} <\textcolor{keywordtype}{int} DerivativeOrder>
00135     \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<Spline,DerivativeOrder>::DerivativeType}
00136       \hyperlink{group___splines___module_a196730cf190dfa16907db888277e5aed}{derivatives}(Scalar u, DenseIndex order = DerivativeOrder) \textcolor{keyword}{const};
00137 
00154     \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<Spline>::BasisVectorType}
00155       \hyperlink{group___splines___module_afe0997f0bb02a3fac3073016abac04c6}{basisFunctions}(Scalar u) \textcolor{keyword}{const};
00156 
00170     \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<Spline>::BasisDerivativeType}
00171       \hyperlink{group___splines___module_a17d416e814d1ee957e5b309dc423751f}{basisFunctionDerivatives}(Scalar u, DenseIndex order) \textcolor{keyword}{const};
00172 
00178     \textcolor{keyword}{template} <\textcolor{keywordtype}{int} DerivativeOrder>
00179     \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<Spline,DerivativeOrder>::BasisDerivativeType}
00180       \hyperlink{group___splines___module_a17d416e814d1ee957e5b309dc423751f}{basisFunctionDerivatives}(Scalar u, DenseIndex order = DerivativeOrder) \textcolor{keyword}{const};
00181 
00185     DenseIndex \hyperlink{group___splines___module_a0df23e941ac0f31dcd095a4dd4f4a7ec}{degree}() \textcolor{keyword}{const};
00186 
00191     DenseIndex \hyperlink{group___splines___module_ab62751802b4cc237aadb0dbf3455df98}{span}(Scalar u) \textcolor{keyword}{const};
00192 
00196     \textcolor{keyword}{static} DenseIndex \hyperlink{group___splines___module_aaba7632c61b84194e890696c2b57be1b}{Span}(\textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<Spline>::Scalar} u, 
      DenseIndex degree, \textcolor{keyword}{const} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<Spline>::KnotVectorType}& 
      \hyperlink{group___splines___module_ae3eac8af580ad880d8ad3a259d453aa1}{knots});
00197     
00210     \textcolor{keyword}{static} BasisVectorType \hyperlink{group___splines___module_a038506788499d71aedddc5211c33bb6e}{BasisFunctions}(Scalar u, DenseIndex degree, \textcolor{keyword}{const} KnotVectorType& 
      knots);
00211 
00217     \textcolor{keyword}{static} BasisDerivativeType \hyperlink{group___splines___module_a2e42e79b08b560007062b8f56689ae24}{BasisFunctionDerivatives}(
00218       \textcolor{keyword}{const} Scalar u, \textcolor{keyword}{const} DenseIndex order, \textcolor{keyword}{const} DenseIndex degree, \textcolor{keyword}{const} KnotVectorType& knots);
00219 
00220   \textcolor{keyword}{private}:
00221     KnotVectorType m\_knots; 
00222     ControlPointVectorType  m\_ctrls; 
00224     \textcolor{keyword}{template} <\textcolor{keyword}{typename} DerivativeType>
00225     \textcolor{keyword}{static} \textcolor{keywordtype}{void} BasisFunctionDerivativesImpl(
00226       \textcolor{keyword}{const} \textcolor{keyword}{typename} \hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Spline<\_Scalar, \_Dim, \_Degree>::Scalar} u,
00227       \textcolor{keyword}{const} DenseIndex order,
00228       \textcolor{keyword}{const} DenseIndex p, 
00229       \textcolor{keyword}{const} \textcolor{keyword}{typename} \hyperlink{group___splines___module_a066f7a8b120316c9068b559f0790e9ec}{Spline<\_Scalar, \_Dim, \_Degree>::KnotVectorType}
      & U,
00230       DerivativeType& N\_);
00231   \};
00232 
00233   \textcolor{keyword}{template} <\textcolor{keyword}{typename} \_Scalar, \textcolor{keywordtype}{int} \_Dim, \textcolor{keywordtype}{int} \_Degree>
00234   DenseIndex \hyperlink{group___splines___module_aaba7632c61b84194e890696c2b57be1b}{Spline<\_Scalar, \_Dim, \_Degree>::Span}(
00235     \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits}< \hyperlink{group___splines___module_class_eigen_1_1_spline}{Spline<\_Scalar, \_Dim, \_Degree>} >::
      \hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Scalar} u,
00236     DenseIndex \hyperlink{group___splines___module_a0df23e941ac0f31dcd095a4dd4f4a7ec}{degree},
00237     \textcolor{keyword}{const} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits}< \hyperlink{group___splines___module_class_eigen_1_1_spline}{Spline<\_Scalar, \_Dim, \_Degree>} >
      ::\hyperlink{group___splines___module_a066f7a8b120316c9068b559f0790e9ec}{KnotVectorType}& \hyperlink{group___splines___module_ae3eac8af580ad880d8ad3a259d453aa1}{knots})
00238   \{
00239     \textcolor{comment}{// Piegl & Tiller, "The NURBS Book", A2.1 (p. 68)}
00240     \textcolor{keywordflow}{if} (u <= \hyperlink{group___splines___module_ae3eac8af580ad880d8ad3a259d453aa1}{knots}(0)) \textcolor{keywordflow}{return} \hyperlink{group___splines___module_a0df23e941ac0f31dcd095a4dd4f4a7ec}{degree};
00241     \textcolor{keyword}{const} \hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Scalar}* pos = std::upper\_bound(knots.data()+degree-1, knots.data()+knots.size()-degree-1, u
      );
00242     \textcolor{keywordflow}{return} \textcolor{keyword}{static\_cast<}DenseIndex\textcolor{keyword}{>}( std::distance(knots.data(), pos) - 1 );
00243   \}
00244 
00245   \textcolor{keyword}{template} <\textcolor{keyword}{typename} \_Scalar, \textcolor{keywordtype}{int} \_Dim, \textcolor{keywordtype}{int} \_Degree>
00246   \textcolor{keyword}{typename} \hyperlink{group___splines___module_a1d49cef942ea59d85d1711ee32354e6b}{Spline<\_Scalar, \_Dim, \_Degree>::BasisVectorType}
00247     \hyperlink{group___splines___module_a038506788499d71aedddc5211c33bb6e}{Spline<\_Scalar, \_Dim, \_Degree>::BasisFunctions}(
00248     \textcolor{keyword}{typename} \hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Spline<\_Scalar, \_Dim, \_Degree>::Scalar} u,
00249     DenseIndex degree,
00250     \textcolor{keyword}{const} \textcolor{keyword}{typename} \hyperlink{group___splines___module_a066f7a8b120316c9068b559f0790e9ec}{Spline<\_Scalar, \_Dim, \_Degree>::KnotVectorType}
      & knots)
00251   \{
00252     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___splines___module_a1d49cef942ea59d85d1711ee32354e6b}{Spline<\_Scalar, \_Dim, \_Degree>::BasisVectorType}
       \hyperlink{group___splines___module_a1d49cef942ea59d85d1711ee32354e6b}{BasisVectorType};
00253 
00254     \textcolor{keyword}{const} DenseIndex p = \hyperlink{group___splines___module_a0df23e941ac0f31dcd095a4dd4f4a7ec}{degree};
00255     \textcolor{keyword}{const} DenseIndex i = \hyperlink{group___splines___module_aaba7632c61b84194e890696c2b57be1b}{Spline::Span}(u, degree, knots);
00256 
00257     \textcolor{keyword}{const} \hyperlink{group___splines___module_a066f7a8b120316c9068b559f0790e9ec}{KnotVectorType}& U = \hyperlink{group___splines___module_ae3eac8af580ad880d8ad3a259d453aa1}{knots};
00258 
00259     BasisVectorType left(p+1); left(0) = \hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Scalar}(0);
00260     BasisVectorType right(p+1); right(0) = \hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Scalar}(0);        
00261 
00262     \hyperlink{group___core___module_class_eigen_1_1_vector_block}{VectorBlock<BasisVectorType,Degree>}(left,1,p) = u - 
      \hyperlink{group___core___module_class_eigen_1_1_vector_block}{VectorBlock<const KnotVectorType,Degree>}(U,i+1-p,p).reverse();
00263     \hyperlink{group___core___module_class_eigen_1_1_vector_block}{VectorBlock<BasisVectorType,Degree>}(right,1,p) = 
      \hyperlink{group___core___module_class_eigen_1_1_vector_block}{VectorBlock<const KnotVectorType,Degree>}(U,i+1,p) - u;
00264 
00265     BasisVectorType N(1,p+1);
00266     N(0) = \hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Scalar}(1);
00267     \textcolor{keywordflow}{for} (DenseIndex j=1; j<=p; ++j)
00268     \{
00269       \hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Scalar} saved = \hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Scalar}(0);
00270       \textcolor{keywordflow}{for} (DenseIndex r=0; r<j; r++)
00271       \{
00272         \textcolor{keyword}{const} \hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Scalar} tmp = N(r)/(right(r+1)+left(j-r));
00273         N[r] = saved + right(r+1)*tmp;
00274         saved = left(j-r)*tmp;
00275       \}
00276       N(j) = saved;
00277     \}
00278     \textcolor{keywordflow}{return} N;
00279   \}
00280 
00281   \textcolor{keyword}{template} <\textcolor{keyword}{typename} \_Scalar, \textcolor{keywordtype}{int} \_Dim, \textcolor{keywordtype}{int} \_Degree>
00282   DenseIndex \hyperlink{group___splines___module_a0df23e941ac0f31dcd095a4dd4f4a7ec}{Spline<\_Scalar, \_Dim, \_Degree>::degree}()\textcolor{keyword}{ const}
00283 \textcolor{keyword}{  }\{
00284     \textcolor{keywordflow}{if} (\_Degree == \hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Dynamic})
00285       \textcolor{keywordflow}{return} m\_knots.size() - m\_ctrls.cols() - 1;
00286     \textcolor{keywordflow}{else}
00287       \textcolor{keywordflow}{return} \_Degree;
00288   \}
00289 
00290   \textcolor{keyword}{template} <\textcolor{keyword}{typename} \_Scalar, \textcolor{keywordtype}{int} \_Dim, \textcolor{keywordtype}{int} \_Degree>
00291   DenseIndex \hyperlink{group___splines___module_ab62751802b4cc237aadb0dbf3455df98}{Spline<\_Scalar, \_Dim, \_Degree>::span}(
      \hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Scalar} u)\textcolor{keyword}{ const}
00292 \textcolor{keyword}{  }\{
00293     \textcolor{keywordflow}{return} \hyperlink{group___splines___module_aaba7632c61b84194e890696c2b57be1b}{Spline::Span}(u, \hyperlink{group___splines___module_a0df23e941ac0f31dcd095a4dd4f4a7ec}{degree}(), \hyperlink{group___splines___module_ae3eac8af580ad880d8ad3a259d453aa1}{knots}());
00294   \}
00295 
00296   \textcolor{keyword}{template} <\textcolor{keyword}{typename} \_Scalar, \textcolor{keywordtype}{int} \_Dim, \textcolor{keywordtype}{int} \_Degree>
00297   \textcolor{keyword}{typename} \hyperlink{group___splines___module_a9ade8a2f81dae6eedb8845cb080672bd}{Spline<\_Scalar, \_Dim, \_Degree>::PointType} 
      \hyperlink{group___splines___module_a3c7e1838eae4ee7e341ef9d3dbf9ba45}{Spline<\_Scalar, \_Dim, \_Degree>::operator()}(
      \hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Scalar} u)\textcolor{keyword}{ const}
00298 \textcolor{keyword}{  }\{
00299     \textcolor{keyword}{enum} \{ Order = \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<Spline>::OrderAtCompileTime} \};
00300 
00301     \textcolor{keyword}{const} DenseIndex \hyperlink{group___splines___module_ab62751802b4cc237aadb0dbf3455df98}{span} = this->\hyperlink{group___splines___module_ab62751802b4cc237aadb0dbf3455df98}{span}(u);
00302     \textcolor{keyword}{const} DenseIndex p = \hyperlink{group___splines___module_a0df23e941ac0f31dcd095a4dd4f4a7ec}{degree}();
00303     \textcolor{keyword}{const} \hyperlink{group___splines___module_a1d49cef942ea59d85d1711ee32354e6b}{BasisVectorType} basis\_funcs = \hyperlink{group___splines___module_afe0997f0bb02a3fac3073016abac04c6}{basisFunctions}(u);
00304 
00305     \textcolor{keyword}{const} \hyperlink{group___core___module_class_eigen_1_1_replicate}{Replicate<BasisVectorType,Dimension,1>} ctrl\_weights(
      basis\_funcs);
00306     \textcolor{keyword}{const} \hyperlink{group___core___module_class_eigen_1_1_block}{Block<const ControlPointVectorType,Dimension,Order>}
       ctrl\_pts(\hyperlink{group___splines___module_a0fc81e475d3a0ba34da1bd97f2e8fbc7}{ctrls}(),0,span-p,\hyperlink{group___splines___module_a82c233f1d4719bc52397d64a6c96c5b0a25366e5e79da5355d259a71096d8d8a7}{Dimension},p+1);
00307     \textcolor{keywordflow}{return} (ctrl\_weights * ctrl\_pts).rowwise().sum();
00308   \}
00309 
00310   \textcolor{comment}{/* --------------------------------------------------------------------------------------------- */}
00311 
00312   \textcolor{keyword}{template} <\textcolor{keyword}{typename} SplineType, \textcolor{keyword}{typename} DerivativeType>
00313   \textcolor{keywordtype}{void} derivativesImpl(\textcolor{keyword}{const} SplineType& spline, \textcolor{keyword}{typename} SplineType::Scalar u, DenseIndex order, 
      DerivativeType& der)
00314   \{    
00315     \textcolor{keyword}{enum} \{ \hyperlink{group___splines___module_a82c233f1d4719bc52397d64a6c96c5b0a25366e5e79da5355d259a71096d8d8a7}{Dimension} = \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<SplineType>::Dimension} \};
00316     \textcolor{keyword}{enum} \{ Order = \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<SplineType>::OrderAtCompileTime}
       \};
00317     \textcolor{keyword}{enum} \{ DerivativeOrder = DerivativeType::ColsAtCompileTime \};
00318 
00319     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<SplineType>::ControlPointVectorType}
       \hyperlink{group___splines___module_ac42c673462a98ad1779761bebeb450bf}{ControlPointVectorType};
00320     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} 
      \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<SplineType,DerivativeOrder>::BasisDerivativeType}
       \hyperlink{group___splines___module_a9db0b0108353660cd03524f2e67d6b3c}{BasisDerivativeType};
00321     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} BasisDerivativeType::ConstRowXpr BasisDerivativeRowXpr;    
00322 
00323     \textcolor{keyword}{const} DenseIndex p = spline.degree();
00324     \textcolor{keyword}{const} DenseIndex \hyperlink{group___splines___module_ab62751802b4cc237aadb0dbf3455df98}{span} = spline.span(u);
00325 
00326     \textcolor{keyword}{const} DenseIndex n = (std::min)(p, order);
00327 
00328     der.resize(\hyperlink{group___splines___module_a82c233f1d4719bc52397d64a6c96c5b0a25366e5e79da5355d259a71096d8d8a7}{Dimension},n+1);
00329 
00330     \textcolor{comment}{// Retrieve the basis function derivatives up to the desired order...    }
00331     \textcolor{keyword}{const} BasisDerivativeType basis\_func\_ders = spline.template basisFunctionDerivatives<DerivativeOrder>(u
      , n+1);
00332 
00333     \textcolor{comment}{// ... and perform the linear combinations of the control points.}
00334     \textcolor{keywordflow}{for} (DenseIndex der\_order=0; der\_order<n+1; ++der\_order)
00335     \{
00336       \textcolor{keyword}{const} \hyperlink{group___core___module_class_eigen_1_1_replicate}{Replicate<BasisDerivativeRowXpr,Dimension,1>} 
      ctrl\_weights( basis\_func\_ders.row(der\_order) );
00337       \textcolor{keyword}{const} \hyperlink{group___core___module_class_eigen_1_1_block}{Block<const ControlPointVectorType,Dimension,Order>}
       ctrl\_pts(spline.ctrls(),0,span-p,\hyperlink{group___splines___module_a82c233f1d4719bc52397d64a6c96c5b0a25366e5e79da5355d259a71096d8d8a7}{Dimension},p+1);
00338       der.col(der\_order) = (ctrl\_weights * ctrl\_pts).rowwise().sum();
00339     \}
00340   \}
00341 
00342   \textcolor{keyword}{template} <\textcolor{keyword}{typename} \_Scalar, \textcolor{keywordtype}{int} \_Dim, \textcolor{keywordtype}{int} \_Degree>
00343   \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits< Spline<\_Scalar, \_Dim, \_Degree>} >
      ::DerivativeType
00344     \hyperlink{group___splines___module_a196730cf190dfa16907db888277e5aed}{Spline<\_Scalar, \_Dim, \_Degree>::derivatives}(
      \hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Scalar} u, DenseIndex order)\textcolor{keyword}{ const}
00345 \textcolor{keyword}{  }\{
00346     \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits< Spline >::DerivativeType} res;
00347     derivativesImpl(*\textcolor{keyword}{this}, u, order, res);
00348     \textcolor{keywordflow}{return} res;
00349   \}
00350 
00351   \textcolor{keyword}{template} <\textcolor{keyword}{typename} \_Scalar, \textcolor{keywordtype}{int} \_Dim, \textcolor{keywordtype}{int} \_Degree>
00352   \textcolor{keyword}{template} <\textcolor{keywordtype}{int} DerivativeOrder>
00353   \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits< Spline<\_Scalar, \_Dim, \_Degree>}, 
      DerivativeOrder >::DerivativeType
00354     \hyperlink{group___splines___module_a196730cf190dfa16907db888277e5aed}{Spline<\_Scalar, \_Dim, \_Degree>::derivatives}(
      \hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Scalar} u, DenseIndex order)\textcolor{keyword}{ const}
00355 \textcolor{keyword}{  }\{
00356     \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits< Spline, DerivativeOrder >::DerivativeType}
       res;
00357     derivativesImpl(*\textcolor{keyword}{this}, u, order, res);
00358     \textcolor{keywordflow}{return} res;
00359   \}
00360 
00361   \textcolor{keyword}{template} <\textcolor{keyword}{typename} \_Scalar, \textcolor{keywordtype}{int} \_Dim, \textcolor{keywordtype}{int} \_Degree>
00362   \textcolor{keyword}{typename} SplineTraits< Spline<\_Scalar, \_Dim, \_Degree> >\hyperlink{group___splines___module_a1d49cef942ea59d85d1711ee32354e6b}{::BasisVectorType}
00363     \hyperlink{group___splines___module_afe0997f0bb02a3fac3073016abac04c6}{Spline<\_Scalar, \_Dim, \_Degree>::basisFunctions}(
      \hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Scalar} u)\textcolor{keyword}{ const}
00364 \textcolor{keyword}{  }\{
00365     \textcolor{keywordflow}{return} \hyperlink{group___splines___module_a038506788499d71aedddc5211c33bb6e}{Spline::BasisFunctions}(u, \hyperlink{group___splines___module_a0df23e941ac0f31dcd095a4dd4f4a7ec}{degree}(), \hyperlink{group___splines___module_ae3eac8af580ad880d8ad3a259d453aa1}{knots}());
00366   \}
00367 
00368   \textcolor{comment}{/* --------------------------------------------------------------------------------------------- */}
00369   
00370   
00371   \textcolor{keyword}{template} <\textcolor{keyword}{typename} \_Scalar, \textcolor{keywordtype}{int} \_Dim, \textcolor{keywordtype}{int} \_Degree>
00372   \textcolor{keyword}{template} <\textcolor{keyword}{typename} DerivativeType>
00373   \textcolor{keywordtype}{void} \hyperlink{group___splines___module_class_eigen_1_1_spline}{Spline<\_Scalar, \_Dim, \_Degree>::BasisFunctionDerivativesImpl}
      (
00374     \textcolor{keyword}{const} \textcolor{keyword}{typename} \hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Spline<\_Scalar, \_Dim, \_Degree>::Scalar} u,
00375     \textcolor{keyword}{const} DenseIndex order,
00376     \textcolor{keyword}{const} DenseIndex p, 
00377     \textcolor{keyword}{const} \textcolor{keyword}{typename} \hyperlink{group___splines___module_a066f7a8b120316c9068b559f0790e9ec}{Spline<\_Scalar, \_Dim, \_Degree>::KnotVectorType}
      & U,
00378     DerivativeType& N\_)
00379   \{
00380     \textcolor{keyword}{typedef} \hyperlink{group___splines___module_class_eigen_1_1_spline}{Spline<\_Scalar, \_Dim, \_Degree>} SplineType;
00381     \textcolor{keyword}{enum} \{ Order = \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<SplineType>::OrderAtCompileTime}
       \};
00382 
00383     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<SplineType>::Scalar} 
      \hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Scalar};
00384     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<SplineType>::BasisVectorType} 
      \hyperlink{group___splines___module_a1d49cef942ea59d85d1711ee32354e6b}{BasisVectorType};
00385   
00386     \textcolor{keyword}{const} DenseIndex \hyperlink{group___splines___module_ab62751802b4cc237aadb0dbf3455df98}{span} = SplineType::Span(u, p, U);
00387 
00388     \textcolor{keyword}{const} DenseIndex n = (std::min)(p, order);
00389 
00390     N\_.resize(n+1, p+1);
00391 
00392     BasisVectorType left = BasisVectorType::Zero(p+1);
00393     BasisVectorType right = BasisVectorType::Zero(p+1);
00394 
00395     \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,Order,Order>} ndu(p+1,p+1);
00396 
00397     Scalar saved, temp; \textcolor{comment}{// FIXME These were double instead of Scalar. Was there a reason for that?}
00398 
00399     ndu(0,0) = 1.0;
00400 
00401     DenseIndex j;
00402     \textcolor{keywordflow}{for} (j=1; j<=p; ++j)
00403     \{
00404       left[j] = u-U[span+1-j];
00405       right[j] = U[span+j]-u;
00406       saved = 0.0;
00407 
00408       \textcolor{keywordflow}{for} (DenseIndex r=0; r<j; ++r)
00409       \{
00410         \textcolor{comment}{/* Lower triangle */}
00411         ndu(j,r) = right[r+1]+left[j-r];
00412         temp = ndu(r,j-1)/ndu(j,r);
00413         \textcolor{comment}{/* Upper triangle */}
00414         ndu(r,j) = \textcolor{keyword}{static\_cast<}Scalar\textcolor{keyword}{>}(saved+right[r+1] * temp);
00415         saved = left[j-r] * temp;
00416       \}
00417 
00418       ndu(j,j) = \textcolor{keyword}{static\_cast<}Scalar\textcolor{keyword}{>}(saved);
00419     \}
00420 
00421     \textcolor{keywordflow}{for} (j = p; j>=0; --j) 
00422       N\_(0,j) = ndu(j,p);
00423 
00424     \textcolor{comment}{// Compute the derivatives}
00425     DerivativeType a(n+1,p+1);
00426     DenseIndex r=0;
00427     \textcolor{keywordflow}{for} (; r<=p; ++r)
00428     \{
00429       DenseIndex s1,s2;
00430       s1 = 0; s2 = 1; \textcolor{comment}{// alternate rows in array a}
00431       a(0,0) = 1.0;
00432 
00433       \textcolor{comment}{// Compute the k-th derivative}
00434       \textcolor{keywordflow}{for} (DenseIndex k=1; k<=static\_cast<DenseIndex>(n); ++k)
00435       \{
00436         Scalar d = 0.0;
00437         DenseIndex rk,pk,j1,j2;
00438         rk = r-k; pk = p-k;
00439 
00440         \textcolor{keywordflow}{if} (r>=k)
00441         \{
00442           a(s2,0) = a(s1,0)/ndu(pk+1,rk);
00443           d = a(s2,0)*ndu(rk,pk);
00444         \}
00445 
00446         \textcolor{keywordflow}{if} (rk>=-1) j1 = 1;
00447         \textcolor{keywordflow}{else}        j1 = -rk;
00448 
00449         \textcolor{keywordflow}{if} (r-1 <= pk) j2 = k-1;
00450         \textcolor{keywordflow}{else}           j2 = p-r;
00451 
00452         \textcolor{keywordflow}{for} (j=j1; j<=j2; ++j)
00453         \{
00454           a(s2,j) = (a(s1,j)-a(s1,j-1))/ndu(pk+1,rk+j);
00455           d += a(s2,j)*ndu(rk+j,pk);
00456         \}
00457 
00458         \textcolor{keywordflow}{if} (r<=pk)
00459         \{
00460           a(s2,k) = -a(s1,k-1)/ndu(pk+1,r);
00461           d += a(s2,k)*ndu(r,pk);
00462         \}
00463 
00464         N\_(k,r) = \textcolor{keyword}{static\_cast<}Scalar\textcolor{keyword}{>}(d);
00465         j = s1; s1 = s2; s2 = j; \textcolor{comment}{// Switch rows}
00466       \}
00467     \}
00468 
00469     \textcolor{comment}{/* Multiply through by the correct factors */}
00470     \textcolor{comment}{/* (Eq. [2.9])                             */}
00471     r = p;
00472     \textcolor{keywordflow}{for} (DenseIndex k=1; k<=static\_cast<DenseIndex>(n); ++k)
00473     \{
00474       \textcolor{keywordflow}{for} (j=p; j>=0; --j) N\_(k,j) *= r;
00475       r *= p-k;
00476     \}
00477   \}
00478 
00479   \textcolor{keyword}{template} <\textcolor{keyword}{typename} \_Scalar, \textcolor{keywordtype}{int} \_Dim, \textcolor{keywordtype}{int} \_Degree>
00480   \textcolor{keyword}{typename} SplineTraits< Spline<\_Scalar, \_Dim, \_Degree> >\hyperlink{group___splines___module_a9db0b0108353660cd03524f2e67d6b3c}{::BasisDerivativeType}
00481     \hyperlink{group___splines___module_a17d416e814d1ee957e5b309dc423751f}{Spline<\_Scalar, \_Dim, \_Degree>::basisFunctionDerivatives}
      (\hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Scalar} u, DenseIndex order)\textcolor{keyword}{ const}
00482 \textcolor{keyword}{  }\{
00483     \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<Spline<\_Scalar, \_Dim, \_Degree>} >
      \hyperlink{group___splines___module_a9db0b0108353660cd03524f2e67d6b3c}{::BasisDerivativeType} der;
00484     BasisFunctionDerivativesImpl(u, order, \hyperlink{group___splines___module_a0df23e941ac0f31dcd095a4dd4f4a7ec}{degree}(), \hyperlink{group___splines___module_ae3eac8af580ad880d8ad3a259d453aa1}{knots}(), der);
00485     \textcolor{keywordflow}{return} der;
00486   \}
00487 
00488   \textcolor{keyword}{template} <\textcolor{keyword}{typename} \_Scalar, \textcolor{keywordtype}{int} \_Dim, \textcolor{keywordtype}{int} \_Degree>
00489   \textcolor{keyword}{template} <\textcolor{keywordtype}{int} DerivativeOrder>
00490   \textcolor{keyword}{typename} SplineTraits< Spline<\_Scalar, \_Dim, \_Degree>, DerivativeOrder >
      \hyperlink{group___splines___module_a9db0b0108353660cd03524f2e67d6b3c}{::BasisDerivativeType}
00491     \hyperlink{group___splines___module_a17d416e814d1ee957e5b309dc423751f}{Spline<\_Scalar, \_Dim, \_Degree>::basisFunctionDerivatives}
      (\hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Scalar} u, DenseIndex order)\textcolor{keyword}{ const}
00492 \textcolor{keyword}{  }\{
00493     \textcolor{keyword}{typename} SplineTraits< Spline<\_Scalar, \_Dim, \_Degree>, DerivativeOrder >
      \hyperlink{group___splines___module_a9db0b0108353660cd03524f2e67d6b3c}{::BasisDerivativeType} der;
00494     BasisFunctionDerivativesImpl(u, order, \hyperlink{group___splines___module_a0df23e941ac0f31dcd095a4dd4f4a7ec}{degree}(), \hyperlink{group___splines___module_ae3eac8af580ad880d8ad3a259d453aa1}{knots}(), der);
00495     \textcolor{keywordflow}{return} der;
00496   \}
00497 
00498   \textcolor{keyword}{template} <\textcolor{keyword}{typename} \_Scalar, \textcolor{keywordtype}{int} \_Dim, \textcolor{keywordtype}{int} \_Degree>
00499   \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<Spline<\_Scalar, \_Dim, \_Degree>} >
      \hyperlink{group___splines___module_a9db0b0108353660cd03524f2e67d6b3c}{::BasisDerivativeType}
00500   \hyperlink{group___splines___module_a2e42e79b08b560007062b8f56689ae24}{Spline<\_Scalar, \_Dim, \_Degree>::BasisFunctionDerivatives}
      (
00501     \textcolor{keyword}{const} \textcolor{keyword}{typename} \hyperlink{group___splines___module_a8cafd78b564825c76fbb3419653d9742}{Spline<\_Scalar, \_Dim, \_Degree>::Scalar} u,
00502     \textcolor{keyword}{const} DenseIndex order,
00503     \textcolor{keyword}{const} DenseIndex degree,
00504     \textcolor{keyword}{const} \textcolor{keyword}{typename} \hyperlink{group___splines___module_a066f7a8b120316c9068b559f0790e9ec}{Spline<\_Scalar, \_Dim, \_Degree>::KnotVectorType}
      & knots)
00505   \{
00506     \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1_spline_traits}{SplineTraits<Spline>::BasisDerivativeType} der;
00507     BasisFunctionDerivativesImpl(u, order, degree, knots, der);
00508     \textcolor{keywordflow}{return} der;
00509   \}
00510 \}
00511 
00512 \textcolor{preprocessor}{#endif // EIGEN\_SPLINE\_H}
\end{DoxyCode}
