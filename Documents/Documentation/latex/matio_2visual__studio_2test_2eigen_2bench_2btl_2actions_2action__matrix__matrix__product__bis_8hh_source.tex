\hypertarget{matio_2visual__studio_2test_2eigen_2bench_2btl_2actions_2action__matrix__matrix__product__bis_8hh_source}{}\section{matio/visual\+\_\+studio/test/eigen/bench/btl/actions/action\+\_\+matrix\+\_\+matrix\+\_\+product\+\_\+bis.hh}
\label{matio_2visual__studio_2test_2eigen_2bench_2btl_2actions_2action__matrix__matrix__product__bis_8hh_source}\index{action\+\_\+matrix\+\_\+matrix\+\_\+product\+\_\+bis.\+hh@{action\+\_\+matrix\+\_\+matrix\+\_\+product\+\_\+bis.\+hh}}

\begin{DoxyCode}
00001 \textcolor{comment}{//=====================================================}
00002 \textcolor{comment}{// File   :  action\_matrix\_matrix\_product\_bis.hh}
00003 \textcolor{comment}{// Author :  L. Plagne <laurent.plagne@edf.fr)>}
00004 \textcolor{comment}{// Copyright (C) EDF R&D,  lun sep 30 14:23:19 CEST 2002}
00005 \textcolor{comment}{//=====================================================}
00006 \textcolor{comment}{//}
00007 \textcolor{comment}{// This program is free software; you can redistribute it and/or}
00008 \textcolor{comment}{// modify it under the terms of the GNU General Public License}
00009 \textcolor{comment}{// as published by the Free Software Foundation; either version 2}
00010 \textcolor{comment}{// of the License, or (at your option) any later version.}
00011 \textcolor{comment}{//}
00012 \textcolor{comment}{// This program is distributed in the hope that it will be useful,}
00013 \textcolor{comment}{// but WITHOUT ANY WARRANTY; without even the implied warranty of}
00014 \textcolor{comment}{// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00015 \textcolor{comment}{// GNU General Public License for more details.}
00016 \textcolor{comment}{// You should have received a copy of the GNU General Public License}
00017 \textcolor{comment}{// along with this program; if not, write to the Free Software}
00018 \textcolor{comment}{// Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.}
00019 \textcolor{comment}{//}
00020 \textcolor{preprocessor}{#ifndef ACTION\_MATRIX\_MATRIX\_PRODUCT\_BIS}
00021 \textcolor{preprocessor}{#define ACTION\_MATRIX\_MATRIX\_PRODUCT\_BIS}
00022 \textcolor{preprocessor}{#include "utilities.h"}
00023 \textcolor{preprocessor}{#include "STL\_interface.hh"}
00024 \textcolor{preprocessor}{#include "STL\_timer.hh"}
00025 \textcolor{preprocessor}{#include <string>}
00026 \textcolor{preprocessor}{#include "init\_function.hh"}
00027 \textcolor{preprocessor}{#include "init\_vector.hh"}
00028 \textcolor{preprocessor}{#include "init\_matrix.hh"}
00029 
00030 \textcolor{keyword}{using namespace }\hyperlink{namespacestd}{std};
00031 
00032 \textcolor{keyword}{template}<\textcolor{keyword}{class} Interface>
00033 \textcolor{keyword}{class }\hyperlink{class_action__matrix__matrix__product__bis}{Action\_matrix\_matrix\_product\_bis} \{
00034 
00035 public :
00036 
00037   \textcolor{keyword}{static} \textcolor{keyword}{inline} std::string name( \textcolor{keywordtype}{void} )
00038   \{
00039     \textcolor{keywordflow}{return} \textcolor{stringliteral}{"matrix\_matrix\_"}+Interface::name();
00040   \}
00041 
00042   \textcolor{keyword}{static} \textcolor{keywordtype}{double} nb\_op\_base(\textcolor{keywordtype}{int} size)\{
00043     \textcolor{keywordflow}{return} 2.0*size*size*size;
00044   \}
00045 
00046   \textcolor{keyword}{static} \textcolor{keywordtype}{double} calculate( \textcolor{keywordtype}{int} nb\_calc, \textcolor{keywordtype}{int} size ) \{
00047 
00048     \textcolor{comment}{// STL matrix and vector initialization}
00049 
00050     \textcolor{keyword}{typename} Interface::stl\_matrix A\_stl;
00051     \textcolor{keyword}{typename} Interface::stl\_matrix B\_stl;
00052     \textcolor{keyword}{typename} Interface::stl\_matrix X\_stl;
00053 
00054     init\_matrix<pseudo\_random>(A\_stl,size);
00055     init\_matrix<pseudo\_random>(B\_stl,size);
00056     init\_matrix<null\_function>(X\_stl,size);
00057 
00058     \textcolor{comment}{// generic matrix and vector initialization}
00059 
00060     \textcolor{keyword}{typename} Interface::gene\_matrix A\_ref;
00061     \textcolor{keyword}{typename} Interface::gene\_matrix B\_ref;
00062     \textcolor{keyword}{typename} Interface::gene\_matrix X\_ref;
00063 
00064     \textcolor{keyword}{typename} Interface::gene\_matrix A;
00065     \textcolor{keyword}{typename} Interface::gene\_matrix B;
00066     \textcolor{keyword}{typename} Interface::gene\_matrix X;
00067 
00068 
00069     Interface::matrix\_from\_stl(A\_ref,A\_stl);
00070     Interface::matrix\_from\_stl(B\_ref,B\_stl);
00071     Interface::matrix\_from\_stl(X\_ref,X\_stl);
00072 
00073     Interface::matrix\_from\_stl(A,A\_stl);
00074     Interface::matrix\_from\_stl(B,B\_stl);
00075     Interface::matrix\_from\_stl(X,X\_stl);
00076 
00077 
00078     \textcolor{comment}{// STL\_timer utilities}
00079 
00080     STL\_timer chronos;
00081 
00082     \textcolor{comment}{// Baseline evaluation}
00083 
00084     chronos.start\_baseline(nb\_calc);
00085 
00086     \textcolor{keywordflow}{do} \{
00087 
00088       Interface::copy\_matrix(A\_ref,A,size);
00089       Interface::copy\_matrix(B\_ref,B,size);
00090       Interface::copy\_matrix(X\_ref,X,size);
00091 
00092 
00093       \textcolor{comment}{//      Interface::matrix\_matrix\_product(A,B,X,size); This line must be commented !!!!}
00094     \}
00095     \textcolor{keywordflow}{while}(chronos.check());
00096 
00097     chronos.report(\textcolor{keyword}{true});
00098 
00099     \textcolor{comment}{// Time measurement}
00100 
00101     chronos.start(nb\_calc);
00102 
00103     \textcolor{keywordflow}{do} \{
00104 
00105       Interface::copy\_matrix(A\_ref,A,size);
00106       Interface::copy\_matrix(B\_ref,B,size);
00107       Interface::copy\_matrix(X\_ref,X,size);
00108 
00109       Interface::matrix\_matrix\_product(A,B,X,size); \textcolor{comment}{// here it is not commented !!!!}
00110     \}
00111     \textcolor{keywordflow}{while}(chronos.check());
00112 
00113     chronos.report(\textcolor{keyword}{true});
00114 
00115     \textcolor{keywordtype}{double} time=chronos.calculated\_time/2000.0;
00116 
00117     \textcolor{comment}{// calculation check}
00118 
00119     \textcolor{keyword}{typename} Interface::stl\_matrix resu\_stl(size);
00120 
00121     Interface::matrix\_to\_stl(X,resu\_stl);
00122 
00123     \hyperlink{class_s_t_l__interface}{STL\_interface<typename Interface::real\_type>::matrix\_matrix\_product}
      (A\_stl,B\_stl,X\_stl,size);
00124 
00125     \textcolor{keyword}{typename} Interface::real\_type error=
00126       \hyperlink{class_s_t_l__interface}{STL\_interface<typename Interface::real\_type>::norm\_diff}
      (X\_stl,resu\_stl);
00127 
00128     \textcolor{keywordflow}{if} (error>1.e-6)\{
00129       INFOS(\textcolor{stringliteral}{"WRONG CALCULATION...residual="} << error);
00130       exit(1);
00131     \}
00132 
00133     \textcolor{comment}{// deallocation and return time}
00134 
00135     Interface::free\_matrix(A,size);
00136     Interface::free\_matrix(B,size);
00137     Interface::free\_matrix(X,size);
00138 
00139     Interface::free\_matrix(A\_ref,size);
00140     Interface::free\_matrix(B\_ref,size);
00141     Interface::free\_matrix(X\_ref,size);
00142 
00143     \textcolor{keywordflow}{return} time;
00144   \}
00145 
00146 \};
00147 
00148 
00149 \textcolor{preprocessor}{#endif}
00150 
00151 
00152 
\end{DoxyCode}
