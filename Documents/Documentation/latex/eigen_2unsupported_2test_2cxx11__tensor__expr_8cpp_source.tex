\hypertarget{eigen_2unsupported_2test_2cxx11__tensor__expr_8cpp_source}{}\section{eigen/unsupported/test/cxx11\+\_\+tensor\+\_\+expr.cpp}
\label{eigen_2unsupported_2test_2cxx11__tensor__expr_8cpp_source}\index{cxx11\+\_\+tensor\+\_\+expr.\+cpp@{cxx11\+\_\+tensor\+\_\+expr.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2014 Benoit Steiner <benoit.steiner.goog@gmail.com>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#include "main.h"}
00011 
00012 \textcolor{preprocessor}{#include <Eigen/CXX11/Tensor>}
00013 
00014 \textcolor{keyword}{using} \hyperlink{class_eigen_1_1_tensor}{Eigen::Tensor};
00015 \textcolor{keyword}{using} \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13acfcde9cd8677c5f7caf6bd603666aae3}{Eigen::RowMajor};
00016 
00017 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_1d()
00018 \{
00019   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 1>} vec1(6);
00020   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 1, RowMajor>} vec2(6);
00021 
00022   vec1(0) = 4.0;  vec2(0) = 0.0;
00023   vec1(1) = 8.0;  vec2(1) = 1.0;
00024   vec1(2) = 15.0; vec2(2) = 2.0;
00025   vec1(3) = 16.0; vec2(3) = 3.0;
00026   vec1(4) = 23.0; vec2(4) = 4.0;
00027   vec1(5) = 42.0; vec2(5) = 5.0;
00028 
00029   \textcolor{keywordtype}{float} data3[6];
00030   TensorMap<Tensor<float, 1>> vec3(data3, 6);
00031   vec3 = vec1.sqrt();
00032   \textcolor{keywordtype}{float} data4[6];
00033   TensorMap<Tensor<float, 1, RowMajor>> vec4(data4, 6);
00034   vec4 = vec2.square();
00035   \textcolor{keywordtype}{float} data5[6];
00036   TensorMap<Tensor<float, 1, RowMajor>> vec5(data5, 6);
00037   vec5 = vec2.cube();
00038 
00039   VERIFY\_IS\_APPROX(vec3(0), sqrtf(4.0));
00040   VERIFY\_IS\_APPROX(vec3(1), sqrtf(8.0));
00041   VERIFY\_IS\_APPROX(vec3(2), sqrtf(15.0));
00042   VERIFY\_IS\_APPROX(vec3(3), sqrtf(16.0));
00043   VERIFY\_IS\_APPROX(vec3(4), sqrtf(23.0));
00044   VERIFY\_IS\_APPROX(vec3(5), sqrtf(42.0));
00045 
00046   VERIFY\_IS\_APPROX(vec4(0), 0.0f);
00047   VERIFY\_IS\_APPROX(vec4(1), 1.0f);
00048   VERIFY\_IS\_APPROX(vec4(2), 2.0f * 2.0f);
00049   VERIFY\_IS\_APPROX(vec4(3), 3.0f * 3.0f);
00050   VERIFY\_IS\_APPROX(vec4(4), 4.0f * 4.0f);
00051   VERIFY\_IS\_APPROX(vec4(5), 5.0f * 5.0f);
00052 
00053   VERIFY\_IS\_APPROX(vec5(0), 0.0f);
00054   VERIFY\_IS\_APPROX(vec5(1), 1.0f);
00055   VERIFY\_IS\_APPROX(vec5(2), 2.0f * 2.0f * 2.0f);
00056   VERIFY\_IS\_APPROX(vec5(3), 3.0f * 3.0f * 3.0f);
00057   VERIFY\_IS\_APPROX(vec5(4), 4.0f * 4.0f * 4.0f);
00058   VERIFY\_IS\_APPROX(vec5(5), 5.0f * 5.0f * 5.0f);
00059 
00060   vec3 = vec1 + vec2;
00061   VERIFY\_IS\_APPROX(vec3(0), 4.0f + 0.0f);
00062   VERIFY\_IS\_APPROX(vec3(1), 8.0f + 1.0f);
00063   VERIFY\_IS\_APPROX(vec3(2), 15.0f + 2.0f);
00064   VERIFY\_IS\_APPROX(vec3(3), 16.0f + 3.0f);
00065   VERIFY\_IS\_APPROX(vec3(4), 23.0f + 4.0f);
00066   VERIFY\_IS\_APPROX(vec3(5), 42.0f + 5.0f);
00067 \}
00068 
00069 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_2d()
00070 \{
00071   \textcolor{keywordtype}{float} data1[6];
00072   TensorMap<Tensor<float, 2>> mat1(data1, 2, 3);
00073   \textcolor{keywordtype}{float} data2[6];
00074   TensorMap<Tensor<float, 2, RowMajor>> mat2(data2, 2, 3);
00075 
00076   mat1(0,0) = 0.0;
00077   mat1(0,1) = 1.0;
00078   mat1(0,2) = 2.0;
00079   mat1(1,0) = 3.0;
00080   mat1(1,1) = 4.0;
00081   mat1(1,2) = 5.0;
00082 
00083   mat2(0,0) = -0.0;
00084   mat2(0,1) = -1.0;
00085   mat2(0,2) = -2.0;
00086   mat2(1,0) = -3.0;
00087   mat2(1,1) = -4.0;
00088   mat2(1,2) = -5.0;
00089 
00090   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 2>} mat3(2,3);
00091   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 2, RowMajor>} mat4(2,3);
00092   mat3 = mat1.abs();
00093   mat4 = mat2.abs();
00094 
00095   VERIFY\_IS\_APPROX(mat3(0,0), 0.0f);
00096   VERIFY\_IS\_APPROX(mat3(0,1), 1.0f);
00097   VERIFY\_IS\_APPROX(mat3(0,2), 2.0f);
00098   VERIFY\_IS\_APPROX(mat3(1,0), 3.0f);
00099   VERIFY\_IS\_APPROX(mat3(1,1), 4.0f);
00100   VERIFY\_IS\_APPROX(mat3(1,2), 5.0f);
00101 
00102   VERIFY\_IS\_APPROX(mat4(0,0), 0.0f);
00103   VERIFY\_IS\_APPROX(mat4(0,1), 1.0f);
00104   VERIFY\_IS\_APPROX(mat4(0,2), 2.0f);
00105   VERIFY\_IS\_APPROX(mat4(1,0), 3.0f);
00106   VERIFY\_IS\_APPROX(mat4(1,1), 4.0f);
00107   VERIFY\_IS\_APPROX(mat4(1,2), 5.0f);
00108 \}
00109 
00110 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_3d()
00111 \{
00112   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} mat1(2,3,7);
00113   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3, RowMajor>} mat2(2,3,7);
00114 
00115   \textcolor{keywordtype}{float} val = 1.0f;
00116   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00117     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
00118       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 7; ++k) \{
00119         mat1(i,j,k) = val;
00120         mat2(i,j,k) = val;
00121         val += 1.0f;
00122       \}
00123     \}
00124   \}
00125 
00126   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} mat3(2,3,7);
00127   mat3 = mat1 + mat1;
00128   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3, RowMajor>} mat4(2,3,7);
00129   mat4 = mat2 * 3.14f;
00130   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} mat5(2,3,7);
00131   mat5 = mat1.inverse().log();
00132   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3, RowMajor>} mat6(2,3,7);
00133   mat6 = mat2.pow(0.5f) * 3.14f;
00134   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} mat7(2,3,7);
00135   mat7 = mat1.cwiseMax(mat5 * 2.0f).exp();
00136   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3, RowMajor>} mat8(2,3,7);
00137   mat8 = (-mat2).exp() * 3.14f;
00138   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3, RowMajor>} mat9(2,3,7);
00139   mat9 = mat2 + 3.14f;
00140   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3, RowMajor>} mat10(2,3,7);
00141   mat10 = mat2 - 3.14f;
00142   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3, RowMajor>} mat11(2,3,7);
00143   mat11 = mat2 / 3.14f;
00144 
00145   val = 1.0f;
00146   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00147     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
00148       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 7; ++k) \{
00149         VERIFY\_IS\_APPROX(mat3(i,j,k), val + val);
00150         VERIFY\_IS\_APPROX(mat4(i,j,k), val * 3.14f);
00151         VERIFY\_IS\_APPROX(mat5(i,j,k), logf(1.0f/val));
00152         VERIFY\_IS\_APPROX(mat6(i,j,k), sqrtf(val) * 3.14f);
00153         VERIFY\_IS\_APPROX(mat7(i,j,k), expf((std::max)(val, mat5(i,j,k) * 2.0f)));
00154         VERIFY\_IS\_APPROX(mat8(i,j,k), expf(-val) * 3.14f);
00155         VERIFY\_IS\_APPROX(mat9(i,j,k), val + 3.14f);
00156         VERIFY\_IS\_APPROX(mat10(i,j,k), val - 3.14f);
00157         VERIFY\_IS\_APPROX(mat11(i,j,k), val / 3.14f);
00158         val += 1.0f;
00159       \}
00160     \}
00161   \}
00162 \}
00163 
00164 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_constants()
00165 \{
00166   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} mat1(2,3,7);
00167   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} mat2(2,3,7);
00168   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} mat3(2,3,7);
00169 
00170   \textcolor{keywordtype}{float} val = 1.0f;
00171   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00172     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
00173       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 7; ++k) \{
00174         mat1(i,j,k) = val;
00175         val += 1.0f;
00176       \}
00177     \}
00178   \}
00179   mat2 = mat1.constant(3.14f);
00180   mat3 = mat1.cwiseMax(7.3f).exp();
00181 
00182   val = 1.0f;
00183   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00184     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
00185       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 7; ++k) \{
00186         VERIFY\_IS\_APPROX(mat2(i,j,k), 3.14f);
00187         VERIFY\_IS\_APPROX(mat3(i,j,k), expf((std::max)(val, 7.3f)));
00188         val += 1.0f;
00189       \}
00190     \}
00191   \}
00192 \}
00193 
00194 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_boolean()
00195 \{
00196   \hyperlink{class_eigen_1_1_tensor}{Tensor<int, 1>} vec(6);
00197   std::copy\_n(std::begin(\{0, 1, 2, 3, 4, 5\}), 6, vec.data());
00198 
00199   \textcolor{comment}{// Test ||.}
00200   \hyperlink{class_eigen_1_1_tensor}{Tensor<bool, 1>} bool1 = vec < vec.constant(1) || vec > vec.constant(4);
00201   VERIFY\_IS\_EQUAL(bool1[0], \textcolor{keyword}{true});
00202   VERIFY\_IS\_EQUAL(bool1[1], \textcolor{keyword}{false});
00203   VERIFY\_IS\_EQUAL(bool1[2], \textcolor{keyword}{false});
00204   VERIFY\_IS\_EQUAL(bool1[3], \textcolor{keyword}{false});
00205   VERIFY\_IS\_EQUAL(bool1[4], \textcolor{keyword}{false});
00206   VERIFY\_IS\_EQUAL(bool1[5], \textcolor{keyword}{true});
00207 
00208   \textcolor{comment}{// Test &&, including cast of operand vec.}
00209   \hyperlink{class_eigen_1_1_tensor}{Tensor<bool, 1>} bool2 = vec.cast<\textcolor{keywordtype}{bool}>() && vec < vec.constant(4);
00210   VERIFY\_IS\_EQUAL(bool2[0], \textcolor{keyword}{false});
00211   VERIFY\_IS\_EQUAL(bool2[1], \textcolor{keyword}{true});
00212   VERIFY\_IS\_EQUAL(bool2[2], \textcolor{keyword}{true});
00213   VERIFY\_IS\_EQUAL(bool2[3], \textcolor{keyword}{true});
00214   VERIFY\_IS\_EQUAL(bool2[4], \textcolor{keyword}{false});
00215   VERIFY\_IS\_EQUAL(bool2[5], \textcolor{keyword}{false});
00216 
00217   \textcolor{comment}{// Compilation tests:}
00218   \textcolor{comment}{// Test Tensor<bool> against results of cast or comparison; verifies that}
00219   \textcolor{comment}{// CoeffReturnType is set to match Op return type of bool for Unary and Binary}
00220   \textcolor{comment}{// Ops.}
00221   \hyperlink{class_eigen_1_1_tensor}{Tensor<bool, 1>} bool3 = vec.cast<\textcolor{keywordtype}{bool}>() && bool2;
00222   bool3 = vec < vec.constant(4) && bool2;
00223 \}
00224 
00225 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_functors()
00226 \{
00227   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} mat1(2,3,7);
00228   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} mat2(2,3,7);
00229   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} mat3(2,3,7);
00230 
00231   \textcolor{keywordtype}{float} val = 1.0f;
00232   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00233     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
00234       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 7; ++k) \{
00235         mat1(i,j,k) = val;
00236         val += 1.0f;
00237       \}
00238     \}
00239   \}
00240   mat2 = mat1.inverse().unaryExpr(&asinf);
00241   mat3 = mat1.unaryExpr(&tanhf);
00242 
00243   val = 1.0f;
00244   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00245     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
00246       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 7; ++k) \{
00247         VERIFY\_IS\_APPROX(mat2(i,j,k), asinf(1.0f / mat1(i,j,k)));
00248         VERIFY\_IS\_APPROX(mat3(i,j,k), tanhf(mat1(i,j,k)));
00249         val += 1.0f;
00250       \}
00251     \}
00252   \}
00253 \}
00254 
00255 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_type\_casting()
00256 \{
00257   \hyperlink{class_eigen_1_1_tensor}{Tensor<bool, 3>} mat1(2,3,7);
00258   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} mat2(2,3,7);
00259   \hyperlink{class_eigen_1_1_tensor}{Tensor<double, 3>} mat3(2,3,7);
00260   mat1.setRandom();
00261   mat2.setRandom();
00262 
00263   mat3 = mat1.cast<\textcolor{keywordtype}{double}>();
00264   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00265     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
00266       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 7; ++k) \{
00267         VERIFY\_IS\_APPROX(mat3(i,j,k), mat1(i,j,k) ? 1.0 : 0.0);
00268       \}
00269     \}
00270   \}
00271 
00272   mat3 = mat2.cast<\textcolor{keywordtype}{double}>();
00273   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00274     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
00275       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 7; ++k) \{
00276         VERIFY\_IS\_APPROX(mat3(i,j,k), static\_cast<double>(mat2(i,j,k)));
00277       \}
00278     \}
00279   \}
00280 \}
00281 
00282 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_select()
00283 \{
00284   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} selector(2,3,7);
00285   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} mat1(2,3,7);
00286   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} mat2(2,3,7);
00287   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} result(2,3,7);
00288 
00289   selector.setRandom();
00290   mat1.setRandom();
00291   mat2.setRandom();
00292   result = (selector > selector.constant(0.5f)).select(mat1, mat2);
00293 
00294   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00295     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
00296       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 7; ++k) \{
00297         VERIFY\_IS\_APPROX(result(i,j,k), (selector(i,j,k) > 0.5f) ? mat1(i,j,k) : mat2(i,j,k));
00298       \}
00299     \}
00300   \}
00301 \}
00302 
00303 
00304 \textcolor{keywordtype}{void} test\_cxx11\_tensor\_expr()
00305 \{
00306   CALL\_SUBTEST(test\_1d());
00307   CALL\_SUBTEST(test\_2d());
00308   CALL\_SUBTEST(test\_3d());
00309   CALL\_SUBTEST(test\_constants());
00310   CALL\_SUBTEST(test\_boolean());
00311   CALL\_SUBTEST(test\_functors());
00312   CALL\_SUBTEST(test\_type\_casting());
00313   CALL\_SUBTEST(test\_select());
00314 \}
\end{DoxyCode}
