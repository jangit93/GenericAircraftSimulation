\hypertarget{matio_2visual__studio_2test_2_mat_file_reader_8cpp_source}{}\section{matio/visual\+\_\+studio/test/\+Mat\+File\+Reader.cpp}
\label{matio_2visual__studio_2test_2_mat_file_reader_8cpp_source}\index{Mat\+File\+Reader.\+cpp@{Mat\+File\+Reader.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include "MatFileReader.h"}
00002 
00003 
00004 MatFileReader::MatFileReader(\textcolor{keyword}{const} \textcolor{keywordtype}{char} * filename)
00005 \{
00006     ing\_index = 0;
00007     err = EXIT\_SUCCESS;
00008     mat = \hyperlink{group___m_a_t_gafbfedb5636a99f0ef867520c47f77d18}{Mat\_Open}(filename, \hyperlink{group___m_a_t_ggaa9dcbc70f538af79bd557593ff6b5cdba8dd1457651b27ba9bea6cfba158c037c}{MAT\_ACC\_RDONLY});
00009 
00010     \textcolor{keywordflow}{if} (NULL == mat) \{
00011         fprintf(stderr, \textcolor{stringliteral}{"Error opening a.mat\(\backslash\)n"});
00012         \textcolor{comment}{//return EXIT\_FAILURE;}
00013     \}
00014 \}
00015 
00016 MatFileReader::~MatFileReader()
00017 \{
00018 \}
00019 
00020 std::tuple<Eigen::MatrixXd, Eigen::VectorXd, double> MatFileReader::readMatFileStructure(\textcolor{keyword}{const} \textcolor{keywordtype}{char} * 
      FieldName, \textcolor{keyword}{const} \textcolor{keywordtype}{char} * MatFileName)
00021 \{
00022     matvar = \hyperlink{group___m_a_t_ga46da2e45ed96d3f1a6ec643757f2b086}{Mat\_VarReadInfo}(mat, MatFileName);
00023     \textcolor{keywordflow}{if} (NULL == matvar) \{
00024         fprintf(stderr, \textcolor{stringliteral}{"Error reading 'AutpilotData' variable information\(\backslash\)n"});
00025         err = EXIT\_FAILURE;
00026     \}
00027 
00028     stru = \hyperlink{group___m_a_t_gaa56680fb7b2cd3d410f659e945da8141}{Mat\_VarGetStructsLinear}(matvar, 0, 0, 9, 0); \textcolor{comment}{// liest gesamte Structure
       ein}
00029     \textcolor{keywordflow}{if} (NULL == stru) \{
00030         fprintf(stderr, \textcolor{stringliteral}{"Error getting 'ing\{%lu\}'\(\backslash\)n"}, ing\_index);
00031         err = EXIT\_FAILURE;
00032     \}
00033     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT} != stru->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type}) \{
00034         fprintf(stderr, \textcolor{stringliteral}{"Variable 'ing\{%lu\}' is not a struct-arrayn\(\backslash\)n"}, ing\_index);
00035         err = EXIT\_FAILURE;
00036     \}
00037     \textcolor{keywordflow}{else} \{
00038         field = \hyperlink{group___m_a_t_ga619d241b49ce97334a38add60562c7be}{Mat\_VarGetStructFieldByName}(stru, FieldName, 0); \textcolor{comment}{// suche nach
       bestimmten Feld}
00039         \textcolor{keywordflow}{if} (NULL == stru) \{
00040             fprintf(stderr, \textcolor{stringliteral}{"Error getting 'ing\{%lu\}.%s'\(\backslash\)n"}, ing\_index, FieldName);
00041             err = EXIT\_FAILURE;
00042         \}
00043         \textcolor{keywordflow}{else} \{
00044             read\_err = \hyperlink{group___m_a_t_gaa8060d7c8e5da0aa9ee5f96e5f1eb30a}{Mat\_VarReadDataAll}(mat, field); \textcolor{comment}{// liest}
00045             \textcolor{keywordflow}{if} (read\_err) \{
00046                 fprintf(stderr, \textcolor{stringliteral}{"Error reading data for 'ing\{%lu\}.%s'\(\backslash\)n"}, ing\_index, FieldName);
00047                 err = EXIT\_FAILURE;
00048             \}
00049             \textcolor{keywordflow}{else} \textcolor{comment}{//Mat\_VarPrint(field, 1);}
00050 
00051                 \textcolor{keywordflow}{if} (\hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE} == field->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type}) \{
00052                     field->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims};
00053                     \textcolor{keywordtype}{unsigned} xSize = field->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} / field->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size};
00054                     \textcolor{keyword}{const} \textcolor{keywordtype}{double} *xData = \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const }\textcolor{keywordtype}{double}*\textcolor{keyword}{>}(field->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data});
00055                     \textcolor{keywordtype}{size\_t} * dim = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}*\textcolor{keyword}{>}(field->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims});
00056                     \textcolor{comment}{//std::cout << dim[0] << "x" << dim[1] << std::endl;}
00057                     \textcolor{keywordflow}{if} (dim[0] > 1 && dim[1] > 1)
00058                     \{
00059                         matrix.resize(dim[0], dim[1]);
00060                         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < dim[0]; ++i) \{
00061                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} ii = 0; ii < dim[1]; ii++) \{
00062                                 matrix(i, ii) = xData[ii*dim[1] + i];
00063                             \}
00064 
00065                         \}
00066                         \textcolor{comment}{//std::cout << matrix << std::endl;}
00067                     \}
00068                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (dim[0] == 1 && dim[1] == 1) \{
00069                         value = xData[0];
00070                     \}
00071                     \textcolor{keywordflow}{else} \{
00072                         vector.resize(std::max(dim[0], dim[1]));
00073                         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < std::max(dim[0], dim[1]); ++i) \{
00074                             vector(i) = xData[i];
00075                         \}
00076                     \}
00077                     \textcolor{keywordflow}{return} std::make\_tuple(matrix, vector, value);
00078                 \}
00079 
00080         \}
00081     \}
00082 \}
00083 
00084 std::tuple<Eigen::MatrixXd, Eigen::VectorXd, double> MatFileReader::readMatFileData(\textcolor{keyword}{const} \textcolor{keywordtype}{char} * FieldName)
00085 \{
00086     matvar = \hyperlink{group___m_a_t_ga3505f63029763eaa73d5a19f1115eb42}{Mat\_VarRead}(mat,FieldName);
00087 
00088     
00089     \textcolor{keywordflow}{if} (\hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE} == matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type}) \{
00090 
00091         \textcolor{keywordtype}{unsigned} xSize = matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} / matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size};
00092         \textcolor{keyword}{const} \textcolor{keywordtype}{double} *xData = \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const }\textcolor{keywordtype}{double}*\textcolor{keyword}{>}(matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data});
00093         \textcolor{keywordtype}{size\_t} * dim = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}*\textcolor{keyword}{>}(matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims});
00094         std::cout << dim[0] << \textcolor{stringliteral}{"x"} << dim[1] << std::endl;
00095         \textcolor{keywordflow}{if} (dim[0] > 1 && dim[1] > 1)
00096         \{
00097             matrix.resize(dim[0], dim[1]);
00098             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < dim[0]; ++i) \{
00099                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} ii = 0; ii < dim[1]; ii++) \{
00100                     matrix(i, ii) = xData[ii*dim[1] + i];
00101                 \}
00102 
00103             \}
00104 
00105         \}
00106         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (dim[0] == 1 && dim[1] == 1) \{
00107             value = xData[0];
00108         \}
00109         \textcolor{keywordflow}{else} \{
00110             vector.resize(std::max(dim[0], dim[1]));
00111             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < std::max(dim[0], dim[1]); ++i) \{
00112                 vector(i) = xData[i];
00113             \}
00114         \}
00115         \textcolor{keywordflow}{return} std::make\_tuple(matrix, vector, value);
00116     \}
00117 \}
\end{DoxyCode}
