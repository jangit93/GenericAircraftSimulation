\hypertarget{matio_2visual__studio_2test_2eigen_2bench_2btl_2actions_2action__matrix__matrix__product_8hh_source}{}\section{matio/visual\+\_\+studio/test/eigen/bench/btl/actions/action\+\_\+matrix\+\_\+matrix\+\_\+product.hh}
\label{matio_2visual__studio_2test_2eigen_2bench_2btl_2actions_2action__matrix__matrix__product_8hh_source}\index{action\+\_\+matrix\+\_\+matrix\+\_\+product.\+hh@{action\+\_\+matrix\+\_\+matrix\+\_\+product.\+hh}}

\begin{DoxyCode}
00001 \textcolor{comment}{//=====================================================}
00002 \textcolor{comment}{// File   :  action\_matrix\_matrix\_product.hh}
00003 \textcolor{comment}{// Author :  L. Plagne <laurent.plagne@edf.fr)>}
00004 \textcolor{comment}{// Copyright (C) EDF R&D,  lun sep 30 14:23:19 CEST 2002}
00005 \textcolor{comment}{//=====================================================}
00006 \textcolor{comment}{//}
00007 \textcolor{comment}{// This program is free software; you can redistribute it and/or}
00008 \textcolor{comment}{// modify it under the terms of the GNU General Public License}
00009 \textcolor{comment}{// as published by the Free Software Foundation; either version 2}
00010 \textcolor{comment}{// of the License, or (at your option) any later version.}
00011 \textcolor{comment}{//}
00012 \textcolor{comment}{// This program is distributed in the hope that it will be useful,}
00013 \textcolor{comment}{// but WITHOUT ANY WARRANTY; without even the implied warranty of}
00014 \textcolor{comment}{// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00015 \textcolor{comment}{// GNU General Public License for more details.}
00016 \textcolor{comment}{// You should have received a copy of the GNU General Public License}
00017 \textcolor{comment}{// along with this program; if not, write to the Free Software}
00018 \textcolor{comment}{// Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.}
00019 \textcolor{comment}{//}
00020 \textcolor{preprocessor}{#ifndef ACTION\_MATRIX\_MATRIX\_PRODUCT}
00021 \textcolor{preprocessor}{#define ACTION\_MATRIX\_MATRIX\_PRODUCT}
00022 \textcolor{preprocessor}{#include "utilities.h"}
00023 \textcolor{preprocessor}{#include "STL\_interface.hh"}
00024 \textcolor{preprocessor}{#include <string>}
00025 \textcolor{preprocessor}{#include "init/init\_function.hh"}
00026 \textcolor{preprocessor}{#include "init/init\_vector.hh"}
00027 \textcolor{preprocessor}{#include "init/init\_matrix.hh"}
00028 
00029 \textcolor{keyword}{using namespace }\hyperlink{namespacestd}{std};
00030 
00031 \textcolor{keyword}{template}<\textcolor{keyword}{class} Interface>
00032 \textcolor{keyword}{class }\hyperlink{class_action__matrix__matrix__product}{Action\_matrix\_matrix\_product} \{
00033 
00034 public :
00035 
00036   \textcolor{comment}{// Ctor}
00037 
00038   \hyperlink{class_action__matrix__matrix__product}{Action\_matrix\_matrix\_product}( \textcolor{keywordtype}{int} size ):\_size(size)
00039   \{
00040     MESSAGE(\textcolor{stringliteral}{"Action\_matrix\_matrix\_product Ctor"});
00041 
00042     \textcolor{comment}{// STL matrix and vector initialization}
00043 
00044     init\_matrix<pseudo\_random>(A\_stl,\_size);
00045     init\_matrix<pseudo\_random>(B\_stl,\_size);
00046     init\_matrix<null\_function>(X\_stl,\_size);
00047     init\_matrix<null\_function>(resu\_stl,\_size);
00048 
00049     \textcolor{comment}{// generic matrix and vector initialization}
00050 
00051     Interface::matrix\_from\_stl(A\_ref,A\_stl);
00052     Interface::matrix\_from\_stl(B\_ref,B\_stl);
00053     Interface::matrix\_from\_stl(X\_ref,X\_stl);
00054 
00055     Interface::matrix\_from\_stl(A,A\_stl);
00056     Interface::matrix\_from\_stl(B,B\_stl);
00057     Interface::matrix\_from\_stl(X,X\_stl);
00058 
00059   \}
00060 
00061   \textcolor{comment}{// invalidate copy ctor}
00062 
00063   \hyperlink{class_action__matrix__matrix__product}{Action\_matrix\_matrix\_product}( \textcolor{keyword}{const}  
      \hyperlink{class_action__matrix__matrix__product}{Action\_matrix\_matrix\_product} & )
00064   \{
00065     INFOS(\textcolor{stringliteral}{"illegal call to Action\_matrix\_matrix\_product Copy Ctor"});
00066     exit(0);
00067   \}
00068 
00069   \textcolor{comment}{// Dtor}
00070 
00071   ~\hyperlink{class_action__matrix__matrix__product}{Action\_matrix\_matrix\_product}( \textcolor{keywordtype}{void} )\{
00072 
00073     MESSAGE(\textcolor{stringliteral}{"Action\_matrix\_matrix\_product Dtor"});
00074 
00075     \textcolor{comment}{// deallocation}
00076 
00077     Interface::free\_matrix(A,\_size);
00078     Interface::free\_matrix(B,\_size);
00079     Interface::free\_matrix(X,\_size);
00080 
00081     Interface::free\_matrix(A\_ref,\_size);
00082     Interface::free\_matrix(B\_ref,\_size);
00083     Interface::free\_matrix(X\_ref,\_size);
00084 
00085   \}
00086 
00087   \textcolor{comment}{// action name}
00088 
00089   \textcolor{keyword}{static} \textcolor{keyword}{inline} std::string name( \textcolor{keywordtype}{void} )
00090   \{
00091     \textcolor{keywordflow}{return} \textcolor{stringliteral}{"matrix\_matrix\_"}+Interface::name();
00092   \}
00093 
00094   \textcolor{keywordtype}{double} nb\_op\_base( \textcolor{keywordtype}{void} )\{
00095     \textcolor{keywordflow}{return} 2.0*\_size*\_size*\_size;
00096   \}
00097 
00098   \textcolor{keyword}{inline} \textcolor{keywordtype}{void} initialize( \textcolor{keywordtype}{void} )\{
00099 
00100     Interface::copy\_matrix(A\_ref,A,\_size);
00101     Interface::copy\_matrix(B\_ref,B,\_size);
00102     Interface::copy\_matrix(X\_ref,X,\_size);
00103 
00104   \}
00105 
00106   \textcolor{keyword}{inline} \textcolor{keywordtype}{void} calculate( \textcolor{keywordtype}{void} ) \{
00107       Interface::matrix\_matrix\_product(A,B,X,\_size);
00108   \}
00109 
00110   \textcolor{keywordtype}{void} check\_result( \textcolor{keywordtype}{void} )\{
00111 
00112     \textcolor{comment}{// calculation check}
00113     \textcolor{keywordflow}{if} (\_size<200)
00114     \{
00115       Interface::matrix\_to\_stl(X,resu\_stl);
00116       \hyperlink{class_s_t_l__interface}{STL\_interface<typename Interface::real\_type>::matrix\_matrix\_product}
      (A\_stl,B\_stl,X\_stl,\_size);
00117       \textcolor{keyword}{typename} Interface::real\_type error=
00118         \hyperlink{class_s_t_l__interface}{STL\_interface<typename Interface::real\_type>::norm\_diff}
      (X\_stl,resu\_stl);
00119       \textcolor{keywordflow}{if} (error>1.e-6)\{
00120         INFOS(\textcolor{stringliteral}{"WRONG CALCULATION...residual="} << error);
00121         exit(1);
00122       \}
00123     \}
00124   \}
00125 
00126 private :
00127 
00128   \textcolor{keyword}{typename} Interface::stl\_matrix A\_stl;
00129   \textcolor{keyword}{typename} Interface::stl\_matrix B\_stl;
00130   \textcolor{keyword}{typename} Interface::stl\_matrix X\_stl;
00131   \textcolor{keyword}{typename} Interface::stl\_matrix resu\_stl;
00132 
00133   \textcolor{keyword}{typename} Interface::gene\_matrix A\_ref;
00134   \textcolor{keyword}{typename} Interface::gene\_matrix B\_ref;
00135   \textcolor{keyword}{typename} Interface::gene\_matrix X\_ref;
00136 
00137   \textcolor{keyword}{typename} Interface::gene\_matrix A;
00138   \textcolor{keyword}{typename} Interface::gene\_matrix B;
00139   \textcolor{keyword}{typename} Interface::gene\_matrix X;
00140 
00141 
00142   \textcolor{keywordtype}{int} \_size;
00143 
00144 \};
00145 
00146 
00147 \textcolor{preprocessor}{#endif}
00148 
00149 
00150 
\end{DoxyCode}
