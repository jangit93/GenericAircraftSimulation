\hypertarget{eigen_2bench_2btl_2data_2smooth_8cxx_source}{}\section{eigen/bench/btl/data/smooth.cxx}
\label{eigen_2bench_2btl_2data_2smooth_8cxx_source}\index{smooth.\+cxx@{smooth.\+cxx}}

\begin{DoxyCode}
00001 \textcolor{comment}{//=====================================================}
00002 \textcolor{comment}{// File   :  smooth.cxx}
00003 \textcolor{comment}{// Author :  L. Plagne <laurent.plagne@edf.fr)>        }
00004 \textcolor{comment}{// Copyright (C) EDF R&D,  lun sep 30 14:23:15 CEST 2002}
00005 \textcolor{comment}{//=====================================================}
00006 \textcolor{comment}{// }
00007 \textcolor{comment}{// This program is free software; you can redistribute it and/or}
00008 \textcolor{comment}{// modify it under the terms of the GNU General Public License}
00009 \textcolor{comment}{// as published by the Free Software Foundation; either version 2}
00010 \textcolor{comment}{// of the License, or (at your option) any later version.}
00011 \textcolor{comment}{// }
00012 \textcolor{comment}{// This program is distributed in the hope that it will be useful,}
00013 \textcolor{comment}{// but WITHOUT ANY WARRANTY; without even the implied warranty of}
00014 \textcolor{comment}{// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00015 \textcolor{comment}{// GNU General Public License for more details.}
00016 \textcolor{comment}{// You should have received a copy of the GNU General Public License}
00017 \textcolor{comment}{// along with this program; if not, write to the Free Software}
00018 \textcolor{comment}{// Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.}
00019 \textcolor{comment}{// }
00020 \textcolor{preprocessor}{#include "utilities.h"}
00021 \textcolor{preprocessor}{#include <vector>}
00022 \textcolor{preprocessor}{#include <deque>}
00023 \textcolor{preprocessor}{#include <string>}
00024 \textcolor{preprocessor}{#include <iostream>}
00025 \textcolor{preprocessor}{#include <fstream>}
00026 \textcolor{preprocessor}{#include "bench\_parameter.hh"}
00027 \textcolor{preprocessor}{#include <set>}
00028 
00029 \textcolor{keyword}{using namespace }\hyperlink{namespacestd}{std};
00030 
00031 \textcolor{keywordtype}{void} read\_xy\_file(\textcolor{keyword}{const} \textcolor{keywordtype}{string} & filename, vector<int> & tab\_sizes, vector<double> & tab\_mflops);
00032 \textcolor{keywordtype}{void} write\_xy\_file(\textcolor{keyword}{const} \textcolor{keywordtype}{string} & filename, vector<int> & tab\_sizes, vector<double> & tab\_mflops);
00033 \textcolor{keywordtype}{void} smooth\_curve(\textcolor{keyword}{const} vector<double> & tab\_mflops, vector<double> & smooth\_tab\_mflops,\textcolor{keywordtype}{int} 
      window\_half\_width);
00034 \textcolor{keywordtype}{void} centered\_smooth\_curve(\textcolor{keyword}{const} vector<double> & tab\_mflops, vector<double> & smooth\_tab\_mflops,\textcolor{keywordtype}{int} 
      window\_half\_width);
00035 
00037 
00038 \textcolor{keywordtype}{int} main( \textcolor{keywordtype}{int} argc , \textcolor{keywordtype}{char} *argv[] )
00039 \{
00040 
00041   \textcolor{comment}{// input data}
00042 
00043   \textcolor{keywordflow}{if} (argc<3)\{
00044     INFOS(\textcolor{stringliteral}{"!!! Error ... usage : main filename window\_half\_width smooth\_filename"});
00045     exit(0);
00046   \}
00047   INFOS(argc);
00048 
00049   \textcolor{keywordtype}{int} window\_half\_width=atoi(argv[2]);
00050 
00051   \textcolor{keywordtype}{string} filename=argv[1];
00052   \textcolor{keywordtype}{string} smooth\_filename=argv[3];
00053   
00054   INFOS(filename);
00055   INFOS(\textcolor{stringliteral}{"window\_half\_width="}<<window\_half\_width);
00056 
00057   vector<int> tab\_sizes;
00058   vector<double> tab\_mflops;
00059 
00060   read\_xy\_file(filename,tab\_sizes,tab\_mflops);
00061 
00062   \textcolor{comment}{// smoothing}
00063 
00064   vector<double> smooth\_tab\_mflops;
00065 
00066   \textcolor{comment}{//smooth\_curve(tab\_mflops,smooth\_tab\_mflops,window\_half\_width);}
00067   centered\_smooth\_curve(tab\_mflops,smooth\_tab\_mflops,window\_half\_width);
00068 
00069   \textcolor{comment}{// output result}
00070 
00071   write\_xy\_file(smooth\_filename,tab\_sizes,smooth\_tab\_mflops);
00072   
00073 
00074 \}
00075 
00077 
00078 \textcolor{keyword}{template}<\textcolor{keyword}{class} VECTOR>
00079 \textcolor{keywordtype}{double} weighted\_mean(\textcolor{keyword}{const} VECTOR & data)
00080 \{
00081 
00082   \textcolor{keywordtype}{double} mean=0.0;
00083   
00084   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0 ; i<data.size() ; i++)\{
00085 
00086     mean+=data[i];
00087 
00088   \}
00089 
00090   \textcolor{keywordflow}{return} mean/double(data.size()) ;
00091 
00092 \}    
00093 
00094 
00095 
00096 
00098 
00099 
00100 \textcolor{keywordtype}{void} smooth\_curve(\textcolor{keyword}{const} vector<double> & tab\_mflops, vector<double> & smooth\_tab\_mflops,\textcolor{keywordtype}{int} 
      window\_half\_width)\{
00101   
00102   \textcolor{keywordtype}{int} window\_width=2*window\_half\_width+1;
00103 
00104   \textcolor{keywordtype}{int} size=tab\_mflops.size();
00105 
00106   vector<double> sample(window\_width);
00107   
00108   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0 ; i < size ; i++)\{
00109     
00110     \textcolor{keywordflow}{for} ( \textcolor{keywordtype}{int} j=0 ; j < window\_width ; j++ )\{
00111       
00112       \textcolor{keywordtype}{int} shifted\_index=i+j-window\_half\_width;
00113       \textcolor{keywordflow}{if} (shifted\_index<0) shifted\_index=0;
00114       \textcolor{keywordflow}{if} (shifted\_index>size-1) shifted\_index=size-1;
00115       sample[j]=tab\_mflops[shifted\_index];
00116       
00117     \}
00118 
00119     smooth\_tab\_mflops.push\_back(weighted\_mean(sample));
00120 
00121   \}
00122 
00123 \}
00124 
00125 \textcolor{keywordtype}{void} centered\_smooth\_curve(\textcolor{keyword}{const} vector<double> & tab\_mflops, vector<double> & smooth\_tab\_mflops,\textcolor{keywordtype}{int} 
      window\_half\_width)\{
00126   
00127   \textcolor{keywordtype}{int} max\_window\_width=2*window\_half\_width+1;
00128 
00129   \textcolor{keywordtype}{int} size=tab\_mflops.size();
00130 
00131   
00132   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0 ; i < size ; i++)\{
00133 
00134     deque<double> sample;
00135 
00136     
00137     sample.push\_back(tab\_mflops[i]);
00138 
00139     \textcolor{keywordflow}{for} ( \textcolor{keywordtype}{int} j=1 ; j <= window\_half\_width ; j++ )\{
00140       
00141       \textcolor{keywordtype}{int} before=i-j;
00142       \textcolor{keywordtype}{int} after=i+j;
00143       
00144       \textcolor{keywordflow}{if} ((before>=0)&&(after<size)) \textcolor{comment}{// inside of the vector}
00145     \{ 
00146       sample.push\_front(tab\_mflops[before]);
00147       sample.push\_back(tab\_mflops[after]);
00148     \}
00149     \}
00150     
00151     smooth\_tab\_mflops.push\_back(weighted\_mean(sample));
00152     
00153   \}
00154 
00155 \}
00156 
00157 
00159 
00160 \textcolor{keywordtype}{void} write\_xy\_file(\textcolor{keyword}{const} \textcolor{keywordtype}{string} & filename, vector<int> & tab\_sizes, vector<double> & tab\_mflops)\{
00161 
00162   ofstream output\_file (filename.c\_str(),ios::out) ;
00163   
00164   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0 ; i < tab\_sizes.size() ; i++)
00165     \{
00166       output\_file << tab\_sizes[i] << \textcolor{stringliteral}{" "} <<  tab\_mflops[i] << endl ;
00167     \}
00168   
00169   output\_file.close();
00170 
00171 \}
00172 
00173 
00175 
00176 \textcolor{keywordtype}{void} read\_xy\_file(\textcolor{keyword}{const} \textcolor{keywordtype}{string} & filename, vector<int> & tab\_sizes, vector<double> & tab\_mflops)\{
00177 
00178   ifstream input\_file (filename.c\_str(),ios::in) ;
00179 
00180   \textcolor{keywordflow}{if} (!input\_file)\{
00181     INFOS(\textcolor{stringliteral}{"!!! Error opening "}<<filename);
00182     exit(0);
00183   \}
00184   
00185   \textcolor{keywordtype}{int} nb\_point=0;
00186   \textcolor{keywordtype}{int} size=0;
00187   \textcolor{keywordtype}{double} mflops=0;
00188 
00189   \textcolor{keywordflow}{while} (input\_file >> size >> mflops )\{
00190     nb\_point++;
00191     tab\_sizes.push\_back(size);
00192     tab\_mflops.push\_back(mflops);
00193   \}
00194   SCRUTE(nb\_point);
00195 
00196   input\_file.close();
00197 \}
00198 
\end{DoxyCode}
