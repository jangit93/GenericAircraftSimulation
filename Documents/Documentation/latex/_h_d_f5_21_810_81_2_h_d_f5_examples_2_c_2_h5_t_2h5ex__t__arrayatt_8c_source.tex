\hypertarget{_h_d_f5_21_810_81_2_h_d_f5_examples_2_c_2_h5_t_2h5ex__t__arrayatt_8c_source}{}\section{H\+D\+F5/1.10.1/\+H\+D\+F5\+Examples/\+C/\+H5\+T/h5ex\+\_\+t\+\_\+arrayatt.c}
\label{_h_d_f5_21_810_81_2_h_d_f5_examples_2_c_2_h5_t_2h5ex__t__arrayatt_8c_source}\index{h5ex\+\_\+t\+\_\+arrayatt.\+c@{h5ex\+\_\+t\+\_\+arrayatt.\+c}}

\begin{DoxyCode}
00001 \textcolor{comment}{/************************************************************}
00002 \textcolor{comment}{}
00003 \textcolor{comment}{  This example shows how to read and write array datatypes}
00004 \textcolor{comment}{  to an attribute.  The program first writes integers arrays}
00005 \textcolor{comment}{  of dimension ADIM0xADIM1 to an attribute with a dataspace}
00006 \textcolor{comment}{  of DIM0, then closes the  file.  Next, it reopens the}
00007 \textcolor{comment}{  file, reads back the data, and outputs it to the screen.}
00008 \textcolor{comment}{}
00009 \textcolor{comment}{  This file is intended for use with HDF5 Library version 1.8}
00010 \textcolor{comment}{}
00011 \textcolor{comment}{ ************************************************************/}
00012 
00013 \textcolor{preprocessor}{#include "hdf5.h"}
00014 \textcolor{preprocessor}{#include <stdio.h>}
00015 \textcolor{preprocessor}{#include <stdlib.h>}
00016 
00017 \textcolor{preprocessor}{#define FILE            "h5ex\_t\_arrayatt.h5"}
00018 \textcolor{preprocessor}{#define DATASET         "DS1"}
00019 \textcolor{preprocessor}{#define ATTRIBUTE       "A1"}
00020 \textcolor{preprocessor}{#define DIM0            4}
00021 \textcolor{preprocessor}{#define ADIM0           3}
00022 \textcolor{preprocessor}{#define ADIM1           5}
00023 
00024 \textcolor{keywordtype}{int}
00025 main (\textcolor{keywordtype}{void})
00026 \{
00027     hid\_t       \hyperlink{structfile}{file}, filetype, memtype, space, dset, attr;
00028                                                 \textcolor{comment}{/* Handles */}
00029     herr\_t      status;
00030     hsize\_t     dims[1] = \{DIM0\},
00031                 adims[2] = \{ADIM0, ADIM1\};
00032     \textcolor{keywordtype}{int}         wdata[DIM0][ADIM0][ADIM1],      \textcolor{comment}{/* Write buffer */}
00033                 ***rdata,                       \textcolor{comment}{/* Read buffer */}
00034                 ndims,
00035                 i, j, k;
00036 
00037     \textcolor{comment}{/*}
00038 \textcolor{comment}{     * Initialize data.  i is the element in the dataspace, j and k the}
00039 \textcolor{comment}{     * elements within the array datatype.}
00040 \textcolor{comment}{     */}
00041     \textcolor{keywordflow}{for} (i=0; i<DIM0; i++)
00042         \textcolor{keywordflow}{for} (j=0; j<ADIM0; j++)
00043             \textcolor{keywordflow}{for} (k=0; k<ADIM1; k++)
00044                 wdata[i][j][k] = i * j - j * k + i * k;
00045 
00046     \textcolor{comment}{/*}
00047 \textcolor{comment}{     * Create a new file using the default properties.}
00048 \textcolor{comment}{     */}
00049     file = H5Fcreate (FILE, H5F\_ACC\_TRUNC, H5P\_DEFAULT, H5P\_DEFAULT);
00050 
00051     \textcolor{comment}{/*}
00052 \textcolor{comment}{     * Create array datatypes for file and memory.}
00053 \textcolor{comment}{     */}
00054     filetype = H5Tarray\_create (H5T\_STD\_I64LE, 2, adims);
00055     memtype = H5Tarray\_create (H5T\_NATIVE\_INT, 2, adims);
00056 
00057     \textcolor{comment}{/*}
00058 \textcolor{comment}{     * Create dataset with a null dataspace.}
00059 \textcolor{comment}{     */}
00060     space = H5Screate (H5S\_NULL);
00061     dset = H5Dcreate (file, DATASET, H5T\_STD\_I32LE, space, H5P\_DEFAULT,
00062                 H5P\_DEFAULT, H5P\_DEFAULT);
00063     status = H5Sclose (space);
00064 
00065     \textcolor{comment}{/*}
00066 \textcolor{comment}{     * Create dataspace.  Setting maximum size to NULL sets the maximum}
00067 \textcolor{comment}{     * size to be the current size.}
00068 \textcolor{comment}{     */}
00069     space = H5Screate\_simple (1, dims, NULL);
00070 
00071     \textcolor{comment}{/*}
00072 \textcolor{comment}{     * Create the attribute and write the array data to it.}
00073 \textcolor{comment}{     */}
00074     attr = H5Acreate (dset, ATTRIBUTE, filetype, space, H5P\_DEFAULT,
00075                 H5P\_DEFAULT);
00076     status = H5Awrite (attr, memtype, wdata[0][0]);
00077 
00078     \textcolor{comment}{/*}
00079 \textcolor{comment}{     * Close and release resources.}
00080 \textcolor{comment}{     */}
00081     status = H5Aclose (attr);
00082     status = H5Dclose (dset);
00083     status = H5Sclose (space);
00084     status = H5Tclose (filetype);
00085     status = H5Tclose (memtype);
00086     status = H5Fclose (file);
00087 
00088 
00089     \textcolor{comment}{/*}
00090 \textcolor{comment}{     * Now we begin the read section of this example.  Here we assume}
00091 \textcolor{comment}{     * the attribute and array have the same name and rank, but can}
00092 \textcolor{comment}{     * have any size.  Therefore we must allocate a new array to read}
00093 \textcolor{comment}{     * in data using malloc().}
00094 \textcolor{comment}{     */}
00095 
00096     \textcolor{comment}{/*}
00097 \textcolor{comment}{     * Open file, dataset, and attribute.}
00098 \textcolor{comment}{     */}
00099     file = H5Fopen (FILE, H5F\_ACC\_RDONLY, H5P\_DEFAULT);
00100     dset = H5Dopen (file, DATASET, H5P\_DEFAULT);
00101     attr = H5Aopen (dset, ATTRIBUTE, H5P\_DEFAULT);
00102 
00103     \textcolor{comment}{/*}
00104 \textcolor{comment}{     * Get the datatype and its dimensions.}
00105 \textcolor{comment}{     */}
00106     filetype = H5Aget\_type (attr);
00107     ndims = H5Tget\_array\_dims (filetype, adims);
00108 
00109     \textcolor{comment}{/*}
00110 \textcolor{comment}{     * Get dataspace and allocate memory for read buffer.  This is a}
00111 \textcolor{comment}{     * three dimensional attribute when the array datatype is included}
00112 \textcolor{comment}{     * so the dynamic allocation must be done in steps.}
00113 \textcolor{comment}{     */}
00114     space = H5Aget\_space (attr);
00115     ndims = H5Sget\_simple\_extent\_dims (space, dims, NULL);
00116 
00117     \textcolor{comment}{/*}
00118 \textcolor{comment}{     * Allocate array of pointers to two-dimensional arrays (the}
00119 \textcolor{comment}{     * elements of the attribute.}
00120 \textcolor{comment}{     */}
00121     rdata = (\textcolor{keywordtype}{int} ***) malloc (dims[0] * \textcolor{keyword}{sizeof} (\textcolor{keywordtype}{int} **));
00122 
00123     \textcolor{comment}{/*}
00124 \textcolor{comment}{     * Allocate two dimensional array of pointers to rows in the data}
00125 \textcolor{comment}{     * elements.}
00126 \textcolor{comment}{     */}
00127     rdata[0] = (\textcolor{keywordtype}{int} **) malloc (dims[0] * adims[0] * \textcolor{keyword}{sizeof} (\textcolor{keywordtype}{int} *));
00128 
00129     \textcolor{comment}{/*}
00130 \textcolor{comment}{     * Allocate space for integer data.}
00131 \textcolor{comment}{     */}
00132     rdata[0][0] = (\textcolor{keywordtype}{int} *) malloc (dims[0] * adims[0] * adims[1] * \textcolor{keyword}{sizeof} (\textcolor{keywordtype}{int}));
00133 
00134     \textcolor{comment}{/*}
00135 \textcolor{comment}{     * Set the members of the pointer arrays allocated above to point}
00136 \textcolor{comment}{     * to the correct locations in their respective arrays.}
00137 \textcolor{comment}{     */}
00138     \textcolor{keywordflow}{for} (i=0; i<dims[0]; i++) \{
00139         rdata[i] = rdata[0] + i * adims[0];
00140         \textcolor{keywordflow}{for} (j=0; j<adims[0]; j++)
00141             rdata[i][j] = rdata[0][0] + (adims[0] * adims[1] * i) +
00142                         (adims[1] * j);
00143     \}
00144 
00145     \textcolor{comment}{/*}
00146 \textcolor{comment}{     * Create the memory datatype.}
00147 \textcolor{comment}{     */}
00148     memtype = H5Tarray\_create (H5T\_NATIVE\_INT, 2, adims);
00149 
00150     \textcolor{comment}{/*}
00151 \textcolor{comment}{     * Read the data.}
00152 \textcolor{comment}{     */}
00153     status = H5Aread (attr, memtype, rdata[0][0]);
00154 
00155     \textcolor{comment}{/*}
00156 \textcolor{comment}{     * Output the data to the screen.}
00157 \textcolor{comment}{     */}
00158     \textcolor{keywordflow}{for} (i=0; i<dims[0]; i++) \{
00159         printf (\textcolor{stringliteral}{"%s[%d]:\(\backslash\)n"}, ATTRIBUTE, i);
00160         \textcolor{keywordflow}{for} (j=0; j<adims[0]; j++) \{
00161             printf (\textcolor{stringliteral}{" ["});
00162             \textcolor{keywordflow}{for} (k=0; k<adims[1]; k++)
00163                 printf (\textcolor{stringliteral}{" %3d"}, rdata[i][j][k]);
00164             printf (\textcolor{stringliteral}{"]\(\backslash\)n"});
00165         \}
00166         printf(\textcolor{stringliteral}{"\(\backslash\)n"});
00167     \}
00168 
00169     \textcolor{comment}{/*}
00170 \textcolor{comment}{     * Close and release resources.}
00171 \textcolor{comment}{     */}
00172     free (rdata[0][0]);
00173     free (rdata[0]);
00174     free (rdata);
00175     status = H5Aclose (attr);
00176     status = H5Dclose (dset);
00177     status = H5Sclose (space);
00178     status = H5Tclose (filetype);
00179     status = H5Tclose (memtype);
00180     status = H5Fclose (file);
00181 
00182     \textcolor{keywordflow}{return} 0;
00183 \}
\end{DoxyCode}
