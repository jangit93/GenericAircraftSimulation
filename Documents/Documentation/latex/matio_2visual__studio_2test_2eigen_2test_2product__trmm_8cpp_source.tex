\hypertarget{matio_2visual__studio_2test_2eigen_2test_2product__trmm_8cpp_source}{}\section{matio/visual\+\_\+studio/test/eigen/test/product\+\_\+trmm.cpp}
\label{matio_2visual__studio_2test_2eigen_2test_2product__trmm_8cpp_source}\index{product\+\_\+trmm.\+cpp@{product\+\_\+trmm.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2008-2009 Gael Guennebaud <gael.guennebaud@inria.fr>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#include "main.h"}
00011 
00012 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>
00013 \textcolor{keywordtype}{int} get\_random\_size()
00014 \{
00015   \textcolor{keyword}{const} \textcolor{keywordtype}{int} factor = \hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<T>::ReadCost};
00016   \textcolor{keyword}{const} \textcolor{keywordtype}{int} max\_test\_size = EIGEN\_TEST\_MAX\_SIZE>2*factor ? EIGEN\_TEST\_MAX\_SIZE/factor : EIGEN\_TEST\_MAX\_SIZE
      ;
00017   \textcolor{keywordflow}{return} internal::random<int>(1,max\_test\_size);
00018 \}
00019 
00020 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Scalar, \textcolor{keywordtype}{int} Mode, \textcolor{keywordtype}{int} TriOrder, \textcolor{keywordtype}{int} OtherOrder, \textcolor{keywordtype}{int} ResOrder, \textcolor{keywordtype}{int} OtherCols>
00021 \textcolor{keywordtype}{void} trmm(\textcolor{keywordtype}{int} rows=get\_random\_size<Scalar>(),
00022           \textcolor{keywordtype}{int} cols=get\_random\_size<Scalar>(),
00023           \textcolor{keywordtype}{int} otherCols = OtherCols==Dynamic?get\_random\_size<Scalar>():OtherCols)
00024 \{
00025   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,Dynamic,Dynamic,TriOrder>} TriMatrix;
00026   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,Dynamic,OtherCols,OtherCols==1?ColMajor:OtherOrder>}
       \hyperlink{group__enums_ggac22de43beeac7a78b384f99bed5cee0ba99dc75d8e00b6c3a5bdc31940f47492b}{OnTheRight};
00027   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,OtherCols,Dynamic,OtherCols==1?RowMajor:OtherOrder>}
       \hyperlink{group__enums_ggac22de43beeac7a78b384f99bed5cee0ba129609b3bdf23b071f5f86cf2f995ec4}{OnTheLeft};
00028   
00029   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,Dynamic,OtherCols,OtherCols==1?ColMajor:ResOrder>}
       ResXS;
00030   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,OtherCols,Dynamic,OtherCols==1?RowMajor:ResOrder>}
       ResSX;
00031 
00032   TriMatrix  mat(rows,cols), tri(rows,cols), triTr(cols,rows);
00033   
00034   OnTheRight  ge\_right(cols,otherCols);
00035   OnTheLeft   ge\_left(otherCols,rows);
00036   ResSX       ge\_sx, ge\_sx\_save;
00037   ResXS       ge\_xs, ge\_xs\_save;
00038 
00039   Scalar s1 = internal::random<Scalar>(),
00040          s2 = internal::random<Scalar>();
00041 
00042   mat.setRandom();
00043   tri = mat.template triangularView<Mode>();
00044   triTr = mat.transpose().template triangularView<Mode>();
00045   ge\_right.setRandom();
00046   ge\_left.setRandom();
00047 
00048   VERIFY\_IS\_APPROX( ge\_xs = mat.template triangularView<Mode>() * ge\_right, tri * ge\_right);
00049   VERIFY\_IS\_APPROX( ge\_sx = ge\_left * mat.template triangularView<Mode>(), ge\_left * tri);
00050   
00051   VERIFY\_IS\_APPROX( ge\_xs.noalias() = mat.template triangularView<Mode>() * ge\_right, tri * ge\_right);
00052   VERIFY\_IS\_APPROX( ge\_sx.noalias() = ge\_left * mat.template triangularView<Mode>(), ge\_left * tri);
00053 
00054   VERIFY\_IS\_APPROX( ge\_xs.noalias() = (s1*mat.adjoint()).\textcolor{keyword}{template} triangularView<Mode>() * (s2*ge\_left.
      transpose()), s1*triTr.conjugate() * (s2*ge\_left.transpose()));
00055   VERIFY\_IS\_APPROX( ge\_sx.noalias() = ge\_right.transpose() * mat.adjoint().template triangularView<Mode>(),
       ge\_right.transpose() * triTr.conjugate());
00056   
00057   VERIFY\_IS\_APPROX( ge\_xs.noalias() = (s1*mat.adjoint()).\textcolor{keyword}{template} triangularView<Mode>() * (s2*ge\_left.
      adjoint()), s1*triTr.conjugate() * (s2*ge\_left.adjoint()));
00058   VERIFY\_IS\_APPROX( ge\_sx.noalias() = ge\_right.adjoint() * mat.adjoint().template triangularView<Mode>(), 
      ge\_right.adjoint() * triTr.conjugate());
00059 
00060   ge\_xs\_save = ge\_xs;
00061   VERIFY\_IS\_APPROX( (ge\_xs\_save + s1*triTr.conjugate() * (s2*ge\_left.adjoint())).eval(), ge\_xs.noalias() +=
       (s1*mat.adjoint()).\textcolor{keyword}{template} triangularView<Mode>() * (s2*ge\_left.adjoint()) );
00062   ge\_sx.setRandom();
00063   ge\_sx\_save = ge\_sx;
00064   VERIFY\_IS\_APPROX( ge\_sx\_save - (ge\_right.adjoint() * (-s1 * triTr).conjugate()).eval(), ge\_sx.noalias() -
      = (ge\_right.adjoint() * (-s1 * mat).adjoint().template triangularView<Mode>()).eval());
00065   
00066   VERIFY\_IS\_APPROX( ge\_xs = (s1*mat).adjoint().\textcolor{keyword}{template} triangularView<Mode>() * ge\_left.adjoint(), 
      numext::conj(s1) * triTr.conjugate() * ge\_left.adjoint());
00067   
00068   \textcolor{comment}{// TODO check with sub-matrix expressions ?}
00069 \}
00070 
00071 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Scalar, \textcolor{keywordtype}{int} Mode, \textcolor{keywordtype}{int} TriOrder>
00072 \textcolor{keywordtype}{void} trmv(\textcolor{keywordtype}{int} rows=get\_random\_size<Scalar>(), \textcolor{keywordtype}{int} cols=get\_random\_size<Scalar>())
00073 \{
00074   trmm<Scalar,Mode,TriOrder,ColMajor,ColMajor,1>(rows,cols,1);
00075 \}
00076 
00077 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Scalar, \textcolor{keywordtype}{int} Mode, \textcolor{keywordtype}{int} TriOrder, \textcolor{keywordtype}{int} OtherOrder, \textcolor{keywordtype}{int} ResOrder>
00078 \textcolor{keywordtype}{void} trmm(\textcolor{keywordtype}{int} rows=get\_random\_size<Scalar>(), \textcolor{keywordtype}{int} cols=get\_random\_size<Scalar>(), \textcolor{keywordtype}{int} otherCols = 
      get\_random\_size<Scalar>())
00079 \{
00080   trmm<Scalar,Mode,TriOrder,OtherOrder,ResOrder,Dynamic>(rows,cols,otherCols);
00081 \}
00082 
00083 \textcolor{preprocessor}{#define CALL\_ALL\_ORDERS(NB,SCALAR,MODE)                                             \(\backslash\)}
00084 \textcolor{preprocessor}{  EIGEN\_CAT(CALL\_SUBTEST\_,NB)((trmm<SCALAR, MODE, ColMajor,ColMajor,ColMajor>()));  \(\backslash\)}
00085 \textcolor{preprocessor}{  EIGEN\_CAT(CALL\_SUBTEST\_,NB)((trmm<SCALAR, MODE, ColMajor,ColMajor,RowMajor>()));  \(\backslash\)}
00086 \textcolor{preprocessor}{  EIGEN\_CAT(CALL\_SUBTEST\_,NB)((trmm<SCALAR, MODE, ColMajor,RowMajor,ColMajor>()));  \(\backslash\)}
00087 \textcolor{preprocessor}{  EIGEN\_CAT(CALL\_SUBTEST\_,NB)((trmm<SCALAR, MODE, ColMajor,RowMajor,RowMajor>()));  \(\backslash\)}
00088 \textcolor{preprocessor}{  EIGEN\_CAT(CALL\_SUBTEST\_,NB)((trmm<SCALAR, MODE, RowMajor,ColMajor,ColMajor>()));  \(\backslash\)}
00089 \textcolor{preprocessor}{  EIGEN\_CAT(CALL\_SUBTEST\_,NB)((trmm<SCALAR, MODE, RowMajor,ColMajor,RowMajor>()));  \(\backslash\)}
00090 \textcolor{preprocessor}{  EIGEN\_CAT(CALL\_SUBTEST\_,NB)((trmm<SCALAR, MODE, RowMajor,RowMajor,ColMajor>()));  \(\backslash\)}
00091 \textcolor{preprocessor}{  EIGEN\_CAT(CALL\_SUBTEST\_,NB)((trmm<SCALAR, MODE, RowMajor,RowMajor,RowMajor>()));  \(\backslash\)}
00092 \textcolor{preprocessor}{  \(\backslash\)}
00093 \textcolor{preprocessor}{  EIGEN\_CAT(CALL\_SUBTEST\_1,NB)((trmv<SCALAR, MODE, ColMajor>()));                   \(\backslash\)}
00094 \textcolor{preprocessor}{  EIGEN\_CAT(CALL\_SUBTEST\_1,NB)((trmv<SCALAR, MODE, RowMajor>()));}
00095 
00096   
00097 \textcolor{preprocessor}{#define CALL\_ALL(NB,SCALAR)                 \(\backslash\)}
00098 \textcolor{preprocessor}{  CALL\_ALL\_ORDERS(EIGEN\_CAT(1,NB),SCALAR,Upper)          \(\backslash\)}
00099 \textcolor{preprocessor}{  CALL\_ALL\_ORDERS(EIGEN\_CAT(2,NB),SCALAR,UnitUpper)      \(\backslash\)}
00100 \textcolor{preprocessor}{  CALL\_ALL\_ORDERS(EIGEN\_CAT(3,NB),SCALAR,StrictlyUpper)  \(\backslash\)}
00101 \textcolor{preprocessor}{  CALL\_ALL\_ORDERS(EIGEN\_CAT(1,NB),SCALAR,Lower)          \(\backslash\)}
00102 \textcolor{preprocessor}{  CALL\_ALL\_ORDERS(EIGEN\_CAT(2,NB),SCALAR,UnitLower)      \(\backslash\)}
00103 \textcolor{preprocessor}{  CALL\_ALL\_ORDERS(EIGEN\_CAT(3,NB),SCALAR,StrictlyLower)}
00104   
00105 
00106 \textcolor{keywordtype}{void} test\_product\_trmm()
00107 \{
00108   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 0; i < g\_repeat ; i++)
00109   \{
00110     CALL\_ALL(1,\textcolor{keywordtype}{float});                \textcolor{comment}{//  EIGEN\_SUFFIXES;11;111;21;121;31;131}
00111     CALL\_ALL(2,\textcolor{keywordtype}{double});               \textcolor{comment}{//  EIGEN\_SUFFIXES;12;112;22;122;32;132}
00112     CALL\_ALL(3,std::complex<float>);  \textcolor{comment}{//  EIGEN\_SUFFIXES;13;113;23;123;33;133}
00113     CALL\_ALL(4,std::complex<double>); \textcolor{comment}{//  EIGEN\_SUFFIXES;14;114;24;124;34;134}
00114   \}
00115 \}
\end{DoxyCode}
