\hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_s_v_d_2_s_v_d_base_8h_source}{}\section{matio/visual\+\_\+studio/test/eigen/\+Eigen/src/\+S\+V\+D/\+S\+V\+D\+Base.h}
\label{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_s_v_d_2_s_v_d_base_8h_source}\index{S\+V\+D\+Base.\+h@{S\+V\+D\+Base.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2009-2010 Benoit Jacob <jacob.benoit.1@gmail.com>}
00005 \textcolor{comment}{// Copyright (C) 2014 Gael Guennebaud <gael.guennebaud@inria.fr>}
00006 \textcolor{comment}{//}
00007 \textcolor{comment}{// Copyright (C) 2013 Gauthier Brun <brun.gauthier@gmail.com>}
00008 \textcolor{comment}{// Copyright (C) 2013 Nicolas Carre <nicolas.carre@ensimag.fr>}
00009 \textcolor{comment}{// Copyright (C) 2013 Jean Ceccato <jean.ceccato@ensimag.fr>}
00010 \textcolor{comment}{// Copyright (C) 2013 Pierre Zoppitelli <pierre.zoppitelli@ensimag.fr>}
00011 \textcolor{comment}{//}
00012 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00013 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00014 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00015 
00016 \textcolor{preprocessor}{#ifndef EIGEN\_SVDBASE\_H}
00017 \textcolor{preprocessor}{#define EIGEN\_SVDBASE\_H}
00018 
00019 \textcolor{keyword}{namespace }\hyperlink{namespace_eigen}{Eigen} \{
00047 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Derived>
00048 \textcolor{keyword}{class }SVDBase
00049 \{
00050 
00051 \textcolor{keyword}{public}:
00052   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} internal::traits<Derived>::MatrixType MatrixType;
00053   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::Scalar Scalar;
00054   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} NumTraits<typename MatrixType::Scalar>::Real RealScalar;
00055   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::StorageIndex StorageIndex;
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_s_v_d_2_s_v_d_base_8h_source_l00056}\hyperlink{group___s_v_d___module_a6229a37997eca1072b52cca5ee7a2bec}{00056}   \textcolor{keyword}{typedef} \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index} \hyperlink{group___s_v_d___module_a6229a37997eca1072b52cca5ee7a2bec}{Index}; 
00057   \textcolor{keyword}{enum} \{
00058     RowsAtCompileTime = MatrixType::RowsAtCompileTime,
00059     ColsAtCompileTime = MatrixType::ColsAtCompileTime,
00060     DiagSizeAtCompileTime = EIGEN\_SIZE\_MIN\_PREFER\_DYNAMIC(RowsAtCompileTime,ColsAtCompileTime),
00061     MaxRowsAtCompileTime = MatrixType::MaxRowsAtCompileTime,
00062     MaxColsAtCompileTime = MatrixType::MaxColsAtCompileTime,
00063     MaxDiagSizeAtCompileTime = EIGEN\_SIZE\_MIN\_PREFER\_FIXED(MaxRowsAtCompileTime,MaxColsAtCompileTime),
00064     MatrixOptions = MatrixType::Options
00065   \};
00066 
00067   \textcolor{keyword}{typedef} 
      \hyperlink{group___core___module}{Matrix<Scalar, RowsAtCompileTime, RowsAtCompileTime, MatrixOptions, MaxRowsAtCompileTime,
       MaxRowsAtCompileTime>}
       \hyperlink{group___core___module}{MatrixUType};
00068   \textcolor{keyword}{typedef} 
      \hyperlink{group___core___module}{Matrix<Scalar, ColsAtCompileTime, ColsAtCompileTime, MatrixOptions, MaxColsAtCompileTime,
       MaxColsAtCompileTime>}
       \hyperlink{group___core___module}{MatrixVType};
00069   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{class_eigen_1_1internal_1_1_tensor_lazy_evaluator_writable}{internal::plain\_diag\_type<MatrixType, RealScalar>::type}
       \hyperlink{class_eigen_1_1internal_1_1_tensor_lazy_evaluator_writable}{SingularValuesType};
00070   
00071   Derived& derived() \{ \textcolor{keywordflow}{return} *\textcolor{keyword}{static\_cast<}Derived*\textcolor{keyword}{>}(\textcolor{keyword}{this}); \}
00072   \textcolor{keyword}{const} Derived& derived()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} *\textcolor{keyword}{static\_cast<}\textcolor{keyword}{const }Derived*\textcolor{keyword}{>}(\textcolor{keyword}{this}); \}
00073 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_s_v_d_2_s_v_d_base_8h_source_l00083}\hyperlink{group___s_v_d___module_afc7fe1546b0f6e1801b86f22f5664cb8}{00083}   \textcolor{keyword}{const} MatrixUType& \hyperlink{group___s_v_d___module_afc7fe1546b0f6e1801b86f22f5664cb8}{matrixU}()\textcolor{keyword}{ const}
00084 \textcolor{keyword}{  }\{
00085     eigen\_assert(m\_isInitialized && \textcolor{stringliteral}{"SVD is not initialized."});
00086     eigen\_assert(\hyperlink{group___s_v_d___module_a705a7c2709e1624ccc19aa748a78d473}{computeU}() && \textcolor{stringliteral}{"This SVD decomposition didn't compute U. Did you ask for it?"});
00087     \textcolor{keywordflow}{return} m\_matrixU;
00088   \}
00089 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_s_v_d_2_s_v_d_base_8h_source_l00099}\hyperlink{group___s_v_d___module_a245a453b5e7347f737295c23133238c4}{00099}   \textcolor{keyword}{const} MatrixVType& \hyperlink{group___s_v_d___module_a245a453b5e7347f737295c23133238c4}{matrixV}()\textcolor{keyword}{ const}
00100 \textcolor{keyword}{  }\{
00101     eigen\_assert(m\_isInitialized && \textcolor{stringliteral}{"SVD is not initialized."});
00102     eigen\_assert(\hyperlink{group___s_v_d___module_a5f12efcb791eb007d4a4890ac5255ac4}{computeV}() && \textcolor{stringliteral}{"This SVD decomposition didn't compute V. Did you ask for it?"});
00103     \textcolor{keywordflow}{return} m\_matrixV;
00104   \}
00105 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_s_v_d_2_s_v_d_base_8h_source_l00111}\hyperlink{group___s_v_d___module_a4e7bac123570c348f7ed6be909e1e474}{00111}   \textcolor{keyword}{const} SingularValuesType& \hyperlink{group___s_v_d___module_a4e7bac123570c348f7ed6be909e1e474}{singularValues}()\textcolor{keyword}{ const}
00112 \textcolor{keyword}{  }\{
00113     eigen\_assert(m\_isInitialized && \textcolor{stringliteral}{"SVD is not initialized."});
00114     \textcolor{keywordflow}{return} m\_singularValues;
00115   \}
00116 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_s_v_d_2_s_v_d_base_8h_source_l00118}\hyperlink{group___s_v_d___module_afe8a555f38393a319a71ec0f0331c9ef}{00118}   Index \hyperlink{group___s_v_d___module_afe8a555f38393a319a71ec0f0331c9ef}{nonzeroSingularValues}()\textcolor{keyword}{ const}
00119 \textcolor{keyword}{  }\{
00120     eigen\_assert(m\_isInitialized && \textcolor{stringliteral}{"SVD is not initialized."});
00121     \textcolor{keywordflow}{return} m\_nonzeroSingularValues;
00122   \}
00123   
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_s_v_d_2_s_v_d_base_8h_source_l00130}\hyperlink{group___s_v_d___module_a30b89e24f42f1692079eea31b361d26a}{00130}   \textcolor{keyword}{inline} Index \hyperlink{group___s_v_d___module_a30b89e24f42f1692079eea31b361d26a}{rank}()\textcolor{keyword}{ const}
00131 \textcolor{keyword}{  }\{
00132     \textcolor{keyword}{using} std::abs;
00133     eigen\_assert(m\_isInitialized && \textcolor{stringliteral}{"JacobiSVD is not initialized."});
00134     \textcolor{keywordflow}{if}(m\_singularValues.size()==0) \textcolor{keywordflow}{return} 0;
00135     RealScalar premultiplied\_threshold = numext::maxi<RealScalar>(m\_singularValues.coeff(0) * 
      \hyperlink{group___s_v_d___module_a98b2ee98690358951807353812a05c69}{threshold}(), (std::numeric\_limits<RealScalar>::min)());
00136     Index i = m\_nonzeroSingularValues-1;
00137     \textcolor{keywordflow}{while}(i>=0 && m\_singularValues.coeff(i) < premultiplied\_threshold) --i;
00138     \textcolor{keywordflow}{return} i+1;
00139   \}
00140   
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_s_v_d_2_s_v_d_base_8h_source_l00155}\hyperlink{group___s_v_d___module_a1c95d05398fc15e410a28560ef70a5a6}{00155}   Derived& \hyperlink{group___s_v_d___module_a1c95d05398fc15e410a28560ef70a5a6}{setThreshold}(\textcolor{keyword}{const} RealScalar& \hyperlink{group___s_v_d___module_a98b2ee98690358951807353812a05c69}{threshold})
00156   \{
00157     m\_usePrescribedThreshold = \textcolor{keyword}{true};
00158     m\_prescribedThreshold = \hyperlink{group___s_v_d___module_a98b2ee98690358951807353812a05c69}{threshold};
00159     \textcolor{keywordflow}{return} derived();
00160   \}
00161 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_s_v_d_2_s_v_d_base_8h_source_l00170}\hyperlink{group___s_v_d___module_a27586b69dbfb63f714d1d45fd6304f97}{00170}   Derived& \hyperlink{group___s_v_d___module_a27586b69dbfb63f714d1d45fd6304f97}{setThreshold}(Default\_t)
00171   \{
00172     m\_usePrescribedThreshold = \textcolor{keyword}{false};
00173     \textcolor{keywordflow}{return} derived();
00174   \}
00175 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_s_v_d_2_s_v_d_base_8h_source_l00180}\hyperlink{group___s_v_d___module_a98b2ee98690358951807353812a05c69}{00180}   RealScalar \hyperlink{group___s_v_d___module_a98b2ee98690358951807353812a05c69}{threshold}()\textcolor{keyword}{ const}
00181 \textcolor{keyword}{  }\{
00182     eigen\_assert(m\_isInitialized || m\_usePrescribedThreshold);
00183     \textcolor{keywordflow}{return} m\_usePrescribedThreshold ? m\_prescribedThreshold
00184                                     : (std::max<Index>)(1,m\_diagSize)*
      \hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<Scalar>::epsilon}();
00185   \}
00186 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_s_v_d_2_s_v_d_base_8h_source_l00188}\hyperlink{group___s_v_d___module_a705a7c2709e1624ccc19aa748a78d473}{00188}   \textcolor{keyword}{inline} \textcolor{keywordtype}{bool} \hyperlink{group___s_v_d___module_a705a7c2709e1624ccc19aa748a78d473}{computeU}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_computeFullU || m\_computeThinU; \}
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_s_v_d_2_s_v_d_base_8h_source_l00190}\hyperlink{group___s_v_d___module_a5f12efcb791eb007d4a4890ac5255ac4}{00190}   \textcolor{keyword}{inline} \textcolor{keywordtype}{bool} \hyperlink{group___s_v_d___module_a5f12efcb791eb007d4a4890ac5255ac4}{computeV}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_computeFullV || m\_computeThinV; \}
00191 
00192   \textcolor{keyword}{inline} Index rows()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_rows; \}
00193   \textcolor{keyword}{inline} Index cols()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_cols; \}
00194   
00204   \textcolor{keyword}{template}<\textcolor{keyword}{typename} Rhs>
00205   \textcolor{keyword}{inline} \textcolor{keyword}{const} \hyperlink{group___core___module_class_eigen_1_1_solve}{Solve<Derived, Rhs>}
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_s_v_d_2_s_v_d_base_8h_source_l00206}\hyperlink{group___s_v_d___module_ab28499936c0764fe5b56b9f4de701e26}{00206}   \hyperlink{group___s_v_d___module_ab28499936c0764fe5b56b9f4de701e26}{solve}(\textcolor{keyword}{const} \hyperlink{group___core___module_class_eigen_1_1_matrix_base}{MatrixBase<Rhs>}& b)\textcolor{keyword}{ const}
00207 \textcolor{keyword}{  }\{
00208     eigen\_assert(m\_isInitialized && \textcolor{stringliteral}{"SVD is not initialized."});
00209     eigen\_assert(\hyperlink{group___s_v_d___module_a705a7c2709e1624ccc19aa748a78d473}{computeU}() && \hyperlink{group___s_v_d___module_a5f12efcb791eb007d4a4890ac5255ac4}{computeV}() && \textcolor{stringliteral}{"SVD::solve() requires both unitaries U and V
       to be computed (thin unitaries suffice)."});
00210     \textcolor{keywordflow}{return} \hyperlink{group___core___module_class_eigen_1_1_solve}{Solve<Derived, Rhs>}(derived(), b.derived());
00211   \}
00212   
00213 \textcolor{preprocessor}{  #ifndef EIGEN\_PARSED\_BY\_DOXYGEN}
00214   \textcolor{keyword}{template}<\textcolor{keyword}{typename} RhsType, \textcolor{keyword}{typename} DstType>
00215   EIGEN\_DEVICE\_FUNC
00216   \textcolor{keywordtype}{void} \_solve\_impl(\textcolor{keyword}{const} RhsType &rhs, DstType &dst) \textcolor{keyword}{const};
00217 \textcolor{preprocessor}{  #endif}
00218 
00219 \textcolor{keyword}{protected}:
00220   
00221   \textcolor{keyword}{static} \textcolor{keywordtype}{void} check\_template\_parameters()
00222   \{
00223     EIGEN\_STATIC\_ASSERT\_NON\_INTEGER(Scalar);
00224   \}
00225   
00226   \textcolor{comment}{// return true if already allocated}
00227   \textcolor{keywordtype}{bool} allocate(Index rows, Index cols, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} computationOptions) ;
00228 
00229   MatrixUType m\_matrixU;
00230   MatrixVType m\_matrixV;
00231   SingularValuesType m\_singularValues;
00232   \textcolor{keywordtype}{bool} m\_isInitialized, m\_isAllocated, m\_usePrescribedThreshold;
00233   \textcolor{keywordtype}{bool} m\_computeFullU, m\_computeThinU;
00234   \textcolor{keywordtype}{bool} m\_computeFullV, m\_computeThinV;
00235   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} m\_computationOptions;
00236   Index m\_nonzeroSingularValues, m\_rows, m\_cols, m\_diagSize;
00237   RealScalar m\_prescribedThreshold;
00238 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_s_v_d_2_s_v_d_base_8h_source_l00243}\hyperlink{group___s_v_d___module_abed06fc6f4b743e1f76a7b317539da87}{00243}   \hyperlink{group___s_v_d___module_abed06fc6f4b743e1f76a7b317539da87}{SVDBase}()
00244     : m\_isInitialized(false),
00245       m\_isAllocated(false),
00246       m\_usePrescribedThreshold(false),
00247       m\_computationOptions(0),
00248       m\_rows(-1), m\_cols(-1), m\_diagSize(0)
00249   \{
00250     check\_template\_parameters();
00251   \}
00252 
00253 
00254 \};
00255 
00256 \textcolor{preprocessor}{#ifndef EIGEN\_PARSED\_BY\_DOXYGEN}
00257 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Derived>
00258 \textcolor{keyword}{template}<\textcolor{keyword}{typename} RhsType, \textcolor{keyword}{typename} DstType>
00259 \textcolor{keywordtype}{void} \hyperlink{group___s_v_d___module_class_eigen_1_1_s_v_d_base}{SVDBase<Derived>::\_solve\_impl}(\textcolor{keyword}{const} RhsType &rhs, DstType &dst)\textcolor{keyword}{ const}
00260 \textcolor{keyword}{}\{
00261   eigen\_assert(rhs.rows() == rows());
00262 
00263   \textcolor{comment}{// A = U S V^*}
00264   \textcolor{comment}{// So A^\{-1\} = V S^\{-1\} U^*}
00265 
00266   
      \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar, Dynamic, RhsType::ColsAtCompileTime, 0, MatrixType::MaxRowsAtCompileTime,
       RhsType::MaxColsAtCompileTime>}
       tmp;
00267   \hyperlink{group___s_v_d___module_a6229a37997eca1072b52cca5ee7a2bec}{Index} l\_rank = \hyperlink{group___s_v_d___module_a30b89e24f42f1692079eea31b361d26a}{rank}();
00268   tmp.noalias() =  m\_matrixU.leftCols(l\_rank).adjoint() * rhs;
00269   tmp = m\_singularValues.head(l\_rank).asDiagonal().inverse() * tmp;
00270   dst = m\_matrixV.leftCols(l\_rank) * tmp;
00271 \}
00272 \textcolor{preprocessor}{#endif}
00273 
00274 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>
00275 \textcolor{keywordtype}{bool} \hyperlink{group___s_v_d___module_class_eigen_1_1_s_v_d_base}{SVDBase<MatrixType>::allocate}(\hyperlink{group___s_v_d___module_a6229a37997eca1072b52cca5ee7a2bec}{Index} rows, 
      \hyperlink{group___s_v_d___module_a6229a37997eca1072b52cca5ee7a2bec}{Index} cols, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} computationOptions)
00276 \{
00277   eigen\_assert(rows >= 0 && cols >= 0);
00278 
00279   \textcolor{keywordflow}{if} (m\_isAllocated &&
00280       rows == m\_rows &&
00281       cols == m\_cols &&
00282       computationOptions == m\_computationOptions)
00283   \{
00284     \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00285   \}
00286 
00287   m\_rows = rows;
00288   m\_cols = cols;
00289   m\_isInitialized = \textcolor{keyword}{false};
00290   m\_isAllocated = \textcolor{keyword}{true};
00291   m\_computationOptions = computationOptions;
00292   m\_computeFullU = (computationOptions & \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a2b4f91ca5859a4159dbfe8090043817f}{ComputeFullU}) != 0;
00293   m\_computeThinU = (computationOptions & \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9af8c742a1aa87773e165eae406c9ccaf8}{ComputeThinU}) != 0;
00294   m\_computeFullV = (computationOptions & \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a52c6f7e80bbf9a42297c88f700245b51}{ComputeFullV}) != 0;
00295   m\_computeThinV = (computationOptions & \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a1055e53fa95c8ae04a07ebb72cfafd95}{ComputeThinV}) != 0;
00296   eigen\_assert(!(m\_computeFullU && m\_computeThinU) && \textcolor{stringliteral}{"SVDBase: you can't ask for both full and thin U"});
00297   eigen\_assert(!(m\_computeFullV && m\_computeThinV) && \textcolor{stringliteral}{"SVDBase: you can't ask for both full and thin V"});
00298   eigen\_assert(EIGEN\_IMPLIES(m\_computeThinU || m\_computeThinV, MatrixType::ColsAtCompileTime==
      \hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Dynamic}) &&
00299            \textcolor{stringliteral}{"SVDBase: thin U and V are only available when your matrix has a dynamic number of columns."});
00300 
00301   m\_diagSize = (std::min)(m\_rows, m\_cols);
00302   m\_singularValues.resize(m\_diagSize);
00303   \textcolor{keywordflow}{if}(RowsAtCompileTime==\hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Dynamic})
00304     m\_matrixU.\hyperlink{class_eigen_1_1_plain_object_base_a99d9054ee2d5a40c6e00ded0265e9cea}{resize}(m\_rows, m\_computeFullU ? m\_rows : m\_computeThinU ? m\_diagSize : 0);
00305   \textcolor{keywordflow}{if}(ColsAtCompileTime==\hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Dynamic})
00306     m\_matrixV.\hyperlink{class_eigen_1_1_plain_object_base_a99d9054ee2d5a40c6e00ded0265e9cea}{resize}(m\_cols, m\_computeFullV ? m\_cols : m\_computeThinV ? m\_diagSize : 0);
00307 
00308   \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00309 \}
00310 
00311 \}\textcolor{comment}{// end namespace}
00312 
00313 \textcolor{preprocessor}{#endif // EIGEN\_SVDBASE\_H}
\end{DoxyCode}
