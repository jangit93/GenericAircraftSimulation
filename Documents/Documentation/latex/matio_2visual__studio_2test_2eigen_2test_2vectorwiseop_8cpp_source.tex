\hypertarget{matio_2visual__studio_2test_2eigen_2test_2vectorwiseop_8cpp_source}{}\section{matio/visual\+\_\+studio/test/eigen/test/vectorwiseop.cpp}
\label{matio_2visual__studio_2test_2eigen_2test_2vectorwiseop_8cpp_source}\index{vectorwiseop.\+cpp@{vectorwiseop.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2011 Benoit Jacob <jacob.benoit.1@gmail.com>}
00005 \textcolor{comment}{// Copyright (C) 2015 Gael Guennebaud <gael.guennebaud@inria.fr>}
00006 \textcolor{comment}{//}
00007 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00008 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00009 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00010 
00011 \textcolor{preprocessor}{#define TEST\_ENABLE\_TEMPORARY\_TRACKING}
00012 \textcolor{preprocessor}{#define EIGEN\_NO\_STATIC\_ASSERT}
00013 
00014 \textcolor{preprocessor}{#include "main.h"}
00015 
00016 \textcolor{keyword}{template}<\textcolor{keyword}{typename} ArrayType> \textcolor{keywordtype}{void} vectorwiseop\_array(\textcolor{keyword}{const} ArrayType& m)
00017 \{
00018   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} ArrayType::Index \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index};
00019   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} ArrayType::Scalar Scalar;
00020   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_array}{Array<Scalar, ArrayType::RowsAtCompileTime, 1>} 
      ColVectorType;
00021   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_array}{Array<Scalar, 1, ArrayType::ColsAtCompileTime>} 
      RowVectorType;
00022 
00023   Index rows = m.rows();
00024   Index cols = m.cols();
00025   Index r = internal::random<Index>(0, rows-1),
00026         c = internal::random<Index>(0, cols-1);
00027 
00028   ArrayType m1 = ArrayType::Random(rows, cols),
00029             m2(rows, cols),
00030             m3(rows, cols);
00031 
00032   ColVectorType colvec = ColVectorType::Random(rows);
00033   RowVectorType rowvec = RowVectorType::Random(cols);
00034 
00035   \textcolor{comment}{// test addition}
00036 
00037   m2 = m1;
00038   m2.colwise() += colvec;
00039   VERIFY\_IS\_APPROX(m2, m1.colwise() + colvec);
00040   VERIFY\_IS\_APPROX(m2.col(c), m1.col(c) + colvec);
00041 
00042   VERIFY\_RAISES\_ASSERT(m2.colwise() += colvec.transpose());
00043   VERIFY\_RAISES\_ASSERT(m1.colwise() + colvec.transpose());
00044 
00045   m2 = m1;
00046   m2.rowwise() += rowvec;
00047   VERIFY\_IS\_APPROX(m2, m1.rowwise() + rowvec);
00048   VERIFY\_IS\_APPROX(m2.row(r), m1.row(r) + rowvec);
00049 
00050   VERIFY\_RAISES\_ASSERT(m2.rowwise() += rowvec.transpose());
00051   VERIFY\_RAISES\_ASSERT(m1.rowwise() + rowvec.transpose());
00052 
00053   \textcolor{comment}{// test substraction}
00054 
00055   m2 = m1;
00056   m2.colwise() -= colvec;
00057   VERIFY\_IS\_APPROX(m2, m1.colwise() - colvec);
00058   VERIFY\_IS\_APPROX(m2.col(c), m1.col(c) - colvec);
00059 
00060   VERIFY\_RAISES\_ASSERT(m2.colwise() -= colvec.transpose());
00061   VERIFY\_RAISES\_ASSERT(m1.colwise() - colvec.transpose());
00062 
00063   m2 = m1;
00064   m2.rowwise() -= rowvec;
00065   VERIFY\_IS\_APPROX(m2, m1.rowwise() - rowvec);
00066   VERIFY\_IS\_APPROX(m2.row(r), m1.row(r) - rowvec);
00067 
00068   VERIFY\_RAISES\_ASSERT(m2.rowwise() -= rowvec.transpose());
00069   VERIFY\_RAISES\_ASSERT(m1.rowwise() - rowvec.transpose());
00070 
00071   \textcolor{comment}{// test multiplication}
00072 
00073   m2 = m1;
00074   m2.colwise() *= colvec;
00075   VERIFY\_IS\_APPROX(m2, m1.colwise() * colvec);
00076   VERIFY\_IS\_APPROX(m2.col(c), m1.col(c) * colvec);
00077 
00078   VERIFY\_RAISES\_ASSERT(m2.colwise() *= colvec.transpose());
00079   VERIFY\_RAISES\_ASSERT(m1.colwise() * colvec.transpose());
00080 
00081   m2 = m1;
00082   m2.rowwise() *= rowvec;
00083   VERIFY\_IS\_APPROX(m2, m1.rowwise() * rowvec);
00084   VERIFY\_IS\_APPROX(m2.row(r), m1.row(r) * rowvec);
00085 
00086   VERIFY\_RAISES\_ASSERT(m2.rowwise() *= rowvec.transpose());
00087   VERIFY\_RAISES\_ASSERT(m1.rowwise() * rowvec.transpose());
00088 
00089   \textcolor{comment}{// test quotient}
00090 
00091   m2 = m1;
00092   m2.colwise() /= colvec;
00093   VERIFY\_IS\_APPROX(m2, m1.colwise() / colvec);
00094   VERIFY\_IS\_APPROX(m2.col(c), m1.col(c) / colvec);
00095 
00096   VERIFY\_RAISES\_ASSERT(m2.colwise() /= colvec.transpose());
00097   VERIFY\_RAISES\_ASSERT(m1.colwise() / colvec.transpose());
00098 
00099   m2 = m1;
00100   m2.rowwise() /= rowvec;
00101   VERIFY\_IS\_APPROX(m2, m1.rowwise() / rowvec);
00102   VERIFY\_IS\_APPROX(m2.row(r), m1.row(r) / rowvec);
00103 
00104   VERIFY\_RAISES\_ASSERT(m2.rowwise() /= rowvec.transpose());
00105   VERIFY\_RAISES\_ASSERT(m1.rowwise() / rowvec.transpose());
00106 
00107   m2 = m1;
00108   \textcolor{comment}{// yes, there might be an aliasing issue there but ".rowwise() /="}
00109   \textcolor{comment}{// is supposed to evaluate " m2.colwise().sum()" into a temporary to avoid}
00110   \textcolor{comment}{// evaluating the reduction multiple times}
00111   \textcolor{keywordflow}{if}(ArrayType::RowsAtCompileTime>2 || ArrayType::RowsAtCompileTime==Dynamic)
00112   \{
00113     m2.rowwise() /= m2.colwise().sum();
00114     VERIFY\_IS\_APPROX(m2, m1.rowwise() / m1.colwise().sum());
00115   \}
00116 
00117   \textcolor{comment}{// all/any}
00118   \hyperlink{group___core___module_class_eigen_1_1_array}{Array<bool,Dynamic,Dynamic>} mb(rows,cols);
00119   mb = (m1.real()<=0.7).colwise().all();
00120   VERIFY( (mb.col(c) == (m1.real().col(c)<=0.7).all()).all() );
00121   mb = (m1.real()<=0.7).rowwise().all();
00122   VERIFY( (mb.row(r) == (m1.real().row(r)<=0.7).all()).all() );
00123 
00124   mb = (m1.real()>=0.7).colwise().any();
00125   VERIFY( (mb.col(c) == (m1.real().col(c)>=0.7).any()).all() );
00126   mb = (m1.real()>=0.7).rowwise().any();
00127   VERIFY( (mb.row(r) == (m1.real().row(r)>=0.7).any()).all() );
00128 \}
00129 
00130 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType> \textcolor{keywordtype}{void} vectorwiseop\_matrix(\textcolor{keyword}{const} MatrixType& m)
00131 \{
00132   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::Index Index;
00133   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::Scalar Scalar;
00134   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<Scalar>::Real} RealScalar;
00135   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar, MatrixType::RowsAtCompileTime, 1>} 
      ColVectorType;
00136   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar, 1, MatrixType::ColsAtCompileTime>} 
      RowVectorType;
00137   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<RealScalar, MatrixType::RowsAtCompileTime, 1>}
       RealColVectorType;
00138   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<RealScalar, 1, MatrixType::ColsAtCompileTime>}
       RealRowVectorType;
00139 
00140   Index rows = m.rows();
00141   Index cols = m.cols();
00142   Index r = internal::random<Index>(0, rows-1),
00143         c = internal::random<Index>(0, cols-1);
00144 
00145   MatrixType m1 = MatrixType::Random(rows, cols),
00146             m2(rows, cols),
00147             m3(rows, cols);
00148 
00149   ColVectorType colvec = ColVectorType::Random(rows);
00150   RowVectorType rowvec = RowVectorType::Random(cols);
00151   RealColVectorType rcres;
00152   RealRowVectorType rrres;
00153 
00154   \textcolor{comment}{// test addition}
00155 
00156   m2 = m1;
00157   m2.colwise() += colvec;
00158   VERIFY\_IS\_APPROX(m2, m1.colwise() + colvec);
00159   VERIFY\_IS\_APPROX(m2.col(c), m1.col(c) + colvec);
00160 
00161   \textcolor{keywordflow}{if}(rows>1)
00162   \{
00163     VERIFY\_RAISES\_ASSERT(m2.colwise() += colvec.transpose());
00164     VERIFY\_RAISES\_ASSERT(m1.colwise() + colvec.transpose());
00165   \}
00166 
00167   m2 = m1;
00168   m2.rowwise() += rowvec;
00169   VERIFY\_IS\_APPROX(m2, m1.rowwise() + rowvec);
00170   VERIFY\_IS\_APPROX(m2.row(r), m1.row(r) + rowvec);
00171 
00172   \textcolor{keywordflow}{if}(cols>1)
00173   \{
00174     VERIFY\_RAISES\_ASSERT(m2.rowwise() += rowvec.transpose());
00175     VERIFY\_RAISES\_ASSERT(m1.rowwise() + rowvec.transpose());
00176   \}
00177 
00178   \textcolor{comment}{// test substraction}
00179 
00180   m2 = m1;
00181   m2.colwise() -= colvec;
00182   VERIFY\_IS\_APPROX(m2, m1.colwise() - colvec);
00183   VERIFY\_IS\_APPROX(m2.col(c), m1.col(c) - colvec);
00184 
00185   \textcolor{keywordflow}{if}(rows>1)
00186   \{
00187     VERIFY\_RAISES\_ASSERT(m2.colwise() -= colvec.transpose());
00188     VERIFY\_RAISES\_ASSERT(m1.colwise() - colvec.transpose());
00189   \}
00190 
00191   m2 = m1;
00192   m2.rowwise() -= rowvec;
00193   VERIFY\_IS\_APPROX(m2, m1.rowwise() - rowvec);
00194   VERIFY\_IS\_APPROX(m2.row(r), m1.row(r) - rowvec);
00195 
00196   \textcolor{keywordflow}{if}(cols>1)
00197   \{
00198     VERIFY\_RAISES\_ASSERT(m2.rowwise() -= rowvec.transpose());
00199     VERIFY\_RAISES\_ASSERT(m1.rowwise() - rowvec.transpose());
00200   \}
00201 
00202   \textcolor{comment}{// test norm}
00203   rrres = m1.colwise().norm();
00204   VERIFY\_IS\_APPROX(rrres(c), m1.col(c).norm());
00205   rcres = m1.rowwise().norm();
00206   VERIFY\_IS\_APPROX(rcres(r), m1.row(r).norm());
00207 
00208   VERIFY\_IS\_APPROX(m1.cwiseAbs().colwise().sum(), m1.colwise().template lpNorm<1>());
00209   VERIFY\_IS\_APPROX(m1.cwiseAbs().rowwise().sum(), m1.rowwise().template lpNorm<1>());
00210   VERIFY\_IS\_APPROX(m1.cwiseAbs().colwise().maxCoeff(), m1.colwise().template lpNorm<Infinity>());
00211   VERIFY\_IS\_APPROX(m1.cwiseAbs().rowwise().maxCoeff(), m1.rowwise().template lpNorm<Infinity>());
00212 
00213   \textcolor{comment}{// regression for bug 1158}
00214   VERIFY\_IS\_APPROX(m1.cwiseAbs().colwise().sum().x(), m1.col(0).cwiseAbs().sum());
00215 
00216   \textcolor{comment}{// test normalized}
00217   m2 = m1.colwise().normalized();
00218   VERIFY\_IS\_APPROX(m2.col(c), m1.col(c).normalized());
00219   m2 = m1.rowwise().normalized();
00220   VERIFY\_IS\_APPROX(m2.row(r), m1.row(r).normalized());
00221 
00222   \textcolor{comment}{// test normalize}
00223   m2 = m1;
00224   m2.colwise().normalize();
00225   VERIFY\_IS\_APPROX(m2.col(c), m1.col(c).normalized());
00226   m2 = m1;
00227   m2.rowwise().normalize();
00228   VERIFY\_IS\_APPROX(m2.row(r), m1.row(r).normalized());
00229 
00230   \textcolor{comment}{// test with partial reduction of products}
00231   \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,MatrixType::RowsAtCompileTime,MatrixType::RowsAtCompileTime>}
       m1m1 = m1 * m1.transpose();
00232   VERIFY\_IS\_APPROX( (m1 * m1.transpose()).colwise().sum(), m1m1.colwise().sum());
00233   \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,1,MatrixType::RowsAtCompileTime>} tmp(rows);
00234   VERIFY\_EVALUATION\_COUNT( tmp = (m1 * m1.transpose()).colwise().sum(), 1);
00235 
00236   m2 = m1.rowwise() - (m1.colwise().sum()/RealScalar(m1.rows())).eval();
00237   m1 = m1.rowwise() - (m1.colwise().sum()/RealScalar(m1.rows()));
00238   VERIFY\_IS\_APPROX( m1, m2 );
00239   VERIFY\_EVALUATION\_COUNT( m2 = (m1.rowwise() - m1.colwise().sum()/RealScalar(m1.rows())), (
      MatrixType::RowsAtCompileTime!=1 ? 1 : 0) );
00240 \}
00241 
00242 \textcolor{keywordtype}{void} test\_vectorwiseop()
00243 \{
00244   CALL\_SUBTEST\_1( vectorwiseop\_array(Array22cd()) );
00245   CALL\_SUBTEST\_2( vectorwiseop\_array(\hyperlink{group___core___module_class_eigen_1_1_array}{Array<double, 3, 2>}()) );
00246   CALL\_SUBTEST\_3( vectorwiseop\_array(ArrayXXf(3, 4)) );
00247   CALL\_SUBTEST\_4( vectorwiseop\_matrix(Matrix4cf()) );
00248   CALL\_SUBTEST\_5( vectorwiseop\_matrix(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<float,4,5>}()) );
00249   CALL\_SUBTEST\_6( vectorwiseop\_matrix(MatrixXd(internal::random<int>(1,EIGEN\_TEST\_MAX\_SIZE), 
      internal::random<int>(1,EIGEN\_TEST\_MAX\_SIZE))) );
00250   CALL\_SUBTEST\_7( vectorwiseop\_matrix(VectorXd(internal::random<int>(1,EIGEN\_TEST\_MAX\_SIZE))) );
00251   CALL\_SUBTEST\_7( vectorwiseop\_matrix(RowVectorXd(internal::random<int>(1,EIGEN\_TEST\_MAX\_SIZE))) );
00252 \}
\end{DoxyCode}
