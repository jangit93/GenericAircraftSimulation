\hypertarget{visual__studio_2_h_d_f5_21_810_81_2_h_d_f5_examples_2_c_2_h5_d_2h5ex__d__extern_8c_source}{}\section{visual\+\_\+studio/\+H\+D\+F5/1.10.1/\+H\+D\+F5\+Examples/\+C/\+H5\+D/h5ex\+\_\+d\+\_\+extern.c}
\label{visual__studio_2_h_d_f5_21_810_81_2_h_d_f5_examples_2_c_2_h5_d_2h5ex__d__extern_8c_source}\index{h5ex\+\_\+d\+\_\+extern.\+c@{h5ex\+\_\+d\+\_\+extern.\+c}}

\begin{DoxyCode}
00001 \textcolor{comment}{/************************************************************}
00002 \textcolor{comment}{}
00003 \textcolor{comment}{  This example shows how to read and write data to an}
00004 \textcolor{comment}{  external dataset.  The program first writes integers to an}
00005 \textcolor{comment}{  external dataset with dataspace dimensions of DIM0xDIM1,}
00006 \textcolor{comment}{  then closes the file.  Next, it reopens the file, reads}
00007 \textcolor{comment}{  back the data, and outputs the name of the external data}
00008 \textcolor{comment}{  file and the data to the screen.}
00009 \textcolor{comment}{}
00010 \textcolor{comment}{  This file is intended for use with HDF5 Library version 1.8}
00011 \textcolor{comment}{}
00012 \textcolor{comment}{ ************************************************************/}
00013 
00014 \textcolor{preprocessor}{#include "hdf5.h"}
00015 \textcolor{preprocessor}{#include <stdio.h>}
00016 \textcolor{preprocessor}{#include <stdlib.h>}
00017 
00018 \textcolor{preprocessor}{#define FILE            "h5ex\_d\_extern.h5"}
00019 \textcolor{preprocessor}{#define EXTERNAL        "h5ex\_d\_extern.data"}
00020 \textcolor{preprocessor}{#define DATASET         "DS1"}
00021 \textcolor{preprocessor}{#define DIM0            4}
00022 \textcolor{preprocessor}{#define DIM1            7}
00023 \textcolor{preprocessor}{#define NAME\_BUF\_SIZE   32}
00024 
00025 \textcolor{keywordtype}{int}
00026 main (\textcolor{keywordtype}{void})
00027 \{
00028     hid\_t       \hyperlink{structfile}{file}, space, dset, dcpl;    \textcolor{comment}{/* Handles */}
00029     herr\_t      status;
00030     hsize\_t     dims[2] = \{DIM0, DIM1\};
00031     \textcolor{keywordtype}{char}        name[NAME\_BUF\_SIZE];
00032     \textcolor{keywordtype}{int}         wdata[DIM0][DIM1],          \textcolor{comment}{/* Write buffer */}
00033                 rdata[DIM0][DIM1],          \textcolor{comment}{/* Read buffer */}
00034                 i, j;
00035 
00036     \textcolor{comment}{/*}
00037 \textcolor{comment}{     * Initialize data.}
00038 \textcolor{comment}{     */}
00039     \textcolor{keywordflow}{for} (i=0; i<DIM0; i++)
00040         \textcolor{keywordflow}{for} (j=0; j<DIM1; j++)
00041             wdata[i][j] = i * j - j;
00042 
00043     \textcolor{comment}{/*}
00044 \textcolor{comment}{     * Create a new file using the default properties.}
00045 \textcolor{comment}{     */}
00046     file = H5Fcreate (FILE, H5F\_ACC\_TRUNC, H5P\_DEFAULT, H5P\_DEFAULT);
00047 
00048     \textcolor{comment}{/*}
00049 \textcolor{comment}{     * Create dataspace.  Setting maximum size to NULL sets the maximum}
00050 \textcolor{comment}{     * size to be the current size.}
00051 \textcolor{comment}{     */}
00052     space = H5Screate\_simple (2, dims, NULL);
00053 
00054     \textcolor{comment}{/*}
00055 \textcolor{comment}{     * Create the dataset creation property list, set the external}
00056 \textcolor{comment}{     * file.}
00057 \textcolor{comment}{     */}
00058     dcpl = H5Pcreate (H5P\_DATASET\_CREATE);
00059     status = H5Pset\_external (dcpl, EXTERNAL, 0, H5F\_UNLIMITED);
00060 
00061     \textcolor{comment}{/*}
00062 \textcolor{comment}{     * Create the external dataset.}
00063 \textcolor{comment}{     */}
00064     dset = H5Dcreate (file, DATASET, H5T\_STD\_I32LE, space, H5P\_DEFAULT, dcpl,
00065                 H5P\_DEFAULT);
00066 
00067     \textcolor{comment}{/*}
00068 \textcolor{comment}{     * Write the data to the dataset.}
00069 \textcolor{comment}{     */}
00070     status = H5Dwrite (dset, H5T\_NATIVE\_INT, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT,
00071                 wdata[0]);
00072 
00073     \textcolor{comment}{/*}
00074 \textcolor{comment}{     * Close and release resources.}
00075 \textcolor{comment}{     */}
00076     status = H5Pclose (dcpl);
00077     status = H5Dclose (dset);
00078     status = H5Sclose (space);
00079     status = H5Fclose (file);
00080 
00081 
00082     \textcolor{comment}{/*}
00083 \textcolor{comment}{     * Now we begin the read section of this example.}
00084 \textcolor{comment}{     */}
00085 
00086     \textcolor{comment}{/*}
00087 \textcolor{comment}{     * Open file and dataset using the default properties.}
00088 \textcolor{comment}{     */}
00089     file = H5Fopen (FILE, H5F\_ACC\_RDONLY, H5P\_DEFAULT);
00090     dset = H5Dopen (file, DATASET, H5P\_DEFAULT);
00091 
00092     \textcolor{comment}{/*}
00093 \textcolor{comment}{     * Retrieve dataset creation property list.}
00094 \textcolor{comment}{     */}
00095     dcpl = H5Dget\_create\_plist (dset);
00096 
00097     \textcolor{comment}{/*}
00098 \textcolor{comment}{     * Retrieve and print the name of the external file.  Here we}
00099 \textcolor{comment}{     * manually set the last field in name to null, in case the name of}
00100 \textcolor{comment}{     * the file is longer than the buffer.}
00101 \textcolor{comment}{     */}
00102     status = H5Pget\_external (dcpl, 0, NAME\_BUF\_SIZE, name, NULL, NULL);
00103     name[NAME\_BUF\_SIZE-1] = \textcolor{charliteral}{'\(\backslash\)0'};
00104     printf (\textcolor{stringliteral}{"%s is stored in file: %s\(\backslash\)n"}, DATASET, name);
00105 
00106     \textcolor{comment}{/*}
00107 \textcolor{comment}{     * Read the data using the default properties.}
00108 \textcolor{comment}{     */}
00109     status = H5Dread (dset, H5T\_NATIVE\_INT, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT,
00110                 rdata[0]);
00111 
00112     \textcolor{comment}{/*}
00113 \textcolor{comment}{     * Output the data to the screen.}
00114 \textcolor{comment}{     */}
00115     printf (\textcolor{stringliteral}{"%s:\(\backslash\)n"}, DATASET);
00116     \textcolor{keywordflow}{for} (i=0; i<DIM0; i++) \{
00117         printf (\textcolor{stringliteral}{" ["});
00118         \textcolor{keywordflow}{for} (j=0; j<DIM1; j++)
00119             printf (\textcolor{stringliteral}{" %3d"}, rdata[i][j]);
00120         printf (\textcolor{stringliteral}{"]\(\backslash\)n"});
00121     \}
00122 
00123     \textcolor{comment}{/*}
00124 \textcolor{comment}{     * Close and release resources.}
00125 \textcolor{comment}{     */}
00126     status = H5Pclose (dcpl);
00127     status = H5Dclose (dset);
00128     status = H5Fclose (file);
00129 
00130     \textcolor{keywordflow}{return} 0;
00131 \}
\end{DoxyCode}
