\hypertarget{visual__studio_2_h_d_f5_21_810_81_2_h_d_f5_examples_2_f_o_r_t_r_a_n_2_h5_t_2h5ex__t__objref___f03_8f90_source}{}\section{visual\+\_\+studio/\+H\+D\+F5/1.10.1/\+H\+D\+F5\+Examples/\+F\+O\+R\+T\+R\+A\+N/\+H5\+T/h5ex\+\_\+t\+\_\+objref\+\_\+\+F03.f90}
\label{visual__studio_2_h_d_f5_21_810_81_2_h_d_f5_examples_2_f_o_r_t_r_a_n_2_h5_t_2h5ex__t__objref___f03_8f90_source}\index{h5ex\+\_\+t\+\_\+objref\+\_\+\+F03.\+f90@{h5ex\+\_\+t\+\_\+objref\+\_\+\+F03.\+f90}}

\begin{DoxyCode}
00001 \textcolor{comment}{!************************************************************}
00002 \textcolor{comment}{!}
00003 \textcolor{comment}{!  This example shows how to read and write object references}
00004 \textcolor{comment}{!  to a dataset.  The program first creates objects in the}
00005 \textcolor{comment}{!  file and writes references to those objects to a dataset}
00006 \textcolor{comment}{!  with a dataspace of DIM0, then closes the file.  Next, it}
00007 \textcolor{comment}{!  reopens the file, dereferences the references, and outputs}
00008 \textcolor{comment}{!  the names of their targets to the screen.}
00009 \textcolor{comment}{!}
00010 \textcolor{comment}{!  This file is intended for use with HDF5 Library version 1.8}
00011 \textcolor{comment}{!  with --enable-fortran2003}
00012 \textcolor{comment}{!}
00013 \textcolor{comment}{! ************************************************************/}
00014 \textcolor{keyword}{PROGRAM} main
00015 
00016   \textcolor{keywordtype}{USE }hdf5
00017   \textcolor{keywordtype}{USE }iso\_c\_binding
00018 
00019   \textcolor{keywordtype}{IMPLICIT NONE}
00020   \textcolor{keywordtype}{CHARACTER(LEN=20)}, \textcolor{keywordtype}{PARAMETER} :: filename  = \textcolor{stringliteral}{"h5ex\_t\_objref\_F03.h5"}
00021   \textcolor{keywordtype}{CHARACTER(LEN=3)} , \textcolor{keywordtype}{PARAMETER} :: dataset   = \textcolor{stringliteral}{"DS1"}
00022   \textcolor{keywordtype}{INTEGER}          , \textcolor{keywordtype}{PARAMETER} :: dim0      = 2
00023 
00024   \textcolor{keywordtype}{INTEGER(HID\_T)}  :: \hyperlink{structfile}{file}, space, dset, obj \textcolor{comment}{! Handles}
00025   \textcolor{keywordtype}{INTEGER} :: hdferr
00026 
00027   \textcolor{keywordtype}{INTEGER(hsize\_t)},   \textcolor{keywordtype}{DIMENSION(1:1)} :: dims = (/dim0/)
00028   \textcolor{keywordtype}{TYPE}(hobj\_ref\_t\_f), \textcolor{keywordtype}{DIMENSION(1:dim0)}, \textcolor{keywordtype}{TARGET} :: wdata \textcolor{comment}{! Write buffer}
00029   \textcolor{keywordtype}{TYPE}(hobj\_ref\_t\_f), \textcolor{keywordtype}{DIMENSION(:)}, \textcolor{keywordtype}{ALLOCATABLE}, \textcolor{keywordtype}{TARGET} :: rdata \textcolor{comment}{! Read buffer}
00030   \textcolor{keywordtype}{INTEGER} :: objtype
00031   \textcolor{keywordtype}{INTEGER(SIZE\_T)} :: name\_size
00032   \textcolor{keywordtype}{CHARACTER(LEN=80)} :: name
00033   \textcolor{keywordtype}{INTEGER(HSIZE\_T)}, \textcolor{keywordtype}{DIMENSION(1:1)} :: maxdims
00034   \textcolor{keywordtype}{INTEGER} :: i
00035   \textcolor{keywordtype}{TYPE}(c\_ptr) :: f\_ptr
00036   \textcolor{comment}{!}
00037   \textcolor{comment}{! Initialize FORTRAN interface.}
00038   \textcolor{comment}{!}
00039   \textcolor{keyword}{CALL }h5open\_f(hdferr)
00040   \textcolor{comment}{!}
00041   \textcolor{comment}{! Create a new file using the default properties.}
00042   \textcolor{comment}{!}
00043   \textcolor{keyword}{CALL }h5fcreate\_f(filename, h5f\_acc\_trunc\_f, \hyperlink{structfile}{file}, hdferr)
00044   \textcolor{comment}{!}
00045   \textcolor{comment}{! Create a dataset with a null dataspace.}
00046   \textcolor{comment}{!}
00047   \textcolor{keyword}{CALL }h5screate\_f(h5s\_null\_f,space,hdferr)
00048   \textcolor{keyword}{CALL }h5dcreate\_f(\hyperlink{structfile}{file}, \textcolor{stringliteral}{"DS2"}, h5t\_std\_i32le, space, obj, hdferr)
00049   \textcolor{comment}{!}
00050   \textcolor{keyword}{CALL }h5dclose\_f(obj  , hdferr)
00051   \textcolor{keyword}{CALL }h5sclose\_f(space, hdferr)
00052   \textcolor{comment}{!}
00053   \textcolor{comment}{! Create a group.}
00054   \textcolor{comment}{!}
00055   \textcolor{keyword}{CALL }h5gcreate\_f(\hyperlink{structfile}{file}, \textcolor{stringliteral}{"G1"}, obj, hdferr)
00056   \textcolor{keyword}{CALL }h5gclose\_f(obj, hdferr)
00057   \textcolor{comment}{!}
00058   \textcolor{comment}{! Create references to the previously created objects. note, space\_id}
00059   \textcolor{comment}{! is not needed for object references.}
00060   \textcolor{comment}{!}
00061   f\_ptr = c\_loc(wdata(1))
00062   \textcolor{keyword}{CALL }h5rcreate\_f(\hyperlink{structfile}{file}, \textcolor{stringliteral}{"G1"}, h5r\_object\_f, f\_ptr, hdferr)
00063   f\_ptr = c\_loc(wdata(2))
00064   \textcolor{keyword}{CALL }h5rcreate\_f(\hyperlink{structfile}{file}, \textcolor{stringliteral}{"DS2"}, h5r\_object\_f, f\_ptr, hdferr)
00065   \textcolor{comment}{!}
00066   \textcolor{comment}{! Create dataspace.  Setting maximum size to be the current size.}
00067   \textcolor{comment}{!}
00068   \textcolor{keyword}{CALL }h5screate\_simple\_f(1, dims, space, hdferr)
00069   \textcolor{comment}{!}
00070   \textcolor{comment}{! Create the dataset and write the object references to it.}
00071   \textcolor{comment}{!}
00072   \textcolor{keyword}{CALL }h5dcreate\_f(\hyperlink{structfile}{file}, dataset, h5t\_std\_ref\_obj, space, dset, hdferr)
00073   f\_ptr = c\_loc(wdata(1))
00074   \textcolor{keyword}{CALL }h5dwrite\_f(dset, h5t\_std\_ref\_obj, f\_ptr, hdferr)
00075   \textcolor{comment}{!}
00076   \textcolor{comment}{! Close and release resources.}
00077   \textcolor{comment}{!}
00078   \textcolor{keyword}{CALL }h5dclose\_f(dset , hdferr)
00079   \textcolor{keyword}{CALL }h5sclose\_f(space, hdferr)
00080   \textcolor{keyword}{CALL }h5fclose\_f(\hyperlink{structfile}{file} , hdferr)
00081   \textcolor{comment}{!}
00082   \textcolor{comment}{! Now we begin the read section of this example.}
00083   \textcolor{comment}{!}
00084   \textcolor{comment}{! Open file and dataset.}
00085   \textcolor{comment}{!}
00086   \textcolor{keyword}{CALL }h5fopen\_f(filename, h5f\_acc\_rdonly\_f, \hyperlink{structfile}{file}, hdferr)
00087   \textcolor{keyword}{CALL }h5dopen\_f(\hyperlink{structfile}{file}, dataset, dset, hdferr)
00088   \textcolor{comment}{!}
00089   \textcolor{comment}{! Get dataspace and allocate memory for read buffer.}
00090   \textcolor{comment}{!}
00091   \textcolor{keyword}{CALL }h5dget\_space\_f(dset, space, hdferr)
00092   \textcolor{keyword}{CALL }h5sget\_simple\_extent\_dims\_f(space, dims, maxdims, hdferr)
00093 
00094   \textcolor{keyword}{ALLOCATE}(rdata(1:maxdims(1)))
00095   \textcolor{comment}{!}
00096   \textcolor{comment}{! Read the data.}
00097   \textcolor{comment}{!}
00098   f\_ptr = c\_loc(rdata(1))
00099   \textcolor{keyword}{CALL }h5dread\_f( dset, h5t\_std\_ref\_obj, f\_ptr, hdferr)
00100   \textcolor{comment}{!}
00101   \textcolor{comment}{! Output the data to the screen.}
00102   \textcolor{comment}{!}
00103   \textcolor{keywordflow}{DO} i = 1, maxdims(1)
00104      \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'(A,"[",i1,"]:",/,2X,"->")'}, advance=\textcolor{stringliteral}{'NO'}) dataset, i-1
00105      \textcolor{comment}{!}
00106      \textcolor{comment}{! Open the referenced object, get its name and type.}
00107      \textcolor{comment}{!}
00108      f\_ptr = c\_loc(rdata(i))
00109      \textcolor{keyword}{CALL }h5rdereference\_f(dset, h5r\_object\_f, f\_ptr, obj, hdferr)
00110      \textcolor{keyword}{CALL }h5rget\_obj\_type\_f(dset, h5r\_object\_f, f\_ptr, objtype, hdferr)
00111      \textcolor{comment}{!}
00112      \textcolor{comment}{! Get the length of the name and name}
00113      \textcolor{comment}{!}
00114      \textcolor{keyword}{CALL }h5iget\_name\_f(obj, name, 80\_size\_t, name\_size, hdferr)
00115      \textcolor{comment}{!}
00116      \textcolor{comment}{! Print the object type and close the object.}
00117      \textcolor{comment}{!}
00118      \textcolor{keywordflow}{IF}(objtype.EQ.h5g\_group\_f)\textcolor{keywordflow}{THEN}
00119         \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'("Group")'}, advance=\textcolor{stringliteral}{"NO"})
00120      \textcolor{keywordflow}{ELSE} \textcolor{keywordflow}{IF}(objtype.EQ.h5g\_dataset\_f)\textcolor{keywordflow}{THEN}
00121         \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'("Dataset")'}, advance=\textcolor{stringliteral}{"NO"})
00122      \textcolor{keywordflow}{ELSE} \textcolor{keywordflow}{IF}(objtype.EQ.h5g\_type\_f)\textcolor{keywordflow}{THEN}
00123         \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'("Named Datatype")'}, advance=\textcolor{stringliteral}{"NO"})
00124      \textcolor{keywordflow}{ELSE}
00125         \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'("Unknown")'}, advance=\textcolor{stringliteral}{"NO"})
00126 \textcolor{keywordflow}{     ENDIF}
00127      \textcolor{keyword}{CALL }h5oclose\_f(obj, hdferr)
00128      \textcolor{comment}{!}
00129      \textcolor{comment}{! Print the name.}
00130      \textcolor{comment}{!}
00131      \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'(": ",A)'}) name(1:name\_size)
00132 \textcolor{keywordflow}{  END DO}
00133   \textcolor{comment}{!}
00134   \textcolor{comment}{! Close and release resources.}
00135   \textcolor{comment}{!}
00136   \textcolor{keyword}{DEALLOCATE}(rdata)
00137   \textcolor{keyword}{CALL }h5dclose\_f(dset , hdferr)
00138   \textcolor{keyword}{CALL }h5sclose\_f(space, hdferr)
00139   \textcolor{keyword}{CALL }h5fclose\_f(\hyperlink{structfile}{file} , hdferr)
00140   \textcolor{comment}{!}
00141 \textcolor{keyword}{  END PROGRAM }main
\end{DoxyCode}
