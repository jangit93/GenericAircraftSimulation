\hypertarget{matio_2visual__studio_2test_2eigen_2bench_2tensors_2contraction__benchmarks__cpu_8cc_source}{}\section{matio/visual\+\_\+studio/test/eigen/bench/tensors/contraction\+\_\+benchmarks\+\_\+cpu.cc}
\label{matio_2visual__studio_2test_2eigen_2bench_2tensors_2contraction__benchmarks__cpu_8cc_source}\index{contraction\+\_\+benchmarks\+\_\+cpu.\+cc@{contraction\+\_\+benchmarks\+\_\+cpu.\+cc}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#define EIGEN\_USE\_THREADS}
00002 
00003 \textcolor{preprocessor}{#include <string>}
00004 
00005 \textcolor{preprocessor}{#include "tensor\_benchmarks.h"}
00006 
00007 \textcolor{preprocessor}{#define CREATE\_THREAD\_POOL(threads)             \(\backslash\)}
00008 \textcolor{preprocessor}{Eigen::ThreadPool pool(threads);                \(\backslash\)}
00009 \textcolor{preprocessor}{Eigen::ThreadPoolDevice device(&pool, threads);}
00010 
00011 
00012 \textcolor{comment}{// Contractions for number of threads ranging from 1 to 32}
00013 \textcolor{comment}{// Dimensions are Rows, Cols, Depth}
00014 \textcolor{preprocessor}{#define BM\_ContractionCPU(D1, D2, D3)                                         \(\backslash\)}
00015 \textcolor{preprocessor}{  static void BM\_##Contraction##\_##D1##x##D2##x##D3(int iters, int Threads) \{ \(\backslash\)}
00016 \textcolor{preprocessor}{    StopBenchmarkTiming();                                                    \(\backslash\)}
00017 \textcolor{preprocessor}{    CREATE\_THREAD\_POOL(Threads);                                              \(\backslash\)}
00018 \textcolor{preprocessor}{    BenchmarkSuite<Eigen::ThreadPoolDevice, float> suite(device, D1, D2, D3); \(\backslash\)}
00019 \textcolor{preprocessor}{    suite.contraction(iters);                                                 \(\backslash\)}
00020 \textcolor{preprocessor}{  \}                                                                           \(\backslash\)}
00021 \textcolor{preprocessor}{  BENCHMARK\_RANGE(BM\_##Contraction##\_##D1##x##D2##x##D3, 1, 32);}
00022 
00023 
00024 \textcolor{comment}{// Vector Matrix and Matrix Vector products}
00025 BM\_ContractionCPU(1, 2000, 500);
00026 BM\_ContractionCPU(2000, 1, 500);
00027 
00028 \textcolor{comment}{// Various skinny matrices}
00029 BM\_ContractionCPU(250, 3, 512);
00030 BM\_ContractionCPU(1500, 3, 512);
00031 
00032 BM\_ContractionCPU(512, 800, 4);
00033 BM\_ContractionCPU(512, 80, 800);
00034 BM\_ContractionCPU(512, 80, 13522);
00035 BM\_ContractionCPU(1, 80, 13522);
00036 
00037 BM\_ContractionCPU(3200, 512, 4);
00038 BM\_ContractionCPU(3200, 512, 80);
00039 BM\_ContractionCPU(3200, 80, 512);
\end{DoxyCode}
