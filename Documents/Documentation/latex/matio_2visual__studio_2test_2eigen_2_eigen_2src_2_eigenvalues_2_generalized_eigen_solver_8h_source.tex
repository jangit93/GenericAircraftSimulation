\hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_generalized_eigen_solver_8h_source}{}\section{matio/visual\+\_\+studio/test/eigen/\+Eigen/src/\+Eigenvalues/\+Generalized\+Eigen\+Solver.h}
\label{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_generalized_eigen_solver_8h_source}\index{Generalized\+Eigen\+Solver.\+h@{Generalized\+Eigen\+Solver.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2012-2016 Gael Guennebaud <gael.guennebaud@inria.fr>}
00005 \textcolor{comment}{// Copyright (C) 2010,2012 Jitse Niesen <jitse@maths.leeds.ac.uk>}
00006 \textcolor{comment}{// Copyright (C) 2016 Tobias Wood <tobias@spinicist.org.uk>}
00007 \textcolor{comment}{//}
00008 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00009 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00010 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00011 
00012 \textcolor{preprocessor}{#ifndef EIGEN\_GENERALIZEDEIGENSOLVER\_H}
00013 \textcolor{preprocessor}{#define EIGEN\_GENERALIZEDEIGENSOLVER\_H}
00014 
00015 \textcolor{preprocessor}{#include "./RealQZ.h"}
00016 
00017 \textcolor{keyword}{namespace }\hyperlink{namespace_eigen}{Eigen} \{ 
00018 
00058 \textcolor{keyword}{template}<\textcolor{keyword}{typename} \_MatrixType> \textcolor{keyword}{class }GeneralizedEigenSolver
00059 \{
00060   \textcolor{keyword}{public}:
00061 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_generalized_eigen_solver_8h_source_l00063}\hyperlink{group___eigenvalues___module_a56f4b9823bb9a267de3aaf48428cd247}{00063}     \textcolor{keyword}{typedef} \_MatrixType \hyperlink{group___eigenvalues___module_a56f4b9823bb9a267de3aaf48428cd247}{MatrixType};
00064 
00065     \textcolor{keyword}{enum} \{
00066       RowsAtCompileTime = MatrixType::RowsAtCompileTime,
00067       ColsAtCompileTime = MatrixType::ColsAtCompileTime,
00068       Options = MatrixType::Options,
00069       MaxRowsAtCompileTime = MatrixType::MaxRowsAtCompileTime,
00070       MaxColsAtCompileTime = MatrixType::MaxColsAtCompileTime
00071     \};
00072 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_generalized_eigen_solver_8h_source_l00074}\hyperlink{group___eigenvalues___module_afb318d0b097ff8dd5a7410d31317ca47}{00074}     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::Scalar \hyperlink{group___eigenvalues___module_afb318d0b097ff8dd5a7410d31317ca47}{Scalar};
00075     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<Scalar>::Real} RealScalar;
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_generalized_eigen_solver_8h_source_l00076}\hyperlink{group___eigenvalues___module_a46a0ff3841059479ec314e56a5645302}{00076}     \textcolor{keyword}{typedef} \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index} \hyperlink{group___eigenvalues___module_a46a0ff3841059479ec314e56a5645302}{Index}; 
00077 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_generalized_eigen_solver_8h_source_l00084}\hyperlink{group___eigenvalues___module_abdec07af91db1345bb4c74066e3d0ea7}{00084}     \textcolor{keyword}{typedef} std::complex<RealScalar> \hyperlink{group___eigenvalues___module_abdec07af91db1345bb4c74066e3d0ea7}{ComplexScalar};
00085 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_generalized_eigen_solver_8h_source_l00091}\hyperlink{group___eigenvalues___module_a5aa3d1390c2b0d455c1c9b8b3101b119}{00091}     \textcolor{keyword}{typedef} 
      \hyperlink{group___core___module}{Matrix<Scalar, ColsAtCompileTime, 1, Options & ~RowMajor, MaxColsAtCompileTime, 1>}
       \hyperlink{group___eigenvalues___module_a5aa3d1390c2b0d455c1c9b8b3101b119}{VectorType};
00092 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_generalized_eigen_solver_8h_source_l00098}\hyperlink{group___eigenvalues___module_acfd144329aca76882069da2fc5d53ef5}{00098}     \textcolor{keyword}{typedef} 
      \hyperlink{group___core___module}{Matrix<ComplexScalar, ColsAtCompileTime, 1, Options & ~RowMajor, MaxColsAtCompileTime, 1>}
       \hyperlink{group___eigenvalues___module_acfd144329aca76882069da2fc5d53ef5}{ComplexVectorType};
00099 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_generalized_eigen_solver_8h_source_l00102}\hyperlink{group___eigenvalues___module_ad59af178acc401f1bc4e330ef80f286d}{00102}     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_cwise_binary_op}{CwiseBinaryOp<internal::scalar\_quotient\_op<ComplexScalar,Scalar>}
      ,\hyperlink{group___eigenvalues___module_acfd144329aca76882069da2fc5d53ef5}{ComplexVectorType},VectorType> \hyperlink{group___eigenvalues___module_ad59af178acc401f1bc4e330ef80f286d}{EigenvalueType};
00103 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_generalized_eigen_solver_8h_source_l00109}\hyperlink{group___eigenvalues___module_afffec018dbb2d87b4c09b6acecbb79cd}{00109}     \textcolor{keyword}{typedef} 
      \hyperlink{group___core___module}{Matrix<ComplexScalar, RowsAtCompileTime, ColsAtCompileTime, Options, MaxRowsAtCompileTime,
       MaxColsAtCompileTime>}
       \hyperlink{group___eigenvalues___module_afffec018dbb2d87b4c09b6acecbb79cd}{EigenvectorsType};
00110 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_generalized_eigen_solver_8h_source_l00118}\hyperlink{group___eigenvalues___module_ae745f39da43f9df192cc2875d82b4cf1}{00118}     \hyperlink{group___eigenvalues___module_ae745f39da43f9df192cc2875d82b4cf1}{GeneralizedEigenSolver}()
00119       : m\_eivec(),
00120         m\_alphas(),
00121         m\_betas(),
00122         m\_valuesOkay(false),
00123         m\_vectorsOkay(false),
00124         m\_realQZ()
00125     \{\}
00126 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_generalized_eigen_solver_8h_source_l00133}\hyperlink{group___eigenvalues___module_aab6423ded30275cd4cdd31758c278694}{00133}     \textcolor{keyword}{explicit} \hyperlink{group___eigenvalues___module_aab6423ded30275cd4cdd31758c278694}{GeneralizedEigenSolver}(Index size)
00134       : m\_eivec(size, size),
00135         m\_alphas(size),
00136         m\_betas(size),
00137         m\_valuesOkay(false),
00138         m\_vectorsOkay(false),
00139         m\_realQZ(size),
00140         m\_tmp(size)
00141     \{\}
00142 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_generalized_eigen_solver_8h_source_l00155}\hyperlink{group___eigenvalues___module_a2a3528cbf75f66d3a60af9dc7b12ff65}{00155}     \hyperlink{group___eigenvalues___module_a2a3528cbf75f66d3a60af9dc7b12ff65}{GeneralizedEigenSolver}(\textcolor{keyword}{const} MatrixType& \hyperlink{group___core___module_class_eigen_1_1_matrix}{A}, \textcolor{keyword}{const} MatrixType& 
      \hyperlink{group___core___module_class_eigen_1_1_matrix}{B}, \textcolor{keywordtype}{bool} computeEigenvectors = \textcolor{keyword}{true})
00156       : m\_eivec(A.rows(), A.cols()),
00157         m\_alphas(A.cols()),
00158         m\_betas(A.cols()),
00159         m\_valuesOkay(false),
00160         m\_vectorsOkay(false),
00161         m\_realQZ(A.cols()),
00162         m\_tmp(A.cols())
00163     \{
00164       \hyperlink{group___eigenvalues___module_a275910b47dfe5f40211dcb59cfd68f3c}{compute}(A, B, computeEigenvectors);
00165     \}
00166 
00167     \textcolor{comment}{/* \(\backslash\)brief Returns the computed generalized eigenvectors.}
00168 \textcolor{comment}{      *}
00169 \textcolor{comment}{      * \(\backslash\)returns  %Matrix whose columns are the (possibly complex) right eigenvectors.}
00170 \textcolor{comment}{      * i.e. the eigenvectors that solve (A - l*B)x = 0. The ordering matches the eigenvalues.}
00171 \textcolor{comment}{      *}
00172 \textcolor{comment}{      * \(\backslash\)pre Either the constructor }
00173 \textcolor{comment}{      * GeneralizedEigenSolver(const MatrixType&,const MatrixType&, bool) or the member function}
00174 \textcolor{comment}{      * compute(const MatrixType&, const MatrixType& bool) has been called before, and}
00175 \textcolor{comment}{      * \(\backslash\)p computeEigenvectors was set to true (the default).}
00176 \textcolor{comment}{      *}
00177 \textcolor{comment}{      * \(\backslash\)sa eigenvalues()}
00178 \textcolor{comment}{      */}
00179     EigenvectorsType eigenvectors()\textcolor{keyword}{ const }\{
00180       eigen\_assert(m\_vectorsOkay && \textcolor{stringliteral}{"Eigenvectors for GeneralizedEigenSolver were not calculated."});
00181       \textcolor{keywordflow}{return} m\_eivec;
00182     \}
00183 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_generalized_eigen_solver_8h_source_l00202}\hyperlink{group___eigenvalues___module_a62f01cd78271efd5e39bcb24e0fe1a58}{00202}     EigenvalueType \hyperlink{group___eigenvalues___module_a62f01cd78271efd5e39bcb24e0fe1a58}{eigenvalues}()\textcolor{keyword}{ const}
00203 \textcolor{keyword}{    }\{
00204       eigen\_assert(m\_valuesOkay && \textcolor{stringliteral}{"GeneralizedEigenSolver is not initialized."});
00205       \textcolor{keywordflow}{return} \hyperlink{group___eigenvalues___module_ad59af178acc401f1bc4e330ef80f286d}{EigenvalueType}(m\_alphas,m\_betas);
00206     \}
00207 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_generalized_eigen_solver_8h_source_l00213}\hyperlink{group___eigenvalues___module_a82b1bc41267f46e5c5899d5b084a73bb}{00213}     ComplexVectorType \hyperlink{group___eigenvalues___module_a82b1bc41267f46e5c5899d5b084a73bb}{alphas}()\textcolor{keyword}{ const}
00214 \textcolor{keyword}{    }\{
00215       eigen\_assert(m\_valuesOkay && \textcolor{stringliteral}{"GeneralizedEigenSolver is not initialized."});
00216       \textcolor{keywordflow}{return} m\_alphas;
00217     \}
00218 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_generalized_eigen_solver_8h_source_l00224}\hyperlink{group___eigenvalues___module_abeaa6f56cee367b83fd09d428462ca0c}{00224}     VectorType \hyperlink{group___eigenvalues___module_abeaa6f56cee367b83fd09d428462ca0c}{betas}()\textcolor{keyword}{ const}
00225 \textcolor{keyword}{    }\{
00226       eigen\_assert(m\_valuesOkay && \textcolor{stringliteral}{"GeneralizedEigenSolver is not initialized."});
00227       \textcolor{keywordflow}{return} m\_betas;
00228     \}
00229 
00253     \hyperlink{group___eigenvalues___module_class_eigen_1_1_generalized_eigen_solver}{GeneralizedEigenSolver}& \hyperlink{group___eigenvalues___module_a275910b47dfe5f40211dcb59cfd68f3c}{compute}(\textcolor{keyword}{const} MatrixType& 
      \hyperlink{group___core___module_class_eigen_1_1_matrix}{A}, \textcolor{keyword}{const} MatrixType& \hyperlink{group___core___module_class_eigen_1_1_matrix}{B}, \textcolor{keywordtype}{bool} computeEigenvectors = \textcolor{keyword}{true});
00254 
00255     \hyperlink{group__enums_ga85fad7b87587764e5cf6b513a9e0ee5e}{ComputationInfo} info()\textcolor{keyword}{ const}
00256 \textcolor{keyword}{    }\{
00257       eigen\_assert(m\_valuesOkay && \textcolor{stringliteral}{"EigenSolver is not initialized."});
00258       \textcolor{keywordflow}{return} m\_realQZ.\hyperlink{group___eigenvalues___module_a36bd77afed89f3f5c110a715e69e4c64}{info}();
00259     \}
00260 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_generalized_eigen_solver_8h_source_l00263}\hyperlink{group___eigenvalues___module_a2a6f96bd042068cfc0eafba839b424bd}{00263}     \hyperlink{group___eigenvalues___module_class_eigen_1_1_generalized_eigen_solver}{GeneralizedEigenSolver}& \hyperlink{group___eigenvalues___module_a2a6f96bd042068cfc0eafba839b424bd}{setMaxIterations}(Index maxIters)
00264     \{
00265       m\_realQZ.\hyperlink{group___eigenvalues___module_a30ae65666b1757e4a2b6a28eaec12226}{setMaxIterations}(maxIters);
00266       \textcolor{keywordflow}{return} *\textcolor{keyword}{this};
00267     \}
00268 
00269   \textcolor{keyword}{protected}:
00270     
00271     \textcolor{keyword}{static} \textcolor{keywordtype}{void} check\_template\_parameters()
00272     \{
00273       EIGEN\_STATIC\_ASSERT\_NON\_INTEGER(Scalar);
00274       EIGEN\_STATIC\_ASSERT(!\hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<Scalar>::IsComplex}, 
      NUMERIC\_TYPE\_MUST\_BE\_REAL);
00275     \}
00276     
00277     EigenvectorsType m\_eivec;
00278     ComplexVectorType m\_alphas;
00279     VectorType m\_betas;
00280     \textcolor{keywordtype}{bool} m\_valuesOkay, m\_vectorsOkay;
00281     \hyperlink{group___eigenvalues___module}{RealQZ<MatrixType>} m\_realQZ;
00282     ComplexVectorType m\_tmp;
00283 \};
00284 
00285 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>
00286 \hyperlink{group___eigenvalues___module_class_eigen_1_1_generalized_eigen_solver}{GeneralizedEigenSolver<MatrixType>}&
00287 \hyperlink{group___eigenvalues___module_a275910b47dfe5f40211dcb59cfd68f3c}{GeneralizedEigenSolver<MatrixType>::compute}(\textcolor{keyword}{const} 
      \hyperlink{group___eigenvalues___module_a56f4b9823bb9a267de3aaf48428cd247}{MatrixType}& \hyperlink{group___core___module_class_eigen_1_1_matrix}{A}, \textcolor{keyword}{const} \hyperlink{group___eigenvalues___module_a56f4b9823bb9a267de3aaf48428cd247}{MatrixType}& \hyperlink{group___core___module_class_eigen_1_1_matrix}{B}, \textcolor{keywordtype}{bool} computeEigenvectors)
00288 \{
00289   check\_template\_parameters();
00290   
00291   \textcolor{keyword}{using} std::sqrt;
00292   \textcolor{keyword}{using} std::abs;
00293   eigen\_assert(A.cols() == A.rows() && B.cols() == A.rows() && B.cols() == B.rows());
00294   \hyperlink{group___eigenvalues___module_a46a0ff3841059479ec314e56a5645302}{Index} size = A.cols();
00295   m\_valuesOkay = \textcolor{keyword}{false};
00296   m\_vectorsOkay = \textcolor{keyword}{false};
00297   \textcolor{comment}{// Reduce to generalized real Schur form:}
00298   \textcolor{comment}{// A = Q S Z and B = Q T Z}
00299   m\_realQZ.\hyperlink{group___eigenvalues___module_a2b6847964d9f1903193cc3e67c196849}{compute}(A, B, computeEigenvectors);
00300   \textcolor{keywordflow}{if} (m\_realQZ.\hyperlink{group___eigenvalues___module_a36bd77afed89f3f5c110a715e69e4c64}{info}() == \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea52581b035f4b59c203b8ff999ef5fcea}{Success})
00301   \{
00302     \textcolor{comment}{// Resize storage}
00303     m\_alphas.\hyperlink{class_eigen_1_1_plain_object_base_a99d9054ee2d5a40c6e00ded0265e9cea}{resize}(size);
00304     m\_betas.\hyperlink{class_eigen_1_1_plain_object_base_a99d9054ee2d5a40c6e00ded0265e9cea}{resize}(size);
00305     \textcolor{keywordflow}{if} (computeEigenvectors)
00306     \{
00307       m\_eivec.\hyperlink{class_eigen_1_1_plain_object_base_a99d9054ee2d5a40c6e00ded0265e9cea}{resize}(size,size);
00308       m\_tmp.\hyperlink{class_eigen_1_1_plain_object_base_a99d9054ee2d5a40c6e00ded0265e9cea}{resize}(size);
00309     \}
00310 
00311     \textcolor{comment}{// Aliases:}
00312     \hyperlink{group___core___module_class_eigen_1_1_map}{Map<VectorType>} v(reinterpret\_cast<Scalar*>(m\_tmp.\hyperlink{class_eigen_1_1_plain_object_base_ac25699535374b1854cf8494e44ad31b2}{data}()), size);
00313     \hyperlink{group___core___module}{ComplexVectorType} &cv = m\_tmp;
00314     \textcolor{keyword}{const} \hyperlink{group___eigenvalues___module_a56f4b9823bb9a267de3aaf48428cd247}{MatrixType} &mZ = m\_realQZ.\hyperlink{group___eigenvalues___module_a19a116383f11423179b4d8f316da6f67}{matrixZ}();
00315     \textcolor{keyword}{const} \hyperlink{group___eigenvalues___module_a56f4b9823bb9a267de3aaf48428cd247}{MatrixType} &mS = m\_realQZ.\hyperlink{group___eigenvalues___module_ad24d7bf534afb55adaef00f00846adaf}{matrixS}();
00316     \textcolor{keyword}{const} \hyperlink{group___eigenvalues___module_a56f4b9823bb9a267de3aaf48428cd247}{MatrixType} &mT = m\_realQZ.\hyperlink{group___eigenvalues___module_a8dc963d8ea2a17df9d8d718e9e34d06f}{matrixT}();
00317 
00318     \hyperlink{group___eigenvalues___module_a46a0ff3841059479ec314e56a5645302}{Index} i = 0;
00319     \textcolor{keywordflow}{while} (i < size)
00320     \{
00321       \textcolor{keywordflow}{if} (i == size - 1 || mS.coeff(i+1, i) == \hyperlink{group___eigenvalues___module_afb318d0b097ff8dd5a7410d31317ca47}{Scalar}(0))
00322       \{
00323         \textcolor{comment}{// Real eigenvalue}
00324         m\_alphas.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(i) = mS.diagonal().coeff(i);
00325         m\_betas.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(i)  = mT.diagonal().coeff(i);
00326         \textcolor{keywordflow}{if} (computeEigenvectors)
00327         \{
00328           v.setConstant(\hyperlink{group___eigenvalues___module_afb318d0b097ff8dd5a7410d31317ca47}{Scalar}(0.0));
00329           v.coeffRef(i) = \hyperlink{group___eigenvalues___module_afb318d0b097ff8dd5a7410d31317ca47}{Scalar}(1.0);
00330           \textcolor{comment}{// For singular eigenvalues do nothing more}
00331           \textcolor{keywordflow}{if}(abs(m\_betas.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(i)) >= (std::numeric\_limits<RealScalar>::min)())
00332           \{
00333             \textcolor{comment}{// Non-singular eigenvalue}
00334             \textcolor{keyword}{const} \hyperlink{group___eigenvalues___module_afb318d0b097ff8dd5a7410d31317ca47}{Scalar} alpha = real(m\_alphas.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(i));
00335             \textcolor{keyword}{const} \hyperlink{group___eigenvalues___module_afb318d0b097ff8dd5a7410d31317ca47}{Scalar} beta = m\_betas.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(i);
00336             \textcolor{keywordflow}{for} (\hyperlink{group___eigenvalues___module_a46a0ff3841059479ec314e56a5645302}{Index} j = i-1; j >= 0; j--)
00337             \{
00338               \textcolor{keyword}{const} \hyperlink{group___eigenvalues___module_a46a0ff3841059479ec314e56a5645302}{Index} st = j+1;
00339               \textcolor{keyword}{const} \hyperlink{group___eigenvalues___module_a46a0ff3841059479ec314e56a5645302}{Index} sz = i-j;
00340               \textcolor{keywordflow}{if} (j > 0 && mS.coeff(j, j-1) != \hyperlink{group___eigenvalues___module_afb318d0b097ff8dd5a7410d31317ca47}{Scalar}(0))
00341               \{
00342                 \textcolor{comment}{// 2x2 block}
00343                 \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar, 2, 1>} rhs = (alpha*mT.template block<2,Dynamic>(j-1,st,2
      ,sz) - beta*mS.template block<2,Dynamic>(j-1,st,2,sz)) .lazyProduct( v.segment(st,sz) );
00344                 \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar, 2, 2>} lhs = beta * mS.template block<2,2>(j-1,j-1) - 
      alpha * mT.template block<2,2>(j-1,j-1);
00345                 v.template segment<2>(j-1) = lhs.partialPivLu().solve(rhs);
00346                 j--;
00347               \}
00348               \textcolor{keywordflow}{else}
00349               \{
00350                 v.coeffRef(j) = -v.segment(st,sz).transpose().cwiseProduct(beta*mS.block(j,st,1,sz) - alpha
      *mT.block(j,st,1,sz)).sum() / (beta*mS.coeffRef(j,j) - alpha*mT.coeffRef(j,j));
00351               \}
00352             \}
00353           \}
00354           m\_eivec.col(i).real().noalias() = mZ.transpose() * v;
00355           m\_eivec.col(i).real().normalize();
00356           m\_eivec.col(i).imag().\hyperlink{class_eigen_1_1_plain_object_base_ac8dea1df3d92b752cc683ff42abf6f9b}{setConstant}(0);
00357         \}
00358         ++i;
00359       \}
00360       \textcolor{keywordflow}{else}
00361       \{
00362         \textcolor{comment}{// We need to extract the generalized eigenvalues of the pair of a general 2x2 block S and a
       positive diagonal 2x2 block T}
00363         \textcolor{comment}{// Then taking beta=T\_00*T\_11, we can avoid any division, and alpha is the eigenvalues of A = (U^-1
       * S * U) * diag(T\_11,T\_00):}
00364 
00365         \textcolor{comment}{// T =  [a 0]}
00366         \textcolor{comment}{//      [0 b]}
00367         RealScalar a = mT.diagonal().coeff(i),
00368                    b = mT.diagonal().coeff(i+1);
00369         \textcolor{keyword}{const} RealScalar beta = m\_betas.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(i) = m\_betas.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(i+1) = a*b;
00370 
00371         \textcolor{comment}{// ^^ NOTE: using diagonal()(i) instead of coeff(i,i) workarounds a MSVC bug.}
00372         \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<RealScalar,2,2>} S2 = mS.template block<2,2>(i,i) * 
      \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,2,1>}(b,a).asDiagonal();
00373 
00374         \hyperlink{group___eigenvalues___module_afb318d0b097ff8dd5a7410d31317ca47}{Scalar} p = \hyperlink{group___eigenvalues___module_afb318d0b097ff8dd5a7410d31317ca47}{Scalar}(0.5) * (S2.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(0,0) - S2.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(1,1));
00375         \hyperlink{group___eigenvalues___module_afb318d0b097ff8dd5a7410d31317ca47}{Scalar} z = sqrt(abs(p * p + S2.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(1,0) * S2.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(0,1)));
00376         \textcolor{keyword}{const} \hyperlink{group___eigenvalues___module_abdec07af91db1345bb4c74066e3d0ea7}{ComplexScalar} alpha = \hyperlink{group___eigenvalues___module_abdec07af91db1345bb4c74066e3d0ea7}{ComplexScalar}(S2.
      \hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(1,1) + p, (beta > 0) ? z : -z);
00377         m\_alphas.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(i)   = conj(alpha);
00378         m\_alphas.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(i+1) = alpha;
00379 
00380         \textcolor{keywordflow}{if} (computeEigenvectors) \{
00381           \textcolor{comment}{// Compute eigenvector in position (i+1) and then position (i) is just the conjugate}
00382           cv.\hyperlink{class_eigen_1_1_plain_object_base_ac21ad5f989f320e46958b75ac8d9a1da}{setZero}();
00383           cv.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(i+1) = \hyperlink{group___eigenvalues___module_afb318d0b097ff8dd5a7410d31317ca47}{Scalar}(1.0);
00384           \textcolor{comment}{// here, the "static\_cast" workaound expression template issues.}
00385           cv.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(i) = -(\textcolor{keyword}{static\_cast<}\hyperlink{group___eigenvalues___module_afb318d0b097ff8dd5a7410d31317ca47}{Scalar}\textcolor{keyword}{>}(beta*mS.coeffRef(i,i+1)) - alpha*mT.coeffRef
      (i,i+1))
00386                           / (static\_cast<Scalar>(beta*mS.coeffRef(i,i))   - alpha*mT.coeffRef(i,i));
00387           \textcolor{keywordflow}{for} (\hyperlink{group___eigenvalues___module_a46a0ff3841059479ec314e56a5645302}{Index} j = i-1; j >= 0; j--)
00388           \{
00389             \textcolor{keyword}{const} \hyperlink{group___eigenvalues___module_a46a0ff3841059479ec314e56a5645302}{Index} st = j+1;
00390             \textcolor{keyword}{const} \hyperlink{group___eigenvalues___module_a46a0ff3841059479ec314e56a5645302}{Index} sz = i+1-j;
00391             \textcolor{keywordflow}{if} (j > 0 && mS.coeff(j, j-1) != \hyperlink{group___eigenvalues___module_afb318d0b097ff8dd5a7410d31317ca47}{Scalar}(0))
00392             \{
00393               \textcolor{comment}{// 2x2 block}
00394               \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<ComplexScalar, 2, 1>} rhs = (alpha*mT.template 
      block<2,Dynamic>(j-1,st,2,sz) - beta*mS.template block<2,Dynamic>(j-1,st,2,sz)) .lazyProduct( cv.segment(st,sz) );
00395               \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<ComplexScalar, 2, 2>} lhs = beta * mS.template block<2,2>(j-
      1,j-1) - alpha * mT.template block<2,2>(j-1,j-1);
00396               cv.template segment<2>(j-1) = lhs.partialPivLu().solve(rhs);
00397               j--;
00398             \} \textcolor{keywordflow}{else} \{
00399               cv.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(j) =  cv.segment(st,sz).transpose().cwiseProduct(beta*mS.block(j,st,1,sz)
       - alpha*mT.block(j,st,1,sz)).sum()
00400                               / (alpha*mT.coeffRef(j,j) - \textcolor{keyword}{static\_cast<}\hyperlink{group___eigenvalues___module_afb318d0b097ff8dd5a7410d31317ca47}{Scalar}\textcolor{keyword}{>}(beta*mS.coeffRef(j,j)))
      ;
00401             \}
00402           \}
00403           m\_eivec.col(i+1).noalias() = (mZ.transpose() * cv);
00404           m\_eivec.col(i+1).normalize();
00405           m\_eivec.col(i) = m\_eivec.col(i+1).conjugate();
00406         \}
00407         i += 2;
00408       \}
00409     \}
00410 
00411     m\_valuesOkay = \textcolor{keyword}{true};
00412     m\_vectorsOkay = computeEigenvectors;
00413   \}
00414   \textcolor{keywordflow}{return} *\textcolor{keyword}{this};
00415 \}
00416 
00417 \} \textcolor{comment}{// end namespace Eigen}
00418 
00419 \textcolor{preprocessor}{#endif // EIGEN\_GENERALIZEDEIGENSOLVER\_H}
\end{DoxyCode}
