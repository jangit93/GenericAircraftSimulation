\hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2test_2matrix__exponential_8cpp_source}{}\section{matio/visual\+\_\+studio/test/eigen/unsupported/test/matrix\+\_\+exponential.cpp}
\label{matio_2visual__studio_2test_2eigen_2unsupported_2test_2matrix__exponential_8cpp_source}\index{matrix\+\_\+exponential.\+cpp@{matrix\+\_\+exponential.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2009 Jitse Niesen <jitse@maths.leeds.ac.uk>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#include "matrix\_functions.h"}
00011 
00012 \textcolor{keywordtype}{double} binom(\textcolor{keywordtype}{int} n, \textcolor{keywordtype}{int} k)
00013 \{
00014   \textcolor{keywordtype}{double} res = 1;
00015   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0; i<k; i++)
00016     res = res * (n-k+i+1) / (i+1);
00017   \textcolor{keywordflow}{return} res;
00018 \}
00019 
00020 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>
00021 \hyperlink{group___sparse_core___module_class_eigen_1_1_triplet}{T} expfn(\hyperlink{group___sparse_core___module_class_eigen_1_1_triplet}{T} x, \textcolor{keywordtype}{int})
00022 \{
00023   \textcolor{keywordflow}{return} std::exp(x);
00024 \}
00025 
00026 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>
00027 \textcolor{keywordtype}{void} test2dRotation(\textcolor{keywordtype}{double} tol)
00028 \{
00029   Matrix<T,2,2> A, B, C;
00030   \hyperlink{group___sparse_core___module_class_eigen_1_1_triplet}{T} angle;
00031 
00032   A << 0, 1, -1, 0;
00033   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0; i<=20; i++)
00034   \{
00035     angle = \textcolor{keyword}{static\_cast<}\hyperlink{group___sparse_core___module_class_eigen_1_1_triplet}{T}\textcolor{keyword}{>}(\hyperlink{group___core___module_ab6dc101d82e8228a19a8840e3a29c1c9}{pow}(10, i / 5. - 2));
00036     B << std::cos(angle), std::sin(angle), -std::sin(angle), std::cos(angle);
00037 
00038     C = (angle*A).matrixFunction(expfn);
00039     std::cout << \textcolor{stringliteral}{"test2dRotation: i = "} << i << \textcolor{stringliteral}{"   error funm = "} << relerr(C, B);
00040     VERIFY(C.isApprox(B, static\_cast<T>(tol)));
00041 
00042     C = (angle*A).exp();
00043     std::cout << \textcolor{stringliteral}{"   error expm = "} << relerr(C, B) << \textcolor{stringliteral}{"\(\backslash\)n"};
00044     VERIFY(C.isApprox(B, static\_cast<T>(tol)));
00045   \}
00046 \}
00047 
00048 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>
00049 \textcolor{keywordtype}{void} test2dHyperbolicRotation(\textcolor{keywordtype}{double} tol)
00050 \{
00051   Matrix<std::complex<T>,2,2> A, B, C;
00052   std::complex<T> imagUnit(0,1);
00053   \hyperlink{group___sparse_core___module_class_eigen_1_1_triplet}{T} angle, ch, sh;
00054 
00055   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0; i<=20; i++)
00056   \{
00057     angle = \textcolor{keyword}{static\_cast<}\hyperlink{group___sparse_core___module_class_eigen_1_1_triplet}{T}\textcolor{keyword}{>}((i-10) / 2.0);
00058     ch = std::cosh(angle);
00059     sh = std::sinh(angle);
00060     A << 0, angle*imagUnit, -angle*imagUnit, 0;
00061     B << ch, sh*imagUnit, -sh*imagUnit, ch;
00062 
00063     C = A.matrixFunction(expfn);
00064     std::cout << \textcolor{stringliteral}{"test2dHyperbolicRotation: i = "} << i << \textcolor{stringliteral}{"   error funm = "} << relerr(C, B);
00065     VERIFY(C.isApprox(B, static\_cast<T>(tol)));
00066 
00067     C = A.exp();
00068     std::cout << \textcolor{stringliteral}{"   error expm = "} << relerr(C, B) << \textcolor{stringliteral}{"\(\backslash\)n"};
00069     VERIFY(C.isApprox(B, static\_cast<T>(tol)));
00070   \}
00071 \}
00072 
00073 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>
00074 \textcolor{keywordtype}{void} testPascal(\textcolor{keywordtype}{double} tol)
00075 \{
00076   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} size=1; size<20; size++)
00077   \{
00078     Matrix<T,Dynamic,Dynamic> A(size,size), B(size,size), C(size,size);
00079     A.setZero();
00080     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0; i<size-1; i++)
00081       A(i+1,i) = \textcolor{keyword}{static\_cast<}\hyperlink{group___sparse_core___module_class_eigen_1_1_triplet}{T}\textcolor{keyword}{>}(i+1);
00082     B.setZero();
00083     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0; i<size; i++)
00084       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j=0; j<=i; j++)
00085     B(i,j) = \textcolor{keyword}{static\_cast<}\hyperlink{group___sparse_core___module_class_eigen_1_1_triplet}{T}\textcolor{keyword}{>}(binom(i,j));
00086 
00087     C = A.matrixFunction(expfn);
00088     std::cout << \textcolor{stringliteral}{"testPascal: size = "} << size << \textcolor{stringliteral}{"   error funm = "} << relerr(C, B);
00089     VERIFY(C.isApprox(B, static\_cast<T>(tol)));
00090 
00091     C = A.exp();
00092     std::cout << \textcolor{stringliteral}{"   error expm = "} << relerr(C, B) << \textcolor{stringliteral}{"\(\backslash\)n"};
00093     VERIFY(C.isApprox(B, static\_cast<T>(tol)));
00094   \}
00095 \}
00096 
00097 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>
00098 \textcolor{keywordtype}{void} randomTest(\textcolor{keyword}{const} MatrixType& m, \textcolor{keywordtype}{double} tol)
00099 \{
00100   \textcolor{comment}{/* this test covers the following files:}
00101 \textcolor{comment}{     Inverse.h}
00102 \textcolor{comment}{  */}
00103   \textcolor{keyword}{typename} MatrixType::Index rows = m.rows();
00104   \textcolor{keyword}{typename} MatrixType::Index cols = m.cols();
00105   MatrixType m1(rows, cols), m2(rows, cols), identity = MatrixType::Identity(rows, cols);
00106 
00107   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} NumTraits<typename internal::traits<MatrixType>::Scalar>::Real RealScalar;
00108 
00109   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 0; i < g\_repeat; i++) \{
00110     m1 = MatrixType::Random(rows, cols);
00111 
00112     m2 = m1.matrixFunction(expfn) * (-m1).matrixFunction(expfn);
00113     std::cout << \textcolor{stringliteral}{"randomTest: error funm = "} << relerr(identity, m2);
00114     VERIFY(identity.isApprox(m2, static\_cast<RealScalar>(tol)));
00115 
00116     m2 = m1.exp() * (-m1).exp();
00117     std::cout << \textcolor{stringliteral}{"   error expm = "} << relerr(identity, m2) << \textcolor{stringliteral}{"\(\backslash\)n"};
00118     VERIFY(identity.isApprox(m2, static\_cast<RealScalar>(tol)));
00119   \}
00120 \}
00121 
00122 \textcolor{keywordtype}{void} test\_matrix\_exponential()
00123 \{
00124   CALL\_SUBTEST\_2(test2dRotation<double>(1e-13));
00125   CALL\_SUBTEST\_1(test2dRotation<float>(2e-5));  \textcolor{comment}{// was 1e-5, relaxed for clang 2.8 / linux / x86-64}
00126   CALL\_SUBTEST\_8(test2dRotation<long double>(1e-13)); 
00127   CALL\_SUBTEST\_2(test2dHyperbolicRotation<double>(1e-14));
00128   CALL\_SUBTEST\_1(test2dHyperbolicRotation<float>(1e-5));
00129   CALL\_SUBTEST\_8(test2dHyperbolicRotation<long double>(1e-14));
00130   CALL\_SUBTEST\_6(testPascal<float>(1e-6));
00131   CALL\_SUBTEST\_5(testPascal<double>(1e-15));
00132   CALL\_SUBTEST\_2(randomTest(Matrix2d(), 1e-13));
00133   CALL\_SUBTEST\_7(randomTest(Matrix<double,3,3,RowMajor>(), 1e-13));
00134   CALL\_SUBTEST\_3(randomTest(Matrix4cd(), 1e-13));
00135   CALL\_SUBTEST\_4(randomTest(MatrixXd(8,8), 1e-13));
00136   CALL\_SUBTEST\_1(randomTest(Matrix2f(), 1e-4));
00137   CALL\_SUBTEST\_5(randomTest(Matrix3cf(), 1e-4));
00138   CALL\_SUBTEST\_1(randomTest(Matrix4f(), 1e-4));
00139   CALL\_SUBTEST\_6(randomTest(MatrixXf(8,8), 1e-4));
00140   CALL\_SUBTEST\_9(randomTest(Matrix<long double,Dynamic,Dynamic>(7,7), 1e-13));
00141 \}
\end{DoxyCode}
