\hypertarget{eigen_2test_2jacobisvd_8cpp_source}{}\section{eigen/test/jacobisvd.cpp}
\label{eigen_2test_2jacobisvd_8cpp_source}\index{jacobisvd.\+cpp@{jacobisvd.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2008-2014 Gael Guennebaud <gael.guennebaud@inria.fr>}
00005 \textcolor{comment}{// Copyright (C) 2009 Benoit Jacob <jacob.benoit.1@gmail.com>}
00006 \textcolor{comment}{//}
00007 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00008 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00009 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00010 
00011 \textcolor{comment}{// discard stack allocation as that too bypasses malloc}
00012 \textcolor{preprocessor}{#define EIGEN\_STACK\_ALLOCATION\_LIMIT 0}
00013 \textcolor{preprocessor}{#define EIGEN\_RUNTIME\_NO\_MALLOC}
00014 \textcolor{preprocessor}{#include "main.h"}
00015 \textcolor{preprocessor}{#include <Eigen/SVD>}
00016 
00017 \textcolor{preprocessor}{#define SVD\_DEFAULT(M) JacobiSVD<M>}
00018 \textcolor{preprocessor}{#define SVD\_FOR\_MIN\_NORM(M) JacobiSVD<M,ColPivHouseholderQRPreconditioner>}
00019 \textcolor{preprocessor}{#include "svd\_common.h"}
00020 
00021 \textcolor{comment}{// Check all variants of JacobiSVD}
00022 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>
00023 \textcolor{keywordtype}{void} jacobisvd(\textcolor{keyword}{const} MatrixType& a = MatrixType(), \textcolor{keywordtype}{bool} pickrandom = \textcolor{keyword}{true})
00024 \{
00025   MatrixType m = a;
00026   \textcolor{keywordflow}{if}(pickrandom)
00027     svd\_fill\_random(m);
00028 
00029   CALL\_SUBTEST(( svd\_test\_all\_computation\_options<
      \hyperlink{group___s_v_d___module_class_eigen_1_1_jacobi_s_v_d}{JacobiSVD<MatrixType, FullPivHouseholderQRPreconditioner>}
       >(m, \textcolor{keyword}{true})  )); \textcolor{comment}{// check full only}
00030   CALL\_SUBTEST(( svd\_test\_all\_computation\_options<
      \hyperlink{group___s_v_d___module_class_eigen_1_1_jacobi_s_v_d}{JacobiSVD<MatrixType, ColPivHouseholderQRPreconditioner>}
        >(m, \textcolor{keyword}{false}) ));
00031   CALL\_SUBTEST(( svd\_test\_all\_computation\_options<
      \hyperlink{group___s_v_d___module_class_eigen_1_1_jacobi_s_v_d}{JacobiSVD<MatrixType, HouseholderQRPreconditioner>}       
       >(m, \textcolor{keyword}{false}) ));
00032   \textcolor{keywordflow}{if}(m.rows()==m.cols())
00033     CALL\_SUBTEST(( svd\_test\_all\_computation\_options<
      \hyperlink{group___s_v_d___module_class_eigen_1_1_jacobi_s_v_d}{JacobiSVD<MatrixType, NoQRPreconditioner>}               >(m, \textcolor{keyword}{false}
      ) ));
00034 \}
00035 
00036 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType> \textcolor{keywordtype}{void} jacobisvd\_verify\_assert(\textcolor{keyword}{const} MatrixType& m)
00037 \{
00038   svd\_verify\_assert<JacobiSVD<MatrixType> >(m);
00039   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::Index \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index};
00040   Index rows = m.rows();
00041   Index cols = m.cols();
00042 
00043   \textcolor{keyword}{enum} \{
00044     ColsAtCompileTime = MatrixType::ColsAtCompileTime
00045   \};
00046 
00047 
00048   MatrixType a = MatrixType::Zero(rows, cols);
00049   a.setZero();
00050 
00051   \textcolor{keywordflow}{if} (ColsAtCompileTime == Dynamic)
00052   \{
00053     \hyperlink{group___s_v_d___module_class_eigen_1_1_jacobi_s_v_d}{JacobiSVD<MatrixType, FullPivHouseholderQRPreconditioner>}
       svd\_fullqr;
00054     VERIFY\_RAISES\_ASSERT(svd\_fullqr.\hyperlink{group___s_v_d___module_a5dab376cc86cf0d36674bcdad4af3f5a}{compute}(a, \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a2b4f91ca5859a4159dbfe8090043817f}{ComputeFullU}|
      \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a1055e53fa95c8ae04a07ebb72cfafd95}{ComputeThinV}))
00055     VERIFY\_RAISES\_ASSERT(svd\_fullqr.\hyperlink{group___s_v_d___module_a5dab376cc86cf0d36674bcdad4af3f5a}{compute}(a, \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9af8c742a1aa87773e165eae406c9ccaf8}{ComputeThinU}|
      \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a1055e53fa95c8ae04a07ebb72cfafd95}{ComputeThinV}))
00056     VERIFY\_RAISES\_ASSERT(svd\_fullqr.\hyperlink{group___s_v_d___module_a5dab376cc86cf0d36674bcdad4af3f5a}{compute}(a, \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9af8c742a1aa87773e165eae406c9ccaf8}{ComputeThinU}|
      \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a52c6f7e80bbf9a42297c88f700245b51}{ComputeFullV}))
00057   \}
00058 \}
00059 
00060 template<typename MatrixType>
00061 \textcolor{keywordtype}{void} jacobisvd\_method()
00062 \{
00063   \textcolor{keyword}{enum} \{ Size = MatrixType::RowsAtCompileTime \};
00064   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::RealScalar RealScalar;
00065   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<RealScalar, Size, 1>} RealVecType;
00066   MatrixType m = MatrixType::Identity();
00067   VERIFY\_IS\_APPROX(m.jacobiSvd().singularValues(), RealVecType::Ones());
00068   VERIFY\_RAISES\_ASSERT(m.jacobiSvd().matrixU());
00069   VERIFY\_RAISES\_ASSERT(m.jacobiSvd().matrixV());
00070   VERIFY\_IS\_APPROX(m.jacobiSvd(\hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a2b4f91ca5859a4159dbfe8090043817f}{ComputeFullU}|\hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a52c6f7e80bbf9a42297c88f700245b51}{ComputeFullV}).solve(m), m);
00071 \}
00072 
00073 \textcolor{keywordtype}{void} test\_jacobisvd()
00074 \{
00075   CALL\_SUBTEST\_3(( jacobisvd\_verify\_assert(Matrix3f()) ));
00076   CALL\_SUBTEST\_4(( jacobisvd\_verify\_assert(Matrix4d()) ));
00077   CALL\_SUBTEST\_7(( jacobisvd\_verify\_assert(MatrixXf(10,12)) ));
00078   CALL\_SUBTEST\_8(( jacobisvd\_verify\_assert(MatrixXcd(7,5)) ));
00079   
00080   CALL\_SUBTEST\_11(svd\_all\_trivial\_2x2(jacobisvd<Matrix2cd>));
00081   CALL\_SUBTEST\_12(svd\_all\_trivial\_2x2(jacobisvd<Matrix2d>));
00082 
00083   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 0; i < g\_repeat; i++) \{
00084     CALL\_SUBTEST\_3(( jacobisvd<Matrix3f>() ));
00085     CALL\_SUBTEST\_4(( jacobisvd<Matrix4d>() ));
00086     CALL\_SUBTEST\_5(( jacobisvd<\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<float,3,5>} >() ));
00087     CALL\_SUBTEST\_6(( jacobisvd<\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<double,Dynamic,2>} >(
      \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<double,Dynamic,2>}(10,2)) ));
00088 
00089     \textcolor{keywordtype}{int} r = internal::random<int>(1, 30),
00090         c = internal::random<int>(1, 30);
00091     
00092     TEST\_SET\_BUT\_UNUSED\_VARIABLE(r)
00093     TEST\_SET\_BUT\_UNUSED\_VARIABLE(c)
00094     
00095     CALL\_SUBTEST\_10(( jacobisvd<MatrixXd>(MatrixXd(r,c)) ));
00096     CALL\_SUBTEST\_7(( jacobisvd<MatrixXf>(MatrixXf(r,c)) ));
00097     CALL\_SUBTEST\_8(( jacobisvd<MatrixXcd>(MatrixXcd(r,c)) ));
00098     (void) r;
00099     (void) c;
00100 
00101     \textcolor{comment}{// Test on inf/nan matrix}
00102     CALL\_SUBTEST\_7(  (svd\_inf\_nan<\hyperlink{group___s_v_d___module_class_eigen_1_1_jacobi_s_v_d}{JacobiSVD<MatrixXf>}, MatrixXf>()) );
00103     CALL\_SUBTEST\_10( (svd\_inf\_nan<\hyperlink{group___s_v_d___module_class_eigen_1_1_jacobi_s_v_d}{JacobiSVD<MatrixXd>}, MatrixXd>()) );
00104 
00105     \textcolor{comment}{// bug1395 test compile-time vectors as input}
00106     CALL\_SUBTEST\_13(( jacobisvd\_verify\_assert(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<double,6,1>}()) ));
00107     CALL\_SUBTEST\_13(( jacobisvd\_verify\_assert(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<double,1,6>}()) ));
00108     CALL\_SUBTEST\_13(( jacobisvd\_verify\_assert(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<double,Dynamic,1>}(r)) ));
00109     CALL\_SUBTEST\_13(( jacobisvd\_verify\_assert(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<double,1,Dynamic>}(c)) ));
00110   \}
00111 
00112   CALL\_SUBTEST\_7(( jacobisvd<MatrixXf>(MatrixXf(internal::random<int>(EIGEN\_TEST\_MAX\_SIZE/4, 
      EIGEN\_TEST\_MAX\_SIZE/2), internal::random<int>(EIGEN\_TEST\_MAX\_SIZE/4, EIGEN\_TEST\_MAX\_SIZE/2))) ));
00113   CALL\_SUBTEST\_8(( jacobisvd<MatrixXcd>(MatrixXcd(internal::random<int>(EIGEN\_TEST\_MAX\_SIZE/4, 
      EIGEN\_TEST\_MAX\_SIZE/3), internal::random<int>(EIGEN\_TEST\_MAX\_SIZE/4, EIGEN\_TEST\_MAX\_SIZE/3))) ));
00114 
00115   \textcolor{comment}{// test matrixbase method}
00116   CALL\_SUBTEST\_1(( jacobisvd\_method<Matrix2cd>() ));
00117   CALL\_SUBTEST\_3(( jacobisvd\_method<Matrix3f>() ));
00118 
00119   \textcolor{comment}{// Test problem size constructors}
00120   CALL\_SUBTEST\_7( \hyperlink{group___s_v_d___module_class_eigen_1_1_jacobi_s_v_d}{JacobiSVD<MatrixXf>}(10,10) );
00121 
00122   \textcolor{comment}{// Check that preallocation avoids subsequent mallocs}
00123   CALL\_SUBTEST\_9( svd\_preallocate<void>() );
00124 
00125   CALL\_SUBTEST\_2( svd\_underoverflow<void>() );
00126 \}
\end{DoxyCode}
