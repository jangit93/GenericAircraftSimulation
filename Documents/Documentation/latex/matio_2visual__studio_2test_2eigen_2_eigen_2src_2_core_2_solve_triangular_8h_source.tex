\hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_core_2_solve_triangular_8h_source}{}\section{matio/visual\+\_\+studio/test/eigen/\+Eigen/src/\+Core/\+Solve\+Triangular.h}
\label{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_core_2_solve_triangular_8h_source}\index{Solve\+Triangular.\+h@{Solve\+Triangular.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2008-2009 Gael Guennebaud <gael.guennebaud@inria.fr>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#ifndef EIGEN\_SOLVETRIANGULAR\_H}
00011 \textcolor{preprocessor}{#define EIGEN\_SOLVETRIANGULAR\_H}
00012 
00013 \textcolor{keyword}{namespace }\hyperlink{namespace_eigen}{Eigen} \{ 
00014 
00015 \textcolor{keyword}{namespace }\hyperlink{namespaceinternal}{internal} \{
00016 
00017 \textcolor{comment}{// Forward declarations:}
00018 \textcolor{comment}{// The following two routines are implemented in the products/TriangularSolver*.h files}
00019 \textcolor{keyword}{template}<\textcolor{keyword}{typename} LhsScalar, \textcolor{keyword}{typename} RhsScalar, \textcolor{keyword}{typename} Index, \textcolor{keywordtype}{int} S\textcolor{keywordtype}{id}e, \textcolor{keywordtype}{int} Mode, \textcolor{keywordtype}{bool} Conjugate, \textcolor{keywordtype}{int} St
      orageOrder>
00020 \textcolor{keyword}{struct }triangular\_solve\_vector;
00021 
00022 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Scalar, \textcolor{keyword}{typename} Index, \textcolor{keywordtype}{int} S\textcolor{keywordtype}{id}e, \textcolor{keywordtype}{int} Mode, \textcolor{keywordtype}{bool} Conjugate, \textcolor{keywordtype}{int} TriStorageOrder, \textcolor{keywordtype}{int} Oth
      erStorageOrder>
00023 \textcolor{keyword}{struct }triangular\_solve\_matrix;
00024 
00025 \textcolor{comment}{// small helper struct extracting some traits on the underlying solver operation}
00026 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Lhs, \textcolor{keyword}{typename} Rhs, \textcolor{keywordtype}{int} S\textcolor{keywordtype}{id}e>
00027 \textcolor{keyword}{class }trsolve\_traits
00028 \{
00029   \textcolor{keyword}{private}:
00030     \textcolor{keyword}{enum} \{
00031       RhsIsVectorAtCompileTime = (Side==\hyperlink{group__enums_ggac22de43beeac7a78b384f99bed5cee0ba129609b3bdf23b071f5f86cf2f995ec4}{OnTheLeft} ? Rhs::ColsAtCompileTime : 
      Rhs::RowsAtCompileTime)==1
00032     \};
00033   \textcolor{keyword}{public}:
00034     \textcolor{keyword}{enum} \{
00035       Unrolling   = (RhsIsVectorAtCompileTime && Rhs::SizeAtCompileTime != 
      \hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Dynamic} && Rhs::SizeAtCompileTime <= 8)
00036                   ? CompleteUnrolling : NoUnrolling,
00037       RhsVectors  = RhsIsVectorAtCompileTime ? 1 : \hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Dynamic}
00038     \};
00039 \};
00040 
00041 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Lhs, \textcolor{keyword}{typename} Rhs,
00042   \textcolor{keywordtype}{int} Side, \textcolor{comment}{// can be OnTheLeft/OnTheRight}
00043   \textcolor{keywordtype}{int} Mode, \textcolor{comment}{// can be Upper/Lower | UnitDiag}
00044   \textcolor{keywordtype}{int} Unrolling = trsolve\_traits<Lhs,Rhs,Side>::Unrolling,
00045   \textcolor{keywordtype}{int} RhsVectors = trsolve\_traits<Lhs,Rhs,Side>::RhsVectors
00046   >
00047 \textcolor{keyword}{struct }triangular\_solver\_selector;
00048 
00049 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Lhs, \textcolor{keyword}{typename} Rhs, \textcolor{keywordtype}{int} S\textcolor{keywordtype}{id}e, \textcolor{keywordtype}{int} Mode>
00050 \textcolor{keyword}{struct }triangular\_solver\_selector<Lhs,Rhs,Side,Mode,NoUnrolling,1>
00051 \{
00052   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Lhs::Scalar LhsScalar;
00053   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Rhs::Scalar RhsScalar;
00054   \textcolor{keyword}{typedef} blas\_traits<Lhs> LhsProductTraits;
00055   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} LhsProductTraits::ExtractType ActualLhsType;
00056   \textcolor{keyword}{typedef} Map<Matrix<RhsScalar,Dynamic,1>, \hyperlink{group__enums_gga45fe06e29902b7a2773de05ba27b47a1ad37d4c71425bb286e9b4103830538fbf}{Aligned}> MappedRhs;
00057   \textcolor{keyword}{static} \textcolor{keywordtype}{void} run(\textcolor{keyword}{const} Lhs& lhs, Rhs& rhs)
00058   \{
00059     ActualLhsType actualLhs = LhsProductTraits::extract(lhs);
00060 
00061     \textcolor{comment}{// FIXME find a way to allow an inner stride if packet\_traits<Scalar>::size==1}
00062 
00063     \textcolor{keywordtype}{bool} useRhsDirectly = Rhs::InnerStrideAtCompileTime==1 || rhs.innerStride()==1;
00064 
00065     ei\_declare\_aligned\_stack\_constructed\_variable(RhsScalar,actualRhs,rhs.size(),
00066                                                   (useRhsDirectly ? rhs.data() : 0));
00067                                                   
00068     \textcolor{keywordflow}{if}(!useRhsDirectly)
00069       MappedRhs(actualRhs,rhs.size()) = rhs;
00070 
00071     triangular\_solve\_vector<LhsScalar, RhsScalar, \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}, Side, Mode, LhsProductTraits::NeedToConjugate
      ,
00072                             (int(Lhs::Flags) & \hyperlink{group__flags_gae4f56c2a60bbe4bd2e44c5b19cbe8762}{RowMajorBit}) ? 
      \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13acfcde9cd8677c5f7caf6bd603666aae3}{RowMajor} : \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor}>
00073       ::run(actualLhs.cols(), actualLhs.data(), actualLhs.outerStride(), actualRhs);
00074 
00075     \textcolor{keywordflow}{if}(!useRhsDirectly)
00076       rhs = MappedRhs(actualRhs, rhs.size());
00077   \}
00078 \};
00079 
00080 \textcolor{comment}{// the rhs is a matrix}
00081 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Lhs, \textcolor{keyword}{typename} Rhs, \textcolor{keywordtype}{int} S\textcolor{keywordtype}{id}e, \textcolor{keywordtype}{int} Mode>
00082 \textcolor{keyword}{struct }triangular\_solver\_selector<Lhs,Rhs,Side,Mode,NoUnrolling,\hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Dynamic}>
00083 \{
00084   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Rhs::Scalar Scalar;
00085   \textcolor{keyword}{typedef} blas\_traits<Lhs> LhsProductTraits;
00086   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} LhsProductTraits::DirectLinearAccessType ActualLhsType;
00087 
00088   \textcolor{keyword}{static} \textcolor{keywordtype}{void} run(\textcolor{keyword}{const} Lhs& lhs, Rhs& rhs)
00089   \{
00090     \textcolor{keyword}{typename} internal::add\_const\_on\_value\_type<ActualLhsType>::type actualLhs = LhsProductTraits::extract(
      lhs);
00091 
00092     \textcolor{keyword}{const} Index size = lhs.rows();
00093     \textcolor{keyword}{const} Index othersize = Side==\hyperlink{group__enums_ggac22de43beeac7a78b384f99bed5cee0ba129609b3bdf23b071f5f86cf2f995ec4}{OnTheLeft}? rhs.cols() : rhs.rows();
00094 
00095     \textcolor{keyword}{typedef} internal::gemm\_blocking\_space<(Rhs::Flags&\hyperlink{group__flags_gae4f56c2a60bbe4bd2e44c5b19cbe8762}{RowMajorBit}) ? 
      \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13acfcde9cd8677c5f7caf6bd603666aae3}{RowMajor} : \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor},Scalar,Scalar,
00096               Rhs::MaxRowsAtCompileTime, Rhs::MaxColsAtCompileTime, Lhs::MaxRowsAtCompileTime,4> 
      BlockingType;
00097 
00098     BlockingType blocking(rhs.rows(), rhs.cols(), size, 1, \textcolor{keyword}{false});
00099 
00100     triangular\_solve\_matrix<Scalar,\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index},Side,Mode,LhsProductTraits::NeedToConjugate,(int(Lhs::Flags) 
      & \hyperlink{group__flags_gae4f56c2a60bbe4bd2e44c5b19cbe8762}{RowMajorBit}) ? \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13acfcde9cd8677c5f7caf6bd603666aae3}{RowMajor} : ColMajor,
00101                                (Rhs::Flags&\hyperlink{group__flags_gae4f56c2a60bbe4bd2e44c5b19cbe8762}{RowMajorBit}) ? \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13acfcde9cd8677c5f7caf6bd603666aae3}{RowMajor} : ColMajor>
00102       ::run(size, othersize, &actualLhs.coeffRef(0,0), actualLhs.outerStride(), &rhs.coeffRef(0,0), rhs.
      outerStride(), blocking);
00103   \}
00104 \};
00105 
00106 \textcolor{comment}{/***************************************************************************}
00107 \textcolor{comment}{* meta-unrolling implementation}
00108 \textcolor{comment}{***************************************************************************/}
00109 
00110 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Lhs, \textcolor{keyword}{typename} Rhs, \textcolor{keywordtype}{int} Mode, \textcolor{keywordtype}{int} LoopIndex, \textcolor{keywordtype}{int} Size,
00111          \textcolor{keywordtype}{bool} Stop = LoopIndex==Size>
00112 \textcolor{keyword}{struct }triangular\_solver\_unroller;
00113 
00114 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Lhs, \textcolor{keyword}{typename} Rhs, \textcolor{keywordtype}{int} Mode, \textcolor{keywordtype}{int} LoopIndex, \textcolor{keywordtype}{int} Size>
00115 \textcolor{keyword}{struct }triangular\_solver\_unroller<Lhs,Rhs,Mode,LoopIndex,Size,false> \{
00116   \textcolor{keyword}{enum} \{
00117     IsLower = ((Mode&\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda891792b8ed394f7607ab16dd716f60e6}{Lower})==\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda891792b8ed394f7607ab16dd716f60e6}{Lower}),
00118     DiagIndex  = IsLower ? LoopIndex : Size - LoopIndex - 1,
00119     StartIndex = IsLower ? 0         : DiagIndex+1
00120   \};
00121   \textcolor{keyword}{static} \textcolor{keywordtype}{void} run(\textcolor{keyword}{const} Lhs& lhs, Rhs& rhs)
00122   \{
00123     \textcolor{keywordflow}{if} (LoopIndex>0)
00124       rhs.coeffRef(DiagIndex) -= lhs.row(DiagIndex).template segment<LoopIndex>(StartIndex).transpose()
00125                                 .cwiseProduct(rhs.template segment<LoopIndex>(StartIndex)).sum();
00126 
00127     \textcolor{keywordflow}{if}(!(Mode & \hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cdaddb72f888ac85d5a1c52333e54f9374b}{UnitDiag}))
00128       rhs.coeffRef(DiagIndex) /= lhs.coeff(DiagIndex,DiagIndex);
00129 
00130     triangular\_solver\_unroller<Lhs,Rhs,Mode,LoopIndex+1,Size>::run(lhs,rhs);
00131   \}
00132 \};
00133 
00134 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Lhs, \textcolor{keyword}{typename} Rhs, \textcolor{keywordtype}{int} Mode, \textcolor{keywordtype}{int} LoopIndex, \textcolor{keywordtype}{int} Size>
00135 \textcolor{keyword}{struct }triangular\_solver\_unroller<Lhs,Rhs,Mode,LoopIndex,Size,true> \{
00136   \textcolor{keyword}{static} \textcolor{keywordtype}{void} run(\textcolor{keyword}{const} Lhs&, Rhs&) \{\}
00137 \};
00138 
00139 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Lhs, \textcolor{keyword}{typename} Rhs, \textcolor{keywordtype}{int} Mode>
00140 \textcolor{keyword}{struct }triangular\_solver\_selector<Lhs,Rhs,\hyperlink{group__enums_ggac22de43beeac7a78b384f99bed5cee0ba129609b3bdf23b071f5f86cf2f995ec4}{OnTheLeft},Mode,CompleteUnrolling,1> \{
00141   \textcolor{keyword}{static} \textcolor{keywordtype}{void} run(\textcolor{keyword}{const} Lhs& lhs, Rhs& rhs)
00142   \{ triangular\_solver\_unroller<Lhs,Rhs,Mode,0,Rhs::SizeAtCompileTime>::run(lhs,rhs); \}
00143 \};
00144 
00145 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Lhs, \textcolor{keyword}{typename} Rhs, \textcolor{keywordtype}{int} Mode>
00146 \textcolor{keyword}{struct }triangular\_solver\_selector<Lhs,Rhs,\hyperlink{group__enums_ggac22de43beeac7a78b384f99bed5cee0ba99dc75d8e00b6c3a5bdc31940f47492b}{OnTheRight},Mode,CompleteUnrolling,1> \{
00147   \textcolor{keyword}{static} \textcolor{keywordtype}{void} run(\textcolor{keyword}{const} Lhs& lhs, Rhs& rhs)
00148   \{
00149     Transpose<const Lhs> trLhs(lhs);
00150     Transpose<Rhs> trRhs(rhs);
00151     
00152     triangular\_solver\_unroller<Transpose<const Lhs>,Transpose<Rhs>,
00153                               ((Mode&\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda6bcb58be3b8b8ec84859ce0c5ac0aaec}{Upper})==\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda6bcb58be3b8b8ec84859ce0c5ac0aaec}{Upper} ? \hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda891792b8ed394f7607ab16dd716f60e6}{Lower} : 
      \hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda6bcb58be3b8b8ec84859ce0c5ac0aaec}{Upper}) | (Mode&\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cdaddb72f888ac85d5a1c52333e54f9374b}{UnitDiag}),
00154                               0,Rhs::SizeAtCompileTime>::run(trLhs,trRhs);
00155   \}
00156 \};
00157 
00158 \} \textcolor{comment}{// end namespace internal}
00159 
00160 \textcolor{comment}{/***************************************************************************}
00161 \textcolor{comment}{* TriangularView methods}
00162 \textcolor{comment}{***************************************************************************/}
00163 
00164 \textcolor{preprocessor}{#ifndef EIGEN\_PARSED\_BY\_DOXYGEN}
00165 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} Mode>
00166 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} S\textcolor{keywordtype}{id}e, \textcolor{keyword}{typename} OtherDerived>
00167 \textcolor{keywordtype}{void} TriangularViewImpl<MatrixType,Mode,Dense>::solveInPlace(\textcolor{keyword}{const} MatrixBase<OtherDerived>& \_other)\textcolor{keyword}{ const}
00168 \textcolor{keyword}{}\{
00169   OtherDerived& other = \_other.const\_cast\_derived();
00170   eigen\_assert( derived().cols() == derived().rows() && ((Side==\hyperlink{group__enums_ggac22de43beeac7a78b384f99bed5cee0ba129609b3bdf23b071f5f86cf2f995ec4}{OnTheLeft} && derived().cols() == 
      other.rows()) || (Side==\hyperlink{group__enums_ggac22de43beeac7a78b384f99bed5cee0ba99dc75d8e00b6c3a5bdc31940f47492b}{OnTheRight} && derived().cols() == other.cols())) );
00171   eigen\_assert((!(Mode & \hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda884ff7240392e85aa6e4b3c957e36483}{ZeroDiag})) && \textcolor{keywordtype}{bool}(Mode & (\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda6bcb58be3b8b8ec84859ce0c5ac0aaec}{Upper}|\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda891792b8ed394f7607ab16dd716f60e6}{Lower})));
00172 
00173   \textcolor{keyword}{enum} \{ copy = (internal::traits<OtherDerived>::Flags & \hyperlink{group__flags_gae4f56c2a60bbe4bd2e44c5b19cbe8762}{RowMajorBit})  && 
      OtherDerived::IsVectorAtCompileTime && OtherDerived::SizeAtCompileTime!=1\};
00174   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} internal::conditional<copy,
00175     \textcolor{keyword}{typename} internal::plain\_matrix\_type\_column\_major<OtherDerived>::type, OtherDerived&>::type OtherCopy;
00176   OtherCopy otherCopy(other);
00177 
00178   internal::triangular\_solver\_selector<MatrixType, typename internal::remove\_reference<OtherCopy>::type,
00179     Side, Mode>::run(derived().nestedExpression(), otherCopy);
00180 
00181   \textcolor{keywordflow}{if} (copy)
00182     other = otherCopy;
00183 \}
00184 
00185 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Derived, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} Mode>
00186 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} S\textcolor{keywordtype}{id}e, \textcolor{keyword}{typename} Other>
00187 \textcolor{keyword}{const} internal::triangular\_solve\_retval<Side,TriangularView<Derived,Mode>,Other>
00188 TriangularViewImpl<Derived,Mode,Dense>::solve(\textcolor{keyword}{const} MatrixBase<Other>& other)\textcolor{keyword}{ const}
00189 \textcolor{keyword}{}\{
00190   \textcolor{keywordflow}{return} internal::triangular\_solve\_retval<Side,TriangularViewType,Other>(derived(), other.derived());
00191 \}
00192 \textcolor{preprocessor}{#endif}
00193 
00194 \textcolor{keyword}{namespace }\hyperlink{namespaceinternal}{internal} \{
00195 
00196 
00197 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} S\textcolor{keywordtype}{id}e, \textcolor{keyword}{typename} TriangularType, \textcolor{keyword}{typename} Rhs>
00198 \textcolor{keyword}{struct }traits<triangular\_solve\_retval<Side, TriangularType, Rhs> >
00199 \{
00200   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} internal::plain\_matrix\_type\_column\_major<Rhs>::type ReturnType;
00201 \};
00202 
00203 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} S\textcolor{keywordtype}{id}e, \textcolor{keyword}{typename} TriangularType, \textcolor{keyword}{typename} Rhs> \textcolor{keyword}{struct }triangular\_solve\_retval
00204  : \textcolor{keyword}{public} ReturnByValue<triangular\_solve\_retval<Side, TriangularType, Rhs> >
00205 \{
00206   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} remove\_all<typename Rhs::Nested>::type RhsNestedCleaned;
00207   \textcolor{keyword}{typedef} ReturnByValue<triangular\_solve\_retval> Base;
00208 
00209   triangular\_solve\_retval(\textcolor{keyword}{const} TriangularType& tri, \textcolor{keyword}{const} Rhs& rhs)
00210     : m\_triangularMatrix(tri), m\_rhs(rhs)
00211   \{\}
00212 
00213   \textcolor{keyword}{inline} Index rows()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_rhs.rows(); \}
00214   \textcolor{keyword}{inline} Index cols()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_rhs.cols(); \}
00215 
00216   \textcolor{keyword}{template}<\textcolor{keyword}{typename} Dest> \textcolor{keyword}{inline} \textcolor{keywordtype}{void} evalTo(Dest& dst)\textcolor{keyword}{ const}
00217 \textcolor{keyword}{  }\{
00218     \textcolor{keywordflow}{if}(!is\_same\_dense(dst,m\_rhs))
00219       dst = m\_rhs;
00220     m\_triangularMatrix.template solveInPlace<Side>(dst);
00221   \}
00222 
00223   \textcolor{keyword}{protected}:
00224     \textcolor{keyword}{const} TriangularType& m\_triangularMatrix;
00225     \textcolor{keyword}{typename} Rhs::Nested m\_rhs;
00226 \};
00227 
00228 \} \textcolor{comment}{// namespace internal}
00229 
00230 \} \textcolor{comment}{// end namespace Eigen}
00231 
00232 \textcolor{preprocessor}{#endif // EIGEN\_SOLVETRIANGULAR\_H}
\end{DoxyCode}
