\hypertarget{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_deflater_8cs_source}{}\section{visual\+\_\+studio/zlib/contrib/dotzlib/\+Dot\+Z\+Lib/\+Deflater.cs}
\label{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_deflater_8cs_source}\index{Deflater.\+cs@{Deflater.\+cs}}

\begin{DoxyCode}
00001 \textcolor{comment}{//}
00002 \textcolor{comment}{// © Copyright Henrik Ravn 2004}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Use, modification and distribution are subject to the Boost Software License, Version 1.0.}
00005 \textcolor{comment}{// (See accompanying file LICENSE\_1\_0.txt or copy at http://www.boost.org/LICENSE\_1\_0.txt)}
00006 \textcolor{comment}{//}
00007 
00008 \textcolor{keyword}{using} \hyperlink{namespace_system}{System};
00009 \textcolor{keyword}{using} \hyperlink{namespace_system}{System}.Diagnostics;
00010 \textcolor{keyword}{using} \hyperlink{namespace_system}{System}.Runtime.InteropServices;
00011 
00012 \textcolor{keyword}{namespace }\hyperlink{namespace_dot_z_lib}{DotZLib}
00013 \{
00014 
\Hypertarget{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_deflater_8cs_source_l00018}\hyperlink{class_dot_z_lib_1_1_deflater}{00018}     \textcolor{keyword}{public} sealed \textcolor{keyword}{class }\hyperlink{class_dot_z_lib_1_1_deflater}{Deflater} : \hyperlink{class_dot_z_lib_1_1_codec_base}{CodecBase}
00019     \{
00020 \textcolor{preprocessor}{        #region Dll imports}
00021         [DllImport(\textcolor{stringliteral}{"ZLIB1.dll"}, CallingConvention=CallingConvention.Cdecl, CharSet=CharSet.Ansi)]
00022         \textcolor{keyword}{private} \textcolor{keyword}{static} \textcolor{keyword}{extern} \textcolor{keywordtype}{int} deflateInit\_(ref ZStream sz, \textcolor{keywordtype}{int} level, \textcolor{keywordtype}{string} vs, \textcolor{keywordtype}{int} size);
00023 
00024         [DllImport(\textcolor{stringliteral}{"ZLIB1.dll"}, CallingConvention=CallingConvention.Cdecl)]
00025         \textcolor{keyword}{private} \textcolor{keyword}{static} \textcolor{keyword}{extern} \textcolor{keywordtype}{int} deflate(ref ZStream sz, \textcolor{keywordtype}{int} flush);
00026 
00027         [DllImport(\textcolor{stringliteral}{"ZLIB1.dll"}, CallingConvention=CallingConvention.Cdecl)]
00028         \textcolor{keyword}{private} \textcolor{keyword}{static} \textcolor{keyword}{extern} \textcolor{keywordtype}{int} deflateReset(ref ZStream sz);
00029 
00030         [DllImport(\textcolor{stringliteral}{"ZLIB1.dll"}, CallingConvention=CallingConvention.Cdecl)]
00031         \textcolor{keyword}{private} \textcolor{keyword}{static} \textcolor{keyword}{extern} \textcolor{keywordtype}{int} deflateEnd(ref ZStream sz);
00032 \textcolor{preprocessor}{        #endregion}
00033 
\Hypertarget{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_deflater_8cs_source_l00038}\hyperlink{class_dot_z_lib_1_1_deflater_a3af92869710011e866633c2186c7cab1}{00038}         \textcolor{keyword}{public} \hyperlink{class_dot_z_lib_1_1_deflater_a3af92869710011e866633c2186c7cab1}{Deflater}(\hyperlink{namespace_dot_z_lib_a034f7a1ef9856d8834e6f6b1c53d8a4c}{CompressLevel} level) : base()
00039         \{
00040             \textcolor{keywordtype}{int} retval = deflateInit\_(ref \_ztream, (\textcolor{keywordtype}{int})level, \hyperlink{class_dot_z_lib_1_1_info}{Info}.\hyperlink{class_dot_z_lib_1_1_info_a55b101b2c131860775880231fdf5fbd7}{Version}, Marshal.SizeOf(
      \_ztream));
00041             \textcolor{keywordflow}{if} (retval != 0)
00042                 \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{class_dot_z_lib_1_1_z_lib_exception}{ZLibException}(retval, \textcolor{stringliteral}{"Could not initialize deflater"});
00043 
00044             \hyperlink{class_dot_z_lib_1_1_codec_base_a801b625073b21aeaab52ebf9e96dd9c9}{resetOutput}();
00045         \}
00046 
\Hypertarget{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_deflater_8cs_source_l00054}\hyperlink{class_dot_z_lib_1_1_deflater_a2db95e3ca07e562df0652ed1ad8d0c4d}{00054}         \textcolor{keyword}{public} \textcolor{keyword}{override} \textcolor{keywordtype}{void} \hyperlink{class_dot_z_lib_1_1_deflater_a2db95e3ca07e562df0652ed1ad8d0c4d}{Add}(byte[] data, \textcolor{keywordtype}{int} offset, \textcolor{keywordtype}{int} count)
00055         \{
00056             \textcolor{keywordflow}{if} (data == null) \textcolor{keywordflow}{throw} \textcolor{keyword}{new} ArgumentNullException();
00057             \textcolor{keywordflow}{if} (offset < 0 || count < 0) \textcolor{keywordflow}{throw} \textcolor{keyword}{new} ArgumentOutOfRangeException();
00058             \textcolor{keywordflow}{if} ((offset+count) > data.Length) \textcolor{keywordflow}{throw} \textcolor{keyword}{new} ArgumentException();
00059 
00060             \textcolor{keywordtype}{int} total = count;
00061             \textcolor{keywordtype}{int} inputIndex = offset;
00062             \textcolor{keywordtype}{int} err = 0;
00063 
00064             \textcolor{keywordflow}{while} (err >= 0 && inputIndex < total)
00065             \{
00066                 \hyperlink{class_dot_z_lib_1_1_codec_base_a8c827f091195356490e7f8b69e0546a7}{copyInput}(data, inputIndex, Math.Min(total - inputIndex, 
      \hyperlink{class_dot_z_lib_1_1_codec_base_a4e516f01a0660be7dbbbed22d1f6b595}{kBufferSize}));
00067                 \textcolor{keywordflow}{while} (err >= 0 && \_ztream.avail\_in > 0)
00068                 \{
00069                     err = deflate(ref \_ztream, (\textcolor{keywordtype}{int})FlushTypes.None);
00070                     \textcolor{keywordflow}{if} (err == 0)
00071                         \textcolor{keywordflow}{while} (\_ztream.avail\_out == 0)
00072                         \{
00073                             \hyperlink{class_dot_z_lib_1_1_codec_base_a5c697195bc017ae951858e7c8948f9ae}{OnDataAvailable}();
00074                             err = deflate(ref \_ztream, (\textcolor{keywordtype}{int})FlushTypes.None);
00075                         \}
00076                     inputIndex += (int)\_ztream.total\_in;
00077                 \}
00078             \}
00079             \hyperlink{class_dot_z_lib_1_1_codec_base_a5dfa2dddf3ac857652af7fd8e3d2034d}{setChecksum}( \_ztream.adler );
00080         \}
00081 
00082 
\Hypertarget{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_deflater_8cs_source_l00086}\hyperlink{class_dot_z_lib_1_1_deflater_a84507769a20a13c2ff48cfcef8f5c13b}{00086}         \textcolor{keyword}{public} \textcolor{keyword}{override} \textcolor{keywordtype}{void} \hyperlink{class_dot_z_lib_1_1_deflater_a84507769a20a13c2ff48cfcef8f5c13b}{Finish}()
00087         \{
00088             \textcolor{keywordtype}{int} err;
00089             \textcolor{keywordflow}{do}
00090             \{
00091                 err = deflate(ref \_ztream, (\textcolor{keywordtype}{int})FlushTypes.Finish);
00092                 \hyperlink{class_dot_z_lib_1_1_codec_base_a5c697195bc017ae951858e7c8948f9ae}{OnDataAvailable}();
00093             \}
00094             \textcolor{keywordflow}{while} (err == 0);
00095             \hyperlink{class_dot_z_lib_1_1_codec_base_a5dfa2dddf3ac857652af7fd8e3d2034d}{setChecksum}( \_ztream.adler );
00096             deflateReset(ref \_ztream);
00097             \hyperlink{class_dot_z_lib_1_1_codec_base_a801b625073b21aeaab52ebf9e96dd9c9}{resetOutput}();
00098         \}
00099 
\Hypertarget{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_deflater_8cs_source_l00103}\hyperlink{class_dot_z_lib_1_1_deflater_af06ac29d92dbe5d6198b8fa906476e05}{00103}         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{void} \hyperlink{class_dot_z_lib_1_1_deflater_af06ac29d92dbe5d6198b8fa906476e05}{CleanUp}() \{ deflateEnd(ref \_ztream); \}
00104 
00105     \}
00106 \}
\end{DoxyCode}
