\hypertarget{visual__studio_2_h_d_f5_21_810_81_2_h_d_f5_examples_2_c_2_h5_t_2h5ex__t__floatatt_8c_source}{}\section{visual\+\_\+studio/\+H\+D\+F5/1.10.1/\+H\+D\+F5\+Examples/\+C/\+H5\+T/h5ex\+\_\+t\+\_\+floatatt.c}
\label{visual__studio_2_h_d_f5_21_810_81_2_h_d_f5_examples_2_c_2_h5_t_2h5ex__t__floatatt_8c_source}\index{h5ex\+\_\+t\+\_\+floatatt.\+c@{h5ex\+\_\+t\+\_\+floatatt.\+c}}

\begin{DoxyCode}
00001 \textcolor{comment}{/************************************************************}
00002 \textcolor{comment}{}
00003 \textcolor{comment}{  This example shows how to read and write floating point}
00004 \textcolor{comment}{  datatypes to an attribute.  The program first writes}
00005 \textcolor{comment}{  floating point numbers to an attribute with a dataspace of}
00006 \textcolor{comment}{  DIM0xDIM1, then closes the file.  Next, it reopens the}
00007 \textcolor{comment}{  file, reads back the data, and outputs it to the screen.}
00008 \textcolor{comment}{}
00009 \textcolor{comment}{  This file is intended for use with HDF5 Library version 1.8}
00010 \textcolor{comment}{}
00011 \textcolor{comment}{ ************************************************************/}
00012 
00013 \textcolor{preprocessor}{#include "hdf5.h"}
00014 \textcolor{preprocessor}{#include <stdio.h>}
00015 \textcolor{preprocessor}{#include <stdlib.h>}
00016 
00017 \textcolor{preprocessor}{#define FILE            "h5ex\_t\_floatatt.h5"}
00018 \textcolor{preprocessor}{#define DATASET         "DS1"}
00019 \textcolor{preprocessor}{#define ATTRIBUTE       "A1"}
00020 \textcolor{preprocessor}{#define DIM0            4}
00021 \textcolor{preprocessor}{#define DIM1            7}
00022 
00023 \textcolor{keywordtype}{int}
00024 main (\textcolor{keywordtype}{void})
00025 \{
00026     hid\_t       \hyperlink{structfile}{file}, space, dset, attr;            \textcolor{comment}{/* Handles */}
00027     herr\_t      status;
00028     hsize\_t     dims[2] = \{DIM0, DIM1\};
00029     \textcolor{keywordtype}{double}      wdata[DIM0][DIM1],                  \textcolor{comment}{/* Write buffer */}
00030                 **rdata;                            \textcolor{comment}{/* Read buffer */}
00031     \textcolor{keywordtype}{int}         ndims,
00032                 i, j;
00033 
00034     \textcolor{comment}{/*}
00035 \textcolor{comment}{     * Initialize data.}
00036 \textcolor{comment}{     */}
00037     \textcolor{keywordflow}{for} (i=0; i<DIM0; i++)
00038         \textcolor{keywordflow}{for} (j=0; j<DIM1; j++)
00039             wdata[i][j] = (\textcolor{keywordtype}{double}) i / (j + 0.5) + j;;
00040 
00041     \textcolor{comment}{/*}
00042 \textcolor{comment}{     * Create a new file using the default properties.}
00043 \textcolor{comment}{     */}
00044     file = H5Fcreate (FILE, H5F\_ACC\_TRUNC, H5P\_DEFAULT, H5P\_DEFAULT);
00045 
00046     \textcolor{comment}{/*}
00047 \textcolor{comment}{     * Create dataset with a null dataspace.}
00048 \textcolor{comment}{     */}
00049     space = H5Screate (H5S\_NULL);
00050     dset = H5Dcreate (file, DATASET, H5T\_STD\_I32LE, space, H5P\_DEFAULT,
00051                 H5P\_DEFAULT, H5P\_DEFAULT);
00052     status = H5Sclose (space);
00053 
00054     \textcolor{comment}{/*}
00055 \textcolor{comment}{     * Create dataspace.  Setting maximum size to NULL sets the maximum}
00056 \textcolor{comment}{     * size to be the current size.}
00057 \textcolor{comment}{     */}
00058     space = H5Screate\_simple (2, dims, NULL);
00059 
00060     \textcolor{comment}{/*}
00061 \textcolor{comment}{     * Create the attribute and write the floating point data to it.}
00062 \textcolor{comment}{     * In this example we will save the data as 64 bit little endian}
00063 \textcolor{comment}{     * IEEE floating point numbers, regardless of the native type.  The}
00064 \textcolor{comment}{     * HDF5 library automatically converts between different floating}
00065 \textcolor{comment}{     * point types.}
00066 \textcolor{comment}{     */}
00067     attr = H5Acreate (dset, ATTRIBUTE, H5T\_IEEE\_F64LE, space, H5P\_DEFAULT,
00068                 H5P\_DEFAULT);
00069     status = H5Awrite (attr, H5T\_NATIVE\_DOUBLE, wdata[0]);
00070 
00071     \textcolor{comment}{/*}
00072 \textcolor{comment}{     * Close and release resources.}
00073 \textcolor{comment}{     */}
00074     status = H5Aclose (attr);
00075     status = H5Dclose (dset);
00076     status = H5Sclose (space);
00077     status = H5Fclose (file);
00078 
00079 
00080     \textcolor{comment}{/*}
00081 \textcolor{comment}{     * Now we begin the read section of this example.  Here we assume}
00082 \textcolor{comment}{     * the attribute has the same name and rank, but can have any size.}
00083 \textcolor{comment}{     * Therefore we must allocate a new array to read in data using}
00084 \textcolor{comment}{     * malloc().}
00085 \textcolor{comment}{     */}
00086 
00087     \textcolor{comment}{/*}
00088 \textcolor{comment}{     * Open file, dataset, and attribute.}
00089 \textcolor{comment}{     */}
00090     file = H5Fopen (FILE, H5F\_ACC\_RDONLY, H5P\_DEFAULT);
00091     dset = H5Dopen (file, DATASET, H5P\_DEFAULT);
00092     attr = H5Aopen (dset, ATTRIBUTE, H5P\_DEFAULT);
00093 
00094     \textcolor{comment}{/*}
00095 \textcolor{comment}{     * Get dataspace and allocate memory for read buffer.  This is a}
00096 \textcolor{comment}{     * two dimensional attribute so the dynamic allocation must be done}
00097 \textcolor{comment}{     * in steps.}
00098 \textcolor{comment}{     */}
00099     space = H5Aget\_space (attr);
00100     ndims = H5Sget\_simple\_extent\_dims (space, dims, NULL);
00101 
00102     \textcolor{comment}{/*}
00103 \textcolor{comment}{     * Allocate array of pointers to rows.}
00104 \textcolor{comment}{     */}
00105     rdata = (\textcolor{keywordtype}{double} **) malloc (dims[0] * \textcolor{keyword}{sizeof} (\textcolor{keywordtype}{double} *));
00106 
00107     \textcolor{comment}{/*}
00108 \textcolor{comment}{     * Allocate space for floating point data.}
00109 \textcolor{comment}{     */}
00110     rdata[0] = (\textcolor{keywordtype}{double} *) malloc (dims[0] * dims[1] * \textcolor{keyword}{sizeof} (\textcolor{keywordtype}{double}));
00111 
00112     \textcolor{comment}{/*}
00113 \textcolor{comment}{     * Set the rest of the pointers to rows to the correct addresses.}
00114 \textcolor{comment}{     */}
00115     \textcolor{keywordflow}{for} (i=1; i<dims[0]; i++)
00116         rdata[i] = rdata[0] + i * dims[1];
00117 
00118     \textcolor{comment}{/*}
00119 \textcolor{comment}{     * Read the data.}
00120 \textcolor{comment}{     */}
00121     status = H5Aread (attr, H5T\_NATIVE\_DOUBLE, rdata[0]);
00122 
00123     \textcolor{comment}{/*}
00124 \textcolor{comment}{     * Output the data to the screen.}
00125 \textcolor{comment}{     */}
00126     printf (\textcolor{stringliteral}{"%s:\(\backslash\)n"}, ATTRIBUTE);
00127     \textcolor{keywordflow}{for} (i=0; i<dims[0]; i++) \{
00128         printf (\textcolor{stringliteral}{" ["});
00129         \textcolor{keywordflow}{for} (j=0; j<dims[1]; j++)
00130             printf (\textcolor{stringliteral}{" %6.4f"}, rdata[i][j]);
00131         printf (\textcolor{stringliteral}{"]\(\backslash\)n"});
00132     \}
00133 
00134     \textcolor{comment}{/*}
00135 \textcolor{comment}{     * Close and release resources.}
00136 \textcolor{comment}{     */}
00137     free (rdata[0]);
00138     free (rdata);
00139     status = H5Aclose (attr);
00140     status = H5Dclose (dset);
00141     status = H5Sclose (space);
00142     status = H5Fclose (file);
00143 
00144     \textcolor{keywordflow}{return} 0;
00145 \}
\end{DoxyCode}
