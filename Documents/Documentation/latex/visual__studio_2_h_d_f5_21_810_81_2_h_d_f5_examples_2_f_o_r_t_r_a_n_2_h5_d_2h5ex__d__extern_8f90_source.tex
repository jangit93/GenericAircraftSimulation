\hypertarget{visual__studio_2_h_d_f5_21_810_81_2_h_d_f5_examples_2_f_o_r_t_r_a_n_2_h5_d_2h5ex__d__extern_8f90_source}{}\section{visual\+\_\+studio/\+H\+D\+F5/1.10.1/\+H\+D\+F5\+Examples/\+F\+O\+R\+T\+R\+A\+N/\+H5\+D/h5ex\+\_\+d\+\_\+extern.f90}
\label{visual__studio_2_h_d_f5_21_810_81_2_h_d_f5_examples_2_f_o_r_t_r_a_n_2_h5_d_2h5ex__d__extern_8f90_source}\index{h5ex\+\_\+d\+\_\+extern.\+f90@{h5ex\+\_\+d\+\_\+extern.\+f90}}

\begin{DoxyCode}
00001 \textcolor{comment}{!************************************************************}
00002 \textcolor{comment}{!}
00003 \textcolor{comment}{!  This example shows how to read and write data to an}
00004 \textcolor{comment}{!  external dataset.  The program first writes integers to an}
00005 \textcolor{comment}{!  external dataset with dataspace dimensions of DIM0xDIM1,}
00006 \textcolor{comment}{!  then closes the file.  Next, it reopens the file, reads}
00007 \textcolor{comment}{!  back the data, and outputs the name of the external data}
00008 \textcolor{comment}{!  file and the data to the screen.}
00009 \textcolor{comment}{!}
00010 \textcolor{comment}{!  This file is intended for use with HDF5 Library verion 1.8}
00011 \textcolor{comment}{!}
00012 \textcolor{comment}{! ************************************************************/}
00013 
00014 \textcolor{keyword}{PROGRAM} main
00015 
00016   \textcolor{keywordtype}{USE }hdf5
00017 
00018   \textcolor{keywordtype}{IMPLICIT NONE}
00019 
00020   \textcolor{keywordtype}{CHARACTER(LEN=16)}, \textcolor{keywordtype}{PARAMETER} :: filename     = \textcolor{stringliteral}{"h5ex\_d\_extern.h5"}
00021   \textcolor{keywordtype}{CHARACTER(LEN=18)}, \textcolor{keywordtype}{PARAMETER} :: externalname = \textcolor{stringliteral}{"h5ex\_d\_extern.data"}
00022   \textcolor{keywordtype}{CHARACTER(LEN=3)} , \textcolor{keywordtype}{PARAMETER} :: dataset  = \textcolor{stringliteral}{"DS1"}
00023   \textcolor{keywordtype}{INTEGER}          , \textcolor{keywordtype}{PARAMETER} :: dim0     = 4
00024   \textcolor{keywordtype}{INTEGER}          , \textcolor{keywordtype}{PARAMETER} :: dim1     = 7
00025   \textcolor{keywordtype}{INTEGER(SIZE\_T)}  , \textcolor{keywordtype}{PARAMETER} :: name\_buf\_size = 32
00026 
00027   \textcolor{keywordtype}{INTEGER} :: hdferr
00028   \textcolor{keywordtype}{INTEGER} :: layout
00029   \textcolor{keywordtype}{INTEGER(HID\_T)}  :: \hyperlink{structfile}{file}, space, dset, dcpl \textcolor{comment}{! Handles}
00030   \textcolor{keywordtype}{INTEGER(HSIZE\_T)}, \textcolor{keywordtype}{DIMENSION(1:2)}   :: dims = (/dim0, dim1/)
00031   \textcolor{keywordtype}{INTEGER(HSIZE\_T)}, \textcolor{keywordtype}{DIMENSION(1:2)}   :: start, stride, count, block
00032 
00033   \textcolor{keywordtype}{INTEGER}, \textcolor{keywordtype}{DIMENSION(1:dim0, 1:dim1)} :: wdata, & \textcolor{comment}{! Write buffer }
00034                                         rdata    \textcolor{comment}{! Read buffer}
00035   \textcolor{keywordtype}{CHARACTER(LEN=name\_buf\_size)} :: name
00036   \textcolor{keywordtype}{INTEGER} :: i, j
00037   \textcolor{keywordtype}{INTEGER(OFF\_T)} :: offset \textcolor{comment}{! Offset, in bytes, from thebeginning of the file to the }
00038                            \textcolor{comment}{! location in the file where the data starts.}
00039   \textcolor{keywordtype}{INTEGER(HSIZE\_T)} :: bytes \textcolor{comment}{! Number of bytes reserved in the file for the data}
00040   \textcolor{keywordtype}{INTEGER(SIZE\_T)} :: int\_size \textcolor{comment}{! size of integer}
00041   \textcolor{comment}{!}
00042   \textcolor{comment}{! Initialize FORTRAN interface.}
00043   \textcolor{comment}{!}
00044   \textcolor{keyword}{CALL }h5open\_f(hdferr)
00045   \textcolor{comment}{!}
00046   \textcolor{comment}{! Initialize data.}
00047   \textcolor{comment}{!}
00048   \textcolor{keywordflow}{DO} i = 1, dim0
00049      \textcolor{keywordflow}{DO} j = 1, dim1
00050         wdata(i,j) = (i-1)*(j-1)-(j-1)
00051 \textcolor{keywordflow}{     ENDDO}
00052 \textcolor{keywordflow}{  ENDDO}
00053   \textcolor{comment}{!}
00054   \textcolor{comment}{! Create a new file using the default properties.}
00055   \textcolor{comment}{!}
00056   \textcolor{keyword}{CALL }h5fcreate\_f(filename, h5f\_acc\_trunc\_f, \hyperlink{structfile}{file}, hdferr)
00057   \textcolor{comment}{!}
00058   \textcolor{comment}{! Create dataspace.  Setting maximum size to NULL sets the maximum}
00059   \textcolor{comment}{! size to be the current size.}
00060   \textcolor{comment}{!}
00061   \textcolor{keyword}{CALL }h5screate\_simple\_f(2, dims, space, hdferr)
00062   \textcolor{comment}{!}
00063   \textcolor{comment}{! Create the dataset creation property list, set the external}
00064   \textcolor{comment}{! file.}
00065   \textcolor{comment}{!}
00066   \textcolor{keyword}{CALL }h5pcreate\_f(h5p\_dataset\_create\_f, dcpl, hdferr)
00067   \textcolor{comment}{! for HDF5 versions <= 1.8.2 use:}
00068   \textcolor{keyword}{CALL }h5tget\_size\_f(h5t\_native\_integer, int\_size, hdferr)
00069   bytes = int\_size*dim0*dim1
00070   \textcolor{comment}{! else use:}
00071   \textcolor{comment}{!   bytes = INT(H5F\_UNLIMITED\_F,HSIZE\_T)}
00072   \textcolor{keyword}{CALL }h5pset\_external\_f(dcpl, externalname, int(0,off\_t), bytes, hdferr)
00073   \textcolor{comment}{!}
00074   \textcolor{comment}{! Create the external dataset.}
00075   \textcolor{comment}{!}
00076   \textcolor{keyword}{CALL }h5dcreate\_f(\hyperlink{structfile}{file}, dataset, h5t\_std\_i32le, space, dset, hdferr, dcpl)
00077   \textcolor{comment}{!}
00078   \textcolor{comment}{! Write the data to the dataset.}
00079   \textcolor{comment}{! }
00080   \textcolor{keyword}{CALL }h5dwrite\_f(dset, h5t\_native\_integer, wdata, dims, hdferr)
00081   \textcolor{comment}{!}
00082   \textcolor{comment}{! Close and release resources.}
00083   \textcolor{comment}{! }
00084   \textcolor{keyword}{CALL }h5pclose\_f(dcpl , hdferr)
00085   \textcolor{keyword}{CALL }h5dclose\_f(dset , hdferr)
00086   \textcolor{keyword}{CALL }h5sclose\_f(space, hdferr)
00087   \textcolor{keyword}{CALL }h5fclose\_f(\hyperlink{structfile}{file} , hdferr)
00088   \textcolor{comment}{!}
00089   \textcolor{comment}{! Now we begin the read section of this example.}
00090   \textcolor{comment}{!}
00091   \textcolor{comment}{!}
00092   \textcolor{comment}{! Open file and dataset using the default properties.}
00093   \textcolor{comment}{!}
00094   \textcolor{keyword}{CALL }h5fopen\_f(filename, h5f\_acc\_rdonly\_f, \hyperlink{structfile}{file}, hdferr)
00095   \textcolor{keyword}{CALL }h5dopen\_f(\hyperlink{structfile}{file}, dataset, dset, hdferr)
00096   \textcolor{comment}{!}
00097   \textcolor{comment}{! Retrieve dataset creation property list.}
00098   \textcolor{comment}{!}
00099   \textcolor{keyword}{CALL }h5dget\_create\_plist\_f(dset, dcpl, hdferr)
00100   \textcolor{comment}{!}
00101   \textcolor{comment}{! Retrieve and print the name of the external file.  Here we}
00102   \textcolor{comment}{! manually set the last field in name to null, in case the name of}
00103   \textcolor{comment}{! the file is longer than the buffer.}
00104   \textcolor{comment}{!}
00105   \textcolor{keyword}{CALL }h5pget\_external\_f (dcpl, 0, name\_buf\_size, name, offset, bytes, hdferr)
00106   \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'(A," is stored in file: ",A)'})  dataset, trim(name)
00107   \textcolor{comment}{!}
00108   \textcolor{comment}{! Read the data using the default properties.}
00109   \textcolor{comment}{!}
00110   \textcolor{keyword}{CALL }h5dread\_f(dset, h5t\_native\_integer, rdata, dims, hdferr)
00111   \textcolor{comment}{!}
00112   \textcolor{comment}{! Output the data to the screen.}
00113   \textcolor{comment}{!}
00114   \textcolor{keyword}{WRITE}(*, \textcolor{stringliteral}{'(A,":")'}) dataset
00115   \textcolor{keywordflow}{DO} i=1, dim0
00116      \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'(" [")'}, advance=\textcolor{stringliteral}{'NO'})
00117      \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'(80i3)'}, advance=\textcolor{stringliteral}{'NO'}) rdata(i,:)
00118      \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'(" ]")'})
00119 \textcolor{keywordflow}{  ENDDO}
00120   \textcolor{comment}{!}
00121   \textcolor{comment}{! Close and release resources.}
00122   \textcolor{comment}{!}
00123   \textcolor{keyword}{CALL }h5pclose\_f(dcpl , hdferr)
00124   \textcolor{keyword}{CALL }h5dclose\_f(dset , hdferr)
00125   \textcolor{keyword}{CALL }h5fclose\_f(\hyperlink{structfile}{file} , hdferr)
00126 
00127 \textcolor{keyword}{END PROGRAM }main
\end{DoxyCode}
