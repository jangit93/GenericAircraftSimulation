\hypertarget{matio_2visual__studio_2test_2eigen_2bench_2btl_2data_2mean_8cxx_source}{}\section{matio/visual\+\_\+studio/test/eigen/bench/btl/data/mean.cxx}
\label{matio_2visual__studio_2test_2eigen_2bench_2btl_2data_2mean_8cxx_source}\index{mean.\+cxx@{mean.\+cxx}}

\begin{DoxyCode}
00001 \textcolor{comment}{//=====================================================}
00002 \textcolor{comment}{// File   :  mean.cxx}
00003 \textcolor{comment}{// Author :  L. Plagne <laurent.plagne@edf.fr)>        }
00004 \textcolor{comment}{// Copyright (C) EDF R&D,  lun sep 30 14:23:15 CEST 2002}
00005 \textcolor{comment}{//=====================================================}
00006 \textcolor{comment}{// }
00007 \textcolor{comment}{// This program is free software; you can redistribute it and/or}
00008 \textcolor{comment}{// modify it under the terms of the GNU General Public License}
00009 \textcolor{comment}{// as published by the Free Software Foundation; either version 2}
00010 \textcolor{comment}{// of the License, or (at your option) any later version.}
00011 \textcolor{comment}{// }
00012 \textcolor{comment}{// This program is distributed in the hope that it will be useful,}
00013 \textcolor{comment}{// but WITHOUT ANY WARRANTY; without even the implied warranty of}
00014 \textcolor{comment}{// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00015 \textcolor{comment}{// GNU General Public License for more details.}
00016 \textcolor{comment}{// You should have received a copy of the GNU General Public License}
00017 \textcolor{comment}{// along with this program; if not, write to the Free Software}
00018 \textcolor{comment}{// Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.}
00019 \textcolor{comment}{// }
00020 \textcolor{preprocessor}{#include "utilities.h"}
00021 \textcolor{preprocessor}{#include <vector>}
00022 \textcolor{preprocessor}{#include <string>}
00023 \textcolor{preprocessor}{#include <iostream>}
00024 \textcolor{preprocessor}{#include <fstream>}
00025 \textcolor{preprocessor}{#include "bench\_parameter.hh"}
00026 \textcolor{preprocessor}{#include "utils/xy\_file.hh"}
00027 \textcolor{preprocessor}{#include <set>}
00028 
00029 \textcolor{keyword}{using namespace }\hyperlink{namespacestd}{std};
00030 
00031 \textcolor{keywordtype}{double} mean\_calc(\textcolor{keyword}{const} vector<int> & tab\_sizes, \textcolor{keyword}{const} vector<double> & tab\_mflops, \textcolor{keyword}{const} \textcolor{keywordtype}{int} size\_min, \textcolor{keyword}{
      const} \textcolor{keywordtype}{int} size\_max);
00032 
00033 \textcolor{keyword}{class }\hyperlink{class_lib___mean}{Lib\_Mean}\{
00034 
00035 \textcolor{keyword}{public}:
00036   \hyperlink{class_lib___mean}{Lib\_Mean}( \textcolor{keywordtype}{void} ):\_lib\_name(),\_mean\_in\_cache(),\_mean\_out\_of\_cache()\{
00037     MESSAGE(\textcolor{stringliteral}{"Lib\_mean Default Ctor"});
00038     MESSAGE(\textcolor{stringliteral}{"!!! should not be used"});
00039     exit(0);
00040   \}
00041   \hyperlink{class_lib___mean}{Lib\_Mean}(\textcolor{keyword}{const} \textcolor{keywordtype}{string} & name, \textcolor{keyword}{const} \textcolor{keywordtype}{double} & mic, \textcolor{keyword}{const} \textcolor{keywordtype}{double} & moc):\_lib\_name(name),
      \_mean\_in\_cache(mic),\_mean\_out\_of\_cache(moc)\{
00042     MESSAGE(\textcolor{stringliteral}{"Lib\_mean Ctor"});
00043   \}
00044   \hyperlink{class_lib___mean}{Lib\_Mean}(\textcolor{keyword}{const} \hyperlink{class_lib___mean}{Lib\_Mean} & lm):\_lib\_name(lm.\_lib\_name),\_mean\_in\_cache(lm.\_mean\_in\_cache),
      \_mean\_out\_of\_cache(lm.\_mean\_out\_of\_cache)\{
00045     MESSAGE(\textcolor{stringliteral}{"Lib\_mean Copy Ctor"});
00046   \}
00047   ~\hyperlink{class_lib___mean}{Lib\_Mean}( \textcolor{keywordtype}{void} )\{
00048     MESSAGE(\textcolor{stringliteral}{"Lib\_mean Dtor"});
00049   \}
00050     
00051   \textcolor{keywordtype}{double} \_mean\_in\_cache;
00052   \textcolor{keywordtype}{double} \_mean\_out\_of\_cache;
00053   \textcolor{keywordtype}{string} \_lib\_name;
00054 
00055   \textcolor{keywordtype}{bool} operator < ( \textcolor{keyword}{const} \hyperlink{class_lib___mean}{Lib\_Mean} &right)\textcolor{keyword}{ const }
00056 \textcolor{keyword}{  }\{
00057     \textcolor{comment}{//return ( this->\_mean\_out\_of\_cache > right.\_mean\_out\_of\_cache) ;}
00058     \textcolor{keywordflow}{return} ( this->\_mean\_in\_cache > right.\_mean\_in\_cache) ;
00059   \}
00060 
00061 \}; 
00062 
00063 
00064 \textcolor{keywordtype}{int} main( \textcolor{keywordtype}{int} argc , \textcolor{keywordtype}{char} *argv[] )
00065 \{
00066 
00067   \textcolor{keywordflow}{if} (argc<6)\{
00068     INFOS(\textcolor{stringliteral}{"!!! Error ... usage : main what mic Mic moc Moc filename1 finename2..."});
00069     exit(0);
00070   \}
00071   INFOS(argc);
00072 
00073   \textcolor{keywordtype}{int} min\_in\_cache=atoi(argv[2]);
00074   \textcolor{keywordtype}{int} max\_in\_cache=atoi(argv[3]);
00075   \textcolor{keywordtype}{int} min\_out\_of\_cache=atoi(argv[4]);
00076   \textcolor{keywordtype}{int} max\_out\_of\_cache=atoi(argv[5]);
00077 
00078 
00079   multiset<Lib\_Mean> s\_lib\_mean ;
00080 
00081   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=6;i<argc;i++)\{
00082     
00083     \textcolor{keywordtype}{string} filename=argv[i];
00084     
00085     INFOS(filename);
00086 
00087     \textcolor{keywordtype}{double} mic=0;
00088     \textcolor{keywordtype}{double} moc=0;
00089 
00090     \{
00091       
00092       vector<int> tab\_sizes;
00093       vector<double> tab\_mflops;
00094 
00095       read\_xy\_file(filename,tab\_sizes,tab\_mflops);
00096 
00097       mic=mean\_calc(tab\_sizes,tab\_mflops,min\_in\_cache,max\_in\_cache);
00098       moc=mean\_calc(tab\_sizes,tab\_mflops,min\_out\_of\_cache,max\_out\_of\_cache);
00099 
00100       \hyperlink{class_lib___mean}{Lib\_Mean} cur\_lib\_mean(filename,mic,moc);
00101       
00102       s\_lib\_mean.insert(cur\_lib\_mean);  
00103 
00104     \}   
00105            
00106   \}
00107 
00108 
00109   cout << \textcolor{stringliteral}{"<TABLE BORDER CELLPADDING=2>"} << endl ;
00110   cout << \textcolor{stringliteral}{"  <TR>"} << endl ;
00111   cout << \textcolor{stringliteral}{"    <TH ALIGN=CENTER> "} << argv[1] << \textcolor{stringliteral}{" </TH>"} << endl ;
00112   cout << \textcolor{stringliteral}{"    <TH ALIGN=CENTER> <a href="}\textcolor{stringliteral}{"#mean\_marker"}\textcolor{stringliteral}{"> in cache <BR> mean perf <BR> Mflops </a></TH>"} <
      < endl ;
00113   cout << \textcolor{stringliteral}{"    <TH ALIGN=CENTER> in cache <BR> % best </TH>"} << endl ;
00114   cout << \textcolor{stringliteral}{"    <TH ALIGN=CENTER> <a href="}\textcolor{stringliteral}{"#mean\_marker"}\textcolor{stringliteral}{"> out of cache <BR> mean perf <BR> Mflops
       </a></TH>"} << endl ;
00115   cout << \textcolor{stringliteral}{"    <TH ALIGN=CENTER> out of cache <BR> % best </TH>"} << endl ;
00116   cout << \textcolor{stringliteral}{"    <TH ALIGN=CENTER> details </TH>"} << endl ;
00117   cout << \textcolor{stringliteral}{"    <TH ALIGN=CENTER> comments </TH>"} << endl ;
00118   cout << \textcolor{stringliteral}{"  </TR>"} << endl ;
00119 
00120   multiset<Lib\_Mean>::iterator is = s\_lib\_mean.begin();
00121   \hyperlink{class_lib___mean}{Lib\_Mean} best(*is);  
00122   
00123 
00124   \textcolor{keywordflow}{for} (is=s\_lib\_mean.begin(); is!=s\_lib\_mean.end() ; is++)\{
00125 
00126     cout << \textcolor{stringliteral}{"  <TR>"} << endl ;
00127     cout << \textcolor{stringliteral}{"     <TD> "} << is->\_lib\_name << \textcolor{stringliteral}{" </TD>"} << endl ;
00128     cout << \textcolor{stringliteral}{"     <TD> "} << is->\_mean\_in\_cache << \textcolor{stringliteral}{" </TD>"} << endl ;
00129     cout << \textcolor{stringliteral}{"     <TD> "} << 100*(is->\_mean\_in\_cache/best.\_mean\_in\_cache) << \textcolor{stringliteral}{" </TD>"} << endl ;
00130     cout << \textcolor{stringliteral}{"     <TD> "} << is->\_mean\_out\_of\_cache << \textcolor{stringliteral}{" </TD>"} << endl ;
00131     cout << \textcolor{stringliteral}{"     <TD> "} << 100*(is->\_mean\_out\_of\_cache/best.\_mean\_out\_of\_cache) << \textcolor{stringliteral}{" </TD>"} << endl ;
00132     cout << \textcolor{stringliteral}{"     <TD> "} << 
00133       \textcolor{stringliteral}{"<a href=\(\backslash\)"#"}<<is->\_lib\_name<<\textcolor{stringliteral}{"\_"}<<argv[1]<<\textcolor{stringliteral}{"\(\backslash\)">snippet</a>/"} 
00134       \textcolor{stringliteral}{"<a href=\(\backslash\)"#"}<<is->\_lib\_name<<\textcolor{stringliteral}{"\_flags\(\backslash\)">flags</a>  </TD>"} << endl ;
00135     cout << \textcolor{stringliteral}{"     <TD> "} << 
00136       \textcolor{stringliteral}{"<a href=\(\backslash\)"#"}<<is->\_lib\_name<<\textcolor{stringliteral}{"\_comments\(\backslash\)">click here</a>  </TD>"} << endl ;
00137     cout << \textcolor{stringliteral}{"  </TR>"} << endl ;
00138   
00139   \}
00140 
00141   cout << \textcolor{stringliteral}{"</TABLE>"} << endl ;
00142 
00143   ofstream output\_file (\textcolor{stringliteral}{"../order\_lib"},ios::out) ;
00144   
00145   \textcolor{keywordflow}{for} (is=s\_lib\_mean.begin(); is!=s\_lib\_mean.end() ; is++)\{
00146     output\_file << is->\_lib\_name << endl ;
00147   \}
00148 
00149   output\_file.close();
00150 
00151 \}
00152 
00153 \textcolor{keywordtype}{double} mean\_calc(\textcolor{keyword}{const} vector<int> & tab\_sizes, \textcolor{keyword}{const} vector<double> & tab\_mflops, \textcolor{keyword}{const} \textcolor{keywordtype}{int} size\_min, \textcolor{keyword}{
      const} \textcolor{keywordtype}{int} size\_max)\{
00154   
00155   \textcolor{keywordtype}{int} size=tab\_sizes.size();
00156   \textcolor{keywordtype}{int} nb\_sample=0;
00157   \textcolor{keywordtype}{double} mean=0.0;
00158 
00159   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0;i<size;i++)\{
00160     
00161     
00162     \textcolor{keywordflow}{if} ((tab\_sizes[i]>=size\_min)&&(tab\_sizes[i]<=size\_max))\{
00163       
00164       nb\_sample++;
00165       mean+=tab\_mflops[i];
00166 
00167     \}
00168 
00169     
00170   \}
00171 
00172   \textcolor{keywordflow}{if} (nb\_sample==0)\{
00173     INFOS(\textcolor{stringliteral}{"no data for mean calculation"});
00174     \textcolor{keywordflow}{return} 0.0;
00175   \}
00176 
00177   \textcolor{keywordflow}{return} mean/nb\_sample;
00178 \}
00179 
00180   
00181 
00182 
\end{DoxyCode}
