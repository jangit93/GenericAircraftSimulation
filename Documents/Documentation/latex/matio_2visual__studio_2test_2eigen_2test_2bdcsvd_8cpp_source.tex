\hypertarget{matio_2visual__studio_2test_2eigen_2test_2bdcsvd_8cpp_source}{}\section{matio/visual\+\_\+studio/test/eigen/test/bdcsvd.cpp}
\label{matio_2visual__studio_2test_2eigen_2test_2bdcsvd_8cpp_source}\index{bdcsvd.\+cpp@{bdcsvd.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2013 Gauthier Brun <brun.gauthier@gmail.com>}
00005 \textcolor{comment}{// Copyright (C) 2013 Nicolas Carre <nicolas.carre@ensimag.fr>}
00006 \textcolor{comment}{// Copyright (C) 2013 Jean Ceccato <jean.ceccato@ensimag.fr>}
00007 \textcolor{comment}{// Copyright (C) 2013 Pierre Zoppitelli <pierre.zoppitelli@ensimag.fr>}
00008 \textcolor{comment}{//}
00009 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00010 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00011 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/}
00012 
00013 \textcolor{comment}{// discard stack allocation as that too bypasses malloc}
00014 \textcolor{preprocessor}{#define EIGEN\_STACK\_ALLOCATION\_LIMIT 0}
00015 \textcolor{preprocessor}{#define EIGEN\_RUNTIME\_NO\_MALLOC}
00016 
00017 \textcolor{preprocessor}{#include "main.h"}
00018 \textcolor{preprocessor}{#include <Eigen/SVD>}
00019 \textcolor{preprocessor}{#include <iostream>}
00020 \textcolor{preprocessor}{#include <Eigen/LU>}
00021 
00022 
00023 \textcolor{preprocessor}{#define SVD\_DEFAULT(M) BDCSVD<M>}
00024 \textcolor{preprocessor}{#define SVD\_FOR\_MIN\_NORM(M) BDCSVD<M>}
00025 \textcolor{preprocessor}{#include "svd\_common.h"}
00026 
00027 \textcolor{comment}{// Check all variants of JacobiSVD}
00028 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>
00029 \textcolor{keywordtype}{void} bdcsvd(\textcolor{keyword}{const} MatrixType& a = MatrixType(), \textcolor{keywordtype}{bool} pickrandom = \textcolor{keyword}{true})
00030 \{
00031   MatrixType m = a;
00032   \textcolor{keywordflow}{if}(pickrandom)
00033     svd\_fill\_random(m);
00034 
00035   CALL\_SUBTEST(( svd\_test\_all\_computation\_options<\hyperlink{group___s_v_d___module_class_eigen_1_1_b_d_c_s_v_d}{BDCSVD<MatrixType>} >(m, \textcolor{keyword}{false})  ));
00036 \}
00037 
00038 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>
00039 \textcolor{keywordtype}{void} bdcsvd\_method()
00040 \{
00041   \textcolor{keyword}{enum} \{ Size = MatrixType::RowsAtCompileTime \};
00042   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::RealScalar RealScalar;
00043   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<RealScalar, Size, 1>} RealVecType;
00044   MatrixType m = MatrixType::Identity();
00045   VERIFY\_IS\_APPROX(m.bdcSvd().singularValues(), RealVecType::Ones());
00046   VERIFY\_RAISES\_ASSERT(m.bdcSvd().matrixU());
00047   VERIFY\_RAISES\_ASSERT(m.bdcSvd().matrixV());
00048   VERIFY\_IS\_APPROX(m.bdcSvd(\hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a2b4f91ca5859a4159dbfe8090043817f}{ComputeFullU}|\hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a52c6f7e80bbf9a42297c88f700245b51}{ComputeFullV}).solve(m), m);
00049 \}
00050 
00051 \textcolor{comment}{// compare the Singular values returned with Jacobi and Bdc}
00052 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType> 
00053 \textcolor{keywordtype}{void} compare\_bdc\_jacobi(\textcolor{keyword}{const} MatrixType& a = MatrixType(), \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} computationOptions = 0)
00054 \{
00055   MatrixType m = MatrixType::Random(a.rows(), a.cols());
00056   \hyperlink{group___s_v_d___module_class_eigen_1_1_b_d_c_s_v_d}{BDCSVD<MatrixType>} bdc\_svd(m);
00057   \hyperlink{group___s_v_d___module_class_eigen_1_1_jacobi_s_v_d}{JacobiSVD<MatrixType>} jacobi\_svd(m);
00058   VERIFY\_IS\_APPROX(bdc\_svd.singularValues(), jacobi\_svd.singularValues());
00059   \textcolor{keywordflow}{if}(computationOptions & \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a2b4f91ca5859a4159dbfe8090043817f}{ComputeFullU}) VERIFY\_IS\_APPROX(bdc\_svd.matrixU(), jacobi\_svd.matrixU(
      ));
00060   \textcolor{keywordflow}{if}(computationOptions & \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9af8c742a1aa87773e165eae406c9ccaf8}{ComputeThinU}) VERIFY\_IS\_APPROX(bdc\_svd.matrixU(), jacobi\_svd.matrixU(
      ));
00061   \textcolor{keywordflow}{if}(computationOptions & \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a52c6f7e80bbf9a42297c88f700245b51}{ComputeFullV}) VERIFY\_IS\_APPROX(bdc\_svd.matrixV(), jacobi\_svd.matrixV(
      ));
00062   \textcolor{keywordflow}{if}(computationOptions & \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a1055e53fa95c8ae04a07ebb72cfafd95}{ComputeThinV}) VERIFY\_IS\_APPROX(bdc\_svd.matrixV(), jacobi\_svd.matrixV(
      ));
00063 \}
00064 
00065 \textcolor{keywordtype}{void} test\_bdcsvd()
00066 \{
00067   CALL\_SUBTEST\_3(( svd\_verify\_assert<\hyperlink{group___s_v_d___module_class_eigen_1_1_b_d_c_s_v_d}{BDCSVD<Matrix3f>}  >(Matrix3f()) ));
00068   CALL\_SUBTEST\_4(( svd\_verify\_assert<\hyperlink{group___s_v_d___module_class_eigen_1_1_b_d_c_s_v_d}{BDCSVD<Matrix4d>}  >(Matrix4d()) ));
00069   CALL\_SUBTEST\_7(( svd\_verify\_assert<\hyperlink{group___s_v_d___module_class_eigen_1_1_b_d_c_s_v_d}{BDCSVD<MatrixXf>}  >(MatrixXf(10,12)) ));
00070   CALL\_SUBTEST\_8(( svd\_verify\_assert<\hyperlink{group___s_v_d___module_class_eigen_1_1_b_d_c_s_v_d}{BDCSVD<MatrixXcd>} >(MatrixXcd(7,5)) ));
00071   
00072   CALL\_SUBTEST\_101(( svd\_all\_trivial\_2x2(bdcsvd<Matrix2cd>) ));
00073   CALL\_SUBTEST\_102(( svd\_all\_trivial\_2x2(bdcsvd<Matrix2d>) ));
00074 
00075   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 0; i < g\_repeat; i++) \{
00076     CALL\_SUBTEST\_3(( bdcsvd<Matrix3f>() ));
00077     CALL\_SUBTEST\_4(( bdcsvd<Matrix4d>() ));
00078     CALL\_SUBTEST\_5(( bdcsvd<\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<float,3,5>} >() ));
00079 
00080     \textcolor{keywordtype}{int} r = internal::random<int>(1, EIGEN\_TEST\_MAX\_SIZE/2),
00081         c = internal::random<int>(1, EIGEN\_TEST\_MAX\_SIZE/2);
00082     
00083     TEST\_SET\_BUT\_UNUSED\_VARIABLE(r)
00084     TEST\_SET\_BUT\_UNUSED\_VARIABLE(c)
00085     
00086     CALL\_SUBTEST\_6((  bdcsvd(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<double,Dynamic,2>}(r,2)) ));
00087     CALL\_SUBTEST\_7((  bdcsvd(MatrixXf(r,c)) ));
00088     CALL\_SUBTEST\_7((  compare\_bdc\_jacobi(MatrixXf(r,c)) ));
00089     CALL\_SUBTEST\_10(( bdcsvd(MatrixXd(r,c)) ));
00090     CALL\_SUBTEST\_10(( compare\_bdc\_jacobi(MatrixXd(r,c)) ));
00091     CALL\_SUBTEST\_8((  bdcsvd(MatrixXcd(r,c)) ));
00092     CALL\_SUBTEST\_8((  compare\_bdc\_jacobi(MatrixXcd(r,c)) ));
00093 
00094     \textcolor{comment}{// Test on inf/nan matrix}
00095     CALL\_SUBTEST\_7(  (svd\_inf\_nan<\hyperlink{group___s_v_d___module_class_eigen_1_1_b_d_c_s_v_d}{BDCSVD<MatrixXf>}, MatrixXf>()) );
00096     CALL\_SUBTEST\_10( (svd\_inf\_nan<\hyperlink{group___s_v_d___module_class_eigen_1_1_b_d_c_s_v_d}{BDCSVD<MatrixXd>}, MatrixXd>()) );
00097   \}
00098 
00099   \textcolor{comment}{// test matrixbase method}
00100   CALL\_SUBTEST\_1(( bdcsvd\_method<Matrix2cd>() ));
00101   CALL\_SUBTEST\_3(( bdcsvd\_method<Matrix3f>() ));
00102 
00103   \textcolor{comment}{// Test problem size constructors}
00104   CALL\_SUBTEST\_7( \hyperlink{group___s_v_d___module_class_eigen_1_1_b_d_c_s_v_d}{BDCSVD<MatrixXf>}(10,10) );
00105 
00106   \textcolor{comment}{// Check that preallocation avoids subsequent mallocs}
00107   CALL\_SUBTEST\_9( svd\_preallocate<void>() );
00108 
00109   CALL\_SUBTEST\_2( svd\_underoverflow<void>() );
00110 \}
00111 
\end{DoxyCode}
