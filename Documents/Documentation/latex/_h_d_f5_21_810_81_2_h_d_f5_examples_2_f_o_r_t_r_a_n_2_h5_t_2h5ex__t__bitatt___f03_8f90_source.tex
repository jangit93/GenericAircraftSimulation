\hypertarget{_h_d_f5_21_810_81_2_h_d_f5_examples_2_f_o_r_t_r_a_n_2_h5_t_2h5ex__t__bitatt___f03_8f90_source}{}\section{H\+D\+F5/1.10.1/\+H\+D\+F5\+Examples/\+F\+O\+R\+T\+R\+A\+N/\+H5\+T/h5ex\+\_\+t\+\_\+bitatt\+\_\+\+F03.f90}
\label{_h_d_f5_21_810_81_2_h_d_f5_examples_2_f_o_r_t_r_a_n_2_h5_t_2h5ex__t__bitatt___f03_8f90_source}\index{h5ex\+\_\+t\+\_\+bitatt\+\_\+\+F03.\+f90@{h5ex\+\_\+t\+\_\+bitatt\+\_\+\+F03.\+f90}}

\begin{DoxyCode}
00001 \textcolor{comment}{!************************************************************}
00002 \textcolor{comment}{!}
00003 \textcolor{comment}{!  This example shows how to read and write bitfield}
00004 \textcolor{comment}{!  datatypes to an attribute.  The program first writes bit}
00005 \textcolor{comment}{!  fields to an attribute with a dataspace of DIM0xDIM1, then}
00006 \textcolor{comment}{!  closes the file.  Next, it reopens the file, reads back}
00007 \textcolor{comment}{!  the data, and outputs it to the screen.}
00008 \textcolor{comment}{!}
00009 \textcolor{comment}{!  This file is intended for use with HDF5 Library version 1.8}
00010 \textcolor{comment}{!  with --enable-fortran2003}
00011 \textcolor{comment}{!}
00012 \textcolor{comment}{!************************************************************}
00013 \textcolor{keyword}{PROGRAM} main
00014 
00015   \textcolor{keywordtype}{USE }hdf5
00016   \textcolor{keywordtype}{USE }iso\_c\_binding
00017   
00018   \textcolor{keywordtype}{IMPLICIT NONE}
00019 
00020   \textcolor{keywordtype}{CHARACTER(LEN=20)}, \textcolor{keywordtype}{PARAMETER} :: filename  = \textcolor{stringliteral}{"h5ex\_t\_bitatt\_F03.h5"}
00021   \textcolor{keywordtype}{CHARACTER(LEN=3)} , \textcolor{keywordtype}{PARAMETER} :: dataset   = \textcolor{stringliteral}{"DS1"}
00022   \textcolor{keywordtype}{CHARACTER(LEN=2)} , \textcolor{keywordtype}{PARAMETER} :: attribute = \textcolor{stringliteral}{"A1"}
00023   \textcolor{keywordtype}{INTEGER}          , \textcolor{keywordtype}{PARAMETER} :: dim0      = 4
00024   \textcolor{keywordtype}{INTEGER}          , \textcolor{keywordtype}{PARAMETER} :: dim1      = 7
00025 
00026   \textcolor{keywordtype}{INTEGER(HID\_T)}  :: \hyperlink{structfile}{file}, space, dset, attr \textcolor{comment}{! Handles}
00027   \textcolor{keywordtype}{INTEGER} :: hdferr
00028   \textcolor{keywordtype}{INTEGER(HSIZE\_T)}, \textcolor{keywordtype}{DIMENSION(1:2)}   :: dims = (/dim0, dim1/)
00029   \textcolor{keywordtype}{INTEGER(HSIZE\_T)}, \textcolor{keywordtype}{DIMENSION(1:2)}   :: maxdims
00030   \textcolor{keywordtype}{INTEGER(C\_SIGNED\_CHAR)}, \textcolor{keywordtype}{DIMENSION(1:dim0, 1:dim1)}, \textcolor{keywordtype}{TARGET} :: wdata              \textcolor{comment}{! Write buffer }
00031   \textcolor{keywordtype}{INTEGER(C\_SIGNED\_CHAR)}, \textcolor{keywordtype}{DIMENSION(:,:)}, \textcolor{keywordtype}{ALLOCATABLE}, \textcolor{keywordtype}{TARGET} :: rdata    \textcolor{comment}{! Read buffer}
00032   \textcolor{keywordtype}{INTEGER} :: a, b, c, d
00033   \textcolor{keywordtype}{INTEGER} :: i, j
00034   \textcolor{keywordtype}{INTEGER}, \textcolor{keywordtype}{PARAMETER} :: hex =  z\textcolor{stringliteral}{'00000003'}
00035   \textcolor{keywordtype}{TYPE}(c\_ptr) :: f\_ptr
00036   \textcolor{comment}{!}
00037   \textcolor{comment}{! Initialize FORTRAN interface.}
00038   \textcolor{comment}{!}
00039   \textcolor{keyword}{CALL }h5open\_f(hdferr)
00040   \textcolor{comment}{!}
00041   \textcolor{comment}{! Initialize data.  We will manually pack 4 2-bit integers into}
00042   \textcolor{comment}{! each unsigned char data element.}
00043   \textcolor{comment}{!}
00044   \textcolor{keywordflow}{DO} i = 0, dim0-1
00045      \textcolor{keywordflow}{DO} j = 0, dim1-1
00046         wdata(i+1,j+1) = 0
00047         wdata(i+1,j+1) = ior( wdata(i+1,j+1), iand(i * j - j, hex))   \textcolor{comment}{! Field "A"}
00048         wdata(i+1,j+1) = ior( wdata(i+1,j+1), ishft(iand(i,hex),2))   \textcolor{comment}{! Field "B"}
00049         wdata(i+1,j+1) = ior( wdata(i+1,j+1), ishft(iand(j,hex),4))   \textcolor{comment}{! Field "C"}
00050         wdata(i+1,j+1) = ior( wdata(i+1,j+1), ishft(iand(i+j,hex),6)) \textcolor{comment}{! Field "D"}
00051 \textcolor{keywordflow}{     ENDDO}
00052 \textcolor{keywordflow}{  ENDDO}
00053   \textcolor{comment}{!}
00054   \textcolor{comment}{! Create a new file using the default properties.}
00055   \textcolor{comment}{!}
00056   \textcolor{keyword}{CALL }h5fcreate\_f(filename, h5f\_acc\_trunc\_f, \hyperlink{structfile}{file}, hdferr)
00057   \textcolor{comment}{!}
00058   \textcolor{comment}{! Create dataset with a null dataspace.}
00059   \textcolor{comment}{!}
00060   \textcolor{keyword}{CALL }h5screate\_f( h5s\_null\_f, space, hdferr)
00061   \textcolor{keyword}{CALL }h5dcreate\_f(\hyperlink{structfile}{file}, dataset, h5t\_std\_i32le, space, dset, hdferr)
00062   \textcolor{keyword}{CALL }h5sclose\_f(space, hdferr)
00063   \textcolor{comment}{!}
00064   \textcolor{comment}{! Create dataspace.  Setting maximum size to be the current size.}
00065   \textcolor{comment}{!}
00066   \textcolor{keyword}{CALL }h5screate\_simple\_f(2, dims, space, hdferr)
00067   \textcolor{comment}{!}
00068   \textcolor{comment}{! Create the attribute and write the bitfield data to it.}
00069   \textcolor{comment}{!}
00070   \textcolor{keyword}{CALL }h5acreate\_f(dset, attribute,  h5t\_std\_b8be, space, attr, hdferr)
00071   f\_ptr = c\_loc(wdata(1,1))
00072   \textcolor{keyword}{CALL }h5awrite\_f(attr, h5t\_native\_b8, f\_ptr, hdferr)
00073   \textcolor{comment}{!}
00074   \textcolor{comment}{! Close and release resources.}
00075   \textcolor{comment}{!}
00076   \textcolor{keyword}{CALL }h5aclose\_f(attr, hdferr)
00077   \textcolor{keyword}{CALL }h5dclose\_f(dset, hdferr)
00078   \textcolor{keyword}{CALL }h5sclose\_f(space, hdferr)
00079   \textcolor{keyword}{CALL }h5fclose\_f(\hyperlink{structfile}{file}, hdferr)
00080   \textcolor{comment}{!}
00081   \textcolor{comment}{! Now we begin the read section of this example. }
00082   \textcolor{comment}{!}
00083   \textcolor{comment}{! Open file, dataset, and attribute.}
00084   \textcolor{comment}{!}
00085   \textcolor{keyword}{CALL }h5fopen\_f(filename, h5f\_acc\_rdonly\_f, \hyperlink{structfile}{file}, hdferr)
00086   \textcolor{keyword}{CALL }h5dopen\_f(\hyperlink{structfile}{file}, dataset, dset, hdferr)
00087   \textcolor{keyword}{CALL }h5aopen\_f(dset, attribute, attr, hdferr)
00088   \textcolor{comment}{!}
00089   \textcolor{comment}{! Get dataspace and allocate memory for read buffer.}
00090   \textcolor{comment}{!}
00091   \textcolor{keyword}{CALL }h5aget\_space\_f(attr, space, hdferr)
00092   \textcolor{keyword}{CALL }h5sget\_simple\_extent\_dims\_f(space, dims, maxdims, hdferr)
00093   \textcolor{keyword}{ALLOCATE}(rdata(1:dims(1),1:dims(2)))
00094   \textcolor{comment}{!}
00095   \textcolor{comment}{! Read the data.}
00096   \textcolor{comment}{!}
00097   f\_ptr = c\_loc(rdata)
00098   \textcolor{keyword}{CALL }h5aread\_f(attr,  h5t\_native\_b8, f\_ptr, hdferr)
00099   \textcolor{comment}{!}
00100   \textcolor{comment}{! Output the data to the screen.}
00101   \textcolor{comment}{!}
00102   \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'(A,":")'}) attribute
00103   \textcolor{keywordflow}{DO} i = 1, dims(1)
00104      \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'(" [ ")'}, advance=\textcolor{stringliteral}{'NO'})
00105      \textcolor{keywordflow}{DO} j = 1, dims(2)
00106         a = iand(rdata(i,j), hex) \textcolor{comment}{! Retrieve field "A"}
00107         b = iand(ishft(rdata(i,j),-2), hex) \textcolor{comment}{! Retrieve field "B"}
00108         c = iand(ishft(rdata(i,j),-4), hex) \textcolor{comment}{! Retrieve field "C"}
00109         d = iand(ishft(rdata(i,j),-6), hex) \textcolor{comment}{! Retrieve field "D"}
00110         \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'(A1,4I2,A2)'}, advance=\textcolor{stringliteral}{'NO'}) \textcolor{stringliteral}{"\{"},a, b, c, d,\textcolor{stringliteral}{"\} "}
00111 \textcolor{keywordflow}{     ENDDO}
00112      \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'(A1)'}) \textcolor{stringliteral}{"]"}
00113 \textcolor{keywordflow}{  ENDDO}
00114   \textcolor{comment}{!}
00115   \textcolor{comment}{! Close and release resources.}
00116   \textcolor{comment}{!}
00117   \textcolor{keyword}{DEALLOCATE}(rdata)
00118   \textcolor{keyword}{CALL }h5aclose\_f(attr, hdferr)
00119   \textcolor{keyword}{CALL }h5dclose\_f(dset, hdferr)
00120   \textcolor{keyword}{CALL }h5sclose\_f(space, hdferr)
00121   \textcolor{keyword}{CALL }h5fclose\_f(\hyperlink{structfile}{file}, hdferr)
00122 \textcolor{keyword}{END PROGRAM }main
\end{DoxyCode}
