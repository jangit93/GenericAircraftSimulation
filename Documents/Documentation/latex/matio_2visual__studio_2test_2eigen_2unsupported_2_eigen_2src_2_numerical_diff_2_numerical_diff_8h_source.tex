\hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_numerical_diff_2_numerical_diff_8h_source}{}\section{matio/visual\+\_\+studio/test/eigen/unsupported/\+Eigen/src/\+Numerical\+Diff/\+Numerical\+Diff.h}
\label{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_numerical_diff_2_numerical_diff_8h_source}\index{Numerical\+Diff.\+h@{Numerical\+Diff.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{// -*- coding: utf-8}
00002 \textcolor{comment}{// vim: set fileencoding=utf-8}
00003 
00004 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00005 \textcolor{comment}{// for linear algebra.}
00006 \textcolor{comment}{//}
00007 \textcolor{comment}{// Copyright (C) 2009 Thomas Capricelli <orzel@freehackers.org>}
00008 \textcolor{comment}{//}
00009 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00010 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00011 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00012 
00013 \textcolor{preprocessor}{#ifndef EIGEN\_NUMERICAL\_DIFF\_H}
00014 \textcolor{preprocessor}{#define EIGEN\_NUMERICAL\_DIFF\_H}
00015 
00016 \textcolor{keyword}{namespace }\hyperlink{namespace_eigen}{Eigen} \{ 
00017 
00018 \textcolor{keyword}{enum} NumericalDiffMode \{
00019     Forward,
00020     Central
00021 \};
00022 
00023 
00035 \textcolor{keyword}{template}<\textcolor{keyword}{typename} \_Functor, NumericalDiffMode mode=Forward>
00036 \textcolor{keyword}{class }NumericalDiff : \textcolor{keyword}{public} \_Functor
00037 \{
00038 \textcolor{keyword}{public}:
00039     \textcolor{keyword}{typedef} \_Functor \hyperlink{struct_functor}{Functor};
00040     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Functor::Scalar Scalar;
00041     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Functor::InputType InputType;
00042     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Functor::ValueType ValueType;
00043     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Functor::JacobianType JacobianType;
00044 
00045     NumericalDiff(Scalar \_epsfcn=0.) : Functor(), epsfcn(\_epsfcn) \{\}
00046     NumericalDiff(\textcolor{keyword}{const} Functor& f, Scalar \_epsfcn=0.) : Functor(f), epsfcn(\_epsfcn) \{\}
00047 
00048     \textcolor{comment}{// forward constructors}
00049     \textcolor{keyword}{template}<\textcolor{keyword}{typename} T0>
00050         NumericalDiff(\textcolor{keyword}{const} T0& a0) : Functor(a0), epsfcn(0) \{\}
00051     \textcolor{keyword}{template}<\textcolor{keyword}{typename} T0, \textcolor{keyword}{typename} T1>
00052         NumericalDiff(\textcolor{keyword}{const} T0& a0, \textcolor{keyword}{const} T1& a1) : Functor(a0, a1), epsfcn(0) \{\}
00053     \textcolor{keyword}{template}<\textcolor{keyword}{typename} T0, \textcolor{keyword}{typename} T1, \textcolor{keyword}{typename} T2>
00054         NumericalDiff(\textcolor{keyword}{const} T0& a0, \textcolor{keyword}{const} T1& a1, \textcolor{keyword}{const} T2& a2) : Functor(a0, a1, a2), epsfcn(0) \{\}
00055 
00056     \textcolor{keyword}{enum} \{
00057         InputsAtCompileTime = Functor::InputsAtCompileTime,
00058         ValuesAtCompileTime = Functor::ValuesAtCompileTime
00059     \};
00060 
\Hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_numerical_diff_2_numerical_diff_8h_source_l00064}\hyperlink{class_eigen_1_1_numerical_diff_a8fc63f1c3307cc6e61dc4d70c57b5037}{00064}     \textcolor{keywordtype}{int} \hyperlink{class_eigen_1_1_numerical_diff_a8fc63f1c3307cc6e61dc4d70c57b5037}{df}(\textcolor{keyword}{const} InputType& \_x, JacobianType &jac)\textcolor{keyword}{ const}
00065 \textcolor{keyword}{    }\{
00066         \textcolor{keyword}{using} std::sqrt;
00067         \textcolor{keyword}{using} std::abs;
00068         \textcolor{comment}{/* Local variables */}
00069         Scalar h;
00070         \textcolor{keywordtype}{int} nfev=0;
00071         \textcolor{keyword}{const} \textcolor{keyword}{typename} InputType::Index n = \_x.size();
00072         \textcolor{keyword}{const} Scalar eps = sqrt(((std::max)(epsfcn,\hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<Scalar>::epsilon}() )
      ));
00073         ValueType val1, val2;
00074         InputType x = \_x;
00075         \textcolor{comment}{// TODO : we should do this only if the size is not already known}
00076         val1.resize(Functor::values());
00077         val2.resize(Functor::values());
00078 
00079         \textcolor{comment}{// initialization}
00080         \textcolor{keywordflow}{switch}(mode) \{
00081             \textcolor{keywordflow}{case} Forward:
00082                 \textcolor{comment}{// compute f(x)}
00083                 Functor::operator()(x, val1); nfev++;
00084                 \textcolor{keywordflow}{break};
00085             \textcolor{keywordflow}{case} Central:
00086                 \textcolor{comment}{// do nothing}
00087                 \textcolor{keywordflow}{break};
00088             \textcolor{keywordflow}{default}:
00089                 eigen\_assert(\textcolor{keyword}{false});
00090         \};
00091 
00092         \textcolor{comment}{// Function Body}
00093         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < n; ++j) \{
00094             h = eps * abs(x[j]);
00095             \textcolor{keywordflow}{if} (h == 0.) \{
00096                 h = eps;
00097             \}
00098             \textcolor{keywordflow}{switch}(mode) \{
00099                 \textcolor{keywordflow}{case} Forward:
00100                     x[j] += h;
00101                     Functor::operator()(x, val2);
00102                     nfev++;
00103                     x[j] = \_x[j];
00104                     jac.col(j) = (val2-val1)/h;
00105                     \textcolor{keywordflow}{break};
00106                 \textcolor{keywordflow}{case} Central:
00107                     x[j] += h;
00108                     Functor::operator()(x, val2); nfev++;
00109                     x[j] -= 2*h;
00110                     Functor::operator()(x, val1); nfev++;
00111                     x[j] = \_x[j];
00112                     jac.col(j) = (val2-val1)/(2*h);
00113                     \textcolor{keywordflow}{break};
00114                 \textcolor{keywordflow}{default}:
00115                     eigen\_assert(\textcolor{keyword}{false});
00116             \};
00117         \}
00118         \textcolor{keywordflow}{return} nfev;
00119     \}
00120 \textcolor{keyword}{private}:
00121     Scalar epsfcn;
00122 
00123     \hyperlink{class_eigen_1_1_numerical_diff}{NumericalDiff}& operator=(\textcolor{keyword}{const} \hyperlink{class_eigen_1_1_numerical_diff}{NumericalDiff}&);
00124 \};
00125 
00126 \} \textcolor{comment}{// end namespace Eigen}
00127 
00128 \textcolor{comment}{//vim: ai ts=4 sts=4 et sw=4}
00129 \textcolor{preprocessor}{#endif // EIGEN\_NUMERICAL\_DIFF\_H}
00130 
\end{DoxyCode}
