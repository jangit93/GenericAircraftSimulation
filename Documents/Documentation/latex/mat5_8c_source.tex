\hypertarget{mat5_8c_source}{}\section{mat5.\+c}
\label{mat5_8c_source}\index{mat5.\+c@{mat5.\+c}}

\begin{DoxyCode}
00001 
00005 \textcolor{comment}{/*}
00006 \textcolor{comment}{ * Copyright (c) 2005-2018, Christopher C. Hulbert}
00007 \textcolor{comment}{ * All rights reserved.}
00008 \textcolor{comment}{ *}
00009 \textcolor{comment}{ * Redistribution and use in source and binary forms, with or without}
00010 \textcolor{comment}{ * modification, are permitted provided that the following conditions are met:}
00011 \textcolor{comment}{ *}
00012 \textcolor{comment}{ * 1. Redistributions of source code must retain the above copyright notice, this}
00013 \textcolor{comment}{ *    list of conditions and the following disclaimer.}
00014 \textcolor{comment}{ *}
00015 \textcolor{comment}{ * 2. Redistributions in binary form must reproduce the above copyright notice,}
00016 \textcolor{comment}{ *    this list of conditions and the following disclaimer in the documentation}
00017 \textcolor{comment}{ *    and/or other materials provided with the distribution.}
00018 \textcolor{comment}{ *}
00019 \textcolor{comment}{ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"}
00020 \textcolor{comment}{ * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE}
00021 \textcolor{comment}{ * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE}
00022 \textcolor{comment}{ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE}
00023 \textcolor{comment}{ * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL}
00024 \textcolor{comment}{ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR}
00025 \textcolor{comment}{ * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER}
00026 \textcolor{comment}{ * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,}
00027 \textcolor{comment}{ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE}
00028 \textcolor{comment}{ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.}
00029 \textcolor{comment}{ */}
00030 
00031 \textcolor{comment}{/* FIXME: Implement Unicode support */}
00032 \textcolor{preprocessor}{#include <stdlib.h>}
00033 \textcolor{preprocessor}{#include <string.h>}
00034 \textcolor{preprocessor}{#include <stdio.h>}
00035 \textcolor{preprocessor}{#include <math.h>}
00036 \textcolor{preprocessor}{#include <time.h>}
00037 \textcolor{preprocessor}{#if defined(\_MSC\_VER) || defined(\_\_MINGW32\_\_)}
00038 \textcolor{preprocessor}{#   define strdup \_strdup}
00039 \textcolor{preprocessor}{#endif}
00040 \textcolor{preprocessor}{#include "matio\_private.h"}
00041 \textcolor{preprocessor}{#include "mat5.h"}
00042 
\Hypertarget{mat5_8c_source_l00044}\hyperlink{mat5_8c_a82bacecc4afc633b61bc3dc8ef88d1ed}{00044} \textcolor{preprocessor}{#define TYPE\_FROM\_TAG(a)          (enum matio\_types)((a) & 0x000000ff)}
00045 
\Hypertarget{mat5_8c_source_l00046}\hyperlink{mat5_8c_a85a616d27707e89bda9fd2e9bbb6a586}{00046} \textcolor{preprocessor}{#define CLASS\_FROM\_ARRAY\_FLAGS(a) (enum matio\_classes)((a) & 0x000000ff)}
00047 
\Hypertarget{mat5_8c_source_l00048}\hyperlink{mat5_8c_a24b94e17e9c34b9c795798099c710751}{00048} \textcolor{preprocessor}{#define CLASS\_TYPE\_MASK           0x000000ff}
00049 
00050 \textcolor{keyword}{static} \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t} null\_complex\_data = \{NULL,NULL\};
00051 
00052 \textcolor{comment}{/*===========================================================================}
00053 \textcolor{comment}{ *  Private functions}
00054 \textcolor{comment}{ *===========================================================================}
00055 \textcolor{comment}{ */}
00056 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} GetTypeBufSize(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar);
00057 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} GetStructFieldBufSize(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar);
00058 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} GetCellArrayFieldBufSize(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar);
00059 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} GetMatrixMaxBufSize(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar);
00060 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} GetEmptyMatrixMaxBufSize(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *name,\textcolor{keywordtype}{int} rank);
00061 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} WriteCharData(\hyperlink{struct__mat__t}{mat\_t} *mat, \textcolor{keywordtype}{void} *data, \textcolor{keywordtype}{int} N,\textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} data\_type);
00062 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} WriteEmptyCharData(\hyperlink{struct__mat__t}{mat\_t} *mat, \textcolor{keywordtype}{int} N, \textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} data\_type);
00063 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} WriteEmptyData(\hyperlink{struct__mat__t}{mat\_t} *mat,\textcolor{keywordtype}{int} N,\textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} data\_type);
00064 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} ReadNextCell( \hyperlink{struct__mat__t}{mat\_t} *mat, \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar );
00065 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} ReadNextStructField( \hyperlink{struct__mat__t}{mat\_t} *mat, \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar );
00066 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} ReadNextFunctionHandle(\hyperlink{struct__mat__t}{mat\_t} *mat, \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar);
00067 \textcolor{keyword}{static} \textcolor{keywordtype}{int}    WriteType(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar);
00068 \textcolor{keyword}{static} \textcolor{keywordtype}{int}    WriteCellArrayFieldInfo(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar);
00069 \textcolor{keyword}{static} \textcolor{keywordtype}{int}    WriteCellArrayField(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar );
00070 \textcolor{keyword}{static} \textcolor{keywordtype}{int}    WriteStructField(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar);
00071 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} Mat\_WriteEmptyVariable5(\hyperlink{struct__mat__t}{mat\_t} *mat,\textcolor{keyword}{const} \textcolor{keywordtype}{char} *name,\textcolor{keywordtype}{int} rank,
00072                   \textcolor{keywordtype}{size\_t} *dims);
00073 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
00074 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} WriteCompressedCharData(\hyperlink{struct__mat__t}{mat\_t} *mat,z\_streamp z,\textcolor{keywordtype}{void} *data,\textcolor{keywordtype}{int} N,
00075                   \textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} data\_type);
00076 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} WriteCompressedEmptyData(\hyperlink{struct__mat__t}{mat\_t} *mat,z\_streamp z,\textcolor{keywordtype}{int} N,
00077                   \textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} data\_type);
00078 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} WriteCompressedData(\hyperlink{struct__mat__t}{mat\_t} *mat,z\_streamp z,\textcolor{keywordtype}{void} *data,\textcolor{keywordtype}{int} N,
00079                   \textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} data\_type);
00080 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} WriteCompressedTypeArrayFlags(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,
00081                   z\_streamp z);
00082 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} WriteCompressedType(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,z\_streamp z);
00083 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} WriteCompressedCellArrayField(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,
00084                   z\_streamp z);
00085 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} WriteCompressedStructField(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,
00086                   z\_streamp z);
00087 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} Mat\_WriteCompressedEmptyVariable5(\hyperlink{struct__mat__t}{mat\_t} *mat,\textcolor{keyword}{const} \textcolor{keywordtype}{char} *name,
00088                   \textcolor{keywordtype}{int} rank,\textcolor{keywordtype}{size\_t} *dims,z\_streamp z);
00089 \textcolor{preprocessor}{#endif}
00090 
00097 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
00098 GetTypeBufSize(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar)
00099 \{
00100     \textcolor{keywordtype}{size\_t} nBytes = 0, data\_bytes;
00101     \textcolor{keywordtype}{size\_t} tag\_size = 8;
00102     \textcolor{keywordtype}{int}    nmemb = 1, i;
00103 
00104     \textcolor{comment}{/* Add rank and dimensions, padded to an 8 byte block */}
00105     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
00106         nmemb *= matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
00107     if ( matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} % 2 )
00108         nBytes += tag\_size + matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}*4 + 4;
00109     \textcolor{keywordflow}{else}
00110         nBytes += tag\_size + matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}*4;
00111 
00112     \textcolor{keywordflow}{switch} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} ) \{
00113         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT}:
00114         \{
00115             \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **fields = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t}**)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
00116             \textcolor{keywordtype}{int} nfields = 0;
00117             \textcolor{keywordtype}{size\_t} maxlen = 0;
00118 
00119             nfields = matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields};
00120             for ( i = 0; i < nfields; i++ ) \{
00121                 \textcolor{keywordtype}{char} *fieldname = matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i];
00122                 \textcolor{keywordflow}{if} ( NULL != fieldname && strlen(fieldname) > maxlen )
00123                     maxlen = strlen(fieldname);
00124             \}
00125             maxlen++;
00126             \textcolor{keywordflow}{while} ( nfields*maxlen % 8 != 0 )
00127                 maxlen++;
00128 
00129             nBytes += tag\_size + tag\_size + maxlen*nfields;
00130 
00131             \textcolor{comment}{/* FIXME: Add bytes for the fieldnames */}
00132             \textcolor{keywordflow}{if} ( NULL != fields && nfields > 0 ) \{
00133                 \textcolor{keywordflow}{for} ( i = 0; i < nfields*nmemb; i++ )
00134                     nBytes += tag\_size + GetStructFieldBufSize(fields[i]);
00135             \}
00136             \textcolor{keywordflow}{break};
00137         \}
00138         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2f7abb47a1c51e248bd4e5e03cc81b08}{MAT\_C\_CELL}:
00139         \{
00140             \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **cells = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t}**)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
00141             \textcolor{keywordtype}{int} ncells;
00142 
00143             if ( matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} == 0 || matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} == 0 )
00144                 \textcolor{keywordflow}{break};
00145 
00146             ncells = matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} / matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size};
00147 
00148             \textcolor{keywordflow}{if} ( NULL != cells && ncells > 0 ) \{
00149                 \textcolor{keywordtype}{int} i;
00150                 \textcolor{keywordflow}{for} ( i = 0; i < ncells; i++ )
00151                     nBytes += tag\_size + GetCellArrayFieldBufSize(cells[i]);
00152             \}
00153             \textcolor{keywordflow}{break};
00154         \}
00155         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a0d5655b7e6178a2242cb3bb56ff4c8d2}{MAT\_C\_SPARSE}:
00156         \{
00157             \hyperlink{group___m_a_t_structmat__sparse__t}{mat\_sparse\_t} *sparse = (\hyperlink{group___m_a_t_structmat__sparse__t}{mat\_sparse\_t}*)matvar->
      \hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
00158 
00159             data\_bytes = sparse->\hyperlink{group___m_a_t_aa64636ad57cf87f7a28ff5018437a850}{nir}*\textcolor{keyword}{sizeof}(mat\_int32\_t);
00160             \textcolor{keywordflow}{if} ( data\_bytes % 8 )
00161                 data\_bytes += (8 - (data\_bytes % 8));
00162             nBytes += tag\_size + data\_bytes;
00163 
00164             data\_bytes = sparse->\hyperlink{group___m_a_t_a482d8e4b40aa975f0c1daf146ebe08a4}{njc}*\textcolor{keyword}{sizeof}(mat\_int32\_t);
00165             \textcolor{keywordflow}{if} ( data\_bytes % 8 )
00166                 data\_bytes += (8 - (data\_bytes % 8));
00167             nBytes += tag\_size + data\_bytes;
00168 
00169             data\_bytes = sparse->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata}*\hyperlink{group__mat__util_gab6774aabdc124c540c1e7686d0804940}{Mat\_SizeOf}(matvar->
      \hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
00170             \textcolor{keywordflow}{if} ( data\_bytes % 8 )
00171                 data\_bytes += (8 - (data\_bytes % 8));
00172             nBytes += tag\_size + data\_bytes;
00173 
00174             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} )
00175                 nBytes += tag\_size + data\_bytes;
00176 
00177             \textcolor{keywordflow}{break};
00178         \}
00179         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40aacdec5834df0861130b393697646119c}{MAT\_C\_CHAR}:
00180             \textcolor{keywordflow}{if} ( \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a01c1bd7db68f90552862eb5d311be408}{MAT\_T\_UINT8} == matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} ||
00181                  \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8} == matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} )
00182                 data\_bytes = nmemb*\hyperlink{group__mat__util_gab6774aabdc124c540c1e7686d0804940}{Mat\_SizeOf}(\hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16});
00183             \textcolor{keywordflow}{else}
00184                 data\_bytes = nmemb*\hyperlink{group__mat__util_gab6774aabdc124c540c1e7686d0804940}{Mat\_SizeOf}(matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
00185             \textcolor{keywordflow}{if} ( data\_bytes % 8 )
00186                 data\_bytes += (8 - (data\_bytes % 8));
00187             nBytes += tag\_size + data\_bytes;
00188             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} )
00189                 nBytes += tag\_size + data\_bytes;
00190             \textcolor{keywordflow}{break};
00191         \textcolor{keywordflow}{default}:
00192             data\_bytes = nmemb*\hyperlink{group__mat__util_gab6774aabdc124c540c1e7686d0804940}{Mat\_SizeOf}(matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
00193             \textcolor{keywordflow}{if} ( data\_bytes % 8 )
00194                 data\_bytes += (8 - (data\_bytes % 8));
00195             nBytes += tag\_size + data\_bytes;
00196             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} )
00197                 nBytes += tag\_size + data\_bytes;
00198     \} \textcolor{comment}{/* switch ( matvar->class\_type ) */}
00199 
00200     \textcolor{keywordflow}{return} nBytes;
00201 \}
00202 
00209 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
00210 GetStructFieldBufSize(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar)
00211 \{
00212     \textcolor{keywordtype}{size\_t} nBytes = 0;
00213     \textcolor{keywordtype}{size\_t} tag\_size = 8, array\_flags\_size = 8;
00214 
00215     \textcolor{keywordflow}{if} ( matvar == NULL )
00216         \textcolor{keywordflow}{return} GetEmptyMatrixMaxBufSize(NULL, 2);
00217 
00218     \textcolor{comment}{/* Add the Array Flags tag and space to the number of bytes */}
00219     nBytes += tag\_size + array\_flags\_size;
00220 
00221     \textcolor{comment}{/* In a struct field, the name is just a tag with 0 bytes */}
00222     nBytes += tag\_size;
00223 
00224     nBytes += GetTypeBufSize(matvar);
00225 
00226     \textcolor{keywordflow}{return} nBytes;
00227 \}
00228 
00235 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
00236 GetCellArrayFieldBufSize(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar)
00237 \{
00238     \textcolor{keywordtype}{size\_t} nBytes = 0;
00239     \textcolor{keywordtype}{size\_t} tag\_size = 8, array\_flags\_size = 8;
00240 
00241     \textcolor{keywordflow}{if} ( matvar == NULL )
00242         \textcolor{keywordflow}{return} nBytes;
00243 
00244     \textcolor{comment}{/* Add the Array Flags tag and space to the number of bytes */}
00245     nBytes += tag\_size + array\_flags\_size;
00246 
00247     \textcolor{comment}{/* In an element of a cell array, the name is just a tag with 0 bytes */}
00248     nBytes += tag\_size;
00249 
00250     nBytes += GetTypeBufSize(matvar);
00251 
00252     \textcolor{keywordflow}{return} nBytes;
00253 \}
00254 
00261 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
00262 GetEmptyMatrixMaxBufSize(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *name,\textcolor{keywordtype}{int} rank)
00263 \{
00264     \textcolor{keywordtype}{size\_t} nBytes = 0, len;
00265     \textcolor{keywordtype}{size\_t} tag\_size = 8, array\_flags\_size = 8;
00266 
00267     \textcolor{comment}{/* Add the Array Flags tag and space to the number of bytes */}
00268     nBytes += tag\_size + array\_flags\_size;
00269 
00270     \textcolor{comment}{/* Get size of variable name, pad it to an 8 byte block, and add it to nBytes */}
00271     \textcolor{keywordflow}{if} ( NULL != name )
00272         len = strlen(name);
00273     \textcolor{keywordflow}{else}
00274         len = 4;
00275 
00276     \textcolor{keywordflow}{if} ( len <= 4 ) \{
00277         nBytes += tag\_size;
00278     \} \textcolor{keywordflow}{else} \{
00279         \textcolor{keywordflow}{if} ( len % 8 )
00280             len = len + (8 - len % 8);
00281         nBytes += tag\_size + len;
00282     \}
00283 
00284     \textcolor{comment}{/* Add rank and dimensions, padded to an 8 byte block */}
00285     \textcolor{keywordflow}{if} ( rank % 2 )
00286         nBytes += tag\_size + rank*4 + 4;
00287     \textcolor{keywordflow}{else}
00288         nBytes += tag\_size + rank*4;
00289 
00290     \textcolor{comment}{/* Data tag */}
00291     nBytes += tag\_size;
00292 
00293     \textcolor{keywordflow}{return} nBytes;
00294 \}
00295 
00302 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
00303 GetMatrixMaxBufSize(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar)
00304 \{
00305     \textcolor{keywordtype}{size\_t} nBytes = 0, len;
00306     \textcolor{keywordtype}{size\_t} tag\_size = 8, array\_flags\_size = 8;
00307 
00308     \textcolor{keywordflow}{if} ( matvar == NULL )
00309         \textcolor{keywordflow}{return} nBytes;
00310 
00311     \textcolor{comment}{/* Add the Array Flags tag and space to the number of bytes */}
00312     nBytes += tag\_size + array\_flags\_size;
00313 
00314     \textcolor{comment}{/* Get size of variable name, pad it to an 8 byte block, and add it to nBytes */}
00315     \textcolor{keywordflow}{if} ( NULL != matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} )
00316         len = strlen(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
00317     \textcolor{keywordflow}{else}
00318         len=4;
00319 
00320     \textcolor{keywordflow}{if} ( len <= 4 ) \{
00321         nBytes += tag\_size;
00322     \} \textcolor{keywordflow}{else} \{
00323         \textcolor{keywordflow}{if} ( len % 8 )
00324             len = len + (8 - len % 8);
00325         nBytes += tag\_size + len;
00326     \}
00327 
00328     nBytes += GetTypeBufSize(matvar);
00329 
00330     \textcolor{keywordflow}{return} nBytes;
00331 \}
00332 
00349 \hyperlink{struct__mat__t}{mat\_t} *
\Hypertarget{mat5_8c_source_l00350}\hyperlink{mat5_8c_aacff52cdf3427b35a54c111fa3d7bb21}{00350} \hyperlink{mat5_8c_aacff52cdf3427b35a54c111fa3d7bb21}{Mat\_Create5}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *matname,\textcolor{keyword}{const} \textcolor{keywordtype}{char} *hdr\_str)
00351 \{
00352     FILE *fp;
00353     mat\_int16\_t endian = 0, version;
00354     \hyperlink{struct__mat__t}{mat\_t} *mat = NULL;
00355     \textcolor{keywordtype}{size\_t} err;
00356     time\_t t;
00357 
00358     fp = fopen(matname,\textcolor{stringliteral}{"w+b"});
00359     \textcolor{keywordflow}{if} ( !fp )
00360         \textcolor{keywordflow}{return} NULL;
00361 
00362     mat = (\hyperlink{struct__mat__t}{mat\_t}*)malloc(\textcolor{keyword}{sizeof}(*mat));
00363     \textcolor{keywordflow}{if} ( mat == NULL ) \{
00364         fclose(fp);
00365         \textcolor{keywordflow}{return} NULL;
00366     \}
00367 
00368     mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp}            = NULL;
00369     mat->\hyperlink{struct__mat__t_a5ed5d0e4e3c4d76b626a8a1772d579c4}{header}        = NULL;
00370     mat->\hyperlink{struct__mat__t_a19317c01209959d755d69311960d3eec}{subsys\_offset} = NULL;
00371     mat->\hyperlink{struct__mat__t_a340b191598135edd03b6dec847f0b1b1}{filename}      = NULL;
00372     mat->\hyperlink{struct__mat__t_a729c2bc0afc97485057a5af425635b1a}{version}       = 0;
00373     mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap}      = 0;
00374     mat->\hyperlink{struct__mat__t_aa43288b63b8edb7cadf0b79e2d1df2ee}{mode}          = 0;
00375     mat->\hyperlink{struct__mat__t_a0f87794a6113bd568fe591953e20ddf3}{bof}           = 128;
00376     mat->\hyperlink{struct__mat__t_a0163a12f9735356723bb604992639d9e}{next\_index}    = 0;
00377     mat->\hyperlink{struct__mat__t_af37d0ba323e65edb27ecd5a2f766a3a4}{num\_datasets}  = 0;
00378 \textcolor{preprocessor}{#if defined(MAT73) && MAT73}
00379     mat->refs\_id       = -1;
00380 \textcolor{preprocessor}{#endif}
00381     mat->\hyperlink{struct__mat__t_a1bc6c604459d0787801d5e53d365684c}{dir}           = NULL;
00382 
00383     t = time(NULL);
00384     mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp}       = fp;
00385     mat->\hyperlink{struct__mat__t_a340b191598135edd03b6dec847f0b1b1}{filename} = \hyperlink{group__mat__util_ga291b08f933c75fb70e3736b669896ebd}{strdup\_printf}(\textcolor{stringliteral}{"%s"},matname);
00386     mat->\hyperlink{struct__mat__t_aa43288b63b8edb7cadf0b79e2d1df2ee}{mode}     = \hyperlink{group___m_a_t_ggaa9dcbc70f538af79bd557593ff6b5cdba0f65f27ea42fde32d62b702b82329c1f}{MAT\_ACC\_RDWR};
00387     mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} = 0;
00388     mat->\hyperlink{struct__mat__t_a5ed5d0e4e3c4d76b626a8a1772d579c4}{header}   = (\textcolor{keywordtype}{char}*)malloc(128*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}));
00389     mat->\hyperlink{struct__mat__t_a19317c01209959d755d69311960d3eec}{subsys\_offset} = (\textcolor{keywordtype}{char}*)malloc(8*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}));
00390     memset(mat->\hyperlink{struct__mat__t_a5ed5d0e4e3c4d76b626a8a1772d579c4}{header},\textcolor{charliteral}{' '},128);
00391     \textcolor{keywordflow}{if} ( hdr\_str == NULL ) \{
00392         err = mat\_snprintf(mat->\hyperlink{struct__mat__t_a5ed5d0e4e3c4d76b626a8a1772d579c4}{header},116,\textcolor{stringliteral}{"MATLAB 5.0 MAT-file, Platform: %s, "}
00393                 \textcolor{stringliteral}{"Created by: libmatio v%d.%d.%d on %s"}, MATIO\_PLATFORM,
00394                 MATIO\_MAJOR\_VERSION, MATIO\_MINOR\_VERSION, MATIO\_RELEASE\_LEVEL,
00395                 ctime(&t));
00396     \} \textcolor{keywordflow}{else} \{
00397         err = mat\_snprintf(mat->\hyperlink{struct__mat__t_a5ed5d0e4e3c4d76b626a8a1772d579c4}{header},116,\textcolor{stringliteral}{"%s"},hdr\_str);
00398     \}
00399     \textcolor{keywordflow}{if} ( err >= 116 )
00400         mat->\hyperlink{struct__mat__t_a5ed5d0e4e3c4d76b626a8a1772d579c4}{header}[115] = \textcolor{charliteral}{'\(\backslash\)0'}; \textcolor{comment}{/* Just to make sure it's NULL terminated */}
00401     memset(mat->\hyperlink{struct__mat__t_a19317c01209959d755d69311960d3eec}{subsys\_offset},\textcolor{charliteral}{' '},8);
00402     mat->\hyperlink{struct__mat__t_a729c2bc0afc97485057a5af425635b1a}{version} = (int)0x0100;
00403     endian = 0x4d49;
00404 
00405     version = 0x0100;
00406 
00407     fwrite(mat->\hyperlink{struct__mat__t_a5ed5d0e4e3c4d76b626a8a1772d579c4}{header},1,116,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00408     fwrite(mat->\hyperlink{struct__mat__t_a19317c01209959d755d69311960d3eec}{subsys\_offset},1,8,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00409     fwrite(&version,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00410     fwrite(&endian,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00411 
00412     \textcolor{keywordflow}{return} mat;
00413 \}
00414 
00431 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
00432 WriteCharData(\hyperlink{struct__mat__t}{mat\_t} *mat, \textcolor{keywordtype}{void} *data, \textcolor{keywordtype}{int} N,\textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} data\_type)
00433 \{
00434     \textcolor{keywordtype}{int} nBytes = 0, i;
00435     \textcolor{keywordtype}{size\_t} byteswritten = 0;
00436     mat\_int8\_t pad1 = 0;
00437 
00438     \textcolor{keywordflow}{switch} ( data\_type ) \{
00439         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16}:
00440         \{
00441             nBytes = N*2;
00442             fwrite(&data\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00443             fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00444             \textcolor{keywordflow}{if} ( NULL != data && N > 0 )
00445                 fwrite(data,2,N,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00446             \textcolor{keywordflow}{if} ( nBytes % 8 )
00447                 \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
00448                     fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00449             \textcolor{keywordflow}{break};
00450         \}
00451         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8}:
00452         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a01c1bd7db68f90552862eb5d311be408}{MAT\_T\_UINT8}:
00453         \{
00454             mat\_uint8\_t *ptr;
00455             mat\_uint16\_t c;
00456 
00457             \textcolor{comment}{/* Matlab can't read MAT\_C\_CHAR as uint8, needs uint16 */}
00458             nBytes = N*2;
00459             data\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16};
00460             fwrite(&data\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00461             fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00462             ptr = (mat\_uint8\_t*)data;
00463             \textcolor{keywordflow}{if} ( NULL == ptr )
00464                 \textcolor{keywordflow}{break};
00465             \textcolor{keywordflow}{for} ( i = 0; i < N; i++ ) \{
00466                 c = (mat\_uint16\_t)*(\textcolor{keywordtype}{char} *)ptr;
00467                 fwrite(&c,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00468                 ptr++;
00469             \}
00470             \textcolor{keywordflow}{if} ( nBytes % 8 )
00471                 \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
00472                     fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00473             \textcolor{keywordflow}{break};
00474         \}
00475         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453ac34ad81f5cbd3b7d0d95e57e5be0149b}{MAT\_T\_UTF8}:
00476         \{
00477             mat\_uint8\_t *ptr;
00478 
00479             nBytes = N;
00480             fwrite(&data\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00481             fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00482             ptr = (mat\_uint8\_t*)data;
00483             \textcolor{keywordflow}{if} ( NULL != ptr && nBytes > 0 )
00484                 fwrite(ptr,1,nBytes,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00485             \textcolor{keywordflow}{if} ( nBytes % 8 )
00486                 \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
00487                     fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00488             \textcolor{keywordflow}{break};
00489         \}
00490         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a2a7318fe8bf9464935e7ed8902618293}{MAT\_T\_UNKNOWN}:
00491         \{
00492             \textcolor{comment}{/* Sometimes empty char data will have MAT\_T\_UNKNOWN, so just write}
00493 \textcolor{comment}{             * a data tag}
00494 \textcolor{comment}{             */}
00495             nBytes = N*2;
00496             data\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16};
00497             fwrite(&data\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00498             fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00499             \textcolor{keywordflow}{break};
00500         \}
00501         \textcolor{keywordflow}{default}:
00502             \textcolor{keywordflow}{break};
00503     \}
00504     byteswritten += nBytes;
00505     \textcolor{keywordflow}{return} byteswritten;
00506 \}
00507 
00508 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
00509 
00524 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
00525 WriteCompressedCharData(\hyperlink{struct__mat__t}{mat\_t} *mat,z\_streamp z,\textcolor{keywordtype}{void} *data,\textcolor{keywordtype}{int} N,
00526     \textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} data\_type)
00527 \{
00528     \textcolor{keywordtype}{int} data\_size, data\_tag[2], byteswritten = 0;
00529     \textcolor{keywordtype}{int} buf\_size = 1024;
00530     mat\_uint8\_t   buf[1024], pad[8] = \{0,\};
00531 
00532     \textcolor{keywordflow}{if} ( mat == NULL || mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp} == NULL )
00533         \textcolor{keywordflow}{return} 0;
00534 
00535     \textcolor{keywordflow}{switch} ( data\_type ) \{
00536         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16}:
00537         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453ac34ad81f5cbd3b7d0d95e57e5be0149b}{MAT\_T\_UTF8}:
00538             data\_size = \hyperlink{group__mat__util_gab6774aabdc124c540c1e7686d0804940}{Mat\_SizeOf}(data\_type);
00539             data\_tag[0] = data\_type;
00540             data\_tag[1] = N*data\_size;
00541             z->next\_in  = ZLIB\_BYTE\_PTR(data\_tag);
00542             z->avail\_in = 8;
00543             \textcolor{keywordflow}{do} \{
00544                 z->next\_out  = buf;
00545                 z->avail\_out = buf\_size;
00546                 deflate(z,Z\_NO\_FLUSH);
00547                 byteswritten += fwrite(buf,1,buf\_size-z->avail\_out,(FILE*)mat->
      \hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00548             \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
00549 
00550             \textcolor{comment}{/* exit early if this is an empty data */}
00551             \textcolor{keywordflow}{if} ( NULL == data || N < 1 )
00552                 \textcolor{keywordflow}{break};
00553 
00554             z->next\_in  = (Bytef*)data;
00555             z->avail\_in = data\_size*N;
00556             \textcolor{keywordflow}{do} \{
00557                 z->next\_out  = buf;
00558                 z->avail\_out = buf\_size;
00559                 deflate(z,Z\_NO\_FLUSH);
00560                 byteswritten += fwrite(buf,1,buf\_size-z->avail\_out,(FILE*)mat->
      \hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00561             \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
00562             \textcolor{comment}{/* Add/Compress padding to pad to 8-byte boundary */}
00563             \textcolor{keywordflow}{if} ( N*data\_size % 8 ) \{
00564                 z->next\_in  = pad;
00565                 z->avail\_in = 8 - (N*data\_size % 8);
00566                 \textcolor{keywordflow}{do} \{
00567                     z->next\_out  = buf;
00568                     z->avail\_out = buf\_size;
00569                     deflate(z,Z\_NO\_FLUSH);
00570                     byteswritten += fwrite(buf,1,buf\_size-z->avail\_out,(FILE*)mat->
      \hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00571                 \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
00572             \}
00573             \textcolor{keywordflow}{break};
00574         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8}:
00575         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a01c1bd7db68f90552862eb5d311be408}{MAT\_T\_UINT8}:
00576         \{
00577             mat\_uint8\_t *ptr;
00578             mat\_uint16\_t c;
00579             \textcolor{keywordtype}{int} i;
00580 
00581             \textcolor{comment}{/* Matlab can't read MAT\_C\_CHAR as uint8, needs uint16 */}
00582             data\_size   = 2;
00583             data\_tag[0] = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16};
00584             data\_tag[1] = N*data\_size;
00585             z->next\_in  = ZLIB\_BYTE\_PTR(data\_tag);
00586             z->avail\_in = 8;
00587             \textcolor{keywordflow}{do} \{
00588                 z->next\_out  = buf;
00589                 z->avail\_out = buf\_size;
00590                 deflate(z,Z\_NO\_FLUSH);
00591                 byteswritten += fwrite(buf,1,buf\_size-z->avail\_out,(FILE*)mat->
      \hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00592             \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
00593 
00594             \textcolor{comment}{/* exit early if this is an empty data */}
00595             \textcolor{keywordflow}{if} ( NULL == data || N < 1 )
00596                 \textcolor{keywordflow}{break};
00597 
00598             z->next\_in  = (Bytef*)data;
00599             z->avail\_in = data\_size*N;
00600             ptr = (mat\_uint8\_t*)data;
00601             \textcolor{keywordflow}{for} ( i = 0; i < N; i++ ) \{
00602                 c = (mat\_uint16\_t)*(\textcolor{keywordtype}{char} *)ptr;
00603                 z->next\_in  = ZLIB\_BYTE\_PTR(&c);
00604                 z->avail\_in = 2;
00605                 \textcolor{keywordflow}{do} \{
00606                     z->next\_out  = buf;
00607                     z->avail\_out = buf\_size;
00608                     deflate(z,Z\_NO\_FLUSH);
00609                     byteswritten += fwrite(buf,1,buf\_size-z->avail\_out,(FILE*)mat->
      \hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00610                 \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
00611                 ptr++;
00612             \}
00613             \textcolor{comment}{/* Add/Compress padding to pad to 8-byte boundary */}
00614             \textcolor{keywordflow}{if} ( N*data\_size % 8 ) \{
00615                 z->next\_in  = pad;
00616                 z->avail\_in = 8 - (N*data\_size % 8);
00617                 \textcolor{keywordflow}{do} \{
00618                     z->next\_out  = buf;
00619                     z->avail\_out = buf\_size;
00620                     deflate(z,Z\_NO\_FLUSH);
00621                     byteswritten += fwrite(buf,1,buf\_size-z->avail\_out,(FILE*)mat->
      \hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00622                 \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
00623             \}
00624             \textcolor{keywordflow}{break};
00625         \}
00626         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a2a7318fe8bf9464935e7ed8902618293}{MAT\_T\_UNKNOWN}:
00627             \textcolor{comment}{/* Sometimes empty char data will have MAT\_T\_UNKNOWN, so just write a data tag */}
00628             data\_size = 2;
00629             data\_tag[0] = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16};
00630             data\_tag[1] = N*data\_size;
00631             z->next\_in  = ZLIB\_BYTE\_PTR(data\_tag);
00632             z->avail\_in = 8;
00633             \textcolor{keywordflow}{do} \{
00634                 z->next\_out  = buf;
00635                 z->avail\_out = buf\_size;
00636                 deflate(z,Z\_NO\_FLUSH);
00637                 byteswritten += fwrite(buf,1,buf\_size-z->avail\_out,(FILE*)mat->
      \hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00638             \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
00639             \textcolor{keywordflow}{break};
00640         \textcolor{keywordflow}{default}:
00641             \textcolor{keywordflow}{break};
00642     \}
00643 
00644     \textcolor{keywordflow}{return} byteswritten;
00645 \}
00646 \textcolor{preprocessor}{#endif}
00647 
00663 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
00664 WriteEmptyCharData(\hyperlink{struct__mat__t}{mat\_t} *mat, \textcolor{keywordtype}{int} N, \textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} data\_type)
00665 \{
00666     \textcolor{keywordtype}{int} nBytes = 0, i;
00667     \textcolor{keywordtype}{size\_t} byteswritten = 0;
00668     mat\_int8\_t pad1 = 0;
00669 
00670     \textcolor{keywordflow}{switch} ( data\_type ) \{
00671         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a01c1bd7db68f90552862eb5d311be408}{MAT\_T\_UINT8}:
00672         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8}:
00673             data\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16};
00674             \textcolor{comment}{/* Fall through: Matlab MAT\_C\_CHAR needs uint16 */}
00675         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16}:
00676         \{
00677             mat\_uint16\_t u16 = 0;
00678             nBytes = N*\textcolor{keyword}{sizeof}(mat\_uint16\_t);
00679             fwrite(&data\_type,\textcolor{keyword}{sizeof}(mat\_int32\_t),1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00680             fwrite(&nBytes,\textcolor{keyword}{sizeof}(mat\_int32\_t),1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00681             \textcolor{keywordflow}{for} ( i = 0; i < N; i++ )
00682                 fwrite(&u16,\textcolor{keyword}{sizeof}(mat\_uint16\_t),1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00683             \textcolor{keywordflow}{if} ( nBytes % 8 )
00684                 \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
00685                     fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00686             \textcolor{keywordflow}{break};
00687         \}
00688         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453ac34ad81f5cbd3b7d0d95e57e5be0149b}{MAT\_T\_UTF8}:
00689         \{
00690             mat\_uint8\_t u8 = 0;
00691             nBytes = N;
00692             fwrite(&data\_type,\textcolor{keyword}{sizeof}(mat\_int32\_t),1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00693             fwrite(&nBytes,\textcolor{keyword}{sizeof}(mat\_int32\_t),1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00694             \textcolor{keywordflow}{for} ( i = 0; i < N; i++ )
00695                 fwrite(&u8,\textcolor{keyword}{sizeof}(mat\_uint8\_t),1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00696             \textcolor{keywordflow}{if} ( nBytes % 8 )
00697                 \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
00698                     fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00699             \textcolor{keywordflow}{break};
00700         \}
00701         \textcolor{keywordflow}{default}:
00702             \textcolor{keywordflow}{break};
00703     \}
00704     byteswritten += nBytes;
00705     \textcolor{keywordflow}{return} byteswritten;
00706 \}
00707 
00720 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
00721 WriteEmptyData(\hyperlink{struct__mat__t}{mat\_t} *mat,\textcolor{keywordtype}{int} N,\textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} data\_type)
00722 \{
00723     \textcolor{keywordtype}{int} nBytes = 0, data\_size, i;
00724 
00725     \textcolor{keywordflow}{if} ( mat == NULL || mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp} == NULL )
00726         \textcolor{keywordflow}{return} 0;
00727 
00728     data\_size = \hyperlink{group__mat__util_gab6774aabdc124c540c1e7686d0804940}{Mat\_SizeOf}(data\_type);
00729 
00730     \textcolor{keywordflow}{switch} ( data\_type ) \{
00731         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE}:
00732         \{
00733             \textcolor{keywordtype}{double} d = 0.0;
00734 
00735             nBytes = N*data\_size;
00736             fwrite(&data\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00737             fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00738             \textcolor{keywordflow}{for} ( i = 0; i < N; i++ )
00739                 fwrite(&d,data\_size,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00740             \textcolor{keywordflow}{break};
00741         \}
00742         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a3a3657d40e9212c923d9b9d03531b64c}{MAT\_T\_SINGLE}:
00743         \{
00744             \textcolor{keywordtype}{float} f = 0.0;
00745 
00746             nBytes = N*data\_size;
00747             fwrite(&data\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00748             fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00749             \textcolor{keywordflow}{for} ( i = 0; i < N; i++ )
00750                 fwrite(&f,data\_size,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00751             \textcolor{keywordflow}{break};
00752         \}
00753         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8}:
00754         \{
00755             mat\_int8\_t i8 = 0;
00756 
00757             nBytes = N*data\_size;
00758             fwrite(&data\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00759             fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00760             \textcolor{keywordflow}{for} ( i = 0; i < N; i++ )
00761                 fwrite(&i8,data\_size,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00762             \textcolor{keywordflow}{break};
00763         \}
00764         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a01c1bd7db68f90552862eb5d311be408}{MAT\_T\_UINT8}:
00765         \{
00766             mat\_uint8\_t ui8 = 0;
00767 
00768             nBytes = N*data\_size;
00769             fwrite(&data\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00770             fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00771             \textcolor{keywordflow}{for} ( i = 0; i < N; i++ )
00772                 fwrite(&ui8,data\_size,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00773             \textcolor{keywordflow}{break};
00774         \}
00775         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a8c5b2e381946e95ea8d81ac216743302}{MAT\_T\_INT16}:
00776         \{
00777             mat\_int16\_t i16 = 0;
00778 
00779             nBytes = N*data\_size;
00780             fwrite(&data\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00781             fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00782             \textcolor{keywordflow}{for} ( i = 0; i < N; i++ )
00783                 fwrite(&i16,data\_size,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00784             \textcolor{keywordflow}{break};
00785         \}
00786         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16}:
00787         \{
00788             mat\_uint16\_t ui16 = 0;
00789 
00790             nBytes = N*data\_size;
00791             fwrite(&data\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00792             fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00793             \textcolor{keywordflow}{for} ( i = 0; i < N; i++ )
00794                 fwrite(&ui16,data\_size,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00795             \textcolor{keywordflow}{break};
00796         \}
00797         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32}:
00798         \{
00799             mat\_int32\_t i32 = 0;
00800 
00801             nBytes = N*data\_size;
00802             fwrite(&data\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00803             fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00804             \textcolor{keywordflow}{for} ( i = 0; i < N; i++ )
00805                 fwrite(&i32,data\_size,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00806             \textcolor{keywordflow}{break};
00807         \}
00808         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32}:
00809         \{
00810             mat\_uint32\_t ui32 = 0;
00811 
00812             nBytes = N*data\_size;
00813             fwrite(&data\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00814             fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00815             \textcolor{keywordflow}{for} ( i = 0; i < N; i++ )
00816                 fwrite(&ui32,data\_size,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00817             \textcolor{keywordflow}{break};
00818         \}
00819 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_INT64\_T}
00820         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9e825b5d18b8f946eaf2b4b57e51c145}{MAT\_T\_INT64}:
00821         \{
00822             mat\_int64\_t i64 = 0;
00823 
00824             nBytes = N*data\_size;
00825             fwrite(&data\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00826             fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00827             \textcolor{keywordflow}{for} ( i = 0; i < N; i++ )
00828                 fwrite(&i64,data\_size,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00829             \textcolor{keywordflow}{break};
00830         \}
00831 \textcolor{preprocessor}{#endif}
00832 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_UINT64\_T}
00833         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a45547932c46be27118abe08302d7e29f}{MAT\_T\_UINT64}:
00834         \{
00835             mat\_uint64\_t ui64 = 0;
00836 
00837             nBytes = N*data\_size;
00838             fwrite(&data\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00839             fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00840             \textcolor{keywordflow}{for} ( i = 0; i < N; i++ )
00841                 fwrite(&ui64,data\_size,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00842             \textcolor{keywordflow}{break};
00843         \}
00844 \textcolor{preprocessor}{#endif}
00845         \textcolor{keywordflow}{default}:
00846             nBytes = 0;
00847     \}
00848 
00849     \textcolor{keywordflow}{return} nBytes;
00850 \}
00851 
00852 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
00853 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
00854 WriteCompressedEmptyData(\hyperlink{struct__mat__t}{mat\_t} *mat,z\_streamp z,\textcolor{keywordtype}{int} N,
00855     \textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} data\_type)
00856 \{
00857     \textcolor{keywordtype}{int} nBytes = 0, data\_size, i;
00858     \textcolor{keywordtype}{size\_t} byteswritten = 0;
00859 
00860     \textcolor{keywordflow}{if} ( mat == NULL || mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp} == NULL )
00861         \textcolor{keywordflow}{return} 0;
00862 
00863     data\_size = \hyperlink{group__mat__util_gab6774aabdc124c540c1e7686d0804940}{Mat\_SizeOf}(data\_type);
00864 
00865     \textcolor{keywordflow}{switch} ( data\_type ) \{
00866         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE}:
00867         \{
00868             mat\_uint32\_t uncomp\_buf[32] = \{0,\};
00869             mat\_uint32\_t comp\_buf[32] = \{0,\};
00870             \textcolor{keywordtype}{double} data\_uncomp\_buf[4] = \{0.0,\};
00871 
00872             nBytes = N*data\_size;
00873             uncomp\_buf[0] = data\_type;
00874             uncomp\_buf[1] = 0;
00875             z->next\_in  = ZLIB\_BYTE\_PTR(uncomp\_buf);
00876             z->avail\_in = 8;
00877             \textcolor{keywordflow}{do} \{
00878                 z->next\_out  = ZLIB\_BYTE\_PTR(comp\_buf);
00879                 z->avail\_out = 32*\textcolor{keyword}{sizeof}(*comp\_buf);
00880                 deflate(z,Z\_NO\_FLUSH);
00881                 byteswritten += fwrite(comp\_buf,1,32*\textcolor{keyword}{sizeof}(*comp\_buf)-z->avail\_out,(FILE*)mat->
      \hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00882             \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
00883             \textcolor{keywordflow}{for} ( i = 0; i < N; i++ ) \{
00884                 z->next\_in  = ZLIB\_BYTE\_PTR(data\_uncomp\_buf);
00885                 z->avail\_in = 8;
00886                 \textcolor{keywordflow}{do} \{
00887                     z->next\_out  = ZLIB\_BYTE\_PTR(comp\_buf);
00888                     z->avail\_out = 32*\textcolor{keyword}{sizeof}(*comp\_buf);
00889                     deflate(z,Z\_NO\_FLUSH);
00890                     byteswritten += fwrite(comp\_buf,32*\textcolor{keyword}{sizeof}(*comp\_buf)-z->avail\_out,1,(FILE*)mat->
      \hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00891                 \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
00892             \}
00893             \textcolor{keywordflow}{break};
00894         \}
00895         \textcolor{keywordflow}{default}:
00896             nBytes = WriteEmptyData(mat,N,data\_type);
00897     \}
00898 
00899     \textcolor{keywordflow}{return} byteswritten;
00900 \}
00901 \textcolor{preprocessor}{#endif}
00902 
00903 \textcolor{preprocessor}{#define WRITE\_DATA\_SLAB2 \(\backslash\)}
00904 \textcolor{preprocessor}{    do \{ \(\backslash\)}
00905 \textcolor{preprocessor}{        int i, j; \(\backslash\)}
00906 \textcolor{preprocessor}{        long pos, row\_stride, col\_stride, pos2; \(\backslash\)}
00907 \textcolor{preprocessor}{        row\_stride = (stride[0]-1)*data\_size; \(\backslash\)}
00908 \textcolor{preprocessor}{        col\_stride = stride[1]*dims[0]*data\_size; \(\backslash\)}
00909 \textcolor{preprocessor}{        (void)fseek((FILE*)mat->fp,start[1]*dims[0]*data\_size,SEEK\_CUR); \(\backslash\)}
00910 \textcolor{preprocessor}{        for ( i = 0; i < edge[1]; i++ ) \{ \(\backslash\)}
00911 \textcolor{preprocessor}{            pos = ftell((FILE*)mat->fp); \(\backslash\)}
00912 \textcolor{preprocessor}{            if ( pos == -1L ) \{ \(\backslash\)}
00913 \textcolor{preprocessor}{                Mat\_Critical("Couldn't determine file position"); \(\backslash\)}
00914 \textcolor{preprocessor}{                return -1; \(\backslash\)}
00915 \textcolor{preprocessor}{            \} \(\backslash\)}
00916 \textcolor{preprocessor}{            (void)fseek((FILE*)mat->fp,start[0]*data\_size,SEEK\_CUR); \(\backslash\)}
00917 \textcolor{preprocessor}{            for ( j = 0; j < edge[0]; j++ ) \{ \(\backslash\)}
00918 \textcolor{preprocessor}{                fwrite(ptr++,data\_size,1,(FILE*)mat->fp); \(\backslash\)}
00919 \textcolor{preprocessor}{                (void)fseek((FILE*)mat->fp,row\_stride,SEEK\_CUR); \(\backslash\)}
00920 \textcolor{preprocessor}{            \} \(\backslash\)}
00921 \textcolor{preprocessor}{            pos2 = ftell((FILE*)mat->fp); \(\backslash\)}
00922 \textcolor{preprocessor}{            if ( pos2 == -1L ) \{ \(\backslash\)}
00923 \textcolor{preprocessor}{                Mat\_Critical("Couldn't determine file position"); \(\backslash\)}
00924 \textcolor{preprocessor}{                return -1; \(\backslash\)}
00925 \textcolor{preprocessor}{            \} \(\backslash\)}
00926 \textcolor{preprocessor}{            pos +=col\_stride-pos2; \(\backslash\)}
00927 \textcolor{preprocessor}{            (void)fseek((FILE*)mat->fp,pos,SEEK\_CUR); \(\backslash\)}
00928 \textcolor{preprocessor}{        \} \(\backslash\)}
00929 \textcolor{preprocessor}{    \} \(\backslash\)}
00930 \textcolor{preprocessor}{    while (0)}
00931 
00947 \textcolor{keywordtype}{int}
\Hypertarget{mat5_8c_source_l00948}\hyperlink{mat5_8c_a04eba34668a0de871c4f245702f802f7}{00948} \hyperlink{mat5_8c_a04eba34668a0de871c4f245702f802f7}{WriteDataSlab2}(\hyperlink{struct__mat__t}{mat\_t} *mat,\textcolor{keywordtype}{void} *data,\textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} data\_type,\textcolor{keywordtype}{size\_t} *dims,
00949     \textcolor{keywordtype}{int} *start,\textcolor{keywordtype}{int} *stride,\textcolor{keywordtype}{int} *edge)
00950 \{
00951     \textcolor{keywordtype}{int} nBytes = 0, data\_size;
00952 
00953     \textcolor{keywordflow}{if} ( (mat   == NULL) || (data   == NULL) || (mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp} == NULL) ||
00954          (start == NULL) || (stride == NULL) || (edge    == NULL) ) \{
00955         \textcolor{keywordflow}{return} 0;
00956     \}
00957 
00958     data\_size = \hyperlink{group__mat__util_gab6774aabdc124c540c1e7686d0804940}{Mat\_SizeOf}(data\_type);
00959 
00960     \textcolor{keywordflow}{switch} ( data\_type ) \{
00961         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE}:
00962         \{
00963             \textcolor{keywordtype}{double} *ptr = (\textcolor{keywordtype}{double} *)data;
00964             WRITE\_DATA\_SLAB2;
00965             \textcolor{keywordflow}{break};
00966         \}
00967         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a3a3657d40e9212c923d9b9d03531b64c}{MAT\_T\_SINGLE}:
00968         \{
00969             \textcolor{keywordtype}{float} *ptr = (\textcolor{keywordtype}{float} *)data;
00970             WRITE\_DATA\_SLAB2;
00971             \textcolor{keywordflow}{break};
00972         \}
00973 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_INT64\_T}
00974         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9e825b5d18b8f946eaf2b4b57e51c145}{MAT\_T\_INT64}:
00975         \{
00976             mat\_int64\_t *ptr = (mat\_int64\_t *)data;
00977             WRITE\_DATA\_SLAB2;
00978             \textcolor{keywordflow}{break};
00979         \}
00980 \textcolor{preprocessor}{#endif}
00981 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_UINT64\_T}
00982         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a45547932c46be27118abe08302d7e29f}{MAT\_T\_UINT64}:
00983         \{
00984             mat\_uint64\_t *ptr = (mat\_uint64\_t *)data;
00985             WRITE\_DATA\_SLAB2;
00986             \textcolor{keywordflow}{break};
00987         \}
00988 \textcolor{preprocessor}{#endif}
00989         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32}:
00990         \{
00991             mat\_int32\_t *ptr = (mat\_int32\_t *)data;
00992             WRITE\_DATA\_SLAB2;
00993             \textcolor{keywordflow}{break};
00994         \}
00995         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32}:
00996         \{
00997             mat\_uint32\_t *ptr = (mat\_uint32\_t *)data;
00998             WRITE\_DATA\_SLAB2;
00999             \textcolor{keywordflow}{break};
01000         \}
01001         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a8c5b2e381946e95ea8d81ac216743302}{MAT\_T\_INT16}:
01002         \{
01003             mat\_int16\_t *ptr = (mat\_int16\_t *)data;
01004             WRITE\_DATA\_SLAB2;
01005             \textcolor{keywordflow}{break};
01006         \}
01007         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16}:
01008         \{
01009             mat\_uint16\_t *ptr = (mat\_uint16\_t *)data;
01010             WRITE\_DATA\_SLAB2;
01011             \textcolor{keywordflow}{break};
01012         \}
01013         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8}:
01014         \{
01015             mat\_int8\_t *ptr = (mat\_int8\_t *)data;
01016             WRITE\_DATA\_SLAB2;
01017             \textcolor{keywordflow}{break};
01018         \}
01019         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a01c1bd7db68f90552862eb5d311be408}{MAT\_T\_UINT8}:
01020         \{
01021             mat\_uint8\_t *ptr = (mat\_uint8\_t *)data;
01022             WRITE\_DATA\_SLAB2;
01023             \textcolor{keywordflow}{break};
01024         \}
01025         \textcolor{keywordflow}{default}:
01026             nBytes = 0;
01027     \}
01028 
01029     \textcolor{keywordflow}{return} nBytes;
01030 \}
01031 
01051 \textcolor{keywordtype}{int}
\Hypertarget{mat5_8c_source_l01052}\hyperlink{mat5_8c_a5afeaabef5e10f73a5805ce6de4acc8b}{01052} \hyperlink{mat5_8c_a5afeaabef5e10f73a5805ce6de4acc8b}{WriteCharDataSlab2}(\hyperlink{struct__mat__t}{mat\_t} *mat,\textcolor{keywordtype}{void} *data,\textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} data\_type,
01053     \textcolor{keywordtype}{size\_t} *dims,\textcolor{keywordtype}{int} *start,\textcolor{keywordtype}{int} *stride,\textcolor{keywordtype}{int} *edge)
01054 \{
01055     \textcolor{keywordtype}{int} nBytes = 0;
01056 
01057     \textcolor{keywordflow}{if} ( (mat   == NULL) || (data   == NULL) || (mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp} == NULL) ||
01058          (start == NULL) || (stride == NULL) || (edge    == NULL) ) \{
01059         \textcolor{keywordflow}{return} 0;
01060     \}
01061 
01062     \textcolor{keywordflow}{switch} ( data\_type ) \{
01063         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16}:
01064         \{
01065             mat\_uint16\_t *ptr = (mat\_uint16\_t*)data;
01066             \textcolor{keywordtype}{int} data\_size = \textcolor{keyword}{sizeof}(mat\_uint16\_t);
01067             WRITE\_DATA\_SLAB2;
01068             \textcolor{keywordflow}{break};
01069         \}
01070         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8}:
01071         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a01c1bd7db68f90552862eb5d311be408}{MAT\_T\_UINT8}:
01072         \{
01073             \textcolor{comment}{/* Matlab can't read MAT\_C\_CHAR as uint8, needs uint16 */}
01074             mat\_uint8\_t *ptr = (mat\_uint8\_t*)data;
01075             mat\_uint16\_t c;
01076             \textcolor{keywordtype}{int} data\_size = \textcolor{keyword}{sizeof}(mat\_uint16\_t);
01077             \textcolor{keywordtype}{int} i, j;
01078             \textcolor{keywordtype}{long} pos, row\_stride, col\_stride, pos2;
01079 
01080             row\_stride = (stride[0]-1)*data\_size;
01081             col\_stride = stride[1]*dims[0]*data\_size;
01082 
01083             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},start[1]*dims[0]*data\_size,SEEK\_CUR);
01084             \textcolor{keywordflow}{for} ( i = 0; i < edge[1]; i++ ) \{
01085                 pos = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01086                 \textcolor{keywordflow}{if} ( pos == -1L ) \{
01087                     \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
01088                     \textcolor{keywordflow}{return} -1;
01089                 \}
01090                 (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},start[0]*data\_size,SEEK\_CUR);
01091                 \textcolor{keywordflow}{for} ( j = 0; j < edge[0]; j++,ptr++ ) \{
01092                     c = *ptr;
01093                     fwrite(&c,data\_size,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01094                     (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},row\_stride,SEEK\_CUR);
01095                 \}
01096                 pos2 = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01097                 \textcolor{keywordflow}{if} ( pos2 == -1L ) \{
01098                     \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
01099                     \textcolor{keywordflow}{return} -1;
01100                 \}
01101                 pos +=col\_stride-pos2;
01102                 (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},pos,SEEK\_CUR);
01103             \}
01104             \textcolor{keywordflow}{break};
01105         \}
01106         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453ac34ad81f5cbd3b7d0d95e57e5be0149b}{MAT\_T\_UTF8}:
01107         \{
01108             mat\_uint8\_t *ptr = (mat\_uint8\_t*)data;
01109             \textcolor{keywordtype}{int} data\_size = \textcolor{keyword}{sizeof}(mat\_uint8\_t);
01110             \textcolor{keywordtype}{int} i, j;
01111             \textcolor{keywordtype}{long} pos, row\_stride, col\_stride, pos2;
01112 
01113             row\_stride = (stride[0]-1)*data\_size;
01114             col\_stride = stride[1]*dims[0]*data\_size;
01115 
01116             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},start[1]*dims[0]*data\_size,SEEK\_CUR);
01117             \textcolor{keywordflow}{for} ( i = 0; i < edge[1]; i++ ) \{
01118                 pos = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01119                 \textcolor{keywordflow}{if} ( pos == -1L ) \{
01120                     \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
01121                     \textcolor{keywordflow}{return} -1;
01122                 \}
01123                 (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},start[0]*data\_size,SEEK\_CUR);
01124                 \textcolor{keywordflow}{for} ( j = 0; j < edge[0]; j++,ptr++ ) \{
01125                     fwrite(ptr,data\_size,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01126                     (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},row\_stride,SEEK\_CUR);
01127                 \}
01128                 pos2 = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01129                 \textcolor{keywordflow}{if} ( pos2 == -1L ) \{
01130                     \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
01131                     \textcolor{keywordflow}{return} -1;
01132                 \}
01133                 pos +=col\_stride-pos2;
01134                 (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},pos,SEEK\_CUR);
01135             \}
01136             \textcolor{keywordflow}{break};
01137         \}
01138         \textcolor{keywordflow}{default}:
01139             nBytes = 0;
01140     \}
01141 
01142     \textcolor{keywordflow}{return} nBytes;
01143 \}
01144 
01145 \textcolor{preprocessor}{#undef WRITE\_DATA\_SLAB2}
01146 
01155 \textcolor{keywordtype}{int}
\Hypertarget{mat5_8c_source_l01156}\hyperlink{mat5_8c_a1bec2ccf2a3b48706edd32e63744d364}{01156} \hyperlink{mat5_8c_a1bec2ccf2a3b48706edd32e63744d364}{WriteData}(\hyperlink{struct__mat__t}{mat\_t} *mat,\textcolor{keywordtype}{void} *data,\textcolor{keywordtype}{int} N,\textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} data\_type)
01157 \{
01158     \textcolor{keywordtype}{int} nBytes = 0, data\_size;
01159 
01160     \textcolor{keywordflow}{if} ( mat == NULL || mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp} == NULL )
01161         \textcolor{keywordflow}{return} 0;
01162 
01163     data\_size = \hyperlink{group__mat__util_gab6774aabdc124c540c1e7686d0804940}{Mat\_SizeOf}(data\_type);
01164     nBytes    = N*data\_size;
01165     fwrite(&data\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01166     fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01167 
01168     \textcolor{keywordflow}{if} ( data != NULL && N > 0 )
01169         fwrite(data,data\_size,N,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01170 
01171     \textcolor{keywordflow}{return} nBytes;
01172 \}
01173 
01174 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
01175 \textcolor{comment}{/* Compresses the data buffer and writes it to the file */}
01176 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
01177 WriteCompressedData(\hyperlink{struct__mat__t}{mat\_t} *mat,z\_streamp z,\textcolor{keywordtype}{void} *data,\textcolor{keywordtype}{int} N,
01178     \textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} data\_type)
01179 \{
01180     \textcolor{keywordtype}{int} nBytes = 0, data\_size, data\_tag[2], byteswritten = 0;
01181     \textcolor{keywordtype}{int} buf\_size = 1024;
01182     mat\_uint8\_t buf[1024], pad[8] = \{0,\};
01183 
01184     \textcolor{keywordflow}{if} ( mat == NULL || mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp} == NULL )
01185         \textcolor{keywordflow}{return} 0;
01186 
01187     data\_size   = \hyperlink{group__mat__util_gab6774aabdc124c540c1e7686d0804940}{Mat\_SizeOf}(data\_type);
01188     data\_tag[0] = data\_type;
01189     data\_tag[1] = data\_size*N;
01190     z->next\_in  = ZLIB\_BYTE\_PTR(data\_tag);
01191     z->avail\_in = 8;
01192     \textcolor{keywordflow}{do} \{
01193         z->next\_out  = buf;
01194         z->avail\_out = buf\_size;
01195         deflate(z,Z\_NO\_FLUSH);
01196         byteswritten += fwrite(buf,1,buf\_size-z->avail\_out,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01197     \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
01198 
01199     \textcolor{comment}{/* exit early if this is an empty data */}
01200     \textcolor{keywordflow}{if} ( NULL == data || N < 1 )
01201         \textcolor{keywordflow}{return} byteswritten;
01202 
01203     z->next\_in  = (Bytef*)data;
01204     z->avail\_in = N*data\_size;
01205     \textcolor{keywordflow}{do} \{
01206         z->next\_out  = buf;
01207         z->avail\_out = buf\_size;
01208         deflate(z,Z\_NO\_FLUSH);
01209         byteswritten += fwrite(buf,1,buf\_size-z->avail\_out,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01210     \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
01211     \textcolor{comment}{/* Add/Compress padding to pad to 8-byte boundary */}
01212     \textcolor{keywordflow}{if} ( N*data\_size % 8 ) \{
01213         z->next\_in  = pad;
01214         z->avail\_in = 8 - (N*data\_size % 8);
01215         \textcolor{keywordflow}{do} \{
01216             z->next\_out  = buf;
01217             z->avail\_out = buf\_size;
01218             deflate(z,Z\_NO\_FLUSH);
01219             byteswritten += fwrite(buf,1,buf\_size-z->avail\_out,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01220         \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
01221     \}
01222     nBytes = byteswritten;
01223     \textcolor{keywordflow}{return} nBytes;
01224 \}
01225 \textcolor{preprocessor}{#endif}
01226 
01234 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
01235 ReadNextCell( \hyperlink{struct__mat__t}{mat\_t} *mat, \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar )
01236 \{
01237     \textcolor{keywordtype}{size\_t} bytesread = 0;
01238     \textcolor{keywordtype}{int} ncells, i;
01239     \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **cells = NULL;
01240 
01241     ncells = 1;
01242     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
01243         ncells *= matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
01244     matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \textcolor{keyword}{sizeof}(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *);
01245     matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes}    = ncells*matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size};
01246     matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data}      = calloc(ncells, matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size});
01247     \textcolor{keywordflow}{if} ( NULL == matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} ) \{
01248         \textcolor{keywordflow}{if} ( NULL != matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} )
01249             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't allocate memory for %s->data"}, matvar->
      \hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
01250         \textcolor{keywordflow}{return} bytesread;
01251     \}
01252     cells = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
01253 
01254     if ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} ) \{
01255 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
01256         mat\_uint32\_t uncomp\_buf[16] = \{0,\};
01257         \textcolor{keywordtype}{int} nbytes;
01258         mat\_uint32\_t array\_flags;
01259         \textcolor{keywordtype}{int} err;
01260 
01261         \textcolor{keywordflow}{for} ( i = 0; i < ncells; i++ ) \{
01262             cells[i] = \hyperlink{group___m_a_t_gae7c9c3699f6e9c31a9c490300013098c}{Mat\_VarCalloc}();
01263             \textcolor{keywordflow}{if} ( NULL == cells[i] ) \{
01264                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't allocate memory for cell %d"}, i);
01265                 \textcolor{keywordflow}{continue};
01266             \}
01267 
01268             \textcolor{comment}{/* Read variable tag for cell */}
01269             uncomp\_buf[0] = 0;
01270             uncomp\_buf[1] = 0;
01271             bytesread += InflateVarTag(mat,matvar,uncomp\_buf);
01272             \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01273                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf);
01274                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+1);
01275             \}
01276             nbytes = uncomp\_buf[1];
01277             \textcolor{keywordflow}{if} ( 0 == nbytes ) \{
01278                 \textcolor{comment}{/* Empty cell: Memory optimization */}
01279                 free(cells[i]->\textcolor{keyword}{internal});
01280                 cells[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal} = NULL;
01281                 \textcolor{keywordflow}{continue};
01282             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( uncomp\_buf[0] != \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a32985fee89a4df8db4b3f5d3a48823d3}{MAT\_T\_MATRIX} ) \{
01283                 \hyperlink{group___m_a_t_ga1d14716f7450530fd1c9d02413787f0e}{Mat\_VarFree}(cells[i]);
01284                 cells[i] = NULL;
01285                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"cells[%d], Uncompressed type not MAT\_T\_MATRIX"},i);
01286                 \textcolor{keywordflow}{break};
01287             \}
01288             cells[i]->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} = \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a5181d2f71eab0f12f05ba65d4f13fb53}{MAT\_COMPRESSION\_ZLIB};
01289             bytesread += InflateArrayFlags(mat,matvar,uncomp\_buf);
01290             nbytes -= 16;
01291             \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01292                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf);
01293                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+1);
01294                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+2);
01295                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+3);
01296             \}
01297             \textcolor{comment}{/* Array Flags */}
01298             \textcolor{keywordflow}{if} ( uncomp\_buf[0] == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32} ) \{
01299                array\_flags = uncomp\_buf[2];
01300                cells[i]->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} = \hyperlink{mat5_8c_a85a616d27707e89bda9fd2e9bbb6a586}{CLASS\_FROM\_ARRAY\_FLAGS}(array\_flags);
01301                cells[i]->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex}  = (array\_flags & \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbbacd7b091a11184aad7fc6078c04470780}{MAT\_F\_COMPLEX});
01302                cells[i]->\hyperlink{group___m_a_t_af26c71c4c0ddb14931d15910dddac1bc}{isGlobal}   = (array\_flags & \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba49084e0c796aa7963e53f7539525d40d}{MAT\_F\_GLOBAL});
01303                cells[i]->\hyperlink{group___m_a_t_a866c1539e68073a837833d74cd4a65be}{isLogical}  = (array\_flags & \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba57eb5c6e200bcbc0f1b7982f29a169c2}{MAT\_F\_LOGICAL});
01304                \textcolor{keywordflow}{if} ( cells[i]->class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a0d5655b7e6178a2242cb3bb56ff4c8d2}{MAT\_C\_SPARSE} ) \{
01305                    \textcolor{comment}{/* Need to find a more appropriate place to store nzmax */}
01306                    cells[i]->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} = uncomp\_buf[3];
01307                \}
01308             \} \textcolor{keywordflow}{else} \{
01309                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Expected MAT\_T\_UINT32 for Array Tags, got %d"},
01310                                uncomp\_buf[0]);
01311                 bytesread+=InflateSkip(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,nbytes);
01312             \}
01313             \textcolor{keywordflow}{if} ( cells[i]->class\_type != \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40ad83c684d250e463c1a3779647695c0c9}{MAT\_C\_OPAQUE} ) \{
01314                 bytesread += InflateDimensions(mat,matvar,uncomp\_buf);
01315                 nbytes -= 8;
01316                 \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01317                     (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf);
01318                     (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+1);
01319                 \}
01320                 \textcolor{comment}{/* Rank and Dimension */}
01321                 \textcolor{keywordflow}{if} ( uncomp\_buf[0] == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32} ) \{
01322                     \textcolor{keywordtype}{int} j = 0;
01323 
01324                     cells[i]->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} = uncomp\_buf[1];
01325                     nbytes -= cells[i]->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank};
01326                     cells[i]->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} /= 4;
01327                     cells[i]->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims} = (\textcolor{keywordtype}{size\_t}*)malloc(cells[i]->rank*\textcolor{keyword}{sizeof}(*cells[i]->dims));
01328                     \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01329                         \textcolor{keywordflow}{for} ( j = 0; j < cells[i]->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; j++ )
01330                             cells[i]->dims[j] = \hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+2+j);
01331                     \} \textcolor{keywordflow}{else} \{
01332                         \textcolor{keywordflow}{for} ( j = 0; j < cells[i]->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; j++ )
01333                             cells[i]->dims[j] = uncomp\_buf[2+j];
01334                     \}
01335                     \textcolor{keywordflow}{if} ( cells[i]->rank % 2 != 0 )
01336                         nbytes -= 4;
01337                 \}
01338                 bytesread += InflateVarNameTag(mat,matvar,uncomp\_buf);
01339                 nbytes -= 8;
01340                 \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01341                     (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf);
01342                     (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+1);
01343                 \}
01344                 \textcolor{comment}{/* Handle cell elements written with a variable name */}
01345                 \textcolor{keywordflow}{if} ( uncomp\_buf[1] > 0 ) \{
01346                     \textcolor{comment}{/* Name of variable */}
01347                     \textcolor{keywordtype}{int} len = 0;
01348                     \textcolor{keywordflow}{if} ( uncomp\_buf[0] == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8} ) \{    \textcolor{comment}{/* Name not in tag */}
01349                         len = uncomp\_buf[1];
01350 
01351                         \textcolor{keywordflow}{if} ( len % 8 > 0 )
01352                             len = len+(8-(len % 8));
01353                         cells[i]->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} = (\textcolor{keywordtype}{char}*)malloc(len+1);
01354                         \textcolor{comment}{/* Inflate variable name */}
01355                         bytesread += InflateVarName(mat,matvar,cells[i]->name,len);
01356                         cells[i]->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name}[len] = \textcolor{charliteral}{'\(\backslash\)0'};
01357                         nbytes -= len;
01358                     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( ((uncomp\_buf[0] & 0x0000ffff) == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8}) &&
01359                                ((uncomp\_buf[0] & 0xffff0000) != 0x00) ) \{
01360                         \textcolor{comment}{/* Name packed in tag */}
01361                         len = (uncomp\_buf[0] & 0xffff0000) >> 16;
01362                         cells[i]->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} = (\textcolor{keywordtype}{char}*)malloc(len+1);
01363                         memcpy(cells[i]->name,uncomp\_buf+1,len);
01364                         cells[i]->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name}[len] = \textcolor{charliteral}{'\(\backslash\)0'};
01365                     \}
01366                 \}
01367                 cells[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z = (z\_streamp)calloc(1,\textcolor{keyword}{sizeof}(
      \hyperlink{structz__stream__s}{z\_stream}));
01368                 \textcolor{keywordflow}{if} ( cells[i]->\hyperlink{namespaceinternal}{internal}->z != NULL ) \{
01369                     err = inflateCopy(cells[i]->\hyperlink{namespaceinternal}{internal}->z,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z);
01370                     \textcolor{keywordflow}{if} ( err == Z\_OK ) \{
01371                         cells[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} = ftell((FILE*)mat->
      \hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01372                         \textcolor{keywordflow}{if} ( cells[i]->\hyperlink{namespaceinternal}{internal}->datapos != -1L ) \{
01373                             cells[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} -= matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in;
01374                             \textcolor{keywordflow}{if} ( cells[i]->class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT} )
01375                                 bytesread+=ReadNextStructField(mat,cells[i]);
01376                             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( cells[i]->class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2f7abb47a1c51e248bd4e5e03cc81b08}{MAT\_C\_CELL} )
01377                                 bytesread+=ReadNextCell(mat,cells[i]);
01378                             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( nbytes <= (1 << MAX\_WBITS) ) \{
01379                                 \textcolor{comment}{/* Memory optimization: Read data if less in size}
01380 \textcolor{comment}{                                   than the zlib inflate state (approximately) */}
01381                                 \hyperlink{mat5_8c_abd8669832a02e759fe190bf2724f60ae}{Read5}(mat,cells[i]);
01382                                 cells[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->data = cells[i]->
      \hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
01383                                 cells[i]->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} = NULL;
01384                             \}
01385                             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},cells[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->
      \hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
01386                         \} \textcolor{keywordflow}{else} \{
01387                             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
01388                         \}
01389                         \textcolor{keywordflow}{if} ( cells[i]->\hyperlink{namespaceinternal}{internal}->data != NULL ||
01390                              cells[i]->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT} ||
01391                              cells[i]->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2f7abb47a1c51e248bd4e5e03cc81b08}{MAT\_C\_CELL} ) \{
01392                             \textcolor{comment}{/* Memory optimization: Free inflate state */}
01393                             inflateEnd(cells[i]->\hyperlink{namespaceinternal}{internal}->z);
01394                             free(cells[i]->\hyperlink{namespaceinternal}{internal}->z);
01395                             cells[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z = NULL;
01396                         \}
01397                     \} \textcolor{keywordflow}{else} \{
01398                         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"inflateCopy returned error %s"},zError(err));
01399                     \}
01400                 \} \textcolor{keywordflow}{else} \{
01401                     \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't allocate memory"});
01402                 \}
01403             \}
01404             bytesread+=InflateSkip(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,nbytes);
01405         \}
01406 \textcolor{preprocessor}{#else}
01407         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Not compiled with zlib support"});
01408 \textcolor{preprocessor}{#endif}
01409 
01410     \} \textcolor{keywordflow}{else} \{
01411         mat\_uint32\_t buf[16];
01412         \textcolor{keywordtype}{int} nbytes,nBytes;
01413         mat\_uint32\_t array\_flags;
01414 
01415         \textcolor{keywordflow}{for} ( i = 0; i < ncells; i++ ) \{
01416             \textcolor{keywordtype}{int} cell\_bytes\_read,name\_len;
01417             cells[i] = \hyperlink{group___m_a_t_gae7c9c3699f6e9c31a9c490300013098c}{Mat\_VarCalloc}();
01418             \textcolor{keywordflow}{if} ( !cells[i] ) \{
01419                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't allocate memory for cell %d"}, i);
01420                 \textcolor{keywordflow}{continue};
01421             \}
01422 
01423             \textcolor{comment}{/* Read variable tag for cell */}
01424             cell\_bytes\_read = fread(buf,4,2,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01425 
01426             \textcolor{comment}{/* Empty cells at the end of a file may cause an EOF */}
01427             \textcolor{keywordflow}{if} ( !cell\_bytes\_read )
01428                 \textcolor{keywordflow}{continue};
01429             bytesread += cell\_bytes\_read;
01430             \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01431                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf);
01432                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+1);
01433             \}
01434             nBytes = buf[1];
01435             \textcolor{keywordflow}{if} ( 0 == nBytes ) \{
01436                 \textcolor{comment}{/* Empty cell: Memory optimization */}
01437                 free(cells[i]->\textcolor{keyword}{internal});
01438                 cells[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal} = NULL;
01439                 \textcolor{keywordflow}{continue};
01440             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( buf[0] != \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a32985fee89a4df8db4b3f5d3a48823d3}{MAT\_T\_MATRIX} ) \{
01441                 \hyperlink{group___m_a_t_ga1d14716f7450530fd1c9d02413787f0e}{Mat\_VarFree}(cells[i]);
01442                 cells[i] = NULL;
01443                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"cells[%d] not MAT\_T\_MATRIX, fpos = %ld"},i,
01444                     ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp}));
01445                 \textcolor{keywordflow}{break};
01446             \}
01447 
01448             \textcolor{comment}{/* Read array flags and the dimensions tag */}
01449             bytesread += fread(buf,4,6,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01450             \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01451                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf);
01452                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+1);
01453                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+2);
01454                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+3);
01455                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+4);
01456                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+5);
01457             \}
01458             nBytes-=24;
01459             \textcolor{comment}{/* Array flags */}
01460             \textcolor{keywordflow}{if} ( buf[0] == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32} ) \{
01461                array\_flags = buf[2];
01462                cells[i]->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} = \hyperlink{mat5_8c_a85a616d27707e89bda9fd2e9bbb6a586}{CLASS\_FROM\_ARRAY\_FLAGS}(array\_flags);
01463                cells[i]->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex}  = (array\_flags & \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbbacd7b091a11184aad7fc6078c04470780}{MAT\_F\_COMPLEX});
01464                cells[i]->\hyperlink{group___m_a_t_af26c71c4c0ddb14931d15910dddac1bc}{isGlobal}   = (array\_flags & \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba49084e0c796aa7963e53f7539525d40d}{MAT\_F\_GLOBAL});
01465                cells[i]->\hyperlink{group___m_a_t_a866c1539e68073a837833d74cd4a65be}{isLogical}  = (array\_flags & \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba57eb5c6e200bcbc0f1b7982f29a169c2}{MAT\_F\_LOGICAL});
01466                \textcolor{keywordflow}{if} ( cells[i]->class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a0d5655b7e6178a2242cb3bb56ff4c8d2}{MAT\_C\_SPARSE} ) \{
01467                    \textcolor{comment}{/* Need to find a more appropriate place to store nzmax */}
01468                    cells[i]->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} = buf[3];
01469                \}
01470             \}
01471             \textcolor{comment}{/* Rank and dimension */}
01472             \textcolor{keywordflow}{if} ( buf[4] == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32} ) \{
01473                 \textcolor{keywordtype}{int} j;
01474                 nbytes = buf[5];
01475                 nBytes-=nbytes;
01476 
01477                 cells[i]->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} = nbytes / 4;
01478                 cells[i]->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims} = (\textcolor{keywordtype}{size\_t}*)malloc(cells[i]->rank*\textcolor{keyword}{sizeof}(*cells[i]->dims));
01479 
01480                 \textcolor{comment}{/* Assumes rank <= 16 */}
01481                 \textcolor{keywordflow}{if} ( cells[i]->rank % 2 != 0 ) \{
01482                     bytesread+=fread(buf,4,cells[i]->rank+1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01483                     nBytes-=4;
01484                 \} \textcolor{keywordflow}{else}
01485                     bytesread+=fread(buf,4,cells[i]->rank,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01486 
01487                 \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01488                     \textcolor{keywordflow}{for} ( j = 0; j < cells[i]->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; j++ )
01489                         cells[i]->dims[j] = \hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+j);
01490                 \} \textcolor{keywordflow}{else} \{
01491                     \textcolor{keywordflow}{for} ( j = 0; j < cells[i]->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; j++ )
01492                         cells[i]->dims[j] = buf[j];
01493                 \}
01494             \}
01495             \textcolor{comment}{/* Variable name tag */}
01496             bytesread+=fread(buf,1,8,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01497             nBytes-=8;
01498             \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01499                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf);
01500                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+1);
01501             \}
01502             name\_len = 0;
01503             \textcolor{keywordflow}{if} ( buf[1] > 0 ) \{
01504                 \textcolor{comment}{/* Name of variable */}
01505                 \textcolor{keywordflow}{if} ( buf[0] == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8} ) \{    \textcolor{comment}{/* Name not in tag */}
01506                     name\_len = buf[1];
01507                     \textcolor{keywordflow}{if} ( name\_len % 8 > 0 )
01508                         name\_len = name\_len+(8-(name\_len % 8));
01509                     nBytes -= name\_len;
01510                     (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},name\_len,SEEK\_CUR);
01511                 \}
01512             \}
01513             cells[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01514             \textcolor{keywordflow}{if} ( cells[i]->\hyperlink{namespaceinternal}{internal}->datapos != -1L ) \{
01515                 \textcolor{keywordflow}{if} ( cells[i]->class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT} )
01516                     bytesread+=ReadNextStructField(mat,cells[i]);
01517                 \textcolor{keywordflow}{if} ( cells[i]->class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2f7abb47a1c51e248bd4e5e03cc81b08}{MAT\_C\_CELL} )
01518                     bytesread+=ReadNextCell(mat,cells[i]);
01519                 (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},cells[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos}+nBytes,SEEK\_SET);
01520             \} \textcolor{keywordflow}{else} \{
01521                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
01522             \}
01523         \}
01524     \}
01525 
01526     \textcolor{keywordflow}{return} bytesread;
01527 \}
01528 
01538 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
01539 ReadNextStructField( \hyperlink{struct__mat__t}{mat\_t} *mat, \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar )
01540 \{
01541     \textcolor{keywordtype}{int} fieldname\_size,nfields, nmemb = 1, i;
01542     \textcolor{keywordtype}{size\_t} bytesread = 0;
01543     \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **fields = NULL;
01544 
01545     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
01546         nmemb *= matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
01547 
01548     if ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} ) \{
01549 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
01550         mat\_uint32\_t uncomp\_buf[16] = \{0,\};
01551         \textcolor{keywordtype}{int} nbytes, j;
01552         mat\_uint32\_t array\_flags;
01553         \textcolor{keywordtype}{int} err;
01554 
01555         \textcolor{comment}{/* Inflate Field name length */}
01556         bytesread += InflateFieldNameLength(mat,matvar,uncomp\_buf);
01557         \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01558             (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf);
01559             (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+1);
01560         \}
01561         \textcolor{keywordflow}{if} ( (uncomp\_buf[0] & 0x0000ffff) == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32} ) \{
01562             fieldname\_size = uncomp\_buf[1];
01563             \textcolor{keywordflow}{if} ( 0 >= fieldname\_size ) \{
01564                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Size of fieldname must be positive"});
01565                 \textcolor{keywordflow}{return} bytesread;
01566             \}
01567         \} \textcolor{keywordflow}{else} \{
01568             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Error getting fieldname size"});
01569             \textcolor{keywordflow}{return} bytesread;
01570         \}
01571 
01572         bytesread += InflateFieldNamesTag(mat,matvar,uncomp\_buf);
01573         \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01574             (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf);
01575             (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+1);
01576         \}
01577         nfields = uncomp\_buf[1];
01578         nfields = nfields / fieldname\_size;
01579         matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \textcolor{keyword}{sizeof}(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *);
01580 
01581         \textcolor{keywordflow}{if} ( nfields*fieldname\_size % 8 != 0 )
01582             i = 8-(nfields*fieldname\_size % 8);
01583         \textcolor{keywordflow}{else}
01584             i = 0;
01585         \textcolor{keywordflow}{if} ( nfields ) \{
01586             \textcolor{keywordtype}{char} *ptr = (\textcolor{keywordtype}{char}*)malloc(nfields*fieldname\_size+i);
01587             bytesread += InflateFieldNames(mat,matvar,ptr,nfields,fieldname\_size,i);
01588             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields} = nfields;
01589             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames} =
01590                 (\textcolor{keywordtype}{char}**)calloc(nfields,\textcolor{keyword}{sizeof}(*matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->
      \hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}));
01591             \textcolor{keywordflow}{for} ( i = 0; i < nfields; i++ ) \{
01592                 matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i] = (\textcolor{keywordtype}{char}*)malloc(fieldname\_size);
01593                 \textcolor{keywordflow}{if} ( NULL != matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i] ) \{
01594                     memcpy(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i], ptr+i*fieldname\_size, 
      fieldname\_size);
01595                     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i][fieldname\_size-1] = \textcolor{charliteral}{'\(\backslash\)0'};
01596                 \}
01597             \}
01598             free(ptr);
01599         \} \textcolor{keywordflow}{else} \{
01600             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields} = 0;
01601             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames} = NULL;
01602         \}
01603 
01604         matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} = nmemb*nfields*matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size};
01605         \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} )
01606             \textcolor{keywordflow}{return} bytesread;
01607 
01608         matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} = calloc(nmemb*nfields, matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size});
01609         \textcolor{keywordflow}{if} ( NULL == matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} ) \{
01610             \textcolor{keywordflow}{if} ( NULL != matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} )
01611                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't allocate memory for %s->data"}, matvar->
      \hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
01612             \textcolor{keywordflow}{return} bytesread;
01613         \}
01614 
01615         fields = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t}**)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
01616         for ( i = 0; i < nmemb; i++ ) \{
01617             \textcolor{keywordflow}{for} ( j = 0; j < nfields; j++ ) \{
01618                 fields[i*nfields+j] = \hyperlink{group___m_a_t_gae7c9c3699f6e9c31a9c490300013098c}{Mat\_VarCalloc}();
01619                 fields[i*nfields+j]->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} = strdup(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->
      \hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[j]);
01620             \}
01621         \}
01622 
01623         \textcolor{keywordflow}{for} ( i = 0; i < nmemb*nfields; i++ ) \{
01624             \textcolor{comment}{/* Read variable tag for struct field */}
01625             bytesread += InflateVarTag(mat,matvar,uncomp\_buf);
01626             \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01627                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf);
01628                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+1);
01629             \}
01630             nbytes = uncomp\_buf[1];
01631             \textcolor{keywordflow}{if} ( uncomp\_buf[0] != \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a32985fee89a4df8db4b3f5d3a48823d3}{MAT\_T\_MATRIX} ) \{
01632                 \hyperlink{group___m_a_t_ga1d14716f7450530fd1c9d02413787f0e}{Mat\_VarFree}(fields[i]);
01633                 fields[i] = NULL;
01634                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"fields[%d], Uncompressed type not MAT\_T\_MATRIX"},i);
01635                 \textcolor{keywordflow}{continue};
01636             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( 0 == nbytes ) \{
01637                 \textcolor{comment}{/* Empty field: Memory optimization */}
01638                 free(fields[i]->\textcolor{keyword}{internal});
01639                 fields[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal} = NULL;
01640                 \textcolor{keywordflow}{continue};
01641             \}
01642             fields[i]->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} = \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a5181d2f71eab0f12f05ba65d4f13fb53}{MAT\_COMPRESSION\_ZLIB};
01643             bytesread += InflateArrayFlags(mat,matvar,uncomp\_buf);
01644             nbytes -= 16;
01645             \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01646                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf);
01647                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+1);
01648                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+2);
01649                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+3);
01650             \}
01651             \textcolor{comment}{/* Array flags */}
01652             \textcolor{keywordflow}{if} ( uncomp\_buf[0] == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32} ) \{
01653                array\_flags = uncomp\_buf[2];
01654                fields[i]->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} = \hyperlink{mat5_8c_a85a616d27707e89bda9fd2e9bbb6a586}{CLASS\_FROM\_ARRAY\_FLAGS}(array\_flags);
01655                fields[i]->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex}  = (array\_flags & \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbbacd7b091a11184aad7fc6078c04470780}{MAT\_F\_COMPLEX});
01656                fields[i]->\hyperlink{group___m_a_t_af26c71c4c0ddb14931d15910dddac1bc}{isGlobal}   = (array\_flags & \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba49084e0c796aa7963e53f7539525d40d}{MAT\_F\_GLOBAL});
01657                fields[i]->\hyperlink{group___m_a_t_a866c1539e68073a837833d74cd4a65be}{isLogical}  = (array\_flags & \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba57eb5c6e200bcbc0f1b7982f29a169c2}{MAT\_F\_LOGICAL});
01658                \textcolor{keywordflow}{if} ( fields[i]->class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a0d5655b7e6178a2242cb3bb56ff4c8d2}{MAT\_C\_SPARSE} ) \{
01659                    \textcolor{comment}{/* Need to find a more appropriate place to store nzmax */}
01660                    fields[i]->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} = uncomp\_buf[3];
01661                \}
01662             \} \textcolor{keywordflow}{else} \{
01663                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Expected MAT\_T\_UINT32 for Array Tags, got %d"},
01664                     uncomp\_buf[0]);
01665                 bytesread+=InflateSkip(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,nbytes);
01666             \}
01667             \textcolor{keywordflow}{if} ( fields[i]->class\_type != \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40ad83c684d250e463c1a3779647695c0c9}{MAT\_C\_OPAQUE} ) \{
01668                 bytesread += InflateDimensions(mat,matvar,uncomp\_buf);
01669                 nbytes -= 8;
01670                 \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01671                     (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf);
01672                     (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+1);
01673                 \}
01674                 \textcolor{comment}{/* Rank and dimension */}
01675                 \textcolor{keywordflow}{if} ( uncomp\_buf[0] == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32} ) \{
01676                     \textcolor{keywordtype}{int} j = 0;
01677 
01678                     fields[i]->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} = uncomp\_buf[1];
01679                     nbytes -= fields[i]->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank};
01680                     fields[i]->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} /= 4;
01681                     fields[i]->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims} = (\textcolor{keywordtype}{size\_t}*)malloc(fields[i]->rank*
01682                                              \textcolor{keyword}{sizeof}(*fields[i]->dims));
01683                     \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01684                         \textcolor{keywordflow}{for} ( j = 0; j < fields[i]->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; j++ )
01685                             fields[i]->dims[j] = \hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+2+j);
01686                     \} \textcolor{keywordflow}{else} \{
01687                         \textcolor{keywordflow}{for} ( j = 0; j < fields[i]->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; j++ )
01688                             fields[i]->dims[j] = uncomp\_buf[2+j];
01689                     \}
01690                     \textcolor{keywordflow}{if} ( fields[i]->rank % 2 != 0 )
01691                         nbytes -= 4;
01692                 \}
01693                 bytesread += InflateVarNameTag(mat,matvar,uncomp\_buf);
01694                 nbytes -= 8;
01695                 fields[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z = (z\_streamp)calloc(1,\textcolor{keyword}{sizeof}(
      \hyperlink{structz__stream__s}{z\_stream}));
01696                 \textcolor{keywordflow}{if} ( fields[i]->\hyperlink{namespaceinternal}{internal}->z != NULL ) \{
01697                     err = inflateCopy(fields[i]->\hyperlink{namespaceinternal}{internal}->z,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z);
01698                     \textcolor{keywordflow}{if} ( err == Z\_OK ) \{
01699                         fields[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} = ftell((FILE*)mat->
      \hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01700                         \textcolor{keywordflow}{if} ( fields[i]->\hyperlink{namespaceinternal}{internal}->datapos != -1L ) \{
01701                             fields[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} -= matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in;
01702                             \textcolor{keywordflow}{if} ( fields[i]->class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT} )
01703                                 bytesread+=ReadNextStructField(mat,fields[i]);
01704                             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( fields[i]->class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2f7abb47a1c51e248bd4e5e03cc81b08}{MAT\_C\_CELL} )
01705                                 bytesread+=ReadNextCell(mat,fields[i]);
01706                             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( nbytes <= (1 << MAX\_WBITS) ) \{
01707                                 \textcolor{comment}{/* Memory optimization: Read data if less in size}
01708 \textcolor{comment}{                                   than the zlib inflate state (approximately) */}
01709                                 \hyperlink{mat5_8c_abd8669832a02e759fe190bf2724f60ae}{Read5}(mat,fields[i]);
01710                                 fields[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->data = fields[i]->
      \hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
01711                                 fields[i]->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} = NULL;
01712                             \}
01713                             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},fields[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->
      \hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
01714                         \} \textcolor{keywordflow}{else} \{
01715                             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
01716                         \}
01717                         \textcolor{keywordflow}{if} ( fields[i]->\hyperlink{namespaceinternal}{internal}->data != NULL ||
01718                              fields[i]->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT} ||
01719                              fields[i]->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2f7abb47a1c51e248bd4e5e03cc81b08}{MAT\_C\_CELL} ) \{
01720                             \textcolor{comment}{/* Memory optimization: Free inflate state */}
01721                             inflateEnd(fields[i]->\hyperlink{namespaceinternal}{internal}->z);
01722                             free(fields[i]->\hyperlink{namespaceinternal}{internal}->z);
01723                             fields[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z = NULL;
01724                         \}
01725                     \} \textcolor{keywordflow}{else} \{
01726                         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"inflateCopy returned error %s"},zError(err));
01727                     \}
01728                 \} \textcolor{keywordflow}{else} \{
01729                     \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't allocate memory"});
01730                 \}
01731             \}
01732             bytesread+=InflateSkip(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,nbytes);
01733         \}
01734 \textcolor{preprocessor}{#else}
01735         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Not compiled with zlib support"});
01736 \textcolor{preprocessor}{#endif}
01737     \} \textcolor{keywordflow}{else} \{
01738         mat\_uint32\_t buf[16] = \{0,\};
01739         \textcolor{keywordtype}{int} nbytes,nBytes,j;
01740         mat\_uint32\_t array\_flags;
01741 
01742         bytesread+=fread(buf,4,2,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01743         \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01744             (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf);
01745             (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+1);
01746         \}
01747         \textcolor{keywordflow}{if} ( (buf[0] & 0x0000ffff) == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32} ) \{
01748             fieldname\_size = buf[1];
01749             \textcolor{keywordflow}{if} ( 0 >= fieldname\_size ) \{
01750                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Size of fieldname must be positive"});
01751                 \textcolor{keywordflow}{return} bytesread;
01752             \}
01753         \} \textcolor{keywordflow}{else} \{
01754             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Error getting fieldname size"});
01755             \textcolor{keywordflow}{return} bytesread;
01756         \}
01757         bytesread+=fread(buf,4,2,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01758         \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01759             (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf);
01760             (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+1);
01761         \}
01762         nfields = buf[1];
01763         nfields = nfields / fieldname\_size;
01764         matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \textcolor{keyword}{sizeof}(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *);
01765 
01766         \textcolor{keywordflow}{if} ( nfields ) \{
01767             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields} = nfields;
01768             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames} =
01769                 (\textcolor{keywordtype}{char}**)calloc(nfields,\textcolor{keyword}{sizeof}(*matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->
      \hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}));
01770             \textcolor{keywordflow}{for} ( i = 0; i < nfields; i++ ) \{
01771                 matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i] = (\textcolor{keywordtype}{char}*)malloc(fieldname\_size);
01772                 \textcolor{keywordflow}{if} ( NULL != matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i] ) \{
01773                     bytesread+=fread(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i],1,fieldname\_size,(
      FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01774                     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i][fieldname\_size-1] = \textcolor{charliteral}{'\(\backslash\)0'};
01775                 \}
01776             \}
01777         \} \textcolor{keywordflow}{else} \{
01778             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields} = 0;
01779             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames} = NULL;
01780         \}
01781 
01782         \textcolor{keywordflow}{if} ( (nfields*fieldname\_size) % 8 ) \{
01783             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},8-((nfields*fieldname\_size) % 8),SEEK\_CUR);
01784             bytesread+=8-((nfields*fieldname\_size) % 8);
01785         \}
01786 
01787         matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} = nmemb*nfields*matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size};
01788         \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} )
01789             \textcolor{keywordflow}{return} bytesread;
01790 
01791         matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} = malloc(matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes});
01792         \textcolor{keywordflow}{if} ( NULL == matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} )
01793             \textcolor{keywordflow}{return} bytesread;
01794 
01795         fields = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t}**)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
01796         for ( i = 0; i < nmemb; i++ ) \{
01797             \textcolor{keywordflow}{for} ( j = 0; j < nfields; j++ ) \{
01798                 fields[i*nfields+j] = \hyperlink{group___m_a_t_gae7c9c3699f6e9c31a9c490300013098c}{Mat\_VarCalloc}();
01799                 fields[i*nfields+j]->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} = strdup(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->
      \hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[j]);
01800             \}
01801         \}
01802 
01803         \textcolor{keywordflow}{for} ( i = 0; i < nmemb*nfields; i++ ) \{
01804             \textcolor{comment}{/* Read variable tag for struct field */}
01805             bytesread += fread(buf,4,2,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01806             \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01807                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf);
01808                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+1);
01809             \}
01810             nBytes = buf[1];
01811             \textcolor{keywordflow}{if} ( buf[0] != \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a32985fee89a4df8db4b3f5d3a48823d3}{MAT\_T\_MATRIX} ) \{
01812                 \hyperlink{group___m_a_t_ga1d14716f7450530fd1c9d02413787f0e}{Mat\_VarFree}(fields[i]);
01813                 fields[i] = NULL;
01814                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"fields[%d] not MAT\_T\_MATRIX, fpos = %ld"},i,
01815                     ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp}));
01816                 \textcolor{keywordflow}{return} bytesread;
01817             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( 0 == nBytes ) \{
01818                 \textcolor{comment}{/* Empty field: Memory optimization */}
01819                 free(fields[i]->\textcolor{keyword}{internal});
01820                 fields[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal} = NULL;
01821                 \textcolor{keywordflow}{continue};
01822             \}
01823 
01824             \textcolor{comment}{/* Read array flags and the dimensions tag */}
01825             bytesread += fread(buf,4,6,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01826             \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01827                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf);
01828                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+1);
01829                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+2);
01830                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+3);
01831                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+4);
01832                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+5);
01833             \}
01834             nBytes-=24;
01835             \textcolor{comment}{/* Array flags */}
01836             \textcolor{keywordflow}{if} ( buf[0] == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32} ) \{
01837                array\_flags = buf[2];
01838                fields[i]->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} = \hyperlink{mat5_8c_a85a616d27707e89bda9fd2e9bbb6a586}{CLASS\_FROM\_ARRAY\_FLAGS}(array\_flags);
01839                fields[i]->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex}  = (array\_flags & \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbbacd7b091a11184aad7fc6078c04470780}{MAT\_F\_COMPLEX});
01840                fields[i]->\hyperlink{group___m_a_t_af26c71c4c0ddb14931d15910dddac1bc}{isGlobal}   = (array\_flags & \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba49084e0c796aa7963e53f7539525d40d}{MAT\_F\_GLOBAL});
01841                fields[i]->\hyperlink{group___m_a_t_a866c1539e68073a837833d74cd4a65be}{isLogical}  = (array\_flags & \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba57eb5c6e200bcbc0f1b7982f29a169c2}{MAT\_F\_LOGICAL});
01842                \textcolor{keywordflow}{if} ( fields[i]->class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a0d5655b7e6178a2242cb3bb56ff4c8d2}{MAT\_C\_SPARSE} ) \{
01843                    \textcolor{comment}{/* Need to find a more appropriate place to store nzmax */}
01844                    fields[i]->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} = buf[3];
01845                \}
01846             \}
01847             \textcolor{comment}{/* Rank and dimension */}
01848             \textcolor{keywordflow}{if} ( buf[4] == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32} ) \{
01849                 \textcolor{keywordtype}{int} j;
01850 
01851                 nbytes = buf[5];
01852                 nBytes-=nbytes;
01853 
01854                 fields[i]->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} = nbytes / 4;
01855                 fields[i]->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims} = (\textcolor{keywordtype}{size\_t}*)malloc(fields[i]->rank*
01856                                          \textcolor{keyword}{sizeof}(*fields[i]->dims));
01857 
01858                 \textcolor{comment}{/* Assumes rank <= 16 */}
01859                 \textcolor{keywordflow}{if} ( fields[i]->rank % 2 != 0 ) \{
01860                     bytesread+=fread(buf,4,fields[i]->rank+1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01861                     nBytes-=4;
01862                 \} \textcolor{keywordflow}{else}
01863                     bytesread+=fread(buf,4,fields[i]->rank,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01864 
01865                 \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
01866                     \textcolor{keywordflow}{for} ( j = 0; j < fields[i]->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; j++ )
01867                         fields[i]->dims[j] = \hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+j);
01868                 \} \textcolor{keywordflow}{else} \{
01869                     \textcolor{keywordflow}{for} ( j = 0; j < fields[i]->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; j++ )
01870                         fields[i]->dims[j] = buf[j];
01871                 \}
01872             \}
01873             \textcolor{comment}{/* Variable name tag */}
01874             bytesread+=fread(buf,1,8,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01875             nBytes-=8;
01876             fields[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01877             \textcolor{keywordflow}{if} ( fields[i]->\hyperlink{namespaceinternal}{internal}->datapos != -1L ) \{
01878                 \textcolor{keywordflow}{if} ( fields[i]->class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT} )
01879                     bytesread+=ReadNextStructField(mat,fields[i]);
01880                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( fields[i]->class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2f7abb47a1c51e248bd4e5e03cc81b08}{MAT\_C\_CELL} )
01881                     bytesread+=ReadNextCell(mat,fields[i]);
01882                 (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},fields[i]->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->
      \hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos}+nBytes,SEEK\_SET);
01883             \} \textcolor{keywordflow}{else} \{
01884                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
01885             \}
01886         \}
01887     \}
01888 
01889     \textcolor{keywordflow}{return} bytesread;
01890 \}
01891 
01899 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
01900 ReadNextFunctionHandle(\hyperlink{struct__mat__t}{mat\_t} *mat, \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar)
01901 \{
01902     \textcolor{keywordtype}{int} nfunctions = 1, i;
01903     \textcolor{keywordtype}{size\_t} bytesread = 0;
01904 
01905     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
01906         nfunctions *= matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
01907 
01908     matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} = malloc(nfunctions*\textcolor{keyword}{sizeof}(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *));
01909     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} != NULL ) \{
01910         \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **functions = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t}**)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};;
01911         matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \textcolor{keyword}{sizeof}(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *);
01912         matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes}    = nfunctions*matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size};
01913         \textcolor{keywordflow}{for} ( i = 0; i < nfunctions; i++ )
01914             functions[i] = \hyperlink{group___m_a_t_ga72dd99330507b17177e22f9ed3bea5e6}{Mat\_VarReadNextInfo}(mat);
01915     \} \textcolor{keywordflow}{else} \{
01916         bytesread = 0;
01917         matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = 0;
01918         matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes}    = 0;
01919     \}
01920 
01921     \textcolor{keywordflow}{return} bytesread;
01922 \}
01923 
01931 \textcolor{keyword}{static} \textcolor{keywordtype}{int}
01932 WriteCellArrayFieldInfo(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar)
01933 \{
01934     mat\_uint32\_t array\_flags = 0x0;
01935     mat\_int16\_t  array\_name\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8};
01936     \textcolor{keywordtype}{int}      array\_flags\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32}, dims\_array\_type = 
      \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32};
01937     \textcolor{keywordtype}{int}      array\_flags\_size = 8, pad4 = 0, matrix\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a32985fee89a4df8db4b3f5d3a48823d3}{MAT\_T\_MATRIX};
01938     mat\_int8\_t   pad1 = 0;
01939     \textcolor{keywordtype}{int}      nBytes, i, nmemb = 1;
01940     \textcolor{keywordtype}{long}     start = 0, end = 0;
01941 
01942     \textcolor{keywordflow}{if} ( matvar == NULL ||  mat == NULL )
01943         \textcolor{keywordflow}{return} 0;
01944 
01945 \textcolor{preprocessor}{#if 0}
01946     nBytes = GetMatrixMaxBufSize(matvar);
01947 \textcolor{preprocessor}{#endif}
01948 
01949     fwrite(&matrix\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01950     fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01951     start = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01952 
01953     \textcolor{comment}{/* Array Flags */}
01954     array\_flags = matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} & \hyperlink{mat5_8c_a24b94e17e9c34b9c795798099c710751}{CLASS\_TYPE\_MASK};
01955     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} )
01956         array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbbacd7b091a11184aad7fc6078c04470780}{MAT\_F\_COMPLEX};
01957     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_af26c71c4c0ddb14931d15910dddac1bc}{isGlobal} )
01958         array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba49084e0c796aa7963e53f7539525d40d}{MAT\_F\_GLOBAL};
01959     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a866c1539e68073a837833d74cd4a65be}{isLogical} )
01960         array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba57eb5c6e200bcbc0f1b7982f29a169c2}{MAT\_F\_LOGICAL};
01961 
01962     \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
01963         array\_flags = \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}((mat\_int32\_t*)&array\_flags);
01964     fwrite(&array\_flags\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01965     fwrite(&array\_flags\_size,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01966     fwrite(&array\_flags,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01967     fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01968     \textcolor{comment}{/* Rank and Dimension */}
01969     nBytes = matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} * 4;
01970     fwrite(&dims\_array\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01971     fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01972     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ ) \{
01973         mat\_int32\_t dim;
01974         dim = matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
01975         nmemb *= dim;
01976         fwrite(&dim,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01977     \}
01978     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} % 2 != 0 )
01979         fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01980     \textcolor{comment}{/* Name of variable */}
01981     \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} ) \{
01982         fwrite(&array\_name\_type,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01983         fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01984         fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01985         fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01986     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( strlen(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name}) <= 4 ) \{
01987         mat\_int16\_t array\_name\_len = (mat\_int16\_t)strlen(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
01988         mat\_int8\_t  pad1 = 0;
01989         fwrite(&array\_name\_type,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01990         fwrite(&array\_name\_len,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01991         fwrite(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},1,array\_name\_len,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01992         \textcolor{keywordflow}{for} ( i = array\_name\_len; i < 4; i++ )
01993             fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01994     \} \textcolor{keywordflow}{else} \{
01995         mat\_int32\_t array\_name\_len = (mat\_int32\_t)strlen(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
01996         mat\_int8\_t  pad1 = 0;
01997 
01998         fwrite(&array\_name\_type,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
01999         fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02000         fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02001         fwrite(&array\_name\_len,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02002         fwrite(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},1,array\_name\_len,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02003         \textcolor{keywordflow}{if} ( array\_name\_len % 8 )
02004             \textcolor{keywordflow}{for} ( i = array\_name\_len % 8; i < 8; i++ )
02005                 fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02006     \}
02007 
02008     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02009     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} == -1L ) \{
02010         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
02011     \}
02012     \textcolor{keywordflow}{switch} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} ) \{
02013         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5d70e0862e5bdb7bd86bf7ba5948f307}{MAT\_C\_DOUBLE}:
02014         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2825631e26a961cbe0f79db50a39cea2}{MAT\_C\_SINGLE}:
02015         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a1ea83bcde49b35477494412973f82409}{MAT\_C\_INT64}:
02016         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a86470e25c3763d9a24623f04326195dd}{MAT\_C\_UINT64}:
02017         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40adb44fc39694e3152ae5e69470a2fefe8}{MAT\_C\_INT32}:
02018         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a9a17a7edd45b19ef68197db81b27e816}{MAT\_C\_UINT32}:
02019         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a40370e9de516c5036a67a5865c071006}{MAT\_C\_INT16}:
02020         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a8bede21dbf6c1edc0bbccc1481bccae7}{MAT\_C\_UINT16}:
02021         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a984ff310f9e906100fcff95f704f43c5}{MAT\_C\_INT8}:
02022         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a81270f8093cb4808e992c1d29d84d4e3}{MAT\_C\_UINT8}:
02023             nBytes = WriteEmptyData(mat,nmemb,matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
02024             \textcolor{keywordflow}{if} ( nBytes % 8 )
02025                 \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
02026                     fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02027             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
02028                 nBytes = WriteEmptyData(mat,nmemb,matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
02029                 \textcolor{keywordflow}{if} ( nBytes % 8 )
02030                     \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
02031                         fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02032             \}
02033             \textcolor{keywordflow}{break};
02034         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40aacdec5834df0861130b393697646119c}{MAT\_C\_CHAR}:
02035         \{
02036             WriteEmptyCharData(mat,nmemb,matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
02037             \textcolor{keywordflow}{break};
02038         \}
02039         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2f7abb47a1c51e248bd4e5e03cc81b08}{MAT\_C\_CELL}:
02040         \{
02041             \textcolor{keywordtype}{int}        ncells;
02042             \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **cells = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
02043 
02044             \textcolor{comment}{/* Check for an empty cell array */}
02045             if ( matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} == 0 || matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} == 0 ||
02046                  matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data}   == NULL )
02047                 \textcolor{keywordflow}{break};
02048             ncells  = matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} / matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size};
02049 
02050             \textcolor{keywordflow}{for} ( i = 0; i < ncells; i++ )
02051                 WriteCellArrayFieldInfo(mat,cells[i]);
02052             \textcolor{keywordflow}{break};
02053         \}
02054         \textcolor{comment}{/* FIXME: Structures */}
02055         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT}:
02056         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a0d5655b7e6178a2242cb3bb56ff4c8d2}{MAT\_C\_SPARSE}:
02057         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40aaa9bf08312779cd1ab8e504a162ddcea}{MAT\_C\_FUNCTION}:
02058         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40afe45104b68b044c83a2f99e349fa1ea6}{MAT\_C\_OBJECT}:
02059         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5c76eef0ca0373d25abe49053be6fa9a}{MAT\_C\_EMPTY}:
02060         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40ad83c684d250e463c1a3779647695c0c9}{MAT\_C\_OPAQUE}:
02061             \textcolor{keywordflow}{break};
02062     \}
02063     end = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02064     \textcolor{keywordflow}{if} ( start != -1L && end != -1L ) \{
02065         nBytes = (int)(end-start);
02066         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},(long)-(nBytes+4),SEEK\_CUR);
02067         fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02068         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},end,SEEK\_SET);
02069     \} \textcolor{keywordflow}{else} \{
02070         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
02071     \}
02072 
02073     \textcolor{keywordflow}{return} 0;
02074 \}
02075 
02083 \textcolor{keyword}{static} \textcolor{keywordtype}{int}
02084 WriteType(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar)
02085 \{
02086     mat\_int16\_t array\_name\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8};
02087     mat\_int8\_t pad1 = 0;
02088     \textcolor{keywordtype}{int} nBytes, i, nmemb = 1;
02089 
02090     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
02091         nmemb *= matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
02092 
02093     switch ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} ) \{
02094         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5d70e0862e5bdb7bd86bf7ba5948f307}{MAT\_C\_DOUBLE}:
02095         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2825631e26a961cbe0f79db50a39cea2}{MAT\_C\_SINGLE}:
02096         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a1ea83bcde49b35477494412973f82409}{MAT\_C\_INT64}:
02097         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a86470e25c3763d9a24623f04326195dd}{MAT\_C\_UINT64}:
02098         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40adb44fc39694e3152ae5e69470a2fefe8}{MAT\_C\_INT32}:
02099         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a9a17a7edd45b19ef68197db81b27e816}{MAT\_C\_UINT32}:
02100         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a40370e9de516c5036a67a5865c071006}{MAT\_C\_INT16}:
02101         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a8bede21dbf6c1edc0bbccc1481bccae7}{MAT\_C\_UINT16}:
02102         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a984ff310f9e906100fcff95f704f43c5}{MAT\_C\_INT8}:
02103         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a81270f8093cb4808e992c1d29d84d4e3}{MAT\_C\_UINT8}:
02104         \{
02105             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
02106                 \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t} *complex\_data = (
      \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t}*)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
02107 
02108                 if ( NULL == matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} )
02109                     complex\_data = &null\_complex\_data;
02110 
02111                 nBytes=\hyperlink{mat5_8c_a1bec2ccf2a3b48706edd32e63744d364}{WriteData}(mat,complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},nmemb,matvar->
      \hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
02112                 \textcolor{keywordflow}{if} ( nBytes % 8 )
02113                     \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
02114                         fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02115                 nBytes=\hyperlink{mat5_8c_a1bec2ccf2a3b48706edd32e63744d364}{WriteData}(mat,complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},nmemb,matvar->
      \hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
02116                 \textcolor{keywordflow}{if} ( nBytes % 8 )
02117                     \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
02118                         fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02119             \} \textcolor{keywordflow}{else} \{
02120                 nBytes=\hyperlink{mat5_8c_a1bec2ccf2a3b48706edd32e63744d364}{WriteData}(mat,matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data},nmemb,matvar->
      \hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
02121                 \textcolor{keywordflow}{if} ( nBytes % 8 )
02122                     \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
02123                         fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02124             \}
02125             \textcolor{keywordflow}{break};
02126         \}
02127         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40aacdec5834df0861130b393697646119c}{MAT\_C\_CHAR}:
02128             nBytes=WriteCharData(mat,matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data},nmemb,matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
02129             \textcolor{keywordflow}{break};
02130         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2f7abb47a1c51e248bd4e5e03cc81b08}{MAT\_C\_CELL}:
02131         \{
02132             \textcolor{keywordtype}{int}        ncells;
02133             \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **cells = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
02134 
02135             \textcolor{comment}{/* Check for an empty cell array */}
02136             if ( matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} == 0 || matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} == 0 ||
02137                  matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data}   == NULL )
02138                 \textcolor{keywordflow}{break};
02139             ncells  = matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} / matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size};
02140 
02141             \textcolor{keywordflow}{for} ( i = 0; i < ncells; i++ )
02142                 WriteCellArrayField(mat,cells[i]);
02143             \textcolor{keywordflow}{break};
02144         \}
02145         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT}:
02146         \{
02147             mat\_int16\_t fieldname\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32};
02148             mat\_int16\_t fieldname\_data\_size = 4;
02149             \textcolor{keywordtype}{char} *padzero;
02150             \textcolor{keywordtype}{int} fieldname\_size, nfields;
02151             \textcolor{keywordtype}{size\_t} maxlen = 0;
02152             \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **fields = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
02153             \textcolor{keywordtype}{unsigned} fieldname;
02154 
02155             \textcolor{comment}{/* nmemb*matvar->data\_size can be zero when saving a struct that}
02156 \textcolor{comment}{             * contains an empty struct in one of its fields}
02157 \textcolor{comment}{             * (e.g. x.y = struct('z', \{\})). If it's zero, we would divide}
02158 \textcolor{comment}{             * by zero.}
02159 \textcolor{comment}{             */}
02160             nfields = matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields};
02161             \textcolor{comment}{/* Check for a structure with no fields */}
02162             if ( nfields < 1 ) \{
02163 \textcolor{preprocessor}{#if 0}
02164                 fwrite(&fieldname\_type,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02165                 fwrite(&fieldname\_data\_size,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02166 \textcolor{preprocessor}{#else}
02167                 fieldname = (fieldname\_data\_size<<16) | fieldname\_type;
02168                 fwrite(&fieldname,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02169 \textcolor{preprocessor}{#endif}
02170                 fieldname\_size = 1;
02171                 fwrite(&fieldname\_size,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02172                 fwrite(&array\_name\_type,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02173                 fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02174                 fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02175                 nBytes = 0;
02176                 fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02177                 \textcolor{keywordflow}{break};
02178             \}
02179 
02180             \textcolor{keywordflow}{for} ( i = 0; i < nfields; i++ ) \{
02181                 \textcolor{keywordtype}{size\_t} len = strlen(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i]);
02182                 \textcolor{keywordflow}{if} ( len > maxlen )
02183                     maxlen = len;
02184             \}
02185             maxlen++;
02186             fieldname\_size = maxlen;
02187             \textcolor{keywordflow}{while} ( nfields*fieldname\_size % 8 != 0 )
02188                 fieldname\_size++;
02189 \textcolor{preprocessor}{#if 0}
02190             fwrite(&fieldname\_type,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02191             fwrite(&fieldname\_data\_size,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02192 \textcolor{preprocessor}{#else}
02193             fieldname = (fieldname\_data\_size<<16) | fieldname\_type;
02194             fwrite(&fieldname,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02195 \textcolor{preprocessor}{#endif}
02196             fwrite(&fieldname\_size,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02197             fwrite(&array\_name\_type,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02198             fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02199             fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02200             nBytes = nfields*fieldname\_size;
02201             fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02202             padzero = (\textcolor{keywordtype}{char}*)calloc(fieldname\_size,1);
02203             \textcolor{keywordflow}{for} ( i = 0; i < nfields; i++ ) \{
02204                 \textcolor{keywordtype}{size\_t} len = strlen(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i]);
02205                 fwrite(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i],1,len,(FILE*)mat->
      \hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02206                 fwrite(padzero,1,fieldname\_size-len,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02207             \}
02208             free(padzero);
02209             \textcolor{keywordflow}{for} ( i = 0; i < nmemb*nfields; i++ )
02210                 WriteStructField(mat,fields[i]);
02211             \textcolor{keywordflow}{break};
02212         \}
02213         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a0d5655b7e6178a2242cb3bb56ff4c8d2}{MAT\_C\_SPARSE}:
02214         \{
02215             \hyperlink{group___m_a_t_structmat__sparse__t}{mat\_sparse\_t} *sparse = (\hyperlink{group___m_a_t_structmat__sparse__t}{mat\_sparse\_t}*)matvar->
      \hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
02216 
02217             nBytes = \hyperlink{mat5_8c_a1bec2ccf2a3b48706edd32e63744d364}{WriteData}(mat,sparse->\hyperlink{group___m_a_t_a8d4c863d704edddec5cbfa15b2d719c8}{ir},sparse->\hyperlink{group___m_a_t_aa64636ad57cf87f7a28ff5018437a850}{nir},
      \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32});
02218             \textcolor{keywordflow}{if} ( nBytes % 8 )
02219                 \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
02220                     fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02221             nBytes = \hyperlink{mat5_8c_a1bec2ccf2a3b48706edd32e63744d364}{WriteData}(mat,sparse->\hyperlink{group___m_a_t_ad1e74cdc4f7eff1e47a670297c01da4b}{jc},sparse->\hyperlink{group___m_a_t_a482d8e4b40aa975f0c1daf146ebe08a4}{njc},
      \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32});
02222             \textcolor{keywordflow}{if} ( nBytes % 8 )
02223                 \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
02224                     fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02225             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
02226                 \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t} *complex\_data = (
      \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t}*)sparse->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data};
02227                 nBytes = \hyperlink{mat5_8c_a1bec2ccf2a3b48706edd32e63744d364}{WriteData}(mat,complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},sparse->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata},
02228                                    matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
02229                 \textcolor{keywordflow}{if} ( nBytes % 8 )
02230                     \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
02231                         fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02232                 nBytes = \hyperlink{mat5_8c_a1bec2ccf2a3b48706edd32e63744d364}{WriteData}(mat,complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},sparse->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata},
02233                                    matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
02234                 \textcolor{keywordflow}{if} ( nBytes % 8 )
02235                     \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
02236                         fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02237             \} \textcolor{keywordflow}{else} \{
02238                 nBytes = \hyperlink{mat5_8c_a1bec2ccf2a3b48706edd32e63744d364}{WriteData}(mat,sparse->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},sparse->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata},
02239                                    matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
02240                 \textcolor{keywordflow}{if} ( nBytes % 8 )
02241                     \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
02242                         fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02243             \}
02244         \}
02245         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40aaa9bf08312779cd1ab8e504a162ddcea}{MAT\_C\_FUNCTION}:
02246         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40afe45104b68b044c83a2f99e349fa1ea6}{MAT\_C\_OBJECT}:
02247         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5c76eef0ca0373d25abe49053be6fa9a}{MAT\_C\_EMPTY}:
02248         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40ad83c684d250e463c1a3779647695c0c9}{MAT\_C\_OPAQUE}:
02249             \textcolor{keywordflow}{break};
02250     \}
02251 
02252     \textcolor{keywordflow}{return} 0;
02253 \}
02254 
02262 \textcolor{keyword}{static} \textcolor{keywordtype}{int}
02263 WriteCellArrayField(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar)
02264 \{
02265     mat\_uint32\_t array\_flags = 0x0;
02266     mat\_int16\_t array\_name\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8};
02267     \textcolor{keywordtype}{int} array\_flags\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32}, dims\_array\_type = 
      \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32};
02268     \textcolor{keywordtype}{int} array\_flags\_size = 8, pad4 = 0, matrix\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a32985fee89a4df8db4b3f5d3a48823d3}{MAT\_T\_MATRIX};
02269     mat\_int8\_t pad1 = 0;
02270     \textcolor{keywordtype}{int} nBytes, i, nmemb = 1, nzmax = 0;
02271     \textcolor{keywordtype}{long} start = 0, end = 0;
02272 
02273     \textcolor{keywordflow}{if} ( matvar == NULL || mat == NULL )
02274         \textcolor{keywordflow}{return} 1;
02275 
02276 \textcolor{preprocessor}{#if 0}
02277     nBytes = GetMatrixMaxBufSize(matvar);
02278 \textcolor{preprocessor}{#endif}
02279 
02280     fwrite(&matrix\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02281     fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02282     \textcolor{keywordflow}{if} ( \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5c76eef0ca0373d25abe49053be6fa9a}{MAT\_C\_EMPTY} == matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} ) \{
02283         \textcolor{comment}{/* exit early if this is an empty data */}
02284         \textcolor{keywordflow}{return} 0;
02285     \}
02286     start = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02287 
02288     \textcolor{comment}{/* Array Flags */}
02289     array\_flags = matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} & \hyperlink{mat5_8c_a24b94e17e9c34b9c795798099c710751}{CLASS\_TYPE\_MASK};
02290     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} )
02291         array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbbacd7b091a11184aad7fc6078c04470780}{MAT\_F\_COMPLEX};
02292     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_af26c71c4c0ddb14931d15910dddac1bc}{isGlobal} )
02293         array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba49084e0c796aa7963e53f7539525d40d}{MAT\_F\_GLOBAL};
02294     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a866c1539e68073a837833d74cd4a65be}{isLogical} )
02295         array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba57eb5c6e200bcbc0f1b7982f29a169c2}{MAT\_F\_LOGICAL};
02296     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a0d5655b7e6178a2242cb3bb56ff4c8d2}{MAT\_C\_SPARSE} )
02297         nzmax = ((\hyperlink{group___m_a_t_structmat__sparse__t}{mat\_sparse\_t} *)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data})->nzmax;
02298 
02299     \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
02300         array\_flags = \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}((mat\_int32\_t*)&array\_flags);
02301     fwrite(&array\_flags\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02302     fwrite(&array\_flags\_size,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02303     fwrite(&array\_flags,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02304     fwrite(&nzmax,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02305     \textcolor{comment}{/* Rank and Dimension */}
02306     nBytes = matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} * 4;
02307     fwrite(&dims\_array\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02308     fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02309     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ ) \{
02310         mat\_int32\_t dim;
02311         dim = matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
02312         nmemb *= dim;
02313         fwrite(&dim,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02314     \}
02315     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} % 2 != 0 )
02316         fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02317     \textcolor{comment}{/* Name of variable */}
02318     \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} ) \{
02319         fwrite(&array\_name\_type,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02320         fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02321         fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02322         fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02323     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( strlen(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name}) <= 4 ) \{
02324         mat\_int16\_t array\_name\_len = (mat\_int16\_t)strlen(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
02325         mat\_int8\_t  pad1 = 0;
02326         fwrite(&array\_name\_type,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02327         fwrite(&array\_name\_len,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02328         fwrite(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},1,array\_name\_len,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02329         \textcolor{keywordflow}{for} ( i = array\_name\_len; i < 4; i++ )
02330             fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02331     \} \textcolor{keywordflow}{else} \{
02332         mat\_int32\_t array\_name\_len = (mat\_int32\_t)strlen(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
02333         mat\_int8\_t  pad1 = 0;
02334 
02335         fwrite(&array\_name\_type,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02336         fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02337         fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02338         fwrite(&array\_name\_len,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02339         fwrite(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},1,array\_name\_len,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02340         \textcolor{keywordflow}{if} ( array\_name\_len % 8 )
02341             \textcolor{keywordflow}{for} ( i = array\_name\_len % 8; i < 8; i++ )
02342                 fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02343     \}
02344 
02345     WriteType(mat,matvar);
02346     end = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02347     \textcolor{keywordflow}{if} ( start != -1L && end != -1L ) \{
02348         nBytes = (int)(end-start);
02349         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},(long)-(nBytes+4),SEEK\_CUR);
02350         fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02351         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},end,SEEK\_SET);
02352     \} \textcolor{keywordflow}{else} \{
02353         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
02354     \}
02355 
02356     \textcolor{keywordflow}{return} 0;
02357 \}
02358 
02359 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
02360 
02367 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
02368 WriteCompressedTypeArrayFlags(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,z\_streamp z)
02369 \{
02370     mat\_uint32\_t array\_flags = 0x0;
02371     mat\_int16\_t  array\_name\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8};
02372     \textcolor{keywordtype}{int} array\_flags\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32}, dims\_array\_type = 
      \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32};
02373     \textcolor{keywordtype}{int} array\_flags\_size = 8;
02374     \textcolor{keywordtype}{int} nBytes, i, nmemb = 1, nzmax = 0;
02375 
02376     mat\_uint32\_t comp\_buf[512];
02377     mat\_uint32\_t uncomp\_buf[512] = \{0,\};
02378     \textcolor{keywordtype}{int} buf\_size = 512;
02379     \textcolor{keywordtype}{size\_t} byteswritten = 0;
02380 
02381     \textcolor{keywordflow}{if} ( \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5c76eef0ca0373d25abe49053be6fa9a}{MAT\_C\_EMPTY} == matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} ) \{
02382         \textcolor{comment}{/* exit early if this is an empty data */}
02383         \textcolor{keywordflow}{return} byteswritten;
02384     \}
02385 
02386     \textcolor{comment}{/* Array Flags */}
02387     array\_flags = matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} & \hyperlink{mat5_8c_a24b94e17e9c34b9c795798099c710751}{CLASS\_TYPE\_MASK};
02388     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} )
02389         array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbbacd7b091a11184aad7fc6078c04470780}{MAT\_F\_COMPLEX};
02390     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_af26c71c4c0ddb14931d15910dddac1bc}{isGlobal} )
02391         array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba49084e0c796aa7963e53f7539525d40d}{MAT\_F\_GLOBAL};
02392     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a866c1539e68073a837833d74cd4a65be}{isLogical} )
02393         array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba57eb5c6e200bcbc0f1b7982f29a169c2}{MAT\_F\_LOGICAL};
02394     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a0d5655b7e6178a2242cb3bb56ff4c8d2}{MAT\_C\_SPARSE} )
02395         nzmax = ((\hyperlink{group___m_a_t_structmat__sparse__t}{mat\_sparse\_t} *)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data})->nzmax;
02396     uncomp\_buf[0] = array\_flags\_type;
02397     uncomp\_buf[1] = array\_flags\_size;
02398     uncomp\_buf[2] = array\_flags;
02399     uncomp\_buf[3] = nzmax;
02400     \textcolor{comment}{/* Rank and Dimension */}
02401     nBytes = matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} * 4;
02402     uncomp\_buf[4] = dims\_array\_type;
02403     uncomp\_buf[5] = nBytes;
02404     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ ) \{
02405         mat\_int32\_t dim;
02406         dim = matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
02407         nmemb *= dim;
02408         uncomp\_buf[6+i] = dim;
02409     \}
02410     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} % 2 != 0 ) \{
02411         \textcolor{keywordtype}{int} pad4 = 0;
02412         uncomp\_buf[6+i] = pad4;
02413         i++;
02414     \}
02415 
02416     z->next\_in  = ZLIB\_BYTE\_PTR(uncomp\_buf);
02417     z->avail\_in = (6+i)*\textcolor{keyword}{sizeof}(*uncomp\_buf);
02418     \textcolor{keywordflow}{do} \{
02419         z->next\_out  = ZLIB\_BYTE\_PTR(comp\_buf);
02420         z->avail\_out = buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf);
02421         deflate(z,Z\_NO\_FLUSH);
02422         byteswritten += fwrite(comp\_buf,1,buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf)-z->avail\_out,
02423             (FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02424     \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
02425     \textcolor{comment}{/* Name of variable */}
02426     uncomp\_buf[0] = array\_name\_type;
02427     uncomp\_buf[1] = 0;
02428     z->next\_in  = ZLIB\_BYTE\_PTR(uncomp\_buf);
02429     z->avail\_in = 8;
02430     \textcolor{keywordflow}{do} \{
02431         z->next\_out  = ZLIB\_BYTE\_PTR(comp\_buf);
02432         z->avail\_out = buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf);
02433         deflate(z,Z\_NO\_FLUSH);
02434         byteswritten += fwrite(comp\_buf,1,buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf)-z->avail\_out,
02435             (FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02436     \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
02437 
02438     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02439     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} == -1L ) \{
02440         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
02441     \}
02442 
02443     byteswritten += WriteCompressedType(mat,matvar,z);
02444     \textcolor{keywordflow}{return} byteswritten;
02445 \}
02446 
02454 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
02455 WriteCompressedType(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,z\_streamp z)
02456 \{
02457     \textcolor{keywordtype}{int} i, nmemb = 1;
02458 
02459     mat\_uint32\_t comp\_buf[512];
02460     mat\_uint32\_t uncomp\_buf[512] = \{0,\};
02461     \textcolor{keywordtype}{size\_t} byteswritten = 0;
02462 
02463     \textcolor{keywordflow}{if} ( \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5c76eef0ca0373d25abe49053be6fa9a}{MAT\_C\_EMPTY} == matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} ) \{
02464         \textcolor{comment}{/* exit early if this is an empty data */}
02465         \textcolor{keywordflow}{return} byteswritten;
02466     \}
02467 
02468     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
02469         nmemb *= matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
02470 
02471     switch ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} ) \{
02472         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5d70e0862e5bdb7bd86bf7ba5948f307}{MAT\_C\_DOUBLE}:
02473         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2825631e26a961cbe0f79db50a39cea2}{MAT\_C\_SINGLE}:
02474         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a1ea83bcde49b35477494412973f82409}{MAT\_C\_INT64}:
02475         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a86470e25c3763d9a24623f04326195dd}{MAT\_C\_UINT64}:
02476         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40adb44fc39694e3152ae5e69470a2fefe8}{MAT\_C\_INT32}:
02477         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a9a17a7edd45b19ef68197db81b27e816}{MAT\_C\_UINT32}:
02478         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a40370e9de516c5036a67a5865c071006}{MAT\_C\_INT16}:
02479         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a8bede21dbf6c1edc0bbccc1481bccae7}{MAT\_C\_UINT16}:
02480         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a984ff310f9e906100fcff95f704f43c5}{MAT\_C\_INT8}:
02481         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a81270f8093cb4808e992c1d29d84d4e3}{MAT\_C\_UINT8}:
02482         \{
02483             \textcolor{comment}{/* WriteCompressedData makes sure uncompressed data is aligned}
02484 \textcolor{comment}{             * on an 8-byte boundary */}
02485             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
02486                 \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t} *complex\_data = (
      \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t}*)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
02487 
02488                 if ( NULL == matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} )
02489                     complex\_data = &null\_complex\_data;
02490 
02491                 byteswritten += WriteCompressedData(mat,z,
02492                     complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},nmemb,matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
02493                 byteswritten += WriteCompressedData(mat,z,
02494                     complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},nmemb,matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
02495             \} \textcolor{keywordflow}{else} \{
02496                 byteswritten += WriteCompressedData(mat,z,
02497                     matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data},nmemb,matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
02498             \}
02499             \textcolor{keywordflow}{break};
02500         \}
02501         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40aacdec5834df0861130b393697646119c}{MAT\_C\_CHAR}:
02502         \{
02503             byteswritten += WriteCompressedCharData(mat,z,matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data},
02504                 nmemb,matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
02505             \textcolor{keywordflow}{break};
02506         \}
02507         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2f7abb47a1c51e248bd4e5e03cc81b08}{MAT\_C\_CELL}:
02508         \{
02509             \textcolor{keywordtype}{int}        ncells;
02510             \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **cells = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
02511 
02512             \textcolor{comment}{/* Check for an empty cell array */}
02513             if ( matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} == 0 || matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} == 0 ||
02514                  matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data}   == NULL )
02515                 \textcolor{keywordflow}{break};
02516             ncells  = matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} / matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size};
02517             \textcolor{keywordflow}{for} ( i = 0; i < ncells; i++ )
02518                 WriteCompressedCellArrayField(mat,cells[i],z);
02519             \textcolor{keywordflow}{break};
02520         \}
02521         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT}:
02522         \{
02523             \textcolor{keywordtype}{int} buf\_size = 512;
02524             mat\_int16\_t fieldname\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32};
02525             mat\_int16\_t fieldname\_data\_size = 4;
02526             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *padzero;
02527             \textcolor{keywordtype}{int} fieldname\_size, nfields;
02528             \textcolor{keywordtype}{size\_t} maxlen = 0;
02529             mat\_int32\_t array\_name\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8};
02530             \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **fields = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
02531 
02532             nfields = matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields};
02533             \textcolor{comment}{/* Check for a structure with no fields */}
02534             if ( nfields < 1 ) \{
02535                 fieldname\_size = 1;
02536                 uncomp\_buf[0] = (fieldname\_data\_size << 16) | fieldname\_type;
02537                 uncomp\_buf[1] = fieldname\_size;
02538                 uncomp\_buf[2] = array\_name\_type;
02539                 uncomp\_buf[3] = 0;
02540                 z->next\_in  = ZLIB\_BYTE\_PTR(uncomp\_buf);
02541                 z->avail\_in = 16;
02542                 \textcolor{keywordflow}{do} \{
02543                     z->next\_out  = ZLIB\_BYTE\_PTR(comp\_buf);
02544                     z->avail\_out = buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf);
02545                     deflate(z,Z\_NO\_FLUSH);
02546                     byteswritten += fwrite(comp\_buf,1,buf\_size*
02547                         \textcolor{keyword}{sizeof}(*comp\_buf)-z->avail\_out,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02548                 \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
02549                 \textcolor{keywordflow}{break};
02550             \}
02551 
02552             \textcolor{keywordflow}{for} ( i = 0; i < nfields; i++ ) \{
02553                 \textcolor{keywordtype}{size\_t} len = strlen(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i]);
02554                 \textcolor{keywordflow}{if} ( len > maxlen )
02555                     maxlen = len;
02556             \}
02557             maxlen++;
02558             fieldname\_size = maxlen;
02559             \textcolor{keywordflow}{while} ( nfields*fieldname\_size % 8 != 0 )
02560                 fieldname\_size++;
02561             uncomp\_buf[0] = (fieldname\_data\_size << 16) | fieldname\_type;
02562             uncomp\_buf[1] = fieldname\_size;
02563             uncomp\_buf[2] = array\_name\_type;
02564             uncomp\_buf[3] = nfields*fieldname\_size;
02565 
02566             padzero = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}*)calloc(fieldname\_size,1);
02567             z->next\_in  = ZLIB\_BYTE\_PTR(uncomp\_buf);
02568             z->avail\_in = 16;
02569             \textcolor{keywordflow}{do} \{
02570                 z->next\_out  = ZLIB\_BYTE\_PTR(comp\_buf);
02571                 z->avail\_out = buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf);
02572                 deflate(z,Z\_NO\_FLUSH);
02573                 byteswritten += fwrite(comp\_buf,1,
02574                     buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf)-z->avail\_out,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02575             \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
02576             \textcolor{keywordflow}{for} ( i = 0; i < nfields; i++ ) \{
02577                 \textcolor{keywordtype}{size\_t} len = strlen(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i]);
02578                 memset(padzero,\textcolor{charliteral}{'\(\backslash\)0'},fieldname\_size);
02579                 memcpy(padzero,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i],len);
02580                 z->next\_in  = ZLIB\_BYTE\_PTR(padzero);
02581                 z->avail\_in = fieldname\_size;
02582                 \textcolor{keywordflow}{do} \{
02583                     z->next\_out  = ZLIB\_BYTE\_PTR(comp\_buf);
02584                     z->avail\_out = buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf);
02585                     deflate(z,Z\_NO\_FLUSH);
02586                     byteswritten += fwrite(comp\_buf,1,
02587                         buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf)-z->avail\_out,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02588                 \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
02589             \}
02590             free(padzero);
02591             \textcolor{keywordflow}{for} ( i = 0; i < nmemb*nfields; i++ )
02592                 byteswritten +=
02593                     WriteCompressedStructField(mat,fields[i],z);
02594             \textcolor{keywordflow}{break};
02595         \}
02596         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a0d5655b7e6178a2242cb3bb56ff4c8d2}{MAT\_C\_SPARSE}:
02597         \{
02598             \hyperlink{group___m_a_t_structmat__sparse__t}{mat\_sparse\_t} *sparse = (\hyperlink{group___m_a_t_structmat__sparse__t}{mat\_sparse\_t}*)matvar->
      \hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
02599 
02600             byteswritten += WriteCompressedData(mat,z,sparse->\hyperlink{group___m_a_t_a8d4c863d704edddec5cbfa15b2d719c8}{ir},
02601                 sparse->\hyperlink{group___m_a_t_aa64636ad57cf87f7a28ff5018437a850}{nir},\hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32});
02602             byteswritten += WriteCompressedData(mat,z,sparse->\hyperlink{group___m_a_t_ad1e74cdc4f7eff1e47a670297c01da4b}{jc},
02603                 sparse->\hyperlink{group___m_a_t_a482d8e4b40aa975f0c1daf146ebe08a4}{njc},\hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32});
02604             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
02605                 \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t} *complex\_data = (
      \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t}*)sparse->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data};
02606                 byteswritten += WriteCompressedData(mat,z,
02607                     complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},sparse->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata},matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
02608                 byteswritten += WriteCompressedData(mat,z,
02609                     complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},sparse->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata},matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
02610             \} \textcolor{keywordflow}{else} \{
02611                 byteswritten += WriteCompressedData(mat,z,
02612                     sparse->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},sparse->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata},matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
02613             \}
02614             \textcolor{keywordflow}{break};
02615         \}
02616         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40aaa9bf08312779cd1ab8e504a162ddcea}{MAT\_C\_FUNCTION}:
02617         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40afe45104b68b044c83a2f99e349fa1ea6}{MAT\_C\_OBJECT}:
02618         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5c76eef0ca0373d25abe49053be6fa9a}{MAT\_C\_EMPTY}:
02619         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40ad83c684d250e463c1a3779647695c0c9}{MAT\_C\_OPAQUE}:
02620             \textcolor{keywordflow}{break};
02621     \}
02622 
02623     \textcolor{keywordflow}{return} byteswritten;
02624 \}
02625 
02633 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
02634 WriteCompressedCellArrayField(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,z\_streamp z)
02635 \{
02636     mat\_uint32\_t comp\_buf[512];
02637     mat\_uint32\_t uncomp\_buf[512] = \{0,\};
02638     \textcolor{keywordtype}{int} buf\_size = 512;
02639     \textcolor{keywordtype}{size\_t} byteswritten = 0;
02640 
02641     \textcolor{keywordflow}{if} ( NULL == matvar || NULL == mat || NULL == z)
02642         \textcolor{keywordflow}{return} 0;
02643 
02644     uncomp\_buf[0] = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a32985fee89a4df8db4b3f5d3a48823d3}{MAT\_T\_MATRIX};
02645     \textcolor{keywordflow}{if} ( \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5c76eef0ca0373d25abe49053be6fa9a}{MAT\_C\_EMPTY} != matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} ) \{
02646         uncomp\_buf[1] = (int)GetCellArrayFieldBufSize(matvar);
02647     \} \textcolor{keywordflow}{else} \{
02648         uncomp\_buf[1] = 0;
02649     \}
02650     z->next\_in  = ZLIB\_BYTE\_PTR(uncomp\_buf);
02651     z->avail\_in = 8;
02652     \textcolor{keywordflow}{do} \{
02653         z->next\_out  = ZLIB\_BYTE\_PTR(comp\_buf);
02654         z->avail\_out = buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf);
02655         deflate(z,Z\_NO\_FLUSH);
02656         byteswritten += fwrite(comp\_buf,1,buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf)-z->avail\_out,
02657             (FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02658     \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
02659 
02660     byteswritten += WriteCompressedTypeArrayFlags(mat,matvar,z);
02661     \textcolor{keywordflow}{return} byteswritten;
02662 \}
02663 \textcolor{preprocessor}{#endif}
02664 
02672 \textcolor{keyword}{static} \textcolor{keywordtype}{int}
02673 WriteStructField(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar)
02674 \{
02675     mat\_uint32\_t array\_flags = 0x0;
02676     mat\_int32\_t  array\_name\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8};
02677     \textcolor{keywordtype}{int}      array\_flags\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32}, dims\_array\_type = 
      \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32};
02678     \textcolor{keywordtype}{int}      array\_flags\_size = 8, pad4 = 0, matrix\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a32985fee89a4df8db4b3f5d3a48823d3}{MAT\_T\_MATRIX};
02679     \textcolor{keywordtype}{int}      nBytes, i, nmemb = 1, nzmax = 0;
02680     \textcolor{keywordtype}{long}     start = 0, end = 0;
02681 
02682     \textcolor{keywordflow}{if} ( mat == NULL )
02683         \textcolor{keywordflow}{return} 1;
02684 
02685     \textcolor{keywordflow}{if} ( NULL == matvar ) \{
02686         \textcolor{keywordtype}{size\_t} dims[2] = \{0,0\};
02687         Mat\_WriteEmptyVariable5(mat, NULL, 2, dims);
02688         \textcolor{keywordflow}{return} 0;
02689     \}
02690 
02691     fwrite(&matrix\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02692     fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02693     \textcolor{keywordflow}{if} ( \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5c76eef0ca0373d25abe49053be6fa9a}{MAT\_C\_EMPTY} == matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} ) \{
02694         \textcolor{comment}{/* exit early if this is an empty data */}
02695         \textcolor{keywordflow}{return} 0;
02696     \}
02697     start = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02698 
02699     \textcolor{comment}{/* Array Flags */}
02700     array\_flags = matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} & \hyperlink{mat5_8c_a24b94e17e9c34b9c795798099c710751}{CLASS\_TYPE\_MASK};
02701     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} )
02702         array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbbacd7b091a11184aad7fc6078c04470780}{MAT\_F\_COMPLEX};
02703     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_af26c71c4c0ddb14931d15910dddac1bc}{isGlobal} )
02704         array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba49084e0c796aa7963e53f7539525d40d}{MAT\_F\_GLOBAL};
02705     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a866c1539e68073a837833d74cd4a65be}{isLogical} )
02706         array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba57eb5c6e200bcbc0f1b7982f29a169c2}{MAT\_F\_LOGICAL};
02707     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a0d5655b7e6178a2242cb3bb56ff4c8d2}{MAT\_C\_SPARSE} )
02708         nzmax = ((\hyperlink{group___m_a_t_structmat__sparse__t}{mat\_sparse\_t} *)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data})->nzmax;
02709 
02710     \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
02711         array\_flags = \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}((mat\_int32\_t*)&array\_flags);
02712     fwrite(&array\_flags\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02713     fwrite(&array\_flags\_size,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02714     fwrite(&array\_flags,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02715     fwrite(&nzmax,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02716     \textcolor{comment}{/* Rank and Dimension */}
02717     nBytes = matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} * 4;
02718     fwrite(&dims\_array\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02719     fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02720     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ ) \{
02721         mat\_int32\_t dim;
02722         dim = matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
02723         nmemb *= dim;
02724         fwrite(&dim,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02725     \}
02726     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} % 2 != 0 )
02727         fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02728 
02729     \textcolor{comment}{/* Name of variable */}
02730     fwrite(&array\_name\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02731     fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02732 
02733     WriteType(mat,matvar);
02734     end = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02735     \textcolor{keywordflow}{if} ( start != -1L && end != -1L ) \{
02736         nBytes = (int)(end-start);
02737         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},(long)-(nBytes+4),SEEK\_CUR);
02738         fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02739         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},end,SEEK\_SET);
02740     \} \textcolor{keywordflow}{else} \{
02741         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
02742     \}
02743 
02744     \textcolor{keywordflow}{return} 0;
02745 \}
02746 
02747 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
02748 
02756 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
02757 WriteCompressedStructField(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,z\_streamp z)
02758 \{
02759     mat\_uint32\_t comp\_buf[512];
02760     mat\_uint32\_t uncomp\_buf[512] = \{0,\};
02761     \textcolor{keywordtype}{int} buf\_size = 512;
02762     \textcolor{keywordtype}{size\_t} byteswritten = 0;
02763 
02764     \textcolor{keywordflow}{if} ( NULL == mat || NULL == z)
02765         \textcolor{keywordflow}{return} 0;
02766 
02767     \textcolor{keywordflow}{if} ( NULL == matvar ) \{
02768         \textcolor{keywordtype}{size\_t} dims[2] = \{0,0\};
02769         byteswritten = Mat\_WriteCompressedEmptyVariable5(mat, NULL, 2, dims, z);
02770         \textcolor{keywordflow}{return} byteswritten;
02771     \}
02772 
02773     uncomp\_buf[0] = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a32985fee89a4df8db4b3f5d3a48823d3}{MAT\_T\_MATRIX};
02774     \textcolor{keywordflow}{if} ( \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5c76eef0ca0373d25abe49053be6fa9a}{MAT\_C\_EMPTY} != matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} ) \{
02775         uncomp\_buf[1] = (int)GetStructFieldBufSize(matvar);
02776     \} \textcolor{keywordflow}{else} \{
02777         uncomp\_buf[1] = 0;
02778     \}
02779     z->next\_in  = ZLIB\_BYTE\_PTR(uncomp\_buf);
02780     z->avail\_in = 8;
02781     \textcolor{keywordflow}{do} \{
02782         z->next\_out  = ZLIB\_BYTE\_PTR(comp\_buf);
02783         z->avail\_out = buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf);
02784         deflate(z,Z\_NO\_FLUSH);
02785         byteswritten += fwrite(comp\_buf,1,buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf)-z->avail\_out,
02786             (FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02787     \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
02788 
02789     byteswritten += WriteCompressedTypeArrayFlags(mat,matvar,z);
02790     \textcolor{keywordflow}{return} byteswritten;
02791 \}
02792 \textcolor{preprocessor}{#endif}
02793 
02794 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
02795 Mat\_WriteEmptyVariable5(\hyperlink{struct__mat__t}{mat\_t} *mat,\textcolor{keyword}{const} \textcolor{keywordtype}{char} *name,\textcolor{keywordtype}{int} rank,\textcolor{keywordtype}{size\_t} *dims)
02796 \{
02797     mat\_uint32\_t array\_flags = 0x0;
02798     mat\_int32\_t  array\_name\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8}, matrix\_type = 
      \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a32985fee89a4df8db4b3f5d3a48823d3}{MAT\_T\_MATRIX};
02799     \textcolor{keywordtype}{int}          array\_flags\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32}, dims\_array\_type = 
      \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32};
02800     \textcolor{keywordtype}{int}          array\_flags\_size = 8, pad4 = 0, nBytes, i, nmemb = 1;
02801     mat\_int8\_t   pad1 = 0;
02802     \textcolor{keywordtype}{size\_t}       byteswritten = 0;
02803     \textcolor{keywordtype}{long}         start = 0, end = 0;
02804 
02805     fwrite(&matrix\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02806     fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02807     start = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02808 
02809     \textcolor{comment}{/* Array Flags */}
02810     array\_flags = \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5d70e0862e5bdb7bd86bf7ba5948f307}{MAT\_C\_DOUBLE};
02811 
02812     \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
02813         array\_flags = \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}((mat\_int32\_t*)&array\_flags);
02814     byteswritten += fwrite(&array\_flags\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02815     byteswritten += fwrite(&array\_flags\_size,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02816     byteswritten += fwrite(&array\_flags,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02817     byteswritten += fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02818     \textcolor{comment}{/* Rank and Dimension */}
02819     nBytes = rank * 4;
02820     byteswritten += fwrite(&dims\_array\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02821     byteswritten += fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02822     \textcolor{keywordflow}{for} ( i = 0; i < rank; i++ ) \{
02823         mat\_int32\_t dim;
02824         dim = dims[i];
02825         nmemb *= dim;
02826         byteswritten += fwrite(&dim,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02827     \}
02828     \textcolor{keywordflow}{if} ( rank % 2 != 0 )
02829         byteswritten += fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02830 
02831     \textcolor{keywordflow}{if} ( NULL == name ) \{
02832         \textcolor{comment}{/* Name of variable */}
02833         byteswritten += fwrite(&array\_name\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02834         byteswritten += fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02835     \} \textcolor{keywordflow}{else} \{
02836         mat\_int32\_t  array\_name\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8};
02837         mat\_int32\_t  array\_name\_len   = strlen(name);
02838         \textcolor{comment}{/* Name of variable */}
02839         \textcolor{keywordflow}{if} ( array\_name\_len <= 4 ) \{
02840             mat\_int8\_t  pad1 = 0;
02841             array\_name\_type = (array\_name\_len << 16) | array\_name\_type;
02842             byteswritten += fwrite(&array\_name\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02843             byteswritten += fwrite(name,1,array\_name\_len,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02844             \textcolor{keywordflow}{for} ( i = array\_name\_len; i < 4; i++ )
02845                 byteswritten += fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02846         \} \textcolor{keywordflow}{else} \{
02847             byteswritten += fwrite(&array\_name\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02848             byteswritten += fwrite(&array\_name\_len,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02849             byteswritten += fwrite(name,1,array\_name\_len,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02850             \textcolor{keywordflow}{if} ( array\_name\_len % 8 )
02851                 \textcolor{keywordflow}{for} ( i = array\_name\_len % 8; i < 8; i++ )
02852                     byteswritten += fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02853         \}
02854     \}
02855 
02856     nBytes = \hyperlink{mat5_8c_a1bec2ccf2a3b48706edd32e63744d364}{WriteData}(mat,NULL,0,\hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE});
02857     byteswritten += nBytes;
02858     \textcolor{keywordflow}{if} ( nBytes % 8 )
02859         \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
02860             byteswritten += fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02861 
02862     end = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02863     \textcolor{keywordflow}{if} ( start != -1L && end != -1L ) \{
02864         nBytes = (int)(end-start);
02865         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},(long)-(nBytes+4),SEEK\_CUR);
02866         fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02867         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},end,SEEK\_SET);
02868     \} \textcolor{keywordflow}{else} \{
02869         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
02870     \}
02871 
02872     \textcolor{keywordflow}{return} byteswritten;
02873 \}
02874 
02875 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
02876 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t}
02877 Mat\_WriteCompressedEmptyVariable5(\hyperlink{struct__mat__t}{mat\_t} *mat,\textcolor{keyword}{const} \textcolor{keywordtype}{char} *name,\textcolor{keywordtype}{int} rank,
02878                                   \textcolor{keywordtype}{size\_t} *dims,z\_streamp z)
02879 \{
02880     mat\_uint32\_t array\_flags = 0x0;
02881     \textcolor{keywordtype}{int} array\_flags\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32}, dims\_array\_type = 
      \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32};
02882     \textcolor{keywordtype}{int} array\_flags\_size = 8;
02883     \textcolor{keywordtype}{int} nBytes, i, nmemb = 1;
02884 
02885     mat\_uint32\_t comp\_buf[512];
02886     mat\_uint32\_t uncomp\_buf[512] = \{0,\};
02887     \textcolor{keywordtype}{int} buf\_size = 512;
02888     \textcolor{keywordtype}{size\_t} byteswritten = 0, buf\_size\_bytes;
02889 
02890     \textcolor{keywordflow}{if} ( NULL == mat || NULL == z)
02891         \textcolor{keywordflow}{return} 1;
02892 
02893     buf\_size\_bytes = buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf);
02894 
02895     \textcolor{comment}{/* Array Flags */}
02896     array\_flags = \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5d70e0862e5bdb7bd86bf7ba5948f307}{MAT\_C\_DOUBLE};
02897 
02898     uncomp\_buf[0] = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a32985fee89a4df8db4b3f5d3a48823d3}{MAT\_T\_MATRIX};
02899     uncomp\_buf[1] = (int)GetEmptyMatrixMaxBufSize(name,rank);
02900     z->next\_in  = ZLIB\_BYTE\_PTR(uncomp\_buf);
02901     z->avail\_in = 8;
02902     \textcolor{keywordflow}{do} \{
02903         z->next\_out  = ZLIB\_BYTE\_PTR(comp\_buf);
02904         z->avail\_out = buf\_size\_bytes;
02905         deflate(z,Z\_NO\_FLUSH);
02906         byteswritten += fwrite(comp\_buf,1,buf\_size\_bytes-z->avail\_out,(FILE*)mat->
      \hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02907     \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
02908     uncomp\_buf[0] = array\_flags\_type;
02909     uncomp\_buf[1] = array\_flags\_size;
02910     uncomp\_buf[2] = array\_flags;
02911     uncomp\_buf[3] = 0;
02912     \textcolor{comment}{/* Rank and Dimension */}
02913     nBytes = rank * 4;
02914     uncomp\_buf[4] = dims\_array\_type;
02915     uncomp\_buf[5] = nBytes;
02916     \textcolor{keywordflow}{for} ( i = 0; i < rank; i++ ) \{
02917         mat\_int32\_t dim;
02918         dim = dims[i];
02919         nmemb *= dim;
02920         uncomp\_buf[6+i] = dim;
02921     \}
02922     \textcolor{keywordflow}{if} ( rank % 2 != 0 ) \{
02923         \textcolor{keywordtype}{int} pad4 = 0;
02924         uncomp\_buf[6+i] = pad4;
02925         i++;
02926     \}
02927 
02928     z->next\_in  = ZLIB\_BYTE\_PTR(uncomp\_buf);
02929     z->avail\_in = (6+i)*\textcolor{keyword}{sizeof}(*uncomp\_buf);
02930     \textcolor{keywordflow}{do} \{
02931         z->next\_out  = ZLIB\_BYTE\_PTR(comp\_buf);
02932         z->avail\_out = buf\_size\_bytes;
02933         deflate(z,Z\_NO\_FLUSH);
02934         byteswritten += fwrite(comp\_buf,1,buf\_size\_bytes-z->avail\_out,(FILE*)mat->
      \hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02935     \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
02936     \textcolor{comment}{/* Name of variable */}
02937     \textcolor{keywordflow}{if} ( NULL == name ) \{
02938         mat\_int16\_t array\_name\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8};
02939         uncomp\_buf[0] = array\_name\_type;
02940         uncomp\_buf[1] = 0;
02941         z->next\_in  = ZLIB\_BYTE\_PTR(uncomp\_buf);
02942         z->avail\_in = 8;
02943         \textcolor{keywordflow}{do} \{
02944             z->next\_out  = ZLIB\_BYTE\_PTR(comp\_buf);
02945             z->avail\_out = buf\_size\_bytes;
02946             deflate(z,Z\_NO\_FLUSH);
02947             byteswritten += fwrite(comp\_buf,1,buf\_size\_bytes-z->avail\_out,(FILE*)mat->
      \hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02948         \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
02949     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( strlen(name) <= 4 ) \{
02950         mat\_int16\_t array\_name\_len = (mat\_int16\_t)strlen(name);
02951         mat\_int16\_t array\_name\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8};
02952 
02953         memset(uncomp\_buf,0,8);
02954         uncomp\_buf[0] = (array\_name\_len << 16) | array\_name\_type;
02955         memcpy(uncomp\_buf+1,name,array\_name\_len);
02956         \textcolor{keywordflow}{if} ( array\_name\_len % 4 )
02957             array\_name\_len += 4-(array\_name\_len % 4);
02958 
02959         z->next\_in  = ZLIB\_BYTE\_PTR(uncomp\_buf);
02960         z->avail\_in = 8;
02961         \textcolor{keywordflow}{do} \{
02962             z->next\_out  = ZLIB\_BYTE\_PTR(comp\_buf);
02963             z->avail\_out = buf\_size\_bytes;
02964             deflate(z,Z\_NO\_FLUSH);
02965             byteswritten += fwrite(comp\_buf,1,buf\_size\_bytes-z->avail\_out,
02966                 (FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02967         \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
02968     \} \textcolor{keywordflow}{else} \{
02969         mat\_int32\_t array\_name\_len = (mat\_int32\_t)strlen(name);
02970         mat\_int32\_t array\_name\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8};
02971 
02972         memset(uncomp\_buf,0,buf\_size*\textcolor{keyword}{sizeof}(*uncomp\_buf));
02973         uncomp\_buf[0] = array\_name\_type;
02974         uncomp\_buf[1] = array\_name\_len;
02975         memcpy(uncomp\_buf+2,name,array\_name\_len);
02976         \textcolor{keywordflow}{if} ( array\_name\_len % 8 )
02977             array\_name\_len += 8-(array\_name\_len % 8);
02978         z->next\_in  = ZLIB\_BYTE\_PTR(uncomp\_buf);
02979         z->avail\_in = 8+array\_name\_len;
02980         \textcolor{keywordflow}{do} \{
02981             z->next\_out  = ZLIB\_BYTE\_PTR(comp\_buf);
02982             z->avail\_out = buf\_size\_bytes;
02983             deflate(z,Z\_NO\_FLUSH);
02984             byteswritten += fwrite(comp\_buf,1,buf\_size\_bytes-z->avail\_out,
02985                 (FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
02986         \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
02987     \}
02988 
02989     byteswritten += WriteCompressedData(mat,z,NULL,0,\hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE});
02990     \textcolor{keywordflow}{return} byteswritten;
02991 \}
02992 \textcolor{preprocessor}{#endif}
02993 
03004 \textcolor{keywordtype}{void}
\Hypertarget{mat5_8c_source_l03005}\hyperlink{mat5_8c_ad4a2e875b830830f0ec3cd678c0c6230}{03005} \hyperlink{mat5_8c_ad4a2e875b830830f0ec3cd678c0c6230}{Mat\_VarReadNumeric5}(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,\textcolor{keywordtype}{void} *data,\textcolor{keywordtype}{size\_t} N)
03006 \{
03007     \textcolor{keywordtype}{int} nBytes = 0, data\_in\_tag = 0;
03008     \textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} packed\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a2a7318fe8bf9464935e7ed8902618293}{MAT\_T\_UNKNOWN};
03009     mat\_uint32\_t tag[2];
03010 
03011     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} ) \{
03012 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
03013         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 0;
03014         InflateDataType(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,tag);
03015         \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
03016             (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(tag);
03017 
03018         packed\_type = \hyperlink{mat5_8c_a82bacecc4afc633b61bc3dc8ef88d1ed}{TYPE\_FROM\_TAG}(tag[0]);
03019         \textcolor{keywordflow}{if} ( tag[0] & 0xffff0000 ) \{ \textcolor{comment}{/* Data is in the tag */}
03020             data\_in\_tag = 1;
03021             nBytes = (tag[0] & 0xffff0000) >> 16;
03022         \} \textcolor{keywordflow}{else} \{
03023             data\_in\_tag = 0;
03024             InflateDataType(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,tag+1);
03025             \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
03026                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(tag+1);
03027             nBytes = tag[1];
03028         \}
03029 \textcolor{preprocessor}{#endif}
03030     \} \textcolor{keywordflow}{else} \{
03031         \textcolor{keywordtype}{size\_t} bytesread = fread(tag,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
03032         \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
03033             (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(tag);
03034         packed\_type = \hyperlink{mat5_8c_a82bacecc4afc633b61bc3dc8ef88d1ed}{TYPE\_FROM\_TAG}(tag[0]);
03035         \textcolor{keywordflow}{if} ( tag[0] & 0xffff0000 ) \{ \textcolor{comment}{/* Data is in the tag */}
03036             data\_in\_tag = 1;
03037             nBytes = (tag[0] & 0xffff0000) >> 16;
03038         \} \textcolor{keywordflow}{else} \{
03039             data\_in\_tag = 0;
03040             bytesread += fread(tag+1,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
03041             \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
03042                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(tag+1);
03043             nBytes = tag[1];
03044         \}
03045     \}
03046     \textcolor{keywordflow}{if} ( nBytes == 0 ) \{
03047         matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} = 0;
03048         \textcolor{keywordflow}{return};
03049     \}
03050 
03051     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a2280b97631ff5dd24dec55261dc587b6}{MAT\_COMPRESSION\_NONE} ) \{
03052         \textcolor{keywordflow}{switch} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} ) \{
03053             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5d70e0862e5bdb7bd86bf7ba5948f307}{MAT\_C\_DOUBLE}:
03054                 nBytes = ReadDoubleData(mat,(\textcolor{keywordtype}{double}*)data,packed\_type,N);
03055                 \textcolor{keywordflow}{break};
03056             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2825631e26a961cbe0f79db50a39cea2}{MAT\_C\_SINGLE}:
03057                 nBytes = ReadSingleData(mat,(\textcolor{keywordtype}{float}*)data,packed\_type,N);
03058                 \textcolor{keywordflow}{break};
03059             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a1ea83bcde49b35477494412973f82409}{MAT\_C\_INT64}:
03060 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_INT64\_T}
03061                 nBytes = ReadInt64Data(mat,(mat\_int64\_t*)data,packed\_type,N);
03062 \textcolor{preprocessor}{#endif}
03063                 \textcolor{keywordflow}{break};
03064             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a86470e25c3763d9a24623f04326195dd}{MAT\_C\_UINT64}:
03065 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_UINT64\_T}
03066                 nBytes = ReadUInt64Data(mat,(mat\_uint64\_t*)data,packed\_type,N);
03067 \textcolor{preprocessor}{#endif}
03068                 \textcolor{keywordflow}{break};
03069             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40adb44fc39694e3152ae5e69470a2fefe8}{MAT\_C\_INT32}:
03070                 nBytes = ReadInt32Data(mat,(mat\_int32\_t*)data,packed\_type,N);
03071                 \textcolor{keywordflow}{break};
03072             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a9a17a7edd45b19ef68197db81b27e816}{MAT\_C\_UINT32}:
03073                 nBytes = ReadUInt32Data(mat,(mat\_uint32\_t*)data,packed\_type,N);
03074                 \textcolor{keywordflow}{break};
03075             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a40370e9de516c5036a67a5865c071006}{MAT\_C\_INT16}:
03076                 nBytes = ReadInt16Data(mat,(mat\_int16\_t*)data,packed\_type,N);
03077                 \textcolor{keywordflow}{break};
03078             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a8bede21dbf6c1edc0bbccc1481bccae7}{MAT\_C\_UINT16}:
03079                 nBytes = ReadUInt16Data(mat,(mat\_uint16\_t*)data,packed\_type,N);
03080                 \textcolor{keywordflow}{break};
03081             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a984ff310f9e906100fcff95f704f43c5}{MAT\_C\_INT8}:
03082                 nBytes = ReadInt8Data(mat,(mat\_int8\_t*)data,packed\_type,N);
03083                 \textcolor{keywordflow}{break};
03084             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a81270f8093cb4808e992c1d29d84d4e3}{MAT\_C\_UINT8}:
03085                 nBytes = ReadUInt8Data(mat,(mat\_uint8\_t*)data,packed\_type,N);
03086                 \textcolor{keywordflow}{break};
03087             \textcolor{keywordflow}{default}:
03088                 \textcolor{keywordflow}{break};
03089         \}
03090         \textcolor{comment}{/*}
03091 \textcolor{comment}{         * If the data was in the tag we started on a 4-byte}
03092 \textcolor{comment}{         * boundary so add 4 to make it an 8-byte}
03093 \textcolor{comment}{         */}
03094         \textcolor{keywordflow}{if} ( data\_in\_tag )
03095             nBytes+=4;
03096         \textcolor{keywordflow}{if} ( (nBytes % 8) != 0 )
03097             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},8-(nBytes % 8),SEEK\_CUR);
03098 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
03099     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a5181d2f71eab0f12f05ba65d4f13fb53}{MAT\_COMPRESSION\_ZLIB} ) \{
03100         \textcolor{keywordflow}{switch} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} ) \{
03101             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5d70e0862e5bdb7bd86bf7ba5948f307}{MAT\_C\_DOUBLE}:
03102                 nBytes = ReadCompressedDoubleData(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,(\textcolor{keywordtype}{double}*)data,
03103                                                   packed\_type,N);
03104                 \textcolor{keywordflow}{break};
03105             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2825631e26a961cbe0f79db50a39cea2}{MAT\_C\_SINGLE}:
03106                 nBytes = ReadCompressedSingleData(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,(\textcolor{keywordtype}{float}*)data,
03107                                                   packed\_type,N);
03108                 \textcolor{keywordflow}{break};
03109             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a1ea83bcde49b35477494412973f82409}{MAT\_C\_INT64}:
03110 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_INT64\_T}
03111                 nBytes = ReadCompressedInt64Data(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,(mat\_int64\_t*)data,
03112                                                  packed\_type,N);
03113 \textcolor{preprocessor}{#endif}
03114                 \textcolor{keywordflow}{break};
03115             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a86470e25c3763d9a24623f04326195dd}{MAT\_C\_UINT64}:
03116 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_UINT64\_T}
03117                 nBytes = ReadCompressedUInt64Data(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,(mat\_uint64\_t*)data,
03118                                                   packed\_type,N);
03119 \textcolor{preprocessor}{#endif}
03120                 \textcolor{keywordflow}{break};
03121             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40adb44fc39694e3152ae5e69470a2fefe8}{MAT\_C\_INT32}:
03122                 nBytes = ReadCompressedInt32Data(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,(mat\_int32\_t*)data,
03123                                                  packed\_type,N);
03124                 \textcolor{keywordflow}{break};
03125             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a9a17a7edd45b19ef68197db81b27e816}{MAT\_C\_UINT32}:
03126                 nBytes = ReadCompressedUInt32Data(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,(mat\_uint32\_t*)data,
03127                                                   packed\_type,N);
03128                 \textcolor{keywordflow}{break};
03129             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a40370e9de516c5036a67a5865c071006}{MAT\_C\_INT16}:
03130                 nBytes = ReadCompressedInt16Data(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,(mat\_int16\_t*)data,
03131                                                  packed\_type,N);
03132                 \textcolor{keywordflow}{break};
03133             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a8bede21dbf6c1edc0bbccc1481bccae7}{MAT\_C\_UINT16}:
03134                 nBytes = ReadCompressedUInt16Data(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,(mat\_uint16\_t*)data,
03135                                                   packed\_type,N);
03136                 \textcolor{keywordflow}{break};
03137             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a984ff310f9e906100fcff95f704f43c5}{MAT\_C\_INT8}:
03138                 nBytes = ReadCompressedInt8Data(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,(mat\_int8\_t*)data,
03139                                                 packed\_type,N);
03140                 \textcolor{keywordflow}{break};
03141             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a81270f8093cb4808e992c1d29d84d4e3}{MAT\_C\_UINT8}:
03142                 nBytes = ReadCompressedUInt8Data(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,(mat\_uint8\_t*)data,
03143                                                  packed\_type,N);
03144                 \textcolor{keywordflow}{break};
03145             \textcolor{keywordflow}{default}:
03146                 \textcolor{keywordflow}{break};
03147         \}
03148         \textcolor{comment}{/*}
03149 \textcolor{comment}{         * If the data was in the tag we started on a 4-byte}
03150 \textcolor{comment}{         * boundary so add 4 to make it an 8-byte}
03151 \textcolor{comment}{         */}
03152         \textcolor{keywordflow}{if} ( data\_in\_tag )
03153             nBytes+=4;
03154         \textcolor{keywordflow}{if} ( (nBytes % 8) != 0 )
03155             InflateSkip(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,8-(nBytes % 8));
03156 \textcolor{preprocessor}{#endif}
03157     \}
03158 \}
03159 
03168 \textcolor{keywordtype}{void}
\Hypertarget{mat5_8c_source_l03169}\hyperlink{mat5_8c_abd8669832a02e759fe190bf2724f60ae}{03169} \hyperlink{mat5_8c_abd8669832a02e759fe190bf2724f60ae}{Read5}(\hyperlink{struct__mat__t}{mat\_t} *mat, \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar)
03170 \{
03171     \textcolor{keywordtype}{int} nBytes = 0, len = 1, i, byteswap, data\_in\_tag = 0;
03172     \textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} packed\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a2a7318fe8bf9464935e7ed8902618293}{MAT\_T\_UNKNOWN};
03173     \textcolor{keywordtype}{long} fpos;
03174     mat\_uint32\_t tag[2];
03175     \textcolor{keywordtype}{size\_t} bytesread = 0;
03176 
03177     \textcolor{keywordflow}{if} ( matvar == NULL )
03178         \textcolor{keywordflow}{return};
03179     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} == 0 )        \textcolor{comment}{/* An empty data set */}
03180         \textcolor{keywordflow}{return};
03181 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
03182     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( NULL != matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->data ) \{
03183         \textcolor{comment}{/* Data already read in ReadNextStructField or ReadNextCell */}
03184         matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} = matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->data;
03185         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->data = NULL;
03186         \textcolor{keywordflow}{return};
03187     \}
03188 \textcolor{preprocessor}{#endif}
03189     fpos = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
03190     \textcolor{keywordflow}{if} ( fpos == -1L ) \{
03191         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
03192         \textcolor{keywordflow}{return};
03193     \}
03194     len = 1;
03195     byteswap = mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap};
03196     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
03197         len *= matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
03198     switch ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} ) \{
03199         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5c76eef0ca0373d25abe49053be6fa9a}{MAT\_C\_EMPTY}:
03200             matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} = 0;
03201             matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \textcolor{keyword}{sizeof}(double);
03202             matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE};
03203             matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} = \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5c76eef0ca0373d25abe49053be6fa9a}{MAT\_C\_EMPTY};
03204             matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} = 2;
03205             matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims} = (\textcolor{keywordtype}{size\_t}*)malloc(matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}*\textcolor{keyword}{sizeof}(*(matvar->
      \hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims})));
03206             matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0] = 0;
03207             matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[1] = 0;
03208             \textcolor{keywordflow}{break};
03209         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5d70e0862e5bdb7bd86bf7ba5948f307}{MAT\_C\_DOUBLE}:
03210             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
03211             matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \textcolor{keyword}{sizeof}(double);
03212             matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE};
03213             \textcolor{keywordflow}{break};
03214         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2825631e26a961cbe0f79db50a39cea2}{MAT\_C\_SINGLE}:
03215             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
03216             matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \textcolor{keyword}{sizeof}(float);
03217             matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a3a3657d40e9212c923d9b9d03531b64c}{MAT\_T\_SINGLE};
03218             \textcolor{keywordflow}{break};
03219         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a1ea83bcde49b35477494412973f82409}{MAT\_C\_INT64}:
03220 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_INT64\_T}
03221             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
03222             matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \textcolor{keyword}{sizeof}(mat\_int64\_t);
03223             matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9e825b5d18b8f946eaf2b4b57e51c145}{MAT\_T\_INT64};
03224 \textcolor{preprocessor}{#endif}
03225             \textcolor{keywordflow}{break};
03226         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a86470e25c3763d9a24623f04326195dd}{MAT\_C\_UINT64}:
03227 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_UINT64\_T}
03228             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
03229             matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \textcolor{keyword}{sizeof}(mat\_uint64\_t);
03230             matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a45547932c46be27118abe08302d7e29f}{MAT\_T\_UINT64};
03231 \textcolor{preprocessor}{#endif}
03232             \textcolor{keywordflow}{break};
03233         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40adb44fc39694e3152ae5e69470a2fefe8}{MAT\_C\_INT32}:
03234             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
03235             matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \textcolor{keyword}{sizeof}(mat\_int32\_t);
03236             matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32};
03237             \textcolor{keywordflow}{break};
03238         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a9a17a7edd45b19ef68197db81b27e816}{MAT\_C\_UINT32}:
03239             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
03240             matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \textcolor{keyword}{sizeof}(mat\_uint32\_t);
03241             matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32};
03242             \textcolor{keywordflow}{break};
03243         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a40370e9de516c5036a67a5865c071006}{MAT\_C\_INT16}:
03244             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
03245             matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \textcolor{keyword}{sizeof}(mat\_int16\_t);
03246             matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a8c5b2e381946e95ea8d81ac216743302}{MAT\_T\_INT16};
03247             \textcolor{keywordflow}{break};
03248         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a8bede21dbf6c1edc0bbccc1481bccae7}{MAT\_C\_UINT16}:
03249             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
03250             matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \textcolor{keyword}{sizeof}(mat\_uint16\_t);
03251             matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16};
03252             \textcolor{keywordflow}{break};
03253         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a984ff310f9e906100fcff95f704f43c5}{MAT\_C\_INT8}:
03254             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
03255             matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \textcolor{keyword}{sizeof}(mat\_int8\_t);
03256             matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8};
03257             \textcolor{keywordflow}{break};
03258         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a81270f8093cb4808e992c1d29d84d4e3}{MAT\_C\_UINT8}:
03259             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
03260             matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \textcolor{keyword}{sizeof}(mat\_uint8\_t);
03261             matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a01c1bd7db68f90552862eb5d311be408}{MAT\_T\_UINT8};
03262             \textcolor{keywordflow}{break};
03263         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40aacdec5834df0861130b393697646119c}{MAT\_C\_CHAR}:
03264             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} ) \{
03265 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
03266                 (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
03267 
03268                 matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 0;
03269                 InflateDataType(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,tag);
03270                 \textcolor{keywordflow}{if} ( byteswap )
03271                     (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(tag);
03272                 packed\_type = \hyperlink{mat5_8c_a82bacecc4afc633b61bc3dc8ef88d1ed}{TYPE\_FROM\_TAG}(tag[0]);
03273                 \textcolor{keywordflow}{if} ( tag[0] & 0xffff0000 ) \{ \textcolor{comment}{/* Data is in the tag */}
03274                     data\_in\_tag = 1;
03275                     nBytes = (tag[0] & 0xffff0000) >> 16;
03276                 \} \textcolor{keywordflow}{else} \{
03277                     data\_in\_tag = 0;
03278                     InflateDataType(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,tag+1);
03279                     \textcolor{keywordflow}{if} ( byteswap )
03280                         (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(tag+1);
03281                     nBytes = tag[1];
03282                 \}
03283 \textcolor{preprocessor}{#endif}
03284             \} \textcolor{keywordflow}{else} \{
03285                 (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
03286                 bytesread += fread(tag,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
03287                 \textcolor{keywordflow}{if} ( byteswap )
03288                     (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(tag);
03289                 packed\_type = \hyperlink{mat5_8c_a82bacecc4afc633b61bc3dc8ef88d1ed}{TYPE\_FROM\_TAG}(tag[0]);
03290                 \textcolor{keywordflow}{if} ( tag[0] & 0xffff0000 ) \{ \textcolor{comment}{/* Data is in the tag */}
03291                     data\_in\_tag = 1;
03292                     nBytes = (tag[0] & 0xffff0000) >> 16;
03293                 \} \textcolor{keywordflow}{else} \{
03294                     data\_in\_tag = 0;
03295                     bytesread += fread(tag+1,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
03296                     \textcolor{keywordflow}{if} ( byteswap )
03297                         (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(tag+1);
03298                     nBytes = tag[1];
03299                 \}
03300             \}
03301             \textcolor{comment}{/* FIXME: */}
03302             matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a01c1bd7db68f90552862eb5d311be408}{MAT\_T\_UINT8};
03303             \textcolor{keywordflow}{if} ( nBytes == 0 ) \{
03304                 matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} = 0;
03305                 matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data}   = calloc(1,1);
03306                 \textcolor{keywordflow}{break};
03307             \}
03308             matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \textcolor{keyword}{sizeof}(char);
03309             matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} = len*matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size};
03310             matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data}   = calloc(matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes}+1,1);
03311             \textcolor{keywordflow}{if} ( NULL == matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} ) \{
03312                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Failed to allocate %d bytes"},matvar->
      \hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes});
03313                 \textcolor{keywordflow}{break};
03314             \}
03315             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a2280b97631ff5dd24dec55261dc587b6}{MAT\_COMPRESSION\_NONE} ) \{
03316                 nBytes = ReadCharData(mat,(\textcolor{keywordtype}{char}*)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data},packed\_type,len);
03317                 \textcolor{comment}{/*}
03318 \textcolor{comment}{                 * If the data was in the tag we started on a 4-byte}
03319 \textcolor{comment}{                 * boundary so add 4 to make it an 8-byte}
03320 \textcolor{comment}{                 */}
03321                 \textcolor{keywordflow}{if} ( data\_in\_tag )
03322                     nBytes+=4;
03323                 \textcolor{keywordflow}{if} ( (nBytes % 8) != 0 )
03324                     (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},8-(nBytes % 8),SEEK\_CUR);
03325 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
03326             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a5181d2f71eab0f12f05ba65d4f13fb53}{MAT\_COMPRESSION\_ZLIB} ) \{
03327                 nBytes = ReadCompressedCharData(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03328                              (\textcolor{keywordtype}{char}*)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data},packed\_type,len);
03329                 \textcolor{comment}{/*}
03330 \textcolor{comment}{                 * If the data was in the tag we started on a 4-byte}
03331 \textcolor{comment}{                 * boundary so add 4 to make it an 8-byte}
03332 \textcolor{comment}{                 */}
03333                 \textcolor{keywordflow}{if} ( data\_in\_tag )
03334                     nBytes+=4;
03335                 \textcolor{keywordflow}{if} ( (nBytes % 8) != 0 )
03336                     InflateSkip(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,8-(nBytes % 8));
03337 \textcolor{preprocessor}{#endif}
03338             \}
03339             \textcolor{keywordflow}{break};
03340         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT}:
03341         \{
03342             \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **fields;
03343             \textcolor{keywordtype}{int} nfields = 0;
03344 
03345             matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a4f4d5a6e1d42c6aa81ffb810e5da5c85}{MAT\_T\_STRUCT};
03346             \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} || !matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} || NULL == matvar->
      \hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} )
03347                 \textcolor{keywordflow}{break};
03348             nfields = matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields};
03349             fields = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
03350             for ( i = 0; i < len*nfields; i++ ) \{
03351                 \textcolor{keywordflow}{if} ( NULL != fields[i] ) \{
03352                     \hyperlink{mat5_8c_abd8669832a02e759fe190bf2724f60ae}{Read5}(mat,fields[i]);
03353                 \}
03354             \}
03355             \textcolor{keywordflow}{break};
03356         \}
03357         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2f7abb47a1c51e248bd4e5e03cc81b08}{MAT\_C\_CELL}:
03358         \{
03359             \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **cells;
03360 
03361             \textcolor{keywordflow}{if} ( NULL == matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} ) \{
03362                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Data is NULL for Cell Array %s"},matvar->
      \hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
03363                 \textcolor{keywordflow}{break};
03364             \}
03365             cells = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
03366             for ( i = 0; i < len; i++ ) \{
03367                 \textcolor{keywordflow}{if} ( NULL != cells[i] ) \{
03368                     \hyperlink{mat5_8c_abd8669832a02e759fe190bf2724f60ae}{Read5}(mat, cells[i]);
03369                 \}
03370             \}
03371             \textcolor{comment}{/* FIXME: */}
03372             matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a07599cf2cca6d2b2d059378563318ba5}{MAT\_T\_CELL};
03373             \textcolor{keywordflow}{break};
03374         \}
03375         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a0d5655b7e6178a2242cb3bb56ff4c8d2}{MAT\_C\_SPARSE}:
03376         \{
03377             \textcolor{keywordtype}{int} N = 0;
03378             \hyperlink{group___m_a_t_structmat__sparse__t}{mat\_sparse\_t} *data;
03379 
03380             matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \textcolor{keyword}{sizeof}(\hyperlink{group___m_a_t_gad1332d0eb4faa5a99377919f84b77baf}{mat\_sparse\_t});
03381             matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data}      = malloc(matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size});
03382             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} == NULL ) \{
03383                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"ReadData: Allocation of data pointer failed"});
03384                 \textcolor{keywordflow}{break};
03385             \}
03386             data = (\hyperlink{group___m_a_t_structmat__sparse__t}{mat\_sparse\_t}*)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
03387             data->\hyperlink{group___m_a_t_ad79471861cb948e32671be6d4089173a}{nzmax}  = matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes};
03388             (\textcolor{keywordtype}{void})fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
03389             \textcolor{comment}{/*  Read ir    */}
03390             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} ) \{
03391 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
03392                 matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 0;
03393                 InflateDataType(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,tag);
03394                 \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
03395                     (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(tag);
03396 
03397                 packed\_type = \hyperlink{mat5_8c_a82bacecc4afc633b61bc3dc8ef88d1ed}{TYPE\_FROM\_TAG}(tag[0]);
03398                 \textcolor{keywordflow}{if} ( tag[0] & 0xffff0000 ) \{ \textcolor{comment}{/* Data is in the tag */}
03399                     data\_in\_tag = 1;
03400                     N = (tag[0] & 0xffff0000) >> 16;
03401                 \} \textcolor{keywordflow}{else} \{
03402                     data\_in\_tag = 0;
03403                     (void)ReadCompressedInt32Data(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03404                              (mat\_int32\_t*)&N,\hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32},1);
03405                 \}
03406 \textcolor{preprocessor}{#endif}
03407             \} \textcolor{keywordflow}{else} \{
03408                 bytesread += fread(tag,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
03409                 \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
03410                     (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(tag);
03411                 packed\_type = \hyperlink{mat5_8c_a82bacecc4afc633b61bc3dc8ef88d1ed}{TYPE\_FROM\_TAG}(tag[0]);
03412                 \textcolor{keywordflow}{if} ( tag[0] & 0xffff0000 ) \{ \textcolor{comment}{/* Data is in the tag */}
03413                     data\_in\_tag = 1;
03414                     N = (tag[0] & 0xffff0000) >> 16;
03415                 \} \textcolor{keywordflow}{else} \{
03416                     data\_in\_tag = 0;
03417                     bytesread += fread(&N,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
03418                     \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
03419                         \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(&N);
03420                 \}
03421             \}
03422             data->\hyperlink{group___m_a_t_aa64636ad57cf87f7a28ff5018437a850}{nir} = N / 4;
03423             data->\hyperlink{group___m_a_t_a8d4c863d704edddec5cbfa15b2d719c8}{ir} = (mat\_int32\_t*)malloc(data->\hyperlink{group___m_a_t_aa64636ad57cf87f7a28ff5018437a850}{nir}*\textcolor{keyword}{sizeof}(mat\_int32\_t));
03424             \textcolor{keywordflow}{if} ( data->\hyperlink{group___m_a_t_a8d4c863d704edddec5cbfa15b2d719c8}{ir} != NULL ) \{
03425                 \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a2280b97631ff5dd24dec55261dc587b6}{MAT\_COMPRESSION\_NONE} ) \{
03426                     nBytes = ReadInt32Data(mat,data->\hyperlink{group___m_a_t_a8d4c863d704edddec5cbfa15b2d719c8}{ir},packed\_type,data->\hyperlink{group___m_a_t_aa64636ad57cf87f7a28ff5018437a850}{nir});
03427                     \textcolor{comment}{/*}
03428 \textcolor{comment}{                     * If the data was in the tag we started on a 4-byte}
03429 \textcolor{comment}{                     * boundary so add 4 to make it an 8-byte}
03430 \textcolor{comment}{                     */}
03431                     \textcolor{keywordflow}{if} ( data\_in\_tag )
03432                         nBytes+=4;
03433                     \textcolor{keywordflow}{if} ( (nBytes % 8) != 0 )
03434                         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},8-(nBytes % 8),SEEK\_CUR);
03435 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
03436                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == 
      \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a5181d2f71eab0f12f05ba65d4f13fb53}{MAT\_COMPRESSION\_ZLIB} ) \{
03437                     nBytes = ReadCompressedInt32Data(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03438                                  data->\hyperlink{group___m_a_t_a8d4c863d704edddec5cbfa15b2d719c8}{ir},packed\_type,data->\hyperlink{group___m_a_t_aa64636ad57cf87f7a28ff5018437a850}{nir});
03439                     \textcolor{comment}{/*}
03440 \textcolor{comment}{                     * If the data was in the tag we started on a 4-byte}
03441 \textcolor{comment}{                     * boundary so add 4 to make it an 8-byte}
03442 \textcolor{comment}{                     */}
03443                     \textcolor{keywordflow}{if} ( data\_in\_tag )
03444                         nBytes+=4;
03445                     \textcolor{keywordflow}{if} ( (nBytes % 8) != 0 )
03446                         InflateSkip(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,8-(nBytes % 8));
03447 \textcolor{preprocessor}{#endif}
03448                 \}
03449             \} \textcolor{keywordflow}{else} \{
03450                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"ReadData: Allocation of ir pointer failed"});
03451                 \textcolor{keywordflow}{break};
03452             \}
03453             \textcolor{comment}{/*  Read jc    */}
03454             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} ) \{
03455 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
03456                 matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 0;
03457                 InflateDataType(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,tag);
03458                 \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
03459                     \hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(tag);
03460                 packed\_type = \hyperlink{mat5_8c_a82bacecc4afc633b61bc3dc8ef88d1ed}{TYPE\_FROM\_TAG}(tag[0]);
03461                 \textcolor{keywordflow}{if} ( tag[0] & 0xffff0000 ) \{ \textcolor{comment}{/* Data is in the tag */}
03462                     data\_in\_tag = 1;
03463                     N = (tag[0] & 0xffff0000) >> 16;
03464                 \} \textcolor{keywordflow}{else} \{
03465                     data\_in\_tag = 0;
03466                     (void)ReadCompressedInt32Data(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03467                              (mat\_int32\_t*)&N,\hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32},1);
03468                 \}
03469 \textcolor{preprocessor}{#endif}
03470             \} \textcolor{keywordflow}{else} \{
03471                 bytesread += fread(tag,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
03472                 \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
03473                     \hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(tag);
03474                 packed\_type = \hyperlink{mat5_8c_a82bacecc4afc633b61bc3dc8ef88d1ed}{TYPE\_FROM\_TAG}(tag[0]);
03475                 \textcolor{keywordflow}{if} ( tag[0] & 0xffff0000 ) \{ \textcolor{comment}{/* Data is in the tag */}
03476                     data\_in\_tag = 1;
03477                     N = (tag[0] & 0xffff0000) >> 16;
03478                 \} \textcolor{keywordflow}{else} \{
03479                     data\_in\_tag = 0;
03480                     bytesread += fread(&N,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
03481                     \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
03482                         \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(&N);
03483                 \}
03484             \}
03485             data->\hyperlink{group___m_a_t_a482d8e4b40aa975f0c1daf146ebe08a4}{njc} = N / 4;
03486             data->\hyperlink{group___m_a_t_ad1e74cdc4f7eff1e47a670297c01da4b}{jc} = (mat\_int32\_t*)malloc(data->\hyperlink{group___m_a_t_a482d8e4b40aa975f0c1daf146ebe08a4}{njc}*\textcolor{keyword}{sizeof}(mat\_int32\_t));
03487             \textcolor{keywordflow}{if} ( data->\hyperlink{group___m_a_t_ad1e74cdc4f7eff1e47a670297c01da4b}{jc} != NULL ) \{
03488                 \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a2280b97631ff5dd24dec55261dc587b6}{MAT\_COMPRESSION\_NONE} ) \{
03489                     nBytes = ReadInt32Data(mat,data->\hyperlink{group___m_a_t_ad1e74cdc4f7eff1e47a670297c01da4b}{jc},packed\_type,data->\hyperlink{group___m_a_t_a482d8e4b40aa975f0c1daf146ebe08a4}{njc});
03490                     \textcolor{comment}{/*}
03491 \textcolor{comment}{                     * If the data was in the tag we started on a 4-byte}
03492 \textcolor{comment}{                     * boundary so add 4 to make it an 8-byte}
03493 \textcolor{comment}{                     */}
03494                     \textcolor{keywordflow}{if} ( data\_in\_tag )
03495                         nBytes+=4;
03496                     \textcolor{keywordflow}{if} ( (nBytes % 8) != 0 )
03497                         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},8-(nBytes % 8),SEEK\_CUR);
03498 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
03499                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == 
      \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a5181d2f71eab0f12f05ba65d4f13fb53}{MAT\_COMPRESSION\_ZLIB} ) \{
03500                     nBytes = ReadCompressedInt32Data(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03501                                  data->\hyperlink{group___m_a_t_ad1e74cdc4f7eff1e47a670297c01da4b}{jc},packed\_type,data->\hyperlink{group___m_a_t_a482d8e4b40aa975f0c1daf146ebe08a4}{njc});
03502                     \textcolor{comment}{/*}
03503 \textcolor{comment}{                     * If the data was in the tag we started on a 4-byte}
03504 \textcolor{comment}{                     * boundary so add 4 to make it an 8-byte}
03505 \textcolor{comment}{                     */}
03506                     \textcolor{keywordflow}{if} ( data\_in\_tag )
03507                         nBytes+=4;
03508                     \textcolor{keywordflow}{if} ( (nBytes % 8) != 0 )
03509                         InflateSkip(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,8-(nBytes % 8));
03510 \textcolor{preprocessor}{#endif}
03511                 \}
03512             \} \textcolor{keywordflow}{else} \{
03513                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"ReadData: Allocation of jc pointer failed"});
03514                 \textcolor{keywordflow}{break};
03515             \}
03516             \textcolor{comment}{/*  Read data    */}
03517             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} ) \{
03518 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
03519                 matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 0;
03520                 InflateDataType(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,tag);
03521                 \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
03522                     \hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(tag);
03523                 packed\_type = \hyperlink{mat5_8c_a82bacecc4afc633b61bc3dc8ef88d1ed}{TYPE\_FROM\_TAG}(tag[0]);
03524                 \textcolor{keywordflow}{if} ( tag[0] & 0xffff0000 ) \{ \textcolor{comment}{/* Data is in the tag */}
03525                     data\_in\_tag = 1;
03526                     N = (tag[0] & 0xffff0000) >> 16;
03527                 \} \textcolor{keywordflow}{else} \{
03528                     data\_in\_tag = 0;
03529                     (void)ReadCompressedInt32Data(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03530                              (mat\_int32\_t*)&N,\hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32},1);
03531                 \}
03532 \textcolor{preprocessor}{#endif}
03533             \} \textcolor{keywordflow}{else} \{
03534                 bytesread += fread(tag,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
03535                 \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
03536                     \hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(tag);
03537                 packed\_type = \hyperlink{mat5_8c_a82bacecc4afc633b61bc3dc8ef88d1ed}{TYPE\_FROM\_TAG}(tag[0]);
03538                 \textcolor{keywordflow}{if} ( tag[0] & 0xffff0000 ) \{ \textcolor{comment}{/* Data is in the tag */}
03539                     data\_in\_tag = 1;
03540                     N = (tag[0] & 0xffff0000) >> 16;
03541                 \} \textcolor{keywordflow}{else} \{
03542                     data\_in\_tag = 0;
03543                     bytesread += fread(&N,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
03544                     \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
03545                         \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(&N);
03546                 \}
03547             \}
03548             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a866c1539e68073a837833d74cd4a65be}{isLogical} && packed\_type == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE} ) \{
03549                 \textcolor{comment}{/* For some reason, MAT says the data type is a double,}
03550 \textcolor{comment}{                 * but it appears to be written as 8-bit unsigned integer.}
03551 \textcolor{comment}{                 */}
03552                 packed\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a01c1bd7db68f90552862eb5d311be408}{MAT\_T\_UINT8};
03553             \}
03554 \textcolor{preprocessor}{#if defined(EXTENDED\_SPARSE)}
03555             matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = packed\_type;
03556 \textcolor{preprocessor}{#else}
03557             matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE};
03558 \textcolor{preprocessor}{#endif}
03559             \{
03560                 \textcolor{keywordtype}{size\_t} s\_type = \hyperlink{group__mat__util_gab6774aabdc124c540c1e7686d0804940}{Mat\_SizeOf}(packed\_type);
03561                 \textcolor{keywordflow}{if} ( s\_type == 0 )
03562                     \textcolor{keywordflow}{break};
03563                 data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata} = N / s\_type;
03564             \}
03565             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
03566                 \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t} *complex\_data =
03567                     ComplexMalloc(data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata}*\hyperlink{group__mat__util_gab6774aabdc124c540c1e7686d0804940}{Mat\_SizeOf}(matvar->
      \hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type}));
03568                 \textcolor{keywordflow}{if} ( NULL == complex\_data ) \{
03569                     \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Memory allocation failure"});
03570                     \textcolor{keywordflow}{break};
03571                 \}
03572                 \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a2280b97631ff5dd24dec55261dc587b6}{MAT\_COMPRESSION\_NONE} ) \{
03573 \textcolor{preprocessor}{#if defined(EXTENDED\_SPARSE)}
03574                     \textcolor{keywordflow}{switch} ( matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} ) \{
03575                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE}:
03576                             nBytes = ReadDoubleData(mat,(\textcolor{keywordtype}{double}*)complex\_data->
      \hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},
03577                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03578                             \textcolor{keywordflow}{break};
03579                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a3a3657d40e9212c923d9b9d03531b64c}{MAT\_T\_SINGLE}:
03580                             nBytes = ReadSingleData(mat,(\textcolor{keywordtype}{float}*)complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},
03581                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03582                             \textcolor{keywordflow}{break};
03583                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9e825b5d18b8f946eaf2b4b57e51c145}{MAT\_T\_INT64}:
03584 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_INT64\_T}
03585                             nBytes = ReadInt64Data(mat,(mat\_int64\_t*)complex\_data->
      \hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},
03586                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03587 \textcolor{preprocessor}{#endif}
03588                             \textcolor{keywordflow}{break};
03589                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a45547932c46be27118abe08302d7e29f}{MAT\_T\_UINT64}:
03590 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_UINT64\_T}
03591                             nBytes = ReadUInt64Data(mat,(mat\_uint64\_t*)complex\_data->
      \hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},
03592                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03593 \textcolor{preprocessor}{#endif}
03594                             \textcolor{keywordflow}{break};
03595                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32}:
03596                             nBytes = ReadInt32Data(mat,(mat\_int32\_t*)complex\_data->
      \hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},
03597                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03598                             \textcolor{keywordflow}{break};
03599                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32}:
03600                             nBytes = ReadUInt32Data(mat,(mat\_uint32\_t*)complex\_data->
      \hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},
03601                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03602                             \textcolor{keywordflow}{break};
03603                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a8c5b2e381946e95ea8d81ac216743302}{MAT\_T\_INT16}:
03604                             nBytes = ReadInt16Data(mat,(mat\_int16\_t*)complex\_data->
      \hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},
03605                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03606                             \textcolor{keywordflow}{break};
03607                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16}:
03608                             nBytes = ReadUInt16Data(mat,(mat\_uint16\_t*)complex\_data->
      \hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},
03609                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03610                             \textcolor{keywordflow}{break};
03611                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8}:
03612                             nBytes = ReadInt8Data(mat,(mat\_int8\_t*)complex\_data->
      \hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},
03613                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03614                             \textcolor{keywordflow}{break};
03615                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a01c1bd7db68f90552862eb5d311be408}{MAT\_T\_UINT8}:
03616                             nBytes = ReadUInt8Data(mat,(mat\_uint8\_t*)complex\_data->
      \hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},
03617                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03618                             \textcolor{keywordflow}{break};
03619                         \textcolor{keywordflow}{default}:
03620                             \textcolor{keywordflow}{break};
03621                     \}
03622 \textcolor{preprocessor}{#else}
03623                     nBytes = ReadDoubleData(mat,complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},
03624                                  packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03625 \textcolor{preprocessor}{#endif}
03626                     \textcolor{keywordflow}{if} ( data\_in\_tag )
03627                         nBytes+=4;
03628                     \textcolor{keywordflow}{if} ( (nBytes % 8) != 0 )
03629                         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},8-(nBytes % 8),SEEK\_CUR);
03630 
03631                     \textcolor{comment}{/* Complex Data Tag */}
03632                     bytesread += fread(tag,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
03633                     \textcolor{keywordflow}{if} ( byteswap )
03634                         (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(tag);
03635                     packed\_type = \hyperlink{mat5_8c_a82bacecc4afc633b61bc3dc8ef88d1ed}{TYPE\_FROM\_TAG}(tag[0]);
03636                     \textcolor{keywordflow}{if} ( tag[0] & 0xffff0000 ) \{ \textcolor{comment}{/* Data is in the tag */}
03637                         data\_in\_tag = 1;
03638                         nBytes = (tag[0] & 0xffff0000) >> 16;
03639                     \} \textcolor{keywordflow}{else} \{
03640                         data\_in\_tag = 0;
03641                         bytesread += fread(tag+1,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
03642                         \textcolor{keywordflow}{if} ( byteswap )
03643                             (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(tag+1);
03644                         nBytes = tag[1];
03645                     \}
03646 \textcolor{preprocessor}{#if defined(EXTENDED\_SPARSE)}
03647                     \textcolor{keywordflow}{switch} ( matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} ) \{
03648                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE}:
03649                             nBytes = ReadDoubleData(mat,(\textcolor{keywordtype}{double}*)complex\_data->
      \hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},
03650                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03651                             \textcolor{keywordflow}{break};
03652                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a3a3657d40e9212c923d9b9d03531b64c}{MAT\_T\_SINGLE}:
03653                             nBytes = ReadSingleData(mat,(\textcolor{keywordtype}{float}*)complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},
03654                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03655                             \textcolor{keywordflow}{break};
03656                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9e825b5d18b8f946eaf2b4b57e51c145}{MAT\_T\_INT64}:
03657 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_INT64\_T}
03658                             nBytes = ReadInt64Data(mat,(mat\_int64\_t*)complex\_data->
      \hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},
03659                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03660 \textcolor{preprocessor}{#endif}
03661                             \textcolor{keywordflow}{break};
03662                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a45547932c46be27118abe08302d7e29f}{MAT\_T\_UINT64}:
03663 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_UINT64\_T}
03664                             nBytes = ReadUInt64Data(mat,(mat\_uint64\_t*)complex\_data->
      \hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},
03665                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03666 \textcolor{preprocessor}{#endif}
03667                             \textcolor{keywordflow}{break};
03668                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32}:
03669                             nBytes = ReadInt32Data(mat,(mat\_int32\_t*)complex\_data->
      \hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},
03670                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03671                             \textcolor{keywordflow}{break};
03672                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32}:
03673                             nBytes = ReadUInt32Data(mat,(mat\_uint32\_t*)complex\_data->
      \hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},
03674                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03675                             \textcolor{keywordflow}{break};
03676                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a8c5b2e381946e95ea8d81ac216743302}{MAT\_T\_INT16}:
03677                             nBytes = ReadInt16Data(mat,(mat\_int16\_t*)complex\_data->
      \hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},
03678                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03679                             \textcolor{keywordflow}{break};
03680                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16}:
03681                             nBytes = ReadUInt16Data(mat,(mat\_uint16\_t*)complex\_data->
      \hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},
03682                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03683                             \textcolor{keywordflow}{break};
03684                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8}:
03685                             nBytes = ReadInt8Data(mat,(mat\_int8\_t*)complex\_data->
      \hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},
03686                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03687                             \textcolor{keywordflow}{break};
03688                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a01c1bd7db68f90552862eb5d311be408}{MAT\_T\_UINT8}:
03689                             nBytes = ReadUInt8Data(mat,(mat\_uint8\_t*)complex\_data->
      \hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},
03690                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03691                             \textcolor{keywordflow}{break};
03692                         \textcolor{keywordflow}{default}:
03693                             \textcolor{keywordflow}{break};
03694                     \}
03695 \textcolor{preprocessor}{#else }\textcolor{comment}{/* EXTENDED\_SPARSE */}\textcolor{preprocessor}{}
03696                     nBytes = ReadDoubleData(mat,complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},
03697                                  packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03698 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* EXTENDED\_SPARSE */}\textcolor{preprocessor}{}
03699                     \textcolor{keywordflow}{if} ( data\_in\_tag )
03700                         nBytes+=4;
03701                     \textcolor{keywordflow}{if} ( (nBytes % 8) != 0 )
03702                         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},8-(nBytes % 8),SEEK\_CUR);
03703 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
03704                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == 
      \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a5181d2f71eab0f12f05ba65d4f13fb53}{MAT\_COMPRESSION\_ZLIB} ) \{
03705 \textcolor{preprocessor}{#if defined(EXTENDED\_SPARSE)}
03706                     \textcolor{keywordflow}{switch} ( matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} ) \{
03707                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE}:
03708                             nBytes = ReadCompressedDoubleData(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03709                                  (\textcolor{keywordtype}{double}*)complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03710                             \textcolor{keywordflow}{break};
03711                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a3a3657d40e9212c923d9b9d03531b64c}{MAT\_T\_SINGLE}:
03712                             nBytes = ReadCompressedSingleData(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03713                                  (\textcolor{keywordtype}{float}*)complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03714                             \textcolor{keywordflow}{break};
03715                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9e825b5d18b8f946eaf2b4b57e51c145}{MAT\_T\_INT64}:
03716 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_INT64\_T}
03717                             nBytes = ReadCompressedInt64Data(mat,
03718                                 matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,(mat\_int64\_t*)complex\_data->
      \hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},
03719                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03720 \textcolor{preprocessor}{#endif}
03721                             \textcolor{keywordflow}{break};
03722                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a45547932c46be27118abe08302d7e29f}{MAT\_T\_UINT64}:
03723 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_UINT64\_T}
03724                             nBytes = ReadCompressedUInt64Data(mat,
03725                                 matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,(mat\_uint64\_t*)complex\_data->
      \hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},
03726                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03727 \textcolor{preprocessor}{#endif}
03728                             \textcolor{keywordflow}{break};
03729                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32}:
03730                             nBytes = ReadCompressedInt32Data(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03731                                  (mat\_int32\_t*)complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03732                             \textcolor{keywordflow}{break};
03733                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32}:
03734                             nBytes = ReadCompressedUInt32Data(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03735                                  (mat\_uint32\_t*)complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03736                             \textcolor{keywordflow}{break};
03737                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a8c5b2e381946e95ea8d81ac216743302}{MAT\_T\_INT16}:
03738                             nBytes = ReadCompressedInt16Data(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03739                                  (mat\_int16\_t*)complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03740                             \textcolor{keywordflow}{break};
03741                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16}:
03742                             nBytes = ReadCompressedUInt16Data(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03743                                  (mat\_uint16\_t*)complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03744                             \textcolor{keywordflow}{break};
03745                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8}:
03746                             nBytes = ReadCompressedInt8Data(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03747                                  (mat\_int8\_t*)complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03748                             \textcolor{keywordflow}{break};
03749                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a01c1bd7db68f90552862eb5d311be408}{MAT\_T\_UINT8}:
03750                             nBytes = ReadCompressedUInt8Data(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03751                                  (mat\_uint8\_t*)complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03752                             \textcolor{keywordflow}{break};
03753                         \textcolor{keywordflow}{default}:
03754                             \textcolor{keywordflow}{break};
03755                     \}
03756 \textcolor{preprocessor}{#else    }\textcolor{comment}{/* EXTENDED\_SPARSE */}\textcolor{preprocessor}{}
03757                     nBytes = ReadCompressedDoubleData(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03758                                  (\textcolor{keywordtype}{double}*)complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03759 \textcolor{preprocessor}{#endif    }\textcolor{comment}{/* EXTENDED\_SPARSE */}\textcolor{preprocessor}{}
03760                     \textcolor{keywordflow}{if} ( data\_in\_tag )
03761                         nBytes+=4;
03762                     \textcolor{keywordflow}{if} ( (nBytes % 8) != 0 )
03763                         InflateSkip(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,8-(nBytes % 8));
03764 
03765                     \textcolor{comment}{/* Complex Data Tag */}
03766                     InflateDataType(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,tag);
03767                     \textcolor{keywordflow}{if} ( byteswap )
03768                         (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(tag);
03769 
03770                     packed\_type = \hyperlink{mat5_8c_a82bacecc4afc633b61bc3dc8ef88d1ed}{TYPE\_FROM\_TAG}(tag[0]);
03771                     \textcolor{keywordflow}{if} ( tag[0] & 0xffff0000 ) \{ \textcolor{comment}{/* Data is in the tag */}
03772                         data\_in\_tag = 1;
03773                         nBytes = (tag[0] & 0xffff0000) >> 16;
03774                     \} \textcolor{keywordflow}{else} \{
03775                         data\_in\_tag = 0;
03776                         InflateDataType(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,tag+1);
03777                         \textcolor{keywordflow}{if} ( byteswap )
03778                             (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(tag+1);
03779                         nBytes = tag[1];
03780                     \}
03781 \textcolor{preprocessor}{#if defined(EXTENDED\_SPARSE)}
03782                     \textcolor{keywordflow}{switch} ( matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} ) \{
03783                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE}:
03784                             nBytes = ReadCompressedDoubleData(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03785                                  (\textcolor{keywordtype}{double}*)complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03786                             \textcolor{keywordflow}{break};
03787                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a3a3657d40e9212c923d9b9d03531b64c}{MAT\_T\_SINGLE}:
03788                             nBytes = ReadCompressedSingleData(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03789                                  (\textcolor{keywordtype}{float}*)complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03790                             \textcolor{keywordflow}{break};
03791                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9e825b5d18b8f946eaf2b4b57e51c145}{MAT\_T\_INT64}:
03792 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_INT64\_T}
03793                             nBytes = ReadCompressedInt64Data(mat,
03794                                 matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,(mat\_int64\_t*)complex\_data->
      \hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},
03795                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03796 \textcolor{preprocessor}{#endif}
03797                             \textcolor{keywordflow}{break};
03798                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a45547932c46be27118abe08302d7e29f}{MAT\_T\_UINT64}:
03799 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_UINT64\_T}
03800                             nBytes = ReadCompressedUInt64Data(mat,
03801                                 matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,(mat\_uint64\_t*)complex\_data->
      \hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},
03802                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03803 \textcolor{preprocessor}{#endif}
03804                             \textcolor{keywordflow}{break};
03805                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32}:
03806                             nBytes = ReadCompressedInt32Data(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03807                                  (mat\_int32\_t*)complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03808                             \textcolor{keywordflow}{break};
03809                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32}:
03810                             nBytes = ReadCompressedUInt32Data(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03811                                  (mat\_uint32\_t*)complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03812                             \textcolor{keywordflow}{break};
03813                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a8c5b2e381946e95ea8d81ac216743302}{MAT\_T\_INT16}:
03814                             nBytes = ReadCompressedInt16Data(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03815                                  (mat\_int16\_t*)complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03816                             \textcolor{keywordflow}{break};
03817                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16}:
03818                             nBytes = ReadCompressedUInt16Data(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03819                                  (mat\_uint16\_t*)complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03820                             \textcolor{keywordflow}{break};
03821                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8}:
03822                             nBytes = ReadCompressedInt8Data(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03823                                  (mat\_int8\_t*)complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03824                             \textcolor{keywordflow}{break};
03825                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a01c1bd7db68f90552862eb5d311be408}{MAT\_T\_UINT8}:
03826                             nBytes = ReadCompressedUInt8Data(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03827                                  (mat\_uint8\_t*)complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03828                             \textcolor{keywordflow}{break};
03829                         \textcolor{keywordflow}{default}:
03830                             \textcolor{keywordflow}{break};
03831                     \}
03832 \textcolor{preprocessor}{#else    }\textcolor{comment}{/* EXTENDED\_SPARSE */}\textcolor{preprocessor}{}
03833                     nBytes = ReadCompressedDoubleData(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03834                                  (\textcolor{keywordtype}{double}*)complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03835 \textcolor{preprocessor}{#endif    }\textcolor{comment}{/* EXTENDED\_SPARSE */}\textcolor{preprocessor}{}
03836                     \textcolor{keywordflow}{if} ( data\_in\_tag )
03837                         nBytes+=4;
03838                     \textcolor{keywordflow}{if} ( (nBytes % 8) != 0 )
03839                         InflateSkip(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,8-(nBytes % 8));
03840 \textcolor{preprocessor}{#endif    }\textcolor{comment}{/* HAVE\_ZLIB */}\textcolor{preprocessor}{}
03841                 \}
03842                 data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data} = complex\_data;
03843             \} \textcolor{keywordflow}{else} \{ \textcolor{comment}{/* isComplex */}
03844                 data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data} = malloc(data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata}*\hyperlink{group__mat__util_gab6774aabdc124c540c1e7686d0804940}{Mat\_SizeOf}(matvar->
      \hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type}));
03845                 \textcolor{keywordflow}{if} ( data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data} == NULL ) \{
03846                     \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Failed to allocate %d bytes"},
03847                                  data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata}*\hyperlink{group__mat__util_gab6774aabdc124c540c1e7686d0804940}{Mat\_SizeOf}(
      \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE}));
03848                     \textcolor{keywordflow}{break};
03849                 \}
03850                 \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a2280b97631ff5dd24dec55261dc587b6}{MAT\_COMPRESSION\_NONE} ) \{
03851 \textcolor{preprocessor}{#if defined(EXTENDED\_SPARSE)}
03852                     \textcolor{keywordflow}{switch} ( matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} ) \{
03853                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE}:
03854                             nBytes = ReadDoubleData(mat,(\textcolor{keywordtype}{double}*)data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},
03855                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03856                             \textcolor{keywordflow}{break};
03857                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a3a3657d40e9212c923d9b9d03531b64c}{MAT\_T\_SINGLE}:
03858                             nBytes = ReadSingleData(mat,(\textcolor{keywordtype}{float}*)data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},
03859                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03860                             \textcolor{keywordflow}{break};
03861                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9e825b5d18b8f946eaf2b4b57e51c145}{MAT\_T\_INT64}:
03862 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_INT64\_T}
03863                             nBytes = ReadInt64Data(mat,(mat\_int64\_t*)data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},
03864                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03865 \textcolor{preprocessor}{#endif}
03866                             \textcolor{keywordflow}{break};
03867                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a45547932c46be27118abe08302d7e29f}{MAT\_T\_UINT64}:
03868 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_UINT64\_T}
03869                             nBytes = ReadUInt64Data(mat,(mat\_uint64\_t*)data->
      \hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},
03870                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03871 \textcolor{preprocessor}{#endif}
03872                             \textcolor{keywordflow}{break};
03873                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32}:
03874                             nBytes = ReadInt32Data(mat,(mat\_int32\_t*)data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},
03875                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03876                             \textcolor{keywordflow}{break};
03877                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32}:
03878                             nBytes = ReadUInt32Data(mat,(mat\_uint32\_t*)data->
      \hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},
03879                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03880                             \textcolor{keywordflow}{break};
03881                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a8c5b2e381946e95ea8d81ac216743302}{MAT\_T\_INT16}:
03882                             nBytes = ReadInt16Data(mat,(mat\_int16\_t*)data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},
03883                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03884                             \textcolor{keywordflow}{break};
03885                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16}:
03886                             nBytes = ReadUInt16Data(mat,(mat\_uint16\_t*)data->
      \hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},
03887                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03888                             \textcolor{keywordflow}{break};
03889                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8}:
03890                             nBytes = ReadInt8Data(mat,(mat\_int8\_t*)data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},
03891                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03892                             \textcolor{keywordflow}{break};
03893                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a01c1bd7db68f90552862eb5d311be408}{MAT\_T\_UINT8}:
03894                             nBytes = ReadUInt8Data(mat,(mat\_uint8\_t*)data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},
03895                                 packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03896                             \textcolor{keywordflow}{break};
03897                         \textcolor{keywordflow}{default}:
03898                             \textcolor{keywordflow}{break};
03899                     \}
03900 \textcolor{preprocessor}{#else}
03901                     nBytes = ReadDoubleData(mat,(\textcolor{keywordtype}{double}*)data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},packed\_type,
03902                                  data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03903 \textcolor{preprocessor}{#endif}
03904                     \textcolor{keywordflow}{if} ( data\_in\_tag )
03905                         nBytes+=4;
03906                     \textcolor{keywordflow}{if} ( (nBytes % 8) != 0 )
03907                         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},8-(nBytes % 8),SEEK\_CUR);
03908 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
03909                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == 
      \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a5181d2f71eab0f12f05ba65d4f13fb53}{MAT\_COMPRESSION\_ZLIB} ) \{
03910 \textcolor{preprocessor}{#if defined(EXTENDED\_SPARSE)}
03911                     \textcolor{keywordflow}{switch} ( matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} ) \{
03912                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE}:
03913                             nBytes = ReadCompressedDoubleData(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03914                                  (\textcolor{keywordtype}{double}*)data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03915                             \textcolor{keywordflow}{break};
03916                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a3a3657d40e9212c923d9b9d03531b64c}{MAT\_T\_SINGLE}:
03917                             nBytes = ReadCompressedSingleData(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03918                                  (\textcolor{keywordtype}{float}*)data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03919                             \textcolor{keywordflow}{break};
03920                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9e825b5d18b8f946eaf2b4b57e51c145}{MAT\_T\_INT64}:
03921 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_INT64\_T}
03922                             nBytes = ReadCompressedInt64Data(mat,
03923                                 matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,(mat\_int64\_t*)data->
      \hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},packed\_type,
03924                                 data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03925 \textcolor{preprocessor}{#endif}
03926                             \textcolor{keywordflow}{break};
03927                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a45547932c46be27118abe08302d7e29f}{MAT\_T\_UINT64}:
03928 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_UINT64\_T}
03929                             nBytes = ReadCompressedUInt64Data(mat,
03930                                 matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,(mat\_uint64\_t*)data->
      \hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},packed\_type,
03931                                 data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03932 \textcolor{preprocessor}{#endif}
03933                             \textcolor{keywordflow}{break};
03934                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32}:
03935                             nBytes = ReadCompressedInt32Data(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03936                                  (mat\_int32\_t*)data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03937                             \textcolor{keywordflow}{break};
03938                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32}:
03939                             nBytes = ReadCompressedUInt32Data(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03940                                  (mat\_uint32\_t*)data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03941                             \textcolor{keywordflow}{break};
03942                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a8c5b2e381946e95ea8d81ac216743302}{MAT\_T\_INT16}:
03943                             nBytes = ReadCompressedInt16Data(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03944                                  (mat\_int16\_t*)data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03945                             \textcolor{keywordflow}{break};
03946                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16}:
03947                             nBytes = ReadCompressedUInt16Data(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03948                                  (mat\_uint16\_t*)data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03949                             \textcolor{keywordflow}{break};
03950                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8}:
03951                             nBytes = ReadCompressedInt8Data(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03952                                  (mat\_int8\_t*)data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03953                             \textcolor{keywordflow}{break};
03954                         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a01c1bd7db68f90552862eb5d311be408}{MAT\_T\_UINT8}:
03955                             nBytes = ReadCompressedUInt8Data(mat,matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03956                                  (mat\_uint8\_t*)data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},packed\_type,data->
      \hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03957                             \textcolor{keywordflow}{break};
03958                         \textcolor{keywordflow}{default}:
03959                             \textcolor{keywordflow}{break};
03960                     \}
03961 \textcolor{preprocessor}{#else   }\textcolor{comment}{/* EXTENDED\_SPARSE */}\textcolor{preprocessor}{}
03962                     nBytes = ReadCompressedDoubleData(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,
03963                                  (\textcolor{keywordtype}{double}*)data->\hyperlink{group___m_a_t_ae2c648cb9eac4ce47f26cddb44246152}{data},packed\_type,data->\hyperlink{group___m_a_t_a1beb8a8c58a808207cbea650563a9b63}{ndata});
03964 \textcolor{preprocessor}{#endif   }\textcolor{comment}{/* EXTENDED\_SPARSE */}\textcolor{preprocessor}{}
03965                     \textcolor{keywordflow}{if} ( data\_in\_tag )
03966                         nBytes+=4;
03967                     \textcolor{keywordflow}{if} ( (nBytes % 8) != 0 )
03968                         InflateSkip(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,8-(nBytes % 8));
03969 \textcolor{preprocessor}{#endif   }\textcolor{comment}{/* HAVE\_ZLIB */}\textcolor{preprocessor}{}
03970                 \}
03971             \}
03972             \textcolor{keywordflow}{break};
03973         \}
03974         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40aaa9bf08312779cd1ab8e504a162ddcea}{MAT\_C\_FUNCTION}:
03975         \{
03976             \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **functions;
03977             \textcolor{keywordtype}{int} nfunctions = 0;
03978 
03979             \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} || !matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} )
03980                 \textcolor{keywordflow}{break};
03981             nfunctions = matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} / matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size};
03982             functions = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
03983             if ( NULL != functions ) \{
03984                 \textcolor{keywordflow}{for} ( i = 0; i < nfunctions; i++ ) \{
03985                     \hyperlink{mat5_8c_abd8669832a02e759fe190bf2724f60ae}{Read5}(mat,functions[i]);
03986                 \}
03987             \}
03988             \textcolor{comment}{/* FIXME: */}
03989             matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453ae76686f267dd1641cd55dce306af6d10}{MAT\_T\_FUNCTION};
03990             \textcolor{keywordflow}{break};
03991         \}
03992         \textcolor{keywordflow}{default}:
03993             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Read5: %d is not a supported class"}, matvar->
      \hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type});
03994     \}
03995     \textcolor{keywordflow}{switch} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} ) \{
03996         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5d70e0862e5bdb7bd86bf7ba5948f307}{MAT\_C\_DOUBLE}:
03997         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2825631e26a961cbe0f79db50a39cea2}{MAT\_C\_SINGLE}:
03998 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_INT64\_T}
03999         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a1ea83bcde49b35477494412973f82409}{MAT\_C\_INT64}:
04000 \textcolor{preprocessor}{#endif}
04001 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_UINT64\_T}
04002         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a86470e25c3763d9a24623f04326195dd}{MAT\_C\_UINT64}:
04003 \textcolor{preprocessor}{#endif}
04004         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40adb44fc39694e3152ae5e69470a2fefe8}{MAT\_C\_INT32}:
04005         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a9a17a7edd45b19ef68197db81b27e816}{MAT\_C\_UINT32}:
04006         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a40370e9de516c5036a67a5865c071006}{MAT\_C\_INT16}:
04007         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a8bede21dbf6c1edc0bbccc1481bccae7}{MAT\_C\_UINT16}:
04008         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a984ff310f9e906100fcff95f704f43c5}{MAT\_C\_INT8}:
04009         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a81270f8093cb4808e992c1d29d84d4e3}{MAT\_C\_UINT8}:
04010             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
04011                 \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t} *complex\_data;
04012 
04013                 matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} = len*matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size};
04014                 complex\_data = ComplexMalloc(matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes});
04015                 \textcolor{keywordflow}{if} ( NULL == complex\_data ) \{
04016                     \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Memory allocation failure"});
04017                     \textcolor{keywordflow}{break};
04018                 \}
04019                 \hyperlink{mat5_8c_ad4a2e875b830830f0ec3cd678c0c6230}{Mat\_VarReadNumeric5}(mat,matvar,complex\_data->
      \hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},len);
04020                 \hyperlink{mat5_8c_ad4a2e875b830830f0ec3cd678c0c6230}{Mat\_VarReadNumeric5}(mat,matvar,complex\_data->
      \hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},len);
04021                 matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} = complex\_data;
04022             \} \textcolor{keywordflow}{else} \{
04023                 matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} = len*matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size};
04024                 matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data}   = malloc(matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes});
04025                 \textcolor{keywordflow}{if} ( NULL == matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} ) \{
04026                     \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Failed to allocate %d bytes"},matvar->
      \hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes});
04027                     \textcolor{keywordflow}{break};
04028                 \}
04029                 \hyperlink{mat5_8c_ad4a2e875b830830f0ec3cd678c0c6230}{Mat\_VarReadNumeric5}(mat,matvar,matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data},len);
04030             \}
04031         \textcolor{keywordflow}{default}:
04032             \textcolor{keywordflow}{break};
04033     \}
04034     (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},fpos,SEEK\_SET);
04035 
04036     \textcolor{keywordflow}{return};
04037 \}
04038 
04039 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
04040 \textcolor{preprocessor}{#define GET\_DATA\_SLABN\_RANK\_LOOP \(\backslash\)}
04041 \textcolor{preprocessor}{    do \{ \(\backslash\)}
04042 \textcolor{preprocessor}{        for ( j = 1; j < rank; j++ ) \{ \(\backslash\)}
04043 \textcolor{preprocessor}{            cnt[j]++; \(\backslash\)}
04044 \textcolor{preprocessor}{            if ( (cnt[j] % edge[j]) == 0 ) \{ \(\backslash\)}
04045 \textcolor{preprocessor}{                cnt[j] = 0; \(\backslash\)}
04046 \textcolor{preprocessor}{                if ( (I % dimp[j]) != 0 ) \{ \(\backslash\)}
04047 \textcolor{preprocessor}{                    ptr\_in += dimp[j]-(I % dimp[j])+dimp[j-1]*start[j]; \(\backslash\)}
04048 \textcolor{preprocessor}{                    I += dimp[j]-(I % dimp[j]) + dimp[j-1]*start[j]; \(\backslash\)}
04049 \textcolor{preprocessor}{                \} else if ( start[j] ) \{ \(\backslash\)}
04050 \textcolor{preprocessor}{                    ptr\_in += dimp[j-1]*start[j]; \(\backslash\)}
04051 \textcolor{preprocessor}{                    I += dimp[j-1]*start[j]; \(\backslash\)}
04052 \textcolor{preprocessor}{                \} \(\backslash\)}
04053 \textcolor{preprocessor}{            \} else \{ \(\backslash\)}
04054 \textcolor{preprocessor}{                I += inc[j]; \(\backslash\)}
04055 \textcolor{preprocessor}{                ptr\_in += inc[j]; \(\backslash\)}
04056 \textcolor{preprocessor}{                break; \(\backslash\)}
04057 \textcolor{preprocessor}{            \} \(\backslash\)}
04058 \textcolor{preprocessor}{        \} \(\backslash\)}
04059 \textcolor{preprocessor}{    \} while (0)}
04060 
04061 \textcolor{preprocessor}{#define GET\_DATA\_SLAB2(T) \(\backslash\)}
04062 \textcolor{preprocessor}{    do \{ \(\backslash\)}
04063 \textcolor{preprocessor}{        ptr\_in += start[1]*dims[0] + start[0]; \(\backslash\)}
04064 \textcolor{preprocessor}{        for ( i = 0; i < edge[1]; i++ ) \{ \(\backslash\)}
04065 \textcolor{preprocessor}{            for ( j = 0; j < edge[0]; j++ ) \{ \(\backslash\)}
04066 \textcolor{preprocessor}{                *ptr = (T)(*(ptr\_in+j*stride[0])); \(\backslash\)}
04067 \textcolor{preprocessor}{                ptr++; \(\backslash\)}
04068 \textcolor{preprocessor}{            \} \(\backslash\)}
04069 \textcolor{preprocessor}{            ptr\_in += stride[1]*dims[0]; \(\backslash\)}
04070 \textcolor{preprocessor}{        \} \(\backslash\)}
04071 \textcolor{preprocessor}{    \} while (0)}
04072 
04073 \textcolor{preprocessor}{#define GET\_DATA\_SLABN(T) \(\backslash\)}
04074 \textcolor{preprocessor}{    do \{ \(\backslash\)}
04075 \textcolor{preprocessor}{        inc[0]  = stride[0]-1; \(\backslash\)}
04076 \textcolor{preprocessor}{        dimp[0] = dims[0]; \(\backslash\)}
04077 \textcolor{preprocessor}{        N       = edge[0]; \(\backslash\)}
04078 \textcolor{preprocessor}{        I       = 0; }\textcolor{comment}{/* start[0]; */}\textcolor{preprocessor}{ \(\backslash\)}
04079 \textcolor{preprocessor}{        for ( i = 1; i < rank; i++ ) \{ \(\backslash\)}
04080 \textcolor{preprocessor}{            inc[i]  = stride[i]-1; \(\backslash\)}
04081 \textcolor{preprocessor}{            dimp[i] = dims[i-1]; \(\backslash\)}
04082 \textcolor{preprocessor}{            for ( j = i; j--; ) \{ \(\backslash\)}
04083 \textcolor{preprocessor}{                inc[i]  *= dims[j]; \(\backslash\)}
04084 \textcolor{preprocessor}{                dimp[i] *= dims[j+1]; \(\backslash\)}
04085 \textcolor{preprocessor}{            \} \(\backslash\)}
04086 \textcolor{preprocessor}{            N *= edge[i]; \(\backslash\)}
04087 \textcolor{preprocessor}{            I += dimp[i-1]*start[i]; \(\backslash\)}
04088 \textcolor{preprocessor}{        \} \(\backslash\)}
04089 \textcolor{preprocessor}{        ptr\_in += I; \(\backslash\)}
04090 \textcolor{preprocessor}{        if ( stride[0] == 1 ) \{ \(\backslash\)}
04091 \textcolor{preprocessor}{            for ( i = 0; i < N; i+=edge[0] ) \{ \(\backslash\)}
04092 \textcolor{preprocessor}{                int k; \(\backslash\)}
04093 \textcolor{preprocessor}{                if ( start[0] ) \{ \(\backslash\)}
04094 \textcolor{preprocessor}{                    ptr\_in += start[0]; \(\backslash\)}
04095 \textcolor{preprocessor}{                    I += start[0]; \(\backslash\)}
04096 \textcolor{preprocessor}{                \} \(\backslash\)}
04097 \textcolor{preprocessor}{                for ( k = 0; k < edge[0]; k++ ) \{ \(\backslash\)}
04098 \textcolor{preprocessor}{                    *(ptr+i+k) = (T)(*(ptr\_in+k)); \(\backslash\)}
04099 \textcolor{preprocessor}{                \} \(\backslash\)}
04100 \textcolor{preprocessor}{                I += dims[0]-start[0]; \(\backslash\)}
04101 \textcolor{preprocessor}{                ptr\_in += dims[0]-start[0]; \(\backslash\)}
04102 \textcolor{preprocessor}{                GET\_DATA\_SLABN\_RANK\_LOOP; \(\backslash\)}
04103 \textcolor{preprocessor}{            \} \(\backslash\)}
04104 \textcolor{preprocessor}{        \} else \{ \(\backslash\)}
04105 \textcolor{preprocessor}{            for ( i = 0; i < N; i+=edge[0] ) \{ \(\backslash\)}
04106 \textcolor{preprocessor}{                if ( start[0] ) \{ \(\backslash\)}
04107 \textcolor{preprocessor}{                    ptr\_in += start[0]; \(\backslash\)}
04108 \textcolor{preprocessor}{                    I += start[0]; \(\backslash\)}
04109 \textcolor{preprocessor}{                \} \(\backslash\)}
04110 \textcolor{preprocessor}{                for ( j = 0; j < edge[0]; j++ ) \{ \(\backslash\)}
04111 \textcolor{preprocessor}{                    *(ptr+i+j) = (T)(*ptr\_in); \(\backslash\)}
04112 \textcolor{preprocessor}{                    ptr\_in += stride[0]; \(\backslash\)}
04113 \textcolor{preprocessor}{                    I += stride[0]; \(\backslash\)}
04114 \textcolor{preprocessor}{                \} \(\backslash\)}
04115 \textcolor{preprocessor}{                I += dims[0]-edge[0]*stride[0]-start[0]; \(\backslash\)}
04116 \textcolor{preprocessor}{                ptr\_in += dims[0]-edge[0]*stride[0]-start[0]; \(\backslash\)}
04117 \textcolor{preprocessor}{                GET\_DATA\_SLABN\_RANK\_LOOP; \(\backslash\)}
04118 \textcolor{preprocessor}{            \} \(\backslash\)}
04119 \textcolor{preprocessor}{        \} \(\backslash\)}
04120 \textcolor{preprocessor}{    \} while (0)}
04121 
04122 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_INT64\_T}
04123 \textcolor{preprocessor}{#define GET\_DATA\_SLAB2\_INT64(T) \(\backslash\)}
04124 \textcolor{preprocessor}{    do \{ \(\backslash\)}
04125 \textcolor{preprocessor}{        if ( MAT\_T\_INT64 == data\_type ) \{ \(\backslash\)}
04126 \textcolor{preprocessor}{            mat\_int64\_t *ptr\_in = (mat\_int64\_t *)data\_in; \(\backslash\)}
04127 \textcolor{preprocessor}{            GET\_DATA\_SLAB2(T); \(\backslash\)}
04128 \textcolor{preprocessor}{            err = 0; \(\backslash\)}
04129 \textcolor{preprocessor}{        \} \(\backslash\)}
04130 \textcolor{preprocessor}{    \} while (0)}
04131 \textcolor{preprocessor}{#else}
04132 \textcolor{preprocessor}{#define GET\_DATA\_SLAB2\_INT64}
04133 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* HAVE\_MAT\_INT64\_T */}\textcolor{preprocessor}{}
04134 
04135 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_UINT64\_T}
04136 \textcolor{preprocessor}{#define GET\_DATA\_SLAB2\_UINT64(T) \(\backslash\)}
04137 \textcolor{preprocessor}{    do \{ \(\backslash\)}
04138 \textcolor{preprocessor}{        if ( MAT\_T\_UINT64 == data\_type ) \{ \(\backslash\)}
04139 \textcolor{preprocessor}{            mat\_uint64\_t *ptr\_in = (mat\_uint64\_t *)data\_in; \(\backslash\)}
04140 \textcolor{preprocessor}{            GET\_DATA\_SLAB2(T); \(\backslash\)}
04141 \textcolor{preprocessor}{            err = 0; \(\backslash\)}
04142 \textcolor{preprocessor}{        \} \(\backslash\)}
04143 \textcolor{preprocessor}{    \} while (0)}
04144 \textcolor{preprocessor}{#else}
04145 \textcolor{preprocessor}{#define GET\_DATA\_SLAB2\_UINT64}
04146 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* HAVE\_MAT\_UINT64\_T */}\textcolor{preprocessor}{}
04147 
04148 \textcolor{preprocessor}{#define GET\_DATA\_SLAB2\_TYPE(T) \(\backslash\)}
04149 \textcolor{preprocessor}{    do \{ \(\backslash\)}
04150 \textcolor{preprocessor}{        switch ( data\_type ) \{ \(\backslash\)}
04151 \textcolor{preprocessor}{            case MAT\_T\_DOUBLE: \(\backslash\)}
04152 \textcolor{preprocessor}{            \{ \(\backslash\)}
04153 \textcolor{preprocessor}{                double *ptr\_in = (double *)data\_in; \(\backslash\)}
04154 \textcolor{preprocessor}{                GET\_DATA\_SLAB2(T); \(\backslash\)}
04155 \textcolor{preprocessor}{                break; \(\backslash\)}
04156 \textcolor{preprocessor}{            \} \(\backslash\)}
04157 \textcolor{preprocessor}{            case MAT\_T\_SINGLE: \(\backslash\)}
04158 \textcolor{preprocessor}{            \{ \(\backslash\)}
04159 \textcolor{preprocessor}{                float *ptr\_in = (float *)data\_in; \(\backslash\)}
04160 \textcolor{preprocessor}{                GET\_DATA\_SLAB2(T); \(\backslash\)}
04161 \textcolor{preprocessor}{                break; \(\backslash\)}
04162 \textcolor{preprocessor}{            \} \(\backslash\)}
04163 \textcolor{preprocessor}{            case MAT\_T\_INT32: \(\backslash\)}
04164 \textcolor{preprocessor}{            \{ \(\backslash\)}
04165 \textcolor{preprocessor}{                mat\_int32\_t *ptr\_in = (mat\_int32\_t *)data\_in; \(\backslash\)}
04166 \textcolor{preprocessor}{                GET\_DATA\_SLAB2(T); \(\backslash\)}
04167 \textcolor{preprocessor}{                break; \(\backslash\)}
04168 \textcolor{preprocessor}{            \} \(\backslash\)}
04169 \textcolor{preprocessor}{            case MAT\_T\_UINT32: \(\backslash\)}
04170 \textcolor{preprocessor}{            \{ \(\backslash\)}
04171 \textcolor{preprocessor}{                mat\_uint32\_t *ptr\_in = (mat\_uint32\_t *)data\_in; \(\backslash\)}
04172 \textcolor{preprocessor}{                GET\_DATA\_SLAB2(T); \(\backslash\)}
04173 \textcolor{preprocessor}{                break; \(\backslash\)}
04174 \textcolor{preprocessor}{            \} \(\backslash\)}
04175 \textcolor{preprocessor}{            case MAT\_T\_INT16: \(\backslash\)}
04176 \textcolor{preprocessor}{            \{ \(\backslash\)}
04177 \textcolor{preprocessor}{                mat\_int16\_t *ptr\_in = (mat\_int16\_t *)data\_in; \(\backslash\)}
04178 \textcolor{preprocessor}{                GET\_DATA\_SLAB2(T); \(\backslash\)}
04179 \textcolor{preprocessor}{                break; \(\backslash\)}
04180 \textcolor{preprocessor}{            \} \(\backslash\)}
04181 \textcolor{preprocessor}{            case MAT\_T\_UINT16: \(\backslash\)}
04182 \textcolor{preprocessor}{            \{ \(\backslash\)}
04183 \textcolor{preprocessor}{                mat\_uint16\_t *ptr\_in = (mat\_uint16\_t *)data\_in; \(\backslash\)}
04184 \textcolor{preprocessor}{                GET\_DATA\_SLAB2(T); \(\backslash\)}
04185 \textcolor{preprocessor}{                break; \(\backslash\)}
04186 \textcolor{preprocessor}{            \} \(\backslash\)}
04187 \textcolor{preprocessor}{            case MAT\_T\_INT8: \(\backslash\)}
04188 \textcolor{preprocessor}{            \{ \(\backslash\)}
04189 \textcolor{preprocessor}{                mat\_int8\_t *ptr\_in = (mat\_int8\_t *)data\_in; \(\backslash\)}
04190 \textcolor{preprocessor}{                GET\_DATA\_SLAB2(T); \(\backslash\)}
04191 \textcolor{preprocessor}{                break; \(\backslash\)}
04192 \textcolor{preprocessor}{            \} \(\backslash\)}
04193 \textcolor{preprocessor}{            case MAT\_T\_UINT8: \(\backslash\)}
04194 \textcolor{preprocessor}{            \{ \(\backslash\)}
04195 \textcolor{preprocessor}{                mat\_uint8\_t *ptr\_in = (mat\_uint8\_t *)data\_in; \(\backslash\)}
04196 \textcolor{preprocessor}{                GET\_DATA\_SLAB2(T); \(\backslash\)}
04197 \textcolor{preprocessor}{                break; \(\backslash\)}
04198 \textcolor{preprocessor}{            \} \(\backslash\)}
04199 \textcolor{preprocessor}{            default: \(\backslash\)}
04200 \textcolor{preprocessor}{                err = 1; \(\backslash\)}
04201 \textcolor{preprocessor}{                GET\_DATA\_SLAB2\_INT64(T); \(\backslash\)}
04202 \textcolor{preprocessor}{                GET\_DATA\_SLAB2\_UINT64(T); \(\backslash\)}
04203 \textcolor{preprocessor}{                break; \(\backslash\)}
04204 \textcolor{preprocessor}{        \} \(\backslash\)}
04205 \textcolor{preprocessor}{    \} while (0)}
04206 
04207 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_INT64\_T}
04208 \textcolor{preprocessor}{#define GET\_DATA\_SLABN\_INT64(T) \(\backslash\)}
04209 \textcolor{preprocessor}{    do \{ \(\backslash\)}
04210 \textcolor{preprocessor}{        if ( MAT\_T\_INT64 == data\_type ) \{ \(\backslash\)}
04211 \textcolor{preprocessor}{            mat\_int64\_t *ptr\_in = (mat\_int64\_t *)data\_in; \(\backslash\)}
04212 \textcolor{preprocessor}{            GET\_DATA\_SLABN(T); \(\backslash\)}
04213 \textcolor{preprocessor}{            err = 0; \(\backslash\)}
04214 \textcolor{preprocessor}{        \} \(\backslash\)}
04215 \textcolor{preprocessor}{    \} while (0)}
04216 \textcolor{preprocessor}{#else}
04217 \textcolor{preprocessor}{#define GET\_DATA\_SLABN\_INT64}
04218 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* HAVE\_MAT\_INT64\_T */}\textcolor{preprocessor}{}
04219 
04220 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_UINT64\_T}
04221 \textcolor{preprocessor}{#define GET\_DATA\_SLABN\_UINT64(T) \(\backslash\)}
04222 \textcolor{preprocessor}{    do \{ \(\backslash\)}
04223 \textcolor{preprocessor}{        if ( MAT\_T\_UINT64 == data\_type ) \{ \(\backslash\)}
04224 \textcolor{preprocessor}{            mat\_uint64\_t *ptr\_in = (mat\_uint64\_t *)data\_in; \(\backslash\)}
04225 \textcolor{preprocessor}{            GET\_DATA\_SLABN(T); \(\backslash\)}
04226 \textcolor{preprocessor}{            err = 0; \(\backslash\)}
04227 \textcolor{preprocessor}{        \} \(\backslash\)}
04228 \textcolor{preprocessor}{    \} while (0)}
04229 \textcolor{preprocessor}{#else}
04230 \textcolor{preprocessor}{#define GET\_DATA\_SLABN\_UINT64}
04231 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* HAVE\_MAT\_UINT64\_T */}\textcolor{preprocessor}{}
04232 
04233 \textcolor{preprocessor}{#define GET\_DATA\_SLABN\_TYPE(T) \(\backslash\)}
04234 \textcolor{preprocessor}{    do \{ \(\backslash\)}
04235 \textcolor{preprocessor}{        switch ( data\_type ) \{ \(\backslash\)}
04236 \textcolor{preprocessor}{            case MAT\_T\_DOUBLE: \(\backslash\)}
04237 \textcolor{preprocessor}{            \{ \(\backslash\)}
04238 \textcolor{preprocessor}{                double *ptr\_in = (double *)data\_in; \(\backslash\)}
04239 \textcolor{preprocessor}{                GET\_DATA\_SLABN(T); \(\backslash\)}
04240 \textcolor{preprocessor}{                break; \(\backslash\)}
04241 \textcolor{preprocessor}{            \} \(\backslash\)}
04242 \textcolor{preprocessor}{            case MAT\_T\_SINGLE: \(\backslash\)}
04243 \textcolor{preprocessor}{            \{ \(\backslash\)}
04244 \textcolor{preprocessor}{                float *ptr\_in = (float *)data\_in; \(\backslash\)}
04245 \textcolor{preprocessor}{                GET\_DATA\_SLABN(T); \(\backslash\)}
04246 \textcolor{preprocessor}{                break; \(\backslash\)}
04247 \textcolor{preprocessor}{            \} \(\backslash\)}
04248 \textcolor{preprocessor}{            case MAT\_T\_INT32: \(\backslash\)}
04249 \textcolor{preprocessor}{            \{ \(\backslash\)}
04250 \textcolor{preprocessor}{                mat\_int32\_t *ptr\_in = (mat\_int32\_t *)data\_in; \(\backslash\)}
04251 \textcolor{preprocessor}{                GET\_DATA\_SLABN(T); \(\backslash\)}
04252 \textcolor{preprocessor}{                break; \(\backslash\)}
04253 \textcolor{preprocessor}{            \} \(\backslash\)}
04254 \textcolor{preprocessor}{            case MAT\_T\_UINT32: \(\backslash\)}
04255 \textcolor{preprocessor}{            \{ \(\backslash\)}
04256 \textcolor{preprocessor}{                mat\_uint32\_t *ptr\_in = (mat\_uint32\_t *)data\_in; \(\backslash\)}
04257 \textcolor{preprocessor}{                GET\_DATA\_SLABN(T); \(\backslash\)}
04258 \textcolor{preprocessor}{                break; \(\backslash\)}
04259 \textcolor{preprocessor}{            \} \(\backslash\)}
04260 \textcolor{preprocessor}{            case MAT\_T\_INT16: \(\backslash\)}
04261 \textcolor{preprocessor}{            \{ \(\backslash\)}
04262 \textcolor{preprocessor}{                mat\_int16\_t *ptr\_in = (mat\_int16\_t *)data\_in; \(\backslash\)}
04263 \textcolor{preprocessor}{                GET\_DATA\_SLABN(T); \(\backslash\)}
04264 \textcolor{preprocessor}{                break; \(\backslash\)}
04265 \textcolor{preprocessor}{            \} \(\backslash\)}
04266 \textcolor{preprocessor}{            case MAT\_T\_UINT16: \(\backslash\)}
04267 \textcolor{preprocessor}{            \{ \(\backslash\)}
04268 \textcolor{preprocessor}{                mat\_uint16\_t *ptr\_in = (mat\_uint16\_t *)data\_in; \(\backslash\)}
04269 \textcolor{preprocessor}{                GET\_DATA\_SLABN(T); \(\backslash\)}
04270 \textcolor{preprocessor}{                break; \(\backslash\)}
04271 \textcolor{preprocessor}{            \} \(\backslash\)}
04272 \textcolor{preprocessor}{            case MAT\_T\_INT8: \(\backslash\)}
04273 \textcolor{preprocessor}{            \{ \(\backslash\)}
04274 \textcolor{preprocessor}{                mat\_int8\_t *ptr\_in = (mat\_int8\_t *)data\_in; \(\backslash\)}
04275 \textcolor{preprocessor}{                GET\_DATA\_SLABN(T); \(\backslash\)}
04276 \textcolor{preprocessor}{                break; \(\backslash\)}
04277 \textcolor{preprocessor}{            \} \(\backslash\)}
04278 \textcolor{preprocessor}{            case MAT\_T\_UINT8: \(\backslash\)}
04279 \textcolor{preprocessor}{            \{ \(\backslash\)}
04280 \textcolor{preprocessor}{                mat\_uint8\_t *ptr\_in = (mat\_uint8\_t *)data\_in; \(\backslash\)}
04281 \textcolor{preprocessor}{                GET\_DATA\_SLABN(T); \(\backslash\)}
04282 \textcolor{preprocessor}{                break; \(\backslash\)}
04283 \textcolor{preprocessor}{            \} \(\backslash\)}
04284 \textcolor{preprocessor}{            default: \(\backslash\)}
04285 \textcolor{preprocessor}{                err = 1; \(\backslash\)}
04286 \textcolor{preprocessor}{                GET\_DATA\_SLABN\_INT64(T); \(\backslash\)}
04287 \textcolor{preprocessor}{                GET\_DATA\_SLABN\_UINT64(T); \(\backslash\)}
04288 \textcolor{preprocessor}{                break; \(\backslash\)}
04289 \textcolor{preprocessor}{        \} \(\backslash\)}
04290 \textcolor{preprocessor}{    \} while (0)}
04291 
04292 \textcolor{keyword}{static} \textcolor{keywordtype}{int}
04293 GetDataSlab(\textcolor{keywordtype}{void} *data\_in, \textcolor{keywordtype}{void} *data\_out, \textcolor{keyword}{enum} \hyperlink{group___m_a_t_gad4d60ae7b709fc81bfd744fb4c857c40}{matio\_classes} class\_type,
04294     \textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} data\_type, \textcolor{keywordtype}{size\_t} *dims, \textcolor{keywordtype}{int} *start, \textcolor{keywordtype}{int} *stride, \textcolor{keywordtype}{int} *edge,
04295     \textcolor{keywordtype}{int} rank, \textcolor{keywordtype}{size\_t} nbytes)
04296 \{
04297     \textcolor{keywordtype}{int} err = 0;
04298     \textcolor{keywordtype}{int} same\_type = 0;
04299     \textcolor{keywordflow}{if} (( class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5d70e0862e5bdb7bd86bf7ba5948f307}{MAT\_C\_DOUBLE} && data\_type == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE} ) ||
04300         ( class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2825631e26a961cbe0f79db50a39cea2}{MAT\_C\_SINGLE} && data\_type == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a3a3657d40e9212c923d9b9d03531b64c}{MAT\_T\_SINGLE} ) ||
04301         ( class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a40370e9de516c5036a67a5865c071006}{MAT\_C\_INT16} && data\_type == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a8c5b2e381946e95ea8d81ac216743302}{MAT\_T\_INT16} ) ||
04302         ( class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40adb44fc39694e3152ae5e69470a2fefe8}{MAT\_C\_INT32} && data\_type == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32} ) ||
04303         ( class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a1ea83bcde49b35477494412973f82409}{MAT\_C\_INT64} && data\_type == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9e825b5d18b8f946eaf2b4b57e51c145}{MAT\_T\_INT64} ) ||
04304         ( class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a984ff310f9e906100fcff95f704f43c5}{MAT\_C\_INT8} && data\_type == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8} ) ||
04305         ( class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a8bede21dbf6c1edc0bbccc1481bccae7}{MAT\_C\_UINT16} && data\_type == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16} ) ||
04306         ( class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a9a17a7edd45b19ef68197db81b27e816}{MAT\_C\_UINT32} && data\_type == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32} ) ||
04307         ( class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a86470e25c3763d9a24623f04326195dd}{MAT\_C\_UINT64} && data\_type == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a45547932c46be27118abe08302d7e29f}{MAT\_T\_UINT64} ) ||
04308         ( class\_type == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a81270f8093cb4808e992c1d29d84d4e3}{MAT\_C\_UINT8} && data\_type == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a01c1bd7db68f90552862eb5d311be408}{MAT\_T\_UINT8} ))
04309         same\_type = 1;
04310 
04311     \textcolor{keywordflow}{if} ( rank == 2 ) \{
04312         \textcolor{keywordflow}{if} ( stride[0]*(edge[0]-1)+start[0]+1 > dims[0] )
04313             err = 1;
04314         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( stride[1]*(edge[1]-1)+start[1]+1 > dims[1] )
04315             err = 1;
04316         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( ( stride[0] == 1 && edge[0] == dims[0] ) &&
04317                   ( stride[1] == 1 ) && ( same\_type == 1 ) )
04318             memcpy(data\_out, data\_in, nbytes);
04319         \textcolor{keywordflow}{else} \{
04320             \textcolor{keywordtype}{int} i, j;
04321 
04322             \textcolor{keywordflow}{switch} ( class\_type ) \{
04323                 \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5d70e0862e5bdb7bd86bf7ba5948f307}{MAT\_C\_DOUBLE}:
04324                 \{
04325                     \textcolor{keywordtype}{double} *ptr = (\textcolor{keywordtype}{double} *)data\_out;
04326                     GET\_DATA\_SLAB2\_TYPE(\textcolor{keywordtype}{double});
04327                     \textcolor{keywordflow}{break};
04328                 \}
04329                 \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2825631e26a961cbe0f79db50a39cea2}{MAT\_C\_SINGLE}:
04330                 \{
04331                     \textcolor{keywordtype}{float} *ptr = (\textcolor{keywordtype}{float} *)data\_out;
04332                     GET\_DATA\_SLAB2\_TYPE(\textcolor{keywordtype}{float});
04333                     \textcolor{keywordflow}{break};
04334                 \}
04335 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_INT64\_T}
04336                 \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a1ea83bcde49b35477494412973f82409}{MAT\_C\_INT64}:
04337                 \{
04338                     mat\_int64\_t *ptr = (mat\_int64\_t *)data\_out;
04339                     GET\_DATA\_SLAB2\_TYPE(mat\_int64\_t);
04340                     \textcolor{keywordflow}{break};
04341                 \}
04342 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* HAVE\_MAT\_INT64\_T */}\textcolor{preprocessor}{}
04343 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_UINT64\_T}
04344                 \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a86470e25c3763d9a24623f04326195dd}{MAT\_C\_UINT64}:
04345                 \{
04346                     mat\_uint64\_t *ptr = (mat\_uint64\_t *)data\_out;
04347                     GET\_DATA\_SLAB2\_TYPE(mat\_uint64\_t);
04348                     \textcolor{keywordflow}{break};
04349                 \}
04350 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* HAVE\_MAT\_UINT64\_T */}\textcolor{preprocessor}{}
04351                 \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40adb44fc39694e3152ae5e69470a2fefe8}{MAT\_C\_INT32}:
04352                 \{
04353                     mat\_int32\_t *ptr = (mat\_int32\_t *)data\_out;
04354                     GET\_DATA\_SLAB2\_TYPE(mat\_int32\_t);
04355                     \textcolor{keywordflow}{break};
04356                 \}
04357                 \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a9a17a7edd45b19ef68197db81b27e816}{MAT\_C\_UINT32}:
04358                 \{
04359                     mat\_uint32\_t *ptr = (mat\_uint32\_t *)data\_out;
04360                     GET\_DATA\_SLAB2\_TYPE(mat\_uint32\_t);
04361                     \textcolor{keywordflow}{break};
04362                 \}
04363                 \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a40370e9de516c5036a67a5865c071006}{MAT\_C\_INT16}:
04364                 \{
04365                     mat\_int16\_t *ptr = (mat\_int16\_t *)data\_out;
04366                     GET\_DATA\_SLAB2\_TYPE(mat\_int16\_t);
04367                     \textcolor{keywordflow}{break};
04368                 \}
04369                 \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a8bede21dbf6c1edc0bbccc1481bccae7}{MAT\_C\_UINT16}:
04370                 \{
04371                     mat\_uint16\_t *ptr = (mat\_uint16\_t *)data\_out;
04372                     GET\_DATA\_SLAB2\_TYPE(mat\_uint16\_t);
04373                     \textcolor{keywordflow}{break};
04374                 \}
04375                 \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a984ff310f9e906100fcff95f704f43c5}{MAT\_C\_INT8}:
04376                 \{
04377                     mat\_int8\_t *ptr = (mat\_int8\_t *)data\_out;
04378                     GET\_DATA\_SLAB2\_TYPE(mat\_int8\_t);
04379                     \textcolor{keywordflow}{break};
04380                 \}
04381                 \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a81270f8093cb4808e992c1d29d84d4e3}{MAT\_C\_UINT8}:
04382                 \{
04383                     mat\_uint8\_t *ptr = (mat\_uint8\_t *)data\_out;
04384                     GET\_DATA\_SLAB2\_TYPE(mat\_uint8\_t);
04385                     \textcolor{keywordflow}{break};
04386                 \}
04387                 \textcolor{keywordflow}{default}:
04388                     err = 1;
04389                     \textcolor{keywordflow}{break};
04390             \}
04391         \}
04392     \} \textcolor{keywordflow}{else} \{
04393         \textcolor{keywordtype}{int} i, j, N, I = 0;
04394         \textcolor{keywordtype}{int} inc[10] = \{0,\}, cnt[10] = \{0,\}, dimp[10] = \{0,\};
04395 
04396         \textcolor{keywordflow}{switch} ( class\_type ) \{
04397             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5d70e0862e5bdb7bd86bf7ba5948f307}{MAT\_C\_DOUBLE}:
04398             \{
04399                 \textcolor{keywordtype}{double} *ptr = (\textcolor{keywordtype}{double} *)data\_out;
04400                 GET\_DATA\_SLABN\_TYPE(\textcolor{keywordtype}{double});
04401                 \textcolor{keywordflow}{break};
04402             \}
04403             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2825631e26a961cbe0f79db50a39cea2}{MAT\_C\_SINGLE}:
04404             \{
04405                 \textcolor{keywordtype}{float} *ptr = (\textcolor{keywordtype}{float} *)data\_out;
04406                 GET\_DATA\_SLABN\_TYPE(\textcolor{keywordtype}{float});
04407                 \textcolor{keywordflow}{break};
04408             \}
04409 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_INT64\_T}
04410             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a1ea83bcde49b35477494412973f82409}{MAT\_C\_INT64}:
04411             \{
04412                 mat\_int64\_t *ptr = (mat\_int64\_t *)data\_out;
04413                 GET\_DATA\_SLABN\_TYPE(mat\_int64\_t);
04414                 \textcolor{keywordflow}{break};
04415             \}
04416 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* HAVE\_MAT\_INT64\_T */}\textcolor{preprocessor}{}
04417 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_UINT64\_T}
04418             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a86470e25c3763d9a24623f04326195dd}{MAT\_C\_UINT64}:
04419             \{
04420                 mat\_uint64\_t *ptr = (mat\_uint64\_t *)data\_out;
04421                 GET\_DATA\_SLABN\_TYPE(mat\_uint64\_t);
04422                 \textcolor{keywordflow}{break};
04423             \}
04424 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* HAVE\_MAT\_UINT64\_T */}\textcolor{preprocessor}{}
04425             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40adb44fc39694e3152ae5e69470a2fefe8}{MAT\_C\_INT32}:
04426             \{
04427                 mat\_int32\_t *ptr = (mat\_int32\_t *)data\_out;
04428                 GET\_DATA\_SLABN\_TYPE(mat\_int32\_t);
04429                 \textcolor{keywordflow}{break};
04430             \}
04431             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a9a17a7edd45b19ef68197db81b27e816}{MAT\_C\_UINT32}:
04432             \{
04433                 mat\_uint32\_t *ptr = (mat\_uint32\_t *)data\_out;
04434                 GET\_DATA\_SLABN\_TYPE(mat\_uint32\_t);
04435                 \textcolor{keywordflow}{break};
04436             \}
04437             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a40370e9de516c5036a67a5865c071006}{MAT\_C\_INT16}:
04438             \{
04439                 mat\_int16\_t *ptr = (mat\_int16\_t *)data\_out;
04440                 GET\_DATA\_SLABN\_TYPE(mat\_int16\_t);
04441                 \textcolor{keywordflow}{break};
04442             \}
04443             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a8bede21dbf6c1edc0bbccc1481bccae7}{MAT\_C\_UINT16}:
04444             \{
04445                 mat\_uint16\_t *ptr = (mat\_uint16\_t *)data\_out;
04446                 GET\_DATA\_SLABN\_TYPE(mat\_uint16\_t);
04447                 \textcolor{keywordflow}{break};
04448             \}
04449             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a984ff310f9e906100fcff95f704f43c5}{MAT\_C\_INT8}:
04450             \{
04451                 mat\_int8\_t *ptr = (mat\_int8\_t *)data\_out;
04452                 GET\_DATA\_SLABN\_TYPE(mat\_int8\_t);
04453                 \textcolor{keywordflow}{break};
04454             \}
04455             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a81270f8093cb4808e992c1d29d84d4e3}{MAT\_C\_UINT8}:
04456             \{
04457                 mat\_uint8\_t *ptr = (mat\_uint8\_t *)data\_out;
04458                 GET\_DATA\_SLABN\_TYPE(mat\_uint8\_t);
04459                 \textcolor{keywordflow}{break};
04460             \}
04461             \textcolor{keywordflow}{default}:
04462                 err = 1;
04463                 \textcolor{keywordflow}{break};
04464         \}
04465     \}
04466 
04467     \textcolor{keywordflow}{return} err;
04468 \}
04469 
04470 \textcolor{preprocessor}{#undef GET\_DATA\_SLAB2}
04471 \textcolor{preprocessor}{#undef GET\_DATA\_SLAB2\_TYPE}
04472 \textcolor{preprocessor}{#undef GET\_DATA\_SLAB2\_INT64}
04473 \textcolor{preprocessor}{#undef GET\_DATA\_SLAB2\_UINT64}
04474 \textcolor{preprocessor}{#undef GET\_DATA\_SLABN}
04475 \textcolor{preprocessor}{#undef GET\_DATA\_SLABN\_TYPE}
04476 \textcolor{preprocessor}{#undef GET\_DATA\_SLABN\_INT64}
04477 \textcolor{preprocessor}{#undef GET\_DATA\_SLABN\_UINT64}
04478 \textcolor{preprocessor}{#undef GET\_DATA\_SLABN\_RANK\_LOOP}
04479 
04480 \textcolor{preprocessor}{#define GET\_DATA\_LINEAR \(\backslash\)}
04481 \textcolor{preprocessor}{    do \{ \(\backslash\)}
04482 \textcolor{preprocessor}{        ptr\_in += start; \(\backslash\)}
04483 \textcolor{preprocessor}{        if ( !stride ) \{ \(\backslash\)}
04484 \textcolor{preprocessor}{            memcpy(ptr, ptr\_in, edge*data\_size); \(\backslash\)}
04485 \textcolor{preprocessor}{        \} else \{ \(\backslash\)}
04486 \textcolor{preprocessor}{            int i; \(\backslash\)}
04487 \textcolor{preprocessor}{            for ( i = 0; i < edge; i++ ) \(\backslash\)}
04488 \textcolor{preprocessor}{                memcpy(ptr++, ptr\_in+i*stride, data\_size); \(\backslash\)}
04489 \textcolor{preprocessor}{        \} \(\backslash\)}
04490 \textcolor{preprocessor}{    \} while (0)}
04491 
04492 \textcolor{keyword}{static} \textcolor{keywordtype}{int}
04493 GetDataLinear(\textcolor{keywordtype}{void} *data\_in, \textcolor{keywordtype}{void} *data\_out, \textcolor{keyword}{enum} \hyperlink{group___m_a_t_gad4d60ae7b709fc81bfd744fb4c857c40}{matio\_classes} class\_type,
04494     \textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} data\_type, \textcolor{keywordtype}{int} start, \textcolor{keywordtype}{int} stride, \textcolor{keywordtype}{int} edge)
04495 \{
04496     \textcolor{keywordtype}{int} err = 0;
04497     \textcolor{keywordtype}{int} data\_size = \hyperlink{group__mat__util_gab6774aabdc124c540c1e7686d0804940}{Mat\_SizeOf}(data\_type);
04498 
04499     \textcolor{keywordflow}{switch} ( class\_type ) \{
04500         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5d70e0862e5bdb7bd86bf7ba5948f307}{MAT\_C\_DOUBLE}:
04501         \{
04502             \textcolor{keywordtype}{double} *ptr = (\textcolor{keywordtype}{double} *)data\_out;
04503             \textcolor{keywordtype}{double} *ptr\_in = (\textcolor{keywordtype}{double}*)data\_in;
04504             GET\_DATA\_LINEAR;
04505             \textcolor{keywordflow}{break};
04506         \}
04507         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2825631e26a961cbe0f79db50a39cea2}{MAT\_C\_SINGLE}:
04508         \{
04509             \textcolor{keywordtype}{float} *ptr = (\textcolor{keywordtype}{float} *)data\_out;
04510             \textcolor{keywordtype}{float} *ptr\_in = (\textcolor{keywordtype}{float}*)data\_in;
04511             GET\_DATA\_LINEAR;
04512             \textcolor{keywordflow}{break};
04513         \}
04514 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_INT64\_T}
04515         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a1ea83bcde49b35477494412973f82409}{MAT\_C\_INT64}:
04516         \{
04517             mat\_int64\_t *ptr = (mat\_int64\_t *)data\_out;
04518             mat\_int64\_t *ptr\_in = (mat\_int64\_t*)data\_in;
04519             GET\_DATA\_LINEAR;
04520             \textcolor{keywordflow}{break};
04521         \}
04522 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* HAVE\_MAT\_INT64\_T */}\textcolor{preprocessor}{}
04523 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_UINT64\_T}
04524         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a86470e25c3763d9a24623f04326195dd}{MAT\_C\_UINT64}:
04525         \{
04526             mat\_uint64\_t *ptr = (mat\_uint64\_t *)data\_out;
04527             mat\_uint64\_t *ptr\_in = (mat\_uint64\_t*)data\_in;
04528             GET\_DATA\_LINEAR;
04529             \textcolor{keywordflow}{break};
04530         \}
04531 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* HAVE\_MAT\_UINT64\_T */}\textcolor{preprocessor}{}
04532         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40adb44fc39694e3152ae5e69470a2fefe8}{MAT\_C\_INT32}:
04533         \{
04534             mat\_int32\_t *ptr = (mat\_int32\_t *)data\_out;
04535             mat\_int32\_t *ptr\_in = (mat\_int32\_t*)data\_in;
04536             GET\_DATA\_LINEAR;
04537             \textcolor{keywordflow}{break};
04538         \}
04539         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a9a17a7edd45b19ef68197db81b27e816}{MAT\_C\_UINT32}:
04540         \{
04541             mat\_uint32\_t *ptr = (mat\_uint32\_t *)data\_out;
04542             mat\_uint32\_t *ptr\_in = (mat\_uint32\_t*)data\_in;
04543             GET\_DATA\_LINEAR;
04544             \textcolor{keywordflow}{break};
04545         \}
04546         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a40370e9de516c5036a67a5865c071006}{MAT\_C\_INT16}:
04547         \{
04548             mat\_int16\_t *ptr = (mat\_int16\_t *)data\_out;
04549             mat\_int16\_t *ptr\_in = (mat\_int16\_t*)data\_in;
04550             GET\_DATA\_LINEAR;
04551             \textcolor{keywordflow}{break};
04552         \}
04553         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a8bede21dbf6c1edc0bbccc1481bccae7}{MAT\_C\_UINT16}:
04554         \{
04555             mat\_uint16\_t *ptr = (mat\_uint16\_t *)data\_out;
04556             mat\_uint16\_t *ptr\_in = (mat\_uint16\_t*)data\_in;
04557             GET\_DATA\_LINEAR;
04558             \textcolor{keywordflow}{break};
04559         \}
04560         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a984ff310f9e906100fcff95f704f43c5}{MAT\_C\_INT8}:
04561         \{
04562             mat\_int8\_t *ptr = (mat\_int8\_t *)data\_out;
04563             mat\_int8\_t *ptr\_in = (mat\_int8\_t*)data\_in;
04564             GET\_DATA\_LINEAR;
04565             \textcolor{keywordflow}{break};
04566         \}
04567         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a81270f8093cb4808e992c1d29d84d4e3}{MAT\_C\_UINT8}:
04568         \{
04569             mat\_uint8\_t *ptr = (mat\_uint8\_t *)data\_out;
04570             mat\_uint8\_t *ptr\_in = (mat\_uint8\_t*)data\_in;
04571             GET\_DATA\_LINEAR;
04572             \textcolor{keywordflow}{break};
04573         \}
04574         \textcolor{keywordflow}{default}:
04575             err = 1;
04576             \textcolor{keywordflow}{break};
04577     \}
04578 
04579     \textcolor{keywordflow}{return} err;
04580 \}
04581 
04582 \textcolor{preprocessor}{#undef GET\_DATA\_LINEAR}
04583 \textcolor{preprocessor}{#endif}
04584 
04599 \textcolor{keywordtype}{int}
\Hypertarget{mat5_8c_source_l04600}\hyperlink{mat5_8c_af8a259573b7b3a89555c5a9bc1860e19}{04600} \hyperlink{mat5_8c_af8a259573b7b3a89555c5a9bc1860e19}{ReadData5}(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,\textcolor{keywordtype}{void} *data,
04601     \textcolor{keywordtype}{int} *start,\textcolor{keywordtype}{int} *stride,\textcolor{keywordtype}{int} *edge)
04602 \{
04603     \textcolor{keywordtype}{int} err = 0,real\_bytes = 0;
04604     mat\_int32\_t tag[2];
04605 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
04606     \hyperlink{structz__stream__s}{z\_stream} z;
04607 \textcolor{preprocessor}{#endif}
04608     \textcolor{keywordtype}{size\_t} bytesread = 0;
04609 
04610     (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
04611     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a2280b97631ff5dd24dec55261dc587b6}{MAT\_COMPRESSION\_NONE} ) \{
04612         bytesread += fread(tag,4,2,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
04613         \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
04614             \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag);
04615             \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag+1);
04616         \}
04617         matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{mat5_8c_a82bacecc4afc633b61bc3dc8ef88d1ed}{TYPE\_FROM\_TAG}(tag[0]);
04618         \textcolor{keywordflow}{if} ( tag[0] & 0xffff0000 ) \{ \textcolor{comment}{/* Data is packed in the tag */}
04619             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},-4,SEEK\_CUR);
04620             real\_bytes = 4+(tag[0] >> 16);
04621         \} \textcolor{keywordflow}{else} \{
04622             real\_bytes = 8+tag[1];
04623         \}
04624 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
04625     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a5181d2f71eab0f12f05ba65d4f13fb53}{MAT\_COMPRESSION\_ZLIB} ) \{
04626         \textcolor{keywordflow}{if} ( NULL != matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->data ) \{
04627             \textcolor{comment}{/* Data already read in ReadNextStructField or ReadNextCell */}
04628             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
04629                 \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t} *ci, *co;
04630 
04631                 co = (\hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t}*)data;
04632                 ci = (\hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t}*)matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->data;
04633                 err = GetDataSlab(ci->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re}, co->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re}, matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},
04634                     matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type}, matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}, start, stride, edge,
04635                     matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}, matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes});
04636                 \textcolor{keywordflow}{if} ( err == 0 )
04637                     err = GetDataSlab(ci->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im}, co->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im}, matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},
04638                         matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type}, matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}, start, stride, edge,
04639                         matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}, matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes});
04640                 \textcolor{keywordflow}{return} err;
04641             \} \textcolor{keywordflow}{else} \{
04642                 \textcolor{keywordflow}{return} GetDataSlab(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->data, data, matvar->
      \hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},
04643                     matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type}, matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}, start, stride, edge,
04644                     matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}, matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes});
04645             \}
04646         \}
04647 
04648         err = inflateCopy(&z,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z);
04649         \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
04650             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"inflateCopy returned error %s"},zError(err));
04651             \textcolor{keywordflow}{return} -1;
04652         \}
04653         z.avail\_in = 0;
04654         InflateDataType(mat,&z,tag);
04655         \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
04656             \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag);
04657         \}
04658         matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{mat5_8c_a82bacecc4afc633b61bc3dc8ef88d1ed}{TYPE\_FROM\_TAG}(tag[0]);
04659         \textcolor{keywordflow}{if} ( !(tag[0] & 0xffff0000) ) \{\textcolor{comment}{/* Data is NOT packed in the tag */}
04660             \textcolor{comment}{/* We're cheating, but InflateDataType just inflates 4 bytes */}
04661             InflateDataType(mat,&z,tag+1);
04662             \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
04663                 \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag+1);
04664             \}
04665             real\_bytes = 8+tag[1];
04666         \} \textcolor{keywordflow}{else} \{
04667             real\_bytes = 4+(tag[0] >> 16);
04668         \}
04669 \textcolor{preprocessor}{#endif}
04670     \}
04671     \textcolor{keywordflow}{if} ( real\_bytes % 8 )
04672         real\_bytes += (8-(real\_bytes % 8));
04673 
04674     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} == 2 ) \{
04675         \textcolor{keywordflow}{if} ( stride[0]*(edge[0]-1)+start[0]+1 > matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0] )
04676             err = 1;
04677         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( stride[1]*(edge[1]-1)+start[1]+1 > matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[1] )
04678             err = 1;
04679         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a2280b97631ff5dd24dec55261dc587b6}{MAT\_COMPRESSION\_NONE} ) \{
04680             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
04681                 \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t} *complex\_data = (
      \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t}*)data;
04682 
04683                 ReadDataSlab2(mat,complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},
04684                     matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims},start,stride,edge);
04685                 (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos}+real\_bytes,SEEK\_SET);
04686                 bytesread += fread(tag,4,2,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
04687                 \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
04688                     \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag);
04689                     \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag+1);
04690                 \}
04691                 matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{mat5_8c_a82bacecc4afc633b61bc3dc8ef88d1ed}{TYPE\_FROM\_TAG}(tag[0]);
04692                 \textcolor{keywordflow}{if} ( tag[0] & 0xffff0000 ) \{ \textcolor{comment}{/* Data is packed in the tag */}
04693                     (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},-4,SEEK\_CUR);
04694                 \}
04695                 ReadDataSlab2(mat,complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},
04696                               matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims},start,stride,edge);
04697             \} \textcolor{keywordflow}{else} \{
04698                 ReadDataSlab2(mat,data,matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},
04699                     matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims},start,stride,edge);
04700             \}
04701         \}
04702 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
04703         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a5181d2f71eab0f12f05ba65d4f13fb53}{MAT\_COMPRESSION\_ZLIB} ) \{
04704             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
04705                 \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t} *complex\_data = (
      \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t}*)data;
04706 
04707                 ReadCompressedDataSlab2(mat,&z,complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},
04708                     matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},matvar->
      \hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims},
04709                     start,stride,edge);
04710 
04711                 (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
04712 
04713                 \textcolor{comment}{/* Reset zlib knowledge to before reading real tag */}
04714                 inflateEnd(&z);
04715                 err = inflateCopy(&z,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z);
04716                 \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
04717                     \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"inflateCopy returned error %s"},zError(err));
04718                 \}
04719                 InflateSkip(mat,&z,real\_bytes);
04720                 z.avail\_in = 0;
04721                 InflateDataType(mat,&z,tag);
04722                 \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
04723                     \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag);
04724                 \}
04725                 matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{mat5_8c_a82bacecc4afc633b61bc3dc8ef88d1ed}{TYPE\_FROM\_TAG}(tag[0]);
04726                 \textcolor{keywordflow}{if} ( !(tag[0] & 0xffff0000) ) \{\textcolor{comment}{/*Data is NOT packed in the tag*/}
04727                     InflateSkip(mat,&z,4);
04728                 \}
04729                 ReadCompressedDataSlab2(mat,&z,complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},
04730                     matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},matvar->
      \hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims},
04731                     start,stride,edge);
04732             \} \textcolor{keywordflow}{else} \{
04733                 ReadCompressedDataSlab2(mat,&z,data,matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},
04734                     matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims},start,stride,edge);
04735             \}
04736             inflateEnd(&z);
04737         \}
04738 \textcolor{preprocessor}{#endif}
04739     \} \textcolor{keywordflow}{else} \{
04740         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a2280b97631ff5dd24dec55261dc587b6}{MAT\_COMPRESSION\_NONE} ) \{
04741             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
04742                 \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t} *complex\_data = (
      \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t}*)data;
04743 
04744                 ReadDataSlabN(mat,complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},
04745                     matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank},matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims},
04746                     start,stride,edge);
04747 
04748                 (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos}+real\_bytes,SEEK\_SET);
04749                 bytesread += fread(tag,4,2,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
04750                 \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
04751                     \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag);
04752                     \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag+1);
04753                 \}
04754                 matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{mat5_8c_a82bacecc4afc633b61bc3dc8ef88d1ed}{TYPE\_FROM\_TAG}(tag[0]);
04755                 \textcolor{keywordflow}{if} ( tag[0] & 0xffff0000 ) \{ \textcolor{comment}{/* Data is packed in the tag */}
04756                     (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},-4,SEEK\_CUR);
04757                 \}
04758                 ReadDataSlabN(mat,complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},
04759                     matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank},matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims},
04760                     start,stride,edge);
04761             \} \textcolor{keywordflow}{else} \{
04762                 ReadDataSlabN(mat,data,matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},matvar->
      \hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},
04763                     matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank},matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims},start,stride,edge);
04764             \}
04765         \}
04766 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
04767         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a5181d2f71eab0f12f05ba65d4f13fb53}{MAT\_COMPRESSION\_ZLIB} ) \{
04768             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
04769                 \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t} *complex\_data = (
      \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t}*)data;
04770 
04771                 ReadCompressedDataSlabN(mat,&z,complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},
04772                     matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},matvar->
      \hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank},
04773                     matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims},start,stride,edge);
04774 
04775                 (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
04776                 \textcolor{comment}{/* Reset zlib knowledge to before reading real tag */}
04777                 inflateEnd(&z);
04778                 err = inflateCopy(&z,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z);
04779                 \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
04780                     \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"inflateCopy returned error %s"},zError(err));
04781                 \}
04782                 InflateSkip(mat,&z,real\_bytes);
04783                 z.avail\_in = 0;
04784                 InflateDataType(mat,&z,tag);
04785                 \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
04786                     \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag);
04787                 \}
04788                 matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = \hyperlink{mat5_8c_a82bacecc4afc633b61bc3dc8ef88d1ed}{TYPE\_FROM\_TAG}(tag[0]);
04789                 \textcolor{keywordflow}{if} ( !(tag[0] & 0xffff0000) ) \{\textcolor{comment}{/*Data is NOT packed in the tag*/}
04790                     InflateSkip(mat,&z,4);
04791                 \}
04792                 ReadCompressedDataSlabN(mat,&z,complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},
04793                     matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},matvar->
      \hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank},
04794                     matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims},start,stride,edge);
04795             \} \textcolor{keywordflow}{else} \{
04796                 ReadCompressedDataSlabN(mat,&z,data,matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},
04797                     matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank},matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims},
04798                     start,stride,edge);
04799             \}
04800             inflateEnd(&z);
04801         \}
04802 \textcolor{preprocessor}{#endif}
04803     \}
04804     \textcolor{keywordflow}{if} ( err )
04805         \textcolor{keywordflow}{return} err;
04806 
04807     matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = ClassType2DataType(matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type});
04808     matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \hyperlink{group___m_a_t_ga2bf682f015b22fa796a8885e997661e7}{Mat\_SizeOfClass}(matvar->
      \hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type});
04809 
04810     \textcolor{keywordflow}{return} err;
04811 \}
04812 
04826 \textcolor{keywordtype}{int}
\Hypertarget{mat5_8c_source_l04827}\hyperlink{group___m_a_t_ga9c81a102772919ad4841c37e4907e712}{04827} \hyperlink{group___m_a_t_ga9c81a102772919ad4841c37e4907e712}{Mat\_VarReadDataLinear5}(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,\textcolor{keywordtype}{void} *data,\textcolor{keywordtype}{int} start,
04828                       \textcolor{keywordtype}{int} stride,\textcolor{keywordtype}{int} edge)
04829 \{
04830     \textcolor{keywordtype}{int} err = 0, nmemb = 1, i, real\_bytes = 0;
04831     mat\_int32\_t tag[2];
04832 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
04833     \hyperlink{structz__stream__s}{z\_stream} z;
04834 \textcolor{preprocessor}{#endif}
04835     \textcolor{keywordtype}{size\_t} bytesread = 0;
04836 
04837     \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a729c2bc0afc97485057a5af425635b1a}{version} == \hyperlink{group___m_a_t_ggad03442b8378999189d510e3745c702b7a858b4f5da65548219b1c3ad47aa478d3}{MAT\_FT\_MAT4} )
04838         \textcolor{keywordflow}{return} -1;
04839     (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
04840     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a2280b97631ff5dd24dec55261dc587b6}{MAT\_COMPRESSION\_NONE} ) \{
04841         bytesread += fread(tag,4,2,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
04842         \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
04843             \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag);
04844             \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag+1);
04845         \}
04846         matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = (\textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types})(tag[0] & 0x000000ff);
04847         \textcolor{keywordflow}{if} ( tag[0] & 0xffff0000 ) \{ \textcolor{comment}{/* Data is packed in the tag */}
04848             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},-4,SEEK\_CUR);
04849             real\_bytes = 4+(tag[0] >> 16);
04850         \} \textcolor{keywordflow}{else} \{
04851             real\_bytes = 8+tag[1];
04852         \}
04853 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
04854     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a5181d2f71eab0f12f05ba65d4f13fb53}{MAT\_COMPRESSION\_ZLIB} ) \{
04855         \textcolor{keywordflow}{if} ( NULL != matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->data ) \{
04856             \textcolor{comment}{/* Data already read in ReadNextStructField or ReadNextCell */}
04857             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
04858                 \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t} *ci, *co;
04859 
04860                 co = (\hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t}*)data;
04861                 ci = (\hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t}*)matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->data;
04862                 err = GetDataLinear(ci->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re}, co->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re}, matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},
04863                     matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type}, start, stride, edge);
04864                 \textcolor{keywordflow}{if} ( err == 0 )
04865                     err = GetDataLinear(ci->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im}, co->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im}, matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},
04866                         matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type}, start, stride, edge);
04867                 \textcolor{keywordflow}{return} err;
04868             \} \textcolor{keywordflow}{else} \{
04869                 \textcolor{keywordflow}{return} GetDataLinear(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->data, data, matvar->
      \hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},
04870                     matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type}, start, stride, edge);
04871             \}
04872         \}
04873 
04874         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 0;
04875         err = inflateCopy(&z,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z);
04876         \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
04877             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"inflateCopy returned error %s"},zError(err));
04878             \textcolor{keywordflow}{return} -1;
04879         \}
04880         InflateDataType(mat,&z,tag);
04881         \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
04882             \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag);
04883             \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag+1);
04884         \}
04885         matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = (\textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types})(tag[0] & 0x000000ff);
04886         \textcolor{keywordflow}{if} ( !(tag[0] & 0xffff0000) ) \{\textcolor{comment}{/* Data is NOT packed in the tag */}
04887             \textcolor{comment}{/* We're cheating, but InflateDataType just inflates 4 bytes */}
04888             InflateDataType(mat,&z,tag+1);
04889             \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
04890                 \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag+1);
04891             \}
04892             real\_bytes = 8+tag[1];
04893         \} \textcolor{keywordflow}{else} \{
04894             real\_bytes = 4+(tag[0] >> 16);
04895         \}
04896 \textcolor{preprocessor}{#endif}
04897     \}
04898     \textcolor{keywordflow}{if} ( real\_bytes % 8 )
04899         real\_bytes += (8-(real\_bytes % 8));
04900 
04901     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
04902         nmemb *= matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
04903 
04904     if ( stride*(edge-1)+start+1 > nmemb ) \{
04905         err = 1;
04906     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a2280b97631ff5dd24dec55261dc587b6}{MAT\_COMPRESSION\_NONE} ) \{
04907         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
04908             \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t} *complex\_data = (
      \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t}*)data;
04909 
04910             ReadDataSlab1(mat,complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},
04911                           matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},start,stride,edge);
04912             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos}+real\_bytes,SEEK\_SET);
04913             bytesread += fread(tag,4,2,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
04914             \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
04915                 \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag);
04916                 \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag+1);
04917             \}
04918             matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = (\textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types})(tag[0] & 0x000000ff);
04919             \textcolor{keywordflow}{if} ( tag[0] & 0xffff0000 ) \{ \textcolor{comment}{/* Data is packed in the tag */}
04920                 (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},-4,SEEK\_CUR);
04921             \}
04922             ReadDataSlab1(mat,complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},
04923                           matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},start,stride,edge);
04924         \} \textcolor{keywordflow}{else} \{
04925             ReadDataSlab1(mat,data,matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},
04926                           matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},start,stride,edge);
04927         \}
04928 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
04929     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a5181d2f71eab0f12f05ba65d4f13fb53}{MAT\_COMPRESSION\_ZLIB} ) \{
04930         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
04931             \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t} *complex\_data = (
      \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t}*)data;
04932 
04933             ReadCompressedDataSlab1(mat,&z,complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re},
04934                 matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},start,stride,edge);
04935 
04936             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos},SEEK\_SET);
04937 
04938             \textcolor{comment}{/* Reset zlib knowledge to before reading real tag */}
04939             inflateEnd(&z);
04940             err = inflateCopy(&z,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z);
04941             \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
04942                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"inflateCopy returned error %s"},zError(err));
04943             \}
04944             InflateSkip(mat,&z,real\_bytes);
04945             z.avail\_in = 0;
04946             InflateDataType(mat,&z,tag);
04947             \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
04948                 \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag);
04949             \}
04950             matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = (\textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types})(tag[0] & 0x000000ff);
04951             \textcolor{keywordflow}{if} ( !(tag[0] & 0xffff0000) ) \{\textcolor{comment}{/*Data is NOT packed in the tag*/}
04952                 InflateSkip(mat,&z,4);
04953             \}
04954             ReadCompressedDataSlab1(mat,&z,complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im},
04955                 matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},start,stride,edge);
04956         \} \textcolor{keywordflow}{else} \{
04957             ReadCompressedDataSlab1(mat,&z,data,matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type},
04958                 matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},start,stride,edge);
04959         \}
04960         inflateEnd(&z);
04961 \textcolor{preprocessor}{#endif}
04962     \}
04963 
04964     matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type} = ClassType2DataType(matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type});
04965     matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \hyperlink{group___m_a_t_ga2bf682f015b22fa796a8885e997661e7}{Mat\_SizeOfClass}(matvar->
      \hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type});
04966 
04967     \textcolor{keywordflow}{return} err;
04968 \}
04969 
04981 \textcolor{keywordtype}{int}
\Hypertarget{mat5_8c_source_l04982}\hyperlink{mat5_8c_a4d546a62c4b429d9b94fe873015e6a24}{04982} \hyperlink{mat5_8c_a4d546a62c4b429d9b94fe873015e6a24}{Mat\_VarWrite5}(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,\textcolor{keywordtype}{int} compress)
04983 \{
04984     mat\_uint32\_t array\_flags = 0x0;
04985     \textcolor{keywordtype}{int} array\_flags\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32}, dims\_array\_type = 
      \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32};
04986     \textcolor{keywordtype}{int} array\_flags\_size = 8, pad4 = 0, matrix\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a32985fee89a4df8db4b3f5d3a48823d3}{MAT\_T\_MATRIX};
04987     \textcolor{keywordtype}{int} nBytes, i, nmemb = 1,nzmax = 0;
04988     \textcolor{keywordtype}{long} start = 0, end = 0;
04989 
04990     \textcolor{keywordflow}{if} ( NULL == mat )
04991         \textcolor{keywordflow}{return} -1;
04992 
04993     \textcolor{comment}{/* FIXME: SEEK\_END is not Guaranteed by the C standard */}
04994     (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},0,SEEK\_END);         \textcolor{comment}{/* Always write at end of file */}
04995 
04996     \textcolor{keywordflow}{if} ( NULL == matvar || NULL == matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} )
04997         \textcolor{keywordflow}{return} -1;
04998 
04999 \textcolor{preprocessor}{#if !defined(HAVE\_ZLIB)}
05000     compress = \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a2280b97631ff5dd24dec55261dc587b6}{MAT\_COMPRESSION\_NONE};
05001 \textcolor{preprocessor}{#endif}
05002 
05003     \textcolor{keywordflow}{if} ( compress == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a2280b97631ff5dd24dec55261dc587b6}{MAT\_COMPRESSION\_NONE} ) \{
05004         fwrite(&matrix\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05005         fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05006         start = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05007 
05008         \textcolor{comment}{/* Array Flags */}
05009         array\_flags = matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} & \hyperlink{mat5_8c_a24b94e17e9c34b9c795798099c710751}{CLASS\_TYPE\_MASK};
05010         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} )
05011             array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbbacd7b091a11184aad7fc6078c04470780}{MAT\_F\_COMPLEX};
05012         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_af26c71c4c0ddb14931d15910dddac1bc}{isGlobal} )
05013             array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba49084e0c796aa7963e53f7539525d40d}{MAT\_F\_GLOBAL};
05014         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a866c1539e68073a837833d74cd4a65be}{isLogical} )
05015             array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba57eb5c6e200bcbc0f1b7982f29a169c2}{MAT\_F\_LOGICAL};
05016         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a0d5655b7e6178a2242cb3bb56ff4c8d2}{MAT\_C\_SPARSE} )
05017             nzmax = ((\hyperlink{group___m_a_t_structmat__sparse__t}{mat\_sparse\_t} *)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data})->nzmax;
05018 
05019         fwrite(&array\_flags\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05020         fwrite(&array\_flags\_size,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05021         fwrite(&array\_flags,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05022         fwrite(&nzmax,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05023         \textcolor{comment}{/* Rank and Dimension */}
05024         nBytes = matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} * 4;
05025         fwrite(&dims\_array\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05026         fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05027         \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ ) \{
05028             mat\_int32\_t dim;
05029             dim = matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
05030             nmemb *= dim;
05031             fwrite(&dim,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05032         \}
05033         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} % 2 != 0 )
05034             fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05035         \textcolor{comment}{/* Name of variable */}
05036         \textcolor{keywordflow}{if} ( strlen(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name}) <= 4 ) \{
05037             mat\_int32\_t  array\_name\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8};
05038             mat\_int32\_t array\_name\_len   = strlen(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
05039             mat\_int8\_t  pad1 = 0;
05040 \textcolor{preprocessor}{#if 0}
05041             fwrite(&array\_name\_type,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05042             fwrite(&array\_name\_len,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05043 \textcolor{preprocessor}{#else}
05044             array\_name\_type = (array\_name\_len << 16) | array\_name\_type;
05045             fwrite(&array\_name\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05046 \textcolor{preprocessor}{#endif}
05047             fwrite(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},1,array\_name\_len,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05048             \textcolor{keywordflow}{for} ( i = array\_name\_len; i < 4; i++ )
05049                 fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05050         \} \textcolor{keywordflow}{else} \{
05051             mat\_int32\_t array\_name\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8};
05052             mat\_int32\_t array\_name\_len  = (mat\_int32\_t)strlen(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
05053             mat\_int8\_t  pad1 = 0;
05054 
05055             fwrite(&array\_name\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05056             fwrite(&array\_name\_len,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05057             fwrite(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},1,array\_name\_len,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05058             \textcolor{keywordflow}{if} ( array\_name\_len % 8 )
05059                 \textcolor{keywordflow}{for} ( i = array\_name\_len % 8; i < 8; i++ )
05060                     fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05061         \}
05062 
05063         \textcolor{keywordflow}{if} ( NULL != matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal} ) \{
05064             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05065             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} == -1L ) \{
05066                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
05067             \}
05068         \} \textcolor{keywordflow}{else} \{
05069             \textcolor{comment}{/* Must be empty */}
05070             matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} = \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5c76eef0ca0373d25abe49053be6fa9a}{MAT\_C\_EMPTY};
05071         \}
05072         WriteType(mat,matvar);
05073 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
05074     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( compress == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a5181d2f71eab0f12f05ba65d4f13fb53}{MAT\_COMPRESSION\_ZLIB} ) \{
05075         mat\_uint32\_t comp\_buf[512];
05076         mat\_uint32\_t uncomp\_buf[512] = \{0,\};
05077         \textcolor{keywordtype}{int} buf\_size = 512, err;
05078         \textcolor{keywordtype}{size\_t} byteswritten = 0;
05079         z\_streamp z;
05080 
05081         z = (z\_streamp)calloc(1,\textcolor{keyword}{sizeof}(*z));
05082         \textcolor{keywordflow}{if} ( z == NULL )
05083             \textcolor{keywordflow}{return} -1;
05084         err = deflateInit(z,Z\_DEFAULT\_COMPRESSION);
05085         \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
05086             free(z);
05087             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"deflateInit returned %s"},zError(err));
05088             \textcolor{keywordflow}{return} -1;
05089         \}
05090 
05091         matrix\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a30437f2eb3becc2fa6e5d96599d7f724}{MAT\_T\_COMPRESSED};
05092         fwrite(&matrix\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05093         fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05094         start = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05095 
05096         \textcolor{comment}{/* Array Flags */}
05097         array\_flags = matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} & \hyperlink{mat5_8c_a24b94e17e9c34b9c795798099c710751}{CLASS\_TYPE\_MASK};
05098         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} )
05099             array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbbacd7b091a11184aad7fc6078c04470780}{MAT\_F\_COMPLEX};
05100         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_af26c71c4c0ddb14931d15910dddac1bc}{isGlobal} )
05101             array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba49084e0c796aa7963e53f7539525d40d}{MAT\_F\_GLOBAL};
05102         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a866c1539e68073a837833d74cd4a65be}{isLogical} )
05103             array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba57eb5c6e200bcbc0f1b7982f29a169c2}{MAT\_F\_LOGICAL};
05104         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a0d5655b7e6178a2242cb3bb56ff4c8d2}{MAT\_C\_SPARSE} )
05105             nzmax = ((\hyperlink{group___m_a_t_structmat__sparse__t}{mat\_sparse\_t} *)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data})->nzmax;
05106 
05107         uncomp\_buf[0] = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a32985fee89a4df8db4b3f5d3a48823d3}{MAT\_T\_MATRIX};
05108         uncomp\_buf[1] = (int)GetMatrixMaxBufSize(matvar);
05109         z->next\_in  = ZLIB\_BYTE\_PTR(uncomp\_buf);
05110         z->avail\_in = 8;
05111         \textcolor{keywordflow}{do} \{
05112             z->next\_out  = ZLIB\_BYTE\_PTR(comp\_buf);
05113             z->avail\_out = buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf);
05114             deflate(z,Z\_NO\_FLUSH);
05115             byteswritten += fwrite(comp\_buf,1,
05116                 buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf)-z->avail\_out,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05117         \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
05118         uncomp\_buf[0] = array\_flags\_type;
05119         uncomp\_buf[1] = array\_flags\_size;
05120         uncomp\_buf[2] = array\_flags;
05121         uncomp\_buf[3] = nzmax;
05122         \textcolor{comment}{/* Rank and Dimension */}
05123         nBytes = matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} * 4;
05124         uncomp\_buf[4] = dims\_array\_type;
05125         uncomp\_buf[5] = nBytes;
05126         \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ ) \{
05127             mat\_int32\_t dim;
05128             dim = matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
05129             nmemb *= dim;
05130             uncomp\_buf[6+i] = dim;
05131         \}
05132         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} % 2 != 0 ) \{
05133             uncomp\_buf[6+i] = pad4;
05134             i++;
05135         \}
05136 
05137         z->next\_in  = ZLIB\_BYTE\_PTR(uncomp\_buf);
05138         z->avail\_in = (6+i)*\textcolor{keyword}{sizeof}(*uncomp\_buf);
05139         \textcolor{keywordflow}{do} \{
05140             z->next\_out  = ZLIB\_BYTE\_PTR(comp\_buf);
05141             z->avail\_out = buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf);
05142             deflate(z,Z\_NO\_FLUSH);
05143             byteswritten += fwrite(comp\_buf,1,
05144                 buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf)-z->avail\_out,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05145         \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
05146         \textcolor{comment}{/* Name of variable */}
05147         \textcolor{keywordflow}{if} ( strlen(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name}) <= 4 ) \{
05148             mat\_int16\_t array\_name\_len = (mat\_int16\_t)strlen(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
05149             mat\_int16\_t array\_name\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8};
05150 
05151             memset(uncomp\_buf,0,8);
05152             uncomp\_buf[0] = (array\_name\_len << 16) | array\_name\_type;
05153             memcpy(uncomp\_buf+1,matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},array\_name\_len);
05154             \textcolor{keywordflow}{if} ( array\_name\_len % 4 )
05155                 array\_name\_len += 4-(array\_name\_len % 4);
05156 
05157             z->next\_in  = ZLIB\_BYTE\_PTR(uncomp\_buf);
05158             z->avail\_in = 8;
05159             \textcolor{keywordflow}{do} \{
05160                 z->next\_out  = ZLIB\_BYTE\_PTR(comp\_buf);
05161                 z->avail\_out = buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf);
05162                 deflate(z,Z\_NO\_FLUSH);
05163                 byteswritten += fwrite(comp\_buf,1,
05164                     buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf)-z->avail\_out,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05165             \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
05166         \} \textcolor{keywordflow}{else} \{
05167             mat\_int32\_t array\_name\_len = (mat\_int32\_t)strlen(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
05168             mat\_int32\_t array\_name\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8};
05169 
05170             memset(uncomp\_buf,0,buf\_size*\textcolor{keyword}{sizeof}(*uncomp\_buf));
05171             uncomp\_buf[0] = array\_name\_type;
05172             uncomp\_buf[1] = array\_name\_len;
05173             memcpy(uncomp\_buf+2,matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},array\_name\_len);
05174             \textcolor{keywordflow}{if} ( array\_name\_len % 8 )
05175                 array\_name\_len += 8-(array\_name\_len % 8);
05176             z->next\_in  = ZLIB\_BYTE\_PTR(uncomp\_buf);
05177             z->avail\_in = 8+array\_name\_len;
05178             \textcolor{keywordflow}{do} \{
05179                 z->next\_out  = ZLIB\_BYTE\_PTR(comp\_buf);
05180                 z->avail\_out = buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf);
05181                 deflate(z,Z\_NO\_FLUSH);
05182                 byteswritten += fwrite(comp\_buf,1,
05183                     buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf)-z->avail\_out,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05184             \} \textcolor{keywordflow}{while} ( z->avail\_out == 0 );
05185         \}
05186         \textcolor{keywordflow}{if} ( NULL != matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal} ) \{
05187             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05188             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} == -1L ) \{
05189                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
05190             \}
05191         \} \textcolor{keywordflow}{else} \{
05192             \textcolor{comment}{/* Must be empty */}
05193             matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} = \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5c76eef0ca0373d25abe49053be6fa9a}{MAT\_C\_EMPTY};
05194         \}
05195         WriteCompressedType(mat,matvar,z);
05196         z->next\_in  = NULL;
05197         z->avail\_in = 0;
05198         \textcolor{keywordflow}{do} \{
05199             z->next\_out  = ZLIB\_BYTE\_PTR(comp\_buf);
05200             z->avail\_out = buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf);
05201             err = deflate(z,Z\_FINISH);
05202             byteswritten += fwrite(comp\_buf,1,
05203                 buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf)-z->avail\_out,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05204         \} \textcolor{keywordflow}{while} ( err != Z\_STREAM\_END && z->avail\_out == 0 );
05205 \textcolor{preprocessor}{#if 0}
05206         \textcolor{keywordflow}{if} ( byteswritten % 8 )
05207             \textcolor{keywordflow}{for} ( i = 0; i < 8-(byteswritten % 8); i++ )
05208                 fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05209 \textcolor{preprocessor}{#endif}
05210         (void)deflateEnd(z);
05211         free(z);
05212 \textcolor{preprocessor}{#endif}
05213     \}
05214     end = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05215     \textcolor{keywordflow}{if} ( start != -1L && end != -1L ) \{
05216         nBytes = (int)(end-start);
05217         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},(long)-(nBytes+4),SEEK\_CUR);
05218         fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05219         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},end,SEEK\_SET);
05220     \} \textcolor{keywordflow}{else} \{
05221         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
05222     \}
05223 
05224     \textcolor{keywordflow}{return} 0;
05225 \}
05226 
05235 \textcolor{keywordtype}{void}
\Hypertarget{mat5_8c_source_l05236}\hyperlink{mat5_8c_a80e4ba45ec110d05657f8f39ffd9ee27}{05236} \hyperlink{mat5_8c_a80e4ba45ec110d05657f8f39ffd9ee27}{WriteInfo5}(\hyperlink{struct__mat__t}{mat\_t} *mat, \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar)
05237 \{
05238     mat\_uint32\_t array\_flags = 0x0;
05239     mat\_int8\_t pad1 = 0;
05240     \textcolor{keywordtype}{int} array\_flags\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32}, dims\_array\_type = 
      \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32};
05241     \textcolor{keywordtype}{int} array\_flags\_size = 8, pad4 = 0, matrix\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a32985fee89a4df8db4b3f5d3a48823d3}{MAT\_T\_MATRIX};
05242     \textcolor{keywordtype}{int} nBytes, nmemb = 1,nzmax = 0;
05243     \textcolor{keywordtype}{long} start = 0, end = 0;
05244 
05245     \textcolor{comment}{/* FIXME: SEEK\_END is not Guaranteed by the C standard */}
05246     (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},0,SEEK\_END);         \textcolor{comment}{/* Always write at end of file */}
05247 
05248     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a2280b97631ff5dd24dec55261dc587b6}{MAT\_COMPRESSION\_NONE} ) \{
05249         \textcolor{keywordtype}{int} i;
05250         fwrite(&matrix\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05251         fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05252         start = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05253 
05254         \textcolor{comment}{/* Array Flags */}
05255         array\_flags = matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} & \hyperlink{mat5_8c_a24b94e17e9c34b9c795798099c710751}{CLASS\_TYPE\_MASK};
05256         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} )
05257             array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbbacd7b091a11184aad7fc6078c04470780}{MAT\_F\_COMPLEX};
05258         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_af26c71c4c0ddb14931d15910dddac1bc}{isGlobal} )
05259             array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba49084e0c796aa7963e53f7539525d40d}{MAT\_F\_GLOBAL};
05260         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a866c1539e68073a837833d74cd4a65be}{isLogical} )
05261             array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba57eb5c6e200bcbc0f1b7982f29a169c2}{MAT\_F\_LOGICAL};
05262         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a0d5655b7e6178a2242cb3bb56ff4c8d2}{MAT\_C\_SPARSE} )
05263             nzmax = ((\hyperlink{group___m_a_t_structmat__sparse__t}{mat\_sparse\_t} *)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data})->nzmax;
05264 
05265         fwrite(&array\_flags\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05266         fwrite(&array\_flags\_size,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05267         fwrite(&array\_flags,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05268         fwrite(&nzmax,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05269         \textcolor{comment}{/* Rank and Dimension */}
05270         nBytes = matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} * 4;
05271         fwrite(&dims\_array\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05272         fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05273         \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ ) \{
05274             mat\_int32\_t dim;
05275             dim = matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
05276             nmemb *= dim;
05277             fwrite(&dim,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05278         \}
05279         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} % 2 != 0 )
05280             fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05281         \textcolor{comment}{/* Name of variable */}
05282         \textcolor{keywordflow}{if} ( strlen(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name}) <= 4 ) \{
05283             mat\_int16\_t array\_name\_len = (mat\_int16\_t)strlen(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
05284             mat\_int8\_t  pad1 = 0;
05285             mat\_int16\_t array\_name\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8};
05286             fwrite(&array\_name\_type,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05287             fwrite(&array\_name\_len,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05288             fwrite(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},1,array\_name\_len,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05289             \textcolor{keywordflow}{for} ( i = array\_name\_len; i < 4; i++ )
05290                 fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05291         \} \textcolor{keywordflow}{else} \{
05292             mat\_int32\_t array\_name\_len = (mat\_int32\_t)strlen(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
05293             mat\_int8\_t  pad1 = 0;
05294             mat\_int32\_t array\_name\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8};
05295 
05296             fwrite(&array\_name\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05297             fwrite(&array\_name\_len,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05298             fwrite(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},1,array\_name\_len,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05299             \textcolor{keywordflow}{if} ( array\_name\_len % 8 )
05300                 \textcolor{keywordflow}{for} ( i = array\_name\_len % 8; i < 8; i++ )
05301                     fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05302         \}
05303 
05304         \textcolor{keywordflow}{if} ( NULL != matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal} ) \{
05305             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05306             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} == -1L ) \{
05307                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
05308             \}
05309         \} \textcolor{keywordflow}{else} \{
05310             \textcolor{comment}{/* Must be empty */}
05311             matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} = \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5c76eef0ca0373d25abe49053be6fa9a}{MAT\_C\_EMPTY};
05312         \}
05313         \textcolor{keywordflow}{switch} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} ) \{
05314             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5d70e0862e5bdb7bd86bf7ba5948f307}{MAT\_C\_DOUBLE}:
05315             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2825631e26a961cbe0f79db50a39cea2}{MAT\_C\_SINGLE}:
05316             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a1ea83bcde49b35477494412973f82409}{MAT\_C\_INT64}:
05317             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a86470e25c3763d9a24623f04326195dd}{MAT\_C\_UINT64}:
05318             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40adb44fc39694e3152ae5e69470a2fefe8}{MAT\_C\_INT32}:
05319             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a9a17a7edd45b19ef68197db81b27e816}{MAT\_C\_UINT32}:
05320             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a40370e9de516c5036a67a5865c071006}{MAT\_C\_INT16}:
05321             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a8bede21dbf6c1edc0bbccc1481bccae7}{MAT\_C\_UINT16}:
05322             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a984ff310f9e906100fcff95f704f43c5}{MAT\_C\_INT8}:
05323             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a81270f8093cb4808e992c1d29d84d4e3}{MAT\_C\_UINT8}:
05324                 nBytes = WriteEmptyData(mat,nmemb,matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
05325                 \textcolor{keywordflow}{if} ( nBytes % 8 )
05326                     \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
05327                         fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05328                 \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
05329                     nBytes = WriteEmptyData(mat,nmemb,matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
05330                     \textcolor{keywordflow}{if} ( nBytes % 8 )
05331                         \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
05332                             fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05333                 \}
05334                 \textcolor{keywordflow}{break};
05335             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40aacdec5834df0861130b393697646119c}{MAT\_C\_CHAR}:
05336             \{
05337                 WriteEmptyCharData(mat,nmemb,matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
05338                 \textcolor{keywordflow}{break};
05339             \}
05340             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2f7abb47a1c51e248bd4e5e03cc81b08}{MAT\_C\_CELL}:
05341             \{
05342                 \textcolor{keywordtype}{int}        ncells;
05343                 \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **cells = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
05344 
05345                 \textcolor{comment}{/* Check for an empty cell array */}
05346                 if ( matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} == 0 || matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} == 0 ||
05347                      matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data}   == NULL )
05348                     \textcolor{keywordflow}{break};
05349                 ncells = matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} / matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size};
05350 
05351                 \textcolor{keywordflow}{for} ( i = 0; i < ncells; i++ )
05352                     WriteCellArrayFieldInfo(mat,cells[i]);
05353                 \textcolor{keywordflow}{break};
05354             \}
05355             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT}:
05356             \{
05357                 \textcolor{keywordtype}{char} *padzero;
05358                 mat\_int16\_t fieldname\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32};
05359                 mat\_int16\_t fieldname\_data\_size = 4;
05360                 \textcolor{keywordtype}{int} maxlen = 0, fieldname\_size;
05361                 \textcolor{keywordtype}{int} nfields = matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields};
05362                 \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **fields = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
05363                 mat\_int32\_t array\_name\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8};
05364                 \textcolor{keywordtype}{unsigned} fieldname;
05365 
05366                 for ( i = 0; i < nfields; i++ ) \{
05367                     \textcolor{keywordtype}{size\_t} len = strlen(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i]);
05368                     \textcolor{keywordflow}{if} ( len > maxlen )
05369                         maxlen = len;
05370                 \}
05371                 maxlen++;
05372                 fieldname\_size = maxlen;
05373                 \textcolor{keywordflow}{while} ( nfields*fieldname\_size % 8 != 0 )
05374                     fieldname\_size++;
05375 \textcolor{preprocessor}{#if 0}
05376                 fwrite(&fieldname\_type,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05377                 fwrite(&fieldname\_data\_size,2,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05378 \textcolor{preprocessor}{#else}
05379                 fieldname = (fieldname\_data\_size<<16) | fieldname\_type;
05380                 fwrite(&fieldname,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05381 \textcolor{preprocessor}{#endif}
05382                 fwrite(&fieldname\_size,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05383                 fwrite(&array\_name\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05384                 nBytes = nfields*fieldname\_size;
05385                 fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05386                 padzero = (\textcolor{keywordtype}{char}*)calloc(fieldname\_size,1);
05387                 \textcolor{keywordflow}{for} ( i = 0; i < nfields; i++ ) \{
05388                     \textcolor{keywordtype}{size\_t} len = strlen(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i]);
05389                     fwrite(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i],1,len,(FILE*)mat->
      \hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05390                     fwrite(padzero,1,fieldname\_size-len,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05391                 \}
05392                 free(padzero);
05393                 \textcolor{keywordflow}{for} ( i = 0; i < nfields; i++ )
05394                     \hyperlink{mat5_8c_a80e4ba45ec110d05657f8f39ffd9ee27}{WriteInfo5}(mat,fields[i]);
05395                 \textcolor{keywordflow}{break};
05396             \}
05397             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a0d5655b7e6178a2242cb3bb56ff4c8d2}{MAT\_C\_SPARSE}:
05398             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5c76eef0ca0373d25abe49053be6fa9a}{MAT\_C\_EMPTY}:
05399             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40aaa9bf08312779cd1ab8e504a162ddcea}{MAT\_C\_FUNCTION}:
05400             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40afe45104b68b044c83a2f99e349fa1ea6}{MAT\_C\_OBJECT}:
05401             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40ad83c684d250e463c1a3779647695c0c9}{MAT\_C\_OPAQUE}:
05402                 \textcolor{keywordflow}{break};
05403         \}
05404     \textcolor{comment}{/* Does not work.}
05405 \textcolor{comment}{     * Can write empty data, but how to go back and add the real data?}
05406 \textcolor{comment}{     */}
05407 \textcolor{preprocessor}{#if 0}
05408     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} == \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a5181d2f71eab0f12f05ba65d4f13fb53}{MAT\_COMPRESSION\_ZLIB} ) \{
05409 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
05410         mat\_uint32\_t comp\_buf[512];
05411         mat\_uint32\_t uncomp\_buf[512] = \{0,\};
05412         \textcolor{keywordtype}{int} buf\_size = 512, err;
05413         \textcolor{keywordtype}{size\_t} byteswritten = 0;
05414 
05415         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z = (z\_streamp)calloc(1,\textcolor{keyword}{sizeof}(*matvar->
      \hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z));
05416         err = deflateInit(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_DEFAULT\_COMPRESSION);
05417         \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
05418             free(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z);
05419             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z = NULL;
05420             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"deflateInit returned %s"},zError(err));
05421             \textcolor{keywordflow}{return};
05422         \}
05423 
05424         matrix\_type = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a30437f2eb3becc2fa6e5d96599d7f724}{MAT\_T\_COMPRESSED};
05425         fwrite(&matrix\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05426         fwrite(&pad4,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05427         start = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05428 
05429         \textcolor{comment}{/* Array Flags */}
05430         array\_flags = matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} & MAT\_F\_CLASS\_T;
05431         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} )
05432             array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbbacd7b091a11184aad7fc6078c04470780}{MAT\_F\_COMPLEX};
05433         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_af26c71c4c0ddb14931d15910dddac1bc}{isGlobal} )
05434             array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba49084e0c796aa7963e53f7539525d40d}{MAT\_F\_GLOBAL};
05435         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a866c1539e68073a837833d74cd4a65be}{isLogical} )
05436             array\_flags |= \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba57eb5c6e200bcbc0f1b7982f29a169c2}{MAT\_F\_LOGICAL};
05437 
05438         uncomp\_buf[0] = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a32985fee89a4df8db4b3f5d3a48823d3}{MAT\_T\_MATRIX};
05439         uncomp\_buf[1] = 448;
05440         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in  = uncomp\_buf;
05441         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 8;
05442         \textcolor{keywordflow}{do} \{
05443             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_out  = comp\_buf;
05444             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out = buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf);
05445             deflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
05446             byteswritten += fwrite(comp\_buf,1,
05447                 buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf)-matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out,
05448                 (FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05449         \} \textcolor{keywordflow}{while} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out == 0 );
05450         uncomp\_buf[0] = array\_flags\_type;
05451         uncomp\_buf[1] = array\_flags\_size;
05452         uncomp\_buf[2] = array\_flags;
05453         uncomp\_buf[3] = 0;
05454         \textcolor{comment}{/* Rank and Dimension */}
05455         nBytes = matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} * 4;
05456         uncomp\_buf[4] = dims\_array\_type;
05457         uncomp\_buf[5] = nBytes;
05458         \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ ) \{
05459             mat\_int32\_t dim;
05460             dim = matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
05461             nmemb *= dim;
05462             uncomp\_buf[6+i] = dim;
05463         \}
05464         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} % 2 != 0 )
05465             uncomp\_buf[6+i] = pad4;
05466 
05467         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in  = uncomp\_buf;
05468         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = (6+i)*\textcolor{keyword}{sizeof}(*uncomp\_buf);
05469         \textcolor{keywordflow}{do} \{
05470             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_out  = comp\_buf;
05471             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out = buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf);
05472             deflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
05473             byteswritten += fwrite(comp\_buf,1,
05474                 buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf)-matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out,
05475                 (FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05476         \} \textcolor{keywordflow}{while} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out == 0 );
05477         \textcolor{comment}{/* Name of variable */}
05478         \textcolor{keywordflow}{if} ( strlen(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name}) <= 4 ) \{
05479 \textcolor{preprocessor}{#if 0}
05480             mat\_int16\_t array\_name\_len = (mat\_int16\_t)strlen(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
05481             mat\_int8\_t  pad1 = 0;
05482 
05483             uncomp\_buf[0] = (array\_name\_type << 16) | array\_name\_len;
05484             memcpy(uncomp\_buf+1,matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},array\_name\_len);
05485 
05486             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in  = uncomp\_buf;
05487             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 8;
05488             \textcolor{keywordflow}{do} \{
05489                 matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_out  = comp\_buf;
05490                 matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out = buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf);
05491                 deflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
05492                 byteswritten += fwrite(comp\_buf,1,
05493                     buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf)-matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out,
05494                     (FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05495             \} \textcolor{keywordflow}{while} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out == 0 );
05496         \} \textcolor{keywordflow}{else} \{
05497 \textcolor{preprocessor}{#endif}
05498             mat\_int32\_t array\_name\_len = (mat\_int32\_t)strlen(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
05499 
05500             memset(uncomp\_buf,0,buf\_size*\textcolor{keyword}{sizeof}(*uncomp\_buf));
05501             uncomp\_buf[0] = array\_name\_type;
05502             uncomp\_buf[1] = array\_name\_len;
05503             memcpy(uncomp\_buf+2,matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},array\_name\_len);
05504             \textcolor{keywordflow}{if} ( array\_name\_len % 8 )
05505                 array\_name\_len += array\_name\_len % 8;
05506             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in   = uncomp\_buf;
05507             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in  = 8+array\_name\_len;
05508             \textcolor{keywordflow}{do} \{
05509                 matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_out  = comp\_buf;
05510                 matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out = buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf);
05511                 deflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
05512                 byteswritten += fwrite(comp\_buf,1,
05513                     buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf)-matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out,(FILE*)mat->
      \hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05514             \} \textcolor{keywordflow}{while} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out == 0 );
05515         \}
05516         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05517         \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} == -1L ) \{
05518             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
05519         \}
05520         deflateCopy(&z\_save,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z);
05521         \textcolor{keywordflow}{switch} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} ) \{
05522             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5d70e0862e5bdb7bd86bf7ba5948f307}{MAT\_C\_DOUBLE}:
05523             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2825631e26a961cbe0f79db50a39cea2}{MAT\_C\_SINGLE}:
05524             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40adb44fc39694e3152ae5e69470a2fefe8}{MAT\_C\_INT32}:
05525             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a9a17a7edd45b19ef68197db81b27e816}{MAT\_C\_UINT32}:
05526             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a40370e9de516c5036a67a5865c071006}{MAT\_C\_INT16}:
05527             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a8bede21dbf6c1edc0bbccc1481bccae7}{MAT\_C\_UINT16}:
05528             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a984ff310f9e906100fcff95f704f43c5}{MAT\_C\_INT8}:
05529             \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a81270f8093cb4808e992c1d29d84d4e3}{MAT\_C\_UINT8}:
05530                 byteswritten += WriteCompressedEmptyData(mat,matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,nmemb,matvar->
      \hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
05531 \textcolor{preprocessor}{#if 0}
05532                 \textcolor{keywordflow}{if} ( nBytes % 8 )
05533                     \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
05534                         fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05535                 \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
05536                     nBytes = WriteEmptyData(mat,nmemb,matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
05537                     \textcolor{keywordflow}{if} ( nBytes % 8 )
05538                         \textcolor{keywordflow}{for} ( i = nBytes % 8; i < 8; i++ )
05539                             fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05540                 \}
05541 \textcolor{preprocessor}{#endif}
05542                 \textcolor{keywordflow}{break};
05543         \}
05544         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in  = NULL;
05545         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 0;
05546         \textcolor{keywordflow}{do} \{
05547             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_out  = comp\_buf;
05548             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out = buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf);
05549             err = deflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_FINISH);
05550             byteswritten += fwrite(comp\_buf,1,
05551                 buf\_size*\textcolor{keyword}{sizeof}(*comp\_buf)-matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out,(FILE*)mat->
      \hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05552         \} \textcolor{keywordflow}{while} ( err != Z\_STREAM\_END && matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out == 0 );
05553         \textcolor{keywordflow}{if} ( byteswritten % 8 )
05554             \textcolor{keywordflow}{for} ( i = byteswritten % 8; i < 8; i++ )
05555                 fwrite(&pad1,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05556         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"deflate with Z\_FINISH returned %s, byteswritten = %u"},zError(err),
      byteswritten);
05557 \textcolor{preprocessor}{#if 1}
05558         (void)deflateEnd(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z);
05559         free(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z);
05560         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z = NULL;
05561 \textcolor{preprocessor}{#else}
05562         memcpy(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,&z\_save,\textcolor{keyword}{sizeof}(*matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z));
05563 \textcolor{preprocessor}{#endif}
05564 \textcolor{preprocessor}{#endif}
05565 \textcolor{preprocessor}{#endif}
05566     \}
05567     end = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05568     \textcolor{keywordflow}{if} ( start != -1L && end != -1L ) \{
05569         nBytes = (int)(end-start);
05570         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},(long)-(nBytes+4),SEEK\_CUR);
05571         fwrite(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05572         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},end,SEEK\_SET);
05573     \} \textcolor{keywordflow}{else} \{
05574         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
05575     \}
05576 \}
05577 
05586 \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *
\Hypertarget{mat5_8c_source_l05587}\hyperlink{mat5_8c_a5defc934cf088b13347e50ea7f276ea3}{05587} \hyperlink{mat5_8c_a5defc934cf088b13347e50ea7f276ea3}{Mat\_VarReadNextInfo5}( \hyperlink{struct__mat__t}{mat\_t} *mat )
05588 \{
05589     \textcolor{keywordtype}{int} err, data\_type, nBytes;
05590     \textcolor{keywordtype}{long} fpos;
05591     \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar = NULL;
05592     mat\_uint32\_t array\_flags;
05593 
05594     \textcolor{keywordflow}{if} ( mat == NULL )
05595         \textcolor{keywordflow}{return} NULL;
05596 
05597     fpos = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05598     \textcolor{keywordflow}{if} ( fpos == -1L ) \{
05599         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
05600         \textcolor{keywordflow}{return} NULL;
05601     \}
05602     err = fread(&data\_type,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05603     \textcolor{keywordflow}{if} ( err == 0 )
05604         \textcolor{keywordflow}{return} NULL;
05605     err = fread(&nBytes,4,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05606     \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
05607         \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(&data\_type);
05608         \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(&nBytes);
05609     \}
05610     \textcolor{keywordflow}{switch} ( data\_type ) \{
05611         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a30437f2eb3becc2fa6e5d96599d7f724}{MAT\_T\_COMPRESSED}:
05612         \{
05613 \textcolor{preprocessor}{#if defined(HAVE\_ZLIB)}
05614             mat\_uint32\_t uncomp\_buf[16] = \{0,\};
05615             \textcolor{keywordtype}{int}      nbytes;
05616             \textcolor{keywordtype}{long}     bytesread = 0;
05617 
05618             matvar               = \hyperlink{group___m_a_t_gae7c9c3699f6e9c31a9c490300013098c}{Mat\_VarCalloc}();
05619             matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression}  = \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a5181d2f71eab0f12f05ba65d4f13fb53}{MAT\_COMPRESSION\_ZLIB};
05620 
05621             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z = (z\_streamp)calloc(1,\textcolor{keyword}{sizeof}(\hyperlink{structz__stream__s}{z\_stream}));
05622             err = inflateInit(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z);
05623             \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
05624                 \hyperlink{group___m_a_t_ga1d14716f7450530fd1c9d02413787f0e}{Mat\_VarFree}(matvar);
05625                 matvar = NULL;
05626                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"inflateInit returned %s"},zError(err));
05627                 \textcolor{keywordflow}{break};
05628             \}
05629 
05630             \textcolor{comment}{/* Read variable tag */}
05631             bytesread += InflateVarTag(mat,matvar,uncomp\_buf);
05632             \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
05633                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf);
05634                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+1);
05635             \}
05636             nbytes = uncomp\_buf[1];
05637             \textcolor{keywordflow}{if} ( uncomp\_buf[0] != \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a32985fee89a4df8db4b3f5d3a48823d3}{MAT\_T\_MATRIX} ) \{
05638                 (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},nBytes-bytesread,SEEK\_CUR);
05639                 \hyperlink{group___m_a_t_ga1d14716f7450530fd1c9d02413787f0e}{Mat\_VarFree}(matvar);
05640                 matvar = NULL;
05641                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Uncompressed type not MAT\_T\_MATRIX"});
05642                 \textcolor{keywordflow}{break};
05643             \}
05644             \textcolor{comment}{/* Inflate array flags */}
05645             bytesread += InflateArrayFlags(mat,matvar,uncomp\_buf);
05646             \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
05647                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf);
05648                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+2);
05649                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+3);
05650             \}
05651             \textcolor{comment}{/* Array flags */}
05652             \textcolor{keywordflow}{if} ( uncomp\_buf[0] == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32} ) \{
05653                 array\_flags = uncomp\_buf[2];
05654                 matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} = \hyperlink{mat5_8c_a85a616d27707e89bda9fd2e9bbb6a586}{CLASS\_FROM\_ARRAY\_FLAGS}(array\_flags);
05655                 matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex}  = (array\_flags & \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbbacd7b091a11184aad7fc6078c04470780}{MAT\_F\_COMPLEX});
05656                 matvar->\hyperlink{group___m_a_t_af26c71c4c0ddb14931d15910dddac1bc}{isGlobal}   = (array\_flags & \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba49084e0c796aa7963e53f7539525d40d}{MAT\_F\_GLOBAL});
05657                 matvar->\hyperlink{group___m_a_t_a866c1539e68073a837833d74cd4a65be}{isLogical}  = (array\_flags & \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba57eb5c6e200bcbc0f1b7982f29a169c2}{MAT\_F\_LOGICAL});
05658                 \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a0d5655b7e6178a2242cb3bb56ff4c8d2}{MAT\_C\_SPARSE} ) \{
05659                     \textcolor{comment}{/* Need to find a more appropriate place to store nzmax */}
05660                     matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} = uncomp\_buf[3];
05661                 \}
05662             \}
05663             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} != \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40ad83c684d250e463c1a3779647695c0c9}{MAT\_C\_OPAQUE} ) \{
05664                 \textcolor{comment}{/* Inflate dimensions */}
05665                 bytesread += InflateDimensions(mat,matvar,uncomp\_buf);
05666                 \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
05667                     (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf);
05668                     (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+1);
05669                 \}
05670                 \textcolor{comment}{/* Rank and dimension */}
05671                 \textcolor{keywordflow}{if} ( uncomp\_buf[0] == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32} ) \{
05672                     \textcolor{keywordtype}{int} i;
05673                     nbytes = uncomp\_buf[1];
05674                     matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} = nbytes / 4;
05675                     matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims} = (\textcolor{keywordtype}{size\_t}*)malloc(matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}*\textcolor{keyword}{sizeof}(*matvar->
      \hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}));
05676                     \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
05677                         \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
05678                             matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i] = \hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(&(uncomp\_buf[2+i]));
05679                     \} \textcolor{keywordflow}{else} \{
05680                         \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
05681                             matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i] = uncomp\_buf[2+i];
05682                     \}
05683                 \}
05684                 \textcolor{comment}{/* Inflate variable name tag */}
05685                 bytesread += InflateVarNameTag(mat,matvar,uncomp\_buf);
05686                 \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
05687                     (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf);
05688                 \textcolor{comment}{/* Name of variable */}
05689                 \textcolor{keywordflow}{if} ( uncomp\_buf[0] == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8} ) \{    \textcolor{comment}{/* Name not in tag */}
05690                     \textcolor{keywordtype}{int} len, i;
05691                     \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
05692                         len = \hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(uncomp\_buf+1);
05693                     \textcolor{keywordflow}{else}
05694                         len = uncomp\_buf[1];
05695 
05696                     \textcolor{keywordflow}{if} ( len % 8 == 0 )
05697                         i = len;
05698                     \textcolor{keywordflow}{else}
05699                         i = len+(8-(len % 8));
05700                     matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} = (\textcolor{keywordtype}{char}*)malloc(i+1);
05701                     \textcolor{comment}{/* Inflate variable name */}
05702                     bytesread += InflateVarName(mat,matvar,matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},i);
05703                     matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name}[len] = \textcolor{charliteral}{'\(\backslash\)0'};
05704                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( ((uncomp\_buf[0] & 0x0000ffff) == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8}) &&
05705                             ((uncomp\_buf[0] & 0xffff0000) != 0x00) ) \{
05706                     \textcolor{comment}{/* Name packed in tag */}
05707                     \textcolor{keywordtype}{int} len;
05708                     len = (uncomp\_buf[0] & 0xffff0000) >> 16;
05709                     matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} = (\textcolor{keywordtype}{char}*)malloc(len+1);
05710                     memcpy(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},uncomp\_buf+1,len);
05711                     matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name}[len] = \textcolor{charliteral}{'\(\backslash\)0'};
05712                 \}
05713                 \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT} )
05714                     (void)ReadNextStructField(mat,matvar);
05715                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2f7abb47a1c51e248bd4e5e03cc81b08}{MAT\_C\_CELL} )
05716                     (void)ReadNextCell(mat,matvar);
05717                 (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},-(int)matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in,SEEK\_CUR);
05718                 matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05719                 \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} == -1L ) \{
05720                     \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
05721                 \}
05722             \}
05723             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},nBytes+8+fpos,SEEK\_SET);
05724             \textcolor{keywordflow}{break};
05725 \textcolor{preprocessor}{#else}
05726             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Compressed variable found in \(\backslash\)"%s\(\backslash\)", but matio was "}
05727                          \textcolor{stringliteral}{"built without zlib support"},mat->\hyperlink{struct__mat__t_a340b191598135edd03b6dec847f0b1b1}{filename});
05728             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},nBytes+8+fpos,SEEK\_SET);
05729             \textcolor{keywordflow}{return} NULL;
05730 \textcolor{preprocessor}{#endif}
05731         \}
05732         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a32985fee89a4df8db4b3f5d3a48823d3}{MAT\_T\_MATRIX}:
05733         \{
05734             mat\_uint32\_t buf[32];
05735             \textcolor{keywordtype}{size\_t} bytesread = 0;
05736 
05737             matvar = \hyperlink{group___m_a_t_gae7c9c3699f6e9c31a9c490300013098c}{Mat\_VarCalloc}();
05738 
05739             \textcolor{comment}{/* Read array flags and the dimensions tag */}
05740             bytesread += fread(buf,4,6,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05741             \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
05742                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf);
05743                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+1);
05744                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+2);
05745                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+3);
05746                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+4);
05747                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+5);
05748             \}
05749             \textcolor{comment}{/* Array flags */}
05750             \textcolor{keywordflow}{if} ( buf[0] == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32} ) \{
05751                array\_flags = buf[2];
05752                matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} = \hyperlink{mat5_8c_a85a616d27707e89bda9fd2e9bbb6a586}{CLASS\_FROM\_ARRAY\_FLAGS}(array\_flags);
05753                matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex}  = (array\_flags & \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbbacd7b091a11184aad7fc6078c04470780}{MAT\_F\_COMPLEX});
05754                matvar->\hyperlink{group___m_a_t_af26c71c4c0ddb14931d15910dddac1bc}{isGlobal}   = (array\_flags & \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba49084e0c796aa7963e53f7539525d40d}{MAT\_F\_GLOBAL});
05755                matvar->\hyperlink{group___m_a_t_a866c1539e68073a837833d74cd4a65be}{isLogical}  = (array\_flags & \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba57eb5c6e200bcbc0f1b7982f29a169c2}{MAT\_F\_LOGICAL});
05756                \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a0d5655b7e6178a2242cb3bb56ff4c8d2}{MAT\_C\_SPARSE} ) \{
05757                    \textcolor{comment}{/* Need to find a more appropriate place to store nzmax */}
05758                    matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} = buf[3];
05759                \}
05760             \}
05761             \textcolor{comment}{/* Rank and dimension */}
05762             \textcolor{keywordflow}{if} ( buf[4] == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32} ) \{
05763                 \textcolor{keywordtype}{int} nbytes = buf[5], i;
05764 
05765                 matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} = nbytes / 4;
05766                 matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims} = (\textcolor{keywordtype}{size\_t}*)malloc(matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}*\textcolor{keyword}{sizeof}(*matvar->
      \hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}));
05767 
05768                 \textcolor{comment}{/* Assumes rank <= 16 */}
05769                 \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} % 2 != 0 )
05770                     bytesread+=fread(buf,4,matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}+1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05771                 \textcolor{keywordflow}{else}
05772                     bytesread+=fread(buf,4,matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank},(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05773 
05774                 \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
05775                     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
05776                         matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i] = \hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+i);
05777                 \} \textcolor{keywordflow}{else} \{
05778                     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
05779                         matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i] = buf[i];
05780                 \}
05781             \}
05782             \textcolor{comment}{/* Variable name tag */}
05783             bytesread+=fread(buf,4,2,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05784             \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
05785                 (void)\hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf);
05786             \textcolor{comment}{/* Name of variable */}
05787             \textcolor{keywordflow}{if} ( buf[0] == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8} ) \{    \textcolor{comment}{/* Name not in tag */}
05788                 \textcolor{keywordtype}{int} len, i;
05789 
05790                 \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} )
05791                     len = \hyperlink{endian_8c_a8cb0d0750e2eaf9840d95db531934f4f}{Mat\_uint32Swap}(buf+1);
05792                 \textcolor{keywordflow}{else}
05793                     len = buf[1];
05794                 \textcolor{keywordflow}{if} ( len % 8 == 0 )
05795                     i = len;
05796                 \textcolor{keywordflow}{else}
05797                     i = len+(8-(len % 8));
05798                 bytesread+=fread(buf,1,i,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05799 
05800                 matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} = (\textcolor{keywordtype}{char}*)malloc(len+1);
05801                 memcpy(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},buf,len);
05802                 matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name}[len] = \textcolor{charliteral}{'\(\backslash\)0'};
05803             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( ((buf[0] & 0x0000ffff) == \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8}) &&
05804                         ((buf[0] & 0xffff0000) != 0x00) ) \{
05805                 \textcolor{comment}{/* Name packed in the tag */}
05806                 \textcolor{keywordtype}{int} len;
05807 
05808                 len = (buf[0] & 0xffff0000) >> 16;
05809                 matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} = (\textcolor{keywordtype}{char}*)malloc(len+1);
05810                 memcpy(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},buf+1,len);
05811                 matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name}[len] = \textcolor{charliteral}{'\(\backslash\)0'};
05812             \}
05813             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT} )
05814                 (void)ReadNextStructField(mat,matvar);
05815             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2f7abb47a1c51e248bd4e5e03cc81b08}{MAT\_C\_CELL} )
05816                 (void)ReadNextCell(mat,matvar);
05817             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40aaa9bf08312779cd1ab8e504a162ddcea}{MAT\_C\_FUNCTION} )
05818                 (void)ReadNextFunctionHandle(mat,matvar);
05819             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} = ftell((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
05820             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_afd3bfaab126a160bd6855563e1ea0a7e}{datapos} == -1L ) \{
05821                 \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Couldn't determine file position"});
05822             \}
05823             (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},nBytes+8+fpos,SEEK\_SET);
05824             \textcolor{keywordflow}{break};
05825         \}
05826         \textcolor{keywordflow}{default}:
05827             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"%d is not valid (MAT\_T\_MATRIX or MAT\_T\_COMPRESSED)"},
05828                          data\_type);
05829             \textcolor{keywordflow}{return} NULL;
05830     \}
05831 
05832     \textcolor{keywordflow}{return} matvar;
05833 \}
\end{DoxyCode}
