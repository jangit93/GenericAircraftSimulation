\hypertarget{eigen_2unsupported_2test_2cxx11__tensor__morphing_8cpp_source}{}\section{eigen/unsupported/test/cxx11\+\_\+tensor\+\_\+morphing.cpp}
\label{eigen_2unsupported_2test_2cxx11__tensor__morphing_8cpp_source}\index{cxx11\+\_\+tensor\+\_\+morphing.\+cpp@{cxx11\+\_\+tensor\+\_\+morphing.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2014 Benoit Steiner <benoit.steiner.goog@gmail.com>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#include "main.h"}
00011 
00012 \textcolor{preprocessor}{#include <Eigen/CXX11/Tensor>}
00013 
00014 \textcolor{keyword}{using} \hyperlink{class_eigen_1_1_tensor}{Eigen::Tensor};
00015 
00016 \textcolor{keyword}{template}<\textcolor{keyword}{typename}>
00017 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_simple\_reshape()
00018 \{
00019   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 5>} tensor1(2,3,1,7,1);
00020   tensor1.setRandom();
00021 
00022   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} tensor2(2,3,7);
00023   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 2>} tensor3(6,7);
00024   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 2>} tensor4(2,21);
00025 
00026   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>::Dimensions} dim1(2,3,7);
00027   tensor2 = tensor1.reshape(dim1);
00028   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 2>::Dimensions} dim2(6,7);
00029   tensor3 = tensor1.reshape(dim2);
00030   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 2>::Dimensions} dim3(2,21);
00031   tensor4 = tensor1.reshape(dim1).reshape(dim3);
00032 
00033   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00034     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
00035       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 7; ++k) \{
00036         VERIFY\_IS\_EQUAL(tensor1(i,j,0,k,0), tensor2(i,j,k));
00037         VERIFY\_IS\_EQUAL(tensor1(i,j,0,k,0), tensor3(i+2*j,k));
00038         VERIFY\_IS\_EQUAL(tensor1(i,j,0,k,0), tensor4(i,j+3*k));
00039       \}
00040     \}
00041   \}
00042 \}
00043 
00044 \textcolor{keyword}{template}<\textcolor{keyword}{typename}>
00045 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_reshape\_in\_expr() \{
00046   MatrixXf m1(2,3*5*7*11);
00047   MatrixXf m2(3*5*7*11,13);
00048   m1.setRandom();
00049   m2.setRandom();
00050   MatrixXf m3 = m1 * m2;
00051 
00052   TensorMap<Tensor<float, 5>> tensor1(m1.data(), 2,3,5,7,11);
00053   TensorMap<Tensor<float, 5>> tensor2(m2.data(), 3,5,7,11,13);
00054   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 2>::Dimensions} newDims1(2,3*5*7*11);
00055   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 2>::Dimensions} newDims2(3*5*7*11,13);
00056   \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 1>::DimensionPair} DimPair;
00057   array<DimPair, 1> contract\_along\{\{DimPair(1, 0)\}\};
00058   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 2>} tensor3(2,13);
00059   tensor3 = tensor1.reshape(newDims1).contract(tensor2.reshape(newDims2), contract\_along);
00060 
00061   Map<MatrixXf> res(tensor3.data(), 2, 13);
00062   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00063     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 13; ++j) \{
00064       VERIFY\_IS\_APPROX(res(i,j), m3(i,j));
00065     \}
00066   \}
00067 \}
00068 
00069 \textcolor{keyword}{template}<\textcolor{keyword}{typename}>
00070 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_reshape\_as\_lvalue()
00071 \{
00072   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} tensor(2,3,7);
00073   tensor.setRandom();
00074 
00075   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 2>} tensor2d(6,7);
00076   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>::Dimensions} dim(2,3,7);
00077   tensor2d.reshape(dim) = tensor;
00078 
00079   \textcolor{keywordtype}{float} scratch[2*3*1*7*1];
00080   TensorMap<Tensor<float, 5>> tensor5d(scratch, 2,3,1,7,1);
00081   tensor5d.reshape(dim).device(\hyperlink{struct_eigen_1_1_default_device}{Eigen::DefaultDevice}()) = tensor;
00082 
00083   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00084     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
00085       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 7; ++k) \{
00086         VERIFY\_IS\_EQUAL(tensor2d(i+2*j,k), tensor(i,j,k));
00087         VERIFY\_IS\_EQUAL(tensor5d(i,j,0,k,0), tensor(i,j,k));
00088       \}
00089     \}
00090   \}
00091 \}
00092 
00093 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} DataLayout>
00094 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_simple\_slice()
00095 \{
00096   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 5, DataLayout>} tensor(2,3,5,7,11);
00097   tensor.setRandom();
00098 
00099   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 5, DataLayout>} slice1(1,1,1,1,1);
00100   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 5>} indices(1,2,3,4,5);
00101   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 5>} sizes(1,1,1,1,1);
00102   slice1 = tensor.slice(indices, sizes);
00103   VERIFY\_IS\_EQUAL(slice1(0,0,0,0,0), tensor(1,2,3,4,5));
00104 
00105   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 5, DataLayout>} slice2(1,1,2,2,3);
00106   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 5>} indices2(1,1,3,4,5);
00107   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 5>} sizes2(1,1,2,2,3);
00108   slice2 = tensor.slice(indices2, sizes2);
00109   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00110     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 2; ++j) \{
00111       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 3; ++k) \{
00112         VERIFY\_IS\_EQUAL(slice2(0,0,i,j,k), tensor(1,1,3+i,4+j,5+k));
00113       \}
00114     \}
00115   \}
00116 \}
00117 
00118 \textcolor{keyword}{template}<\textcolor{keyword}{typename}=\textcolor{keywordtype}{void}>
00119 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_const\_slice()
00120 \{
00121   \textcolor{keyword}{const} \textcolor{keywordtype}{float} b[1] = \{42\};
00122   TensorMap<Tensor<const float, 1> > m(b, 1);
00123   DSizes<DenseIndex, 1> offsets;
00124   offsets[0] = 0;
00125   TensorRef<Tensor<const float, 1> > slice\_ref(m.slice(offsets, m.dimensions()));
00126   VERIFY\_IS\_EQUAL(slice\_ref(0), 42);
00127 \}
00128 
00129 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} DataLayout>
00130 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_slice\_in\_expr() \{
00131   \textcolor{keyword}{typedef} Matrix<float, Dynamic, Dynamic, DataLayout> Mtx;
00132   Mtx m1(7,7);
00133   Mtx m2(3,3);
00134   m1.setRandom();
00135   m2.setRandom();
00136 
00137   Mtx m3 = m1.block(1, 2, 3, 3) * m2.block(0, 2, 3, 1);
00138 
00139   TensorMap<Tensor<float, 2, DataLayout>> tensor1(m1.data(), 7, 7);
00140   TensorMap<Tensor<float, 2, DataLayout>> tensor2(m2.data(), 3, 3);
00141   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 2, DataLayout>} tensor3(3,1);
00142   \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 1>::DimensionPair} DimPair;
00143   array<DimPair, 1> contract\_along\{\{DimPair(1, 0)\}\};
00144 
00145   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 2>} indices1(1,2);
00146   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 2>} sizes1(3,3);
00147   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 2>} indices2(0,2);
00148   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 2>} sizes2(3,1);
00149   tensor3 = tensor1.slice(indices1, sizes1).contract(tensor2.slice(indices2, sizes2), contract\_along);
00150 
00151   Map<Mtx> res(tensor3.data(), 3, 1);
00152   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 3; ++i) \{
00153     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 1; ++j) \{
00154       VERIFY\_IS\_APPROX(res(i,j), m3(i,j));
00155     \}
00156   \}
00157 
00158   \textcolor{comment}{// Take an arbitrary slice of an arbitrarily sized tensor.}
00159   TensorMap<Tensor<const float, 2, DataLayout>> tensor4(m1.data(), 7, 7);
00160   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 1, DataLayout>} tensor6 = tensor4.reshape(DSizes<ptrdiff\_t, 1>(7
      *7)).exp().slice(DSizes<ptrdiff\_t, 1>(0), DSizes<ptrdiff\_t, 1>(35));
00161   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 35; ++i) \{
00162     VERIFY\_IS\_APPROX(tensor6(i), expf(tensor4.data()[i]));
00163   \}
00164 \}
00165 
00166 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} DataLayout>
00167 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_slice\_as\_lvalue()
00168 \{
00169   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3, DataLayout>} tensor1(2,2,7);
00170   tensor1.setRandom();
00171   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3, DataLayout>} tensor2(2,2,7);
00172   tensor2.setRandom();
00173   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3, DataLayout>} tensor3(4,3,5);
00174   tensor3.setRandom();
00175   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3, DataLayout>} tensor4(4,3,2);
00176   tensor4.setRandom();
00177   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3, DataLayout>} tensor5(10,13,12);
00178   tensor5.setRandom();
00179 
00180   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3, DataLayout>} result(4,5,7);
00181   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 3>} sizes12(2,2,7);
00182   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 3>} first\_slice(0,0,0);
00183   result.slice(first\_slice, sizes12) = tensor1;
00184   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 3>} second\_slice(2,0,0);
00185   result.slice(second\_slice, sizes12).device(\hyperlink{struct_eigen_1_1_default_device}{Eigen::DefaultDevice}()) = tensor2;
00186 
00187   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 3>} sizes3(4,3,5);
00188   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 3>} third\_slice(0,2,0);
00189   result.slice(third\_slice, sizes3) = tensor3;
00190 
00191   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 3>} sizes4(4,3,2);
00192   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 3>} fourth\_slice(0,2,5);
00193   result.slice(fourth\_slice, sizes4) = tensor4;
00194 
00195   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 2; ++j) \{
00196     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 7; ++k) \{
00197       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00198         VERIFY\_IS\_EQUAL(result(i,j,k), tensor1(i,j,k));
00199         VERIFY\_IS\_EQUAL(result(i+2,j,k), tensor2(i,j,k));
00200       \}
00201     \}
00202   \}
00203   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 4; ++i) \{
00204     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 2; j < 5; ++j) \{
00205       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 5; ++k) \{
00206         VERIFY\_IS\_EQUAL(result(i,j,k), tensor3(i,j-2,k));
00207       \}
00208       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 5; k < 7; ++k) \{
00209         VERIFY\_IS\_EQUAL(result(i,j,k), tensor4(i,j-2,k-5));
00210       \}
00211     \}
00212   \}
00213 
00214   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 3>} sizes5(4,5,7);
00215   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 3>} fifth\_slice(0,0,0);
00216   result.slice(fifth\_slice, sizes5) = tensor5.slice(fifth\_slice, sizes5);
00217   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 4; ++i) \{
00218     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 2; j < 5; ++j) \{
00219       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 7; ++k) \{
00220         VERIFY\_IS\_EQUAL(result(i,j,k), tensor5(i,j,k));
00221       \}
00222     \}
00223   \}
00224 \}
00225 
00226 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} DataLayout>
00227 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_slice\_raw\_data()
00228 \{
00229   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 4, DataLayout>} tensor(3,5,7,11);
00230   tensor.setRandom();
00231 
00232   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 4>} offsets(1,2,3,4);
00233   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 4>} extents(1,1,1,1);
00234   \textcolor{keyword}{typedef} TensorEvaluator<decltype(tensor.slice(offsets, extents)), DefaultDevice> SliceEvaluator;
00235   \textcolor{keyword}{auto} slice1 = SliceEvaluator(tensor.slice(offsets, extents), DefaultDevice());
00236   VERIFY\_IS\_EQUAL(slice1.dimensions().TotalSize(), 1);
00237   VERIFY\_IS\_EQUAL(slice1.data()[0], tensor(1,2,3,4));
00238 
00239   \textcolor{keywordflow}{if} (DataLayout == \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor}) \{
00240     extents = \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 4>}(2,1,1,1);
00241     \textcolor{keyword}{auto} slice2 = SliceEvaluator(tensor.slice(offsets, extents), DefaultDevice());
00242     VERIFY\_IS\_EQUAL(slice2.dimensions().TotalSize(), 2);
00243     VERIFY\_IS\_EQUAL(slice2.data()[0], tensor(1,2,3,4));
00244     VERIFY\_IS\_EQUAL(slice2.data()[1], tensor(2,2,3,4));
00245   \} \textcolor{keywordflow}{else} \{
00246     extents = \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 4>}(1,1,1,2);
00247     \textcolor{keyword}{auto} slice2 = SliceEvaluator(tensor.slice(offsets, extents), DefaultDevice());
00248     VERIFY\_IS\_EQUAL(slice2.dimensions().TotalSize(), 2);
00249     VERIFY\_IS\_EQUAL(slice2.data()[0], tensor(1,2,3,4));
00250     VERIFY\_IS\_EQUAL(slice2.data()[1], tensor(1,2,3,5));
00251   \}
00252 
00253   extents = \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 4>}(1,2,1,1);
00254   \textcolor{keyword}{auto} slice3 = SliceEvaluator(tensor.slice(offsets, extents), DefaultDevice());
00255   VERIFY\_IS\_EQUAL(slice3.dimensions().TotalSize(), 2);
00256   VERIFY\_IS\_EQUAL(slice3.data(), \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}*\textcolor{keyword}{>}(0));
00257 
00258   \textcolor{keywordflow}{if} (DataLayout == \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor}) \{
00259     offsets = \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 4>}(0,2,3,4);
00260     extents = \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 4>}(3,2,1,1);
00261     \textcolor{keyword}{auto} slice4 = SliceEvaluator(tensor.slice(offsets, extents), DefaultDevice());
00262     VERIFY\_IS\_EQUAL(slice4.dimensions().TotalSize(), 6);
00263     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 3; ++i) \{
00264       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 2; ++j) \{
00265         VERIFY\_IS\_EQUAL(slice4.data()[i+3*j], tensor(i,2+j,3,4));
00266       \}
00267     \}
00268   \} \textcolor{keywordflow}{else} \{
00269     offsets = \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 4>}(1,2,3,0);
00270     extents = \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 4>}(1,1,2,11);
00271     \textcolor{keyword}{auto} slice4 = SliceEvaluator(tensor.slice(offsets, extents), DefaultDevice());
00272     VERIFY\_IS\_EQUAL(slice4.dimensions().TotalSize(), 22);
00273     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} l = 0; l < 11; ++l) \{
00274       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 2; ++k) \{
00275         VERIFY\_IS\_EQUAL(slice4.data()[l+11*k], tensor(1,2,3+k,l));
00276       \}
00277     \}
00278   \}
00279 
00280   \textcolor{keywordflow}{if} (DataLayout == \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor}) \{
00281     offsets = \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 4>}(0,0,0,4);
00282     extents = \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 4>}(3,5,7,2);
00283     \textcolor{keyword}{auto} slice5 = SliceEvaluator(tensor.slice(offsets, extents), DefaultDevice());
00284     VERIFY\_IS\_EQUAL(slice5.dimensions().TotalSize(), 210);
00285     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 3; ++i) \{
00286       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 5; ++j) \{
00287         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 7; ++k) \{
00288           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} l = 0; l < 2; ++l) \{
00289             \textcolor{keywordtype}{int} slice\_index = i + 3 * (j + 5 * (k + 7 * l));
00290             VERIFY\_IS\_EQUAL(slice5.data()[slice\_index], tensor(i,j,k,l+4));
00291           \}
00292         \}
00293       \}
00294     \}
00295   \} \textcolor{keywordflow}{else} \{
00296     offsets = \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 4>}(1,0,0,0);
00297     extents = \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 4>}(2,5,7,11);
00298     \textcolor{keyword}{auto} slice5 = SliceEvaluator(tensor.slice(offsets, extents), DefaultDevice());
00299     VERIFY\_IS\_EQUAL(slice5.dimensions().TotalSize(), 770);
00300     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} l = 0; l < 11; ++l) \{
00301       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 7; ++k) \{
00302         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 5; ++j) \{
00303           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00304             \textcolor{keywordtype}{int} slice\_index = l + 11 * (k + 7 * (j + 5 * i));
00305             VERIFY\_IS\_EQUAL(slice5.data()[slice\_index], tensor(i+1,j,k,l));
00306           \}
00307         \}
00308       \}
00309     \}
00310 
00311   \}
00312 
00313   offsets = \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 4>}(0,0,0,0);
00314   extents = \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 4>}(3,5,7,11);
00315   \textcolor{keyword}{auto} slice6 = SliceEvaluator(tensor.slice(offsets, extents), DefaultDevice());
00316   VERIFY\_IS\_EQUAL(slice6.dimensions().TotalSize(), 3*5*7*11);
00317   VERIFY\_IS\_EQUAL(slice6.data(), tensor.data());
00318 \}
00319 
00320 
00321 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} DataLayout>
00322 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_strided\_slice()
00323 \{
00324   \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 5, DataLayout>} Tensor5f;
00325   \textcolor{keyword}{typedef} \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<Eigen::DenseIndex, 5>} Index5;
00326   \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 2, DataLayout>} Tensor2f;
00327   \textcolor{keyword}{typedef} \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<Eigen::DenseIndex, 2>} Index2;
00328   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 5, DataLayout>} tensor(2,3,5,7,11);
00329   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 2, DataLayout>} tensor2(7,11);
00330   tensor.setRandom();
00331   tensor2.setRandom();
00332 
00333   \textcolor{keywordflow}{if} (\textcolor{keyword}{true}) \{
00334     Tensor2f slice(2,3);
00335     Index2 strides(-2,-1);
00336     Index2 indicesStart(5,7);
00337     Index2 indicesStop(0,4);
00338     slice = tensor2.stridedSlice(indicesStart, indicesStop, strides);
00339     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 2; ++j) \{
00340       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 3; ++k) \{
00341         VERIFY\_IS\_EQUAL(slice(j,k), tensor2(5-2*j,7-k));
00342       \}
00343     \}
00344   \}
00345 
00346   \textcolor{keywordflow}{if}(\textcolor{keyword}{true}) \{
00347     Tensor2f slice(0,1);
00348     Index2 strides(1,1);
00349     Index2 indicesStart(5,4);
00350     Index2 indicesStop(5,5);
00351     slice = tensor2.stridedSlice(indicesStart, indicesStop, strides);
00352   \}
00353 
00354   \textcolor{keywordflow}{if}(\textcolor{keyword}{true}) \{ \textcolor{comment}{// test clamped degenerate interavls}
00355     Tensor2f slice(7,11);
00356     Index2 strides(1,-1);
00357     Index2 indicesStart(-3,20); \textcolor{comment}{// should become 0,10}
00358     Index2 indicesStop(20,-11); \textcolor{comment}{// should become 11, -1}
00359     slice = tensor2.stridedSlice(indicesStart, indicesStop, strides);
00360     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 7; ++j) \{
00361       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 11; ++k) \{
00362         VERIFY\_IS\_EQUAL(slice(j,k), tensor2(j,10-k));
00363       \}
00364     \}
00365   \}
00366 
00367   \textcolor{keywordflow}{if}(\textcolor{keyword}{true}) \{
00368     Tensor5f slice1(1,1,1,1,1);
00369     \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<Eigen::DenseIndex, 5>} indicesStart(1, 2, 3, 4, 5);
00370     \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<Eigen::DenseIndex, 5>} indicesStop(2, 3, 4, 5, 6);
00371     \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<Eigen::DenseIndex, 5>} strides(1, 1, 1, 1, 1);
00372     slice1 = tensor.stridedSlice(indicesStart, indicesStop, strides);
00373     VERIFY\_IS\_EQUAL(slice1(0,0,0,0,0), tensor(1,2,3,4,5));
00374   \}
00375 
00376   \textcolor{keywordflow}{if}(\textcolor{keyword}{true}) \{
00377     Tensor5f slice(1,1,2,2,3);
00378     Index5 start(1, 1, 3, 4, 5);
00379     Index5 stop(2, 2, 5, 6, 8);
00380     Index5 strides(1, 1, 1, 1, 1);
00381     slice = tensor.stridedSlice(start, stop, strides);
00382     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00383       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 2; ++j) \{
00384         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 3; ++k) \{
00385           VERIFY\_IS\_EQUAL(slice(0,0,i,j,k), tensor(1,1,3+i,4+j,5+k));
00386         \}
00387       \}
00388     \}
00389   \}
00390 
00391   \textcolor{keywordflow}{if}(\textcolor{keyword}{true}) \{
00392     Tensor5f slice(1,1,2,2,3);
00393     Index5 strides3(1, 1, -2, 1, -1);
00394     Index5 indices3Start(1, 1, 4, 4, 7);
00395     Index5 indices3Stop(2, 2, 0, 6, 4);
00396     slice = tensor.stridedSlice(indices3Start, indices3Stop, strides3);
00397     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00398       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 2; ++j) \{
00399         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 3; ++k) \{
00400           VERIFY\_IS\_EQUAL(slice(0,0,i,j,k), tensor(1,1,4-2*i,4+j,7-k));
00401         \}
00402       \}
00403     \}
00404   \}
00405 
00406   \textcolor{keywordflow}{if}(\textcolor{keyword}{false}) \{ \textcolor{comment}{// tests degenerate interval}
00407     Tensor5f slice(1,1,2,2,3);
00408     Index5 strides3(1, 1, 2, 1, 1);
00409     Index5 indices3Start(1, 1, 4, 4, 7);
00410     Index5 indices3Stop(2, 2, 0, 6, 4);
00411     slice = tensor.stridedSlice(indices3Start, indices3Stop, strides3);
00412   \}
00413 \}
00414 
00415 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} DataLayout>
00416 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_strided\_slice\_write()
00417 \{
00418   \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 2, DataLayout>} Tensor2f;
00419   \textcolor{keyword}{typedef} \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<Eigen::DenseIndex, 2>} Index2;
00420 
00421   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 2, DataLayout>} tensor(7,11),tensor2(7,11);
00422   tensor.setRandom();
00423   tensor2=tensor;
00424   Tensor2f slice(2,3);
00425 
00426   slice.setRandom();
00427 
00428   Index2 strides(1,1);
00429   Index2 indicesStart(3,4);
00430   Index2 indicesStop(5,7);
00431   Index2 lengths(2,3);
00432 
00433   tensor.slice(indicesStart,lengths)=slice;
00434   tensor2.stridedSlice(indicesStart,indicesStop,strides)=slice;
00435 
00436   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0;i<7;i++) \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} j=0;j<11;j++)\{
00437     VERIFY\_IS\_EQUAL(tensor(i,j), tensor2(i,j));
00438   \}
00439 \}
00440 
00441 
00442 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} DataLayout>
00443 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_composition()
00444 \{
00445   \hyperlink{class_eigen_1_1_tensor}{Eigen::Tensor<float, 2, DataLayout>} matrix(7, 11);
00446   matrix.setRandom();
00447 
00448   \textcolor{keyword}{const} DSizes<ptrdiff\_t, 3> newDims(1, 1, 11);
00449   \hyperlink{class_eigen_1_1_tensor}{Eigen::Tensor<float, 3, DataLayout>} tensor =
00450       matrix.slice(DSizes<ptrdiff\_t, 2>(2, 0), DSizes<ptrdiff\_t, 2>(1, 11)).reshape(newDims);
00451 
00452   VERIFY\_IS\_EQUAL(tensor.dimensions().TotalSize(), 11);
00453   VERIFY\_IS\_EQUAL(tensor.dimension(0), 1);
00454   VERIFY\_IS\_EQUAL(tensor.dimension(1), 1);
00455   VERIFY\_IS\_EQUAL(tensor.dimension(2), 11);
00456   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 11; ++i) \{
00457     VERIFY\_IS\_EQUAL(tensor(0,0,i), matrix(2,i));
00458   \}
00459 \}
00460 
00461 
00462 \textcolor{keywordtype}{void} test\_cxx11\_tensor\_morphing()
00463 \{
00464   CALL\_SUBTEST\_1(test\_simple\_reshape<void>());
00465   CALL\_SUBTEST\_1(test\_reshape\_in\_expr<void>());
00466   CALL\_SUBTEST\_1(test\_reshape\_as\_lvalue<void>());
00467 
00468   CALL\_SUBTEST\_1(test\_simple\_slice<ColMajor>());
00469   CALL\_SUBTEST\_1(test\_simple\_slice<RowMajor>());
00470   CALL\_SUBTEST\_1(test\_const\_slice());
00471   CALL\_SUBTEST\_2(test\_slice\_in\_expr<ColMajor>());
00472   CALL\_SUBTEST\_3(test\_slice\_in\_expr<RowMajor>());
00473   CALL\_SUBTEST\_4(test\_slice\_as\_lvalue<ColMajor>());
00474   CALL\_SUBTEST\_4(test\_slice\_as\_lvalue<RowMajor>());
00475   CALL\_SUBTEST\_5(test\_slice\_raw\_data<ColMajor>());
00476   CALL\_SUBTEST\_5(test\_slice\_raw\_data<RowMajor>());
00477 
00478   CALL\_SUBTEST\_6(test\_strided\_slice\_write<ColMajor>());
00479   CALL\_SUBTEST\_6(test\_strided\_slice<ColMajor>());
00480   CALL\_SUBTEST\_6(test\_strided\_slice\_write<RowMajor>());
00481   CALL\_SUBTEST\_6(test\_strided\_slice<RowMajor>());
00482 
00483   CALL\_SUBTEST\_7(test\_composition<ColMajor>());
00484   CALL\_SUBTEST\_7(test\_composition<RowMajor>());
00485 \}
\end{DoxyCode}
