\hypertarget{eigen_2unsupported_2_eigen_2src_2_levenberg_marquardt_2_l_mcovar_8h_source}{}\section{eigen/unsupported/\+Eigen/src/\+Levenberg\+Marquardt/\+L\+Mcovar.h}
\label{eigen_2unsupported_2_eigen_2src_2_levenberg_marquardt_2_l_mcovar_8h_source}\index{L\+Mcovar.\+h@{L\+Mcovar.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// This code initially comes from MINPACK whose original authors are:}
00005 \textcolor{comment}{// Copyright Jorge More - Argonne National Laboratory}
00006 \textcolor{comment}{// Copyright Burt Garbow - Argonne National Laboratory}
00007 \textcolor{comment}{// Copyright Ken Hillstrom - Argonne National Laboratory}
00008 \textcolor{comment}{//}
00009 \textcolor{comment}{// This Source Code Form is subject to the terms of the Minpack license}
00010 \textcolor{comment}{// (a BSD-like license) described in the campaigned CopyrightMINPACK.txt file.}
00011 
00012 \textcolor{preprocessor}{#ifndef EIGEN\_LMCOVAR\_H}
00013 \textcolor{preprocessor}{#define EIGEN\_LMCOVAR\_H}
00014 
00015 \textcolor{keyword}{namespace }\hyperlink{namespace_eigen}{Eigen} \{ 
00016 
00017 \textcolor{keyword}{namespace }\hyperlink{namespaceinternal}{internal} \{
00018 
00019 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Scalar>
00020 \textcolor{keywordtype}{void} covar(
00021         \hyperlink{group___core___module}{Matrix< Scalar, Dynamic, Dynamic >} &r,
00022         \textcolor{keyword}{const} VectorXi& ipvt,
00023         Scalar tol = std::sqrt(NumTraits<Scalar>::epsilon()) )
00024 \{
00025     \textcolor{keyword}{using} std::abs;
00026     \textcolor{comment}{/* Local variables */}
00027     \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} i, j, k, l, ii, jj;
00028     \textcolor{keywordtype}{bool} sing;
00029     Scalar temp;
00030 
00031     \textcolor{comment}{/* Function Body */}
00032     \textcolor{keyword}{const} \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} n = r.cols();
00033     \textcolor{keyword}{const} Scalar tolr = tol * abs(r(0,0));
00034     \hyperlink{group___core___module}{Matrix< Scalar, Dynamic, 1 >} wa(n);
00035     eigen\_assert(ipvt.size()==n);
00036 
00037     \textcolor{comment}{/* form the inverse of r in the full upper triangle of r. */}
00038     l = -1;
00039     \textcolor{keywordflow}{for} (k = 0; k < n; ++k)
00040         \textcolor{keywordflow}{if} (abs(r(k,k)) > tolr) \{
00041             r(k,k) = 1. / r(k,k);
00042             \textcolor{keywordflow}{for} (j = 0; j <= k-1; ++j) \{
00043                 temp = r(k,k) * r(j,k);
00044                 r(j,k) = 0.;
00045                 r.col(k).head(j+1) -= r.col(j).head(j+1) * temp;
00046             \}
00047             l = k;
00048         \}
00049 
00050     \textcolor{comment}{/* form the full upper triangle of the inverse of (r transpose)*r */}
00051     \textcolor{comment}{/* in the full upper triangle of r. */}
00052     \textcolor{keywordflow}{for} (k = 0; k <= l; ++k) \{
00053         \textcolor{keywordflow}{for} (j = 0; j <= k-1; ++j)
00054             r.col(j).head(j+1) += r.col(k).head(j+1) * r(j,k);
00055         r.col(k).head(k+1) *= r(k,k);
00056     \}
00057 
00058     \textcolor{comment}{/* form the full lower triangle of the covariance matrix */}
00059     \textcolor{comment}{/* in the strict lower triangle of r and in wa. */}
00060     \textcolor{keywordflow}{for} (j = 0; j < n; ++j) \{
00061         jj = ipvt[j];
00062         sing = j > l;
00063         \textcolor{keywordflow}{for} (i = 0; i <= j; ++i) \{
00064             \textcolor{keywordflow}{if} (sing)
00065                 r(i,j) = 0.;
00066             ii = ipvt[i];
00067             \textcolor{keywordflow}{if} (ii > jj)
00068                 r(ii,jj) = r(i,j);
00069             \textcolor{keywordflow}{if} (ii < jj)
00070                 r(jj,ii) = r(i,j);
00071         \}
00072         wa[jj] = r(j,j);
00073     \}
00074 
00075     \textcolor{comment}{/* symmetrize the covariance matrix in r. */}
00076     r.topLeftCorner(n,n).template triangularView<StrictlyUpper>() = r.topLeftCorner(n,n).transpose();
00077     r.diagonal() = wa;
00078 \}
00079 
00080 \} \textcolor{comment}{// end namespace internal}
00081 
00082 \} \textcolor{comment}{// end namespace Eigen}
00083 
00084 \textcolor{preprocessor}{#endif // EIGEN\_LMCOVAR\_H}
\end{DoxyCode}
