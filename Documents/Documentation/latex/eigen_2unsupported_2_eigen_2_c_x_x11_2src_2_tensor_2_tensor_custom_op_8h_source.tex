\hypertarget{eigen_2unsupported_2_eigen_2_c_x_x11_2src_2_tensor_2_tensor_custom_op_8h_source}{}\section{eigen/unsupported/\+Eigen/\+C\+X\+X11/src/\+Tensor/\+Tensor\+Custom\+Op.h}
\label{eigen_2unsupported_2_eigen_2_c_x_x11_2src_2_tensor_2_tensor_custom_op_8h_source}\index{Tensor\+Custom\+Op.\+h@{Tensor\+Custom\+Op.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2014 Benoit Steiner <benoit.steiner.goog@gmail.com>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#ifndef EIGEN\_CXX11\_TENSOR\_TENSOR\_CUSTOM\_OP\_H}
00011 \textcolor{preprocessor}{#define EIGEN\_CXX11\_TENSOR\_TENSOR\_CUSTOM\_OP\_H}
00012 
00013 \textcolor{keyword}{namespace }\hyperlink{namespace_eigen}{Eigen} \{
00014 
00022 \textcolor{keyword}{namespace }\hyperlink{namespaceinternal}{internal} \{
00023 \textcolor{keyword}{template}<\textcolor{keyword}{typename} CustomUnaryFunc, \textcolor{keyword}{typename} XprType>
\Hypertarget{eigen_2unsupported_2_eigen_2_c_x_x11_2src_2_tensor_2_tensor_custom_op_8h_source_l00024}\hyperlink{struct_eigen_1_1internal_1_1traits_3_01_tensor_custom_unary_op_3_01_custom_unary_func_00_01_xpr_type_01_4_01_4}{00024} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1traits}{traits}<\hyperlink{class_eigen_1_1_tensor_custom_unary_op}{TensorCustomUnaryOp}<CustomUnaryFunc, XprType> >
00025 \{
00026   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} XprType::Scalar Scalar;
00027   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} XprType::StorageKind StorageKind;
00028   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} XprType::Index \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index};
00029   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} XprType::Nested Nested;
00030   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{remove\_reference<Nested>::type} 
      \hyperlink{group___sparse_core___module}{\_Nested};
00031   \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{int} NumDimensions = \hyperlink{struct_eigen_1_1internal_1_1traits}{traits<XprType>::NumDimensions};
00032   \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{int} Layout = \hyperlink{struct_eigen_1_1internal_1_1traits}{traits<XprType>::Layout};
00033 \};
00034 
00035 \textcolor{keyword}{template}<\textcolor{keyword}{typename} CustomUnaryFunc, \textcolor{keyword}{typename} XprType>
\Hypertarget{eigen_2unsupported_2_eigen_2_c_x_x11_2src_2_tensor_2_tensor_custom_op_8h_source_l00036}\hyperlink{struct_eigen_1_1internal_1_1eval_3_01_tensor_custom_unary_op_3_01_custom_unary_func_00_01_xpr_ty453212bf40fc24f334a0deb6823dd342}{00036} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1eval}{eval}<\hyperlink{class_eigen_1_1_tensor_custom_unary_op}{TensorCustomUnaryOp}<CustomUnaryFunc, XprType>, 
      \hyperlink{namespace_eigen}{Eigen}::\hyperlink{struct_eigen_1_1_dense}{Dense}>
00037 \{
00038   \textcolor{keyword}{typedef} \textcolor{keyword}{const} \hyperlink{class_eigen_1_1_tensor_custom_unary_op}{TensorCustomUnaryOp<CustomUnaryFunc, XprType>}&
       \hyperlink{class_eigen_1_1_tensor_custom_unary_op}{type};
00039 \};
00040 
00041 \textcolor{keyword}{template}<\textcolor{keyword}{typename} CustomUnaryFunc, \textcolor{keyword}{typename} XprType>
\Hypertarget{eigen_2unsupported_2_eigen_2_c_x_x11_2src_2_tensor_2_tensor_custom_op_8h_source_l00042}\hyperlink{struct_eigen_1_1internal_1_1nested_3_01_tensor_custom_unary_op_3_01_custom_unary_func_00_01_xpr_type_01_4_01_4}{00042} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1nested}{nested}<\hyperlink{class_eigen_1_1_tensor_custom_unary_op}{TensorCustomUnaryOp}<CustomUnaryFunc, XprType> >
00043 \{
00044   \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1_tensor_custom_unary_op}{TensorCustomUnaryOp<CustomUnaryFunc, XprType>} 
      \hyperlink{class_eigen_1_1_tensor_custom_unary_op}{type};
00045 \};
00046 
00047 \}  \textcolor{comment}{// end namespace internal}
00048 
00049 
00050 
00051 \textcolor{keyword}{template}<\textcolor{keyword}{typename} CustomUnaryFunc, \textcolor{keyword}{typename} XprType>
\Hypertarget{eigen_2unsupported_2_eigen_2_c_x_x11_2src_2_tensor_2_tensor_custom_op_8h_source_l00052}\hyperlink{class_eigen_1_1_tensor_custom_unary_op}{00052} \textcolor{keyword}{class }\hyperlink{class_eigen_1_1_tensor_custom_unary_op}{TensorCustomUnaryOp} : \textcolor{keyword}{public} \hyperlink{class_eigen_1_1_tensor_base}{TensorBase}<TensorCustomUnaryOp<CustomUnaryF
      unc, XprType>, ReadOnlyAccessors>
00053 \{
00054   \textcolor{keyword}{public}:
00055   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1traits}{internal::traits<TensorCustomUnaryOp>::Scalar}
       Scalar;
00056   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{Eigen::NumTraits<Scalar>::Real} 
      \hyperlink{group___sparse_core___module}{RealScalar};
00057   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} XprType::CoeffReturnType CoeffReturnType;
00058   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{class_eigen_1_1internal_1_1_tensor_lazy_evaluator_writable}{internal::nested<TensorCustomUnaryOp>::type} 
      \hyperlink{class_eigen_1_1internal_1_1_tensor_lazy_evaluator_writable}{Nested};
00059   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1traits}{internal::traits<TensorCustomUnaryOp>::StorageKind}
       StorageKind;
00060   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1traits}{internal::traits<TensorCustomUnaryOp>::Index}
       \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index};
00061 
00062   EIGEN\_DEVICE\_FUNC EIGEN\_STRONG\_INLINE \hyperlink{class_eigen_1_1_tensor_custom_unary_op}{TensorCustomUnaryOp}(\textcolor{keyword}{const} XprType& expr, \textcolor{keyword}{const} 
      CustomUnaryFunc& \hyperlink{structfunc}{func})
00063       : m\_expr(expr), m\_func(func) \{\}
00064 
00065   EIGEN\_DEVICE\_FUNC
00066   \textcolor{keyword}{const} CustomUnaryFunc& func()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_func; \}
00067 
00068   EIGEN\_DEVICE\_FUNC
00069   \textcolor{keyword}{const} \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{internal::remove\_all<typename XprType::Nested>::type}
      &
00070   expression()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_expr; \}
00071 
00072   \textcolor{keyword}{protected}:
00073     \textcolor{keyword}{typename} XprType::Nested m\_expr;
00074     \textcolor{keyword}{const} CustomUnaryFunc m\_func;
00075 \};
00076 
00077 
00078 \textcolor{comment}{// Eval as rvalue}
00079 \textcolor{keyword}{template}<\textcolor{keyword}{typename} CustomUnaryFunc, \textcolor{keyword}{typename} XprType, \textcolor{keyword}{typename} Device>
\Hypertarget{eigen_2unsupported_2_eigen_2_c_x_x11_2src_2_tensor_2_tensor_custom_op_8h_source_l00080}\hyperlink{struct_eigen_1_1_tensor_evaluator_3_01const_01_tensor_custom_unary_op_3_01_custom_unary_func_00_c98bd2331846ae9855eae47ba436125b}{00080} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1_tensor_evaluator}{TensorEvaluator}<const \hyperlink{class_eigen_1_1_tensor_custom_unary_op}{TensorCustomUnaryOp}<CustomUnaryFunc, XprType
      >, Device>
00081 \{
00082   \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1_tensor_custom_unary_op}{TensorCustomUnaryOp<CustomUnaryFunc, XprType>} 
      \hyperlink{class_eigen_1_1_tensor_custom_unary_op}{ArgType};
00083   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1traits}{internal::traits<ArgType>::Index} 
      \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index};
00084   \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{int} NumDims = \hyperlink{struct_eigen_1_1internal_1_1traits}{internal::traits<ArgType>::NumDimensions}
      ;
00085   \textcolor{keyword}{typedef} \hyperlink{struct_eigen_1_1_d_sizes}{DSizes<Index, NumDims>} \hyperlink{struct_eigen_1_1_d_sizes}{Dimensions};
00086   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{internal::remove\_const<typename ArgType::Scalar>::type}
       \hyperlink{group___sparse_core___module}{Scalar};
00087   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} 
      \hyperlink{group___sparse_core___module}{internal::remove\_const<typename XprType::CoeffReturnType>::type}
       \hyperlink{group___sparse_core___module}{CoeffReturnType};
00088   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{PacketType<CoeffReturnType, Device>::type} 
      \hyperlink{group___sparse_core___module}{PacketReturnType};
00089   \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{int} PacketSize = 
      \hyperlink{struct_eigen_1_1internal_1_1unpacket__traits}{internal::unpacket\_traits<PacketReturnType>::size};
00090 
00091   \textcolor{keyword}{enum} \{
00092     IsAligned = \textcolor{keyword}{false},
00093     PacketAccess = (\hyperlink{struct_eigen_1_1internal_1_1packet__traits}{internal::packet\_traits<Scalar>::size} > 1),
00094     BlockAccess = \textcolor{keyword}{false},
00095     Layout = \hyperlink{struct_eigen_1_1_tensor_evaluator}{TensorEvaluator<XprType, Device>::Layout},
00096     CoordAccess = \textcolor{keyword}{false},  \textcolor{comment}{// to be implemented}
00097     RawAccess = \textcolor{keyword}{false}
00098   \};
00099 
00100   EIGEN\_DEVICE\_FUNC EIGEN\_STRONG\_INLINE \hyperlink{struct_eigen_1_1_tensor_evaluator}{TensorEvaluator}(\textcolor{keyword}{const} ArgType& op, \textcolor{keyword}{const} Device& 
      device)
00101       : m\_op(op), m\_device(device), m\_result(NULL)
00102   \{
00103     m\_dimensions = op.func().dimensions(op.expression());
00104   \}
00105 
00106   EIGEN\_DEVICE\_FUNC EIGEN\_STRONG\_INLINE \textcolor{keyword}{const} Dimensions& dimensions()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_dimensions; \}
00107 
00108   EIGEN\_DEVICE\_FUNC EIGEN\_STRONG\_INLINE \textcolor{keywordtype}{bool} evalSubExprsIfNeeded(CoeffReturnType* data) \{
00109     \textcolor{keywordflow}{if} (data) \{
00110       evalTo(data);
00111       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00112     \} \textcolor{keywordflow}{else} \{
00113       m\_result = \textcolor{keyword}{static\_cast<}CoeffReturnType*\textcolor{keyword}{>}(
00114           m\_device.allocate(dimensions().TotalSize() * \textcolor{keyword}{sizeof}(Scalar)));
00115       evalTo(m\_result);
00116       \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00117     \}
00118   \}
00119 
00120   EIGEN\_DEVICE\_FUNC EIGEN\_STRONG\_INLINE \textcolor{keywordtype}{void} cleanup() \{
00121     \textcolor{keywordflow}{if} (m\_result != NULL) \{
00122       m\_device.deallocate(m\_result);
00123       m\_result = NULL;
00124     \}
00125   \}
00126 
00127   EIGEN\_DEVICE\_FUNC EIGEN\_STRONG\_INLINE CoeffReturnType coeff(Index index)\textcolor{keyword}{ const }\{
00128     \textcolor{keywordflow}{return} m\_result[index];
00129   \}
00130 
00131   \textcolor{keyword}{template}<\textcolor{keywordtype}{int} LoadMode>
00132   EIGEN\_DEVICE\_FUNC PacketReturnType packet(Index index)\textcolor{keyword}{ const }\{
00133     \textcolor{keywordflow}{return} internal::ploadt<PacketReturnType, LoadMode>(m\_result + index);
00134   \}
00135 
00136   EIGEN\_DEVICE\_FUNC EIGEN\_STRONG\_INLINE \hyperlink{class_eigen_1_1_tensor_op_cost}{TensorOpCost} costPerCoeff(\textcolor{keywordtype}{bool} vectorized)\textcolor{keyword}{ const }\{
00137     \textcolor{comment}{// TODO(rmlarsen): Extend CustomOp API to return its cost estimate.}
00138     \textcolor{keywordflow}{return} \hyperlink{class_eigen_1_1_tensor_op_cost}{TensorOpCost}(\textcolor{keyword}{sizeof}(CoeffReturnType), 0, 0, vectorized, PacketSize);
00139   \}
00140 
00141   EIGEN\_DEVICE\_FUNC CoeffReturnType* data()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_result; \}
00142 
00143  \textcolor{keyword}{protected}:
00144   EIGEN\_DEVICE\_FUNC \textcolor{keywordtype}{void} evalTo(Scalar* data) \{
00145     \hyperlink{class_eigen_1_1_tensor_map}{TensorMap<Tensor<CoeffReturnType, NumDims, Layout, Index>}
       > result(
00146         data, m\_dimensions);
00147     m\_op.func().eval(m\_op.expression(), result, m\_device);
00148   \}
00149 
00150   Dimensions m\_dimensions;
00151   \textcolor{keyword}{const} ArgType m\_op;
00152   \textcolor{keyword}{const} Device& m\_device;
00153   CoeffReturnType* m\_result;
00154 \};
00155 
00156 
00157 
00165 \textcolor{keyword}{namespace }\hyperlink{namespaceinternal}{internal} \{
00166 \textcolor{keyword}{template}<\textcolor{keyword}{typename} CustomBinaryFunc, \textcolor{keyword}{typename} LhsXprType, \textcolor{keyword}{typename} RhsXprType>
\Hypertarget{eigen_2unsupported_2_eigen_2_c_x_x11_2src_2_tensor_2_tensor_custom_op_8h_source_l00167}\hyperlink{struct_eigen_1_1internal_1_1traits_3_01_tensor_custom_binary_op_3_01_custom_binary_func_00_01_lh13ec16c8467537dd695eeaba8e396b16}{00167} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1traits}{traits}<\hyperlink{class_eigen_1_1_tensor_custom_binary_op}{TensorCustomBinaryOp}<CustomBinaryFunc, LhsXprType, RhsXprType> >
00168 \{
00169   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1promote__storage__type}{internal::promote\_storage\_type}<\textcolor{keyword}{typename} LhsXprType::Scalar
      ,
00170                                                   \textcolor{keyword}{typename} RhsXprType::Scalar>::ret Scalar;
00171   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1promote__storage__type}{internal::promote\_storage\_type}<\textcolor{keyword}{typename} 
      LhsXprType::CoeffReturnType,
00172                                                   \textcolor{keyword}{typename} RhsXprType::CoeffReturnType>::ret 
      CoeffReturnType;
00173   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1promote__storage__type}{promote\_storage\_type<typename traits<LhsXprType>::StorageKind}
      ,
00174                                         \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1traits}{traits<RhsXprType>::StorageKind}
      >::ret StorageKind;
00175   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1promote__index__type}{promote\_index\_type<typename traits<LhsXprType>::Index}
      ,
00176                                       \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1traits}{traits<RhsXprType>::Index}>::type 
      \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index};
00177   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} LhsXprType::Nested LhsNested;
00178   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} RhsXprType::Nested RhsNested;
00179   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{remove\_reference<LhsNested>::type} 
      \hyperlink{group___sparse_core___module}{\_LhsNested};
00180   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{remove\_reference<RhsNested>::type} 
      \hyperlink{group___sparse_core___module}{\_RhsNested};
00181   \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{int} NumDimensions = \hyperlink{struct_eigen_1_1internal_1_1traits}{traits<LhsXprType>::NumDimensions};
00182   \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{int} Layout = \hyperlink{struct_eigen_1_1internal_1_1traits}{traits<LhsXprType>::Layout};
00183 \};
00184 
00185 \textcolor{keyword}{template}<\textcolor{keyword}{typename} CustomBinaryFunc, \textcolor{keyword}{typename} LhsXprType, \textcolor{keyword}{typename} RhsXprType>
\Hypertarget{eigen_2unsupported_2_eigen_2_c_x_x11_2src_2_tensor_2_tensor_custom_op_8h_source_l00186}\hyperlink{struct_eigen_1_1internal_1_1eval_3_01_tensor_custom_binary_op_3_01_custom_binary_func_00_01_lhs_0b3fac7023a8693ad10b9b9dcfd17f7c}{00186} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1eval}{eval}<\hyperlink{class_eigen_1_1_tensor_custom_binary_op}{TensorCustomBinaryOp}<CustomBinaryFunc, LhsXprType, RhsXprType>, 
      \hyperlink{namespace_eigen}{Eigen}::\hyperlink{struct_eigen_1_1_dense}{Dense}>
00187 \{
00188   \textcolor{keyword}{typedef} \textcolor{keyword}{const} \hyperlink{class_eigen_1_1_tensor_custom_binary_op}{TensorCustomBinaryOp<CustomBinaryFunc, LhsXprType, RhsXprType>}
      & \hyperlink{class_eigen_1_1_tensor_custom_binary_op}{type};
00189 \};
00190 
00191 \textcolor{keyword}{template}<\textcolor{keyword}{typename} CustomBinaryFunc, \textcolor{keyword}{typename} LhsXprType, \textcolor{keyword}{typename} RhsXprType>
\Hypertarget{eigen_2unsupported_2_eigen_2_c_x_x11_2src_2_tensor_2_tensor_custom_op_8h_source_l00192}\hyperlink{struct_eigen_1_1internal_1_1nested_3_01_tensor_custom_binary_op_3_01_custom_binary_func_00_01_lh0ebeaddb698d52bc5880e3a8cd1df790}{00192} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1nested}{nested}<\hyperlink{class_eigen_1_1_tensor_custom_binary_op}{TensorCustomBinaryOp}<CustomBinaryFunc, LhsXprType, RhsXprType> >
00193 \{
00194   \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1_tensor_custom_binary_op}{TensorCustomBinaryOp<CustomBinaryFunc, LhsXprType, RhsXprType>}
       \hyperlink{class_eigen_1_1_tensor_custom_binary_op}{type};
00195 \};
00196 
00197 \}  \textcolor{comment}{// end namespace internal}
00198 
00199 
00200 
00201 \textcolor{keyword}{template}<\textcolor{keyword}{typename} CustomBinaryFunc, \textcolor{keyword}{typename} LhsXprType, \textcolor{keyword}{typename} RhsXprType>
\Hypertarget{eigen_2unsupported_2_eigen_2_c_x_x11_2src_2_tensor_2_tensor_custom_op_8h_source_l00202}\hyperlink{class_eigen_1_1_tensor_custom_binary_op}{00202} \textcolor{keyword}{class }\hyperlink{class_eigen_1_1_tensor_custom_binary_op}{TensorCustomBinaryOp} : \textcolor{keyword}{public} \hyperlink{class_eigen_1_1_tensor_base}{TensorBase}<TensorCustomBinaryOp<CustomBin
      aryFunc, LhsXprType, RhsXprType>, ReadOnlyAccessors>
00203 \{
00204   \textcolor{keyword}{public}:
00205   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1traits}{internal::traits<TensorCustomBinaryOp>::Scalar}
       Scalar;
00206   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{Eigen::NumTraits<Scalar>::Real} 
      \hyperlink{group___sparse_core___module}{RealScalar};
00207   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1traits}{internal::traits<TensorCustomBinaryOp>::CoeffReturnType}
       CoeffReturnType;
00208   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{class_eigen_1_1internal_1_1_tensor_lazy_evaluator_writable}{internal::nested<TensorCustomBinaryOp>::type}
       \hyperlink{class_eigen_1_1internal_1_1_tensor_lazy_evaluator_writable}{Nested};
00209   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1traits}{internal::traits<TensorCustomBinaryOp>::StorageKind}
       StorageKind;
00210   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1traits}{internal::traits<TensorCustomBinaryOp>::Index}
       \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index};
00211 
00212   EIGEN\_DEVICE\_FUNC EIGEN\_STRONG\_INLINE \hyperlink{class_eigen_1_1_tensor_custom_binary_op}{TensorCustomBinaryOp}(\textcolor{keyword}{const} LhsXprType& lhs, \textcolor{keyword}{
      const} RhsXprType& rhs, \textcolor{keyword}{const} CustomBinaryFunc& \hyperlink{structfunc}{func})
00213 
00214       : m\_lhs\_xpr(lhs), m\_rhs\_xpr(rhs), m\_func(func) \{\}
00215 
00216   EIGEN\_DEVICE\_FUNC
00217   \textcolor{keyword}{const} CustomBinaryFunc& func()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_func; \}
00218 
00219   EIGEN\_DEVICE\_FUNC
00220   \textcolor{keyword}{const} \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{internal::remove\_all<typename LhsXprType::Nested>::type}
      &
00221   lhsExpression()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_lhs\_xpr; \}
00222 
00223   EIGEN\_DEVICE\_FUNC
00224   \textcolor{keyword}{const} \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{internal::remove\_all<typename RhsXprType::Nested>::type}
      &
00225   rhsExpression()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_rhs\_xpr; \}
00226 
00227   \textcolor{keyword}{protected}:
00228     \textcolor{keyword}{typename} LhsXprType::Nested m\_lhs\_xpr;
00229     \textcolor{keyword}{typename} RhsXprType::Nested m\_rhs\_xpr;
00230     \textcolor{keyword}{const} CustomBinaryFunc m\_func;
00231 \};
00232 
00233 
00234 \textcolor{comment}{// Eval as rvalue}
00235 \textcolor{keyword}{template}<\textcolor{keyword}{typename} CustomBinaryFunc, \textcolor{keyword}{typename} LhsXprType, \textcolor{keyword}{typename} RhsXprType, \textcolor{keyword}{typename} Device>
\Hypertarget{eigen_2unsupported_2_eigen_2_c_x_x11_2src_2_tensor_2_tensor_custom_op_8h_source_l00236}\hyperlink{struct_eigen_1_1_tensor_evaluator_3_01const_01_tensor_custom_binary_op_3_01_custom_binary_func_0fea6836b993af318b6a5ab54d775368f}{00236} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1_tensor_evaluator}{TensorEvaluator}<const \hyperlink{class_eigen_1_1_tensor_custom_binary_op}{TensorCustomBinaryOp}<CustomBinaryFunc, 
      LhsXprType, RhsXprType>, Device>
00237 \{
00238   \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1_tensor_custom_binary_op}{TensorCustomBinaryOp<CustomBinaryFunc, LhsXprType, RhsXprType>}
       \hyperlink{class_eigen_1_1_tensor_custom_binary_op}{XprType};
00239   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1traits}{internal::traits<XprType>::Index} 
      \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index};
00240   \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{int} NumDims = \hyperlink{struct_eigen_1_1internal_1_1traits}{internal::traits<XprType>::NumDimensions}
      ;
00241   \textcolor{keyword}{typedef} \hyperlink{struct_eigen_1_1_d_sizes}{DSizes<Index, NumDims>} \hyperlink{struct_eigen_1_1_d_sizes}{Dimensions};
00242   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} XprType::Scalar Scalar;
00243   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} 
      \hyperlink{group___sparse_core___module}{internal::remove\_const<typename XprType::CoeffReturnType>::type}
       \hyperlink{group___sparse_core___module}{CoeffReturnType};
00244   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{PacketType<CoeffReturnType, Device>::type} 
      \hyperlink{group___sparse_core___module}{PacketReturnType};
00245   \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{int} PacketSize = 
      \hyperlink{struct_eigen_1_1internal_1_1unpacket__traits}{internal::unpacket\_traits<PacketReturnType>::size};
00246 
00247   \textcolor{keyword}{enum} \{
00248     IsAligned = \textcolor{keyword}{false},
00249     PacketAccess = (\hyperlink{struct_eigen_1_1internal_1_1packet__traits}{internal::packet\_traits<Scalar>::size} > 1),
00250     BlockAccess = \textcolor{keyword}{false},
00251     Layout = \hyperlink{struct_eigen_1_1_tensor_evaluator}{TensorEvaluator<LhsXprType, Device>::Layout},
00252     CoordAccess = \textcolor{keyword}{false},  \textcolor{comment}{// to be implemented}
00253     RawAccess = \textcolor{keyword}{false}
00254   \};
00255 
00256   EIGEN\_DEVICE\_FUNC EIGEN\_STRONG\_INLINE \hyperlink{struct_eigen_1_1_tensor_evaluator}{TensorEvaluator}(\textcolor{keyword}{const} XprType& op, \textcolor{keyword}{const} Device& 
      device)
00257       : m\_op(op), m\_device(device), m\_result(NULL)
00258   \{
00259     m\_dimensions = op.func().dimensions(op.lhsExpression(), op.rhsExpression());
00260   \}
00261 
00262   EIGEN\_DEVICE\_FUNC EIGEN\_STRONG\_INLINE \textcolor{keyword}{const} Dimensions& dimensions()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_dimensions; \}
00263 
00264   EIGEN\_DEVICE\_FUNC EIGEN\_STRONG\_INLINE \textcolor{keywordtype}{bool} evalSubExprsIfNeeded(CoeffReturnType* data) \{
00265     \textcolor{keywordflow}{if} (data) \{
00266       evalTo(data);
00267       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00268     \} \textcolor{keywordflow}{else} \{
00269       m\_result = \textcolor{keyword}{static\_cast<}Scalar *\textcolor{keyword}{>}(m\_device.allocate(dimensions().TotalSize() * \textcolor{keyword}{sizeof}(Scalar)));
00270       evalTo(m\_result);
00271       \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00272     \}
00273   \}
00274 
00275   EIGEN\_DEVICE\_FUNC EIGEN\_STRONG\_INLINE \textcolor{keywordtype}{void} cleanup() \{
00276     \textcolor{keywordflow}{if} (m\_result != NULL) \{
00277       m\_device.deallocate(m\_result);
00278       m\_result = NULL;
00279     \}
00280   \}
00281 
00282   EIGEN\_DEVICE\_FUNC EIGEN\_STRONG\_INLINE CoeffReturnType coeff(Index index)\textcolor{keyword}{ const }\{
00283     \textcolor{keywordflow}{return} m\_result[index];
00284   \}
00285 
00286   \textcolor{keyword}{template}<\textcolor{keywordtype}{int} LoadMode>
00287   EIGEN\_DEVICE\_FUNC PacketReturnType packet(Index index)\textcolor{keyword}{ const }\{
00288     \textcolor{keywordflow}{return} internal::ploadt<PacketReturnType, LoadMode>(m\_result + index);
00289   \}
00290 
00291   EIGEN\_DEVICE\_FUNC EIGEN\_STRONG\_INLINE \hyperlink{class_eigen_1_1_tensor_op_cost}{TensorOpCost} costPerCoeff(\textcolor{keywordtype}{bool} vectorized)\textcolor{keyword}{ const }\{
00292     \textcolor{comment}{// TODO(rmlarsen): Extend CustomOp API to return its cost estimate.}
00293     \textcolor{keywordflow}{return} \hyperlink{class_eigen_1_1_tensor_op_cost}{TensorOpCost}(\textcolor{keyword}{sizeof}(CoeffReturnType), 0, 0, vectorized, PacketSize);
00294   \}
00295 
00296   EIGEN\_DEVICE\_FUNC CoeffReturnType* data()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_result; \}
00297 
00298  \textcolor{keyword}{protected}:
00299   EIGEN\_DEVICE\_FUNC \textcolor{keywordtype}{void} evalTo(Scalar* data) \{
00300     \hyperlink{class_eigen_1_1_tensor_map}{TensorMap<Tensor<Scalar, NumDims, Layout>} > result(data, 
      m\_dimensions);
00301     m\_op.func().eval(m\_op.lhsExpression(), m\_op.rhsExpression(), result, m\_device);
00302   \}
00303 
00304   Dimensions m\_dimensions;
00305   \textcolor{keyword}{const} XprType m\_op;
00306   \textcolor{keyword}{const} Device& m\_device;
00307   CoeffReturnType* m\_result;
00308 \};
00309 
00310 
00311 \} \textcolor{comment}{// end namespace Eigen}
00312 
00313 \textcolor{preprocessor}{#endif // EIGEN\_CXX11\_TENSOR\_TENSOR\_CUSTOM\_OP\_H}
\end{DoxyCode}
