\hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2test_2kronecker__product_8cpp_source}{}\section{matio/visual\+\_\+studio/test/eigen/unsupported/test/kronecker\+\_\+product.cpp}
\label{matio_2visual__studio_2test_2eigen_2unsupported_2test_2kronecker__product_8cpp_source}\index{kronecker\+\_\+product.\+cpp@{kronecker\+\_\+product.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2011 Kolja Brix <brix@igpm.rwth-aachen.de>}
00005 \textcolor{comment}{// Copyright (C) 2011 Andreas Platen <andiplaten@gmx.de>}
00006 \textcolor{comment}{// Copyright (C) 2012 Chen-Pang He <jdh8@ms63.hinet.net>}
00007 \textcolor{comment}{//}
00008 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00009 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00010 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00011 
00012 \textcolor{preprocessor}{#ifdef EIGEN\_TEST\_PART\_1}
00013 
00014 \textcolor{preprocessor}{#include "sparse.h"}
00015 \textcolor{preprocessor}{#include <Eigen/SparseExtra>}
00016 \textcolor{preprocessor}{#include <Eigen/KroneckerProduct>}
00017 
00018 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>
00019 \textcolor{keywordtype}{void} check\_dimension(\textcolor{keyword}{const} MatrixType& ab, \textcolor{keyword}{const} \textcolor{keywordtype}{int} rows,  \textcolor{keyword}{const} \textcolor{keywordtype}{int} cols)
00020 \{
00021   VERIFY\_IS\_EQUAL(ab.rows(), rows);
00022   VERIFY\_IS\_EQUAL(ab.cols(), cols);
00023 \}
00024 
00025 
00026 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>
00027 \textcolor{keywordtype}{void} check\_kronecker\_product(\textcolor{keyword}{const} MatrixType& ab)
00028 \{
00029   VERIFY\_IS\_EQUAL(ab.rows(), 6);
00030   VERIFY\_IS\_EQUAL(ab.cols(), 6);
00031   VERIFY\_IS\_EQUAL(ab.nonZeros(),  36);
00032   VERIFY\_IS\_APPROX(ab.coeff(0,0), -0.4017367630386106);
00033   VERIFY\_IS\_APPROX(ab.coeff(0,1),  0.1056863433932735);
00034   VERIFY\_IS\_APPROX(ab.coeff(0,2), -0.7255206194554212);
00035   VERIFY\_IS\_APPROX(ab.coeff(0,3),  0.1908653336744706);
00036   VERIFY\_IS\_APPROX(ab.coeff(0,4),  0.350864567234111);
00037   VERIFY\_IS\_APPROX(ab.coeff(0,5), -0.0923032108308013);
00038   VERIFY\_IS\_APPROX(ab.coeff(1,0),  0.415417514804677);
00039   VERIFY\_IS\_APPROX(ab.coeff(1,1), -0.2369227701722048);
00040   VERIFY\_IS\_APPROX(ab.coeff(1,2),  0.7502275131458511);
00041   VERIFY\_IS\_APPROX(ab.coeff(1,3), -0.4278731019742696);
00042   VERIFY\_IS\_APPROX(ab.coeff(1,4), -0.3628129162264507);
00043   VERIFY\_IS\_APPROX(ab.coeff(1,5),  0.2069210808481275);
00044   VERIFY\_IS\_APPROX(ab.coeff(2,0),  0.05465890160863986);
00045   VERIFY\_IS\_APPROX(ab.coeff(2,1), -0.2634092511419858);
00046   VERIFY\_IS\_APPROX(ab.coeff(2,2),  0.09871180285793758);
00047   VERIFY\_IS\_APPROX(ab.coeff(2,3), -0.4757066334017702);
00048   VERIFY\_IS\_APPROX(ab.coeff(2,4), -0.04773740823058334);
00049   VERIFY\_IS\_APPROX(ab.coeff(2,5),  0.2300535609645254);
00050   VERIFY\_IS\_APPROX(ab.coeff(3,0), -0.8172945853260133);
00051   VERIFY\_IS\_APPROX(ab.coeff(3,1),  0.2150086428359221);
00052   VERIFY\_IS\_APPROX(ab.coeff(3,2),  0.5825113847292743);
00053   VERIFY\_IS\_APPROX(ab.coeff(3,3), -0.1532433770097174);
00054   VERIFY\_IS\_APPROX(ab.coeff(3,4), -0.329383387282399);
00055   VERIFY\_IS\_APPROX(ab.coeff(3,5),  0.08665207912033064);
00056   VERIFY\_IS\_APPROX(ab.coeff(4,0),  0.8451267514863225);
00057   VERIFY\_IS\_APPROX(ab.coeff(4,1), -0.481996458918977);
00058   VERIFY\_IS\_APPROX(ab.coeff(4,2), -0.6023482390791535);
00059   VERIFY\_IS\_APPROX(ab.coeff(4,3),  0.3435339347164565);
00060   VERIFY\_IS\_APPROX(ab.coeff(4,4),  0.3406002157428891);
00061   VERIFY\_IS\_APPROX(ab.coeff(4,5), -0.1942526344200915);
00062   VERIFY\_IS\_APPROX(ab.coeff(5,0),  0.1111982482925399);
00063   VERIFY\_IS\_APPROX(ab.coeff(5,1), -0.5358806424754169);
00064   VERIFY\_IS\_APPROX(ab.coeff(5,2), -0.07925446559335647);
00065   VERIFY\_IS\_APPROX(ab.coeff(5,3),  0.3819388757769038);
00066   VERIFY\_IS\_APPROX(ab.coeff(5,4),  0.04481475387219876);
00067   VERIFY\_IS\_APPROX(ab.coeff(5,5), -0.2159688616158057);
00068 \}
00069 
00070 
00071 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>
00072 \textcolor{keywordtype}{void} check\_sparse\_kronecker\_product(\textcolor{keyword}{const} MatrixType& ab)
00073 \{
00074   VERIFY\_IS\_EQUAL(ab.rows(), 12);
00075   VERIFY\_IS\_EQUAL(ab.cols(), 10);
00076   VERIFY\_IS\_EQUAL(ab.nonZeros(), 3*2);
00077   VERIFY\_IS\_APPROX(ab.coeff(3,0), -0.04);
00078   VERIFY\_IS\_APPROX(ab.coeff(5,1),  0.05);
00079   VERIFY\_IS\_APPROX(ab.coeff(0,6), -0.08);
00080   VERIFY\_IS\_APPROX(ab.coeff(2,7),  0.10);
00081   VERIFY\_IS\_APPROX(ab.coeff(6,8),  0.12);
00082   VERIFY\_IS\_APPROX(ab.coeff(8,9), -0.15);
00083 \}
00084 
00085 
00086 \textcolor{keywordtype}{void} test\_kronecker\_product()
00087 \{
00088   \textcolor{comment}{// DM = dense matrix; SM = sparse matrix}
00089 
00090   Matrix<double, 2, 3> DM\_a;
00091   SparseMatrix<double> SM\_a(2,3);
00092   SM\_a.insert(0,0) = DM\_a.coeffRef(0,0) = -0.4461540300782201;
00093   SM\_a.insert(0,1) = DM\_a.coeffRef(0,1) = -0.8057364375283049;
00094   SM\_a.insert(0,2) = DM\_a.coeffRef(0,2) =  0.3896572459516341;
00095   SM\_a.insert(1,0) = DM\_a.coeffRef(1,0) = -0.9076572187376921;
00096   SM\_a.insert(1,1) = DM\_a.coeffRef(1,1) =  0.6469156566545853;
00097   SM\_a.insert(1,2) = DM\_a.coeffRef(1,2) = -0.3658010398782789;
00098  
00099   MatrixXd             DM\_b(3,2);
00100   SparseMatrix<double> SM\_b(3,2);
00101   SM\_b.insert(0,0) = DM\_b.coeffRef(0,0) =  0.9004440976767099;
00102   SM\_b.insert(0,1) = DM\_b.coeffRef(0,1) = -0.2368830858139832;
00103   SM\_b.insert(1,0) = DM\_b.coeffRef(1,0) = -0.9311078389941825;
00104   SM\_b.insert(1,1) = DM\_b.coeffRef(1,1) =  0.5310335762980047;
00105   SM\_b.insert(2,0) = DM\_b.coeffRef(2,0) = -0.1225112806872035;
00106   SM\_b.insert(2,1) = DM\_b.coeffRef(2,1) =  0.5903998022741264;
00107 
00108   SparseMatrix<double,RowMajor> SM\_row\_a(SM\_a), SM\_row\_b(SM\_b);
00109 
00110   \textcolor{comment}{// test DM\_fixedSize = kroneckerProduct(DM\_block,DM)}
00111   Matrix<double, 6, 6> DM\_fix\_ab = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(DM\_a.topLeftCorner<2,3>(),DM\_b);
00112 
00113   CALL\_SUBTEST(check\_kronecker\_product(DM\_fix\_ab));
00114   CALL\_SUBTEST(check\_kronecker\_product(\hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(DM\_a.topLeftCorner<2,3>(),DM\_b)));
00115 
00116   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0;i<DM\_fix\_ab.rows();++i)
00117     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} j=0;j<DM\_fix\_ab.cols();++j)
00118        VERIFY\_IS\_APPROX(\hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(DM\_a,DM\_b).coeff(i,j), DM\_fix\_ab(i,j));
00119 
00120   \textcolor{comment}{// test DM\_block = kroneckerProduct(DM,DM)}
00121   MatrixXd DM\_block\_ab(10,15);
00122   DM\_block\_ab.block<6,6>(2,5) = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(DM\_a,DM\_b);
00123   CALL\_SUBTEST(check\_kronecker\_product(DM\_block\_ab.block<6,6>(2,5)));
00124 
00125   \textcolor{comment}{// test DM = kroneckerProduct(DM,DM)}
00126   MatrixXd DM\_ab = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(DM\_a,DM\_b);
00127   CALL\_SUBTEST(check\_kronecker\_product(DM\_ab));
00128   CALL\_SUBTEST(check\_kronecker\_product(\hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(DM\_a,DM\_b)));
00129 
00130   \textcolor{comment}{// test SM = kroneckerProduct(SM,DM)}
00131   SparseMatrix<double> SM\_ab = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(SM\_a,DM\_b);
00132   CALL\_SUBTEST(check\_kronecker\_product(SM\_ab));
00133   SparseMatrix<double,RowMajor> SM\_ab2 = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(SM\_a,DM\_b);
00134   CALL\_SUBTEST(check\_kronecker\_product(SM\_ab2));
00135   CALL\_SUBTEST(check\_kronecker\_product(\hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(SM\_a,DM\_b)));
00136 
00137   \textcolor{comment}{// test SM = kroneckerProduct(DM,SM)}
00138   SM\_ab.setZero();
00139   SM\_ab.insert(0,0)=37.0;
00140   SM\_ab = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(DM\_a,SM\_b);
00141   CALL\_SUBTEST(check\_kronecker\_product(SM\_ab));
00142   SM\_ab2.setZero();
00143   SM\_ab2.insert(0,0)=37.0;
00144   SM\_ab2 = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(DM\_a,SM\_b);
00145   CALL\_SUBTEST(check\_kronecker\_product(SM\_ab2));
00146   CALL\_SUBTEST(check\_kronecker\_product(\hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(DM\_a,SM\_b)));
00147 
00148   \textcolor{comment}{// test SM = kroneckerProduct(SM,SM)}
00149   SM\_ab.resize(2,33);
00150   SM\_ab.insert(0,0)=37.0;
00151   SM\_ab = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(SM\_a,SM\_b);
00152   CALL\_SUBTEST(check\_kronecker\_product(SM\_ab));
00153   SM\_ab2.resize(5,11);
00154   SM\_ab2.insert(0,0)=37.0;
00155   SM\_ab2 = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(SM\_a,SM\_b);
00156   CALL\_SUBTEST(check\_kronecker\_product(SM\_ab2));
00157   CALL\_SUBTEST(check\_kronecker\_product(\hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(SM\_a,SM\_b)));
00158 
00159   \textcolor{comment}{// test SM = kroneckerProduct(SM,SM) with sparse pattern}
00160   SM\_a.resize(4,5);
00161   SM\_b.resize(3,2);
00162   SM\_a.resizeNonZeros(0);
00163   SM\_b.resizeNonZeros(0);
00164   SM\_a.insert(1,0) = -0.1;
00165   SM\_a.insert(0,3) = -0.2;
00166   SM\_a.insert(2,4) =  0.3;
00167   SM\_a.finalize();
00168   
00169   SM\_b.insert(0,0) =  0.4;
00170   SM\_b.insert(2,1) = -0.5;
00171   SM\_b.finalize();
00172   SM\_ab.resize(1,1);
00173   SM\_ab.insert(0,0)=37.0;
00174   SM\_ab = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(SM\_a,SM\_b);
00175   CALL\_SUBTEST(check\_sparse\_kronecker\_product(SM\_ab));
00176 
00177   \textcolor{comment}{// test dimension of result of DM = kroneckerProduct(DM,DM)}
00178   MatrixXd DM\_a2(2,1);
00179   MatrixXd DM\_b2(5,4);
00180   MatrixXd DM\_ab2 = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(DM\_a2,DM\_b2);
00181   CALL\_SUBTEST(check\_dimension(DM\_ab2,2*5,1*4));
00182   DM\_a2.resize(10,9);
00183   DM\_b2.resize(4,8);
00184   DM\_ab2 = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(DM\_a2,DM\_b2);
00185   CALL\_SUBTEST(check\_dimension(DM\_ab2,10*4,9*8));
00186   
00187   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 0; i < g\_repeat; i++)
00188   \{
00189     \textcolor{keywordtype}{double} density = Eigen::internal::random<double>(0.01,0.5);
00190     \textcolor{keywordtype}{int} ra = Eigen::internal::random<int>(1,50);
00191     \textcolor{keywordtype}{int} ca = Eigen::internal::random<int>(1,50);
00192     \textcolor{keywordtype}{int} rb = Eigen::internal::random<int>(1,50);
00193     \textcolor{keywordtype}{int} cb = Eigen::internal::random<int>(1,50);
00194     SparseMatrix<float,ColMajor> sA(ra,ca), sB(rb,cb), sC;
00195     SparseMatrix<float,RowMajor> sC2;
00196     MatrixXf dA(ra,ca), dB(rb,cb), dC;
00197     initSparse(density, dA, sA);
00198     initSparse(density, dB, sB);
00199     
00200     sC = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(sA,sB);
00201     dC = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(dA,dB);
00202     VERIFY\_IS\_APPROX(MatrixXf(sC),dC);
00203     
00204     sC = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(sA.transpose(),sB);
00205     dC = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(dA.transpose(),dB);
00206     VERIFY\_IS\_APPROX(MatrixXf(sC),dC);
00207     
00208     sC = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(sA.transpose(),sB.transpose());
00209     dC = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(dA.transpose(),dB.transpose());
00210     VERIFY\_IS\_APPROX(MatrixXf(sC),dC);
00211     
00212     sC = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(sA,sB.transpose());
00213     dC = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(dA,dB.transpose());
00214     VERIFY\_IS\_APPROX(MatrixXf(sC),dC);
00215     
00216     sC2 = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(sA,sB);
00217     dC = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(dA,dB);
00218     VERIFY\_IS\_APPROX(MatrixXf(sC2),dC);
00219     
00220     sC2 = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(dA,sB);
00221     dC = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(dA,dB);
00222     VERIFY\_IS\_APPROX(MatrixXf(sC2),dC);
00223     
00224     sC2 = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(sA,dB);
00225     dC = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(dA,dB);
00226     VERIFY\_IS\_APPROX(MatrixXf(sC2),dC);
00227     
00228     sC2 = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(2*sA,sB);
00229     dC = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(2*dA,dB);
00230     VERIFY\_IS\_APPROX(MatrixXf(sC2),dC);
00231   \}
00232 \}
00233 
00234 \textcolor{preprocessor}{#endif}
00235 
00236 \textcolor{preprocessor}{#ifdef EIGEN\_TEST\_PART\_2}
00237 
00238 \textcolor{comment}{// simply check that for a dense kronecker product, sparse module is not needed}
00239 
00240 \textcolor{preprocessor}{#include "main.h"}
00241 \textcolor{preprocessor}{#include <Eigen/KroneckerProduct>}
00242 
00243 \textcolor{keywordtype}{void} test\_kronecker\_product()
00244 \{
00245   MatrixXd a(2,2), b(3,3), c;
00246   a.setRandom();
00247   b.setRandom();
00248   c = \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(a,b);
00249   VERIFY\_IS\_APPROX(c.block(3,3,3,3), a(1,1)*b);
00250 \}
00251 
00252 \textcolor{preprocessor}{#endif}
\end{DoxyCode}
