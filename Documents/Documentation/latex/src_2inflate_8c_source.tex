\hypertarget{src_2inflate_8c_source}{}\section{src/inflate.c}
\label{src_2inflate_8c_source}\index{inflate.\+c@{inflate.\+c}}

\begin{DoxyCode}
00001 
00005 \textcolor{comment}{/*}
00006 \textcolor{comment}{ * Copyright (c) 2005-2018, Christopher C. Hulbert}
00007 \textcolor{comment}{ * All rights reserved.}
00008 \textcolor{comment}{ *}
00009 \textcolor{comment}{ * Redistribution and use in source and binary forms, with or without}
00010 \textcolor{comment}{ * modification, are permitted provided that the following conditions are met:}
00011 \textcolor{comment}{ *}
00012 \textcolor{comment}{ * 1. Redistributions of source code must retain the above copyright notice, this}
00013 \textcolor{comment}{ *    list of conditions and the following disclaimer.}
00014 \textcolor{comment}{ *}
00015 \textcolor{comment}{ * 2. Redistributions in binary form must reproduce the above copyright notice,}
00016 \textcolor{comment}{ *    this list of conditions and the following disclaimer in the documentation}
00017 \textcolor{comment}{ *    and/or other materials provided with the distribution.}
00018 \textcolor{comment}{ *}
00019 \textcolor{comment}{ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"}
00020 \textcolor{comment}{ * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE}
00021 \textcolor{comment}{ * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE}
00022 \textcolor{comment}{ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE}
00023 \textcolor{comment}{ * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL}
00024 \textcolor{comment}{ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR}
00025 \textcolor{comment}{ * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER}
00026 \textcolor{comment}{ * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,}
00027 \textcolor{comment}{ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE}
00028 \textcolor{comment}{ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.}
00029 \textcolor{comment}{ */}
00030 
00031 \textcolor{preprocessor}{#include <stdlib.h>}
00032 \textcolor{preprocessor}{#include "matio\_private.h"}
00033 
00034 \textcolor{preprocessor}{#if HAVE\_ZLIB}
00035 
00047 \textcolor{keywordtype}{size\_t}
00048 InflateSkip(\hyperlink{struct__mat__t}{mat\_t} *mat, z\_streamp z, \textcolor{keywordtype}{int} nbytes)
00049 \{
00050     mat\_uint8\_t comp\_buf[512],uncomp\_buf[512];
00051     \textcolor{keywordtype}{int}    n, err, cnt = 0;
00052     \textcolor{keywordtype}{size\_t} bytesread = 0;
00053 
00054     \textcolor{keywordflow}{if} ( nbytes < 1 )
00055         \textcolor{keywordflow}{return} 0;
00056 
00057     n = (nbytes<512) ? nbytes : 512;
00058     \textcolor{keywordflow}{if} ( !z->avail\_in ) \{
00059         z->next\_in = comp\_buf;
00060         z->avail\_in += fread(comp\_buf,1,n,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00061         bytesread   += z->avail\_in;
00062     \}
00063     z->avail\_out = n;
00064     z->next\_out  = uncomp\_buf;
00065     err = inflate(z,Z\_FULL\_FLUSH);
00066     \textcolor{keywordflow}{if} ( err == Z\_STREAM\_END ) \{
00067         \textcolor{keywordflow}{return} bytesread;
00068     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00069         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateSkip: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00070         \textcolor{keywordflow}{return} bytesread;
00071     \}
00072     \textcolor{keywordflow}{if} ( !z->avail\_out ) \{
00073         cnt += n;
00074         n = ((nbytes-cnt)<512) ? nbytes-cnt : 512;
00075         z->avail\_out = n;
00076         z->next\_out  = uncomp\_buf;
00077     \}
00078     \textcolor{keywordflow}{while} ( cnt < nbytes ) \{
00079         \textcolor{keywordflow}{if} ( !z->avail\_in ) \{
00080             z->next\_in   = comp\_buf;
00081             z->avail\_in += fread(comp\_buf,1,n,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00082             bytesread   += z->avail\_in;
00083         \}
00084         err = inflate(z,Z\_FULL\_FLUSH);
00085         \textcolor{keywordflow}{if} ( err == Z\_STREAM\_END ) \{
00086             \textcolor{keywordflow}{break};
00087         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00088             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateSkip: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00089             \textcolor{keywordflow}{break};
00090         \}
00091         \textcolor{keywordflow}{if} ( !z->avail\_out ) \{
00092             cnt         += n;
00093             n            = ((nbytes-cnt)<512) ? nbytes-cnt : 512;
00094             z->avail\_out = n;
00095             z->next\_out  = uncomp\_buf;
00096         \}
00097     \}
00098 
00099     \textcolor{keywordflow}{if} ( z->avail\_in ) \{
00100         \textcolor{keywordtype}{long} offset = -(long)z->avail\_in;
00101         (\textcolor{keywordtype}{void})fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},offset,SEEK\_CUR);
00102         bytesread -= z->avail\_in;
00103         z->avail\_in = 0;
00104     \}
00105 
00106     \textcolor{keywordflow}{return} bytesread;
00107 \}
00108 
00118 \textcolor{keywordtype}{size\_t}
00119 InflateSkip2(\hyperlink{struct__mat__t}{mat\_t} *mat, \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar, \textcolor{keywordtype}{int} nbytes)
00120 \{
00121     mat\_uint8\_t comp\_buf[32],uncomp\_buf[32];
00122     \textcolor{keywordtype}{int}    err, cnt = 0;
00123     \textcolor{keywordtype}{size\_t} bytesread = 0;
00124 
00125     \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00126         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00127         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00128         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00129     \}
00130     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out = 1;
00131     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_out = uncomp\_buf;
00132     err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00133     \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00134         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateSkip2: %s - inflate returned %s"},matvar->
      \hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},zError(err == Z\_NEED\_DICT ? Z\_DATA\_ERROR : err));
00135         \textcolor{keywordflow}{return} bytesread;
00136     \}
00137     \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out ) \{
00138         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out = 1;
00139         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_out = uncomp\_buf;
00140     \}
00141     \textcolor{keywordflow}{while} ( cnt < nbytes ) \{
00142         \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00143             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00144             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00145             bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00146             cnt++;
00147         \}
00148         err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00149         \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00150             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateSkip2: %s - inflate returned %s"},matvar->
      \hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},zError(err == Z\_NEED\_DICT ? Z\_DATA\_ERROR : err));
00151             \textcolor{keywordflow}{return} bytesread;
00152         \}
00153         \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out ) \{
00154             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out = 1;
00155             matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_out = uncomp\_buf;
00156         \}
00157     \}
00158 
00159     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00160         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},-(int)matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in,SEEK\_CUR);
00161         bytesread -= matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in;
00162         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 0;
00163     \}
00164 
00165     \textcolor{keywordflow}{return} bytesread;
00166 \}
00167 
00178 \textcolor{keywordtype}{size\_t}
00179 InflateSkipData(\hyperlink{struct__mat__t}{mat\_t} *mat,z\_streamp z,\textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} data\_type,\textcolor{keywordtype}{int} len)
00180 \{
00181     \textcolor{keywordtype}{int} data\_size = 0;
00182 
00183     \textcolor{keywordflow}{if} ( (mat == NULL) || (z == NULL) )
00184         \textcolor{keywordflow}{return} 0;
00185     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( len < 1 )
00186         \textcolor{keywordflow}{return} 0;
00187 
00188     \textcolor{keywordflow}{switch} ( data\_type ) \{
00189         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE}:
00190             data\_size = \textcolor{keyword}{sizeof}(double);
00191             \textcolor{keywordflow}{break};
00192         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a3a3657d40e9212c923d9b9d03531b64c}{MAT\_T\_SINGLE}:
00193             data\_size = \textcolor{keyword}{sizeof}(float);
00194             \textcolor{keywordflow}{break};
00195 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_INT64\_T}
00196         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9e825b5d18b8f946eaf2b4b57e51c145}{MAT\_T\_INT64}:
00197             data\_size = \textcolor{keyword}{sizeof}(mat\_int64\_t);
00198             \textcolor{keywordflow}{break};
00199 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* HAVE\_MAT\_INT64\_T */}\textcolor{preprocessor}{}
00200 \textcolor{preprocessor}{#ifdef HAVE\_MAT\_UINT64\_T}
00201         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a45547932c46be27118abe08302d7e29f}{MAT\_T\_UINT64}:
00202             data\_size = \textcolor{keyword}{sizeof}(mat\_uint64\_t);
00203             \textcolor{keywordflow}{break};
00204 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* HAVE\_MAT\_UINT64\_T */}\textcolor{preprocessor}{}
00205         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32}:
00206             data\_size = \textcolor{keyword}{sizeof}(mat\_int32\_t);
00207             \textcolor{keywordflow}{break};
00208         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32}:
00209             data\_size = \textcolor{keyword}{sizeof}(mat\_uint32\_t);
00210             \textcolor{keywordflow}{break};
00211         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a8c5b2e381946e95ea8d81ac216743302}{MAT\_T\_INT16}:
00212             data\_size = \textcolor{keyword}{sizeof}(mat\_int16\_t);
00213             \textcolor{keywordflow}{break};
00214         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16}:
00215             data\_size = \textcolor{keyword}{sizeof}(mat\_uint16\_t);
00216             \textcolor{keywordflow}{break};
00217         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a01c1bd7db68f90552862eb5d311be408}{MAT\_T\_UINT8}:
00218             data\_size = \textcolor{keyword}{sizeof}(mat\_uint8\_t);
00219             \textcolor{keywordflow}{break};
00220         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8}:
00221             data\_size = \textcolor{keyword}{sizeof}(mat\_int8\_t);
00222             \textcolor{keywordflow}{break};
00223         \textcolor{keywordflow}{default}:
00224             \textcolor{keywordflow}{return} 0;
00225     \}
00226     InflateSkip(mat,z,len*data\_size);
00227     \textcolor{keywordflow}{return} len;
00228 \}
00229 
00239 \textcolor{keywordtype}{size\_t}
00240 InflateVarTag(\hyperlink{struct__mat__t}{mat\_t} *mat, \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar, \textcolor{keywordtype}{void} *buf)
00241 \{
00242     mat\_uint8\_t comp\_buf[32];
00243     \textcolor{keywordtype}{int}    err;
00244     \textcolor{keywordtype}{size\_t} bytesread = 0;
00245 
00246     \textcolor{keywordflow}{if} ( buf == NULL )
00247         \textcolor{keywordflow}{return} 0;
00248 
00249     \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00250         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00251         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00252         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00253     \}
00254     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out = 8;
00255     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_out = (Bytef*)buf;
00256     err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00257     \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00258         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateVarTag: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00259         \textcolor{keywordflow}{return} bytesread;
00260     \}
00261     \textcolor{keywordflow}{while} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out && !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00262         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00263         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00264         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00265         err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00266         \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00267             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateVarTag: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00268             \textcolor{keywordflow}{return} bytesread;
00269         \}
00270     \}
00271 
00272     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00273         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},-(int)matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in,SEEK\_CUR);
00274         bytesread -= matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in;
00275         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 0;
00276     \}
00277 
00278     \textcolor{keywordflow}{return} bytesread;
00279 \}
00280 
00290 \textcolor{keywordtype}{size\_t}
00291 InflateArrayFlags(\hyperlink{struct__mat__t}{mat\_t} *mat, \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar, \textcolor{keywordtype}{void} *buf)
00292 \{
00293     mat\_uint8\_t comp\_buf[32];
00294     \textcolor{keywordtype}{int}    err;
00295     \textcolor{keywordtype}{size\_t} bytesread = 0;
00296 
00297     \textcolor{keywordflow}{if} ( buf == NULL )
00298         \textcolor{keywordflow}{return} 0;
00299 
00300     \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00301         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00302         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00303         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00304     \}
00305     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out = 16;
00306     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_out = (Bytef*)buf;
00307     err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00308     \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00309         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateArrayFlags: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00310         \textcolor{keywordflow}{return} bytesread;
00311     \}
00312     \textcolor{keywordflow}{while} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out && !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00313         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00314         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00315         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00316         err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00317         \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00318             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateArrayFlags: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00319             \textcolor{keywordflow}{return} bytesread;
00320         \}
00321     \}
00322 
00323     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00324         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},-(int)matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in,SEEK\_CUR);
00325         bytesread -= matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in;
00326         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 0;
00327     \}
00328 
00329     \textcolor{keywordflow}{return} bytesread;
00330 \}
00331 
00343 \textcolor{keywordtype}{size\_t}
00344 InflateDimensions(\hyperlink{struct__mat__t}{mat\_t} *mat, \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar, \textcolor{keywordtype}{void} *buf)
00345 \{
00346     mat\_uint8\_t comp\_buf[32];
00347     mat\_int32\_t tag[2];
00348     \textcolor{keywordtype}{int}    err, rank, i;
00349     \textcolor{keywordtype}{size\_t} bytesread = 0;
00350 
00351     \textcolor{keywordflow}{if} ( buf == NULL )
00352         \textcolor{keywordflow}{return} 0;
00353 
00354     \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00355         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00356         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00357         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00358     \}
00359     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out = 8;
00360     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_out = (Bytef*)buf;
00361     err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00362     \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00363         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateDimensions: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00364         \textcolor{keywordflow}{return} bytesread;
00365     \}
00366     \textcolor{keywordflow}{while} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out && !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00367         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00368         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00369         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00370         err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00371         \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00372             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateDimensions: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00373             \textcolor{keywordflow}{return} bytesread;
00374         \}
00375     \}
00376     tag[0] = *(\textcolor{keywordtype}{int} *)buf;
00377     tag[1] = *((\textcolor{keywordtype}{int} *)buf+1);
00378     \textcolor{keywordflow}{if} ( mat->\hyperlink{struct__mat__t_a99d207977af5e04941ace56d71817a40}{byteswap} ) \{
00379         \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag);
00380         \hyperlink{endian_8c_a2e0153996243f0a34df9a5286087cfa3}{Mat\_int32Swap}(tag+1);
00381     \}
00382     \textcolor{keywordflow}{if} ( (tag[0] & 0x0000ffff) != \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32} ) \{
00383         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateDimensions: Reading dimensions expected type MAT\_T\_INT32"});
00384         \textcolor{keywordflow}{return} bytesread;
00385     \}
00386     rank = tag[1];
00387     \textcolor{keywordflow}{if} ( rank % 8 != 0 )
00388         i = 8-(rank %8);
00389     \textcolor{keywordflow}{else}
00390         i = 0;
00391     rank+=i;
00392 
00393     \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00394         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00395         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00396         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00397     \}
00398     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out = rank;
00399     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_out = (Bytef*)((mat\_int32\_t *)buf+2);
00400     err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00401     \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00402         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateDimensions: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00403         \textcolor{keywordflow}{return} bytesread;
00404     \}
00405     \textcolor{keywordflow}{while} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out && !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00406         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00407         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00408         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00409         err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00410         \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00411             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateDimensions: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00412             \textcolor{keywordflow}{return} bytesread;
00413         \}
00414     \}
00415 
00416     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00417         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},-(int)matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in,SEEK\_CUR);
00418         bytesread -= matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in;
00419         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 0;
00420     \}
00421 
00422     \textcolor{keywordflow}{return} bytesread;
00423 \}
00424 
00433 \textcolor{keywordtype}{size\_t}
00434 InflateVarNameTag(\hyperlink{struct__mat__t}{mat\_t} *mat, \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar, \textcolor{keywordtype}{void} *buf)
00435 \{
00436     mat\_uint8\_t comp\_buf[32];
00437     \textcolor{keywordtype}{int}    err;
00438     \textcolor{keywordtype}{size\_t} bytesread = 0;
00439 
00440     \textcolor{keywordflow}{if} ( buf == NULL )
00441         \textcolor{keywordflow}{return} 0;
00442 
00443     \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00444         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00445         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00446         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00447     \}
00448     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out = 8;
00449     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_out = (Bytef*)buf;
00450     err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00451     \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00452         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateVarNameTag: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00453         \textcolor{keywordflow}{return} bytesread;
00454     \}
00455     \textcolor{keywordflow}{while} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out && !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00456         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00457         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00458         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00459         err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00460         \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00461             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateVarNameTag: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00462             \textcolor{keywordflow}{return} bytesread;
00463         \}
00464     \}
00465 
00466     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00467         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},-(int)matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in,SEEK\_CUR);
00468         bytesread -= matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in;
00469         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 0;
00470     \}
00471 
00472     \textcolor{keywordflow}{return} bytesread;
00473 \}
00474 
00484 \textcolor{keywordtype}{size\_t}
00485 InflateVarName(\hyperlink{struct__mat__t}{mat\_t} *mat, \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar, \textcolor{keywordtype}{void} *buf, \textcolor{keywordtype}{int} N)
00486 \{
00487     mat\_uint8\_t comp\_buf[32];
00488     \textcolor{keywordtype}{int}    err;
00489     \textcolor{keywordtype}{size\_t} bytesread = 0;
00490 
00491     \textcolor{keywordflow}{if} ( buf == NULL )
00492         \textcolor{keywordflow}{return} 0;
00493 
00494     \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00495         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00496         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00497         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00498     \}
00499     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out = N;
00500     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_out = (Bytef*)buf;
00501     err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00502     \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00503         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateVarName: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00504         \textcolor{keywordflow}{return} bytesread;
00505     \}
00506     \textcolor{keywordflow}{while} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out && !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00507         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00508         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00509         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00510         err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00511         \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00512             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateVarName: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00513             \textcolor{keywordflow}{return} bytesread;
00514         \}
00515     \}
00516 
00517     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00518         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},-(int)matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in,SEEK\_CUR);
00519         bytesread -= matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in;
00520         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 0;
00521     \}
00522 
00523     \textcolor{keywordflow}{return} bytesread;
00524 \}
00525 
00535 \textcolor{keywordtype}{size\_t}
00536 InflateDataTag(\hyperlink{struct__mat__t}{mat\_t} *mat, \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar, \textcolor{keywordtype}{void} *buf)
00537 \{
00538     mat\_uint8\_t comp\_buf[32];
00539     \textcolor{keywordtype}{int}    err;
00540     \textcolor{keywordtype}{size\_t} bytesread = 0;
00541 
00542     \textcolor{keywordflow}{if} ( buf == NULL )
00543         \textcolor{keywordflow}{return} 0;
00544 
00545    \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00546         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00547         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00548         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00549     \}
00550     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out = 8;
00551     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_out = (Bytef*)buf;
00552     err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00553     \textcolor{keywordflow}{if} ( err == Z\_STREAM\_END ) \{
00554         \textcolor{keywordflow}{return} bytesread;
00555     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00556         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateDataTag: %s - inflate returned %s"},matvar->
      \hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},zError(err == Z\_NEED\_DICT ? Z\_DATA\_ERROR : err));
00557         \textcolor{keywordflow}{return} bytesread;
00558     \}
00559     \textcolor{keywordflow}{while} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out && !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00560         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00561         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00562         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00563         err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00564         \textcolor{keywordflow}{if} ( err == Z\_STREAM\_END ) \{
00565             \textcolor{keywordflow}{break};
00566         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00567             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateDataTag: %s - inflate returned %s"},matvar->
      \hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},zError(err == Z\_NEED\_DICT ? Z\_DATA\_ERROR : err));
00568             \textcolor{keywordflow}{return} bytesread;
00569         \}
00570     \}
00571 
00572     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00573         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},-(int)matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in,SEEK\_CUR);
00574         bytesread -= matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in;
00575         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 0;
00576     \}
00577 
00578     \textcolor{keywordflow}{return} bytesread;
00579 \}
00580 
00590 \textcolor{keywordtype}{size\_t}
00591 InflateDataType(\hyperlink{struct__mat__t}{mat\_t} *mat, z\_streamp z, \textcolor{keywordtype}{void} *buf)
00592 \{
00593     mat\_uint8\_t comp\_buf[32];
00594     \textcolor{keywordtype}{int}    err;
00595     \textcolor{keywordtype}{size\_t} bytesread = 0;
00596 
00597     \textcolor{keywordflow}{if} ( buf == NULL )
00598         \textcolor{keywordflow}{return} 0;
00599 
00600     \textcolor{keywordflow}{if} ( !z->avail\_in ) \{
00601         z->avail\_in = 1;
00602         z->next\_in = comp\_buf;
00603         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00604     \}
00605     z->avail\_out = 4;
00606     z->next\_out = (Bytef*)buf;
00607     err = inflate(z,Z\_NO\_FLUSH);
00608     \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00609         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateDataType: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00610         \textcolor{keywordflow}{return} bytesread;
00611     \}
00612     \textcolor{keywordflow}{while} ( z->avail\_out && !z->avail\_in ) \{
00613         z->avail\_in = 1;
00614         z->next\_in = comp\_buf;
00615         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00616         err = inflate(z,Z\_NO\_FLUSH);
00617         \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00618             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateDataType: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00619             \textcolor{keywordflow}{return} bytesread;
00620         \}
00621     \}
00622 
00623     \textcolor{keywordflow}{if} ( z->avail\_in ) \{
00624         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},-(int)z->avail\_in,SEEK\_CUR);
00625         bytesread -= z->avail\_in;
00626         z->avail\_in = 0;
00627     \}
00628 
00629     \textcolor{keywordflow}{return} bytesread;
00630 \}
00631 
00642 \textcolor{keywordtype}{size\_t}
00643 InflateData(\hyperlink{struct__mat__t}{mat\_t} *mat, z\_streamp z, \textcolor{keywordtype}{void} *buf, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nBytes)
00644 \{
00645     mat\_uint8\_t comp\_buf[1024];
00646     \textcolor{keywordtype}{int}    err;
00647     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} bytesread = 0;
00648 
00649     \textcolor{keywordflow}{if} ( buf == NULL )
00650         \textcolor{keywordflow}{return} 0;
00651     \textcolor{keywordflow}{if} ( nBytes == 0 ) \{
00652         \textcolor{keywordflow}{return} bytesread;
00653     \}
00654 
00655     \textcolor{keywordflow}{if} ( !z->avail\_in ) \{
00656         \textcolor{keywordflow}{if} ( nBytes > 1024 ) \{
00657             z->avail\_in = fread(comp\_buf,1,1024,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00658         \} \textcolor{keywordflow}{else} \{
00659             z->avail\_in = fread(comp\_buf,1,nBytes,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00660         \}
00661         bytesread += z->avail\_in;
00662         z->next\_in = comp\_buf;
00663     \}
00664     z->avail\_out = nBytes;
00665     z->next\_out = (Bytef*)buf;
00666     err = inflate(z,Z\_FULL\_FLUSH);
00667     \textcolor{keywordflow}{if} ( err == Z\_STREAM\_END ) \{
00668         \textcolor{keywordflow}{return} bytesread;
00669     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00670         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateData: inflate returned %s"},zError( err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err ));
00671         \textcolor{keywordflow}{return} bytesread;
00672     \}
00673     \textcolor{keywordflow}{while} ( z->avail\_out && !z->avail\_in ) \{
00674         \textcolor{keywordflow}{if} ( nBytes > 1024 + bytesread ) \{
00675             z->avail\_in = fread(comp\_buf,1,1024,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00676         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( nBytes < 1 + bytesread ) \{ \textcolor{comment}{/* Read a byte at a time */}
00677             z->avail\_in = fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00678         \} \textcolor{keywordflow}{else} \{
00679             z->avail\_in = fread(comp\_buf,1,nBytes-bytesread,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00680         \}
00681         bytesread += z->avail\_in;
00682         z->next\_in = comp\_buf;
00683         err = inflate(z,Z\_FULL\_FLUSH);
00684         \textcolor{keywordflow}{if} ( err == Z\_STREAM\_END ) \{
00685             \textcolor{keywordflow}{break};
00686         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( err != Z\_OK && err != Z\_BUF\_ERROR ) \{
00687             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateData: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00688             \textcolor{keywordflow}{break};
00689         \}
00690     \}
00691 
00692     \textcolor{keywordflow}{if} ( z->avail\_in ) \{
00693         \textcolor{keywordtype}{long} offset = -(long)z->avail\_in;
00694         (\textcolor{keywordtype}{void})fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},offset,SEEK\_CUR);
00695         bytesread -= z->avail\_in;
00696         z->avail\_in = 0;
00697     \}
00698 
00699     \textcolor{keywordflow}{return} bytesread;
00700 \}
00701 
00711 \textcolor{keywordtype}{size\_t}
00712 InflateFieldNameLength(\hyperlink{struct__mat__t}{mat\_t} *mat, \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar, \textcolor{keywordtype}{void} *buf)
00713 \{
00714     mat\_uint8\_t comp\_buf[32];
00715     \textcolor{keywordtype}{int}    err;
00716     \textcolor{keywordtype}{size\_t} bytesread = 0;
00717 
00718     \textcolor{keywordflow}{if} ( buf == NULL )
00719         \textcolor{keywordflow}{return} 0;
00720 
00721     \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00722         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00723         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00724         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00725     \}
00726     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out = 8;
00727     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_out = (Bytef*)buf;
00728     err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00729     \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00730         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateFieldNameLength: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00731         \textcolor{keywordflow}{return} bytesread;
00732     \}
00733     \textcolor{keywordflow}{while} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out && !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00734         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00735         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00736         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00737         err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00738         \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00739             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateFieldNameLength: inflate returned %s"},zError(err == 
      Z\_NEED\_DICT ? Z\_DATA\_ERROR : err));
00740             \textcolor{keywordflow}{return} bytesread;
00741         \}
00742     \}
00743 
00744     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00745         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},-(int)matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in,SEEK\_CUR);
00746         bytesread -= matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in;
00747         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 0;
00748     \}
00749 
00750     \textcolor{keywordflow}{return} bytesread;
00751 \}
00752 
00762 \textcolor{keywordtype}{size\_t}
00763 InflateFieldNamesTag(\hyperlink{struct__mat__t}{mat\_t} *mat, \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar, \textcolor{keywordtype}{void} *buf)
00764 \{
00765     mat\_uint8\_t comp\_buf[32];
00766     \textcolor{keywordtype}{int}    err;
00767     \textcolor{keywordtype}{size\_t} bytesread = 0;
00768 
00769     \textcolor{keywordflow}{if} ( buf == NULL )
00770         \textcolor{keywordflow}{return} 0;
00771 
00772     \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00773         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00774         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00775         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00776     \}
00777     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out = 8;
00778     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_out = (Bytef*)buf;
00779     err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00780     \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00781         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateFieldNamesTag: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00782         \textcolor{keywordflow}{return} bytesread;
00783     \}
00784     \textcolor{keywordflow}{while} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out && !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00785         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00786         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00787         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00788         err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00789         \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00790             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateFieldNamesTag: inflate returned %s"},zError(err == Z\_NEED\_DICT 
      ? Z\_DATA\_ERROR : err));
00791             \textcolor{keywordflow}{return} bytesread;
00792         \}
00793     \}
00794 
00795     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00796         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},-(int)matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in,SEEK\_CUR);
00797         bytesread -= matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in;
00798         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 0;
00799     \}
00800 
00801     \textcolor{keywordflow}{return} bytesread;
00802 \}
00803 
00804 \textcolor{comment}{/*}
00805 \textcolor{comment}{ * Inflates the structure's fieldname length.  buf must hold at least}
00806 \textcolor{comment}{ * nfields*fieldname\_length bytes}
00807 \textcolor{comment}{ */}
00820 \textcolor{keywordtype}{size\_t}
00821 InflateFieldNames(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,\textcolor{keywordtype}{void} *buf,\textcolor{keywordtype}{int} nfields,
00822                   \textcolor{keywordtype}{int} fieldname\_length,\textcolor{keywordtype}{int} padding)
00823 \{
00824     mat\_uint8\_t comp\_buf[32];
00825     \textcolor{keywordtype}{int}    err;
00826     \textcolor{keywordtype}{size\_t} bytesread = 0;
00827 
00828     \textcolor{keywordflow}{if} ( buf == NULL )
00829         \textcolor{keywordflow}{return} 0;
00830 
00831     \textcolor{keywordflow}{if} ( !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00832         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00833         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00834         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00835     \}
00836     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out = nfields*fieldname\_length+padding;
00837     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_out = (Bytef*)buf;
00838     err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00839     \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00840         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateFieldNames: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00841         \textcolor{keywordflow}{return} bytesread;
00842     \}
00843     \textcolor{keywordflow}{while} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_out && !matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00844         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 1;
00845         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->next\_in = comp\_buf;
00846         bytesread += fread(comp\_buf,1,1,(FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp});
00847         err = inflate(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z,Z\_NO\_FLUSH);
00848         \textcolor{keywordflow}{if} ( err != Z\_OK ) \{
00849             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"InflateFieldNames: inflate returned %s"},zError(err == Z\_NEED\_DICT ? 
      Z\_DATA\_ERROR : err));
00850             \textcolor{keywordflow}{return} bytesread;
00851         \}
00852     \}
00853 
00854     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in ) \{
00855         (void)fseek((FILE*)mat->\hyperlink{struct__mat__t_a85f562e407ca9ad4d2a6e14f839432b7}{fp},-(int)matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in,SEEK\_CUR);
00856         bytesread -= matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in;
00857         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->z->avail\_in = 0;
00858     \}
00859 
00860     \textcolor{keywordflow}{return} bytesread;
00861 \}
00862 
00865 \textcolor{preprocessor}{#endif}
\end{DoxyCode}
