\hypertarget{eigen_2test_2fastmath_8cpp_source}{}\section{eigen/test/fastmath.cpp}
\label{eigen_2test_2fastmath_8cpp_source}\index{fastmath.\+cpp@{fastmath.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2015 Gael Guennebaud <gael.guennebaud@inria.fr>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#include "main.h"}
00011 
00012 \textcolor{keywordtype}{void} check(\textcolor{keywordtype}{bool} b, \textcolor{keywordtype}{bool} ref)
00013 \{
00014   std::cout << b;
00015   \textcolor{keywordflow}{if}(b==ref)
00016     std::cout << \textcolor{stringliteral}{" OK  "};
00017   \textcolor{keywordflow}{else}
00018     std::cout << \textcolor{stringliteral}{" BAD "};
00019 \}
00020 
00021 \textcolor{preprocessor}{#if EIGEN\_COMP\_MSVC && EIGEN\_COMP\_MSVC < 1800}
00022 \textcolor{keyword}{namespace }\hyperlink{namespacestd}{std} \{
00023   \textcolor{keyword}{template}<\textcolor{keyword}{typename} T> bool (isfinite)(\hyperlink{group___sparse_core___module}{T} x) \{ \textcolor{keywordflow}{return} \_finite(x); \}
00024   \textcolor{keyword}{template}<\textcolor{keyword}{typename} T> bool (isnan)(\hyperlink{group___sparse_core___module}{T} x) \{ \textcolor{keywordflow}{return} \_isnan(x); \}
00025   \textcolor{keyword}{template}<\textcolor{keyword}{typename} T> bool (isinf)(\hyperlink{group___sparse_core___module}{T} x) \{ \textcolor{keywordflow}{return} \_fpclass(x)==\_FPCLASS\_NINF || \_fpclass(x)==\_FPCLASS\_PINF
      ; \}
00026 \}
00027 \textcolor{preprocessor}{#endif}
00028 
00029 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>
00030 \textcolor{keywordtype}{void} check\_inf\_nan(\textcolor{keywordtype}{bool} dryrun) \{
00031   \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<T,Dynamic,1>} m(10);
00032   m.setRandom();
00033   m(3) = std::numeric\_limits<T>::quiet\_NaN();
00034 
00035   \textcolor{keywordflow}{if}(dryrun)
00036   \{
00037     std::cout << \textcolor{stringliteral}{"std::isfinite("} << m(3) << \textcolor{stringliteral}{") = "}; check((std::isfinite)(m(3)),\textcolor{keyword}{false}); std::cout << \textcolor{stringliteral}{"  ;
       numext::isfinite = "}; check((numext::isfinite)(m(3)), \textcolor{keyword}{false}); std::cout << \textcolor{stringliteral}{"\(\backslash\)n"};
00038     std::cout << \textcolor{stringliteral}{"std::isinf("} << m(3) << \textcolor{stringliteral}{")    = "}; check((std::isinf)(m(3)),\textcolor{keyword}{false});    std::cout << \textcolor{stringliteral}{"  ;
       numext::isinf    = "}; check((numext::isinf)(m(3)), \textcolor{keyword}{false}); std::cout << \textcolor{stringliteral}{"\(\backslash\)n"};
00039     std::cout << \textcolor{stringliteral}{"std::isnan("} << m(3) << \textcolor{stringliteral}{")    = "}; check((std::isnan)(m(3)),\textcolor{keyword}{true});     std::cout << \textcolor{stringliteral}{"  ;
       numext::isnan    = "}; check((numext::isnan)(m(3)), \textcolor{keyword}{true}); std::cout << \textcolor{stringliteral}{"\(\backslash\)n"};
00040     std::cout << \textcolor{stringliteral}{"allFinite: "}; check(m.allFinite(), 0); std::cout << \textcolor{stringliteral}{"\(\backslash\)n"};
00041     std::cout << \textcolor{stringliteral}{"hasNaN:    "}; check(m.hasNaN(), 1);    std::cout << \textcolor{stringliteral}{"\(\backslash\)n"};
00042     std::cout << \textcolor{stringliteral}{"\(\backslash\)n"};
00043   \}
00044   \textcolor{keywordflow}{else}
00045   \{
00046     VERIFY( !(numext::isfinite)(m(3)) );
00047     VERIFY( !(numext::isinf)(m(3)) );
00048     VERIFY(  (numext::isnan)(m(3)) );
00049     VERIFY( !m.allFinite() );
00050     VERIFY(  m.hasNaN() );
00051   \}
00052   \hyperlink{group___sparse_core___module}{T} hidden\_zero = (std::numeric\_limits<T>::min)()*(std::numeric\_limits<T>::min)();
00053   m(4) /= hidden\_zero;
00054   \textcolor{keywordflow}{if}(dryrun)
00055   \{
00056     std::cout << \textcolor{stringliteral}{"std::isfinite("} << m(4) << \textcolor{stringliteral}{") = "}; check((std::isfinite)(m(4)),\textcolor{keyword}{false}); std::cout << \textcolor{stringliteral}{"  ;
       numext::isfinite = "}; check((numext::isfinite)(m(4)), \textcolor{keyword}{false}); std::cout << \textcolor{stringliteral}{"\(\backslash\)n"};
00057     std::cout << \textcolor{stringliteral}{"std::isinf("} << m(4) << \textcolor{stringliteral}{")    = "}; check((std::isinf)(m(4)),\textcolor{keyword}{true});     std::cout << \textcolor{stringliteral}{"  ;
       numext::isinf    = "}; check((numext::isinf)(m(4)), \textcolor{keyword}{true}); std::cout << \textcolor{stringliteral}{"\(\backslash\)n"};
00058     std::cout << \textcolor{stringliteral}{"std::isnan("} << m(4) << \textcolor{stringliteral}{")    = "}; check((std::isnan)(m(4)),\textcolor{keyword}{false});    std::cout << \textcolor{stringliteral}{"  ;
       numext::isnan    = "}; check((numext::isnan)(m(4)), \textcolor{keyword}{false}); std::cout << \textcolor{stringliteral}{"\(\backslash\)n"};
00059     std::cout << \textcolor{stringliteral}{"allFinite: "}; check(m.allFinite(), 0); std::cout << \textcolor{stringliteral}{"\(\backslash\)n"};
00060     std::cout << \textcolor{stringliteral}{"hasNaN:    "}; check(m.hasNaN(), 1);    std::cout << \textcolor{stringliteral}{"\(\backslash\)n"};
00061     std::cout << \textcolor{stringliteral}{"\(\backslash\)n"};
00062   \}
00063   \textcolor{keywordflow}{else}
00064   \{
00065     VERIFY( !(numext::isfinite)(m(4)) );
00066     VERIFY(  (numext::isinf)(m(4)) );
00067     VERIFY( !(numext::isnan)(m(4)) );
00068     VERIFY( !m.allFinite() );
00069     VERIFY(  m.hasNaN() );
00070   \}
00071   m(3) = 0;
00072   \textcolor{keywordflow}{if}(dryrun)
00073   \{
00074     std::cout << \textcolor{stringliteral}{"std::isfinite("} << m(3) << \textcolor{stringliteral}{") = "}; check((std::isfinite)(m(3)),\textcolor{keyword}{true}); std::cout << \textcolor{stringliteral}{"  ;
       numext::isfinite = "}; check((numext::isfinite)(m(3)), \textcolor{keyword}{true}); std::cout << \textcolor{stringliteral}{"\(\backslash\)n"};
00075     std::cout << \textcolor{stringliteral}{"std::isinf("} << m(3) << \textcolor{stringliteral}{")    = "}; check((std::isinf)(m(3)),\textcolor{keyword}{false});    std::cout << \textcolor{stringliteral}{"  ;
       numext::isinf    = "}; check((numext::isinf)(m(3)), \textcolor{keyword}{false}); std::cout << \textcolor{stringliteral}{"\(\backslash\)n"};
00076     std::cout << \textcolor{stringliteral}{"std::isnan("} << m(3) << \textcolor{stringliteral}{")    = "}; check((std::isnan)(m(3)),\textcolor{keyword}{false});     std::cout << \textcolor{stringliteral}{"  ;
       numext::isnan    = "}; check((numext::isnan)(m(3)), \textcolor{keyword}{false}); std::cout << \textcolor{stringliteral}{"\(\backslash\)n"};
00077     std::cout << \textcolor{stringliteral}{"allFinite: "}; check(m.allFinite(), 0); std::cout << \textcolor{stringliteral}{"\(\backslash\)n"};
00078     std::cout << \textcolor{stringliteral}{"hasNaN:    "}; check(m.hasNaN(), 0);    std::cout << \textcolor{stringliteral}{"\(\backslash\)n"};
00079     std::cout << \textcolor{stringliteral}{"\(\backslash\)n\(\backslash\)n"};
00080   \}
00081   \textcolor{keywordflow}{else}
00082   \{
00083     VERIFY(  (numext::isfinite)(m(3)) );
00084     VERIFY( !(numext::isinf)(m(3)) );
00085     VERIFY( !(numext::isnan)(m(3)) );
00086     VERIFY( !m.allFinite() );
00087     VERIFY( !m.hasNaN() );
00088   \}
00089 \}
00090 
00091 \textcolor{keywordtype}{void} test\_fastmath() \{
00092   std::cout << \textcolor{stringliteral}{"*** float *** \(\backslash\)n\(\backslash\)n"}; check\_inf\_nan<float>(\textcolor{keyword}{true});
00093   std::cout << \textcolor{stringliteral}{"*** double ***\(\backslash\)n\(\backslash\)n"}; check\_inf\_nan<double>(\textcolor{keyword}{true});
00094   std::cout << \textcolor{stringliteral}{"*** long double *** \(\backslash\)n\(\backslash\)n"}; check\_inf\_nan<long double>(\textcolor{keyword}{true});
00095 
00096   check\_inf\_nan<float>(\textcolor{keyword}{false});
00097   check\_inf\_nan<double>(\textcolor{keyword}{false});
00098   check\_inf\_nan<long double>(\textcolor{keyword}{false});
00099 \}
\end{DoxyCode}
