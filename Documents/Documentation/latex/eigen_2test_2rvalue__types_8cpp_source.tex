\hypertarget{eigen_2test_2rvalue__types_8cpp_source}{}\section{eigen/test/rvalue\+\_\+types.cpp}
\label{eigen_2test_2rvalue__types_8cpp_source}\index{rvalue\+\_\+types.\+cpp@{rvalue\+\_\+types.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2013 Hauke Heibel <hauke.heibel@gmail.com>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#include "main.h"}
00011 
00012 \textcolor{preprocessor}{#include <Eigen/Core>}
00013 
00014 \textcolor{keyword}{using} internal::UIntPtr;
00015 
00016 \textcolor{preprocessor}{#if EIGEN\_HAS\_RVALUE\_REFERENCES}
00017 \textcolor{keyword}{template} <\textcolor{keyword}{typename} MatrixType>
00018 \textcolor{keywordtype}{void} rvalue\_copyassign(\textcolor{keyword}{const} MatrixType& m)
00019 \{
00020 
00021   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} internal::traits<MatrixType>::Scalar Scalar;
00022   
00023   \textcolor{comment}{// create a temporary which we are about to destroy by moving}
00024   MatrixType tmp = m;
00025   UIntPtr src\_address = \textcolor{keyword}{reinterpret\_cast<}UIntPtr\textcolor{keyword}{>}(tmp.data());
00026   
00027   \textcolor{comment}{// move the temporary to n}
00028   MatrixType n = std::move(tmp);
00029   UIntPtr dst\_address = \textcolor{keyword}{reinterpret\_cast<}UIntPtr\textcolor{keyword}{>}(n.data());
00030 
00031   \textcolor{keywordflow}{if} (MatrixType::RowsAtCompileTime==Dynamic|| MatrixType::ColsAtCompileTime==Dynamic)
00032   \{
00033     \textcolor{comment}{// verify that we actually moved the guts}
00034     VERIFY\_IS\_EQUAL(src\_address, dst\_address);
00035   \}
00036 
00037   \textcolor{comment}{// verify that the content did not change}
00038   Scalar abs\_diff = (m-n).\hyperlink{class_eigen_1_1array}{array}().abs().sum();
00039   VERIFY\_IS\_EQUAL(abs\_diff, Scalar(0));
00040 \}
00041 \textcolor{preprocessor}{#else}
00042 \textcolor{keyword}{template} <\textcolor{keyword}{typename} MatrixType>
00043 \textcolor{keywordtype}{void} rvalue\_copyassign(\textcolor{keyword}{const} MatrixType&) \{\}
00044 \textcolor{preprocessor}{#endif}
00045 
00046 \textcolor{keywordtype}{void} test\_rvalue\_types()
00047 \{
00048   CALL\_SUBTEST\_1(rvalue\_copyassign( MatrixXf::Random(50,50).eval() ));
00049   CALL\_SUBTEST\_1(rvalue\_copyassign( ArrayXXf::Random(50,50).eval() ));
00050 
00051   CALL\_SUBTEST\_1(rvalue\_copyassign( \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<float,1,Dynamic>::Random}(50).eval
      () ));
00052   CALL\_SUBTEST\_1(rvalue\_copyassign( \hyperlink{group___core___module_class_eigen_1_1_array}{Array<float,1,Dynamic>::Random}(50).eval()
       ));
00053 
00054   CALL\_SUBTEST\_1(rvalue\_copyassign( \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<float,Dynamic,1>::Random}(50).eval
      () ));
00055   CALL\_SUBTEST\_1(rvalue\_copyassign( \hyperlink{group___core___module_class_eigen_1_1_array}{Array<float,Dynamic,1>::Random}(50).eval()
       ));
00056   
00057   CALL\_SUBTEST\_2(rvalue\_copyassign( \hyperlink{group___core___module_class_eigen_1_1_array}{Array<float,2,1>::Random}().eval() ));
00058   CALL\_SUBTEST\_2(rvalue\_copyassign( \hyperlink{group___core___module_class_eigen_1_1_array}{Array<float,3,1>::Random}().eval() ));
00059   CALL\_SUBTEST\_2(rvalue\_copyassign( \hyperlink{group___core___module_class_eigen_1_1_array}{Array<float,4,1>::Random}().eval() ));
00060 
00061   CALL\_SUBTEST\_2(rvalue\_copyassign( \hyperlink{group___core___module_class_eigen_1_1_array}{Array<float,2,2>::Random}().eval() ));
00062   CALL\_SUBTEST\_2(rvalue\_copyassign( \hyperlink{group___core___module_class_eigen_1_1_array}{Array<float,3,3>::Random}().eval() ));
00063   CALL\_SUBTEST\_2(rvalue\_copyassign( \hyperlink{group___core___module_class_eigen_1_1_array}{Array<float,4,4>::Random}().eval() ));
00064 \}
\end{DoxyCode}
