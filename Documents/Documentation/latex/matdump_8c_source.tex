\hypertarget{matdump_8c_source}{}\section{matdump.\+c}
\label{matdump_8c_source}\index{matdump.\+c@{matdump.\+c}}

\begin{DoxyCode}
00001 \textcolor{comment}{/*}
00002 \textcolor{comment}{ * Copyright (c) 2005-2018, Christopher C. Hulbert}
00003 \textcolor{comment}{ * All rights reserved.}
00004 \textcolor{comment}{ *}
00005 \textcolor{comment}{ * Redistribution and use in source and binary forms, with or without}
00006 \textcolor{comment}{ * modification, are permitted provided that the following conditions are met:}
00007 \textcolor{comment}{ *}
00008 \textcolor{comment}{ * 1. Redistributions of source code must retain the above copyright notice, this}
00009 \textcolor{comment}{ *    list of conditions and the following disclaimer.}
00010 \textcolor{comment}{ *}
00011 \textcolor{comment}{ * 2. Redistributions in binary form must reproduce the above copyright notice,}
00012 \textcolor{comment}{ *    this list of conditions and the following disclaimer in the documentation}
00013 \textcolor{comment}{ *    and/or other materials provided with the distribution.}
00014 \textcolor{comment}{ *}
00015 \textcolor{comment}{ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"}
00016 \textcolor{comment}{ * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE}
00017 \textcolor{comment}{ * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE}
00018 \textcolor{comment}{ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE}
00019 \textcolor{comment}{ * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL}
00020 \textcolor{comment}{ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR}
00021 \textcolor{comment}{ * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER}
00022 \textcolor{comment}{ * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,}
00023 \textcolor{comment}{ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE}
00024 \textcolor{comment}{ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.}
00025 \textcolor{comment}{ */}
00026 
00027 \textcolor{preprocessor}{#include <stdlib.h>}
00028 \textcolor{preprocessor}{#include <stdarg.h>}
00029 \textcolor{preprocessor}{#include <stdio.h>}
00030 \textcolor{preprocessor}{#include <string.h>}
00031 \textcolor{preprocessor}{#include <math.h>}
00032 \textcolor{preprocessor}{#include <getopt.h>}
00033 \textcolor{preprocessor}{#include "matio.h"}
00034 \textcolor{preprocessor}{#if !defined(HAVE\_STRCASECMP)}
00035 \textcolor{preprocessor}{#   define strcasecmp(a,b) strcmp(a,b)}
00036 \textcolor{preprocessor}{#endif}
00037 \textcolor{preprocessor}{#if defined(\_MSC\_VER) || defined(\_\_MINGW32\_\_)}
00038 \textcolor{preprocessor}{#   define SIZE\_T\_FMTSTR "Iu"}
00039 \textcolor{preprocessor}{#else}
00040 \textcolor{preprocessor}{#   define SIZE\_T\_FMTSTR "zu"}
00041 \textcolor{preprocessor}{#endif}
00042 
00043 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *optstring = \textcolor{stringliteral}{"df:hvHV"};
00044 \textcolor{keyword}{static} \textcolor{keyword}{struct }\hyperlink{structoption}{option} options[] = \{
00045     \{\textcolor{stringliteral}{"data"},    no\_argument,      NULL,\textcolor{charliteral}{'d'}\},
00046     \{\textcolor{stringliteral}{"format"},  required\_argument,NULL,\textcolor{charliteral}{'f'}\},
00047     \{\textcolor{stringliteral}{"human"},   no\_argument,      NULL,\textcolor{charliteral}{'h'}\},
00048     \{\textcolor{stringliteral}{"verbose"}, optional\_argument,NULL,\textcolor{charliteral}{'v'}\},
00049     \{\textcolor{stringliteral}{"help"},    no\_argument,      NULL,\textcolor{charliteral}{'H'}\},
00050     \{\textcolor{stringliteral}{"version"}, no\_argument,      NULL,\textcolor{charliteral}{'V'}\},
00051     \{NULL,0,NULL,0\}
00052 \};
00053 
00054 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *helpstr[] = \{
00055 \textcolor{stringliteral}{""},
00056 \textcolor{stringliteral}{"Usage: matdump [OPTIONS] mat\_file [var1 var2 ...]"},
00057 \textcolor{stringliteral}{""},
00058 \textcolor{stringliteral}{"Runs various test on the Matlab I/O library libmatio"},
00059 \textcolor{stringliteral}{""},
00060 \textcolor{stringliteral}{"OPTIONS"},
00061 \textcolor{stringliteral}{"-d,--data         Print data with header information"},
00062 \textcolor{stringliteral}{"-f,--format whos  Turn on 'whos' display mode"},
00063 \textcolor{stringliteral}{"-h,--human        Human readable sizes in 'whos' display mode"},
00064 \textcolor{stringliteral}{"-v,--verbose      Turn on verbose messages"},
00065 \textcolor{stringliteral}{"-H,--help         This output"},
00066 \textcolor{stringliteral}{"-V,--version      version information"},
00067 \textcolor{stringliteral}{""},
00068 \textcolor{stringliteral}{"mat\_file          name of the MAT file to dump"},
00069 \textcolor{stringliteral}{"var1 var2 ...     If specified, dumps only listed variables"},
00070 \textcolor{stringliteral}{""},
00071 \textcolor{stringliteral}{"Report bugs to <chulbe2lsu@sourceforge.net>."},
00072 NULL
00073 \};
00074 
00075 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *mxclass[18] = \{ \textcolor{stringliteral}{"mxUNKNOWN\_CLASS"},
00076     \textcolor{stringliteral}{"mxCELL\_CLASS"}, \textcolor{stringliteral}{"mxSTRUCT\_CLASS"}, \textcolor{stringliteral}{"mxOBJECT\_CLASS"},
00077     \textcolor{stringliteral}{"mxCHAR\_CLASS"}, \textcolor{stringliteral}{"mxSPARSE\_CLASS"}, \textcolor{stringliteral}{"mxDOUBLE\_CLASS"},
00078     \textcolor{stringliteral}{"mxSINGLE\_CLASS"}, \textcolor{stringliteral}{"mxINT8\_CLASS"}, \textcolor{stringliteral}{"mxUINT8\_CLASS"},
00079     \textcolor{stringliteral}{"mxINT16\_CLASS"}, \textcolor{stringliteral}{"mxUINT16\_CLASS"}, \textcolor{stringliteral}{"mxINT32\_CLASS"},
00080     \textcolor{stringliteral}{"mxUINT32\_CLASS"}, \textcolor{stringliteral}{"mxINT64\_CLASS"}, \textcolor{stringliteral}{"mxUINT64\_CLASS"},
00081     \textcolor{stringliteral}{"mxFUNCTION\_CLASS"}, \textcolor{stringliteral}{"mxOPAQUE\_CLASS"} \};
00082 \textcolor{keyword}{static} \textcolor{keywordtype}{int} printdata = 0;
00083 \textcolor{keyword}{static} \textcolor{keywordtype}{int} human\_readable = 0;
00084 \textcolor{keyword}{static} \textcolor{keywordtype}{int} print\_whos\_first = 1;
00085 
00086 \textcolor{comment}{/* Print Functions */}
00087 \textcolor{keyword}{static} \textcolor{keywordtype}{void} print\_whos(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar);
00088 \textcolor{keyword}{static} \textcolor{keywordtype}{void} print\_default(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar);
00089 
00090 \textcolor{keyword}{static} void (*printfunc)(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar) = NULL;
00091 
00092 \textcolor{keyword}{static} \textcolor{keywordtype}{char} *
00093 get\_next\_token(\textcolor{keywordtype}{char} *str)
00094 \{
00095     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *tokens = \textcolor{stringliteral}{"()\{\}."};
00096     \textcolor{keywordtype}{char} *next\_tok, *tok;
00097 
00098     next\_tok = NULL;
00099     \textcolor{keywordflow}{while} (*tokens != \textcolor{charliteral}{'\(\backslash\)0'}) \{
00100         tok   = strchr(str,*tokens);
00101         \textcolor{keywordflow}{if} ( tok != NULL ) \{
00102             \textcolor{keywordflow}{if} ( NULL == next\_tok )
00103                 next\_tok = tok;
00104             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (tok < next\_tok)
00105                 next\_tok = tok;
00106         \}
00107         tokens++;
00108     \}
00109     \textcolor{keywordflow}{if} ( NULL == next\_tok )
00110         next\_tok = str;
00111     \textcolor{keywordflow}{return} next\_tok;
00112 \}
00113 
00114 \textcolor{keyword}{static} \textcolor{keywordtype}{int}
00115 slab\_get\_rank(\textcolor{keywordtype}{char} *open,\textcolor{keywordtype}{char} *close)
00116 \{
00117     \textcolor{keywordtype}{int} rank = 0;    \textcolor{keywordtype}{char} *ptr = open+1;
00118     rank = 1;
00119     \textcolor{keywordflow}{while} ( ptr != close ) \{
00120         \textcolor{keywordflow}{if} ( *ptr++ == \textcolor{charliteral}{','} )
00121             rank++;
00122     \}
00123     \textcolor{keywordflow}{return} rank;
00124 \}
00125 
00126 \textcolor{keyword}{static} \textcolor{keywordtype}{void}
00127 slab\_get\_select(\textcolor{keywordtype}{char} *open, \textcolor{keywordtype}{char} *close, \textcolor{keywordtype}{int} rank, \textcolor{keywordtype}{int} *start, \textcolor{keywordtype}{int} *stride,
00128                 \textcolor{keywordtype}{int} *edge)
00129 \{
00130     \textcolor{keywordtype}{char} *ptr, *valptr;
00131     \textcolor{keywordtype}{int} nvals, dim, i;
00132 
00133     ptr = open;
00134     valptr = open+1;
00135     dim = 0;
00136     nvals = 0;
00137     \textcolor{keywordflow}{do} \{
00138         ptr++;
00139         \textcolor{keywordflow}{if} ( *ptr == \textcolor{charliteral}{','} ) \{
00140             \textcolor{keywordflow}{if} (nvals == 2) \{
00141                 *ptr = \textcolor{charliteral}{'\(\backslash\)0'};
00142                  \textcolor{keywordflow}{if} ( !strcmp(valptr,\textcolor{stringliteral}{"end"}) ) \{
00143                      edge[dim] = -1;
00144                  \} \textcolor{keywordflow}{else} \{
00145                      i = atoi(valptr);
00146                      edge[dim] = i;
00147                  \}
00148             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( nvals == 1 ) \{
00149                 *ptr = \textcolor{charliteral}{'\(\backslash\)0'};
00150                  \textcolor{keywordflow}{if} ( !strcmp(valptr,\textcolor{stringliteral}{"end"}) ) \{
00151                      edge[dim] = -1;
00152                  \} \textcolor{keywordflow}{else} \{
00153                      i = atoi(valptr);
00154                      edge[dim] = i;
00155                  \}
00156             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( nvals == 0 ) \{
00157                 *ptr = \textcolor{charliteral}{'\(\backslash\)0'};
00158                  \textcolor{keywordflow}{if} ( !strcmp(valptr,\textcolor{stringliteral}{"end"}) ) \{
00159                      start[dim] = -1;
00160                      edge[dim]  = -1;
00161                  \} \textcolor{keywordflow}{else} \{
00162                      i = atoi(valptr);
00163                      start[dim] = i-1;
00164                      edge[dim]  = i;
00165                  \}
00166             \}
00167             dim++;
00168             valptr = ptr+1;
00169             nvals = 0;
00170         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( *ptr == \textcolor{charliteral}{':'} ) \{
00171             *ptr = \textcolor{charliteral}{'\(\backslash\)0'};
00172             \textcolor{keywordflow}{if} ( !strcmp(valptr,\textcolor{stringliteral}{"end"}) ) \{
00173                 \textcolor{keywordflow}{if} ( nvals == 0 )
00174                     start[dim] = -1;
00175                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( nvals == 1 )
00176                     edge[dim] = -1;
00177                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( nvals == 2 )
00178                     edge[dim] = -1;
00179                 \textcolor{keywordflow}{else}
00180                     fprintf(stderr,\textcolor{stringliteral}{"Too many inputs to dim %d"},dim+1);
00181             \} \textcolor{keywordflow}{else} \{
00182                 i = atoi(valptr);
00183                 \textcolor{keywordflow}{if} ( nvals == 0 )
00184                     start[dim] = i-1;
00185                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( nvals == 1 )
00186                     stride[dim] = i;
00187                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( nvals == 2 )
00188                     edge[dim] = i;
00189                 \textcolor{keywordflow}{else}
00190                     fprintf(stderr,\textcolor{stringliteral}{"Too many inputs to dim %d"},dim+1);
00191             \}
00192             nvals++;
00193             valptr = ptr+1;
00194         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( *ptr == \textcolor{charliteral}{')'} || *ptr == \textcolor{charliteral}{'\}'} ) \{
00195             *ptr = \textcolor{charliteral}{'\(\backslash\)0'};
00196             \textcolor{keywordflow}{if} ( !strcmp(valptr,\textcolor{stringliteral}{"end"}) ) \{
00197                 \textcolor{keywordflow}{if} ( nvals == 0 ) \{
00198                     start[dim] = -1;
00199                     edge[dim]  = -1;
00200                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( nvals == 1 )
00201                     edge[dim] = -1;
00202                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( nvals == 2 )
00203                     edge[dim] = -1;
00204                 \textcolor{keywordflow}{else}
00205                     fprintf(stderr,\textcolor{stringliteral}{"Too many inputs to dim %d"},dim+1);
00206             \} \textcolor{keywordflow}{else} \{
00207                 i = atoi(valptr);
00208                 \textcolor{keywordflow}{if} ( nvals == 0 ) \{
00209                     start[dim] = i-1;
00210                     edge[dim]  = i;
00211                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( nvals == 1 )
00212                     edge[dim] = i;
00213                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( nvals == 2 )
00214                     edge[dim] = i;
00215                 \textcolor{keywordflow}{else}
00216                     fprintf(stderr,\textcolor{stringliteral}{"Too many inputs to dim %d"},dim+1);
00217             \}
00218             nvals++;
00219             valptr = ptr+1;
00220         \}
00221     \} \textcolor{keywordflow}{while} ( ptr != close );
00222 \}
00223 
00224 \textcolor{keyword}{static} \textcolor{keywordtype}{int}
00225 slab\_select\_valid(\textcolor{keywordtype}{int} rank,\textcolor{keywordtype}{int} *start,\textcolor{keywordtype}{int} *stride,\textcolor{keywordtype}{int} *edge,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar)
00226 \{
00227     \textcolor{keywordtype}{int} valid = 1, i, nmemb = 1;
00228 
00229     \textcolor{keywordflow}{if} ( (matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} != rank) && (rank != 1) ) \{
00230         valid = 0;
00231     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( rank == 1 ) \{
00232         \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
00233             nmemb *= matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
00234         if ( *stride < 1 ) \{
00235             \textcolor{comment}{/* Check stride is at least 1 */}
00236             fprintf(stderr,\textcolor{stringliteral}{"stride must be positive"});
00237             valid = 0;
00238         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( *edge > nmemb ) \{
00239             \textcolor{comment}{/* edge can't be bigger than the size of the dimension */}
00240             fprintf(stderr,\textcolor{stringliteral}{"edge out of bound"});
00241             valid = 0;
00242         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( *start >= nmemb || (*start > *edge && *edge > 0) ) \{
00243             \textcolor{comment}{/* Start can't be bigger than the size of the dimension and}
00244 \textcolor{comment}{             * can't be greater than the edge unless edge == -1 => end}
00245 \textcolor{comment}{             */}
00246             fprintf(stderr,\textcolor{stringliteral}{"start out of bound"});
00247             valid = 0;
00248         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( *edge == -1 && *start == -1 ) \{
00249             \textcolor{comment}{/* If edge == start == -1, then a single end was used */}
00250             *edge = 1;
00251             *start = nmemb-1;
00252         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( *edge == -1 && *stride == 1 ) \{
00253             \textcolor{comment}{/* index of the form 1:end, 1:1:end, or : */}
00254             *edge = nmemb;
00255             \textcolor{comment}{/* If ':' was specified, start[i] will be -1 */}
00256             \textcolor{keywordflow}{if} ( *start < 0 )
00257                 *start = 0;
00258         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( *edge == -1 ) \{
00259             \textcolor{comment}{/* index of the form 1:stride:end */}
00260             *edge = nmemb;
00261             *edge = (int)floor((\textcolor{keywordtype}{double})(*edge-*start-1) / (\textcolor{keywordtype}{double})*stride)+1;
00262         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( *edge > 0 ) \{
00263             *edge = (int)floor((\textcolor{keywordtype}{double})(*edge-*start-1) / (\textcolor{keywordtype}{double})*stride)+1;
00264         \}
00265         nmemb = *edge;
00266     \} \textcolor{keywordflow}{else} \{
00267         \textcolor{keywordflow}{for} ( i = 0; i < rank && valid; i++ ) \{
00268             \textcolor{keywordflow}{if} ( stride[i] < 1 ) \{
00269                 \textcolor{comment}{/* Check stride is at least 1 */}
00270                 fprintf(stderr,\textcolor{stringliteral}{"stride must be positive"});
00271                 valid = 0;
00272                 \textcolor{keywordflow}{break};
00273             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( edge[i] == -1 && start[i] == -1 ) \{
00274                 \textcolor{comment}{/* If edge == start == -1, then a single end was used */}
00275                 edge[i] = 1;
00276                 start[i] = matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i]-1;
00277             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( edge[i] < 0 && stride[i] == 1) \{
00278                 \textcolor{comment}{/* index of the form 1:end, 1:1:end, or : */}
00279                 edge[i] = matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
00280                 \textcolor{comment}{/* If ':' was specified, start[i] will be -1 */}
00281                 \textcolor{keywordflow}{if} ( start[i] < 0 )
00282                     start[i] = 0;
00283             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( edge[i] < 0 ) \{
00284                 \textcolor{comment}{/* index of the form 1:stride:end */}
00285                 edge[i] = (int)floor((\textcolor{keywordtype}{double})(matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i]-start[i]-1) / (\textcolor{keywordtype}{double})stride[i])+1;
00286             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( edge[i] > matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i] ) \{
00287                 \textcolor{comment}{/* edge can't be bigger than the size of the dimension */}
00288                 fprintf(stderr,\textcolor{stringliteral}{"edge out of bound on dimension %d"},i+1);
00289                 valid = 0;
00290                 \textcolor{keywordflow}{break};
00291             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( start[i] >= matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i] ||
00292                         (start[i] > edge[i] && edge[i] > 0) ) \{
00293                 \textcolor{comment}{/* Start can't be bigger than the size of the dimension and}
00294 \textcolor{comment}{                 * can't be greater than the edge unless edge == -1 => end}
00295 \textcolor{comment}{                 */}
00296                 fprintf(stderr,\textcolor{stringliteral}{"start out of bound on dimension %d"},i+1);
00297                 valid = 0;
00298                 \textcolor{keywordflow}{break};
00299             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( edge[i] == (start[i]+1) ) \{
00300                 \textcolor{comment}{/* index of the form 3:3 */}
00301                 edge[i] = 1;
00302             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( edge[i] > 0 ) \{
00303                 edge[i] = (int)floor((\textcolor{keywordtype}{double})(edge[i]-start[i]-1) / (\textcolor{keywordtype}{double})stride[i])+1;
00304             \}
00305             nmemb *= edge[i];
00306         \}
00307     \}
00308     \textcolor{keywordflow}{if} ( !valid )
00309         nmemb = 0;
00310     \textcolor{keywordflow}{return} nmemb;
00311 \}
00312 
00313 \textcolor{keyword}{static} \textcolor{keywordtype}{void}
00314 read\_selected\_data(\hyperlink{struct__mat__t}{mat\_t} *mat,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **\_matvar,\textcolor{keywordtype}{char} *index\_str)
00315 \{
00316     \textcolor{keywordtype}{char} *next\_tok\_pos, next\_tok = 0;
00317     \textcolor{keywordtype}{char} *open = NULL, *close = NULL;
00318     \textcolor{keywordtype}{int} err, i = 0, j, done = 0;
00319     \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t}* matvar = *\_matvar;
00320 
00321     next\_tok\_pos = get\_next\_token(index\_str);
00322     next\_tok = *next\_tok\_pos;
00323 
00324     \textcolor{keywordflow}{while} ( !done ) \{
00325         \textcolor{comment}{/* Check If the user is selecting a subset of the dataset */}
00326         \textcolor{keywordflow}{if} ( next\_tok == \textcolor{charliteral}{'('} ) \{
00327             \textcolor{keywordtype}{int} rank, *start, *stride, *edge,nmemb;
00328 
00329             open    = next\_tok\_pos;
00330             close   = strchr(open+1,\textcolor{charliteral}{')'});
00331 
00332             \textcolor{comment}{/* Get the next token after this selection */}
00333             next\_tok\_pos = get\_next\_token(close+1);
00334             \textcolor{keywordflow}{if} ( next\_tok\_pos != (close+1) ) \{
00335                 *next\_tok\_pos = \textcolor{charliteral}{'\(\backslash\)0'};
00336                 next\_tok = *next\_tok\_pos;
00337             \} \textcolor{keywordflow}{else} \{
00338                 done = 1;
00339             \}
00340             \textcolor{comment}{/* Make sure that the partial I/O is the last token */}
00341             \textcolor{keywordflow}{if} ( !done ) \{
00342                 fprintf(stderr,\textcolor{stringliteral}{"Partial I/O must be the last operation in "}
00343                              \textcolor{stringliteral}{"the expression"});
00344                 \textcolor{keywordflow}{break};
00345             \}
00346             \textcolor{comment}{/* Get the rank of the dataset */}
00347             rank   = slab\_get\_rank(open,close);
00348             start  = (\textcolor{keywordtype}{int}*)malloc(rank*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));
00349             stride = (\textcolor{keywordtype}{int}*)malloc(rank*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));
00350             edge   = (\textcolor{keywordtype}{int}*)malloc(rank*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));
00351             \textcolor{keywordflow}{for} ( j = 0; j < rank; j++ ) \{
00352                 start[j]  = 0;
00353                 stride[j] = 1;
00354                 edge[j]   = 1;
00355             \}
00356             \textcolor{comment}{/* Get the start,stride,edge using matlab syntax */}
00357             slab\_get\_select(open,close,rank,start,stride,edge);
00358 
00359             \textcolor{comment}{/* Check if the users selection is valid and if so read the data */}
00360             \textcolor{keywordflow}{if} ((nmemb = slab\_select\_valid(rank,start,stride,edge,matvar))) \{
00361                  matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \hyperlink{group___m_a_t_ga2bf682f015b22fa796a8885e997661e7}{Mat\_SizeOfClass}(matvar->
      \hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type});
00362                  matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} = nmemb*matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size};
00363                 \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
00364                     \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t} *z;
00365                     matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} = malloc(\textcolor{keyword}{sizeof}(*z));
00366                     z = (\hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t}*)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
00367                     z->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re} = malloc(matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes});
00368                     z->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im} = malloc(matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes});
00369                 \} \textcolor{keywordflow}{else} \{
00370                     matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} = malloc(matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes});
00371                 \}
00372                 \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} == NULL ) \{
00373                     fprintf(stderr,\textcolor{stringliteral}{"Couldn't allocate memory for the data"});
00374                     err = 1;
00375                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( rank == 1 ) \{
00376                     \hyperlink{group___m_a_t_gaad61c8449a2106afa697280ff0ee9dd8}{Mat\_VarReadDataLinear}(mat,matvar,matvar->
      \hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data},*start,
00377                                          *stride,*edge);
00378                     \textcolor{keywordflow}{if} (matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} == 2 && matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0] == 1) \{
00379                        matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[1] = *edge;
00380                     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} == 2 && matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[1] == 1) \{
00381                        matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0] = *edge;
00382                     \} \textcolor{keywordflow}{else} \{
00383                         matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} = 2;
00384                         matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0] = *edge;
00385                         matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[1] = 1;
00386                     \}
00387                 \} \textcolor{keywordflow}{else} \{
00388                     \hyperlink{group___m_a_t_ga1845000f4fc6252ec5ff11c4b9f0759f}{Mat\_VarReadData}(mat,matvar,matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data},start,stride,edge);
00389                     \textcolor{keywordflow}{for} ( i = 0; i < rank; i++ )
00390                         matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i] = (\textcolor{keywordtype}{size\_t})edge[i];
00391                 \}
00392             \}
00393             free(start);
00394             free(stride);
00395             free(edge);
00396         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( next\_tok == \textcolor{charliteral}{'.'} ) \{
00397             \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *field;
00398             \textcolor{keywordtype}{char} *varname;
00399 
00400             varname = next\_tok\_pos+1;
00401             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT} ) \{
00402                 next\_tok\_pos = get\_next\_token(next\_tok\_pos+1);
00403                 \textcolor{keywordflow}{if} ( next\_tok\_pos != varname ) \{
00404                     next\_tok = *next\_tok\_pos;
00405                     *next\_tok\_pos = \textcolor{charliteral}{'\(\backslash\)0'};
00406                 \} \textcolor{keywordflow}{else} \{
00407                     done = 1;
00408                 \}
00409                 \textcolor{comment}{/* FIXME: Handle structures > 1x1 */}
00410                 field = \hyperlink{group___m_a_t_ga619d241b49ce97334a38add60562c7be}{Mat\_VarGetStructFieldByName}(matvar, varname, 0);
00411                 \textcolor{keywordflow}{if} ( field == NULL ) \{
00412                     fprintf(stderr,\textcolor{stringliteral}{"field %s was not found in structure %s"},
00413                         varname,matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
00414                     \textcolor{keywordflow}{break};
00415                 \}
00416                 field = \hyperlink{group___m_a_t_ga7ef80c5d99d7918b2b09db3bea106ecc}{Mat\_VarDuplicate}(field,1);
00417                 \hyperlink{group___m_a_t_ga1d14716f7450530fd1c9d02413787f0e}{Mat\_VarFree}(matvar);
00418                 matvar = field;
00419                 \textcolor{keywordflow}{if} ( done == 1 ) \{
00420                     \hyperlink{group___m_a_t_gaa8060d7c8e5da0aa9ee5f96e5f1eb30a}{Mat\_VarReadDataAll}(mat, matvar);
00421                 \}
00422             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} == \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2f7abb47a1c51e248bd4e5e03cc81b08}{MAT\_C\_CELL} ) \{
00423                 \textcolor{keywordtype}{int} ncells;
00424                 \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *cell, **cells;
00425 
00426                 ncells = matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} / matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size};
00427                 cells = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t}**)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
00428                 next\_tok\_pos = get\_next\_token(next\_tok\_pos+1);
00429                 \textcolor{keywordflow}{if} ( next\_tok\_pos != varname ) \{
00430                     next\_tok = *next\_tok\_pos;
00431                     *next\_tok\_pos = \textcolor{charliteral}{'\(\backslash\)0'};
00432                 \} \textcolor{keywordflow}{else} \{
00433                     done = 1;
00434                 \}
00435                 \textcolor{keywordflow}{for} ( j = 0 ; j < ncells; j++ ) \{
00436                     cell = \hyperlink{group___m_a_t_gac1e15063439c0bd3eb0c986514c742dc}{Mat\_VarGetCell}(matvar,j);
00437                     \textcolor{keywordflow}{if} ( cell == NULL || cell->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} != 
      \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT} ) \{
00438                         fprintf(stderr,\textcolor{stringliteral}{"cell index %d is not a structure"},j);
00439                         \textcolor{keywordflow}{break};
00440                     \} \textcolor{keywordflow}{else} \{
00441                         \textcolor{comment}{/* FIXME: Handle structures > 1x1 */}
00442                         field = \hyperlink{group___m_a_t_ga619d241b49ce97334a38add60562c7be}{Mat\_VarGetStructFieldByName}(cell,varname,0);
00443                         \textcolor{keywordflow}{if} ( field == NULL ) \{
00444                             fprintf(stderr,\textcolor{stringliteral}{"field %s was not found in "}
00445                                 \textcolor{stringliteral}{"structure %s"},varname,matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
00446                             \textcolor{keywordflow}{break};
00447                         \}
00448                         field = \hyperlink{group___m_a_t_ga7ef80c5d99d7918b2b09db3bea106ecc}{Mat\_VarDuplicate}(field,1);
00449                         \hyperlink{group___m_a_t_ga1d14716f7450530fd1c9d02413787f0e}{Mat\_VarFree}(cell);
00450                         cells[j] = field;
00451                     \}
00452                 \}
00453                 \textcolor{keywordflow}{if} ( j != ncells )
00454                     \textcolor{keywordflow}{break};
00455             \} \textcolor{keywordflow}{else} \{
00456                 fprintf(stderr,\textcolor{stringliteral}{"%s is not a structure"}, varname);
00457                 \textcolor{keywordflow}{break};
00458             \}
00459         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( next\_tok == \textcolor{charliteral}{'\{'} ) \{
00460             \textcolor{keywordtype}{int} rank, *start, *stride, *edge,nmemb, err = 0;
00461 
00462             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} != \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2f7abb47a1c51e248bd4e5e03cc81b08}{MAT\_C\_CELL} ) \{
00463                 fprintf(stderr,\textcolor{stringliteral}{"Only Cell Arrays can index with \{\}"});
00464                 \textcolor{keywordflow}{break};
00465             \}
00466             open    = next\_tok\_pos;
00467             close   = strchr(open+1,\textcolor{charliteral}{'\}'});
00468 
00469             \textcolor{comment}{/* Get the next token after this selection */}
00470             next\_tok\_pos = get\_next\_token(close+1);
00471             \textcolor{keywordflow}{if} ( *next\_tok\_pos != \textcolor{charliteral}{'\(\backslash\)0'} ) \{
00472                 next\_tok = *next\_tok\_pos;
00473                 *next\_tok\_pos = \textcolor{charliteral}{'\(\backslash\)0'};
00474             \} \textcolor{keywordflow}{else} \{
00475                 done = 1;
00476             \}
00477             \textcolor{comment}{/* Get the rank of the dataset */}
00478             rank   = slab\_get\_rank(open,close);
00479             start  = (\textcolor{keywordtype}{int}*)malloc(rank*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));
00480             stride = (\textcolor{keywordtype}{int}*)malloc(rank*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));
00481             edge   = (\textcolor{keywordtype}{int}*)malloc(rank*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));
00482             \textcolor{keywordflow}{for} ( j = 0; j < rank; j++ ) \{
00483                 start[j]  = 0;
00484                 stride[j] = 1;
00485                 edge[j]   = 1;
00486             \}
00487             \textcolor{comment}{/* Get the start,stride,edge using matlab syntax */}
00488             slab\_get\_select(open,close,rank,start,stride,edge);
00489             \textcolor{comment}{/* Check if the users selection is valid and if so read the data */}
00490             \textcolor{keywordflow}{if} ((nmemb = slab\_select\_valid(rank,start,stride,edge,matvar))) \{
00491                 \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **cells, *tmp;
00492                 \textcolor{keywordflow}{if} ( rank == 1 ) \{
00493                     cells = \hyperlink{group___m_a_t_ga004987d665654409f74eaf8e82bb1380}{Mat\_VarGetCellsLinear}(matvar,*start,
00494                                   *stride,*edge);
00495                     \textcolor{keywordflow}{if} (matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} == 2 && matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0] == 1) \{
00496                         matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[1] = *edge;
00497                     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} == 2 && matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[1] == 1) \{
00498                         matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0] = *edge;
00499                     \} \textcolor{keywordflow}{else} \{
00500                         matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} = 1;
00501                         matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0] = *edge;
00502                     \}
00503                 \} \textcolor{keywordflow}{else} \{
00504                     cells = \hyperlink{group___m_a_t_ga0732b0a6c40975b036068b9a14422d45}{Mat\_VarGetCells}(matvar,start,stride,edge);
00505                     \textcolor{keywordflow}{for} ( i = 0; i < rank; i++ )
00506                         matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i] = (\textcolor{keywordtype}{size\_t})edge[i];
00507                 \}
00508                 \textcolor{keywordflow}{if} ( cells == NULL ) \{
00509                     fprintf(stderr,\textcolor{stringliteral}{"Error getting the indexed cells"});
00510                     err = 1;
00511                 \} \textcolor{keywordflow}{else} \{
00512                     \textcolor{keywordflow}{for} ( j = 0; j < nmemb; j++ )
00513                         cells[j] = \hyperlink{group___m_a_t_ga7ef80c5d99d7918b2b09db3bea106ecc}{Mat\_VarDuplicate}(cells[j],1);
00514                     tmp = \hyperlink{group___m_a_t_ga1c54a84bb4d810c6fccdb8869489eac4}{Mat\_VarCreate}(matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},\hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2f7abb47a1c51e248bd4e5e03cc81b08}{MAT\_C\_CELL},
00515                         \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a07599cf2cca6d2b2d059378563318ba5}{MAT\_T\_CELL},matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank},matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims},cells,
00516                         \hyperlink{group___m_a_t_ggab9d6ef9e3ddca78a317b173f01d53fbba762244499f52eb35e7b53fb79a1f2889}{MAT\_F\_DONT\_COPY\_DATA});
00517                     \hyperlink{group___m_a_t_ga1d14716f7450530fd1c9d02413787f0e}{Mat\_VarFree}(matvar);
00518                     matvar = tmp;
00519                 \}
00520             \} \textcolor{keywordflow}{else} \{
00521                 fprintf(stderr,\textcolor{stringliteral}{"Cell selection not valid"});
00522                 err = 1;
00523             \}
00524             free(start);
00525             free(stride);
00526             free(edge);
00527             \textcolor{keywordflow}{if} ( err )
00528                 \textcolor{keywordflow}{break};
00529         \}
00530     \}
00531     *\_matvar = matvar;
00532 \}
00533 
00534 \textcolor{keyword}{static} \textcolor{keywordtype}{void}
00535 print\_whos(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar)
00536 \{
00537     \textcolor{keywordtype}{int} i;
00538     \textcolor{keywordtype}{size\_t} nbytes;
00539     \textcolor{keywordtype}{char} size[32] = \{\textcolor{charliteral}{'\(\backslash\)0'},\};
00540 
00541     \textcolor{keywordflow}{if} ( print\_whos\_first ) \{
00542         printf(\textcolor{stringliteral}{"%-20s       %-10s     %-10s     %-18s\(\backslash\)n\(\backslash\)n"},\textcolor{stringliteral}{"Name"},\textcolor{stringliteral}{"Size"},\textcolor{stringliteral}{"Bytes"},\textcolor{stringliteral}{"Class"});
00543         print\_whos\_first = 0;
00544     \}
00545     printf(\textcolor{stringliteral}{"%-20s"}, matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
00546     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} > 0 ) \{
00547         \textcolor{keywordtype}{int} cnt = 0;
00548         printf(\textcolor{stringliteral}{"%8"} SIZE\_T\_FMTSTR, matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0]);
00549         \textcolor{keywordflow}{for} ( i = 1; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ ) \{
00550             \textcolor{keywordflow}{if} ( ceil(log10((\textcolor{keywordtype}{double})matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i]))+1 < 32 )
00551                 cnt += sprintf(size+cnt,\textcolor{stringliteral}{"x%"} SIZE\_T\_FMTSTR, matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i]);
00552         \}
00553         printf(\textcolor{stringliteral}{"%-10s"},size);
00554     \} \textcolor{keywordflow}{else} \{
00555         printf(\textcolor{stringliteral}{"                    "});
00556     \}
00557     nbytes = \hyperlink{group___m_a_t_gaeeb798fead2f765bddfb19016c7fdbcc}{Mat\_VarGetSize}(matvar);
00558     \textcolor{keywordflow}{if} ( human\_readable ) \{
00559         \textcolor{keywordflow}{if} ( nbytes > 1073741824L )
00560             printf(\textcolor{stringliteral}{" %10.1fG"},(\textcolor{keywordtype}{double})nbytes/1073741824.0);
00561         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( nbytes > 1048576 )
00562             printf(\textcolor{stringliteral}{" %10.1fM"},(\textcolor{keywordtype}{double})nbytes/1048576.0);
00563         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( nbytes > 1024 )
00564             printf(\textcolor{stringliteral}{" %10.1fK"},(\textcolor{keywordtype}{double})nbytes/1024.0);
00565         \textcolor{keywordflow}{else}
00566             printf(\textcolor{stringliteral}{" %10"} SIZE\_T\_FMTSTR \textcolor{stringliteral}{"B"},nbytes);
00567     \} \textcolor{keywordflow}{else} \{
00568         printf(\textcolor{stringliteral}{"  %10"} SIZE\_T\_FMTSTR,nbytes);
00569     \}
00570     printf(\textcolor{stringliteral}{"  %-18s\(\backslash\)n"},mxclass[matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type}]);
00571 
00572     \textcolor{keywordflow}{return};
00573 \}
00574 
00575 \textcolor{keyword}{static} \textcolor{keywordtype}{int} indent = 0;
00576 
00577 \textcolor{keyword}{static} \textcolor{keywordtype}{void}
00578 default\_printf\_func(\textcolor{keywordtype}{int} log\_level,\textcolor{keywordtype}{char} *message)
00579 \{
00580     \textcolor{keywordtype}{int} i;
00581 
00582     \textcolor{keywordflow}{for} ( i = 0; i < indent; i++ )
00583         printf(\textcolor{stringliteral}{"    "});
00584     printf(\textcolor{stringliteral}{"%s\(\backslash\)n"},message);
00585 \}
00586 
00587 \textcolor{keyword}{static} \textcolor{keywordtype}{void}
00588 print\_default\_number(\textcolor{keyword}{enum} \hyperlink{group___m_a_t_gacf7b3b879282b7ab3a51190e49bf3453}{matio\_types} type, \textcolor{keywordtype}{void} *data)
00589 \{
00590     \textcolor{keywordflow}{switch} ( type ) \{
00591         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a31e721ecf7e188196f83c32838288797}{MAT\_T\_DOUBLE}:
00592             printf(\textcolor{stringliteral}{"%g"},*(\textcolor{keywordtype}{double}*)data);
00593             \textcolor{keywordflow}{break};
00594         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a3a3657d40e9212c923d9b9d03531b64c}{MAT\_T\_SINGLE}:
00595             printf(\textcolor{stringliteral}{"%g"},*(\textcolor{keywordtype}{float}*)data);
00596             \textcolor{keywordflow}{break};
00597 \textcolor{preprocessor}{#ifdef \_mat\_int64\_t}
00598         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9e825b5d18b8f946eaf2b4b57e51c145}{MAT\_T\_INT64}:
00599 \textcolor{preprocessor}{#if MATIO\_HAVE\_INTTYPES\_H}
00600             printf(\textcolor{stringliteral}{"%"} PRIi64,*(mat\_int64\_t*)data);
00601 \textcolor{preprocessor}{#elif defined(\_MSC\_VER) && \_MSC\_VER >= 1200}
00602             printf(\textcolor{stringliteral}{"%I64i"},*(mat\_int64\_t*)data);
00603 \textcolor{preprocessor}{#else}
00604             printf(\textcolor{stringliteral}{"%lld"},(\textcolor{keywordtype}{long} \textcolor{keywordtype}{long})(*(mat\_int64\_t*)data));
00605 \textcolor{preprocessor}{#endif}
00606             \textcolor{keywordflow}{break};
00607 \textcolor{preprocessor}{#endif}
00608 \textcolor{preprocessor}{#ifdef \_mat\_uint64\_t}
00609         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a45547932c46be27118abe08302d7e29f}{MAT\_T\_UINT64}:
00610 \textcolor{preprocessor}{#if MATIO\_HAVE\_INTTYPES\_H}
00611             printf(\textcolor{stringliteral}{"%"} PRIu64,*(mat\_uint64\_t*)data);
00612 \textcolor{preprocessor}{#elif defined(\_MSC\_VER) && \_MSC\_VER >= 1200}
00613             printf(\textcolor{stringliteral}{"%I64u"},*(mat\_uint64\_t*)data);
00614 \textcolor{preprocessor}{#else}
00615             printf(\textcolor{stringliteral}{"%llu"},(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long})(*(mat\_uint64\_t*)data));
00616 \textcolor{preprocessor}{#endif}
00617             \textcolor{keywordflow}{break};
00618 \textcolor{preprocessor}{#endif}
00619         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a83e06a68320726c6572bfbb9f3addb1d}{MAT\_T\_INT32}:
00620             printf(\textcolor{stringliteral}{"%d"},*(mat\_int32\_t*)data);
00621             \textcolor{keywordflow}{break};
00622         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453aa397e285a23fe240368b752897652c6a}{MAT\_T\_UINT32}:
00623             printf(\textcolor{stringliteral}{"%u"},*(mat\_uint32\_t*)data);
00624             \textcolor{keywordflow}{break};
00625         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a8c5b2e381946e95ea8d81ac216743302}{MAT\_T\_INT16}:
00626             printf(\textcolor{stringliteral}{"%hd"},*(mat\_int16\_t*)data);
00627             \textcolor{keywordflow}{break};
00628         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a05bc7af7680aa68be95126ae0a4c2e31}{MAT\_T\_UINT16}:
00629             printf(\textcolor{stringliteral}{"%hu"},*(mat\_uint16\_t*)data);
00630             \textcolor{keywordflow}{break};
00631         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a9807f5033ed4f9b548953742d9fd1658}{MAT\_T\_INT8}:
00632             printf(\textcolor{stringliteral}{"%hhd"},*(mat\_int8\_t*)data);
00633             \textcolor{keywordflow}{break};
00634         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a01c1bd7db68f90552862eb5d311be408}{MAT\_T\_UINT8}:
00635             printf(\textcolor{stringliteral}{"%hhu"},*(mat\_uint8\_t*)data);
00636             \textcolor{keywordflow}{break};
00637         \textcolor{keywordflow}{default}:
00638             \textcolor{keywordflow}{break};
00639     \}
00640 \}
00641 
00642 \textcolor{keyword}{static} \textcolor{keywordtype}{void}
00643 print\_default\_numeric\_2d(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar)
00644 \{
00645     \textcolor{keywordtype}{size\_t} i, j, stride;
00646 
00647     \textcolor{keywordflow}{if} ( NULL == matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} )
00648         \textcolor{keywordflow}{return};
00649 
00650     stride = \hyperlink{group__mat__util_gab6774aabdc124c540c1e7686d0804940}{Mat\_SizeOf}(matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
00651     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
00652         \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t} *complex\_data = (
      \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t}*)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
00653         \textcolor{keywordtype}{char} *rp = (\textcolor{keywordtype}{char}*)complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re};
00654         \textcolor{keywordtype}{char} *ip = (\textcolor{keywordtype}{char}*)complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im};
00655         for ( i = 0; i < matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0]; i++ ) \{
00656             \textcolor{keywordflow}{for} ( j = 0; j < matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[1]; j++ ) \{
00657                 \textcolor{keywordtype}{size\_t} idx = matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0]*j+i;
00658                 print\_default\_number(matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},rp+idx*stride);
00659                 printf(\textcolor{stringliteral}{" + "});
00660                 print\_default\_number(matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},ip+idx*stride);
00661                 printf(\textcolor{stringliteral}{"i "});
00662             \}
00663             printf(\textcolor{stringliteral}{"\(\backslash\)n"});
00664         \}
00665     \} \textcolor{keywordflow}{else} \{
00666         \textcolor{keywordtype}{char} *data = (\textcolor{keywordtype}{char}*)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
00667         for ( i = 0; i < matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0]; i++ ) \{
00668             \textcolor{keywordflow}{for} ( j = 0; j < matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[1]; j++ ) \{
00669                 \textcolor{keywordtype}{size\_t} idx = matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0]*j+i;
00670                 print\_default\_number(matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},
00671                                 data+idx*stride);
00672                 printf(\textcolor{stringliteral}{" "});
00673             \}
00674             printf(\textcolor{stringliteral}{"\(\backslash\)n"});
00675         \}
00676     \}
00677 \}
00678 
00679 \textcolor{keyword}{static} \textcolor{keywordtype}{void}
00680 print\_default\_numeric\_3d(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar)
00681 \{
00682     \textcolor{keywordtype}{size\_t} i, j, k, l, stride;
00683 
00684     \textcolor{keywordflow}{if} ( NULL == matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} )
00685         \textcolor{keywordflow}{return};
00686 
00687     stride = \hyperlink{group__mat__util_gab6774aabdc124c540c1e7686d0804940}{Mat\_SizeOf}(matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type});
00688     \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aeb03b3a69f108dc05470b00443a43739}{isComplex} ) \{
00689         \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t} *complex\_data = (
      \hyperlink{group___m_a_t_structmat__complex__split__t}{mat\_complex\_split\_t}*)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
00690         \textcolor{keywordtype}{char} *rp = (\textcolor{keywordtype}{char}*)complex\_data->\hyperlink{group___m_a_t_a484a93607508adac2bce53a0252e0325}{Re};
00691         \textcolor{keywordtype}{char} *ip = (\textcolor{keywordtype}{char}*)complex\_data->\hyperlink{group___m_a_t_a7182d10b0d3598415887376065440946}{Im};
00692         for ( k = 0; k < matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[2]; k++ ) \{
00693             \hyperlink{group__mat__util_gae7dfa394b111bc908a616f8f5bddaa97}{Mat\_Message}(\textcolor{stringliteral}{"%s(:,:,%lu) = "},matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},k);
00694             indent++;
00695             \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0]; i++ ) \{
00696                 \textcolor{keywordflow}{for} ( l = 0; l < indent; l++ )
00697                     printf(\textcolor{stringliteral}{"    "});
00698                 \textcolor{keywordflow}{for} ( j = 0; j < matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[1]; j++ ) \{
00699                     \textcolor{keywordtype}{size\_t} idx = matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0]*matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[1]*k+matvar->
      \hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0]*j+i;
00700                     print\_default\_number(matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},rp+idx*stride);
00701                     printf(\textcolor{stringliteral}{" + "});
00702                     print\_default\_number(matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},ip+idx*stride);
00703                     printf(\textcolor{stringliteral}{"i "});
00704                 \}
00705                 printf(\textcolor{stringliteral}{"\(\backslash\)n"});
00706             \}
00707             indent--;
00708             printf(\textcolor{stringliteral}{"\(\backslash\)n"});
00709         \}
00710     \} \textcolor{keywordflow}{else} \{
00711         \textcolor{keywordtype}{char} *data = (\textcolor{keywordtype}{char}*)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
00712         for ( k = 0; k < matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[2]; k++ ) \{
00713             \hyperlink{group__mat__util_gae7dfa394b111bc908a616f8f5bddaa97}{Mat\_Message}(\textcolor{stringliteral}{"%s(:,:,%lu) = "},matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name},k);
00714             indent++;
00715             \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0]; i++ ) \{
00716                 \textcolor{keywordflow}{for} ( l = 0; l < indent; l++ )
00717                     printf(\textcolor{stringliteral}{"    "});
00718                 \textcolor{keywordflow}{for} ( j = 0; j < matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[1]; j++ ) \{
00719                     \textcolor{keywordtype}{size\_t} idx = matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0]*matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[1]*k+matvar->
      \hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0]*j+i;
00720                     print\_default\_number(matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type},
00721                                     data+idx*stride);
00722                     printf(\textcolor{stringliteral}{" "});
00723                 \}
00724                 printf(\textcolor{stringliteral}{"\(\backslash\)n"});
00725             \}
00726             indent--;
00727             printf(\textcolor{stringliteral}{"\(\backslash\)n"});
00728         \}
00729     \}
00730 \}
00731 
00732 \textcolor{keyword}{static} \textcolor{keywordtype}{void}
00733 print\_default(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar)
00734 \{
00735     \textcolor{keywordflow}{if} ( NULL == matvar )
00736         \textcolor{keywordflow}{return};
00737 
00738     \textcolor{keywordflow}{switch} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} ) \{
00739         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a5d70e0862e5bdb7bd86bf7ba5948f307}{MAT\_C\_DOUBLE}:
00740         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2825631e26a961cbe0f79db50a39cea2}{MAT\_C\_SINGLE}:
00741         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a1ea83bcde49b35477494412973f82409}{MAT\_C\_INT64}:
00742         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a86470e25c3763d9a24623f04326195dd}{MAT\_C\_UINT64}:
00743         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40adb44fc39694e3152ae5e69470a2fefe8}{MAT\_C\_INT32}:
00744         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a9a17a7edd45b19ef68197db81b27e816}{MAT\_C\_UINT32}:
00745         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a40370e9de516c5036a67a5865c071006}{MAT\_C\_INT16}:
00746         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a8bede21dbf6c1edc0bbccc1481bccae7}{MAT\_C\_UINT16}:
00747         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a984ff310f9e906100fcff95f704f43c5}{MAT\_C\_INT8}:
00748         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a81270f8093cb4808e992c1d29d84d4e3}{MAT\_C\_UINT8}:
00749         \{
00750             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} == 2 )
00751                 print\_default\_numeric\_2d(matvar);
00752             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} == 3 )
00753                 print\_default\_numeric\_3d(matvar);
00754             \textcolor{keywordflow}{break};
00755         \}
00756         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40aacdec5834df0861130b393697646119c}{MAT\_C\_CHAR}:
00757         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a0d5655b7e6178a2242cb3bb56ff4c8d2}{MAT\_C\_SPARSE}:
00758             \hyperlink{group___m_a_t_ga9100c145e338b84b55d5d0795d5d390a}{Mat\_VarPrint}(matvar, printdata);
00759             \textcolor{keywordflow}{break};
00760         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT}:
00761         \{
00762             \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **fields = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
00763             \textcolor{keywordtype}{int}        nfields;
00764             \textcolor{keywordtype}{int}        i;
00765             \textcolor{keywordtype}{size\_t}     nmemb;
00766 
00767             if ( matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} )
00768                 \hyperlink{group__mat__util_gae7dfa394b111bc908a616f8f5bddaa97}{Mat\_Message}(\textcolor{stringliteral}{"      Name: %s"}, matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
00769             \hyperlink{group__mat__util_gae7dfa394b111bc908a616f8f5bddaa97}{Mat\_Message}(\textcolor{stringliteral}{"      Rank: %d"}, matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank});
00770             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} == 0 )
00771                 \textcolor{keywordflow}{return};
00772             \hyperlink{group__mat__util_gae7dfa394b111bc908a616f8f5bddaa97}{Mat\_Message}(\textcolor{stringliteral}{"Class Type: Structure"});
00773             nfields = \hyperlink{group___m_a_t_ga06ba20aa758543d53dc83a1ccbdc2efc}{Mat\_VarGetNumberOfFields}(matvar);
00774             nmemb = matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0];
00775             \textcolor{keywordflow}{for} ( i = 1; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
00776                 nmemb *= matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
00777             if ( nfields > 0 && nmemb < 1 ) \{
00778                 \textcolor{keywordtype}{char} * \textcolor{keyword}{const} *fieldnames = \hyperlink{group___m_a_t_ga88bc328e59ce1dd8f43e917c07140803}{Mat\_VarGetStructFieldnames}(matvar);
00779                 \hyperlink{group__mat__util_gae7dfa394b111bc908a616f8f5bddaa97}{Mat\_Message}(\textcolor{stringliteral}{"Fields[%d] \{"}, nfields);
00780                 indent++;
00781                 \textcolor{keywordflow}{for} ( i = 0; i < nfields; i++ )
00782                     \hyperlink{group__mat__util_gae7dfa394b111bc908a616f8f5bddaa97}{Mat\_Message}(\textcolor{stringliteral}{"    Name: %s"}, fieldnames[i]);
00783                 indent--;
00784                 \hyperlink{group__mat__util_gae7dfa394b111bc908a616f8f5bddaa97}{Mat\_Message}(\textcolor{stringliteral}{"\}"});
00785             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( nfields > 0 && nmemb > 0 ) \{
00786                 \hyperlink{group__mat__util_gae7dfa394b111bc908a616f8f5bddaa97}{Mat\_Message}(\textcolor{stringliteral}{"Fields[%d] \{"}, nfields);
00787                 indent++;
00788                 \textcolor{keywordflow}{for} ( i = 0; i < nfields*nmemb; i++ )
00789                     print\_default(fields[i]);
00790                 indent--;
00791                 \hyperlink{group__mat__util_gae7dfa394b111bc908a616f8f5bddaa97}{Mat\_Message}(\textcolor{stringliteral}{"\}"});
00792             \}
00793             \textcolor{keywordflow}{break};
00794         \}
00795         \textcolor{keywordflow}{case} \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40a2f7abb47a1c51e248bd4e5e03cc81b08}{MAT\_C\_CELL}:
00796         \{
00797             \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **cells = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
00798             \textcolor{keywordtype}{size\_t}     ncells;
00799             \textcolor{keywordtype}{int}        i;
00800 
00801             if ( matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} )
00802                 \hyperlink{group__mat__util_gae7dfa394b111bc908a616f8f5bddaa97}{Mat\_Message}(\textcolor{stringliteral}{"      Name: %s"}, matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
00803             \hyperlink{group__mat__util_gae7dfa394b111bc908a616f8f5bddaa97}{Mat\_Message}(\textcolor{stringliteral}{"      Rank: %d"}, matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank});
00804             \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} == 0 )
00805                 \textcolor{keywordflow}{return};
00806             ncells = matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0];
00807             \textcolor{keywordflow}{for} ( i = 1; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
00808                 ncells *= matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
00809             \hyperlink{group__mat__util_gae7dfa394b111bc908a616f8f5bddaa97}{Mat\_Message}(\textcolor{stringliteral}{"Class Type: Cell Array"});
00810             \hyperlink{group__mat__util_gae7dfa394b111bc908a616f8f5bddaa97}{Mat\_Message}(\textcolor{stringliteral}{"\{"});
00811             indent++;
00812             \textcolor{keywordflow}{for} ( i = 0; i < ncells; i++ )
00813                 print\_default(cells[i]);
00814             indent--;
00815             \hyperlink{group__mat__util_gae7dfa394b111bc908a616f8f5bddaa97}{Mat\_Message}(\textcolor{stringliteral}{"\}"});
00816             \textcolor{keywordflow}{break};
00817         \}
00818         \textcolor{keywordflow}{default}:
00819             \hyperlink{group__mat__util_gae7dfa394b111bc908a616f8f5bddaa97}{Mat\_Message}(\textcolor{stringliteral}{"Empty"});
00820     \}
00821 \}
00822 
00823 \textcolor{keywordtype}{int}
00824 main (\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} *argv[])
00825 \{
00826     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *prog\_name = \textcolor{stringliteral}{"matdump"};
00827     \textcolor{keywordtype}{int}   i, c, err = EXIT\_SUCCESS;
00828     \hyperlink{struct__mat__t}{mat\_t}    *mat;
00829     \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar;
00830     \textcolor{keywordtype}{int} version[3];
00831 
00832     \hyperlink{mat_8c_a2069c4f0d1106778b56216ff4f95f94b}{Mat\_GetLibraryVersion}(version, version+1, version+2);
00833     \textcolor{keywordflow}{if} ( MATIO\_MAJOR\_VERSION != version[0] ||
00834          MATIO\_MINOR\_VERSION != version[1] ||
00835          MATIO\_RELEASE\_LEVEL != version[2] ) \{
00836         fprintf(stderr,\textcolor{stringliteral}{"matio version in header does not match runtime "}
00837                 \textcolor{stringliteral}{"version\(\backslash\)n"});
00838         \textcolor{keywordflow}{return} EXIT\_FAILURE;
00839     \}
00840 
00841     \hyperlink{group__mat__util_ga93f4dd8d36413ae7f49260d757e3ab9f}{Mat\_LogInitFunc}(prog\_name,default\_printf\_func);
00842 
00843     printfunc = print\_default;
00844 
00845     \textcolor{keywordflow}{while} ((c = getopt\_long(argc,argv,optstring,options,NULL)) != EOF) \{
00846         \textcolor{keywordflow}{switch} (c) \{
00847             \textcolor{keywordflow}{case} \textcolor{charliteral}{'d'}:
00848                 printdata = 1;
00849                 \hyperlink{group__mat__util_ga64a176ea7e27e38d4242a24f3e3bad24}{Mat\_VerbMessage}(1,\textcolor{stringliteral}{"Printing data\(\backslash\)n"});
00850                 \textcolor{keywordflow}{break};
00851             \textcolor{keywordflow}{case} \textcolor{charliteral}{'f'}:
00852                 \textcolor{keywordflow}{if} ( NULL != optarg ) \{
00853                     \textcolor{keywordflow}{if} ( !strcmp(optarg,\textcolor{stringliteral}{"whos"}) ) \{
00854                         printfunc = print\_whos;
00855                     \} \textcolor{keywordflow}{else} \{
00856                         \hyperlink{group__mat__util_gafcedc83eb7e4759a8ea5c974c4f801c3}{Mat\_Warning}(\textcolor{stringliteral}{"%s is not a recognized output format. "}
00857                               \textcolor{stringliteral}{"Using default\(\backslash\)n"}, optarg);
00858                     \}
00859                 \} \textcolor{keywordflow}{else} \{
00860                     \hyperlink{group__mat__util_gafcedc83eb7e4759a8ea5c974c4f801c3}{Mat\_Warning}(\textcolor{stringliteral}{"Missing output format. "}
00861                             \textcolor{stringliteral}{"Using default\(\backslash\)n"}, optarg);
00862                 \}
00863                 \textcolor{keywordflow}{break};
00864             \textcolor{keywordflow}{case} \textcolor{charliteral}{'h'}:
00865                 human\_readable = 1;
00866                 \textcolor{keywordflow}{break};
00867             \textcolor{keywordflow}{case} \textcolor{charliteral}{'v'}:
00868                 \hyperlink{group__mat__util_gaf348b811ee26bfc923924878cea3c9ba}{Mat\_SetVerbose}(1,0);
00869                 \textcolor{keywordflow}{break};
00870             \textcolor{keywordflow}{case} \textcolor{charliteral}{'H'}:
00871                 \hyperlink{group__mat__util_gaa4039c185e807ed2e9682b66fe2ea331}{Mat\_Help}(helpstr);
00872                 exit(EXIT\_SUCCESS);
00873             \textcolor{keywordflow}{case} \textcolor{charliteral}{'V'}:
00874                 printf(\textcolor{stringliteral}{"%s %s\(\backslash\)nWritten by Christopher Hulbert\(\backslash\)n\(\backslash\)n"}
00875                        \textcolor{stringliteral}{"Copyright(C) 2006-2018 Christopher C. Hulbert\(\backslash\)n"},
00876                        prog\_name,MATIO\_VERSION\_STR);
00877                 exit(EXIT\_SUCCESS);
00878             \textcolor{keywordflow}{default}:
00879                 printf(\textcolor{stringliteral}{"%c not a valid option\(\backslash\)n"}, c);
00880                 \textcolor{keywordflow}{break};
00881         \}
00882     \}
00883 
00884     \textcolor{keywordflow}{if} ( (argc-optind) < 1 ) \{
00885         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Must specify at least one argument"});
00886         \textcolor{keywordflow}{return} EXIT\_FAILURE;
00887     \}
00888 
00889     mat = \hyperlink{group___m_a_t_gafbfedb5636a99f0ef867520c47f77d18}{Mat\_Open}( argv[optind],\hyperlink{group___m_a_t_ggaa9dcbc70f538af79bd557593ff6b5cdba8dd1457651b27ba9bea6cfba158c037c}{MAT\_ACC\_RDONLY} );
00890     \textcolor{keywordflow}{if} ( NULL == mat ) \{
00891         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Error opening %s\(\backslash\)n"}, argv[optind]);
00892         \textcolor{keywordflow}{return} EXIT\_FAILURE;
00893     \}
00894 
00895     optind++;
00896 
00897     \textcolor{keywordflow}{if} ( optind < argc ) \{
00898         \textcolor{comment}{/* variables specified on the command line */}
00899         \textcolor{keywordflow}{for} ( i = optind; i < argc; i++ ) \{
00900             \textcolor{keywordtype}{char} *next\_tok\_pos, next\_tok = 0;
00901 
00902             next\_tok\_pos = get\_next\_token(argv[i]);
00903             \textcolor{keywordflow}{if} ( next\_tok\_pos != argv[i] ) \{
00904                 next\_tok = *next\_tok\_pos;
00905                 *next\_tok\_pos = \textcolor{charliteral}{'\(\backslash\)0'};
00906             \}
00907 
00908             matvar = \hyperlink{group___m_a_t_ga46da2e45ed96d3f1a6ec643757f2b086}{Mat\_VarReadInfo}(mat,argv[i]);
00909             \textcolor{keywordflow}{if} ( matvar ) \{
00910                 \textcolor{keywordflow}{if} ( printdata ) \{
00911                     \textcolor{keywordflow}{if} ( next\_tok == \textcolor{charliteral}{'\(\backslash\)0'} ) \{
00912                         \textcolor{comment}{/* No indexing tokens found, so read all of the data */}
00913                         \hyperlink{group___m_a_t_gaa8060d7c8e5da0aa9ee5f96e5f1eb30a}{Mat\_VarReadDataAll}(mat,matvar);
00914                     \} \textcolor{keywordflow}{else} \{
00915                         *next\_tok\_pos = next\_tok;
00916                         read\_selected\_data(mat,&matvar,next\_tok\_pos);
00917                     \}
00918                 \}
00919                 (*printfunc)(matvar);
00920                 \hyperlink{group___m_a_t_ga1d14716f7450530fd1c9d02413787f0e}{Mat\_VarFree}(matvar);
00921             \} \textcolor{keywordflow}{else} \{
00922                 \hyperlink{group__mat__util_gafcedc83eb7e4759a8ea5c974c4f801c3}{Mat\_Warning}(\textcolor{stringliteral}{"Couldn't find variable %s in the MAT file"},
00923                       argv[i]);
00924             \}
00925         \} \textcolor{comment}{/* for ( i = optind; i < argc; i++ ) */}
00926     \} \textcolor{keywordflow}{else} \{
00927         \textcolor{comment}{/* print all variables */}
00928         \textcolor{keywordflow}{if} ( printdata ) \{
00929             \textcolor{keywordflow}{while} ( (matvar = \hyperlink{group___m_a_t_ga7c321d6aafd93916ba6c5655ad78e9ca}{Mat\_VarReadNext}(mat)) != NULL ) \{
00930                 (*printfunc)(matvar);
00931                 \hyperlink{group___m_a_t_ga1d14716f7450530fd1c9d02413787f0e}{Mat\_VarFree}(matvar);
00932             \}
00933         \} \textcolor{keywordflow}{else} \{
00934             \textcolor{keywordflow}{while} ( (matvar = \hyperlink{group___m_a_t_ga72dd99330507b17177e22f9ed3bea5e6}{Mat\_VarReadNextInfo}(mat)) != NULL ) \{
00935                 (*printfunc)(matvar);
00936                 \hyperlink{group___m_a_t_ga1d14716f7450530fd1c9d02413787f0e}{Mat\_VarFree}(matvar);
00937             \}
00938         \}
00939     \}
00940 
00941     \hyperlink{group___m_a_t_ga101c92ff7bde4a2d4615661beba09262}{Mat\_Close}(mat);
00942 
00943     \hyperlink{group__mat__util_ga333d15dbd2e7a691621a2af8fc7adc3d}{Mat\_LogClose}();
00944 
00945     \textcolor{keywordflow}{return} err;
00946 \}
\end{DoxyCode}
