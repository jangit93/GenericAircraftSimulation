\hypertarget{eigen_2test_2rand_8cpp_source}{}\section{eigen/test/rand.cpp}
\label{eigen_2test_2rand_8cpp_source}\index{rand.\+cpp@{rand.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2015 Gael Guennebaud <gael.guennebaud@inria.fr>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#include "main.h"}
00011 
00012 \textcolor{keyword}{typedef} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} int64;
00013 
00014 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Scalar> Scalar check\_in\_range(Scalar x, Scalar y)
00015 \{
00016   Scalar r = internal::random<Scalar>(x,y);
00017   VERIFY(r>=x);
00018   \textcolor{keywordflow}{if}(y>=x)
00019   \{
00020     VERIFY(r<=y);
00021   \}
00022   \textcolor{keywordflow}{return} r;
00023 \}
00024 
00025 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Scalar> \textcolor{keywordtype}{void} check\_all\_in\_range(Scalar x, Scalar y)
00026 \{
00027   \hyperlink{group___core___module_class_eigen_1_1_array}{Array<int,1,Dynamic>} mask(y-x+1);
00028   mask.fill(0);
00029   \textcolor{keywordtype}{long} n = (y-x+1)*32;
00030   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{long} k=0; k<n; ++k)
00031   \{
00032     mask( check\_in\_range(x,y)-x )++;
00033   \}
00034   \textcolor{keywordflow}{for}(\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} i=0; i<mask.size(); ++i)
00035     \textcolor{keywordflow}{if}(mask(i)==0)
00036       std::cout << \textcolor{stringliteral}{"WARNING: value "} << x+i << \textcolor{stringliteral}{" not reached."} << std::endl;
00037   VERIFY( (mask>0).all() );
00038 \}
00039 
00040 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Scalar> \textcolor{keywordtype}{void} check\_histogram(Scalar x, Scalar y, \textcolor{keywordtype}{int} bins)
00041 \{
00042   \hyperlink{group___core___module_class_eigen_1_1_array}{Array<int,1,Dynamic>} hist(bins);
00043   hist.fill(0);
00044   \textcolor{keywordtype}{int} f = 100000;
00045   \textcolor{keywordtype}{int} n = bins*f;
00046   int64 range = int64(y)-int64(x);
00047   \textcolor{keywordtype}{int} divisor = int((range+1)/bins);
00048   assert(((range+1)%bins)==0);
00049   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} k=0; k<n; ++k)
00050   \{
00051     Scalar r = check\_in\_range(x,y);
00052     hist( \textcolor{keywordtype}{int}((int64(r)-int64(x))/divisor) )++;
00053   \}
00054   VERIFY( (((hist.cast<\textcolor{keywordtype}{double}>()/\textcolor{keywordtype}{double}(f))-1.0).abs()<0.02).all() );
00055 \}
00056 
00057 \textcolor{keywordtype}{void} test\_rand()
00058 \{
00059   \textcolor{keywordtype}{long} long\_ref = \hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<long>::highest}()/10;
00060   \textcolor{keywordtype}{signed} \textcolor{keywordtype}{char} char\_offset = (std::min)(g\_repeat,64);
00061   \textcolor{keywordtype}{signed} \textcolor{keywordtype}{char} short\_offset = (std::min)(g\_repeat,16000);
00062 
00063   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 0; i < g\_repeat*10000; i++) \{
00064     CALL\_SUBTEST(check\_in\_range<float>(10,11));
00065     CALL\_SUBTEST(check\_in\_range<float>(1.24234523,1.24234523));
00066     CALL\_SUBTEST(check\_in\_range<float>(-1,1));
00067     CALL\_SUBTEST(check\_in\_range<float>(-1432.2352,-1432.2352));
00068 
00069     CALL\_SUBTEST(check\_in\_range<double>(10,11));
00070     CALL\_SUBTEST(check\_in\_range<double>(1.24234523,1.24234523));
00071     CALL\_SUBTEST(check\_in\_range<double>(-1,1));
00072     CALL\_SUBTEST(check\_in\_range<double>(-1432.2352,-1432.2352));
00073 
00074     CALL\_SUBTEST(check\_in\_range<int>(0,-1));
00075     CALL\_SUBTEST(check\_in\_range<short>(0,-1));
00076     CALL\_SUBTEST(check\_in\_range<long>(0,-1));
00077     CALL\_SUBTEST(check\_in\_range<int>(-673456,673456));
00078     CALL\_SUBTEST(check\_in\_range<int>(-RAND\_MAX+10,RAND\_MAX-10));
00079     CALL\_SUBTEST(check\_in\_range<short>(-24345,24345));
00080     CALL\_SUBTEST(check\_in\_range<long>(-long\_ref,long\_ref));
00081   \}
00082 
00083   CALL\_SUBTEST(check\_all\_in\_range<signed char>(11,11));
00084   CALL\_SUBTEST(check\_all\_in\_range<signed char>(11,11+char\_offset));
00085   CALL\_SUBTEST(check\_all\_in\_range<signed char>(-5,5));
00086   CALL\_SUBTEST(check\_all\_in\_range<signed char>(-11-char\_offset,-11));
00087   CALL\_SUBTEST(check\_all\_in\_range<signed char>(-126,-126+char\_offset));
00088   CALL\_SUBTEST(check\_all\_in\_range<signed char>(126-char\_offset,126));
00089   CALL\_SUBTEST(check\_all\_in\_range<signed char>(-126,126));
00090 
00091   CALL\_SUBTEST(check\_all\_in\_range<short>(11,11));
00092   CALL\_SUBTEST(check\_all\_in\_range<short>(11,11+short\_offset));
00093   CALL\_SUBTEST(check\_all\_in\_range<short>(-5,5));
00094   CALL\_SUBTEST(check\_all\_in\_range<short>(-11-short\_offset,-11));
00095   CALL\_SUBTEST(check\_all\_in\_range<short>(-24345,-24345+short\_offset));
00096   CALL\_SUBTEST(check\_all\_in\_range<short>(24345,24345+short\_offset));
00097 
00098   CALL\_SUBTEST(check\_all\_in\_range<int>(11,11));
00099   CALL\_SUBTEST(check\_all\_in\_range<int>(11,11+g\_repeat));
00100   CALL\_SUBTEST(check\_all\_in\_range<int>(-5,5));
00101   CALL\_SUBTEST(check\_all\_in\_range<int>(-11-g\_repeat,-11));
00102   CALL\_SUBTEST(check\_all\_in\_range<int>(-673456,-673456+g\_repeat));
00103   CALL\_SUBTEST(check\_all\_in\_range<int>(673456,673456+g\_repeat));
00104 
00105   CALL\_SUBTEST(check\_all\_in\_range<long>(11,11));
00106   CALL\_SUBTEST(check\_all\_in\_range<long>(11,11+g\_repeat));
00107   CALL\_SUBTEST(check\_all\_in\_range<long>(-5,5));
00108   CALL\_SUBTEST(check\_all\_in\_range<long>(-11-g\_repeat,-11));
00109   CALL\_SUBTEST(check\_all\_in\_range<long>(-long\_ref,-long\_ref+g\_repeat));
00110   CALL\_SUBTEST(check\_all\_in\_range<long>( long\_ref, long\_ref+g\_repeat));
00111 
00112   CALL\_SUBTEST(check\_histogram<int>(-5,5,11));
00113   \textcolor{keywordtype}{int} bins = 100;
00114   CALL\_SUBTEST(check\_histogram<int>(-3333,-3333+bins*(3333/bins)-1,bins));
00115   bins = 1000;
00116   CALL\_SUBTEST(check\_histogram<int>(-RAND\_MAX+10,-RAND\_MAX+10+bins*(RAND\_MAX/bins)-1,bins));
00117   CALL\_SUBTEST(check\_histogram<int>(-RAND\_MAX+10,-int64(RAND\_MAX)+10+bins*(2*int64(RAND\_MAX)/bins)-1,bins))
      ;
00118 \}
\end{DoxyCode}
