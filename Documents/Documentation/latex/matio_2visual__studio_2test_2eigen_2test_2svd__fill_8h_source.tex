\hypertarget{matio_2visual__studio_2test_2eigen_2test_2svd__fill_8h_source}{}\section{matio/visual\+\_\+studio/test/eigen/test/svd\+\_\+fill.h}
\label{matio_2visual__studio_2test_2eigen_2test_2svd__fill_8h_source}\index{svd\+\_\+fill.\+h@{svd\+\_\+fill.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2014-2015 Gael Guennebaud <gael.guennebaud@inria.fr>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>
00011 Array<T,4,1> four\_denorms();
00012 
00013 \textcolor{keyword}{template}<>
00014 Array4f four\_denorms() \{ \textcolor{keywordflow}{return} Array4f(5.60844e-39f, -5.60844e-39f, 4.94e-44f, -4.94e-44f); \}
00015 \textcolor{keyword}{template}<>
00016 Array4d four\_denorms() \{ \textcolor{keywordflow}{return} Array4d(5.60844e-313, -5.60844e-313, 4.94e-324, -4.94e-324); \}
00017 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>
00018 Array<T,4,1> four\_denorms() \{ \textcolor{keywordflow}{return} four\_denorms<double>().cast<T>(); \}
00019 
00020 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>
00021 \textcolor{keywordtype}{void} svd\_fill\_random(MatrixType &m, \textcolor{keywordtype}{int} Option = 0)
00022 \{
00023   \textcolor{keyword}{using} std::pow;
00024   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::Scalar Scalar;
00025   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::RealScalar RealScalar;
00026   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::Index \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index};
00027   Index diagSize = (std::min)(m.rows(), m.cols());
00028   RealScalar s = std::numeric\_limits<RealScalar>::max\_exponent10/4;
00029   s = internal::random<RealScalar>(1,s);
00030   Matrix<RealScalar,Dynamic,1> d =  Matrix<RealScalar,Dynamic,1>::Random(diagSize);
00031   \textcolor{keywordflow}{for}(Index k=0; k<diagSize; ++k)
00032     d(k) = d(k)*\hyperlink{group___core___module_ab6dc101d82e8228a19a8840e3a29c1c9}{pow}(RealScalar(10),internal::random<RealScalar>(-s,s));
00033 
00034   \textcolor{keywordtype}{bool} dup     = internal::random<int>(0,10) < 3;
00035   \textcolor{keywordtype}{bool} unit\_uv = internal::random<int>(0,10) < (dup?7:3); \textcolor{comment}{// if we duplicate some diagonal entries, then
       increase the chance to preserve them using unitary U and V factors}
00036   
00037   \textcolor{comment}{// duplicate some singular values}
00038   \textcolor{keywordflow}{if}(dup)
00039   \{
00040     Index n = internal::random<Index>(0,d.size()-1);
00041     \textcolor{keywordflow}{for}(Index i=0; i<n; ++i)
00042       d(internal::random<Index>(0,d.size()-1)) = d(internal::random<Index>(0,d.size()-1));
00043   \}
00044   
00045   Matrix<Scalar,Dynamic,Dynamic> U(m.rows(),diagSize);
00046   Matrix<Scalar,Dynamic,Dynamic> VT(diagSize,m.cols());
00047   \textcolor{keywordflow}{if}(unit\_uv)
00048   \{
00049     \textcolor{comment}{// in very rare cases let's try with a pure diagonal matrix}
00050     \textcolor{keywordflow}{if}(internal::random<int>(0,10) < 1)
00051     \{
00052       U.setIdentity();
00053       VT.setIdentity();
00054     \}
00055     \textcolor{keywordflow}{else}
00056     \{
00057       \hyperlink{namespace_eigen_a0d9a7ddcee5c7c8defaba3628455efb2}{createRandomPIMatrixOfRank}(diagSize,U.rows(), U.cols(), U);
00058       \hyperlink{namespace_eigen_a0d9a7ddcee5c7c8defaba3628455efb2}{createRandomPIMatrixOfRank}(diagSize,VT.rows(), VT.cols(), VT);
00059     \}
00060   \}
00061   \textcolor{keywordflow}{else}
00062   \{
00063     U.setRandom();
00064     VT.setRandom();
00065   \}
00066   
00067   Matrix<Scalar,Dynamic,1> samples(9);
00068   samples << 0, four\_denorms<RealScalar>(),
00069             -RealScalar(1)/NumTraits<RealScalar>::highest(), RealScalar(1)/NumTraits<RealScalar>::highest()
      , (std::numeric\_limits<RealScalar>::min)(), \hyperlink{group___core___module_ab6dc101d82e8228a19a8840e3a29c1c9}{pow}((std::numeric\_limits<RealScalar>::min)(),0.8);
00070   
00071   \textcolor{keywordflow}{if}(Option==\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda7d30fb969ef6b763c098f0015108cef4}{Symmetric})
00072   \{
00073     m = U * d.asDiagonal() * U.transpose();
00074     
00075     \textcolor{comment}{// randomly nullify some rows/columns}
00076     \{
00077       Index count = internal::random<Index>(-diagSize,diagSize);
00078       \textcolor{keywordflow}{for}(Index k=0; k<count; ++k)
00079       \{
00080         Index i = internal::random<Index>(0,diagSize-1);
00081         m.row(i).setZero();
00082         m.col(i).setZero();
00083       \}
00084       \textcolor{keywordflow}{if}(count<0)
00085       \textcolor{comment}{// (partly) cancel some coeffs}
00086       \textcolor{keywordflow}{if}(!(dup && unit\_uv))
00087       \{
00088         
00089         Index n = internal::random<Index>(0,m.size()-1);
00090         \textcolor{keywordflow}{for}(Index k=0; k<n; ++k)
00091         \{
00092           Index i = internal::random<Index>(0,m.rows()-1);
00093           Index j = internal::random<Index>(0,m.cols()-1);
00094           m(j,i) = m(i,j) = samples(internal::random<Index>(0,samples.size()-1));
00095           \textcolor{keywordflow}{if}(NumTraits<Scalar>::IsComplex)
00096             *(&numext::real\_ref(m(j,i))+1) = *(&numext::real\_ref(m(i,j))+1) = samples.real()(
      internal::random<Index>(0,samples.size()-1));
00097         \}
00098       \}
00099     \}
00100   \}
00101   \textcolor{keywordflow}{else}
00102   \{
00103     m = U * d.asDiagonal() * VT;
00104     \textcolor{comment}{// (partly) cancel some coeffs}
00105     \textcolor{keywordflow}{if}(!(dup && unit\_uv))
00106     \{
00107       Index n = internal::random<Index>(0,m.size()-1);
00108       \textcolor{keywordflow}{for}(Index k=0; k<n; ++k)
00109       \{
00110         Index i = internal::random<Index>(0,m.rows()-1);
00111         Index j = internal::random<Index>(0,m.cols()-1);
00112         m(i,j) = samples(internal::random<Index>(0,samples.size()-1));
00113         \textcolor{keywordflow}{if}(NumTraits<Scalar>::IsComplex)
00114           *(&numext::real\_ref(m(i,j))+1) = samples.real()(internal::random<Index>(0,samples.size()-1));
00115       \}
00116     \}
00117   \}
00118 \}
00119 
\end{DoxyCode}
