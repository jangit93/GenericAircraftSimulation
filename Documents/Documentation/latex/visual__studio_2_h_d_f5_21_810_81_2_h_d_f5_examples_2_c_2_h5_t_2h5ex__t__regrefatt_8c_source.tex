\hypertarget{visual__studio_2_h_d_f5_21_810_81_2_h_d_f5_examples_2_c_2_h5_t_2h5ex__t__regrefatt_8c_source}{}\section{visual\+\_\+studio/\+H\+D\+F5/1.10.1/\+H\+D\+F5\+Examples/\+C/\+H5\+T/h5ex\+\_\+t\+\_\+regrefatt.c}
\label{visual__studio_2_h_d_f5_21_810_81_2_h_d_f5_examples_2_c_2_h5_t_2h5ex__t__regrefatt_8c_source}\index{h5ex\+\_\+t\+\_\+regrefatt.\+c@{h5ex\+\_\+t\+\_\+regrefatt.\+c}}

\begin{DoxyCode}
00001 \textcolor{comment}{/************************************************************}
00002 \textcolor{comment}{}
00003 \textcolor{comment}{  This example shows how to read and write region references}
00004 \textcolor{comment}{  to an attribute.  The program first creates a dataset}
00005 \textcolor{comment}{  containing characters and writes references to region of}
00006 \textcolor{comment}{  the dataset to a new attribute with a dataspace of DIM0,}
00007 \textcolor{comment}{  then closes the file.  Next, it reopens the file,}
00008 \textcolor{comment}{  dereferences the references, and outputs the referenced}
00009 \textcolor{comment}{  regions to the screen.}
00010 \textcolor{comment}{}
00011 \textcolor{comment}{  This file is intended for use with HDF5 Library version 1.8}
00012 \textcolor{comment}{}
00013 \textcolor{comment}{ ************************************************************/}
00014 
00015 \textcolor{preprocessor}{#include "hdf5.h"}
00016 \textcolor{preprocessor}{#include <stdio.h>}
00017 \textcolor{preprocessor}{#include <stdlib.h>}
00018 
00019 \textcolor{preprocessor}{#define FILE            "h5ex\_t\_regrefatt.h5"}
00020 \textcolor{preprocessor}{#define DATASET         "DS1"}
00021 \textcolor{preprocessor}{#define DATASET2        "DS2"}
00022 \textcolor{preprocessor}{#define ATTRIBUTE       "A1"}
00023 \textcolor{preprocessor}{#define DIM0            2}
00024 \textcolor{preprocessor}{#define DS2DIM0         3}
00025 \textcolor{preprocessor}{#define DS2DIM1         16}
00026 
00027 \textcolor{keywordtype}{int}
00028 main (\textcolor{keywordtype}{void})
00029 \{
00030     hid\_t               \hyperlink{structfile}{file}, space, memspace, dset, dset2, attr;
00031                                                     \textcolor{comment}{/* Handles */}
00032     herr\_t              status;
00033     hsize\_t             dims[1] = \{DIM0\},
00034                         dims2[2] = \{DS2DIM0, DS2DIM1\},
00035                         coords[4][2] = \{ \{0,  1\},
00036                                          \{2, 11\},
00037                                          \{1,  0\},
00038                                          \{2,  4\} \},
00039                         start[2] = \{0, 0\},
00040                         stride[2] = \{2, 11\},
00041                         count[2] = \{2, 2\},
00042                         block[2] = \{1, 3\};
00043     hssize\_t            npoints;
00044     hdset\_reg\_ref\_t     wdata[DIM0],                \textcolor{comment}{/* Write buffer */}
00045                         *rdata;                     \textcolor{comment}{/* Read buffer */}
00046     ssize\_t             size;
00047     \textcolor{keywordtype}{char}                wdata2[DS2DIM0][DS2DIM1] = \{\textcolor{stringliteral}{"The quick brown"},
00048                                                     \textcolor{stringliteral}{"fox jumps over "},
00049                                                     \textcolor{stringliteral}{"the 5 lazy dogs"}\},
00050                         *rdata2,
00051                         *name;
00052     \textcolor{keywordtype}{int}                 ndims,
00053                         i;
00054 
00055     \textcolor{comment}{/*}
00056 \textcolor{comment}{     * Create a new file using the default properties.}
00057 \textcolor{comment}{     */}
00058     file = H5Fcreate (FILE, H5F\_ACC\_TRUNC, H5P\_DEFAULT, H5P\_DEFAULT);
00059 
00060     \textcolor{comment}{/*}
00061 \textcolor{comment}{     * Create a dataset with character data.}
00062 \textcolor{comment}{     */}
00063     space = H5Screate\_simple (2, dims2, NULL);
00064     dset2 = H5Dcreate (file, DATASET2, H5T\_STD\_I8LE, space, H5P\_DEFAULT,
00065                 H5P\_DEFAULT, H5P\_DEFAULT);
00066     status = H5Dwrite (dset2, H5T\_NATIVE\_CHAR, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT,
00067                 wdata2);
00068 
00069     \textcolor{comment}{/*}
00070 \textcolor{comment}{     * Create reference to a list of elements in dset2.}
00071 \textcolor{comment}{     */}
00072     status = H5Sselect\_elements (space, H5S\_SELECT\_SET, 4, coords[0]);
00073     status = H5Rcreate (&wdata[0], file, DATASET2, H5R\_DATASET\_REGION, space);
00074 
00075     \textcolor{comment}{/*}
00076 \textcolor{comment}{     * Create reference to a hyperslab in dset2, close dataspace.}
00077 \textcolor{comment}{     */}
00078     status = H5Sselect\_hyperslab (space, H5S\_SELECT\_SET, start, stride, count,
00079                 block);
00080     status = H5Rcreate (&wdata[1], file, DATASET2, H5R\_DATASET\_REGION, space);
00081     status = H5Sclose (space);
00082 
00083     \textcolor{comment}{/*}
00084 \textcolor{comment}{     * Create dataset with a null dataspace to serve as the parent for}
00085 \textcolor{comment}{     * the attribute.}
00086 \textcolor{comment}{     */}
00087     space = H5Screate (H5S\_NULL);
00088     dset = H5Dcreate (file, DATASET, H5T\_STD\_I32LE, space, H5P\_DEFAULT,
00089                 H5P\_DEFAULT, H5P\_DEFAULT);
00090     status = H5Sclose (space);
00091 
00092     \textcolor{comment}{/*}
00093 \textcolor{comment}{     * Create dataspace.  Setting maximum size to NULL sets the maximum}
00094 \textcolor{comment}{     * size to be the current size.}
00095 \textcolor{comment}{     */}
00096     space = H5Screate\_simple (1, dims, NULL);
00097 
00098     \textcolor{comment}{/*}
00099 \textcolor{comment}{     * Create the attribute and write the region references to it.}
00100 \textcolor{comment}{     */}
00101     attr = H5Acreate (dset, ATTRIBUTE, H5T\_STD\_REF\_DSETREG, space, H5P\_DEFAULT,
00102                     H5P\_DEFAULT);
00103     status = H5Awrite (attr, H5T\_STD\_REF\_DSETREG, wdata);
00104 
00105     \textcolor{comment}{/*}
00106 \textcolor{comment}{     * Close and release resources.}
00107 \textcolor{comment}{     */}
00108     status = H5Aclose (attr);
00109     status = H5Dclose (dset);
00110     status = H5Dclose (dset2);
00111     status = H5Sclose (space);
00112     status = H5Fclose (file);
00113 
00114 
00115     \textcolor{comment}{/*}
00116 \textcolor{comment}{     * Now we begin the read section of this example.  Here we assume}
00117 \textcolor{comment}{     * the attribute has the same name and rank, but can have any size.}
00118 \textcolor{comment}{     * Therefore we must allocate a new array to read in data using}
00119 \textcolor{comment}{     * malloc().}
00120 \textcolor{comment}{     */}
00121 
00122     \textcolor{comment}{/*}
00123 \textcolor{comment}{     * Open file, dataset, and attribute.}
00124 \textcolor{comment}{     */}
00125     file = H5Fopen (FILE, H5F\_ACC\_RDONLY, H5P\_DEFAULT);
00126     dset = H5Dopen (file, DATASET, H5P\_DEFAULT);
00127     attr = H5Aopen (dset, ATTRIBUTE, H5P\_DEFAULT);
00128 
00129     \textcolor{comment}{/*}
00130 \textcolor{comment}{     * Get dataspace and allocate memory for read buffer.}
00131 \textcolor{comment}{     */}
00132     space = H5Aget\_space (attr);
00133     ndims = H5Sget\_simple\_extent\_dims (space, dims, NULL);
00134     rdata = (hdset\_reg\_ref\_t *) malloc (dims[0] * \textcolor{keyword}{sizeof} (hdset\_reg\_ref\_t));
00135     status = H5Sclose (space);
00136 
00137     \textcolor{comment}{/*}
00138 \textcolor{comment}{     * Read the data.}
00139 \textcolor{comment}{     */}
00140     status = H5Aread (attr, H5T\_STD\_REF\_DSETREG, rdata);
00141 
00142     \textcolor{comment}{/*}
00143 \textcolor{comment}{     * Output the data to the screen.}
00144 \textcolor{comment}{     */}
00145     \textcolor{keywordflow}{for} (i=0; i<dims[0]; i++) \{
00146         printf (\textcolor{stringliteral}{"%s[%d]:\(\backslash\)n  ->"}, ATTRIBUTE, i);
00147 
00148         \textcolor{comment}{/*}
00149 \textcolor{comment}{         * Open the referenced object, retrieve its region as a}
00150 \textcolor{comment}{         * dataspace selection.}
00151 \textcolor{comment}{         */}
00152         dset2 = H5Rdereference (dset, H5P\_DEFAULT, H5R\_DATASET\_REGION, &rdata[i]);
00153         space = H5Rget\_region (dset, H5R\_DATASET\_REGION, &rdata[i]);
00154 
00155         \textcolor{comment}{/*}
00156 \textcolor{comment}{         * Get the length of the object's name, allocate space, then}
00157 \textcolor{comment}{         * retrieve the name.}
00158 \textcolor{comment}{         */}
00159         size = 1 + H5Iget\_name (dset2, NULL, 0);
00160         name = (\textcolor{keywordtype}{char} *) malloc (size);
00161         size = H5Iget\_name (dset2, name, size);
00162 
00163         \textcolor{comment}{/*}
00164 \textcolor{comment}{         * Allocate space for the read buffer.  We will only allocate}
00165 \textcolor{comment}{         * enough space for the selection, plus a null terminator.  The}
00166 \textcolor{comment}{         * read buffer will be 1-dimensional.}
00167 \textcolor{comment}{         */}
00168         npoints = H5Sget\_select\_npoints (space);
00169         rdata2 = (\textcolor{keywordtype}{char} *) malloc (npoints + 1);
00170 
00171         \textcolor{comment}{/*}
00172 \textcolor{comment}{         * Read the dataset region, and add a null terminator so we can}
00173 \textcolor{comment}{         * print it as a string.}
00174 \textcolor{comment}{         */}
00175         memspace = H5Screate\_simple (1, (hsize\_t *) &npoints, NULL);
00176         status = H5Dread (dset2, H5T\_NATIVE\_CHAR, memspace, space, H5P\_DEFAULT,
00177                     rdata2);
00178         rdata2[npoints] = \textcolor{charliteral}{'\(\backslash\)0'};
00179 
00180         \textcolor{comment}{/*}
00181 \textcolor{comment}{         * Print the name and region data, close and release resources.}
00182 \textcolor{comment}{         */}
00183         printf (\textcolor{stringliteral}{" %s: %s\(\backslash\)n"}, name, rdata2);
00184         free (rdata2);
00185         free (name);
00186         status = H5Sclose (space);
00187         status = H5Sclose (memspace);
00188         status = H5Dclose (dset2);
00189     \}
00190 
00191     \textcolor{comment}{/*}
00192 \textcolor{comment}{     * Close and release resources.}
00193 \textcolor{comment}{     */}
00194     free (rdata);
00195     status = H5Aclose (attr);
00196     status = H5Dclose (dset);
00197     status = H5Fclose (file);
00198 
00199     \textcolor{keywordflow}{return} 0;
00200 \}
\end{DoxyCode}
