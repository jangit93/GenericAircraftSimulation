\hypertarget{matio_2visual__studio_2test_2eigen_2test_2eigensolver__generic_8cpp_source}{}\section{matio/visual\+\_\+studio/test/eigen/test/eigensolver\+\_\+generic.cpp}
\label{matio_2visual__studio_2test_2eigen_2test_2eigensolver__generic_8cpp_source}\index{eigensolver\+\_\+generic.\+cpp@{eigensolver\+\_\+generic.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2008 Gael Guennebaud <gael.guennebaud@inria.fr>}
00005 \textcolor{comment}{// Copyright (C) 2010,2012 Jitse Niesen <jitse@maths.leeds.ac.uk>}
00006 \textcolor{comment}{//}
00007 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00008 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00009 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00010 
00011 \textcolor{preprocessor}{#include "main.h"}
00012 \textcolor{preprocessor}{#include <limits>}
00013 \textcolor{preprocessor}{#include <Eigen/Eigenvalues>}
00014 
00015 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType> \textcolor{keywordtype}{void} eigensolver(\textcolor{keyword}{const} MatrixType& m)
00016 \{
00017   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::Index \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index};
00018   \textcolor{comment}{/* this test covers the following files:}
00019 \textcolor{comment}{     EigenSolver.h}
00020 \textcolor{comment}{  */}
00021   Index rows = m.rows();
00022   Index cols = m.cols();
00023 
00024   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::Scalar Scalar;
00025   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<Scalar>::Real} RealScalar;
00026   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<RealScalar, MatrixType::RowsAtCompileTime, 1>}
       RealVectorType;
00027   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} std::complex<typename NumTraits<typename MatrixType::Scalar>::Real> Complex;
00028 
00029   MatrixType a = MatrixType::Random(rows,cols);
00030   MatrixType a1 = MatrixType::Random(rows,cols);
00031   MatrixType symmA =  a.adjoint() * a + a1.adjoint() * a1;
00032 
00033   \hyperlink{group___eigenvalues___module_class_eigen_1_1_eigen_solver}{EigenSolver<MatrixType>} ei0(symmA);
00034   VERIFY\_IS\_EQUAL(ei0.info(), \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea52581b035f4b59c203b8ff999ef5fcea}{Success});
00035   VERIFY\_IS\_APPROX(symmA * ei0.pseudoEigenvectors(), ei0.pseudoEigenvectors() * ei0.pseudoEigenvalueMatrix(
      ));
00036   VERIFY\_IS\_APPROX((symmA.template cast<Complex>()) * (ei0.pseudoEigenvectors().template cast<Complex>()),
00037     (ei0.pseudoEigenvectors().template cast<Complex>()) * (ei0.eigenvalues().asDiagonal()));
00038 
00039   \hyperlink{group___eigenvalues___module_class_eigen_1_1_eigen_solver}{EigenSolver<MatrixType>} ei1(a);
00040   VERIFY\_IS\_EQUAL(ei1.info(), \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea52581b035f4b59c203b8ff999ef5fcea}{Success});
00041   VERIFY\_IS\_APPROX(a * ei1.pseudoEigenvectors(), ei1.pseudoEigenvectors() * ei1.pseudoEigenvalueMatrix());
00042   VERIFY\_IS\_APPROX(a.template cast<Complex>() * ei1.eigenvectors(),
00043                    ei1.eigenvectors() * ei1.eigenvalues().asDiagonal());
00044   VERIFY\_IS\_APPROX(ei1.eigenvectors().colwise().norm(), RealVectorType::Ones(rows).transpose());
00045   VERIFY\_IS\_APPROX(a.eigenvalues(), ei1.eigenvalues());
00046 
00047   \hyperlink{group___eigenvalues___module_class_eigen_1_1_eigen_solver}{EigenSolver<MatrixType>} ei2;
00048   ei2.\hyperlink{group___eigenvalues___module_a6cff220aadfd8d8c1366b915ddefd164}{setMaxIterations}(
      \hyperlink{group___eigenvalues___module_class_eigen_1_1_real_schur}{RealSchur<MatrixType>::m\_maxIterationsPerRow} * rows).
      \hyperlink{group___eigenvalues___module_a38d032b75b3e75640e3db42e7ab20c24}{compute}(a);
00049   VERIFY\_IS\_EQUAL(ei2.info(), \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea52581b035f4b59c203b8ff999ef5fcea}{Success});
00050   VERIFY\_IS\_EQUAL(ei2.eigenvectors(), ei1.eigenvectors());
00051   VERIFY\_IS\_EQUAL(ei2.eigenvalues(), ei1.eigenvalues());
00052   \textcolor{keywordflow}{if} (rows > 2) \{
00053     ei2.setMaxIterations(1).compute(a);
00054     VERIFY\_IS\_EQUAL(ei2.info(), \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5eaba1c8763d1179778070f365ecc4157a8}{NoConvergence});
00055     VERIFY\_IS\_EQUAL(ei2.getMaxIterations(), 1);
00056   \}
00057 
00058   \hyperlink{group___eigenvalues___module_class_eigen_1_1_eigen_solver}{EigenSolver<MatrixType>} eiNoEivecs(a, \textcolor{keyword}{false});
00059   VERIFY\_IS\_EQUAL(eiNoEivecs.info(), \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea52581b035f4b59c203b8ff999ef5fcea}{Success});
00060   VERIFY\_IS\_APPROX(ei1.eigenvalues(), eiNoEivecs.eigenvalues());
00061   VERIFY\_IS\_APPROX(ei1.pseudoEigenvalueMatrix(), eiNoEivecs.pseudoEigenvalueMatrix());
00062 
00063   MatrixType \textcolor{keywordtype}{id} = MatrixType::Identity(rows, cols);
00064   VERIFY\_IS\_APPROX(\textcolor{keywordtype}{id}.operatorNorm(), RealScalar(1));
00065 
00066   \textcolor{keywordflow}{if} (rows > 2 && rows < 20)
00067   \{
00068     \textcolor{comment}{// Test matrix with NaN}
00069     a(0,0) = std::numeric\_limits<typename MatrixType::RealScalar>::quiet\_NaN();
00070     \hyperlink{group___eigenvalues___module_class_eigen_1_1_eigen_solver}{EigenSolver<MatrixType>} eiNaN(a);
00071     VERIFY\_IS\_EQUAL(eiNaN.info(), \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5eaba1c8763d1179778070f365ecc4157a8}{NoConvergence});
00072   \}
00073 
00074   \textcolor{comment}{// regression test for bug 1098}
00075   \{
00076     \hyperlink{group___eigenvalues___module_class_eigen_1_1_eigen_solver}{EigenSolver<MatrixType>} eig(a.adjoint() * a);
00077     eig.compute(a.adjoint() * a);
00078   \}
00079 
00080   \textcolor{comment}{// regression test for bug 478}
00081   \{
00082     a.setZero();
00083     \hyperlink{group___eigenvalues___module_class_eigen_1_1_eigen_solver}{EigenSolver<MatrixType>} ei3(a);
00084     VERIFY\_IS\_EQUAL(ei3.info(), \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea52581b035f4b59c203b8ff999ef5fcea}{Success});
00085     VERIFY\_IS\_MUCH\_SMALLER\_THAN(ei3.eigenvalues().norm(),RealScalar(1));
00086     VERIFY((ei3.eigenvectors().transpose()*ei3.eigenvectors().transpose()).eval().isIdentity());
00087   \}
00088 \}
00089 
00090 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType> \textcolor{keywordtype}{void} eigensolver\_verify\_assert(\textcolor{keyword}{const} MatrixType& m)
00091 \{
00092   \hyperlink{group___eigenvalues___module_class_eigen_1_1_eigen_solver}{EigenSolver<MatrixType>} eig;
00093   VERIFY\_RAISES\_ASSERT(eig.\hyperlink{group___eigenvalues___module_a66288022802172e3ee059283b26201d7}{eigenvectors}());
00094   VERIFY\_RAISES\_ASSERT(eig.\hyperlink{group___eigenvalues___module_a4e796226f06e1f7347cf03a38755a155}{pseudoEigenvectors}());
00095   VERIFY\_RAISES\_ASSERT(eig.\hyperlink{group___eigenvalues___module_a4979eafe0aeef06b19ada7fa5e19db17}{pseudoEigenvalueMatrix}());
00096   VERIFY\_RAISES\_ASSERT(eig.\hyperlink{group___eigenvalues___module_a114189009e42f5e03372a7a3dfa33b97}{eigenvalues}());
00097 
00098   MatrixType a = MatrixType::Random(m.rows(),m.cols());
00099   eig.\hyperlink{group___eigenvalues___module_a38d032b75b3e75640e3db42e7ab20c24}{compute}(a, \textcolor{keyword}{false});
00100   VERIFY\_RAISES\_ASSERT(eig.\hyperlink{group___eigenvalues___module_a66288022802172e3ee059283b26201d7}{eigenvectors}());
00101   VERIFY\_RAISES\_ASSERT(eig.\hyperlink{group___eigenvalues___module_a4e796226f06e1f7347cf03a38755a155}{pseudoEigenvectors}());
00102 \}
00103 
00104 \textcolor{keywordtype}{void} test\_eigensolver\_generic()
00105 \{
00106   \textcolor{keywordtype}{int} s = 0;
00107   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 0; i < g\_repeat; i++) \{
00108     CALL\_SUBTEST\_1( eigensolver(Matrix4f()) );
00109     s = internal::random<int>(1,EIGEN\_TEST\_MAX\_SIZE/4);
00110     CALL\_SUBTEST\_2( eigensolver(MatrixXd(s,s)) );
00111     TEST\_SET\_BUT\_UNUSED\_VARIABLE(s)
00112 
00113     \textcolor{comment}{// some trivial but implementation-wise tricky cases}
00114     CALL\_SUBTEST\_2( eigensolver(MatrixXd(1,1)) );
00115     CALL\_SUBTEST\_2( eigensolver(MatrixXd(2,2)) );
00116     CALL\_SUBTEST\_3( eigensolver(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<double,1,1>}()) );
00117     CALL\_SUBTEST\_4( eigensolver(Matrix2d()) );
00118   \}
00119 
00120   CALL\_SUBTEST\_1( eigensolver\_verify\_assert(Matrix4f()) );
00121   s = internal::random<int>(1,EIGEN\_TEST\_MAX\_SIZE/4);
00122   CALL\_SUBTEST\_2( eigensolver\_verify\_assert(MatrixXd(s,s)) );
00123   CALL\_SUBTEST\_3( eigensolver\_verify\_assert(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<double,1,1>}()) );
00124   CALL\_SUBTEST\_4( eigensolver\_verify\_assert(Matrix2d()) );
00125 
00126   \textcolor{comment}{// Test problem size constructors}
00127   CALL\_SUBTEST\_5(\hyperlink{group___eigenvalues___module_class_eigen_1_1_eigen_solver}{EigenSolver<MatrixXf>} tmp(s));
00128 
00129   \textcolor{comment}{// regression test for bug 410}
00130   CALL\_SUBTEST\_2(
00131   \{
00132      MatrixXd \hyperlink{group___core___module_class_eigen_1_1_matrix}{A}(1,1);
00133      \hyperlink{group___core___module_class_eigen_1_1_matrix}{A}(0,0) = std::sqrt(-1.); \textcolor{comment}{// is Not-a-Number}
00134      \hyperlink{group___eigenvalues___module_class_eigen_1_1_eigen_solver}{Eigen::EigenSolver<MatrixXd>} solver(\hyperlink{group___core___module_class_eigen_1_1_matrix}{A});
00135      VERIFY\_IS\_EQUAL(solver.info(), \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5eaaf9b736d310a664e7729d163a035cc5f}{NumericalIssue});
00136   \}
00137   );
00138   
00139 \textcolor{preprocessor}{#ifdef EIGEN\_TEST\_PART\_2}
00140   \{
00141     \textcolor{comment}{// regression test for bug 793}
00142     MatrixXd a(3,3);
00143     a << 0,  0,  1,
00144         1,  1, 1,
00145         1, 1e+200,  1;
00146     \hyperlink{group___eigenvalues___module_class_eigen_1_1_eigen_solver}{Eigen::EigenSolver<MatrixXd>} eig(a);
00147     \textcolor{keywordtype}{double} scale = 1e-200; \textcolor{comment}{// scale to avoid overflow during the comparisons}
00148     VERIFY\_IS\_APPROX(a * eig.\hyperlink{group___eigenvalues___module_a4e796226f06e1f7347cf03a38755a155}{pseudoEigenvectors}()*scale, eig.
      \hyperlink{group___eigenvalues___module_a4e796226f06e1f7347cf03a38755a155}{pseudoEigenvectors}() * eig.\hyperlink{group___eigenvalues___module_a4979eafe0aeef06b19ada7fa5e19db17}{pseudoEigenvalueMatrix}()*scale);
00149     VERIFY\_IS\_APPROX(a * eig.\hyperlink{group___eigenvalues___module_a66288022802172e3ee059283b26201d7}{eigenvectors}()*scale, eig.\hyperlink{group___eigenvalues___module_a66288022802172e3ee059283b26201d7}{eigenvectors}() * eig.
      \hyperlink{group___eigenvalues___module_a114189009e42f5e03372a7a3dfa33b97}{eigenvalues}().asDiagonal()*scale);
00150   \}
00151   \{
00152     \textcolor{comment}{// check a case where all eigenvalues are null.}
00153     MatrixXd a(2,2);
00154     a << 1,  1,
00155         -1, -1;
00156     \hyperlink{group___eigenvalues___module_class_eigen_1_1_eigen_solver}{Eigen::EigenSolver<MatrixXd>} eig(a);
00157     VERIFY\_IS\_APPROX(eig.\hyperlink{group___eigenvalues___module_a4e796226f06e1f7347cf03a38755a155}{pseudoEigenvectors}().squaredNorm(), 2.);
00158     VERIFY\_IS\_APPROX((a * eig.\hyperlink{group___eigenvalues___module_a4e796226f06e1f7347cf03a38755a155}{pseudoEigenvectors}()).norm()+1., 1.);
00159     VERIFY\_IS\_APPROX((eig.\hyperlink{group___eigenvalues___module_a4e796226f06e1f7347cf03a38755a155}{pseudoEigenvectors}() * eig.
      \hyperlink{group___eigenvalues___module_a4979eafe0aeef06b19ada7fa5e19db17}{pseudoEigenvalueMatrix}()).norm()+1., 1.);
00160     VERIFY\_IS\_APPROX((a * eig.\hyperlink{group___eigenvalues___module_a66288022802172e3ee059283b26201d7}{eigenvectors}()).norm()+1., 1.);
00161     VERIFY\_IS\_APPROX((eig.\hyperlink{group___eigenvalues___module_a66288022802172e3ee059283b26201d7}{eigenvectors}() * eig.\hyperlink{group___eigenvalues___module_a114189009e42f5e03372a7a3dfa33b97}{eigenvalues}().asDiagonal()).norm()+1.
      , 1.);
00162   \}
00163 \textcolor{preprocessor}{#endif}
00164   
00165   TEST\_SET\_BUT\_UNUSED\_VARIABLE(s)
00166 \}
\end{DoxyCode}
