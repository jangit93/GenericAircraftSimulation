\hypertarget{matio_2visual__studio_2test_2eigen_2bench_2btl_2libs_2gmm_2gmm___l_u__solve__interface_8hh_source}{}\section{matio/visual\+\_\+studio/test/eigen/bench/btl/libs/gmm/gmm\+\_\+\+L\+U\+\_\+solve\+\_\+interface.hh}
\label{matio_2visual__studio_2test_2eigen_2bench_2btl_2libs_2gmm_2gmm___l_u__solve__interface_8hh_source}\index{gmm\+\_\+\+L\+U\+\_\+solve\+\_\+interface.\+hh@{gmm\+\_\+\+L\+U\+\_\+solve\+\_\+interface.\+hh}}

\begin{DoxyCode}
00001 \textcolor{comment}{//=====================================================}
00002 \textcolor{comment}{// File   :  blitz\_LU\_solve\_interface.hh}
00003 \textcolor{comment}{// Author :  L. Plagne <laurent.plagne@edf.fr)>        }
00004 \textcolor{comment}{// Copyright (C) EDF R&D,  lun sep 30 14:23:31 CEST 2002}
00005 \textcolor{comment}{//=====================================================}
00006 \textcolor{comment}{// }
00007 \textcolor{comment}{// This program is free software; you can redistribute it and/or}
00008 \textcolor{comment}{// modify it under the terms of the GNU General Public License}
00009 \textcolor{comment}{// as published by the Free Software Foundation; either version 2}
00010 \textcolor{comment}{// of the License, or (at your option) any later version.}
00011 \textcolor{comment}{// }
00012 \textcolor{comment}{// This program is distributed in the hope that it will be useful,}
00013 \textcolor{comment}{// but WITHOUT ANY WARRANTY; without even the implied warranty of}
00014 \textcolor{comment}{// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00015 \textcolor{comment}{// GNU General Public License for more details.}
00016 \textcolor{comment}{// You should have received a copy of the GNU General Public License}
00017 \textcolor{comment}{// along with this program; if not, write to the Free Software}
00018 \textcolor{comment}{// Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.}
00019 \textcolor{comment}{// }
00020 \textcolor{preprocessor}{#ifndef BLITZ\_LU\_SOLVE\_INTERFACE\_HH}
00021 \textcolor{preprocessor}{#define BLITZ\_LU\_SOLVE\_INTERFACE\_HH}
00022 
00023 \textcolor{preprocessor}{#include "blitz/array.h"}
00024 \textcolor{preprocessor}{#include <vector>}
00025 
00026 BZ\_USING\_NAMESPACE(blitz)
00027 
00028 \textcolor{keyword}{template}<\textcolor{keyword}{class} real>
00029 \textcolor{keyword}{class }\hyperlink{classblitz___l_u__solve__interface}{blitz\_LU\_solve\_interface} : \textcolor{keyword}{public} \hyperlink{classblitz__interface}{blitz\_interface}<real>
00030 \{
00031 
00032 public :
00033 
00034   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} blitz\_interface<real>::gene\_matrix gene\_matrix;
00035   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} blitz\_interface<real>::gene\_vector gene\_vector;
00036 
00037   \textcolor{keyword}{typedef} blitz::Array<int,1> Pivot\_Vector;
00038 
00039   \textcolor{keyword}{inline} \textcolor{keyword}{static} \textcolor{keywordtype}{void} new\_Pivot\_Vector(Pivot\_Vector & pivot,\textcolor{keywordtype}{int} N)
00040   \{
00041 
00042     pivot.resize(N);
00043 
00044   \}
00045 
00046   \textcolor{keyword}{inline} \textcolor{keyword}{static} \textcolor{keywordtype}{void} free\_Pivot\_Vector(Pivot\_Vector & pivot)
00047   \{
00048     
00049     \textcolor{keywordflow}{return};
00050 
00051   \}
00052 
00053 
00054   \textcolor{keyword}{static} \textcolor{keyword}{inline} real matrix\_vector\_product\_sliced(\textcolor{keyword}{const} gene\_matrix & A, gene\_vector B, \textcolor{keywordtype}{int} row, \textcolor{keywordtype}{int} 
      col\_start, \textcolor{keywordtype}{int} col\_end)
00055   \{
00056     
00057     real somme=0.;
00058     
00059     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j=col\_start ; j<col\_end+1 ; j++)\{
00060     
00061     somme+=A(row,j)*B(j);
00062     
00063     \}
00064 
00065     \textcolor{keywordflow}{return} somme;
00066 
00067   \}
00068 
00069 
00070 
00071 
00072   \textcolor{keyword}{static} \textcolor{keyword}{inline} real matrix\_matrix\_product\_sliced(gene\_matrix & A, \textcolor{keywordtype}{int} row, \textcolor{keywordtype}{int} col\_start, \textcolor{keywordtype}{int} col\_end, 
      gene\_matrix & B, \textcolor{keywordtype}{int} row\_shift, \textcolor{keywordtype}{int} col )
00073   \{
00074     
00075     real somme=0.;
00076     
00077     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j=col\_start ; j<col\_end+1 ; j++)\{
00078     
00079     somme+=A(row,j)*B(j+row\_shift,col);
00080     
00081     \}
00082 
00083     \textcolor{keywordflow}{return} somme;
00084 
00085   \}
00086 
00087   \textcolor{keyword}{inline} \textcolor{keyword}{static} \textcolor{keywordtype}{void} LU\_factor(gene\_matrix & LU, Pivot\_Vector & pivot, \textcolor{keywordtype}{int} N)
00088   \{
00089 
00090     ASSERT( LU.rows()==LU.cols() ) ;
00091     \textcolor{keywordtype}{int} index\_max = 0 ;
00092     real big = 0. ;
00093     real theSum = 0. ;
00094     real dum = 0. ;
00095     \textcolor{comment}{// Get the implicit scaling information :}
00096     gene\_vector ImplicitScaling( N ) ;
00097     \textcolor{keywordflow}{for}( \textcolor{keywordtype}{int} i=0; i<N; i++ ) \{
00098       big = 0. ;
00099       \textcolor{keywordflow}{for}( \textcolor{keywordtype}{int} j=0; j<N; j++ ) \{
00100     \textcolor{keywordflow}{if}( abs( LU( i, j ) )>=big ) big = abs( LU( i, j ) ) ;
00101       \}
00102       \textcolor{keywordflow}{if}( big==0. ) \{
00103     INFOS( \textcolor{stringliteral}{"blitz\_LU\_factor::Singular matrix"} ) ;
00104     exit( 0 ) ;
00105       \}
00106       ImplicitScaling( i ) = 1./big ;
00107     \}
00108     \textcolor{comment}{// Loop over columns of Crout's method :}
00109     \textcolor{keywordflow}{for}( \textcolor{keywordtype}{int} j=0; j<N; j++ ) \{
00110       \textcolor{keywordflow}{for}( \textcolor{keywordtype}{int} i=0; i<j; i++ ) \{
00111     theSum = LU( i, j ) ;
00112     theSum -= matrix\_matrix\_product\_sliced(LU, i, 0, i-1, LU, 0, j) ;
00113     \textcolor{comment}{//  theSum -= sum( LU( i, Range( fromStart, i-1 ) )*LU( Range( fromStart, i-1 ), j ) ) ;}
00114     LU( i, j ) = theSum ;
00115       \}
00116       
00117       \textcolor{comment}{// Search for the largest pivot element :}
00118       big = 0. ;
00119       \textcolor{keywordflow}{for}( \textcolor{keywordtype}{int} i=j; i<N; i++ ) \{
00120     theSum = LU( i, j ) ;
00121     theSum -= matrix\_matrix\_product\_sliced(LU, i, 0, j-1, LU, 0, j) ;
00122     \textcolor{comment}{//  theSum -= sum( LU( i, Range( fromStart, j-1 ) )*LU( Range( fromStart, j-1 ), j ) ) ;}
00123     LU( i, j ) = theSum ;
00124     \textcolor{keywordflow}{if}( (ImplicitScaling( i )*abs( theSum ))>=big ) \{
00125       dum = ImplicitScaling( i )*abs( theSum ) ;
00126       big = dum ;
00127       index\_max = i ;
00128     \}
00129       \}
00130       \textcolor{comment}{// Interchanging rows and the scale factor :}
00131       \textcolor{keywordflow}{if}( j!=index\_max ) \{
00132     \textcolor{keywordflow}{for}( \textcolor{keywordtype}{int} k=0; k<N; k++ ) \{
00133       dum = LU( index\_max, k ) ;
00134       LU( index\_max, k ) = LU( j, k ) ;
00135       LU( j, k ) = dum ;
00136     \}
00137     ImplicitScaling( index\_max ) = ImplicitScaling( j ) ;
00138       \}
00139       pivot( j ) = index\_max ;
00140       \textcolor{keywordflow}{if} ( LU( j, j )==0. ) LU( j, j ) = 1.e-20 ;
00141       \textcolor{comment}{// Divide by the pivot element :}
00142       \textcolor{keywordflow}{if}( j<N ) \{
00143     dum = 1./LU( j, j ) ;
00144     \textcolor{keywordflow}{for}( \textcolor{keywordtype}{int} i=j+1; i<N; i++ ) LU( i, j ) *= dum ;
00145       \}
00146     \}
00147 
00148   \}
00149 
00150   \textcolor{keyword}{inline} \textcolor{keyword}{static} \textcolor{keywordtype}{void} LU\_solve(\textcolor{keyword}{const} gene\_matrix & LU, \textcolor{keyword}{const} Pivot\_Vector pivot, gene\_vector &B, gene\_vector
       X, \textcolor{keywordtype}{int} N)
00151   \{
00152 
00153     \textcolor{comment}{// Pour conserver le meme header, on travaille sur X, copie du second-membre B}
00154     X = B.copy() ;
00155     ASSERT( LU.rows()==LU.cols() ) ;
00156     firstIndex indI ;
00157     \textcolor{comment}{// Forward substitution :}
00158     \textcolor{keywordtype}{int} ii = 0 ;
00159     real theSum = 0. ;
00160     \textcolor{keywordflow}{for}( \textcolor{keywordtype}{int} i=0; i<N; i++ ) \{
00161       \textcolor{keywordtype}{int} ip = pivot( i ) ;
00162       theSum = X( ip ) ;
00163       \textcolor{comment}{//      theSum = B( ip ) ;}
00164       X( ip ) = X( i ) ;
00165       \textcolor{comment}{//      B( ip ) = B( i ) ;}
00166       \textcolor{keywordflow}{if}( ii ) \{
00167     theSum -= matrix\_vector\_product\_sliced(LU, X, i, ii-1, i-1) ;
00168     \textcolor{comment}{//  theSum -= sum( LU( i, Range( ii-1, i-1 ) )*X( Range( ii-1, i-1 ) ) ) ;}
00169     \textcolor{comment}{//  theSum -= sum( LU( i, Range( ii-1, i-1 ) )*B( Range( ii-1, i-1 ) ) ) ;}
00170       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( theSum ) \{
00171     ii = i+1 ;
00172       \}
00173       X( i ) = theSum ;
00174       \textcolor{comment}{//      B( i ) = theSum ;}
00175     \}
00176     \textcolor{comment}{// Backsubstitution :}
00177     \textcolor{keywordflow}{for}( \textcolor{keywordtype}{int} i=N-1; i>=0; i-- ) \{
00178       theSum = X( i ) ;
00179       \textcolor{comment}{//      theSum = B( i ) ;}
00180       theSum -= matrix\_vector\_product\_sliced(LU, X, i, i+1, N) ;
00181       \textcolor{comment}{//      theSum -= sum( LU( i, Range( i+1, toEnd ) )*X( Range( i+1, toEnd ) ) ) ;}
00182       \textcolor{comment}{//      theSum -= sum( LU( i, Range( i+1, toEnd ) )*B( Range( i+1, toEnd ) ) ) ;}
00183       \textcolor{comment}{// Store a component of the solution vector :}
00184       X( i ) = theSum/LU( i, i ) ;
00185       \textcolor{comment}{//      B( i ) = theSum/LU( i, i ) ;}
00186     \}
00187 
00188   \}
00189 
00190 \};
00191 
00192 \textcolor{preprocessor}{#endif}
\end{DoxyCode}
