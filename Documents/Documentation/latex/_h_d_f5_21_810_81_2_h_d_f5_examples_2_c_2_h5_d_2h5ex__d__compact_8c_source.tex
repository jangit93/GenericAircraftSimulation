\hypertarget{_h_d_f5_21_810_81_2_h_d_f5_examples_2_c_2_h5_d_2h5ex__d__compact_8c_source}{}\section{H\+D\+F5/1.10.1/\+H\+D\+F5\+Examples/\+C/\+H5\+D/h5ex\+\_\+d\+\_\+compact.c}
\label{_h_d_f5_21_810_81_2_h_d_f5_examples_2_c_2_h5_d_2h5ex__d__compact_8c_source}\index{h5ex\+\_\+d\+\_\+compact.\+c@{h5ex\+\_\+d\+\_\+compact.\+c}}

\begin{DoxyCode}
00001 \textcolor{comment}{/************************************************************}
00002 \textcolor{comment}{}
00003 \textcolor{comment}{  This example shows how to read and write data to a compact}
00004 \textcolor{comment}{  dataset.  The program first writes integers to a compact}
00005 \textcolor{comment}{  dataset with dataspace dimensions of DIM0xDIM1, then}
00006 \textcolor{comment}{  closes the file.  Next, it reopens the file, reads back}
00007 \textcolor{comment}{  the data, and outputs it to the screen.}
00008 \textcolor{comment}{}
00009 \textcolor{comment}{  This file is intended for use with HDF5 Library version 1.8}
00010 \textcolor{comment}{}
00011 \textcolor{comment}{ ************************************************************/}
00012 
00013 \textcolor{preprocessor}{#include "hdf5.h"}
00014 \textcolor{preprocessor}{#include <stdio.h>}
00015 \textcolor{preprocessor}{#include <stdlib.h>}
00016 
00017 \textcolor{preprocessor}{#define FILE            "h5ex\_d\_compact.h5"}
00018 \textcolor{preprocessor}{#define DATASET         "DS1"}
00019 \textcolor{preprocessor}{#define DIM0            4}
00020 \textcolor{preprocessor}{#define DIM1            7}
00021 
00022 \textcolor{keywordtype}{int}
00023 main (\textcolor{keywordtype}{void})
00024 \{
00025     hid\_t       \hyperlink{structfile}{file}, space, dset, dcpl;    \textcolor{comment}{/* Handles */}
00026     herr\_t      status;
00027     H5D\_layout\_t    layout;
00028     hsize\_t     dims[2] = \{DIM0, DIM1\};
00029     \textcolor{keywordtype}{int}         wdata[DIM0][DIM1],          \textcolor{comment}{/* Write buffer */}
00030                 rdata[DIM0][DIM1],          \textcolor{comment}{/* Read buffer */}
00031                 i, j;
00032 
00033     \textcolor{comment}{/*}
00034 \textcolor{comment}{     * Initialize data.}
00035 \textcolor{comment}{     */}
00036     \textcolor{keywordflow}{for} (i=0; i<DIM0; i++)
00037         \textcolor{keywordflow}{for} (j=0; j<DIM1; j++)
00038             wdata[i][j] = i * j - j;
00039 
00040     \textcolor{comment}{/*}
00041 \textcolor{comment}{     * Create a new file using the default properties.}
00042 \textcolor{comment}{     */}
00043     file = H5Fcreate (FILE, H5F\_ACC\_TRUNC, H5P\_DEFAULT, H5P\_DEFAULT);
00044 
00045     \textcolor{comment}{/*}
00046 \textcolor{comment}{     * Create dataspace.  Setting maximum size to NULL sets the maximum}
00047 \textcolor{comment}{     * size to be the current size.}
00048 \textcolor{comment}{     */}
00049     space = H5Screate\_simple (2, dims, NULL);
00050 
00051     \textcolor{comment}{/*}
00052 \textcolor{comment}{     * Create the dataset creation property list, set the layout to}
00053 \textcolor{comment}{     * compact.}
00054 \textcolor{comment}{     */}
00055     dcpl = H5Pcreate (H5P\_DATASET\_CREATE);
00056     status = H5Pset\_layout (dcpl, H5D\_COMPACT);
00057 
00058     \textcolor{comment}{/*}
00059 \textcolor{comment}{     * Create the dataset.  We will use all default properties for this}
00060 \textcolor{comment}{     * example.}
00061 \textcolor{comment}{     */}
00062     dset = H5Dcreate (file, DATASET, H5T\_STD\_I32LE, space, H5P\_DEFAULT, dcpl,
00063                 H5P\_DEFAULT);
00064 
00065     \textcolor{comment}{/*}
00066 \textcolor{comment}{     * Write the data to the dataset.}
00067 \textcolor{comment}{     */}
00068     status = H5Dwrite (dset, H5T\_NATIVE\_INT, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT,
00069                 wdata[0]);
00070 
00071     \textcolor{comment}{/*}
00072 \textcolor{comment}{     * Close and release resources.}
00073 \textcolor{comment}{     */}
00074     status = H5Pclose (dcpl);
00075     status = H5Dclose (dset);
00076     status = H5Sclose (space);
00077     status = H5Fclose (file);
00078 
00079 
00080     \textcolor{comment}{/*}
00081 \textcolor{comment}{     * Now we begin the read section of this example.}
00082 \textcolor{comment}{     */}
00083 
00084     \textcolor{comment}{/*}
00085 \textcolor{comment}{     * Open file and dataset using the default properties.}
00086 \textcolor{comment}{     */}
00087     file = H5Fopen (FILE, H5F\_ACC\_RDONLY, H5P\_DEFAULT);
00088     dset = H5Dopen (file, DATASET, H5P\_DEFAULT);
00089 
00090     \textcolor{comment}{/*}
00091 \textcolor{comment}{     * Retrieve the dataset creation property list, and print the}
00092 \textcolor{comment}{     * storage layout.}
00093 \textcolor{comment}{     */}
00094     dcpl = H5Dget\_create\_plist (dset);
00095     layout = H5Pget\_layout (dcpl);
00096     printf (\textcolor{stringliteral}{"Storage layout for %s is: "}, DATASET);
00097     \textcolor{keywordflow}{switch} (layout) \{
00098         \textcolor{keywordflow}{case} H5D\_COMPACT:
00099             printf (\textcolor{stringliteral}{"H5D\_COMPACT\(\backslash\)n"});
00100             \textcolor{keywordflow}{break};
00101         \textcolor{keywordflow}{case} H5D\_CONTIGUOUS:
00102             printf (\textcolor{stringliteral}{"H5D\_CONTIGUOUS\(\backslash\)n"});
00103             \textcolor{keywordflow}{break};
00104         \textcolor{keywordflow}{case} H5D\_CHUNKED:
00105             printf (\textcolor{stringliteral}{"H5D\_CHUNKED\(\backslash\)n"});
00106             \textcolor{keywordflow}{break};
00107         \textcolor{keywordflow}{case} H5D\_VIRTUAL:
00108             printf (\textcolor{stringliteral}{"H5D\_VIRTUAL\(\backslash\)n"});
00109             \textcolor{keywordflow}{break};
00110         \textcolor{keywordflow}{case} H5D\_LAYOUT\_ERROR:
00111         \textcolor{keywordflow}{case} H5D\_NLAYOUTS:
00112             printf (\textcolor{stringliteral}{"H5D\_LAYOUT\_ERROR\(\backslash\)n"});
00113     \}
00114 
00115     \textcolor{comment}{/*}
00116 \textcolor{comment}{     * Read the data using the default properties.}
00117 \textcolor{comment}{     */}
00118     status = H5Dread (dset, H5T\_NATIVE\_INT, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT,
00119                 rdata[0]);
00120 
00121     \textcolor{comment}{/*}
00122 \textcolor{comment}{     * Output the data to the screen.}
00123 \textcolor{comment}{     */}
00124     printf (\textcolor{stringliteral}{"%s:\(\backslash\)n"}, DATASET);
00125     \textcolor{keywordflow}{for} (i=0; i<DIM0; i++) \{
00126         printf (\textcolor{stringliteral}{" ["});
00127         \textcolor{keywordflow}{for} (j=0; j<DIM1; j++)
00128             printf (\textcolor{stringliteral}{" %3d"}, rdata[i][j]);
00129         printf (\textcolor{stringliteral}{"]\(\backslash\)n"});
00130     \}
00131 
00132     \textcolor{comment}{/*}
00133 \textcolor{comment}{     * Close and release resources.}
00134 \textcolor{comment}{     */}
00135     status = H5Pclose (dcpl);
00136     status = H5Dclose (dset);
00137     status = H5Fclose (file);
00138 
00139     \textcolor{keywordflow}{return} 0;
00140 \}
\end{DoxyCode}
