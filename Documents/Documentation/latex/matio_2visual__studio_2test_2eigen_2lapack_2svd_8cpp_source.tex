\hypertarget{matio_2visual__studio_2test_2eigen_2lapack_2svd_8cpp_source}{}\section{matio/visual\+\_\+studio/test/eigen/lapack/svd.cpp}
\label{matio_2visual__studio_2test_2eigen_2lapack_2svd_8cpp_source}\index{svd.\+cpp@{svd.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2014 Gael Guennebaud <gael.guennebaud@inria.fr>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#include "lapack\_common.h"}
00011 \textcolor{preprocessor}{#include <Eigen/SVD>}
00012 
00013 \textcolor{comment}{// computes the singular values/vectors a general M-by-N matrix A using divide-and-conquer}
00014 EIGEN\_LAPACK\_FUNC(gesdd,(\textcolor{keywordtype}{char} *jobz, \textcolor{keywordtype}{int} *m, \textcolor{keywordtype}{int}* n, Scalar* a, \textcolor{keywordtype}{int} *lda, RealScalar *s, Scalar *u, \textcolor{keywordtype}{int} *
      ldu, Scalar *vt, \textcolor{keywordtype}{int} *ldvt, Scalar* \textcolor{comment}{/*work*/}, \textcolor{keywordtype}{int}* lwork,
00015                          EIGEN\_LAPACK\_ARG\_IF\_COMPLEX(RealScalar *\textcolor{comment}{/*rwork*/}) \textcolor{keywordtype}{int} * \textcolor{comment}{/*iwork*/}, \textcolor{keywordtype}{int} *info))
00016 \{
00017   \textcolor{comment}{// TODO exploit the work buffer}
00018   \textcolor{keywordtype}{bool} query\_size = *lwork==-1;
00019   \textcolor{keywordtype}{int} diag\_size = (std::min)(*m,*n);
00020   
00021   *info = 0;
00022         \textcolor{keywordflow}{if}(*jobz!=\textcolor{charliteral}{'A'} && *jobz!=\textcolor{charliteral}{'S'} && *jobz!=\textcolor{charliteral}{'O'} && *jobz!=\textcolor{charliteral}{'N'})  *info = -1;
00023   \textcolor{keywordflow}{else}  \textcolor{keywordflow}{if}(*m<0)                                                  *info = -2;
00024   \textcolor{keywordflow}{else}  \textcolor{keywordflow}{if}(*n<0)                                                  *info = -3;
00025   \textcolor{keywordflow}{else}  \textcolor{keywordflow}{if}(*lda<std::max(1,*m))                                   *info = -5;
00026   \textcolor{keywordflow}{else}  \textcolor{keywordflow}{if}(*lda<std::max(1,*m))                                   *info = -8;
00027   \textcolor{keywordflow}{else}  \textcolor{keywordflow}{if}(*ldu <1 || (*jobz==\textcolor{charliteral}{'A'} && *ldu <*m)
00028                    || (*jobz==\textcolor{charliteral}{'O'} && *m<*n && *ldu<*m))           *info = -8;
00029   \textcolor{keywordflow}{else}  \textcolor{keywordflow}{if}(*ldvt<1 || (*jobz==\textcolor{charliteral}{'A'} && *ldvt<*n)
00030                    || (*jobz==\textcolor{charliteral}{'S'} && *ldvt<diag\_size)
00031                    || (*jobz==\textcolor{charliteral}{'O'} && *m>=*n && *ldvt<*n))         *info = -10;
00032   
00033   \textcolor{keywordflow}{if}(*info!=0)
00034   \{
00035     \textcolor{keywordtype}{int} e = -*info;
00036     \textcolor{keywordflow}{return} xerbla\_(SCALAR\_SUFFIX\_UP\textcolor{stringliteral}{"GESDD "}, &e, 6);
00037   \}
00038   
00039   \textcolor{keywordflow}{if}(query\_size)
00040   \{
00041     *lwork = 0;
00042     \textcolor{keywordflow}{return} 0;
00043   \}
00044   
00045   \textcolor{keywordflow}{if}(*n==0 || *m==0)
00046     \textcolor{keywordflow}{return} 0;
00047   
00048   \hyperlink{group___core___module_class_eigen_1_1_matrix}{PlainMatrixType} mat(*m,*n);
00049   mat = matrix(a,*m,*n,*lda);
00050   
00051   \textcolor{keywordtype}{int} \hyperlink{structoption}{option} = *jobz==\textcolor{charliteral}{'A'} ? \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a2b4f91ca5859a4159dbfe8090043817f}{ComputeFullU}|\hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a52c6f7e80bbf9a42297c88f700245b51}{ComputeFullV}
00052              : *jobz==\textcolor{charliteral}{'S'} ? \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9af8c742a1aa87773e165eae406c9ccaf8}{ComputeThinU}|\hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a1055e53fa95c8ae04a07ebb72cfafd95}{ComputeThinV}
00053              : *jobz==\textcolor{charliteral}{'O'} ? \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9af8c742a1aa87773e165eae406c9ccaf8}{ComputeThinU}|\hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a1055e53fa95c8ae04a07ebb72cfafd95}{ComputeThinV}
00054              : 0;
00055 
00056   \hyperlink{group___s_v_d___module_class_eigen_1_1_b_d_c_s_v_d}{BDCSVD<PlainMatrixType>} svd(mat,option);
00057   
00058   make\_vector(s,diag\_size) = svd.singularValues().head(diag\_size);
00059 
00060   \textcolor{keywordflow}{if}(*jobz==\textcolor{charliteral}{'A'})
00061   \{
00062     matrix(u,*m,*m,*ldu)   = svd.matrixU();
00063     matrix(vt,*n,*n,*ldvt) = svd.matrixV().adjoint();
00064   \}
00065   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(*jobz==\textcolor{charliteral}{'S'})
00066   \{
00067     matrix(u,*m,diag\_size,*ldu)   = svd.matrixU();
00068     matrix(vt,diag\_size,*n,*ldvt) = svd.matrixV().adjoint();
00069   \}
00070   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(*jobz==\textcolor{charliteral}{'O'} && *m>=*n)
00071   \{
00072     matrix(a,*m,*n,*lda)   = svd.matrixU();
00073     matrix(vt,*n,*n,*ldvt) = svd.matrixV().adjoint();
00074   \}
00075   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(*jobz==\textcolor{charliteral}{'O'})
00076   \{
00077     matrix(u,*m,*m,*ldu)        = svd.matrixU();
00078     matrix(a,diag\_size,*n,*lda) = svd.matrixV().adjoint();
00079   \}
00080     
00081   \textcolor{keywordflow}{return} 0;
00082 \}
00083 
00084 \textcolor{comment}{// computes the singular values/vectors a general M-by-N matrix A using two sided jacobi algorithm}
00085 EIGEN\_LAPACK\_FUNC(gesvd,(\textcolor{keywordtype}{char} *jobu, \textcolor{keywordtype}{char} *jobv, \textcolor{keywordtype}{int} *m, \textcolor{keywordtype}{int}* n, Scalar* a, \textcolor{keywordtype}{int} *lda, RealScalar *s, Scalar
       *u, \textcolor{keywordtype}{int} *ldu, Scalar *vt, \textcolor{keywordtype}{int} *ldvt, Scalar* \textcolor{comment}{/*work*/}, \textcolor{keywordtype}{int}* lwork,
00086                          EIGEN\_LAPACK\_ARG\_IF\_COMPLEX(RealScalar *\textcolor{comment}{/*rwork*/}) \textcolor{keywordtype}{int} *info))
00087 \{
00088   \textcolor{comment}{// TODO exploit the work buffer}
00089   \textcolor{keywordtype}{bool} query\_size = *lwork==-1;
00090   \textcolor{keywordtype}{int} diag\_size = (std::min)(*m,*n);
00091   
00092   *info = 0;
00093         \textcolor{keywordflow}{if}( *jobu!=\textcolor{charliteral}{'A'} && *jobu!=\textcolor{charliteral}{'S'} && *jobu!=\textcolor{charliteral}{'O'} && *jobu!=\textcolor{charliteral}{'N'}) *info = -1;
00094   \textcolor{keywordflow}{else}  \textcolor{keywordflow}{if}((*jobv!=\textcolor{charliteral}{'A'} && *jobv!=\textcolor{charliteral}{'S'} && *jobv!=\textcolor{charliteral}{'O'} && *jobv!=\textcolor{charliteral}{'N'})
00095            || (*jobu==\textcolor{charliteral}{'O'} && *jobv==\textcolor{charliteral}{'O'}))                         *info = -2;
00096   \textcolor{keywordflow}{else}  \textcolor{keywordflow}{if}(*m<0)                                                  *info = -3;
00097   \textcolor{keywordflow}{else}  \textcolor{keywordflow}{if}(*n<0)                                                  *info = -4;
00098   \textcolor{keywordflow}{else}  \textcolor{keywordflow}{if}(*lda<std::max(1,*m))                                   *info = -6;
00099   \textcolor{keywordflow}{else}  \textcolor{keywordflow}{if}(*ldu <1 || ((*jobu==\textcolor{charliteral}{'A'} || *jobu==\textcolor{charliteral}{'S'}) && *ldu<*m))    *info = -9;
00100   \textcolor{keywordflow}{else}  \textcolor{keywordflow}{if}(*ldvt<1 || (*jobv==\textcolor{charliteral}{'A'} && *ldvt<*n)
00101                    || (*jobv==\textcolor{charliteral}{'S'} && *ldvt<diag\_size))            *info = -11;
00102   
00103   \textcolor{keywordflow}{if}(*info!=0)
00104   \{
00105     \textcolor{keywordtype}{int} e = -*info;
00106     \textcolor{keywordflow}{return} xerbla\_(SCALAR\_SUFFIX\_UP\textcolor{stringliteral}{"GESVD "}, &e, 6);
00107   \}
00108   
00109   \textcolor{keywordflow}{if}(query\_size)
00110   \{
00111     *lwork = 0;
00112     \textcolor{keywordflow}{return} 0;
00113   \}
00114   
00115   \textcolor{keywordflow}{if}(*n==0 || *m==0)
00116     \textcolor{keywordflow}{return} 0;
00117   
00118   \hyperlink{group___core___module_class_eigen_1_1_matrix}{PlainMatrixType} mat(*m,*n);
00119   mat = matrix(a,*m,*n,*lda);
00120   
00121   \textcolor{keywordtype}{int} option = (*jobu==\textcolor{charliteral}{'A'} ? \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a2b4f91ca5859a4159dbfe8090043817f}{ComputeFullU} : *jobu==\textcolor{charliteral}{'S'} || *jobu==\textcolor{charliteral}{'O'} ? 
      \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9af8c742a1aa87773e165eae406c9ccaf8}{ComputeThinU} : 0)
00122              | (*jobv==\textcolor{charliteral}{'A'} ? \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a52c6f7e80bbf9a42297c88f700245b51}{ComputeFullV} : *jobv==\textcolor{charliteral}{'S'} || *jobv==\textcolor{charliteral}{'O'} ? 
      \hyperlink{group__enums_ggae3e239fb70022eb8747994cf5d68b4a9a1055e53fa95c8ae04a07ebb72cfafd95}{ComputeThinV} : 0);
00123   
00124   \hyperlink{group___s_v_d___module_class_eigen_1_1_jacobi_s_v_d}{JacobiSVD<PlainMatrixType>} svd(mat,option);
00125   
00126   make\_vector(s,diag\_size) = svd.singularValues().head(diag\_size);
00127   \{
00128         \textcolor{keywordflow}{if}(*jobu==\textcolor{charliteral}{'A'}) matrix(u,*m,*m,*ldu)           = svd.matrixU();
00129   \textcolor{keywordflow}{else}  \textcolor{keywordflow}{if}(*jobu==\textcolor{charliteral}{'S'}) matrix(u,*m,diag\_size,*ldu)    = svd.matrixU();
00130   \textcolor{keywordflow}{else}  \textcolor{keywordflow}{if}(*jobu==\textcolor{charliteral}{'O'}) matrix(a,*m,diag\_size,*lda)    = svd.matrixU();
00131   \}
00132   \{
00133         \textcolor{keywordflow}{if}(*jobv==\textcolor{charliteral}{'A'}) matrix(vt,*n,*n,*ldvt)         = svd.matrixV().adjoint();
00134   \textcolor{keywordflow}{else}  \textcolor{keywordflow}{if}(*jobv==\textcolor{charliteral}{'S'}) matrix(vt,diag\_size,*n,*ldvt)  = svd.matrixV().adjoint();
00135   \textcolor{keywordflow}{else}  \textcolor{keywordflow}{if}(*jobv==\textcolor{charliteral}{'O'}) matrix(a,diag\_size,*n,*lda)    = svd.matrixV().adjoint();
00136   \}
00137   \textcolor{keywordflow}{return} 0;
00138 \}
\end{DoxyCode}
