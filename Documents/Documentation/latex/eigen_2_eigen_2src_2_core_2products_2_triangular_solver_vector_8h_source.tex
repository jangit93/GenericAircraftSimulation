\hypertarget{eigen_2_eigen_2src_2_core_2products_2_triangular_solver_vector_8h_source}{}\section{eigen/\+Eigen/src/\+Core/products/\+Triangular\+Solver\+Vector.h}
\label{eigen_2_eigen_2src_2_core_2products_2_triangular_solver_vector_8h_source}\index{Triangular\+Solver\+Vector.\+h@{Triangular\+Solver\+Vector.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2008-2010 Gael Guennebaud <gael.guennebaud@inria.fr>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#ifndef EIGEN\_TRIANGULAR\_SOLVER\_VECTOR\_H}
00011 \textcolor{preprocessor}{#define EIGEN\_TRIANGULAR\_SOLVER\_VECTOR\_H}
00012 
00013 \textcolor{keyword}{namespace }\hyperlink{namespace_eigen}{Eigen} \{
00014 
00015 \textcolor{keyword}{namespace }\hyperlink{namespaceinternal}{internal} \{
00016 
00017 \textcolor{keyword}{template}<\textcolor{keyword}{typename} LhsScalar, \textcolor{keyword}{typename} RhsScalar, \textcolor{keyword}{typename} Index, \textcolor{keywordtype}{int} Mode, \textcolor{keywordtype}{bool} Conjugate, \textcolor{keywordtype}{int} StorageOrder
      >
\Hypertarget{eigen_2_eigen_2src_2_core_2products_2_triangular_solver_vector_8h_source_l00018}\hyperlink{struct_eigen_1_1internal_1_1triangular__solve__vector_3_01_lhs_scalar_00_01_rhs_scalar_00_01_ind2257c92bae887c34b8b6b704148c0908}{00018} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1triangular__solve__vector}{triangular\_solve\_vector}<LhsScalar, RhsScalar, 
      \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}, \hyperlink{group__enums_ggac22de43beeac7a78b384f99bed5cee0ba99dc75d8e00b6c3a5bdc31940f47492b}{OnTheRight}, Mode, \hyperlink{class_eigen_1_1_conjugate}{Conjugate}, StorageOrder>
00019 \{
00020   \textcolor{keyword}{static} \textcolor{keywordtype}{void} run(\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} size, \textcolor{keyword}{const} LhsScalar* \_lhs, \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} lhsStride, RhsScalar* rhs)
00021   \{
00022     \hyperlink{struct_eigen_1_1internal_1_1triangular__solve__vector}{triangular\_solve\_vector}<LhsScalar,RhsScalar,\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index},
      \hyperlink{group__enums_ggac22de43beeac7a78b384f99bed5cee0ba129609b3bdf23b071f5f86cf2f995ec4}{OnTheLeft},
00023         ((Mode&\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda6bcb58be3b8b8ec84859ce0c5ac0aaec}{Upper})==\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda6bcb58be3b8b8ec84859ce0c5ac0aaec}{Upper} ? \hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda891792b8ed394f7607ab16dd716f60e6}{Lower} : \hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda6bcb58be3b8b8ec84859ce0c5ac0aaec}{Upper}) | (Mode&
      \hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cdaddb72f888ac85d5a1c52333e54f9374b}{UnitDiag}),
00024         \hyperlink{class_eigen_1_1_conjugate}{Conjugate},StorageOrder==\hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13acfcde9cd8677c5f7caf6bd603666aae3}{RowMajor}?\hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor}:
      \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13acfcde9cd8677c5f7caf6bd603666aae3}{RowMajor}
00025       >::run(size, \_lhs, lhsStride, rhs);
00026   \}
00027 \};
00028 
00029 \textcolor{comment}{// forward and backward substitution, row-major, rhs is a vector}
00030 \textcolor{keyword}{template}<\textcolor{keyword}{typename} LhsScalar, \textcolor{keyword}{typename} RhsScalar, \textcolor{keyword}{typename} Index, \textcolor{keywordtype}{int} Mode, \textcolor{keywordtype}{bool} Conjugate>
\Hypertarget{eigen_2_eigen_2src_2_core_2products_2_triangular_solver_vector_8h_source_l00031}\hyperlink{struct_eigen_1_1internal_1_1triangular__solve__vector_3_01_lhs_scalar_00_01_rhs_scalar_00_01_ind05791747bf7342daa3286389f182e45b}{00031} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1triangular__solve__vector}{triangular\_solve\_vector}<LhsScalar, RhsScalar, 
      \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}, \hyperlink{group__enums_ggac22de43beeac7a78b384f99bed5cee0ba129609b3bdf23b071f5f86cf2f995ec4}{OnTheLeft}, Mode, \hyperlink{class_eigen_1_1_conjugate}{Conjugate}, \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13acfcde9cd8677c5f7caf6bd603666aae3}{RowMajor}>
00032 \{
00033   \textcolor{keyword}{enum} \{
00034     IsLower = ((Mode&\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda891792b8ed394f7607ab16dd716f60e6}{Lower})==\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda891792b8ed394f7607ab16dd716f60e6}{Lower})
00035   \};
00036   \textcolor{keyword}{static} \textcolor{keywordtype}{void} run(\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} size, \textcolor{keyword}{const} LhsScalar* \_lhs, \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} lhsStride, RhsScalar* rhs)
00037   \{
00038     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_map}{Map<const Matrix<LhsScalar,Dynamic,Dynamic,RowMajor>}
      , 0, \hyperlink{class_eigen_1_1_outer_stride}{OuterStride<>} > LhsMap;
00039     \textcolor{keyword}{const} LhsMap lhs(\_lhs,size,size,\hyperlink{class_eigen_1_1_outer_stride}{OuterStride<>}(lhsStride));
00040 
00041     \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1internal_1_1const__blas__data__mapper}{const\_blas\_data\_mapper<LhsScalar,Index,RowMajor>}
       LhsMapper;
00042     \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1internal_1_1const__blas__data__mapper}{const\_blas\_data\_mapper<RhsScalar,Index,ColMajor>}
       RhsMapper;
00043 
00044     \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1conditional}{internal::conditional}<
00045                           \hyperlink{class_eigen_1_1_conjugate}{Conjugate},
00046                           \textcolor{keyword}{const} 
      \hyperlink{group___core___module_class_eigen_1_1_cwise_unary_op}{CwiseUnaryOp<typename internal::scalar\_conjugate\_op<LhsScalar>}
      ,LhsMap>,
00047                           \textcolor{keyword}{const} LhsMap&>
00048                         ::type cjLhs(lhs);
00049     \textcolor{keyword}{static} \textcolor{keyword}{const} \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} PanelWidth = EIGEN\_TUNE\_TRIANGULAR\_PANEL\_WIDTH;
00050     \textcolor{keywordflow}{for}(\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} pi=IsLower ? 0 : size;
00051         IsLower ? pi<size : pi>0;
00052         IsLower ? pi+=PanelWidth : pi-=PanelWidth)
00053     \{
00054       \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} actualPanelWidth = (std::min)(IsLower ? size - pi : pi, PanelWidth);
00055 
00056       \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} r = IsLower ? pi : size - pi; \textcolor{comment}{// remaining size}
00057       \textcolor{keywordflow}{if} (r > 0)
00058       \{
00059         \textcolor{comment}{// let's directly call the low level product function because:}
00060         \textcolor{comment}{// 1 - it is faster to compile}
00061         \textcolor{comment}{// 2 - it is slighlty faster at runtime}
00062         \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} startRow = IsLower ? pi : pi-actualPanelWidth;
00063         \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} startCol = IsLower ? 0 : pi;
00064 
00065         
      \hyperlink{struct_eigen_1_1internal_1_1general__matrix__vector__product}{general\_matrix\_vector\_product<Index,LhsScalar,LhsMapper,RowMajor,Conjugate,RhsScalar,RhsMapper,false>::run}
      (
00066           actualPanelWidth, r,
00067           LhsMapper(&lhs.coeffRef(startRow,startCol), lhsStride),
00068           RhsMapper(rhs + startCol, 1),
00069           rhs + startRow, 1,
00070           RhsScalar(-1));
00071       \}
00072 
00073       \textcolor{keywordflow}{for}(\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} k=0; k<actualPanelWidth; ++k)
00074       \{
00075         \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} i = IsLower ? pi+k : pi-k-1;
00076         \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} s = IsLower ? pi   : i+1;
00077         \textcolor{keywordflow}{if} (k>0)
00078           rhs[i] -= (cjLhs.row(i).segment(s,k).transpose().cwiseProduct(\hyperlink{group___core___module_class_eigen_1_1_map}{Map}<\textcolor{keyword}{const} 
      \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<RhsScalar,Dynamic,1>} >(rhs+s,k))).sum();
00079 
00080         \textcolor{keywordflow}{if}(!(Mode & \hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cdaddb72f888ac85d5a1c52333e54f9374b}{UnitDiag}))
00081           rhs[i] /= cjLhs(i,i);
00082       \}
00083     \}
00084   \}
00085 \};
00086 
00087 \textcolor{comment}{// forward and backward substitution, column-major, rhs is a vector}
00088 \textcolor{keyword}{template}<\textcolor{keyword}{typename} LhsScalar, \textcolor{keyword}{typename} RhsScalar, \textcolor{keyword}{typename} Index, \textcolor{keywordtype}{int} Mode, \textcolor{keywordtype}{bool} Conjugate>
\Hypertarget{eigen_2_eigen_2src_2_core_2products_2_triangular_solver_vector_8h_source_l00089}\hyperlink{struct_eigen_1_1internal_1_1triangular__solve__vector_3_01_lhs_scalar_00_01_rhs_scalar_00_01_ind063e019bb54cf6ae298090bc534a9cdf}{00089} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1triangular__solve__vector}{triangular\_solve\_vector}<LhsScalar, RhsScalar, 
      \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}, \hyperlink{group__enums_ggac22de43beeac7a78b384f99bed5cee0ba129609b3bdf23b071f5f86cf2f995ec4}{OnTheLeft}, Mode, \hyperlink{class_eigen_1_1_conjugate}{Conjugate}, \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor}>
00090 \{
00091   \textcolor{keyword}{enum} \{
00092     IsLower = ((Mode&\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda891792b8ed394f7607ab16dd716f60e6}{Lower})==\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda891792b8ed394f7607ab16dd716f60e6}{Lower})
00093   \};
00094   \textcolor{keyword}{static} \textcolor{keywordtype}{void} run(\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} size, \textcolor{keyword}{const} LhsScalar* \_lhs, \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} lhsStride, RhsScalar* rhs)
00095   \{
00096     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_map}{Map<const Matrix<LhsScalar,Dynamic,Dynamic,ColMajor>}
      , 0, \hyperlink{class_eigen_1_1_outer_stride}{OuterStride<>} > LhsMap;
00097     \textcolor{keyword}{const} LhsMap lhs(\_lhs,size,size,\hyperlink{class_eigen_1_1_outer_stride}{OuterStride<>}(lhsStride));
00098     \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1internal_1_1const__blas__data__mapper}{const\_blas\_data\_mapper<LhsScalar,Index,ColMajor>}
       LhsMapper;
00099     \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1internal_1_1const__blas__data__mapper}{const\_blas\_data\_mapper<RhsScalar,Index,ColMajor>}
       RhsMapper;
00100     \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1conditional}{internal::conditional}<\hyperlink{class_eigen_1_1_conjugate}{Conjugate},
00101                                    \textcolor{keyword}{const} 
      \hyperlink{group___core___module_class_eigen_1_1_cwise_unary_op}{CwiseUnaryOp<typename internal::scalar\_conjugate\_op<LhsScalar>}
      ,LhsMap>,
00102                                    \textcolor{keyword}{const} LhsMap&
00103                                   >::type cjLhs(lhs);
00104     \textcolor{keyword}{static} \textcolor{keyword}{const} \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} PanelWidth = EIGEN\_TUNE\_TRIANGULAR\_PANEL\_WIDTH;
00105 
00106     \textcolor{keywordflow}{for}(\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} pi=IsLower ? 0 : size;
00107         IsLower ? pi<size : pi>0;
00108         IsLower ? pi+=PanelWidth : pi-=PanelWidth)
00109     \{
00110       \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} actualPanelWidth = (std::min)(IsLower ? size - pi : pi, PanelWidth);
00111       \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} startBlock = IsLower ? pi : pi-actualPanelWidth;
00112       \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} endBlock = IsLower ? pi + actualPanelWidth : 0;
00113 
00114       \textcolor{keywordflow}{for}(\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} k=0; k<actualPanelWidth; ++k)
00115       \{
00116         \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} i = IsLower ? pi+k : pi-k-1;
00117         \textcolor{keywordflow}{if}(!(Mode & \hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cdaddb72f888ac85d5a1c52333e54f9374b}{UnitDiag}))
00118           rhs[i] /= cjLhs.coeff(i,i);
00119 
00120         \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} r = actualPanelWidth - k - 1; \textcolor{comment}{// remaining size}
00121         \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} s = IsLower ? i+1 : i-r;
00122         \textcolor{keywordflow}{if} (r>0)
00123           \hyperlink{group___core___module_class_eigen_1_1_map}{Map<Matrix<RhsScalar,Dynamic,1>} >(rhs+s,r) -= rhs[i] * cjLhs.col(i
      ).segment(s,r);
00124       \}
00125       \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} r = IsLower ? size - endBlock : startBlock; \textcolor{comment}{// remaining size}
00126       \textcolor{keywordflow}{if} (r > 0)
00127       \{
00128         \textcolor{comment}{// let's directly call the low level product function because:}
00129         \textcolor{comment}{// 1 - it is faster to compile}
00130         \textcolor{comment}{// 2 - it is slighlty faster at runtime}
00131         
      \hyperlink{struct_eigen_1_1internal_1_1general__matrix__vector__product}{general\_matrix\_vector\_product<Index,LhsScalar,LhsMapper,ColMajor,Conjugate,RhsScalar,RhsMapper,false>::run}
      (
00132             r, actualPanelWidth,
00133             LhsMapper(&lhs.coeffRef(endBlock,startBlock), lhsStride),
00134             RhsMapper(rhs+startBlock, 1),
00135             rhs+endBlock, 1, RhsScalar(-1));
00136       \}
00137     \}
00138   \}
00139 \};
00140 
00141 \} \textcolor{comment}{// end namespace internal}
00142 
00143 \} \textcolor{comment}{// end namespace Eigen}
00144 
00145 \textcolor{preprocessor}{#endif // EIGEN\_TRIANGULAR\_SOLVER\_VECTOR\_H}
\end{DoxyCode}
