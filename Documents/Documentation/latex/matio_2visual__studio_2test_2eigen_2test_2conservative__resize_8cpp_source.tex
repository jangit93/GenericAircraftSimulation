\hypertarget{matio_2visual__studio_2test_2eigen_2test_2conservative__resize_8cpp_source}{}\section{matio/visual\+\_\+studio/test/eigen/test/conservative\+\_\+resize.cpp}
\label{matio_2visual__studio_2test_2eigen_2test_2conservative__resize_8cpp_source}\index{conservative\+\_\+resize.\+cpp@{conservative\+\_\+resize.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2009 Hauke Heibel <hauke.heibel@gmail.com>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#include "main.h"}
00011 
00012 \textcolor{preprocessor}{#include <Eigen/Core>}
00013 
00014 \textcolor{keyword}{using namespace }\hyperlink{namespace_eigen}{Eigen};
00015 
00016 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Scalar, \textcolor{keywordtype}{int} Storage>
00017 \textcolor{keywordtype}{void} run\_matrix\_tests()
00018 \{
00019   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar, Eigen::Dynamic, Eigen::Dynamic, Storage>}
       MatrixType;
00020   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::Index \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index};
00021 
00022   MatrixType m, n;
00023 
00024   \textcolor{comment}{// boundary cases ...}
00025   m = n = MatrixType::Random(50,50);
00026   m.conservativeResize(1,50);
00027   VERIFY\_IS\_APPROX(m, n.block(0,0,1,50));
00028 
00029   m = n = MatrixType::Random(50,50);
00030   m.conservativeResize(50,1);
00031   VERIFY\_IS\_APPROX(m, n.block(0,0,50,1));
00032 
00033   m = n = MatrixType::Random(50,50);
00034   m.conservativeResize(50,50);
00035   VERIFY\_IS\_APPROX(m, n.block(0,0,50,50));
00036 
00037   \textcolor{comment}{// random shrinking ...}
00038   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0; i<25; ++i)
00039   \{
00040     \textcolor{keyword}{const} Index rows = internal::random<Index>(1,50);
00041     \textcolor{keyword}{const} Index cols = internal::random<Index>(1,50);
00042     m = n = MatrixType::Random(50,50);
00043     m.conservativeResize(rows,cols);
00044     VERIFY\_IS\_APPROX(m, n.block(0,0,rows,cols));
00045   \}
00046 
00047   \textcolor{comment}{// random growing with zeroing ...}
00048   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0; i<25; ++i)
00049   \{
00050     \textcolor{keyword}{const} Index rows = internal::random<Index>(50,75);
00051     \textcolor{keyword}{const} Index cols = internal::random<Index>(50,75);
00052     m = n = MatrixType::Random(50,50);
00053     m.conservativeResizeLike(MatrixType::Zero(rows,cols));
00054     VERIFY\_IS\_APPROX(m.block(0,0,n.rows(),n.cols()), n);
00055     VERIFY( rows<=50 || m.block(50,0,rows-50,cols).sum() == Scalar(0) );
00056     VERIFY( cols<=50 || m.block(0,50,rows,cols-50).sum() == Scalar(0) );
00057   \}
00058 \}
00059 
00060 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Scalar>
00061 \textcolor{keywordtype}{void} run\_vector\_tests()
00062 \{
00063   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar, 1, Eigen::Dynamic>} 
      \hyperlink{struct_vector_type}{VectorType};
00064 
00065   VectorType m, n;
00066 
00067   \textcolor{comment}{// boundary cases ...}
00068   m = n = VectorType::Random(50);
00069   m.conservativeResize(1);
00070   VERIFY\_IS\_APPROX(m, n.segment(0,1));
00071 
00072   m = n = VectorType::Random(50);
00073   m.conservativeResize(50);
00074   VERIFY\_IS\_APPROX(m, n.segment(0,50));
00075   
00076   m = n = VectorType::Random(50);
00077   m.conservativeResize(m.rows(),1);
00078   VERIFY\_IS\_APPROX(m, n.segment(0,1));
00079 
00080   m = n = VectorType::Random(50);
00081   m.conservativeResize(m.rows(),50);
00082   VERIFY\_IS\_APPROX(m, n.segment(0,50));
00083 
00084   \textcolor{comment}{// random shrinking ...}
00085   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0; i<50; ++i)
00086   \{
00087     \textcolor{keyword}{const} \textcolor{keywordtype}{int} size = internal::random<int>(1,50);
00088     m = n = VectorType::Random(50);
00089     m.conservativeResize(size);
00090     VERIFY\_IS\_APPROX(m, n.segment(0,size));
00091     
00092     m = n = VectorType::Random(50);
00093     m.conservativeResize(m.rows(), size);
00094     VERIFY\_IS\_APPROX(m, n.segment(0,size));
00095   \}
00096 
00097   \textcolor{comment}{// random growing with zeroing ...}
00098   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0; i<50; ++i)
00099   \{
00100     \textcolor{keyword}{const} \textcolor{keywordtype}{int} size = internal::random<int>(50,100);
00101     m = n = VectorType::Random(50);
00102     m.conservativeResizeLike(VectorType::Zero(size));
00103     VERIFY\_IS\_APPROX(m.segment(0,50), n);
00104     VERIFY( size<=50 || m.segment(50,size-50).sum() == Scalar(0) );
00105     
00106     m = n = VectorType::Random(50);
00107     m.conservativeResizeLike(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,Dynamic,Dynamic>::Zero}(1,
      size));
00108     VERIFY\_IS\_APPROX(m.segment(0,50), n);
00109     VERIFY( size<=50 || m.segment(50,size-50).sum() == Scalar(0) );
00110   \}
00111 \}
00112 
00113 \textcolor{keywordtype}{void} test\_conservative\_resize()
00114 \{
00115   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0; i<g\_repeat; ++i)
00116   \{
00117     CALL\_SUBTEST\_1((run\_matrix\_tests<int, Eigen::RowMajor>()));
00118     CALL\_SUBTEST\_1((run\_matrix\_tests<int, Eigen::ColMajor>()));
00119     CALL\_SUBTEST\_2((run\_matrix\_tests<float, Eigen::RowMajor>()));
00120     CALL\_SUBTEST\_2((run\_matrix\_tests<float, Eigen::ColMajor>()));
00121     CALL\_SUBTEST\_3((run\_matrix\_tests<double, Eigen::RowMajor>()));
00122     CALL\_SUBTEST\_3((run\_matrix\_tests<double, Eigen::ColMajor>()));
00123     CALL\_SUBTEST\_4((run\_matrix\_tests<std::complex<float>, \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13acfcde9cd8677c5f7caf6bd603666aae3}{Eigen::RowMajor}>()));
00124     CALL\_SUBTEST\_4((run\_matrix\_tests<std::complex<float>, \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{Eigen::ColMajor}>()));
00125     CALL\_SUBTEST\_5((run\_matrix\_tests<std::complex<double>, \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13acfcde9cd8677c5f7caf6bd603666aae3}{Eigen::RowMajor}>()));
00126     CALL\_SUBTEST\_6((run\_matrix\_tests<std::complex<double>, \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{Eigen::ColMajor}>()));
00127 
00128     CALL\_SUBTEST\_1((run\_vector\_tests<int>()));
00129     CALL\_SUBTEST\_2((run\_vector\_tests<float>()));
00130     CALL\_SUBTEST\_3((run\_vector\_tests<double>()));
00131     CALL\_SUBTEST\_4((run\_vector\_tests<std::complex<float> >()));
00132     CALL\_SUBTEST\_5((run\_vector\_tests<std::complex<double> >()));
00133   \}
00134 \}
\end{DoxyCode}
