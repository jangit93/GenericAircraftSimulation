\hypertarget{eigen_2unsupported_2test_2cxx11__tensor__reverse_8cpp_source}{}\section{eigen/unsupported/test/cxx11\+\_\+tensor\+\_\+reverse.cpp}
\label{eigen_2unsupported_2test_2cxx11__tensor__reverse_8cpp_source}\index{cxx11\+\_\+tensor\+\_\+reverse.\+cpp@{cxx11\+\_\+tensor\+\_\+reverse.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2014 Navdeep Jaitly <ndjaitly@google.com and}
00005 \textcolor{comment}{//                    Benoit Steiner <benoit.steiner.goog@gmail.com>}
00006 \textcolor{comment}{//}
00007 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00008 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00009 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00010 
00011 \textcolor{preprocessor}{#include "main.h"}
00012 
00013 \textcolor{preprocessor}{#include <Eigen/CXX11/Tensor>}
00014 
00015 \textcolor{keyword}{using} \hyperlink{class_eigen_1_1_tensor}{Eigen::Tensor};
00016 \textcolor{keyword}{using} \hyperlink{class_eigen_1_1array}{Eigen::array};
00017 
00018 \textcolor{keyword}{template} <\textcolor{keywordtype}{int} DataLayout>
00019 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_simple\_reverse()
00020 \{
00021   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 4, DataLayout>} tensor(2,3,5,7);
00022   tensor.setRandom();
00023 
00024   \hyperlink{class_eigen_1_1array}{array<bool, 4>} dim\_rev;
00025   dim\_rev[0] = \textcolor{keyword}{false};
00026   dim\_rev[1] = \textcolor{keyword}{true};
00027   dim\_rev[2] = \textcolor{keyword}{true};
00028   dim\_rev[3] = \textcolor{keyword}{false};
00029 
00030   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 4, DataLayout>} reversed\_tensor;
00031   reversed\_tensor = tensor.reverse(dim\_rev);
00032 
00033   VERIFY\_IS\_EQUAL(reversed\_tensor.dimension(0), 2);
00034   VERIFY\_IS\_EQUAL(reversed\_tensor.dimension(1), 3);
00035   VERIFY\_IS\_EQUAL(reversed\_tensor.dimension(2), 5);
00036   VERIFY\_IS\_EQUAL(reversed\_tensor.dimension(3), 7);
00037 
00038   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00039     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
00040       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 5; ++k) \{
00041         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} l = 0; l < 7; ++l) \{
00042           VERIFY\_IS\_EQUAL(tensor(i,j,k,l), reversed\_tensor(i,2-j,4-k,l));
00043         \}
00044       \}
00045     \}
00046   \}
00047 
00048   dim\_rev[0] = \textcolor{keyword}{true};
00049   dim\_rev[1] = \textcolor{keyword}{false};
00050   dim\_rev[2] = \textcolor{keyword}{false};
00051   dim\_rev[3] = \textcolor{keyword}{false};
00052 
00053   reversed\_tensor = tensor.reverse(dim\_rev);
00054 
00055   VERIFY\_IS\_EQUAL(reversed\_tensor.dimension(0), 2);
00056   VERIFY\_IS\_EQUAL(reversed\_tensor.dimension(1), 3);
00057   VERIFY\_IS\_EQUAL(reversed\_tensor.dimension(2), 5);
00058   VERIFY\_IS\_EQUAL(reversed\_tensor.dimension(3), 7);
00059 
00060 
00061   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00062     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
00063       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 5; ++k) \{
00064         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} l = 0; l < 7; ++l) \{
00065           VERIFY\_IS\_EQUAL(tensor(i,j,k,l), reversed\_tensor(1-i,j,k,l));
00066         \}
00067       \}
00068     \}
00069   \}
00070 
00071   dim\_rev[0] = \textcolor{keyword}{true};
00072   dim\_rev[1] = \textcolor{keyword}{false};
00073   dim\_rev[2] = \textcolor{keyword}{false};
00074   dim\_rev[3] = \textcolor{keyword}{true};
00075 
00076   reversed\_tensor = tensor.reverse(dim\_rev);
00077 
00078   VERIFY\_IS\_EQUAL(reversed\_tensor.dimension(0), 2);
00079   VERIFY\_IS\_EQUAL(reversed\_tensor.dimension(1), 3);
00080   VERIFY\_IS\_EQUAL(reversed\_tensor.dimension(2), 5);
00081   VERIFY\_IS\_EQUAL(reversed\_tensor.dimension(3), 7);
00082 
00083 
00084   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00085     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
00086       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 5; ++k) \{
00087         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} l = 0; l < 7; ++l) \{
00088           VERIFY\_IS\_EQUAL(tensor(i,j,k,l), reversed\_tensor(1-i,j,k,6-l));
00089         \}
00090       \}
00091     \}
00092   \}
00093 \}
00094 
00095 
00096 \textcolor{keyword}{template} <\textcolor{keywordtype}{int} DataLayout>
00097 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_expr\_reverse(\textcolor{keywordtype}{bool} LValue)
00098 \{
00099   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 4, DataLayout>} tensor(2,3,5,7);
00100   tensor.setRandom();
00101 
00102   \hyperlink{class_eigen_1_1array}{array<bool, 4>} dim\_rev;
00103   dim\_rev[0] = \textcolor{keyword}{false};
00104   dim\_rev[1] = \textcolor{keyword}{true};
00105   dim\_rev[2] = \textcolor{keyword}{false};
00106   dim\_rev[3] = \textcolor{keyword}{true};
00107 
00108   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 4, DataLayout>} expected(2, 3, 5, 7);
00109   \textcolor{keywordflow}{if} (LValue) \{
00110     expected.reverse(dim\_rev) = tensor;
00111   \} \textcolor{keywordflow}{else} \{
00112     expected = tensor.reverse(dim\_rev);
00113   \}
00114 
00115   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 4, DataLayout>} result(2,3,5,7);
00116 
00117   \hyperlink{class_eigen_1_1array}{array<ptrdiff\_t, 4>} src\_slice\_dim;
00118   src\_slice\_dim[0] = 2;
00119   src\_slice\_dim[1] = 3;
00120   src\_slice\_dim[2] = 1;
00121   src\_slice\_dim[3] = 7;
00122   \hyperlink{class_eigen_1_1array}{array<ptrdiff\_t, 4>} src\_slice\_start;
00123   src\_slice\_start[0] = 0;
00124   src\_slice\_start[1] = 0;
00125   src\_slice\_start[2] = 0;
00126   src\_slice\_start[3] = 0;
00127   \hyperlink{class_eigen_1_1array}{array<ptrdiff\_t, 4>} dst\_slice\_dim = src\_slice\_dim;
00128   \hyperlink{class_eigen_1_1array}{array<ptrdiff\_t, 4>} dst\_slice\_start = src\_slice\_start;
00129 
00130   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 5; ++i) \{
00131     \textcolor{keywordflow}{if} (LValue) \{
00132       result.slice(dst\_slice\_start, dst\_slice\_dim).reverse(dim\_rev) =
00133           tensor.slice(src\_slice\_start, src\_slice\_dim);
00134     \} \textcolor{keywordflow}{else} \{
00135       result.slice(dst\_slice\_start, dst\_slice\_dim) =
00136           tensor.slice(src\_slice\_start, src\_slice\_dim).reverse(dim\_rev);
00137     \}
00138     src\_slice\_start[2] += 1;
00139     dst\_slice\_start[2] += 1;
00140   \}
00141 
00142   VERIFY\_IS\_EQUAL(result.dimension(0), 2);
00143   VERIFY\_IS\_EQUAL(result.dimension(1), 3);
00144   VERIFY\_IS\_EQUAL(result.dimension(2), 5);
00145   VERIFY\_IS\_EQUAL(result.dimension(3), 7);
00146 
00147   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < expected.dimension(0); ++i) \{
00148     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < expected.dimension(1); ++j) \{
00149       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < expected.dimension(2); ++k) \{
00150         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} l = 0; l < expected.dimension(3); ++l) \{
00151           VERIFY\_IS\_EQUAL(result(i,j,k,l), expected(i,j,k,l));
00152         \}
00153       \}
00154     \}
00155   \}
00156 
00157   dst\_slice\_start[2] = 0;
00158   result.setRandom();
00159   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 5; ++i) \{
00160      \textcolor{keywordflow}{if} (LValue) \{
00161        result.slice(dst\_slice\_start, dst\_slice\_dim).reverse(dim\_rev) =
00162            tensor.slice(dst\_slice\_start, dst\_slice\_dim);
00163      \} \textcolor{keywordflow}{else} \{
00164        result.slice(dst\_slice\_start, dst\_slice\_dim) =
00165            tensor.reverse(dim\_rev).slice(dst\_slice\_start, dst\_slice\_dim);
00166      \}
00167     dst\_slice\_start[2] += 1;
00168   \}
00169 
00170   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < expected.dimension(0); ++i) \{
00171     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < expected.dimension(1); ++j) \{
00172       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < expected.dimension(2); ++k) \{
00173         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} l = 0; l < expected.dimension(3); ++l) \{
00174           VERIFY\_IS\_EQUAL(result(i,j,k,l), expected(i,j,k,l));
00175         \}
00176       \}
00177     \}
00178   \}
00179 \}
00180 
00181 
00182 \textcolor{keywordtype}{void} test\_cxx11\_tensor\_reverse()
00183 \{
00184   CALL\_SUBTEST(test\_simple\_reverse<ColMajor>());
00185   CALL\_SUBTEST(test\_simple\_reverse<RowMajor>());
00186   CALL\_SUBTEST(test\_expr\_reverse<ColMajor>(\textcolor{keyword}{true}));
00187   CALL\_SUBTEST(test\_expr\_reverse<RowMajor>(\textcolor{keyword}{true}));
00188   CALL\_SUBTEST(test\_expr\_reverse<ColMajor>(\textcolor{keyword}{false}));
00189   CALL\_SUBTEST(test\_expr\_reverse<RowMajor>(\textcolor{keyword}{false}));
00190 \}
\end{DoxyCode}
