\hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_kronecker_product_2_kronecker_tensor_product_8h_source}{}\section{matio/visual\+\_\+studio/test/eigen/unsupported/\+Eigen/src/\+Kronecker\+Product/\+Kronecker\+Tensor\+Product.h}
\label{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_kronecker_product_2_kronecker_tensor_product_8h_source}\index{Kronecker\+Tensor\+Product.\+h@{Kronecker\+Tensor\+Product.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2011 Kolja Brix <brix@igpm.rwth-aachen.de>}
00005 \textcolor{comment}{// Copyright (C) 2011 Andreas Platen <andiplaten@gmx.de>}
00006 \textcolor{comment}{// Copyright (C) 2012 Chen-Pang He <jdh8@ms63.hinet.net>}
00007 \textcolor{comment}{//}
00008 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00009 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00010 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00011 
00012 \textcolor{preprocessor}{#ifndef KRONECKER\_TENSOR\_PRODUCT\_H}
00013 \textcolor{preprocessor}{#define KRONECKER\_TENSOR\_PRODUCT\_H}
00014 
00015 \textcolor{keyword}{namespace }\hyperlink{namespace_eigen}{Eigen} \{
00016 
00024 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Derived>
00025 \textcolor{keyword}{class }KroneckerProductBase : \textcolor{keyword}{public} ReturnByValue<Derived>
00026 \{
00027   \textcolor{keyword}{private}:
00028     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} internal::traits<Derived> Traits;
00029     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Traits::Scalar Scalar;
00030 
00031   \textcolor{keyword}{protected}:
00032     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Traits::Lhs Lhs;
00033     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Traits::Rhs Rhs;
00034 
00035   \textcolor{keyword}{public}:
\Hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_kronecker_product_2_kronecker_tensor_product_8h_source_l00037}\hyperlink{class_eigen_1_1_kronecker_product_base_a0cb05eaa978b9fdc0285b48a6e0ecfb1}{00037}     \hyperlink{class_eigen_1_1_kronecker_product_base_a0cb05eaa978b9fdc0285b48a6e0ecfb1}{KroneckerProductBase}(\textcolor{keyword}{const} Lhs& \hyperlink{group___core___module_class_eigen_1_1_matrix}{A}, \textcolor{keyword}{const} Rhs& \hyperlink{group___core___module_class_eigen_1_1_matrix}{B})
00038       : m\_A(A), m\_B(B)
00039     \{\}
00040 
00041     \textcolor{keyword}{inline} \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} rows()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_A.rows() * m\_B.rows(); \}
00042     \textcolor{keyword}{inline} \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} cols()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_A.cols() * m\_B.cols(); \}
00043 
\Hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_kronecker_product_2_kronecker_tensor_product_8h_source_l00048}\hyperlink{class_eigen_1_1_kronecker_product_base_a0b302d4e55f5a58955e6c645d066928f}{00048}     Scalar \hyperlink{class_eigen_1_1_kronecker_product_base_a0b302d4e55f5a58955e6c645d066928f}{coeff}(\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} row, \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} col)\textcolor{keyword}{ const}
00049 \textcolor{keyword}{    }\{
00050       \textcolor{keywordflow}{return} m\_A.coeff(row / m\_B.rows(), col / m\_B.cols()) *
00051              m\_B.coeff(row % m\_B.rows(), col % m\_B.cols());
00052     \}
00053 
\Hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_kronecker_product_2_kronecker_tensor_product_8h_source_l00058}\hyperlink{class_eigen_1_1_kronecker_product_base_a673348e7d9d2a4570aa0bcac33507f7b}{00058}     Scalar \hyperlink{class_eigen_1_1_kronecker_product_base_a673348e7d9d2a4570aa0bcac33507f7b}{coeff}(\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} i)\textcolor{keyword}{ const}
00059 \textcolor{keyword}{    }\{
00060       EIGEN\_STATIC\_ASSERT\_VECTOR\_ONLY(Derived);
00061       \textcolor{keywordflow}{return} m\_A.coeff(i / m\_A.size()) * m\_B.coeff(i % m\_A.size());
00062     \}
00063 
00064   \textcolor{keyword}{protected}:
00065     \textcolor{keyword}{typename} Lhs::Nested m\_A;
00066     \textcolor{keyword}{typename} Rhs::Nested m\_B;
00067 \};
00068 
00081 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Lhs, \textcolor{keyword}{typename} Rhs>
00082 \textcolor{keyword}{class }\hyperlink{class_eigen_1_1_kronecker_product}{KroneckerProduct} : \textcolor{keyword}{public} \hyperlink{class_eigen_1_1_kronecker_product_base}{KroneckerProductBase}<KroneckerProduct<L
      hs,Rhs> >
00083 \{
00084   \textcolor{keyword}{private}:
00085     \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1_kronecker_product_base}{KroneckerProductBase<KroneckerProduct>} Base;
00086     \textcolor{keyword}{using} Base::m\_A;
00087     \textcolor{keyword}{using} Base::m\_B;
00088 
00089   \textcolor{keyword}{public}:
\Hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_kronecker_product_2_kronecker_tensor_product_8h_source_l00091}\hyperlink{class_eigen_1_1_kronecker_product_a0b01b6d5ae2413cef8fd91fe7a98a0d7}{00091}     \hyperlink{class_eigen_1_1_kronecker_product_a0b01b6d5ae2413cef8fd91fe7a98a0d7}{KroneckerProduct}(\textcolor{keyword}{const} Lhs& \hyperlink{group___core___module_class_eigen_1_1_matrix}{A}, \textcolor{keyword}{const} Rhs& \hyperlink{group___core___module_class_eigen_1_1_matrix}{B})
00092       : Base(A, B)
00093     \{\}
00094 
00096     \textcolor{keyword}{template}<\textcolor{keyword}{typename} Dest> \textcolor{keywordtype}{void} evalTo(Dest& dst) \textcolor{keyword}{const};
00097 \};
00098 
00114 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Lhs, \textcolor{keyword}{typename} Rhs>
00115 \textcolor{keyword}{class }\hyperlink{class_eigen_1_1_kronecker_product_sparse}{KroneckerProductSparse} : \textcolor{keyword}{public} \hyperlink{class_eigen_1_1_kronecker_product_base}{KroneckerProductBase}<Kronec
      kerProductSparse<Lhs,Rhs> >
00116 \{
00117   \textcolor{keyword}{private}:
00118     \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1_kronecker_product_base}{KroneckerProductBase<KroneckerProductSparse>} 
      \hyperlink{class_eigen_1_1_kronecker_product_base}{Base};
00119     \textcolor{keyword}{using} Base::m\_A;
00120     \textcolor{keyword}{using} Base::m\_B;
00121 
00122   \textcolor{keyword}{public}:
\Hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_kronecker_product_2_kronecker_tensor_product_8h_source_l00124}\hyperlink{class_eigen_1_1_kronecker_product_sparse_ac0a69ba844415fbe79e6514f32b41fb5}{00124}     \hyperlink{class_eigen_1_1_kronecker_product_sparse_ac0a69ba844415fbe79e6514f32b41fb5}{KroneckerProductSparse}(\textcolor{keyword}{const} Lhs& \hyperlink{group___core___module_class_eigen_1_1_matrix}{A}, \textcolor{keyword}{const} Rhs& \hyperlink{group___core___module_class_eigen_1_1_matrix}{B})
00125       : Base(A, B)
00126     \{\}
00127 
00129     \textcolor{keyword}{template}<\textcolor{keyword}{typename} Dest> \textcolor{keywordtype}{void} evalTo(Dest& dst) \textcolor{keyword}{const};
00130 \};
00131 
00132 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Lhs, \textcolor{keyword}{typename} Rhs>
00133 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Dest>
00134 \textcolor{keywordtype}{void} \hyperlink{class_eigen_1_1_kronecker_product_a10f65aca36ed69da354e70b300b5a223}{KroneckerProduct<Lhs,Rhs>::evalTo}(Dest& dst)\textcolor{keyword}{ const}
00135 \textcolor{keyword}{}\{
00136   \textcolor{keyword}{const} \textcolor{keywordtype}{int} BlockRows = Rhs::RowsAtCompileTime,
00137             BlockCols = Rhs::ColsAtCompileTime;
00138   \textcolor{keyword}{const} \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} Br = m\_B.rows(),
00139               Bc = m\_B.cols();
00140   \textcolor{keywordflow}{for} (\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} i=0; i < m\_A.rows(); ++i)
00141     \textcolor{keywordflow}{for} (\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} j=0; j < m\_A.cols(); ++j)
00142       \hyperlink{group___core___module_class_eigen_1_1_block}{Block<Dest,BlockRows,BlockCols>}(dst,i*Br,j*Bc,Br,Bc) = m\_A.coeff(i,j) 
      * m\_B;
00143 \}
00144 
00145 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Lhs, \textcolor{keyword}{typename} Rhs>
00146 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Dest>
00147 \textcolor{keywordtype}{void} \hyperlink{class_eigen_1_1_kronecker_product_sparse_a8b7269c23294765e0965b70b5af2557b}{KroneckerProductSparse<Lhs,Rhs>::evalTo}(Dest& dst)\textcolor{keyword}{ const}
00148 \textcolor{keyword}{}\{
00149   \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} Br = m\_B.rows(), Bc = m\_B.cols();
00150   dst.resize(this->rows(), this->cols());
00151   dst.resizeNonZeros(0);
00152   
00153   \textcolor{comment}{// 1 - evaluate the operands if needed:}
00154   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{class_eigen_1_1internal_1_1_tensor_lazy_evaluator_writable}{internal::nested\_eval<Lhs,Dynamic>::type} Lhs1;
00155   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{internal::remove\_all<Lhs1>::type} Lhs1Cleaned;
00156   \textcolor{keyword}{const} Lhs1 lhs1(m\_A);
00157   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{class_eigen_1_1internal_1_1_tensor_lazy_evaluator_writable}{internal::nested\_eval<Rhs,Dynamic>::type} Rhs1;
00158   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{internal::remove\_all<Rhs1>::type} Rhs1Cleaned;
00159   \textcolor{keyword}{const} Rhs1 rhs1(m\_B);
00160     
00161   \textcolor{comment}{// 2 - construct respective iterators}
00162   \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1_inner_iterator}{Eigen::InnerIterator<Lhs1Cleaned>} LhsInnerIterator;
00163   \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1_inner_iterator}{Eigen::InnerIterator<Rhs1Cleaned>} RhsInnerIterator;
00164   
00165   \textcolor{comment}{// compute number of non-zeros per innervectors of dst}
00166   \{
00167     \textcolor{comment}{// TODO VectorXi is not necessarily big enough!}
00168     VectorXi nnzA = VectorXi::Zero(Dest::IsRowMajor ? m\_A.rows() : m\_A.cols());
00169     \textcolor{keywordflow}{for} (\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} kA=0; kA < m\_A.outerSize(); ++kA)
00170       \textcolor{keywordflow}{for} (LhsInnerIterator itA(lhs1,kA); itA; ++itA)
00171         nnzA(Dest::IsRowMajor ? itA.row() : itA.col())++;
00172       
00173     VectorXi nnzB = VectorXi::Zero(Dest::IsRowMajor ? m\_B.rows() : m\_B.cols());
00174     \textcolor{keywordflow}{for} (\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} kB=0; kB < m\_B.outerSize(); ++kB)
00175       \textcolor{keywordflow}{for} (RhsInnerIterator itB(rhs1,kB); itB; ++itB)
00176         nnzB(Dest::IsRowMajor ? itB.row() : itB.col())++;
00177     
00178     \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<int,Dynamic,Dynamic,ColMajor>} nnzAB = nnzB * nnzA.transpose(
      );
00179     dst.reserve(VectorXi::Map(nnzAB.\hyperlink{class_eigen_1_1_plain_object_base_ac25699535374b1854cf8494e44ad31b2}{data}(), nnzAB.size()));
00180   \}
00181 
00182   \textcolor{keywordflow}{for} (\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} kA=0; kA < m\_A.outerSize(); ++kA)
00183   \{
00184     \textcolor{keywordflow}{for} (\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} kB=0; kB < m\_B.outerSize(); ++kB)
00185     \{
00186       \textcolor{keywordflow}{for} (LhsInnerIterator itA(lhs1,kA); itA; ++itA)
00187       \{
00188         \textcolor{keywordflow}{for} (RhsInnerIterator itB(rhs1,kB); itB; ++itB)
00189         \{
00190           \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} i = itA.row() * Br + itB.row(),
00191                 j = itA.col() * Bc + itB.col();
00192           dst.insert(i,j) = itA.value() * itB.value();
00193         \}
00194       \}
00195     \}
00196   \}
00197 \}
00198 
00199 \textcolor{keyword}{namespace }\hyperlink{namespaceinternal}{internal} \{
00200 
00201 \textcolor{keyword}{template}<\textcolor{keyword}{typename} \_Lhs, \textcolor{keyword}{typename} \_Rhs>
00202 \textcolor{keyword}{struct }traits<KroneckerProduct<\_Lhs,\_Rhs> >
00203 \{
00204   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} remove\_all<\_Lhs>::type Lhs;
00205   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} remove\_all<\_Rhs>::type Rhs;
00206   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} 
      \hyperlink{group___core___module_struct_eigen_1_1_scalar_binary_op_traits}{ScalarBinaryOpTraits<typename Lhs::Scalar, typename Rhs::Scalar>::ReturnType}
       Scalar;
00207   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} promote\_index\_type<typename Lhs::StorageIndex, typename Rhs::StorageIndex>::type 
      StorageIndex;
00208 
00209   \textcolor{keyword}{enum} \{
00210     Rows = size\_at\_compile\_time<traits<Lhs>::RowsAtCompileTime, traits<Rhs>::RowsAtCompileTime>::ret,
00211     Cols = size\_at\_compile\_time<traits<Lhs>::ColsAtCompileTime, traits<Rhs>::ColsAtCompileTime>::ret,
00212     MaxRows = size\_at\_compile\_time<traits<Lhs>::MaxRowsAtCompileTime, traits<Rhs>::MaxRowsAtCompileTime>
      ::ret,
00213     MaxCols = size\_at\_compile\_time<traits<Lhs>::MaxColsAtCompileTime, traits<Rhs>::MaxColsAtCompileTime>
      ::ret
00214   \};
00215 
00216   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,Rows,Cols>} ReturnType;
00217 \};
00218 
00219 \textcolor{keyword}{template}<\textcolor{keyword}{typename} \_Lhs, \textcolor{keyword}{typename} \_Rhs>
00220 \textcolor{keyword}{struct }traits<KroneckerProductSparse<\_Lhs,\_Rhs> >
00221 \{
00222   \textcolor{keyword}{typedef} \hyperlink{struct_eigen_1_1_matrix_xpr}{MatrixXpr} XprKind;
00223   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} remove\_all<\_Lhs>::type Lhs;
00224   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} remove\_all<\_Rhs>::type Rhs;
00225   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} 
      \hyperlink{group___core___module_struct_eigen_1_1_scalar_binary_op_traits}{ScalarBinaryOpTraits<typename Lhs::Scalar, typename Rhs::Scalar>::ReturnType}
       Scalar;
00226   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} cwise\_promote\_storage\_type<typename traits<Lhs>::StorageKind, \textcolor{keyword}{typename} 
      traits<Rhs>::StorageKind, scalar\_product\_op<typename Lhs::Scalar, typename Rhs::Scalar> >::ret StorageKind;
00227   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} promote\_index\_type<typename Lhs::StorageIndex, typename Rhs::StorageIndex>::type 
      StorageIndex;
00228 
00229   \textcolor{keyword}{enum} \{
00230     LhsFlags = Lhs::Flags,
00231     RhsFlags = Rhs::Flags,
00232 
00233     RowsAtCompileTime = size\_at\_compile\_time<traits<Lhs>::RowsAtCompileTime, traits<Rhs>::RowsAtCompileTime
      >::ret,
00234     ColsAtCompileTime = size\_at\_compile\_time<traits<Lhs>::ColsAtCompileTime, traits<Rhs>::ColsAtCompileTime
      >::ret,
00235     MaxRowsAtCompileTime = size\_at\_compile\_time<traits<Lhs>::MaxRowsAtCompileTime, 
      traits<Rhs>::MaxRowsAtCompileTime>::ret,
00236     MaxColsAtCompileTime = size\_at\_compile\_time<traits<Lhs>::MaxColsAtCompileTime, 
      traits<Rhs>::MaxColsAtCompileTime>::ret,
00237 
00238     EvalToRowMajor = (LhsFlags & RhsFlags & \hyperlink{group__flags_gae4f56c2a60bbe4bd2e44c5b19cbe8762}{RowMajorBit}),
00239     RemovedBits = ~(EvalToRowMajor ? 0 : \hyperlink{group__flags_gae4f56c2a60bbe4bd2e44c5b19cbe8762}{RowMajorBit}),
00240 
00241     Flags = ((LhsFlags | RhsFlags) & HereditaryBits & RemovedBits)
00242           | \hyperlink{group__flags_gaa34e83bae46a8eeae4e69ebe3aaecbed}{EvalBeforeNestingBit},
00243     CoeffReadCost = \hyperlink{namespace_eigen_a3163430a1c13173faffde69016b48aaf}{HugeCost}
00244   \};
00245 
00246   \textcolor{keyword}{typedef} \hyperlink{group___sparse_core___module_class_eigen_1_1_sparse_matrix}{SparseMatrix<Scalar, 0, StorageIndex>} ReturnType;
00247 \};
00248 
00249 \} \textcolor{comment}{// end namespace internal}
00250 
00270 \textcolor{keyword}{template}<\textcolor{keyword}{typename} A, \textcolor{keyword}{typename} B>
00271 \hyperlink{class_eigen_1_1_kronecker_product}{KroneckerProduct<A,B>} \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(\textcolor{keyword}{const} 
      \hyperlink{group___core___module_class_eigen_1_1_matrix_base}{MatrixBase<A>}& a, \textcolor{keyword}{const} \hyperlink{group___core___module_class_eigen_1_1_matrix_base}{MatrixBase<B>}& b)
00272 \{
00273   \textcolor{keywordflow}{return} \hyperlink{class_eigen_1_1_kronecker_product}{KroneckerProduct<A, B>}(a.derived(), b.derived());
00274 \}
00275 
00297 \textcolor{keyword}{template}<\textcolor{keyword}{typename} A, \textcolor{keyword}{typename} B>
00298 \hyperlink{class_eigen_1_1_kronecker_product_sparse}{KroneckerProductSparse<A,B>} \hyperlink{namespace_eigen_aedd4b7cd1e324ed0769cac2701f4d050}{kroneckerProduct}(\textcolor{keyword}{const} 
      \hyperlink{group___core___module_struct_eigen_1_1_eigen_base}{EigenBase<A>}& a, \textcolor{keyword}{const} \hyperlink{group___core___module_struct_eigen_1_1_eigen_base}{EigenBase<B>}& b)
00299 \{
00300   \textcolor{keywordflow}{return} \hyperlink{class_eigen_1_1_kronecker_product_sparse}{KroneckerProductSparse<A,B>}(a.\hyperlink{group___core___module_a324b16961a11d2ecfd2d1b7dd7946545}{derived}(), b.
      \hyperlink{group___core___module_a324b16961a11d2ecfd2d1b7dd7946545}{derived}());
00301 \}
00302 
00303 \} \textcolor{comment}{// end namespace Eigen}
00304 
00305 \textcolor{preprocessor}{#endif // KRONECKER\_TENSOR\_PRODUCT\_H}
\end{DoxyCode}
