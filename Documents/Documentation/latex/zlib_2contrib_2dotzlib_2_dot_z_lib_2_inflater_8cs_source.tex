\hypertarget{zlib_2contrib_2dotzlib_2_dot_z_lib_2_inflater_8cs_source}{}\section{zlib/contrib/dotzlib/\+Dot\+Z\+Lib/\+Inflater.cs}
\label{zlib_2contrib_2dotzlib_2_dot_z_lib_2_inflater_8cs_source}\index{Inflater.\+cs@{Inflater.\+cs}}

\begin{DoxyCode}
00001 \textcolor{comment}{//}
00002 \textcolor{comment}{// © Copyright Henrik Ravn 2004}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Use, modification and distribution are subject to the Boost Software License, Version 1.0.}
00005 \textcolor{comment}{// (See accompanying file LICENSE\_1\_0.txt or copy at http://www.boost.org/LICENSE\_1\_0.txt)}
00006 \textcolor{comment}{//}
00007 
00008 \textcolor{keyword}{using} \hyperlink{namespace_system}{System};
00009 \textcolor{keyword}{using} \hyperlink{namespace_system}{System}.Diagnostics;
00010 \textcolor{keyword}{using} \hyperlink{namespace_system}{System}.Runtime.InteropServices;
00011 
00012 \textcolor{keyword}{namespace }\hyperlink{namespace_dot_z_lib}{DotZLib}
00013 \{
00014 
00018     \textcolor{keyword}{public} \textcolor{keyword}{class }Inflater : CodecBase
00019     \{
00020 \textcolor{preprocessor}{        #region Dll imports}
00021         [DllImport(\textcolor{stringliteral}{"ZLIB1.dll"}, CallingConvention=CallingConvention.Cdecl, CharSet=CharSet.Ansi)]
00022         \textcolor{keyword}{private} \textcolor{keyword}{static} \textcolor{keyword}{extern} \textcolor{keywordtype}{int} inflateInit\_(ref ZStream sz, \textcolor{keywordtype}{string} vs, \textcolor{keywordtype}{int} size);
00023 
00024         [DllImport(\textcolor{stringliteral}{"ZLIB1.dll"}, CallingConvention=CallingConvention.Cdecl)]
00025         \textcolor{keyword}{private} \textcolor{keyword}{static} \textcolor{keyword}{extern} \textcolor{keywordtype}{int} inflate(ref ZStream sz, \textcolor{keywordtype}{int} flush);
00026 
00027         [DllImport(\textcolor{stringliteral}{"ZLIB1.dll"}, CallingConvention=CallingConvention.Cdecl)]
00028         \textcolor{keyword}{private} \textcolor{keyword}{static} \textcolor{keyword}{extern} \textcolor{keywordtype}{int} inflateReset(ref ZStream sz);
00029 
00030         [DllImport(\textcolor{stringliteral}{"ZLIB1.dll"}, CallingConvention=CallingConvention.Cdecl)]
00031         \textcolor{keyword}{private} \textcolor{keyword}{static} \textcolor{keyword}{extern} \textcolor{keywordtype}{int} inflateEnd(ref ZStream sz);
00032 \textcolor{preprocessor}{        #endregion}
00033 
\Hypertarget{zlib_2contrib_2dotzlib_2_dot_z_lib_2_inflater_8cs_source_l00037}\hyperlink{class_dot_z_lib_1_1_inflater_acb40e9664a78756a3def8ed66aa35ca1}{00037}         \textcolor{keyword}{public} \hyperlink{class_dot_z_lib_1_1_inflater_acb40e9664a78756a3def8ed66aa35ca1}{Inflater}() : base()
00038         \{
00039             \textcolor{keywordtype}{int} retval = inflateInit\_(ref \_ztream, \hyperlink{class_dot_z_lib_1_1_info}{Info}.\hyperlink{class_dot_z_lib_1_1_info_a55b101b2c131860775880231fdf5fbd7}{Version}, Marshal.SizeOf(\_ztream));
00040             \textcolor{keywordflow}{if} (retval != 0)
00041                 \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{class_dot_z_lib_1_1_z_lib_exception}{ZLibException}(retval, \textcolor{stringliteral}{"Could not initialize inflater"});
00042 
00043             \hyperlink{class_dot_z_lib_1_1_codec_base_a801b625073b21aeaab52ebf9e96dd9c9}{resetOutput}();
00044         \}
00045 
00046 
\Hypertarget{zlib_2contrib_2dotzlib_2_dot_z_lib_2_inflater_8cs_source_l00054}\hyperlink{class_dot_z_lib_1_1_inflater_a773dd62fe806dd9b6117f859faaeb079}{00054}         \textcolor{keyword}{public} \textcolor{keyword}{override} \textcolor{keywordtype}{void} \hyperlink{class_dot_z_lib_1_1_inflater_a773dd62fe806dd9b6117f859faaeb079}{Add}(byte[] data, \textcolor{keywordtype}{int} offset, \textcolor{keywordtype}{int} count)
00055         \{
00056             \textcolor{keywordflow}{if} (data == null) \textcolor{keywordflow}{throw} \textcolor{keyword}{new} ArgumentNullException();
00057             \textcolor{keywordflow}{if} (offset < 0 || count < 0) \textcolor{keywordflow}{throw} \textcolor{keyword}{new} ArgumentOutOfRangeException();
00058             \textcolor{keywordflow}{if} ((offset+count) > data.Length) \textcolor{keywordflow}{throw} \textcolor{keyword}{new} ArgumentException();
00059 
00060             \textcolor{keywordtype}{int} total = count;
00061             \textcolor{keywordtype}{int} inputIndex = offset;
00062             \textcolor{keywordtype}{int} err = 0;
00063 
00064             \textcolor{keywordflow}{while} (err >= 0 && inputIndex < total)
00065             \{
00066                 \hyperlink{class_dot_z_lib_1_1_codec_base_a8c827f091195356490e7f8b69e0546a7}{copyInput}(data, inputIndex, Math.Min(total - inputIndex, 
      \hyperlink{class_dot_z_lib_1_1_codec_base_a4e516f01a0660be7dbbbed22d1f6b595}{kBufferSize}));
00067                 err = inflate(ref \_ztream, (\textcolor{keywordtype}{int})FlushTypes.None);
00068                 \textcolor{keywordflow}{if} (err == 0)
00069                     \textcolor{keywordflow}{while} (\_ztream.avail\_out == 0)
00070                     \{
00071                         \hyperlink{class_dot_z_lib_1_1_codec_base_a5c697195bc017ae951858e7c8948f9ae}{OnDataAvailable}();
00072                         err = inflate(ref \_ztream, (\textcolor{keywordtype}{int})FlushTypes.None);
00073                     \}
00074 
00075                 inputIndex += (int)\_ztream.total\_in;
00076             \}
00077             \hyperlink{class_dot_z_lib_1_1_codec_base_a5dfa2dddf3ac857652af7fd8e3d2034d}{setChecksum}( \_ztream.adler );
00078         \}
00079 
00080 
\Hypertarget{zlib_2contrib_2dotzlib_2_dot_z_lib_2_inflater_8cs_source_l00084}\hyperlink{class_dot_z_lib_1_1_inflater_aa70c9d026f5d1b44fe0679b78973285c}{00084}         \textcolor{keyword}{public} \textcolor{keyword}{override} \textcolor{keywordtype}{void} \hyperlink{class_dot_z_lib_1_1_inflater_aa70c9d026f5d1b44fe0679b78973285c}{Finish}()
00085         \{
00086             \textcolor{keywordtype}{int} err;
00087             \textcolor{keywordflow}{do}
00088             \{
00089                 err = inflate(ref \_ztream, (\textcolor{keywordtype}{int})FlushTypes.Finish);
00090                 \hyperlink{class_dot_z_lib_1_1_codec_base_a5c697195bc017ae951858e7c8948f9ae}{OnDataAvailable}();
00091             \}
00092             \textcolor{keywordflow}{while} (err == 0);
00093             \hyperlink{class_dot_z_lib_1_1_codec_base_a5dfa2dddf3ac857652af7fd8e3d2034d}{setChecksum}( \_ztream.adler );
00094             inflateReset(ref \_ztream);
00095             \hyperlink{class_dot_z_lib_1_1_codec_base_a801b625073b21aeaab52ebf9e96dd9c9}{resetOutput}();
00096         \}
00097 
\Hypertarget{zlib_2contrib_2dotzlib_2_dot_z_lib_2_inflater_8cs_source_l00101}\hyperlink{class_dot_z_lib_1_1_inflater_af4ed4f530151f83222d2cb732a77626b}{00101}         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{void} \hyperlink{class_dot_z_lib_1_1_inflater_af4ed4f530151f83222d2cb732a77626b}{CleanUp}() \{ inflateEnd(ref \_ztream); \}
00102 
00103 
00104     \}
00105 \}
\end{DoxyCode}
