\hypertarget{matio_2visual__studio_2test_2eigen_2bench_2bench__gemm_8cpp_source}{}\section{matio/visual\+\_\+studio/test/eigen/bench/bench\+\_\+gemm.cpp}
\label{matio_2visual__studio_2test_2eigen_2bench_2bench__gemm_8cpp_source}\index{bench\+\_\+gemm.\+cpp@{bench\+\_\+gemm.\+cpp}}

\begin{DoxyCode}
00001 
00002 \textcolor{comment}{// g++-4.4 bench\_gemm.cpp -I .. -O2 -DNDEBUG -lrt -fopenmp && OMP\_NUM\_THREADS=2  ./a.out}
00003 \textcolor{comment}{// icpc bench\_gemm.cpp -I .. -O3 -DNDEBUG -lrt -openmp  && OMP\_NUM\_THREADS=2  ./a.out}
00004 
00005 \textcolor{comment}{// Compilation options:}
00006 \textcolor{comment}{// }
00007 \textcolor{comment}{// -DSCALAR=std::complex<double>}
00008 \textcolor{comment}{// -DSCALARA=double or -DSCALARB=double}
00009 \textcolor{comment}{// -DHAVE\_BLAS}
00010 \textcolor{comment}{// -DDECOUPLED}
00011 \textcolor{comment}{//}
00012 
00013 \textcolor{preprocessor}{#include <iostream>}
00014 \textcolor{preprocessor}{#include <Eigen/Core>}
00015 \textcolor{preprocessor}{#include <bench/BenchTimer.h>}
00016 
00017 \textcolor{keyword}{using namespace }\hyperlink{namespacestd}{std};
00018 \textcolor{keyword}{using namespace }\hyperlink{namespace_eigen}{Eigen};
00019 
00020 \textcolor{preprocessor}{#ifndef SCALAR}
00021 \textcolor{comment}{// #define SCALAR std::complex<float>}
00022 \textcolor{preprocessor}{#define SCALAR float}
00023 \textcolor{preprocessor}{#endif}
00024 
00025 \textcolor{preprocessor}{#ifndef SCALARA}
00026 \textcolor{preprocessor}{#define SCALARA SCALAR}
00027 \textcolor{preprocessor}{#endif}
00028 
00029 \textcolor{preprocessor}{#ifndef SCALARB}
00030 \textcolor{preprocessor}{#define SCALARB SCALAR}
00031 \textcolor{preprocessor}{#endif}
00032 
00033 \textcolor{keyword}{typedef} SCALAR Scalar;
00034 \textcolor{keyword}{typedef} \hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<Scalar>::Real} RealScalar;
00035 \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<SCALARA,Dynamic,Dynamic>} \hyperlink{group___core___module_class_eigen_1_1_matrix}{A};
00036 \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<SCALARB,Dynamic,Dynamic>} \hyperlink{group___core___module_class_eigen_1_1_matrix}{B};
00037 \textcolor{keyword}{typedef} \hyperlink{group___core___module}{Matrix<Scalar,Dynamic,Dynamic>} \hyperlink{group___core___module}{C};
00038 \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<RealScalar,Dynamic,Dynamic>} \hyperlink{group___core___module_class_eigen_1_1_matrix}{M};
00039 
00040 \textcolor{preprocessor}{#ifdef HAVE\_BLAS}
00041 
00042 \textcolor{keyword}{extern} \textcolor{stringliteral}{"C"} \{
00043 \textcolor{preprocessor}{  #include <Eigen/src/misc/blas.h>}
00044 \}
00045 
00046 \textcolor{keyword}{static} \textcolor{keywordtype}{float} fone = 1;
00047 \textcolor{keyword}{static} \textcolor{keywordtype}{float} fzero = 0;
00048 \textcolor{keyword}{static} \textcolor{keywordtype}{double} done = 1;
00049 \textcolor{keyword}{static} \textcolor{keywordtype}{double} szero = 0;
00050 \textcolor{keyword}{static} std::complex<float> cfone = 1;
00051 \textcolor{keyword}{static} std::complex<float> cfzero = 0;
00052 \textcolor{keyword}{static} std::complex<double> cdone = 1;
00053 \textcolor{keyword}{static} std::complex<double> cdzero = 0;
00054 \textcolor{keyword}{static} \textcolor{keywordtype}{char} notrans = \textcolor{charliteral}{'N'};
00055 \textcolor{keyword}{static} \textcolor{keywordtype}{char} trans = \textcolor{charliteral}{'T'};  
00056 \textcolor{keyword}{static} \textcolor{keywordtype}{char} nonunit = \textcolor{charliteral}{'N'};
00057 \textcolor{keyword}{static} \textcolor{keywordtype}{char} lower = \textcolor{charliteral}{'L'};
00058 \textcolor{keyword}{static} \textcolor{keywordtype}{char} right = \textcolor{charliteral}{'R'};
00059 \textcolor{keyword}{static} \textcolor{keywordtype}{int} intone = 1;
00060 
00061 \textcolor{keywordtype}{void} blas\_gemm(\textcolor{keyword}{const} MatrixXf& a, \textcolor{keyword}{const} MatrixXf& b, MatrixXf& c)
00062 \{
00063   \textcolor{keywordtype}{int} \hyperlink{group___core___module_class_eigen_1_1_matrix}{M} = c.rows(); \textcolor{keywordtype}{int} N = c.cols(); \textcolor{keywordtype}{int} K = a.cols();
00064   \textcolor{keywordtype}{int} lda = a.rows(); \textcolor{keywordtype}{int} ldb = b.rows(); \textcolor{keywordtype}{int} ldc = c.rows();
00065 
00066   sgemm\_(&notrans,&notrans,&M,&N,&K,&fone,
00067          const\_cast<float*>(a.data()),&lda,
00068          const\_cast<float*>(b.data()),&ldb,&fone,
00069          c.data(),&ldc);
00070 \}
00071 
00072 EIGEN\_DONT\_INLINE \textcolor{keywordtype}{void} blas\_gemm(\textcolor{keyword}{const} MatrixXd& a, \textcolor{keyword}{const} MatrixXd& b, MatrixXd& c)
00073 \{
00074   \textcolor{keywordtype}{int} M = c.rows(); \textcolor{keywordtype}{int} N = c.cols(); \textcolor{keywordtype}{int} K = a.cols();
00075   \textcolor{keywordtype}{int} lda = a.rows(); \textcolor{keywordtype}{int} ldb = b.rows(); \textcolor{keywordtype}{int} ldc = c.rows();
00076 
00077   dgemm\_(&notrans,&notrans,&M,&N,&K,&done,
00078          const\_cast<double*>(a.data()),&lda,
00079          const\_cast<double*>(b.data()),&ldb,&done,
00080          c.data(),&ldc);
00081 \}
00082 
00083 \textcolor{keywordtype}{void} blas\_gemm(\textcolor{keyword}{const} MatrixXcf& a, \textcolor{keyword}{const} MatrixXcf& b, MatrixXcf& c)
00084 \{
00085   \textcolor{keywordtype}{int} M = c.rows(); \textcolor{keywordtype}{int} N = c.cols(); \textcolor{keywordtype}{int} K = a.cols();
00086   \textcolor{keywordtype}{int} lda = a.rows(); \textcolor{keywordtype}{int} ldb = b.rows(); \textcolor{keywordtype}{int} ldc = c.rows();
00087 
00088   cgemm\_(&notrans,&notrans,&M,&N,&K,(\textcolor{keywordtype}{float}*)&cfone,
00089          const\_cast<float*>((\textcolor{keyword}{const} \textcolor{keywordtype}{float}*)a.data()),&lda,
00090          const\_cast<float*>((\textcolor{keyword}{const} \textcolor{keywordtype}{float}*)b.data()),&ldb,(\textcolor{keywordtype}{float}*)&cfone,
00091          (\textcolor{keywordtype}{float}*)c.data(),&ldc);
00092 \}
00093 
00094 \textcolor{keywordtype}{void} blas\_gemm(\textcolor{keyword}{const} MatrixXcd& a, \textcolor{keyword}{const} MatrixXcd& b, MatrixXcd& c)
00095 \{
00096   \textcolor{keywordtype}{int} M = c.rows(); \textcolor{keywordtype}{int} N = c.cols(); \textcolor{keywordtype}{int} K = a.cols();
00097   \textcolor{keywordtype}{int} lda = a.rows(); \textcolor{keywordtype}{int} ldb = b.rows(); \textcolor{keywordtype}{int} ldc = c.rows();
00098 
00099   zgemm\_(&notrans,&notrans,&M,&N,&K,(\textcolor{keywordtype}{double}*)&cdone,
00100          const\_cast<double*>((\textcolor{keyword}{const} \textcolor{keywordtype}{double}*)a.data()),&lda,
00101          const\_cast<double*>((\textcolor{keyword}{const} \textcolor{keywordtype}{double}*)b.data()),&ldb,(\textcolor{keywordtype}{double}*)&cdone,
00102          (\textcolor{keywordtype}{double}*)c.data(),&ldc);
00103 \}
00104 
00105 
00106 
00107 \textcolor{preprocessor}{#endif}
00108 
00109 \textcolor{keywordtype}{void} matlab\_cplx\_cplx(\textcolor{keyword}{const} M& ar, \textcolor{keyword}{const} M& ai, \textcolor{keyword}{const} M& br, \textcolor{keyword}{const} M& bi, M& cr, M& ci)
00110 \{
00111   cr.noalias() += ar * br;
00112   cr.noalias() -= ai * bi;
00113   ci.noalias() += ar * bi;
00114   ci.noalias() += ai * br;
00115 \}
00116 
00117 \textcolor{keywordtype}{void} matlab\_real\_cplx(\textcolor{keyword}{const} M& a, \textcolor{keyword}{const} M& br, \textcolor{keyword}{const} M& bi, M& cr, M& ci)
00118 \{
00119   cr.noalias() += a * br;
00120   ci.noalias() += a * bi;
00121 \}
00122 
00123 \textcolor{keywordtype}{void} matlab\_cplx\_real(\textcolor{keyword}{const} M& ar, \textcolor{keyword}{const} M& ai, \textcolor{keyword}{const} M& b, M& cr, M& ci)
00124 \{
00125   cr.noalias() += ar * b;
00126   ci.noalias() += ai * b;
00127 \}
00128 
00129 \textcolor{keyword}{template}<\textcolor{keyword}{typename} A, \textcolor{keyword}{typename} B, \textcolor{keyword}{typename} C>
00130 EIGEN\_DONT\_INLINE \textcolor{keywordtype}{void} gemm(\textcolor{keyword}{const} \hyperlink{group___core___module_class_eigen_1_1_matrix}{A}& a, \textcolor{keyword}{const} \hyperlink{group___core___module_class_eigen_1_1_matrix}{B}& b, \hyperlink{group___core___module}{C}& c)
00131 \{
00132  c.noalias() += a * b;
00133 \}
00134 
00135 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} ** argv)
00136 \{
00137   std::ptrdiff\_t l1 = internal::queryL1CacheSize();
00138   std::ptrdiff\_t l2 = internal::queryTopLevelCacheSize();
00139   std::cout << \textcolor{stringliteral}{"L1 cache size     = "} << (l1>0 ? l1/1024 : -1) << \textcolor{stringliteral}{" KB\(\backslash\)n"};
00140   std::cout << \textcolor{stringliteral}{"L2/L3 cache size  = "} << (l2>0 ? l2/1024 : -1) << \textcolor{stringliteral}{" KB\(\backslash\)n"};
00141   \textcolor{keyword}{typedef} internal::gebp\_traits<Scalar,Scalar> Traits;
00142   std::cout << \textcolor{stringliteral}{"Register blocking = "} << Traits::mr << \textcolor{stringliteral}{" x "} << Traits::nr << \textcolor{stringliteral}{"\(\backslash\)n"};
00143 
00144   \textcolor{keywordtype}{int} rep = 1;    \textcolor{comment}{// number of repetitions per try}
00145   \textcolor{keywordtype}{int} tries = 2;  \textcolor{comment}{// number of tries, we keep the best}
00146 
00147   \textcolor{keywordtype}{int} s = 2048;
00148   \textcolor{keywordtype}{int} m = s;
00149   \textcolor{keywordtype}{int} n = s;
00150   \textcolor{keywordtype}{int} p = s;
00151   \textcolor{keywordtype}{int} cache\_size1=-1, cache\_size2=l2, cache\_size3 = 0;
00152 
00153   \textcolor{keywordtype}{bool} need\_help = \textcolor{keyword}{false};
00154   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=1; i<argc;)
00155   \{
00156     \textcolor{keywordflow}{if}(argv[i][0]==\textcolor{charliteral}{'-'})
00157     \{
00158       \textcolor{keywordflow}{if}(argv[i][1]==\textcolor{charliteral}{'s'})
00159       \{
00160         ++i;
00161         s = atoi(argv[i++]);
00162         m = n = p = s;
00163         \textcolor{keywordflow}{if}(argv[i][0]!=\textcolor{charliteral}{'-'})
00164         \{
00165           n = atoi(argv[i++]);
00166           p = atoi(argv[i++]);
00167         \}
00168       \}
00169       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(argv[i][1]==\textcolor{charliteral}{'c'})
00170       \{
00171         ++i;
00172         cache\_size1 = atoi(argv[i++]);
00173         \textcolor{keywordflow}{if}(argv[i][0]!=\textcolor{charliteral}{'-'})
00174         \{
00175           cache\_size2 = atoi(argv[i++]);
00176           \textcolor{keywordflow}{if}(argv[i][0]!=\textcolor{charliteral}{'-'})
00177             cache\_size3 = atoi(argv[i++]);
00178         \}
00179       \}
00180       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(argv[i][1]==\textcolor{charliteral}{'t'})
00181       \{
00182         ++i;
00183         tries = atoi(argv[i++]);
00184       \}
00185       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(argv[i][1]==\textcolor{charliteral}{'p'})
00186       \{
00187         ++i;
00188         rep = atoi(argv[i++]);
00189       \}
00190     \}
00191     \textcolor{keywordflow}{else}
00192     \{
00193       need\_help = \textcolor{keyword}{true};
00194       \textcolor{keywordflow}{break};
00195     \}
00196   \}
00197 
00198   \textcolor{keywordflow}{if}(need\_help)
00199   \{
00200     std::cout << argv[0] << \textcolor{stringliteral}{" -s <matrix sizes> -c <cache sizes> -t <nb tries> -p <nb repeats>\(\backslash\)n"};
00201     std::cout << \textcolor{stringliteral}{"   <matrix sizes> : size\(\backslash\)n"};
00202     std::cout << \textcolor{stringliteral}{"   <matrix sizes> : rows columns depth\(\backslash\)n"};
00203     \textcolor{keywordflow}{return} 1;
00204   \}
00205 
00206 \textcolor{preprocessor}{#if EIGEN\_VERSION\_AT\_LEAST(3,2,90)}
00207   \textcolor{keywordflow}{if}(cache\_size1>0)
00208     \hyperlink{namespace_eigen_ae64421554aa0a4bf9258bafe3170102b}{setCpuCacheSizes}(cache\_size1,cache\_size2,cache\_size3);
00209 \textcolor{preprocessor}{#endif}
00210   
00211   \hyperlink{group___core___module_class_eigen_1_1_matrix}{A} a(m,p); a.\hyperlink{class_eigen_1_1_plain_object_base_af0e576a0e1aefc9ee346de44cc352ba3}{setRandom}();
00212   \hyperlink{group___core___module_class_eigen_1_1_matrix}{B} b(p,n); b.\hyperlink{class_eigen_1_1_plain_object_base_af0e576a0e1aefc9ee346de44cc352ba3}{setRandom}();
00213   \hyperlink{group___core___module}{C} c(m,n); c.\hyperlink{class_eigen_1_1_plain_object_base_a2871e88e1feb1cc665fa1f1cc800078b}{setOnes}();
00214   \hyperlink{group___core___module}{C} rc = c;
00215 
00216   std::cout << \textcolor{stringliteral}{"Matrix sizes = "} << m << \textcolor{stringliteral}{"x"} << p << \textcolor{stringliteral}{" * "} << p << \textcolor{stringliteral}{"x"} << n << \textcolor{stringliteral}{"\(\backslash\)n"};
00217   std::ptrdiff\_t mc(m), nc(n), kc(p);
00218   internal::computeProductBlockingSizes<Scalar,Scalar>(kc, mc, nc);
00219   std::cout << \textcolor{stringliteral}{"blocking size (mc x kc) = "} << mc << \textcolor{stringliteral}{" x "} << kc << \textcolor{stringliteral}{"\(\backslash\)n"};
00220 
00221   \hyperlink{group___core___module}{C} r = c;
00222 
00223   \textcolor{comment}{// check the parallel product is correct}
00224 \textcolor{preprocessor}{  #if defined EIGEN\_HAS\_OPENMP}
00225   \hyperlink{namespace_eigen_a820c0e0460934cc17eb6dacbad54a9f5}{Eigen::initParallel}();
00226   \textcolor{keywordtype}{int} procs = omp\_get\_max\_threads();
00227   \textcolor{keywordflow}{if}(procs>1)
00228   \{
00229 \textcolor{preprocessor}{    #ifdef HAVE\_BLAS}
00230     blas\_gemm(a,b,r);
00231 \textcolor{preprocessor}{    #else}
00232     omp\_set\_num\_threads(1);
00233     r.noalias() += a * b;
00234     omp\_set\_num\_threads(procs);
00235 \textcolor{preprocessor}{    #endif}
00236     c.noalias() += a * b;
00237     \textcolor{keywordflow}{if}(!r.isApprox(c)) std::cerr << \textcolor{stringliteral}{"Warning, your parallel product is crap!\(\backslash\)n\(\backslash\)n"};
00238   \}
00239 \textcolor{preprocessor}{  #elif defined HAVE\_BLAS}
00240     blas\_gemm(a,b,r);
00241     c.noalias() += a * b;
00242     \textcolor{keywordflow}{if}(!r.isApprox(c)) \{
00243       std::cout << r  - c << \textcolor{stringliteral}{"\(\backslash\)n"};
00244       std::cerr << \textcolor{stringliteral}{"Warning, your product is crap!\(\backslash\)n\(\backslash\)n"};
00245     \}
00246 \textcolor{preprocessor}{  #else}
00247     \textcolor{keywordflow}{if}(1.*m*n*p<2000.*2000*2000)
00248     \{
00249       gemm(a,b,c);
00250       r.noalias() += a.cast<Scalar>() .lazyProduct( b.cast<Scalar>() );
00251       \textcolor{keywordflow}{if}(!r.isApprox(c)) \{
00252         std::cout << r - c << \textcolor{stringliteral}{"\(\backslash\)n"};
00253         std::cerr << \textcolor{stringliteral}{"Warning, your product is crap!\(\backslash\)n\(\backslash\)n"};
00254       \}
00255     \}
00256 \textcolor{preprocessor}{  #endif}
00257 
00258 \textcolor{preprocessor}{  #ifdef HAVE\_BLAS}
00259   \hyperlink{class_eigen_1_1_bench_timer}{BenchTimer} tblas;
00260   c = rc;
00261   BENCH(tblas, tries, rep, blas\_gemm(a,b,c));
00262   std::cout << \textcolor{stringliteral}{"blas  cpu         "} << tblas.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(CPU\_TIMER)/rep  << \textcolor{stringliteral}{"s  \(\backslash\)t"} << (double(m)*n*p*rep*2/
      tblas.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(CPU\_TIMER))*1e-9  <<  \textcolor{stringliteral}{" GFLOPS \(\backslash\)t("} << tblas.\hyperlink{class_eigen_1_1_bench_timer_af341aa613dba2d4a3d167093197e4e7a}{total}(CPU\_TIMER)  << \textcolor{stringliteral}{"s)\(\backslash\)n"};
00263   std::cout << \textcolor{stringliteral}{"blas  real        "} << tblas.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(REAL\_TIMER)/rep << \textcolor{stringliteral}{"s  \(\backslash\)t"} << (double(m)*n*p*rep*2/
      tblas.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(REAL\_TIMER))*1e-9 <<  \textcolor{stringliteral}{" GFLOPS \(\backslash\)t("} << tblas.\hyperlink{class_eigen_1_1_bench_timer_af341aa613dba2d4a3d167093197e4e7a}{total}(REAL\_TIMER) << \textcolor{stringliteral}{"s)\(\backslash\)n"};
00264 \textcolor{preprocessor}{  #endif}
00265 
00266   \hyperlink{class_eigen_1_1_bench_timer}{BenchTimer} tmt;
00267   c = rc;
00268   BENCH(tmt, tries, rep, gemm(a,b,c));
00269   std::cout << \textcolor{stringliteral}{"eigen cpu         "} << tmt.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(CPU\_TIMER)/rep  << \textcolor{stringliteral}{"s  \(\backslash\)t"} << (double(m)*n*p*rep*2/tmt.
      \hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(CPU\_TIMER))*1e-9  <<  \textcolor{stringliteral}{" GFLOPS \(\backslash\)t("} << tmt.\hyperlink{class_eigen_1_1_bench_timer_af341aa613dba2d4a3d167093197e4e7a}{total}(CPU\_TIMER)  << \textcolor{stringliteral}{"s)\(\backslash\)n"};
00270   std::cout << \textcolor{stringliteral}{"eigen real        "} << tmt.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(REAL\_TIMER)/rep << \textcolor{stringliteral}{"s  \(\backslash\)t"} << (double(m)*n*p*rep*2/tmt.
      \hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(REAL\_TIMER))*1e-9 <<  \textcolor{stringliteral}{" GFLOPS \(\backslash\)t("} << tmt.\hyperlink{class_eigen_1_1_bench_timer_af341aa613dba2d4a3d167093197e4e7a}{total}(REAL\_TIMER) << \textcolor{stringliteral}{"s)\(\backslash\)n"};
00271 
00272 \textcolor{preprocessor}{  #ifdef EIGEN\_HAS\_OPENMP}
00273   \textcolor{keywordflow}{if}(procs>1)
00274   \{
00275     \hyperlink{class_eigen_1_1_bench_timer}{BenchTimer} tmono;
00276     omp\_set\_num\_threads(1);
00277     \hyperlink{namespace_eigen_af9cd17c2fe18204239cd11c88c120b50}{Eigen::setNbThreads}(1);
00278     c = rc;
00279     BENCH(tmono, tries, rep, gemm(a,b,c));
00280     std::cout << \textcolor{stringliteral}{"eigen mono cpu    "} << tmono.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(CPU\_TIMER)/rep  << \textcolor{stringliteral}{"s  \(\backslash\)t"} << (double(m)*n*p*rep*2/
      tmono.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(CPU\_TIMER))*1e-9  <<  \textcolor{stringliteral}{" GFLOPS \(\backslash\)t("} << tmono.\hyperlink{class_eigen_1_1_bench_timer_af341aa613dba2d4a3d167093197e4e7a}{total}(CPU\_TIMER)  << \textcolor{stringliteral}{"s)\(\backslash\)n"};
00281     std::cout << \textcolor{stringliteral}{"eigen mono real   "} << tmono.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(REAL\_TIMER)/rep << \textcolor{stringliteral}{"s  \(\backslash\)t"} << (double(m)*n*p*rep*2/
      tmono.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(REAL\_TIMER))*1e-9 <<  \textcolor{stringliteral}{" GFLOPS \(\backslash\)t("} << tmono.\hyperlink{class_eigen_1_1_bench_timer_af341aa613dba2d4a3d167093197e4e7a}{total}(REAL\_TIMER) << \textcolor{stringliteral}{"s)\(\backslash\)n"};
00282     std::cout << \textcolor{stringliteral}{"mt speed up x"} << tmono.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(CPU\_TIMER) / tmt.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(REAL\_TIMER)  << \textcolor{stringliteral}{" => "} << (100
      .0*tmono.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(CPU\_TIMER) / tmt.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(REAL\_TIMER))/procs << \textcolor{stringliteral}{"%\(\backslash\)n"};
00283   \}
00284 \textcolor{preprocessor}{  #endif}
00285   
00286   \textcolor{keywordflow}{if}(1.*m*n*p<30*30*30)
00287   \{
00288       \hyperlink{class_eigen_1_1_bench_timer}{BenchTimer} tmt;
00289       c = rc;
00290       BENCH(tmt, tries, rep, c.noalias()+=a.lazyProduct(b));
00291       std::cout << \textcolor{stringliteral}{"lazy cpu         "} << tmt.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(CPU\_TIMER)/rep  << \textcolor{stringliteral}{"s  \(\backslash\)t"} << (double(m)*n*p*rep*2/
      tmt.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(CPU\_TIMER))*1e-9  <<  \textcolor{stringliteral}{" GFLOPS \(\backslash\)t("} << tmt.\hyperlink{class_eigen_1_1_bench_timer_af341aa613dba2d4a3d167093197e4e7a}{total}(CPU\_TIMER)  << \textcolor{stringliteral}{"s)\(\backslash\)n"};
00292       std::cout << \textcolor{stringliteral}{"lazy real        "} << tmt.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(REAL\_TIMER)/rep << \textcolor{stringliteral}{"s  \(\backslash\)t"} << (double(m)*n*p*rep*2/
      tmt.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(REAL\_TIMER))*1e-9 <<  \textcolor{stringliteral}{" GFLOPS \(\backslash\)t("} << tmt.\hyperlink{class_eigen_1_1_bench_timer_af341aa613dba2d4a3d167093197e4e7a}{total}(REAL\_TIMER) << \textcolor{stringliteral}{"s)\(\backslash\)n"};
00293   \}
00294   
00295 \textcolor{preprocessor}{  #ifdef DECOUPLED}
00296   \textcolor{keywordflow}{if}((\hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<A::Scalar>::IsComplex}) && (
      \hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<B::Scalar>::IsComplex}))
00297   \{
00298     M ar(m,p); ar.\hyperlink{class_eigen_1_1_plain_object_base_af0e576a0e1aefc9ee346de44cc352ba3}{setRandom}();
00299     M ai(m,p); ai.\hyperlink{class_eigen_1_1_plain_object_base_af0e576a0e1aefc9ee346de44cc352ba3}{setRandom}();
00300     M br(p,n); br.setRandom();
00301     M bi(p,n); bi.\hyperlink{class_eigen_1_1_plain_object_base_af0e576a0e1aefc9ee346de44cc352ba3}{setRandom}();
00302     M cr(m,n); cr.\hyperlink{class_eigen_1_1_plain_object_base_af0e576a0e1aefc9ee346de44cc352ba3}{setRandom}();
00303     M ci(m,n); ci.\hyperlink{class_eigen_1_1_plain_object_base_af0e576a0e1aefc9ee346de44cc352ba3}{setRandom}();
00304     
00305     \hyperlink{class_eigen_1_1_bench_timer}{BenchTimer} t;
00306     BENCH(t, tries, rep, matlab\_cplx\_cplx(ar,ai,br,bi,cr,ci));
00307     std::cout << \textcolor{stringliteral}{"\(\backslash\)"matlab\(\backslash\)" cpu    "} << t.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(CPU\_TIMER)/rep  << \textcolor{stringliteral}{"s  \(\backslash\)t"} << (double(m)*n*p*rep*2/t.
      \hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(CPU\_TIMER))*1e-9  <<  \textcolor{stringliteral}{" GFLOPS \(\backslash\)t("} << t.\hyperlink{class_eigen_1_1_bench_timer_af341aa613dba2d4a3d167093197e4e7a}{total}(CPU\_TIMER)  << \textcolor{stringliteral}{"s)\(\backslash\)n"};
00308     std::cout << \textcolor{stringliteral}{"\(\backslash\)"matlab\(\backslash\)" real   "} << t.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(REAL\_TIMER)/rep << \textcolor{stringliteral}{"s  \(\backslash\)t"} << (double(m)*n*p*rep*2/t.
      \hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(REAL\_TIMER))*1e-9 <<  \textcolor{stringliteral}{" GFLOPS \(\backslash\)t("} << t.\hyperlink{class_eigen_1_1_bench_timer_af341aa613dba2d4a3d167093197e4e7a}{total}(REAL\_TIMER) << \textcolor{stringliteral}{"s)\(\backslash\)n"};
00309   \}
00310   \textcolor{keywordflow}{if}((!\hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<A::Scalar>::IsComplex}) && (
      \hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<B::Scalar>::IsComplex}))
00311   \{
00312     M a(m,p);  a.\hyperlink{class_eigen_1_1_plain_object_base_af0e576a0e1aefc9ee346de44cc352ba3}{setRandom}();
00313     M br(p,n); br.setRandom();
00314     M bi(p,n); bi.\hyperlink{class_eigen_1_1_plain_object_base_af0e576a0e1aefc9ee346de44cc352ba3}{setRandom}();
00315     M cr(m,n); cr.\hyperlink{class_eigen_1_1_plain_object_base_af0e576a0e1aefc9ee346de44cc352ba3}{setRandom}();
00316     M ci(m,n); ci.\hyperlink{class_eigen_1_1_plain_object_base_af0e576a0e1aefc9ee346de44cc352ba3}{setRandom}();
00317     
00318     \hyperlink{class_eigen_1_1_bench_timer}{BenchTimer} t;
00319     BENCH(t, tries, rep, matlab\_real\_cplx(a,br,bi,cr,ci));
00320     std::cout << \textcolor{stringliteral}{"\(\backslash\)"matlab\(\backslash\)" cpu    "} << t.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(CPU\_TIMER)/rep  << \textcolor{stringliteral}{"s  \(\backslash\)t"} << (double(m)*n*p*rep*2/t.
      \hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(CPU\_TIMER))*1e-9  <<  \textcolor{stringliteral}{" GFLOPS \(\backslash\)t("} << t.\hyperlink{class_eigen_1_1_bench_timer_af341aa613dba2d4a3d167093197e4e7a}{total}(CPU\_TIMER)  << \textcolor{stringliteral}{"s)\(\backslash\)n"};
00321     std::cout << \textcolor{stringliteral}{"\(\backslash\)"matlab\(\backslash\)" real   "} << t.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(REAL\_TIMER)/rep << \textcolor{stringliteral}{"s  \(\backslash\)t"} << (double(m)*n*p*rep*2/t.
      \hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(REAL\_TIMER))*1e-9 <<  \textcolor{stringliteral}{" GFLOPS \(\backslash\)t("} << t.\hyperlink{class_eigen_1_1_bench_timer_af341aa613dba2d4a3d167093197e4e7a}{total}(REAL\_TIMER) << \textcolor{stringliteral}{"s)\(\backslash\)n"};
00322   \}
00323   \textcolor{keywordflow}{if}((\hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<A::Scalar>::IsComplex}) && (!
      \hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<B::Scalar>::IsComplex}))
00324   \{
00325     M ar(m,p); ar.\hyperlink{class_eigen_1_1_plain_object_base_af0e576a0e1aefc9ee346de44cc352ba3}{setRandom}();
00326     M ai(m,p); ai.\hyperlink{class_eigen_1_1_plain_object_base_af0e576a0e1aefc9ee346de44cc352ba3}{setRandom}();
00327     M b(p,n);  b.setRandom();
00328     M cr(m,n); cr.\hyperlink{class_eigen_1_1_plain_object_base_af0e576a0e1aefc9ee346de44cc352ba3}{setRandom}();
00329     M ci(m,n); ci.\hyperlink{class_eigen_1_1_plain_object_base_af0e576a0e1aefc9ee346de44cc352ba3}{setRandom}();
00330     
00331     \hyperlink{class_eigen_1_1_bench_timer}{BenchTimer} t;
00332     BENCH(t, tries, rep, matlab\_cplx\_real(ar,ai,b,cr,ci));
00333     std::cout << \textcolor{stringliteral}{"\(\backslash\)"matlab\(\backslash\)" cpu    "} << t.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(CPU\_TIMER)/rep  << \textcolor{stringliteral}{"s  \(\backslash\)t"} << (double(m)*n*p*rep*2/t.
      \hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(CPU\_TIMER))*1e-9  <<  \textcolor{stringliteral}{" GFLOPS \(\backslash\)t("} << t.\hyperlink{class_eigen_1_1_bench_timer_af341aa613dba2d4a3d167093197e4e7a}{total}(CPU\_TIMER)  << \textcolor{stringliteral}{"s)\(\backslash\)n"};
00334     std::cout << \textcolor{stringliteral}{"\(\backslash\)"matlab\(\backslash\)" real   "} << t.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(REAL\_TIMER)/rep << \textcolor{stringliteral}{"s  \(\backslash\)t"} << (double(m)*n*p*rep*2/t.
      \hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}(REAL\_TIMER))*1e-9 <<  \textcolor{stringliteral}{" GFLOPS \(\backslash\)t("} << t.\hyperlink{class_eigen_1_1_bench_timer_af341aa613dba2d4a3d167093197e4e7a}{total}(REAL\_TIMER) << \textcolor{stringliteral}{"s)\(\backslash\)n"};
00335   \}
00336 \textcolor{preprocessor}{  #endif}
00337 
00338   \textcolor{keywordflow}{return} 0;
00339 \}
00340 
\end{DoxyCode}
