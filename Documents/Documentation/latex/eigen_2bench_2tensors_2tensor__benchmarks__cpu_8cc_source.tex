\hypertarget{eigen_2bench_2tensors_2tensor__benchmarks__cpu_8cc_source}{}\section{eigen/bench/tensors/tensor\+\_\+benchmarks\+\_\+cpu.cc}
\label{eigen_2bench_2tensors_2tensor__benchmarks__cpu_8cc_source}\index{tensor\+\_\+benchmarks\+\_\+cpu.\+cc@{tensor\+\_\+benchmarks\+\_\+cpu.\+cc}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#define EIGEN\_USE\_THREADS}
00002 
00003 \textcolor{preprocessor}{#include <string>}
00004 
00005 \textcolor{preprocessor}{#include "tensor\_benchmarks.h"}
00006 
00007 \textcolor{preprocessor}{#define CREATE\_THREAD\_POOL(threads)             \(\backslash\)}
00008 \textcolor{preprocessor}{Eigen::ThreadPool pool(threads);                \(\backslash\)}
00009 \textcolor{preprocessor}{Eigen::ThreadPoolDevice device(&pool, threads);}
00010 
00011 \textcolor{comment}{// Simple functions}
00012 \textcolor{preprocessor}{#define BM\_FuncCPU(FUNC, THREADS)                                    \(\backslash\)}
00013 \textcolor{preprocessor}{  static void BM\_##FUNC##\_##THREADS##T(int iters, int N) \{           \(\backslash\)}
00014 \textcolor{preprocessor}{    StopBenchmarkTiming();                                           \(\backslash\)}
00015 \textcolor{preprocessor}{    CREATE\_THREAD\_POOL(THREADS);                                     \(\backslash\)}
00016 \textcolor{preprocessor}{    BenchmarkSuite<Eigen::ThreadPoolDevice, float> suite(device, N); \(\backslash\)}
00017 \textcolor{preprocessor}{    suite.FUNC(iters);                                               \(\backslash\)}
00018 \textcolor{preprocessor}{  \}                                                                  \(\backslash\)}
00019 \textcolor{preprocessor}{  BENCHMARK\_RANGE(BM\_##FUNC##\_##THREADS##T, 10, 5000);}
00020 
00021 BM\_FuncCPU(memcpy, 4);
00022 BM\_FuncCPU(memcpy, 8);
00023 BM\_FuncCPU(memcpy, 12);
00024 
00025 BM\_FuncCPU(typeCasting, 4);
00026 BM\_FuncCPU(typeCasting, 8);
00027 BM\_FuncCPU(typeCasting, 12);
00028 
00029 BM\_FuncCPU(random, 4);
00030 BM\_FuncCPU(random, 8);
00031 BM\_FuncCPU(random, 12);
00032 
00033 BM\_FuncCPU(slicing, 4);
00034 BM\_FuncCPU(slicing, 8);
00035 BM\_FuncCPU(slicing, 12);
00036 
00037 BM\_FuncCPU(rowChip, 4);
00038 BM\_FuncCPU(rowChip, 8);
00039 BM\_FuncCPU(rowChip, 12);
00040 
00041 BM\_FuncCPU(colChip, 4);
00042 BM\_FuncCPU(colChip, 8);
00043 BM\_FuncCPU(colChip, 12);
00044 
00045 BM\_FuncCPU(shuffling, 4);
00046 BM\_FuncCPU(shuffling, 8);
00047 BM\_FuncCPU(shuffling, 12);
00048 
00049 BM\_FuncCPU(padding, 4);
00050 BM\_FuncCPU(padding, 8);
00051 BM\_FuncCPU(padding, 12);
00052 
00053 BM\_FuncCPU(striding, 4);
00054 BM\_FuncCPU(striding, 8);
00055 BM\_FuncCPU(striding, 12);
00056 
00057 BM\_FuncCPU(broadcasting, 4);
00058 BM\_FuncCPU(broadcasting, 8);
00059 BM\_FuncCPU(broadcasting, 12);
00060 
00061 BM\_FuncCPU(coeffWiseOp, 4);
00062 BM\_FuncCPU(coeffWiseOp, 8);
00063 BM\_FuncCPU(coeffWiseOp, 12);
00064 
00065 BM\_FuncCPU(algebraicFunc, 4);
00066 BM\_FuncCPU(algebraicFunc, 8);
00067 BM\_FuncCPU(algebraicFunc, 12);
00068 
00069 BM\_FuncCPU(transcendentalFunc, 4);
00070 BM\_FuncCPU(transcendentalFunc, 8);
00071 BM\_FuncCPU(transcendentalFunc, 12);
00072 
00073 BM\_FuncCPU(rowReduction, 4);
00074 BM\_FuncCPU(rowReduction, 8);
00075 BM\_FuncCPU(rowReduction, 12);
00076 
00077 BM\_FuncCPU(colReduction, 4);
00078 BM\_FuncCPU(colReduction, 8);
00079 BM\_FuncCPU(colReduction, 12);
00080 
00081 
00082 \textcolor{comment}{// Contractions}
00083 \textcolor{preprocessor}{#define BM\_FuncWithInputDimsCPU(FUNC, D1, D2, D3, THREADS)                      \(\backslash\)}
00084 \textcolor{preprocessor}{  static void BM\_##FUNC##\_##D1##x##D2##x##D3##\_##THREADS##T(int iters, int N) \{ \(\backslash\)}
00085 \textcolor{preprocessor}{    StopBenchmarkTiming();                                                      \(\backslash\)}
00086 \textcolor{preprocessor}{    if (THREADS == 1) \{                                                         \(\backslash\)}
00087 \textcolor{preprocessor}{      Eigen::DefaultDevice device;                                              \(\backslash\)}
00088 \textcolor{preprocessor}{      BenchmarkSuite<Eigen::DefaultDevice, float> suite(device, D1, D2, D3);    \(\backslash\)}
00089 \textcolor{preprocessor}{      suite.FUNC(iters);                                                        \(\backslash\)}
00090 \textcolor{preprocessor}{    \} else \{                                                                    \(\backslash\)}
00091 \textcolor{preprocessor}{      CREATE\_THREAD\_POOL(THREADS);                                              \(\backslash\)}
00092 \textcolor{preprocessor}{      BenchmarkSuite<Eigen::ThreadPoolDevice, float> suite(device, D1, D2, D3); \(\backslash\)}
00093 \textcolor{preprocessor}{      suite.FUNC(iters);                                                        \(\backslash\)}
00094 \textcolor{preprocessor}{    \}                                                                           \(\backslash\)}
00095 \textcolor{preprocessor}{  \}                                                                             \(\backslash\)}
00096 \textcolor{preprocessor}{  BENCHMARK\_RANGE(BM\_##FUNC##\_##D1##x##D2##x##D3##\_##THREADS##T, 10, 5000);}
00097 
00098 
00099 BM\_FuncWithInputDimsCPU(contraction, N, N, N, 1);
00100 BM\_FuncWithInputDimsCPU(contraction, N, N, N, 4);
00101 BM\_FuncWithInputDimsCPU(contraction, N, N, N, 8);
00102 BM\_FuncWithInputDimsCPU(contraction, N, N, N, 12);
00103 BM\_FuncWithInputDimsCPU(contraction, N, N, N, 16);
00104 
00105 BM\_FuncWithInputDimsCPU(contraction, 64, N, N, 1);
00106 BM\_FuncWithInputDimsCPU(contraction, 64, N, N, 4);
00107 BM\_FuncWithInputDimsCPU(contraction, 64, N, N, 8);
00108 BM\_FuncWithInputDimsCPU(contraction, 64, N, N, 12);
00109 BM\_FuncWithInputDimsCPU(contraction, 64, N, N, 16);
00110 
00111 BM\_FuncWithInputDimsCPU(contraction, N, 64, N, 1);
00112 BM\_FuncWithInputDimsCPU(contraction, N, 64, N, 4);
00113 BM\_FuncWithInputDimsCPU(contraction, N, 64, N, 8);
00114 BM\_FuncWithInputDimsCPU(contraction, N, 64, N, 12);
00115 BM\_FuncWithInputDimsCPU(contraction, N, 64, N, 16);
00116 
00117 BM\_FuncWithInputDimsCPU(contraction, N, N, 64, 1);
00118 BM\_FuncWithInputDimsCPU(contraction, N, N, 64, 4);
00119 BM\_FuncWithInputDimsCPU(contraction, N, N, 64, 8);
00120 BM\_FuncWithInputDimsCPU(contraction, N, N, 64, 12);
00121 BM\_FuncWithInputDimsCPU(contraction, N, N, 64, 16);
00122 
00123 BM\_FuncWithInputDimsCPU(contraction, 1, N, N, 1);
00124 BM\_FuncWithInputDimsCPU(contraction, 1, N, N, 4);
00125 BM\_FuncWithInputDimsCPU(contraction, 1, N, N, 8);
00126 BM\_FuncWithInputDimsCPU(contraction, 1, N, N, 12);
00127 BM\_FuncWithInputDimsCPU(contraction, 1, N, N, 16);
00128 
00129 BM\_FuncWithInputDimsCPU(contraction, N, N, 1, 1);
00130 BM\_FuncWithInputDimsCPU(contraction, N, N, 1, 4);
00131 BM\_FuncWithInputDimsCPU(contraction, N, N, 1, 8);
00132 BM\_FuncWithInputDimsCPU(contraction, N, N, 1, 12);
00133 BM\_FuncWithInputDimsCPU(contraction, N, N, 1, 16);
00134 
00135 
00136 \textcolor{comment}{// Convolutions}
00137 \textcolor{preprocessor}{#define BM\_FuncWithKernelDimsCPU(FUNC, DIM1, DIM2, THREADS)                    \(\backslash\)}
00138 \textcolor{preprocessor}{  static void BM\_##FUNC##\_##DIM1##x##DIM2##\_##THREADS##T(int iters, int N) \{   \(\backslash\)}
00139 \textcolor{preprocessor}{    StopBenchmarkTiming();                                                     \(\backslash\)}
00140 \textcolor{preprocessor}{    CREATE\_THREAD\_POOL(THREADS);                                               \(\backslash\)}
00141 \textcolor{preprocessor}{    BenchmarkSuite<Eigen::ThreadPoolDevice, float> suite(device, N);           \(\backslash\)}
00142 \textcolor{preprocessor}{    suite.FUNC(iters, DIM1, DIM2);                                             \(\backslash\)}
00143 \textcolor{preprocessor}{  \}                                                                            \(\backslash\)}
00144 \textcolor{preprocessor}{  BENCHMARK\_RANGE(BM\_##FUNC##\_##DIM1##x##DIM2##\_##THREADS##T, 128, 5000);}
00145 
00146 BM\_FuncWithKernelDimsCPU(convolution, 7, 1, 4);
00147 BM\_FuncWithKernelDimsCPU(convolution, 7, 1, 8);
00148 BM\_FuncWithKernelDimsCPU(convolution, 7, 1, 12);
00149 
00150 BM\_FuncWithKernelDimsCPU(convolution, 1, 7, 4);
00151 BM\_FuncWithKernelDimsCPU(convolution, 1, 7, 8);
00152 BM\_FuncWithKernelDimsCPU(convolution, 1, 7, 12);
00153 
00154 BM\_FuncWithKernelDimsCPU(convolution, 7, 4, 4);
00155 BM\_FuncWithKernelDimsCPU(convolution, 7, 4, 8);
00156 BM\_FuncWithKernelDimsCPU(convolution, 7, 4, 12);
00157 
00158 BM\_FuncWithKernelDimsCPU(convolution, 4, 7, 4);
00159 BM\_FuncWithKernelDimsCPU(convolution, 4, 7, 8);
00160 BM\_FuncWithKernelDimsCPU(convolution, 4, 7, 12);
00161 
00162 BM\_FuncWithKernelDimsCPU(convolution, 7, 64, 4);
00163 BM\_FuncWithKernelDimsCPU(convolution, 7, 64, 8);
00164 BM\_FuncWithKernelDimsCPU(convolution, 7, 64, 12);
00165 
00166 BM\_FuncWithKernelDimsCPU(convolution, 64, 7, 4);
00167 BM\_FuncWithKernelDimsCPU(convolution, 64, 7, 8);
00168 BM\_FuncWithKernelDimsCPU(convolution, 64, 7, 12);
\end{DoxyCode}
