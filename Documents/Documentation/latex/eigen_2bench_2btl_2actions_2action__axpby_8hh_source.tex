\hypertarget{eigen_2bench_2btl_2actions_2action__axpby_8hh_source}{}\section{eigen/bench/btl/actions/action\+\_\+axpby.hh}
\label{eigen_2bench_2btl_2actions_2action__axpby_8hh_source}\index{action\+\_\+axpby.\+hh@{action\+\_\+axpby.\+hh}}

\begin{DoxyCode}
00001 \textcolor{comment}{//=====================================================}
00002 \textcolor{comment}{// File   :  action\_axpby.hh}
00003 \textcolor{comment}{// Copyright (C) 2008 Gael Guennebaud <gael.guennebaud@inria.fr>}
00004 \textcolor{comment}{//=====================================================}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This program is free software; you can redistribute it and/or}
00007 \textcolor{comment}{// modify it under the terms of the GNU General Public License}
00008 \textcolor{comment}{// as published by the Free Software Foundation; either version 2}
00009 \textcolor{comment}{// of the License, or (at your option) any later version.}
00010 \textcolor{comment}{//}
00011 \textcolor{comment}{// This program is distributed in the hope that it will be useful,}
00012 \textcolor{comment}{// but WITHOUT ANY WARRANTY; without even the implied warranty of}
00013 \textcolor{comment}{// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00014 \textcolor{comment}{// GNU General Public License for more details.}
00015 \textcolor{comment}{// You should have received a copy of the GNU General Public License}
00016 \textcolor{comment}{// along with this program; if not, write to the Free Software}
00017 \textcolor{comment}{// Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.}
00018 \textcolor{comment}{//}
00019 \textcolor{preprocessor}{#ifndef ACTION\_AXPBY}
00020 \textcolor{preprocessor}{#define ACTION\_AXPBY}
00021 \textcolor{preprocessor}{#include "utilities.h"}
00022 \textcolor{preprocessor}{#include "STL\_interface.hh"}
00023 \textcolor{preprocessor}{#include <string>}
00024 \textcolor{preprocessor}{#include "init/init\_function.hh"}
00025 \textcolor{preprocessor}{#include "init/init\_vector.hh"}
00026 \textcolor{preprocessor}{#include "init/init\_matrix.hh"}
00027 
00028 \textcolor{keyword}{using namespace }\hyperlink{namespacestd}{std};
00029 
00030 \textcolor{keyword}{template}<\textcolor{keyword}{class} Interface>
\Hypertarget{eigen_2bench_2btl_2actions_2action__axpby_8hh_source_l00031}\hyperlink{class_action__axpby}{00031} \textcolor{keyword}{class }\hyperlink{class_action__axpby}{Action\_axpby} \{
00032 
00033 public :
00034 
00035   \textcolor{comment}{// Ctor}
00036   \hyperlink{class_action__axpby}{Action\_axpby}( \textcolor{keywordtype}{int} size ):\_alpha(0.5),\_beta(0.95),\_size(size)
00037   \{
00038     MESSAGE(\textcolor{stringliteral}{"Action\_axpby Ctor"});
00039 
00040     \textcolor{comment}{// STL vector initialization}
00041     init\_vector<pseudo\_random>(X\_stl,\_size);
00042     init\_vector<pseudo\_random>(Y\_stl,\_size);
00043     init\_vector<null\_function>(resu\_stl,\_size);
00044 
00045     \textcolor{comment}{// generic matrix and vector initialization}
00046     Interface::vector\_from\_stl(X\_ref,X\_stl);
00047     Interface::vector\_from\_stl(Y\_ref,Y\_stl);
00048 
00049     Interface::vector\_from\_stl(X,X\_stl);
00050     Interface::vector\_from\_stl(Y,Y\_stl);
00051   \}
00052 
00053   \textcolor{comment}{// invalidate copy ctor}
00054   \hyperlink{class_action__axpby}{Action\_axpby}( \textcolor{keyword}{const}  \hyperlink{class_action__axpby}{Action\_axpby} & )
00055   \{
00056     INFOS(\textcolor{stringliteral}{"illegal call to Action\_axpby Copy Ctor"});
00057     exit(1);
00058   \}
00059 
00060   \textcolor{comment}{// Dtor}
00061   ~\hyperlink{class_action__axpby}{Action\_axpby}( \textcolor{keywordtype}{void} )\{
00062     MESSAGE(\textcolor{stringliteral}{"Action\_axpby Dtor"});
00063 
00064     \textcolor{comment}{// deallocation}
00065     Interface::free\_vector(X\_ref);
00066     Interface::free\_vector(Y\_ref);
00067 
00068     Interface::free\_vector(X);
00069     Interface::free\_vector(Y);
00070   \}
00071 
00072   \textcolor{comment}{// action name}
00073   \textcolor{keyword}{static} \textcolor{keyword}{inline} std::string name( \textcolor{keywordtype}{void} )
00074   \{
00075     \textcolor{keywordflow}{return} \textcolor{stringliteral}{"axpby\_"}+Interface::name();
00076   \}
00077 
00078   \textcolor{keywordtype}{double} nb\_op\_base( \textcolor{keywordtype}{void} )\{
00079     \textcolor{keywordflow}{return} 3.0*\_size;
00080   \}
00081 
00082   \textcolor{keyword}{inline} \textcolor{keywordtype}{void} initialize( \textcolor{keywordtype}{void} )\{
00083     Interface::copy\_vector(X\_ref,X,\_size);
00084     Interface::copy\_vector(Y\_ref,Y,\_size);
00085   \}
00086 
00087   \textcolor{keyword}{inline} \textcolor{keywordtype}{void} calculate( \textcolor{keywordtype}{void} ) \{
00088     BTL\_ASM\_COMMENT(\textcolor{stringliteral}{"mybegin axpby"});
00089     Interface::axpby(\_alpha,X,\_beta,Y,\_size);
00090     BTL\_ASM\_COMMENT(\textcolor{stringliteral}{"myend axpby"});
00091   \}
00092 
00093   \textcolor{keywordtype}{void} check\_result( \textcolor{keywordtype}{void} )\{
00094     \textcolor{keywordflow}{if} (\_size>128) \textcolor{keywordflow}{return};
00095     \textcolor{comment}{// calculation check}
00096     Interface::vector\_to\_stl(Y,resu\_stl);
00097 
00098     \hyperlink{class_s_t_l__interface}{STL\_interface<typename Interface::real\_type>::axpby}(
      \_alpha,X\_stl,\_beta,Y\_stl,\_size);
00099 
00100     \textcolor{keyword}{typename} Interface::real\_type error=
00101       \hyperlink{class_s_t_l__interface}{STL\_interface<typename Interface::real\_type>::norm\_diff}
      (Y\_stl,resu\_stl);
00102 
00103     \textcolor{keywordflow}{if} (error>1.e-6)\{
00104       INFOS(\textcolor{stringliteral}{"WRONG CALCULATION...residual="} << error);
00105       exit(2);
00106     \}
00107   \}
00108 
00109 private :
00110 
00111   \textcolor{keyword}{typename} Interface::stl\_vector X\_stl;
00112   \textcolor{keyword}{typename} Interface::stl\_vector Y\_stl;
00113   \textcolor{keyword}{typename} Interface::stl\_vector resu\_stl;
00114 
00115   \textcolor{keyword}{typename} Interface::gene\_vector X\_ref;
00116   \textcolor{keyword}{typename} Interface::gene\_vector Y\_ref;
00117 
00118   \textcolor{keyword}{typename} Interface::gene\_vector X;
00119   \textcolor{keyword}{typename} Interface::gene\_vector Y;
00120 
00121   \textcolor{keyword}{typename} Interface::real\_type \_alpha;
00122   \textcolor{keyword}{typename} Interface::real\_type \_beta;
00123 
00124   \textcolor{keywordtype}{int} \_size;
00125 \};
00126 
00127 \textcolor{preprocessor}{#endif}
\end{DoxyCode}
