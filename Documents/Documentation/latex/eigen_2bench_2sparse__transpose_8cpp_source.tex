\hypertarget{eigen_2bench_2sparse__transpose_8cpp_source}{}\section{eigen/bench/sparse\+\_\+transpose.cpp}
\label{eigen_2bench_2sparse__transpose_8cpp_source}\index{sparse\+\_\+transpose.\+cpp@{sparse\+\_\+transpose.\+cpp}}

\begin{DoxyCode}
00001 
00002 \textcolor{comment}{//g++ -O3 -g0 -DNDEBUG  sparse\_transpose.cpp -I.. -I/home/gael/Coding/LinearAlgebra/mtl4/ -DDENSITY=0.005
       -DSIZE=10000 && ./a.out}
00003 \textcolor{comment}{// -DNOGMM -DNOMTL}
00004 \textcolor{comment}{// -DCSPARSE -I /home/gael/Coding/LinearAlgebra/CSparse/Include/
       /home/gael/Coding/LinearAlgebra/CSparse/Lib/libcsparse.a}
00005 
00006 \textcolor{preprocessor}{#ifndef SIZE}
00007 \textcolor{preprocessor}{#define SIZE 10000}
00008 \textcolor{preprocessor}{#endif}
00009 
00010 \textcolor{preprocessor}{#ifndef DENSITY}
00011 \textcolor{preprocessor}{#define DENSITY 0.01}
00012 \textcolor{preprocessor}{#endif}
00013 
00014 \textcolor{preprocessor}{#ifndef REPEAT}
00015 \textcolor{preprocessor}{#define REPEAT 1}
00016 \textcolor{preprocessor}{#endif}
00017 
00018 \textcolor{preprocessor}{#include "BenchSparseUtil.h"}
00019 
00020 \textcolor{preprocessor}{#ifndef MINDENSITY}
00021 \textcolor{preprocessor}{#define MINDENSITY 0.0004}
00022 \textcolor{preprocessor}{#endif}
00023 
00024 \textcolor{preprocessor}{#ifndef NBTRIES}
00025 \textcolor{preprocessor}{#define NBTRIES 10}
00026 \textcolor{preprocessor}{#endif}
00027 
00028 \textcolor{preprocessor}{#define BENCH(X) \(\backslash\)}
00029 \textcolor{preprocessor}{  timer.reset(); \(\backslash\)}
00030 \textcolor{preprocessor}{  for (int \_j=0; \_j<NBTRIES; ++\_j) \{ \(\backslash\)}
00031 \textcolor{preprocessor}{    timer.start(); \(\backslash\)}
00032 \textcolor{preprocessor}{    for (int \_k=0; \_k<REPEAT; ++\_k) \{ \(\backslash\)}
00033 \textcolor{preprocessor}{        X  \(\backslash\)}
00034 \textcolor{preprocessor}{  \} timer.stop(); \}}
00035 
00036 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} *argv[])
00037 \{
00038   \textcolor{keywordtype}{int} rows = SIZE;
00039   \textcolor{keywordtype}{int} cols = SIZE;
00040   \textcolor{keywordtype}{float} density = DENSITY;
00041 
00042   \hyperlink{group___sparse_core___module}{EigenSparseMatrix} sm1(rows,cols), sm3(rows,cols);
00043 
00044   \hyperlink{class_eigen_1_1_bench_timer}{BenchTimer} timer;
00045   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{float} density = DENSITY; density>=MINDENSITY; density*=0.5)
00046   \{
00047     fillMatrix(density, rows, cols, sm1);
00048 
00049     \textcolor{comment}{// dense matrices}
00050 \textcolor{preprocessor}{    #ifdef DENSEMATRIX}
00051     \{
00052       \hyperlink{group___core___module}{DenseMatrix} m1(rows,cols), m3(rows,cols);
00053       eiToDense(sm1, m1);
00054       BENCH(\textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k=0; k<REPEAT; ++k) m3 = m1.transpose();)
00055       std::cout << \textcolor{stringliteral}{"  Eigen dense:\(\backslash\)t"} << timer.\hyperlink{class_eigen_1_1_bench_timer_a26760f963ed8b64c126159bfea57735e}{value}() << endl;
00056     \}
00057 \textcolor{preprocessor}{    #endif}
00058 
00059     std::cout << \textcolor{stringliteral}{"Non zeros: "} << sm1.nonZeros()/float(sm1.rows()*sm1.cols())*100 << \textcolor{stringliteral}{"%\(\backslash\)n"};
00060 
00061     \textcolor{comment}{// eigen sparse matrices}
00062     \{
00063       BENCH(\textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k=0; k<REPEAT; ++k) sm3 = sm1.transpose();)
00064       std::cout << \textcolor{stringliteral}{"  Eigen:\(\backslash\)t"} << timer.\hyperlink{class_eigen_1_1_bench_timer_a26760f963ed8b64c126159bfea57735e}{value}() << endl;
00065     \}
00066 
00067     \textcolor{comment}{// CSparse}
00068 \textcolor{preprocessor}{    #ifdef CSPARSE}
00069     \{
00070       cs *m1, *m3;
00071       eiToCSparse(sm1, m1);
00072 
00073       BENCH(\textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k=0; k<REPEAT; ++k) \{ m3 = cs\_transpose(m1,1); cs\_spfree(m3);\})
00074       std::cout << \textcolor{stringliteral}{"  CSparse:\(\backslash\)t"} << timer.\hyperlink{class_eigen_1_1_bench_timer_a26760f963ed8b64c126159bfea57735e}{value}() << endl;
00075     \}
00076 \textcolor{preprocessor}{    #endif}
00077 
00078     \textcolor{comment}{// GMM++}
00079 \textcolor{preprocessor}{    #ifndef NOGMM}
00080     \{
00081       GmmDynSparse  gmmT3(rows,cols);
00082       GmmSparse m1(rows,cols), m3(rows,cols);
00083       eiToGmm(sm1, m1);
00084       BENCH(\textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k=0; k<REPEAT; ++k) gmm::copy(gmm::transposed(m1),m3);)
00085       std::cout << \textcolor{stringliteral}{"  GMM:\(\backslash\)t\(\backslash\)t"} << timer.\hyperlink{class_eigen_1_1_bench_timer_a26760f963ed8b64c126159bfea57735e}{value}() << endl;
00086     \}
00087 \textcolor{preprocessor}{    #endif}
00088 
00089     \textcolor{comment}{// MTL4}
00090 \textcolor{preprocessor}{    #ifndef NOMTL}
00091     \{
00092       MtlSparse m1(rows,cols), m3(rows,cols);
00093       eiToMtl(sm1, m1);
00094       BENCH(\textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k=0; k<REPEAT; ++k) m3 = trans(m1);)
00095       std::cout << \textcolor{stringliteral}{"  MTL4:\(\backslash\)t\(\backslash\)t"} << timer.\hyperlink{class_eigen_1_1_bench_timer_a26760f963ed8b64c126159bfea57735e}{value}() << endl;
00096     \}
00097 \textcolor{preprocessor}{    #endif}
00098 
00099     std::cout << \textcolor{stringliteral}{"\(\backslash\)n\(\backslash\)n"};
00100   \}
00101 
00102   \textcolor{keywordflow}{return} 0;
00103 \}
00104 
\end{DoxyCode}
