\hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_core_2arch_2_c_u_d_a_2_type_casting_8h_source}{}\section{matio/visual\+\_\+studio/test/eigen/\+Eigen/src/\+Core/arch/\+C\+U\+D\+A/\+Type\+Casting.h}
\label{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_core_2arch_2_c_u_d_a_2_type_casting_8h_source}\index{Type\+Casting.\+h@{Type\+Casting.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2016 Benoit Steiner <benoit.steiner.goog@gmail.com>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#ifndef EIGEN\_TYPE\_CASTING\_CUDA\_H}
00011 \textcolor{preprocessor}{#define EIGEN\_TYPE\_CASTING\_CUDA\_H}
00012 
00013 \textcolor{keyword}{namespace }\hyperlink{namespace_eigen}{Eigen} \{
00014 
00015 \textcolor{keyword}{namespace }\hyperlink{namespaceinternal}{internal} \{
00016 
00017 \textcolor{keyword}{template}<>
00018 \textcolor{keyword}{struct }scalar\_cast\_op<float, \hyperlink{namespace_eigen}{Eigen}::half> \{
00019   EIGEN\_EMPTY\_STRUCT\_CTOR(scalar\_cast\_op)
00020   \textcolor{keyword}{typedef} \hyperlink{struct_eigen_1_1half}{Eigen::half} result\_type;
00021   EIGEN\_DEVICE\_FUNC EIGEN\_STRONG\_INLINE \hyperlink{struct_eigen_1_1half}{Eigen::half} operator() (\textcolor{keyword}{const} \textcolor{keywordtype}{float}& a)\textcolor{keyword}{ const }\{
00022 \textcolor{preprocessor}{    #if defined(EIGEN\_HAS\_CUDA\_FP16) && defined(\_\_CUDA\_ARCH\_\_) && \_\_CUDA\_ARCH\_\_ >= 300}
00023       \textcolor{keywordflow}{return} \_\_float2half(a);
00024 \textcolor{preprocessor}{    #else}
00025       \textcolor{keywordflow}{return} \hyperlink{struct_eigen_1_1half}{Eigen::half}(a);
00026 \textcolor{preprocessor}{    #endif}
00027   \}
00028 \};
00029 
00030 \textcolor{keyword}{template}<>
00031 \textcolor{keyword}{struct }functor\_traits<scalar\_cast\_op<float, \hyperlink{namespace_eigen}{Eigen}::half> >
00032 \{ \textcolor{keyword}{enum} \{ Cost = NumTraits<float>::AddCost, PacketAccess = \textcolor{keyword}{false} \}; \};
00033 
00034 
00035 \textcolor{keyword}{template}<>
00036 \textcolor{keyword}{struct }scalar\_cast\_op<int, \hyperlink{namespace_eigen}{Eigen}::half> \{
00037   EIGEN\_EMPTY\_STRUCT\_CTOR(scalar\_cast\_op)
00038   \textcolor{keyword}{typedef} \hyperlink{struct_eigen_1_1half}{Eigen::half} result\_type;
00039   EIGEN\_DEVICE\_FUNC EIGEN\_STRONG\_INLINE \hyperlink{struct_eigen_1_1half}{Eigen::half} operator() (\textcolor{keyword}{const} \textcolor{keywordtype}{int}& a)\textcolor{keyword}{ const }\{
00040 \textcolor{preprocessor}{    #if defined(EIGEN\_HAS\_CUDA\_FP16) && defined(\_\_CUDA\_ARCH\_\_) && \_\_CUDA\_ARCH\_\_ >= 300}
00041       \textcolor{keywordflow}{return} \_\_float2half(static\_cast<float>(a));
00042 \textcolor{preprocessor}{    #else}
00043       \textcolor{keywordflow}{return} \hyperlink{struct_eigen_1_1half}{Eigen::half}(static\_cast<float>(a));
00044 \textcolor{preprocessor}{    #endif}
00045   \}
00046 \};
00047 
00048 \textcolor{keyword}{template}<>
00049 \textcolor{keyword}{struct }functor\_traits<scalar\_cast\_op<int, \hyperlink{namespace_eigen}{Eigen}::half> >
00050 \{ \textcolor{keyword}{enum} \{ Cost = NumTraits<float>::AddCost, PacketAccess = \textcolor{keyword}{false} \}; \};
00051 
00052 
00053 \textcolor{keyword}{template}<>
00054 \textcolor{keyword}{struct }scalar\_cast\_op<\hyperlink{namespace_eigen}{Eigen}::half, float> \{
00055   EIGEN\_EMPTY\_STRUCT\_CTOR(scalar\_cast\_op)
00056   \textcolor{keyword}{typedef} \textcolor{keywordtype}{float} result\_type;
00057   EIGEN\_DEVICE\_FUNC EIGEN\_STRONG\_INLINE \textcolor{keywordtype}{float} operator() (\textcolor{keyword}{const} \hyperlink{struct_eigen_1_1half}{Eigen::half}& a)\textcolor{keyword}{ const }\{
00058 \textcolor{preprocessor}{    #if defined(EIGEN\_HAS\_CUDA\_FP16) && defined(\_\_CUDA\_ARCH\_\_) && \_\_CUDA\_ARCH\_\_ >= 300}
00059       \textcolor{keywordflow}{return} \_\_half2float(a);
00060 \textcolor{preprocessor}{    #else}
00061       \textcolor{keywordflow}{return} \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(a);
00062 \textcolor{preprocessor}{    #endif}
00063   \}
00064 \};
00065 
00066 \textcolor{keyword}{template}<>
00067 \textcolor{keyword}{struct }functor\_traits<scalar\_cast\_op<\hyperlink{namespace_eigen}{Eigen}::half, float> >
00068 \{ \textcolor{keyword}{enum} \{ Cost = NumTraits<float>::AddCost, PacketAccess = \textcolor{keyword}{false} \}; \};
00069 
00070 
00071 
00072 \textcolor{preprocessor}{#if defined(EIGEN\_HAS\_CUDA\_FP16) && defined(\_\_CUDA\_ARCH\_\_) && \_\_CUDA\_ARCH\_\_ >= 300}
00073 
00074 \textcolor{keyword}{template} <>
00075 \textcolor{keyword}{struct }type\_casting\_traits<\hyperlink{namespace_eigen}{Eigen}::half, float> \{
00076   \textcolor{keyword}{enum} \{
00077     VectorizedCast = 1,
00078     SrcCoeffRatio = 2,
00079     TgtCoeffRatio = 1
00080   \};
00081 \};
00082 
00083 \textcolor{keyword}{template}<> EIGEN\_DEVICE\_FUNC EIGEN\_STRONG\_INLINE float4 pcast<half2, float4>(\textcolor{keyword}{const} half2& a, \textcolor{keyword}{const} half2& b
      ) \{
00084   float2 r1 = \_\_half22float2(a);
00085   float2 r2 = \_\_half22float2(b);
00086   \textcolor{keywordflow}{return} make\_float4(r1.x, r1.y, r2.x, r2.y);
00087 \}
00088 
00089 \textcolor{keyword}{template} <>
00090 \textcolor{keyword}{struct }type\_casting\_traits<float, \hyperlink{namespace_eigen}{Eigen}::half> \{
00091   \textcolor{keyword}{enum} \{
00092     VectorizedCast = 1,
00093     SrcCoeffRatio = 1,
00094     TgtCoeffRatio = 2
00095   \};
00096 \};
00097 
00098 \textcolor{keyword}{template}<> EIGEN\_DEVICE\_FUNC EIGEN\_STRONG\_INLINE half2 pcast<float4, half2>(\textcolor{keyword}{const} float4& a) \{
00099   \textcolor{comment}{// Simply discard the second half of the input}
00100   \textcolor{keywordflow}{return} \_\_floats2half2\_rn(a.x, a.y);
00101 \}
00102 
00103 \textcolor{preprocessor}{#elif defined EIGEN\_VECTORIZE\_AVX512}
00104 \textcolor{keyword}{template} <>
00105 \textcolor{keyword}{struct }type\_casting\_traits<half, float> \{
00106   \textcolor{keyword}{enum} \{
00107     VectorizedCast = 1,
00108     SrcCoeffRatio = 1,
00109     TgtCoeffRatio = 1
00110   \};
00111 \};
00112 
00113 \textcolor{keyword}{template}<> EIGEN\_STRONG\_INLINE Packet16f pcast<Packet16h, Packet16f>(\textcolor{keyword}{const} Packet16h& a) \{
00114   \textcolor{keywordflow}{return} half2float(a);
00115 \}
00116 
00117 \textcolor{keyword}{template} <>
00118 \textcolor{keyword}{struct }type\_casting\_traits<float, half> \{
00119   \textcolor{keyword}{enum} \{
00120     VectorizedCast = 1,
00121     SrcCoeffRatio = 1,
00122     TgtCoeffRatio = 1
00123   \};
00124 \};
00125 
00126 \textcolor{keyword}{template}<> EIGEN\_STRONG\_INLINE Packet16h pcast<Packet16f, Packet16h>(\textcolor{keyword}{const} Packet16f& a) \{
00127   \textcolor{keywordflow}{return} float2half(a);
00128 \}
00129 
00130 \textcolor{preprocessor}{#elif defined EIGEN\_VECTORIZE\_AVX}
00131 
00132 \textcolor{keyword}{template} <>
00133 \textcolor{keyword}{struct }type\_casting\_traits<\hyperlink{namespace_eigen}{Eigen}::half, float> \{
00134   \textcolor{keyword}{enum} \{
00135     VectorizedCast = 1,
00136     SrcCoeffRatio = 1,
00137     TgtCoeffRatio = 1
00138   \};
00139 \};
00140 
00141 \textcolor{keyword}{template}<> EIGEN\_STRONG\_INLINE Packet8f pcast<Packet8h, Packet8f>(\textcolor{keyword}{const} Packet8h& a) \{
00142   \textcolor{keywordflow}{return} half2float(a);
00143 \}
00144 
00145 \textcolor{keyword}{template} <>
00146 \textcolor{keyword}{struct }type\_casting\_traits<float, \hyperlink{namespace_eigen}{Eigen}::half> \{
00147   \textcolor{keyword}{enum} \{
00148     VectorizedCast = 1,
00149     SrcCoeffRatio = 1,
00150     TgtCoeffRatio = 1
00151   \};
00152 \};
00153 
00154 \textcolor{keyword}{template}<> EIGEN\_STRONG\_INLINE Packet8h pcast<Packet8f, Packet8h>(\textcolor{keyword}{const} Packet8f& a) \{
00155   \textcolor{keywordflow}{return} float2half(a);
00156 \}
00157 
00158 \textcolor{comment}{// Disable the following code since it's broken on too many platforms / compilers.}
00159 \textcolor{comment}{//#elif defined(EIGEN\_VECTORIZE\_SSE) && (!EIGEN\_ARCH\_x86\_64) && (!EIGEN\_COMP\_MSVC)}
00160 \textcolor{preprocessor}{#elif 0}
00161 
00162 \textcolor{keyword}{template} <>
00163 \textcolor{keyword}{struct }type\_casting\_traits<\hyperlink{namespace_eigen}{Eigen}::half, float> \{
00164   \textcolor{keyword}{enum} \{
00165     VectorizedCast = 1,
00166     SrcCoeffRatio = 1,
00167     TgtCoeffRatio = 1
00168   \};
00169 \};
00170 
00171 \textcolor{keyword}{template}<> EIGEN\_STRONG\_INLINE Packet4f pcast<Packet4h, Packet4f>(\textcolor{keyword}{const} Packet4h& a) \{
00172   \_\_int64\_t a64 = \_mm\_cvtm64\_si64(a.x);
00173   \hyperlink{struct_eigen_1_1half}{Eigen::half} h = raw\_uint16\_to\_half(static\_cast<unsigned short>(a64));
00174   \textcolor{keywordtype}{float} f1 = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(h);
00175   h = raw\_uint16\_to\_half(static\_cast<unsigned short>(a64 >> 16));
00176   \textcolor{keywordtype}{float} f2 = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(h);
00177   h = raw\_uint16\_to\_half(static\_cast<unsigned short>(a64 >> 32));
00178   \textcolor{keywordtype}{float} f3 = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(h);
00179   h = raw\_uint16\_to\_half(static\_cast<unsigned short>(a64 >> 48));
00180   \textcolor{keywordtype}{float} f4 = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(h);
00181   \textcolor{keywordflow}{return} \_mm\_set\_ps(f4, f3, f2, f1);
00182 \}
00183 
00184 \textcolor{keyword}{template} <>
00185 \textcolor{keyword}{struct }type\_casting\_traits<float, \hyperlink{namespace_eigen}{Eigen}::half> \{
00186   \textcolor{keyword}{enum} \{
00187     VectorizedCast = 1,
00188     SrcCoeffRatio = 1,
00189     TgtCoeffRatio = 1
00190   \};
00191 \};
00192 
00193 \textcolor{keyword}{template}<> EIGEN\_STRONG\_INLINE Packet4h pcast<Packet4f, Packet4h>(\textcolor{keyword}{const} Packet4f& a) \{
00194   EIGEN\_ALIGN16 \textcolor{keywordtype}{float} aux[4];
00195   pstore(aux, a);
00196   \hyperlink{struct_eigen_1_1half}{Eigen::half} h0(aux[0]);
00197   \hyperlink{struct_eigen_1_1half}{Eigen::half} h1(aux[1]);
00198   \hyperlink{struct_eigen_1_1half}{Eigen::half} h2(aux[2]);
00199   \hyperlink{struct_eigen_1_1half}{Eigen::half} h3(aux[3]);
00200 
00201   Packet4h result;
00202   result.x = \_mm\_set\_pi16(h3.x, h2.x, h1.x, h0.x);
00203   \textcolor{keywordflow}{return} result;
00204 \}
00205 
00206 \textcolor{preprocessor}{#endif}
00207 
00208 \} \textcolor{comment}{// end namespace internal}
00209 
00210 \} \textcolor{comment}{// end namespace Eigen}
00211 
00212 \textcolor{preprocessor}{#endif // EIGEN\_TYPE\_CASTING\_CUDA\_H}
\end{DoxyCode}
