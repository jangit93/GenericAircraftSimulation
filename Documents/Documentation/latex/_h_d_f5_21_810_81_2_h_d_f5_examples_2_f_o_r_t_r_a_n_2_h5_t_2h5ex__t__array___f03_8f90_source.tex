\hypertarget{_h_d_f5_21_810_81_2_h_d_f5_examples_2_f_o_r_t_r_a_n_2_h5_t_2h5ex__t__array___f03_8f90_source}{}\section{H\+D\+F5/1.10.1/\+H\+D\+F5\+Examples/\+F\+O\+R\+T\+R\+A\+N/\+H5\+T/h5ex\+\_\+t\+\_\+array\+\_\+\+F03.f90}
\label{_h_d_f5_21_810_81_2_h_d_f5_examples_2_f_o_r_t_r_a_n_2_h5_t_2h5ex__t__array___f03_8f90_source}\index{h5ex\+\_\+t\+\_\+array\+\_\+\+F03.\+f90@{h5ex\+\_\+t\+\_\+array\+\_\+\+F03.\+f90}}

\begin{DoxyCode}
00001 \textcolor{comment}{!************************************************************}
00002 \textcolor{comment}{!}
00003 \textcolor{comment}{!  This example shows how to read and write array datatypes}
00004 \textcolor{comment}{!  to a dataset.  The program first writes integers arrays of}
00005 \textcolor{comment}{!  dimension ADIM0xADIM1 to a dataset with a dataspace of}
00006 \textcolor{comment}{!  DIM0, then closes the  file.  Next, it reopens the file,}
00007 \textcolor{comment}{!  reads back the data, and outputs it to the screen.}
00008 \textcolor{comment}{!}
00009 \textcolor{comment}{!  This file is intended for use with HDF5 Library verion 1.8}
00010 \textcolor{comment}{!  with --enable-fortran2003 }
00011 \textcolor{comment}{!}
00012 \textcolor{comment}{!************************************************************}
00013 \textcolor{keyword}{PROGRAM} main
00014 
00015   \textcolor{keywordtype}{USE }hdf5
00016   \textcolor{keywordtype}{USE }iso\_c\_binding
00017   
00018   \textcolor{keywordtype}{IMPLICIT NONE}
00019 
00020   \textcolor{keywordtype}{CHARACTER(LEN=19)}, \textcolor{keywordtype}{PARAMETER} :: filename  = \textcolor{stringliteral}{"h5ex\_t\_array\_F03.h5"}
00021   \textcolor{keywordtype}{CHARACTER(LEN=3)} , \textcolor{keywordtype}{PARAMETER} :: dataset   = \textcolor{stringliteral}{"DS1"}
00022   \textcolor{keywordtype}{INTEGER}          , \textcolor{keywordtype}{PARAMETER} :: dim0      = 4
00023   \textcolor{keywordtype}{INTEGER}          , \textcolor{keywordtype}{PARAMETER} :: adim0     = 3
00024   \textcolor{keywordtype}{INTEGER}          , \textcolor{keywordtype}{PARAMETER} :: adim1     = 5
00025   \textcolor{keywordtype}{INTEGER(HID\_T)}  :: \hyperlink{structfile}{file}, filetype, memtype, space, dset \textcolor{comment}{! Handles}
00026   \textcolor{keywordtype}{INTEGER} :: hdferr
00027   \textcolor{keywordtype}{INTEGER(HSIZE\_T)}, \textcolor{keywordtype}{DIMENSION(1:1)}   :: dims = (/dim0/)
00028   \textcolor{keywordtype}{INTEGER(HSIZE\_T)}, \textcolor{keywordtype}{DIMENSION(1:2)}   :: adims = (/adim0, adim1/)
00029   \textcolor{keywordtype}{INTEGER(HSIZE\_T)}, \textcolor{keywordtype}{DIMENSION(1:3)}   :: bdims = (/dim0, adim0, adim1/)
00030   \textcolor{keywordtype}{INTEGER(HSIZE\_T)}, \textcolor{keywordtype}{DIMENSION(1:2)}   :: maxdims
00031   \textcolor{keywordtype}{INTEGER}, \textcolor{keywordtype}{DIMENSION(1:dim0, 1:adim0, 1:adim1)}, \textcolor{keywordtype}{TARGET} :: wdata \textcolor{comment}{! Write buffer }
00032   \textcolor{keywordtype}{INTEGER}, \textcolor{keywordtype}{DIMENSION(:,:,:)}, \textcolor{keywordtype}{ALLOCATABLE}, \textcolor{keywordtype}{TARGET} :: rdata    \textcolor{comment}{! Read buffer}
00033   \textcolor{keywordtype}{INTEGER} :: i, j, k
00034   \textcolor{keywordtype}{TYPE}(c\_ptr) :: f\_ptr
00035   \textcolor{comment}{!}
00036   \textcolor{comment}{! Initialize FORTRAN interface.}
00037   \textcolor{comment}{!}
00038   \textcolor{keyword}{CALL }h5open\_f(hdferr)
00039   \textcolor{comment}{!}
00040   \textcolor{comment}{! Initialize data.  i is the element in the dataspace, j and k the}
00041   \textcolor{comment}{! elements within the array datatype.}
00042   \textcolor{comment}{!}
00043   \textcolor{keywordflow}{DO} i = 1, dim0
00044      \textcolor{keywordflow}{DO} j = 1, adim0
00045         \textcolor{keywordflow}{DO} k = 1, adim1
00046            wdata(i,j,k) = (i-1)*(j-1)-(j-1)*(k-1)+(i-1)*(k-1)
00047 \textcolor{keywordflow}{        ENDDO}
00048 \textcolor{keywordflow}{     ENDDO}
00049 \textcolor{keywordflow}{  ENDDO}
00050   \textcolor{comment}{!}
00051   \textcolor{comment}{! Create a new file using the default properties.}
00052   \textcolor{comment}{!}
00053   \textcolor{keyword}{CALL }h5fcreate\_f(filename, h5f\_acc\_trunc\_f, \hyperlink{structfile}{file}, hdferr)
00054   \textcolor{comment}{!}
00055   \textcolor{comment}{! Create array datatypes for file and memory.}
00056   \textcolor{comment}{!}
00057   \textcolor{keyword}{CALL }h5tarray\_create\_f(int(h5t\_std\_i64le, hid\_t), 2, adims, filetype, hdferr)
00058   \textcolor{keyword}{CALL }h5tarray\_create\_f(h5t\_native\_integer, 2, adims, memtype, hdferr)
00059   \textcolor{comment}{!}
00060   \textcolor{comment}{! Create dataspace.  Setting maximum size to be the current size.}
00061   \textcolor{comment}{!}
00062   \textcolor{keyword}{CALL }h5screate\_simple\_f(1, dims, space, hdferr)
00063   \textcolor{comment}{!}
00064   \textcolor{comment}{! Create the dataset and write the array data to it.}
00065   \textcolor{comment}{!}
00066   \textcolor{keyword}{CALL }h5dcreate\_f(\hyperlink{structfile}{file}, dataset, filetype, space, dset, hdferr)
00067   f\_ptr = c\_loc(wdata)
00068   \textcolor{keyword}{CALL }h5dwrite\_f(dset, memtype, f\_ptr, hdferr)
00069   \textcolor{comment}{!}
00070   \textcolor{comment}{! Close and release resources.}
00071   \textcolor{comment}{!}
00072   \textcolor{keyword}{CALL }h5dclose\_f (dset, hdferr)
00073   \textcolor{keyword}{CALL }h5sclose\_f (space, hdferr)
00074   \textcolor{keyword}{CALL }h5tclose\_f (filetype, hdferr)
00075   \textcolor{keyword}{CALL }h5tclose\_f (memtype, hdferr)
00076   \textcolor{keyword}{CALL }h5fclose\_f (\hyperlink{structfile}{file}, hdferr)
00077   \textcolor{comment}{!}
00078   \textcolor{comment}{! Now we begin the read section of this example. }
00079   \textcolor{comment}{!}
00080   \textcolor{comment}{! Open file, dataset, and attribute.}
00081   \textcolor{comment}{!}
00082   \textcolor{keyword}{CALL }h5fopen\_f(filename, h5f\_acc\_rdonly\_f, \hyperlink{structfile}{file}, hdferr)
00083   \textcolor{keyword}{CALL }h5dopen\_f (\hyperlink{structfile}{file}, dataset, dset, hdferr)
00084   \textcolor{comment}{!}
00085   \textcolor{comment}{! Get the datatype and its dimensions.}
00086   \textcolor{comment}{!}
00087   \textcolor{keyword}{CALL }h5dget\_type\_f(dset, filetype, hdferr)
00088   \textcolor{keyword}{CALL }h5tget\_array\_dims\_f (filetype, adims, hdferr)
00089   \textcolor{comment}{!}
00090   \textcolor{comment}{! Get dataspace and allocate memory for read buffer.  This is a}
00091   \textcolor{comment}{! three dimensional attribute when the array datatype is included.}
00092   \textcolor{comment}{!}
00093   \textcolor{keyword}{CALL }h5dget\_space\_f (dset, space, hdferr)
00094   \textcolor{keyword}{CALL }h5sget\_simple\_extent\_dims\_f (space, dims, maxdims, hdferr)
00095   \textcolor{keyword}{ALLOCATE}(rdata(1:dims(1),1:adims(1),1:adims(2)))
00096   \textcolor{comment}{!}
00097   \textcolor{comment}{! Create the memory datatype.}
00098   \textcolor{comment}{! }
00099   \textcolor{keyword}{CALL }h5tarray\_create\_f(h5t\_native\_integer, 2, adims, memtype, hdferr)
00100   \textcolor{comment}{!}
00101   \textcolor{comment}{! Read the data.}
00102   \textcolor{comment}{!}
00103   f\_ptr = c\_loc(rdata)
00104   \textcolor{keyword}{CALL }h5dread\_f (dset, memtype, f\_ptr, hdferr)
00105   \textcolor{comment}{!}
00106   \textcolor{comment}{! Output the data to the screen.}
00107   \textcolor{comment}{!}
00108   \textcolor{keywordflow}{DO} i = 1, dims(1)
00109      \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'(A,"[",i1,"]:")'}) dataset,i-1
00110      \textcolor{keywordflow}{DO} j=1, adim0
00111         \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'(" [")'}, advance=\textcolor{stringliteral}{'NO'})
00112         \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'(80i3)'}, advance=\textcolor{stringliteral}{'NO'}) rdata(i,j,:)
00113         \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'(" ]")'})
00114 \textcolor{keywordflow}{     ENDDO}
00115 \textcolor{keywordflow}{  ENDDO}
00116   \textcolor{comment}{!}
00117   \textcolor{comment}{! Close and release resources.}
00118   \textcolor{comment}{!}
00119   \textcolor{keyword}{DEALLOCATE}(rdata)
00120   \textcolor{keyword}{CALL }h5dclose\_f (dset, hdferr)
00121   \textcolor{keyword}{CALL }h5sclose\_f (space, hdferr)
00122   \textcolor{keyword}{CALL }h5tclose\_f (filetype, hdferr)
00123   \textcolor{keyword}{CALL }h5tclose\_f (memtype, hdferr)
00124   \textcolor{keyword}{CALL }h5fclose\_f (\hyperlink{structfile}{file}, hdferr)
00125 
00126 \textcolor{keyword}{END PROGRAM }main
\end{DoxyCode}
