\hypertarget{matio_2visual__studio_2test_2eigen_2bench_2btl_2libs_2tensors_2tensor__interface_8hh_source}{}\section{matio/visual\+\_\+studio/test/eigen/bench/btl/libs/tensors/tensor\+\_\+interface.hh}
\label{matio_2visual__studio_2test_2eigen_2bench_2btl_2libs_2tensors_2tensor__interface_8hh_source}\index{tensor\+\_\+interface.\+hh@{tensor\+\_\+interface.\+hh}}

\begin{DoxyCode}
00001 \textcolor{comment}{//=====================================================}
00002 \textcolor{comment}{// Copyright (C) 2014 Benoit Steiner <benoit.steiner.goog@gmail.com>}
00003 \textcolor{comment}{//=====================================================}
00004 \textcolor{comment}{//}
00005 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00006 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00007 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00008 \textcolor{comment}{//}
00009 \textcolor{preprocessor}{#ifndef TENSOR\_INTERFACE\_HH}
00010 \textcolor{preprocessor}{#define TENSOR\_INTERFACE\_HH}
00011 
00012 \textcolor{preprocessor}{#include <unsupported/Eigen/CXX11/Tensor>}
00013 \textcolor{preprocessor}{#include <vector>}
00014 \textcolor{preprocessor}{#include "btl.hh"}
00015 
00016 \textcolor{keyword}{using namespace }\hyperlink{namespace_eigen}{Eigen};
00017 
00018 \textcolor{keyword}{template}<\textcolor{keyword}{class} real>
00019 \textcolor{keyword}{class }\hyperlink{classtensor__interface}{tensor\_interface}
00020 \{
00021 public :
00022   \textcolor{keyword}{typedef} real real\_type;
00023   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Eigen::Tensor<real,2>::Index \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index};
00024 
00025   \textcolor{keyword}{typedef} std::vector<real> stl\_vector;
00026   \textcolor{keyword}{typedef} std::vector<stl\_vector> stl\_matrix;
00027 
00028   \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1_tensor}{Eigen::Tensor<real,2>} gene\_matrix;
00029   \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1_tensor}{Eigen::Tensor<real,1>} gene\_vector;
00030 
00031 
00032   \textcolor{keyword}{static} \textcolor{keyword}{inline} std::string name( \textcolor{keywordtype}{void} )
00033   \{
00034     \textcolor{keywordflow}{return} EIGEN\_MAKESTRING(BTL\_PREFIX);
00035   \}
00036 
00037   \textcolor{keyword}{static} \textcolor{keywordtype}{void} free\_matrix(gene\_matrix & \textcolor{comment}{/*A*/}, \textcolor{keywordtype}{int} \textcolor{comment}{/*N*/}) \{\}
00038 
00039   \textcolor{keyword}{static} \textcolor{keywordtype}{void} free\_vector(gene\_vector & \textcolor{comment}{/*B*/}) \{\}
00040 
00041   \textcolor{keyword}{static} BTL\_DONT\_INLINE \textcolor{keywordtype}{void} matrix\_from\_stl(gene\_matrix & \hyperlink{group___core___module_class_eigen_1_1_matrix}{A}, stl\_matrix & A\_stl)\{
00042     A.resize(\hyperlink{class_eigen_1_1array}{Eigen::array<Index,2>}(A\_stl[0].size(), A\_stl.size()));
00043 
00044     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} j=0; j<A\_stl.size() ; j++)\{
00045       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i=0; i<A\_stl[j].size() ; i++)\{
00046         A.coeffRef(\hyperlink{class_eigen_1_1array}{Eigen::array<Index,2>}(i,j)) = A\_stl[j][i];
00047       \}
00048     \}
00049   \}
00050 
00051   \textcolor{keyword}{static} BTL\_DONT\_INLINE  \textcolor{keywordtype}{void} vector\_from\_stl(gene\_vector & \hyperlink{group___core___module_class_eigen_1_1_matrix}{B}, stl\_vector & B\_stl)\{
00052     B.resize(B\_stl.size());
00053 
00054     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i=0; i<B\_stl.size() ; i++)\{
00055       B.coeffRef(i) = B\_stl[i];
00056     \}
00057   \}
00058 
00059   \textcolor{keyword}{static} BTL\_DONT\_INLINE  \textcolor{keywordtype}{void} vector\_to\_stl(gene\_vector & B, stl\_vector & B\_stl)\{
00060     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i=0; i<B\_stl.size() ; i++)\{
00061       B\_stl[i] = B.coeff(i);
00062     \}
00063   \}
00064 
00065   \textcolor{keyword}{static} BTL\_DONT\_INLINE  \textcolor{keywordtype}{void} matrix\_to\_stl(gene\_matrix & A, stl\_matrix & A\_stl)\{
00066     \textcolor{keywordtype}{int}  N=A\_stl.size();
00067 
00068     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j=0;j<N;j++)\{
00069       A\_stl[j].resize(N);
00070       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0;i<N;i++)\{
00071         A\_stl[j][i] = A.coeff(\hyperlink{class_eigen_1_1array}{Eigen::array<Index,2>}(i,j));
00072       \}
00073     \}
00074   \}
00075 
00076   \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} matrix\_matrix\_product(\textcolor{keyword}{const} gene\_matrix & A, \textcolor{keyword}{const} gene\_matrix & B, gene\_matrix & X, \textcolor{keywordtype}{
      int}  \textcolor{comment}{/*N*/})\{
00077     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{class_eigen_1_1_tensor}{Eigen::Tensor<real\_type, 1>::DimensionPair} 
      DimPair;
00078     \textcolor{keyword}{const} \hyperlink{class_eigen_1_1array}{Eigen::array<DimPair, 1>} dims(DimPair(1, 0));
00079     X\textcolor{comment}{/*.noalias()*/} = A.contract(B, dims);
00080   \}
00081 
00082   \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} matrix\_vector\_product(\textcolor{keyword}{const} gene\_matrix & A, \textcolor{keyword}{const} gene\_vector & B, gene\_vector & X, \textcolor{keywordtype}{
      int}  \textcolor{comment}{/*N*/})\{
00083     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{class_eigen_1_1_tensor}{Eigen::Tensor<real\_type, 1>::DimensionPair} 
      DimPair;
00084     \textcolor{keyword}{const} \hyperlink{class_eigen_1_1array}{Eigen::array<DimPair, 1>} dims(DimPair(1, 0));
00085     X\textcolor{comment}{/*.noalias()*/} = A.contract(B, dims);
00086   \}
00087 
00088   \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} axpy(real coef, \textcolor{keyword}{const} gene\_vector & X, gene\_vector & Y, \textcolor{keywordtype}{int}  \textcolor{comment}{/*N*/})\{
00089     Y += X.constant(coef) * X;
00090   \}
00091 
00092   \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} axpby(real a, \textcolor{keyword}{const} gene\_vector & X, real b, gene\_vector & Y, \textcolor{keywordtype}{int}  \textcolor{comment}{/*N*/})\{
00093     Y = X.constant(a)*X + Y.constant(b)*Y;
00094   \}
00095 
00096   \textcolor{keyword}{static} EIGEN\_DONT\_INLINE \textcolor{keywordtype}{void} copy\_matrix(\textcolor{keyword}{const} gene\_matrix & source, gene\_matrix & cible, \textcolor{keywordtype}{int}  \textcolor{comment}{/*N*/})\{
00097     cible = source;
00098   \}
00099 
00100   \textcolor{keyword}{static} EIGEN\_DONT\_INLINE \textcolor{keywordtype}{void} copy\_vector(\textcolor{keyword}{const} gene\_vector & source, gene\_vector & cible, \textcolor{keywordtype}{int}  \textcolor{comment}{/*N*/})\{
00101     cible = source;
00102   \}
00103 \};
00104 
00105 \textcolor{preprocessor}{#endif}
\end{DoxyCode}
