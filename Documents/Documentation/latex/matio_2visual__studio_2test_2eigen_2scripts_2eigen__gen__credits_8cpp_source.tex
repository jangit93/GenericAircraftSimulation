\hypertarget{matio_2visual__studio_2test_2eigen_2scripts_2eigen__gen__credits_8cpp_source}{}\section{matio/visual\+\_\+studio/test/eigen/scripts/eigen\+\_\+gen\+\_\+credits.cpp}
\label{matio_2visual__studio_2test_2eigen_2scripts_2eigen__gen__credits_8cpp_source}\index{eigen\+\_\+gen\+\_\+credits.\+cpp@{eigen\+\_\+gen\+\_\+credits.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include <string>}
00002 \textcolor{preprocessor}{#include <sstream>}
00003 \textcolor{preprocessor}{#include <iostream>}
00004 \textcolor{preprocessor}{#include <fstream>}
00005 \textcolor{preprocessor}{#include <iomanip>}
00006 \textcolor{preprocessor}{#include <map>}
00007 \textcolor{preprocessor}{#include <list>}
00008 
00009 \textcolor{keyword}{using namespace }\hyperlink{namespacestd}{std};
00010 
00011 \textcolor{comment}{// this function takes a line that may contain a name and/or email address,}
00012 \textcolor{comment}{// and returns just the name, while fixing the "bad cases".}
00013 std::string contributor\_name(\textcolor{keyword}{const} std::string& line)
00014 \{
00015   \textcolor{keywordtype}{string} result;
00016 
00017   \textcolor{comment}{// let's first take care of the case of isolated email addresses, like}
00018   \textcolor{comment}{// "user@localhost.localdomain" entries}
00019   \textcolor{keywordflow}{if}(line.find(\textcolor{stringliteral}{"markb@localhost.localdomain"}) != string::npos)
00020   \{
00021     \textcolor{keywordflow}{return} \textcolor{stringliteral}{"Mark Borgerding"};
00022   \}
00023 
00024   \textcolor{keywordflow}{if}(line.find(\textcolor{stringliteral}{"kayhman@contact.intra.cea.fr"}) != string::npos)
00025   \{
00026     \textcolor{keywordflow}{return} \textcolor{stringliteral}{"Guillaume Saupin"};
00027   \}
00028 
00029   \textcolor{comment}{// from there on we assume that we have a entry of the form}
00030   \textcolor{comment}{// either:}
00031   \textcolor{comment}{//   Bla bli Blurp}
00032   \textcolor{comment}{// or:}
00033   \textcolor{comment}{//   Bla bli Blurp <bblurp@email.com>}
00034   
00035   \textcolor{keywordtype}{size\_t} position\_of\_email\_address = line.find\_first\_of(\textcolor{charliteral}{'<'});
00036   \textcolor{keywordflow}{if}(position\_of\_email\_address != string::npos)
00037   \{
00038     \textcolor{comment}{// there is an e-mail address in <...>.}
00039     
00040     \textcolor{comment}{// Hauke once committed as "John Smith", fix that.}
00041     \textcolor{keywordflow}{if}(line.find(\textcolor{stringliteral}{"hauke.heibel"}) != string::npos)
00042       result = \textcolor{stringliteral}{"Hauke Heibel"};
00043     \textcolor{keywordflow}{else}
00044     \{
00045       \textcolor{comment}{// just remove the e-mail address}
00046       result = line.substr(0, position\_of\_email\_address);
00047     \}
00048   \}
00049   \textcolor{keywordflow}{else}
00050   \{
00051     \textcolor{comment}{// there is no e-mail address in <...>.}
00052     
00053     \textcolor{keywordflow}{if}(line.find(\textcolor{stringliteral}{"convert-repo"}) != string::npos)
00054       result = \textcolor{stringliteral}{""};
00055     \textcolor{keywordflow}{else}
00056       result = line;
00057   \}
00058 
00059   \textcolor{comment}{// remove trailing spaces}
00060   \textcolor{keywordtype}{size\_t} length = result.length();
00061   \textcolor{keywordflow}{while}(length >= 1 && result[length-1] == \textcolor{charliteral}{' '}) result.erase(--length);
00062 
00063   \textcolor{keywordflow}{return} result;
00064 \}
00065 
00066 \textcolor{comment}{// parses hg churn output to generate a contributors map.}
00067 map<string,int> contributors\_map\_from\_churn\_output(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *filename)
00068 \{
00069   map<string,int> contributors\_map;
00070 
00071   \textcolor{keywordtype}{string} line;
00072   ifstream churn\_out;
00073   churn\_out.open(filename, ios::in);
00074   \textcolor{keywordflow}{while}(!getline(churn\_out,line).eof())
00075   \{
00076     \textcolor{comment}{// remove the histograms "******" that hg churn may draw at the end of some lines}
00077     \textcolor{keywordtype}{size\_t} first\_star = line.find\_first\_of(\textcolor{charliteral}{'*'});
00078     \textcolor{keywordflow}{if}(first\_star != string::npos) line.erase(first\_star);
00079     
00080     \textcolor{comment}{// remove trailing spaces}
00081     \textcolor{keywordtype}{size\_t} length = line.length();
00082     \textcolor{keywordflow}{while}(length >= 1 && line[length-1] == \textcolor{charliteral}{' '}) line.erase(--length);
00083 
00084     \textcolor{comment}{// now the last space indicates where the number starts}
00085     \textcolor{keywordtype}{size\_t} last\_space = line.find\_last\_of(\textcolor{charliteral}{' '});
00086     
00087     \textcolor{comment}{// get the number (of changesets or of modified lines for each contributor)}
00088     \textcolor{keywordtype}{int} number;
00089     istringstream(line.substr(last\_space+1)) >> number;
00090 
00091     \textcolor{comment}{// get the name of the contributor}
00092     line.erase(last\_space);    
00093     \textcolor{keywordtype}{string} name = contributor\_name(line);
00094     
00095     map<string,int>::iterator it = contributors\_map.find(name);
00096     \textcolor{comment}{// if new contributor, insert}
00097     \textcolor{keywordflow}{if}(it == contributors\_map.end())
00098       contributors\_map.insert(pair<string,int>(name, number));
00099     \textcolor{comment}{// if duplicate, just add the number}
00100     \textcolor{keywordflow}{else}
00101       it->second += number;
00102   \}
00103   churn\_out.close();
00104 
00105   \textcolor{keywordflow}{return} contributors\_map;
00106 \}
00107 
00108 \textcolor{comment}{// find the last name, i.e. the last word.}
00109 \textcolor{comment}{// for "van den Schbling" types of last names, that's not a problem, that's actually what we want.}
00110 \textcolor{keywordtype}{string} lastname(\textcolor{keyword}{const} \textcolor{keywordtype}{string}& name)
00111 \{
00112   \textcolor{keywordtype}{size\_t} last\_space = name.find\_last\_of(\textcolor{charliteral}{' '});
00113   \textcolor{keywordflow}{if}(last\_space >= name.length()-1) \textcolor{keywordflow}{return} name;
00114   \textcolor{keywordflow}{else} \textcolor{keywordflow}{return} name.substr(last\_space+1);
00115 \}
00116 
00117 \textcolor{keyword}{struct }\hyperlink{structcontributor}{contributor}
00118 \{
00119   \textcolor{keywordtype}{string} name;
00120   \textcolor{keywordtype}{int} changedlines;
00121   \textcolor{keywordtype}{int} changesets;
00122   \textcolor{keywordtype}{string} url;
00123   \textcolor{keywordtype}{string} misc;
00124   
00125   \hyperlink{structcontributor}{contributor}() : changedlines(0), changesets(0) \{\}
00126   
00127   \textcolor{keywordtype}{bool} operator < (\textcolor{keyword}{const} \hyperlink{structcontributor}{contributor}& other)
00128   \{
00129     \textcolor{keywordflow}{return} lastname(name).compare(lastname(other.name)) < 0;
00130   \}
00131 \};
00132 
00133 \textcolor{keywordtype}{void} add\_online\_info\_into\_contributors\_list(list<contributor>& contributors\_list, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *filename)
00134 \{
00135   \textcolor{keywordtype}{string} line;
00136   ifstream online\_info;
00137   online\_info.open(filename, ios::in);
00138   \textcolor{keywordflow}{while}(!getline(online\_info,line).eof())
00139   \{
00140     \textcolor{keywordtype}{string} hgname, realname, url, misc;
00141     
00142     \textcolor{keywordtype}{size\_t} last\_bar = line.find\_last\_of(\textcolor{charliteral}{'|'});
00143     \textcolor{keywordflow}{if}(last\_bar == string::npos) \textcolor{keywordflow}{continue};
00144     \textcolor{keywordflow}{if}(last\_bar < line.length())
00145       misc = line.substr(last\_bar+1);
00146     line.erase(last\_bar);
00147     
00148     last\_bar = line.find\_last\_of(\textcolor{charliteral}{'|'});
00149     \textcolor{keywordflow}{if}(last\_bar == string::npos) \textcolor{keywordflow}{continue};
00150     \textcolor{keywordflow}{if}(last\_bar < line.length())
00151       url = line.substr(last\_bar+1);
00152     line.erase(last\_bar);
00153 
00154     last\_bar = line.find\_last\_of(\textcolor{charliteral}{'|'});
00155     \textcolor{keywordflow}{if}(last\_bar == string::npos) \textcolor{keywordflow}{continue};
00156     \textcolor{keywordflow}{if}(last\_bar < line.length())
00157       realname = line.substr(last\_bar+1);
00158     line.erase(last\_bar);
00159 
00160     hgname = line;
00161     
00162     \textcolor{comment}{// remove the example line}
00163     \textcolor{keywordflow}{if}(hgname.find(\textcolor{stringliteral}{"MercurialName"}) != string::npos) \textcolor{keywordflow}{continue};
00164     
00165     list<contributor>::iterator it;
00166     \textcolor{keywordflow}{for}(it=contributors\_list.begin(); it != contributors\_list.end() && it->name != hgname; ++it)
00167     \{\}
00168     
00169     \textcolor{keywordflow}{if}(it == contributors\_list.end())
00170     \{
00171       \hyperlink{structcontributor}{contributor} c;
00172       c.name = realname;
00173       c.url = url;
00174       c.misc = misc;
00175       contributors\_list.push\_back(c);
00176     \}
00177     \textcolor{keywordflow}{else}
00178     \{
00179       it->name = realname;
00180       it->url = url;
00181       it->misc = misc;
00182     \}
00183   \}
00184 \}
00185 
00186 \textcolor{keywordtype}{int} main()
00187 \{
00188   \textcolor{comment}{// parse the hg churn output files}
00189   map<string,int> contributors\_map\_for\_changedlines = contributors\_map\_from\_churn\_output(\textcolor{stringliteral}{"
      churn-changedlines.out"});
00190   \textcolor{comment}{//map<string,int> contributors\_map\_for\_changesets =
       contributors\_map\_from\_churn\_output("churn-changesets.out");}
00191   
00192   \textcolor{comment}{// merge into the contributors list}
00193   list<contributor> contributors\_list;
00194   map<string,int>::iterator it;
00195   \textcolor{keywordflow}{for}(it=contributors\_map\_for\_changedlines.begin(); it != contributors\_map\_for\_changedlines.end(); ++it)
00196   \{
00197     \hyperlink{structcontributor}{contributor} c;
00198     c.name = it->first;
00199     c.changedlines = it->second;
00200     c.changesets = 0; \textcolor{comment}{//contributors\_map\_for\_changesets.find(it->first)->second;}
00201     contributors\_list.push\_back(c);
00202   \}
00203   
00204   add\_online\_info\_into\_contributors\_list(contributors\_list, \textcolor{stringliteral}{"online-info.out"});
00205   
00206   contributors\_list.sort();
00207   
00208   cout << \textcolor{stringliteral}{"\{| cellpadding=\(\backslash\)"5\(\backslash\)"\(\backslash\)n"};
00209   cout << \textcolor{stringliteral}{"!\(\backslash\)n"};
00210   cout << \textcolor{stringliteral}{"! Lines changed\(\backslash\)n"};
00211   cout << \textcolor{stringliteral}{"!\(\backslash\)n"};
00212 
00213   list<contributor>::iterator itc;
00214   \textcolor{keywordtype}{int} i = 0;
00215   \textcolor{keywordflow}{for}(itc=contributors\_list.begin(); itc != contributors\_list.end(); ++itc)
00216   \{
00217     \textcolor{keywordflow}{if}(itc->name.length() == 0) \textcolor{keywordflow}{continue};
00218     \textcolor{keywordflow}{if}(i%2) cout << \textcolor{stringliteral}{"|-\(\backslash\)n"};
00219     \textcolor{keywordflow}{else} cout << \textcolor{stringliteral}{"|- style=\(\backslash\)"background:#FFFFD0\(\backslash\)"\(\backslash\)n"};
00220     \textcolor{keywordflow}{if}(itc->url.length())
00221       cout << \textcolor{stringliteral}{"| ["} << itc->url << \textcolor{stringliteral}{" "} << itc->name << \textcolor{stringliteral}{"]\(\backslash\)n"};
00222     \textcolor{keywordflow}{else}
00223       cout << \textcolor{stringliteral}{"| "} << itc->name << \textcolor{stringliteral}{"\(\backslash\)n"};
00224     \textcolor{keywordflow}{if}(itc->changedlines)
00225       cout << \textcolor{stringliteral}{"| "} << itc->changedlines << \textcolor{stringliteral}{"\(\backslash\)n"};
00226     \textcolor{keywordflow}{else}
00227       cout << \textcolor{stringliteral}{"| (no information)\(\backslash\)n"};
00228     cout << \textcolor{stringliteral}{"| "} << itc->misc << \textcolor{stringliteral}{"\(\backslash\)n"};
00229     i++;
00230   \}
00231   cout << \textcolor{stringliteral}{"|\}"} << endl;
00232 \}
\end{DoxyCode}
