\hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_schur_8h_source}{}\section{matio/visual\+\_\+studio/test/eigen/\+Eigen/src/\+Eigenvalues/\+Complex\+Schur.h}
\label{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_schur_8h_source}\index{Complex\+Schur.\+h@{Complex\+Schur.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2009 Claire Maurice}
00005 \textcolor{comment}{// Copyright (C) 2009 Gael Guennebaud <gael.guennebaud@inria.fr>}
00006 \textcolor{comment}{// Copyright (C) 2010,2012 Jitse Niesen <jitse@maths.leeds.ac.uk>}
00007 \textcolor{comment}{//}
00008 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00009 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00010 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00011 
00012 \textcolor{preprocessor}{#ifndef EIGEN\_COMPLEX\_SCHUR\_H}
00013 \textcolor{preprocessor}{#define EIGEN\_COMPLEX\_SCHUR\_H}
00014 
00015 \textcolor{preprocessor}{#include "./HessenbergDecomposition.h"}
00016 
00017 \textcolor{keyword}{namespace }\hyperlink{namespace_eigen}{Eigen} \{ 
00018 
00019 \textcolor{keyword}{namespace }\hyperlink{namespaceinternal}{internal} \{
00020 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType, \textcolor{keywordtype}{bool} IsComplex> \textcolor{keyword}{struct }complex\_schur\_reduce\_to\_hessenberg;
00021 \}
00022 
00051 \textcolor{keyword}{template}<\textcolor{keyword}{typename} \_MatrixType> \textcolor{keyword}{class }ComplexSchur
00052 \{
00053   \textcolor{keyword}{public}:
00054     \textcolor{keyword}{typedef} \_MatrixType MatrixType;
00055     \textcolor{keyword}{enum} \{
00056       RowsAtCompileTime = MatrixType::RowsAtCompileTime,
00057       ColsAtCompileTime = MatrixType::ColsAtCompileTime,
00058       Options = MatrixType::Options,
00059       MaxRowsAtCompileTime = MatrixType::MaxRowsAtCompileTime,
00060       MaxColsAtCompileTime = MatrixType::MaxColsAtCompileTime
00061     \};
00062 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_schur_8h_source_l00064}\hyperlink{group___eigenvalues___module_a9a8ee9df37ee1f90d0e53103c58683c0}{00064}     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::Scalar \hyperlink{group___eigenvalues___module_a9a8ee9df37ee1f90d0e53103c58683c0}{Scalar};
00065     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<Scalar>::Real} RealScalar;
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_schur_8h_source_l00066}\hyperlink{group___eigenvalues___module_a652104d13723a5b1db2937866a034557}{00066}     \textcolor{keyword}{typedef} \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index} \hyperlink{group___eigenvalues___module_a652104d13723a5b1db2937866a034557}{Index}; 
00067 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_schur_8h_source_l00074}\hyperlink{group___eigenvalues___module_ae1a4713b53f821867fbad617e426832a}{00074}     \textcolor{keyword}{typedef} std::complex<RealScalar> \hyperlink{group___eigenvalues___module_ae1a4713b53f821867fbad617e426832a}{ComplexScalar};
00075 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_schur_8h_source_l00081}\hyperlink{group___eigenvalues___module_af61fe57877d51cfb50178f78534042f0}{00081}     \textcolor{keyword}{typedef} 
      \hyperlink{group___core___module}{Matrix<ComplexScalar, RowsAtCompileTime, ColsAtCompileTime, Options, MaxRowsAtCompileTime,
       MaxColsAtCompileTime>}
       \hyperlink{group___eigenvalues___module_af61fe57877d51cfb50178f78534042f0}{ComplexMatrixType};
00082 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_schur_8h_source_l00094}\hyperlink{group___eigenvalues___module_ad707d9978dc36b3b15e460c2a83f4093}{00094}     \textcolor{keyword}{explicit} \hyperlink{group___eigenvalues___module_ad707d9978dc36b3b15e460c2a83f4093}{ComplexSchur}(Index size = RowsAtCompileTime==\hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Dynamic} ? 1 : 
      RowsAtCompileTime)
00095       : m\_matT(size,size),
00096         m\_matU(size,size),
00097         m\_hess(size),
00098         m\_isInitialized(false),
00099         m\_matUisUptodate(false),
00100         m\_maxIters(-1)
00101     \{\}
00102 
00112     \textcolor{keyword}{template}<\textcolor{keyword}{typename} InputType>
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_schur_8h_source_l00113}\hyperlink{group___eigenvalues___module_a9c92c6e4c33890d2d063c5c8dd22777d}{00113}     \textcolor{keyword}{explicit} \hyperlink{group___eigenvalues___module_a9c92c6e4c33890d2d063c5c8dd22777d}{ComplexSchur}(\textcolor{keyword}{const} \hyperlink{group___core___module_struct_eigen_1_1_eigen_base}{EigenBase<InputType>}& matrix, \textcolor{keywordtype}{bool} computeU
       = \textcolor{keyword}{true})
00114       : m\_matT(matrix.rows(),matrix.cols()),
00115         m\_matU(matrix.rows(),matrix.cols()),
00116         m\_hess(matrix.rows()),
00117         m\_isInitialized(false),
00118         m\_matUisUptodate(false),
00119         m\_maxIters(-1)
00120     \{
00121       compute(matrix.\hyperlink{group___core___module_a324b16961a11d2ecfd2d1b7dd7946545}{derived}(), computeU);
00122     \}
00123 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_schur_8h_source_l00138}\hyperlink{group___eigenvalues___module_afed8177cf9836f032d42bdb6c6bc6e01}{00138}     \textcolor{keyword}{const} ComplexMatrixType& \hyperlink{group___eigenvalues___module_afed8177cf9836f032d42bdb6c6bc6e01}{matrixU}()\textcolor{keyword}{ const}
00139 \textcolor{keyword}{    }\{
00140       eigen\_assert(m\_isInitialized && \textcolor{stringliteral}{"ComplexSchur is not initialized."});
00141       eigen\_assert(m\_matUisUptodate && \textcolor{stringliteral}{"The matrix U has not been computed during the ComplexSchur
       decomposition."});
00142       \textcolor{keywordflow}{return} m\_matU;
00143     \}
00144 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_schur_8h_source_l00162}\hyperlink{group___eigenvalues___module_add3ab5ed83f7f2f06b79fa910a2d5684}{00162}     \textcolor{keyword}{const} ComplexMatrixType& \hyperlink{group___eigenvalues___module_add3ab5ed83f7f2f06b79fa910a2d5684}{matrixT}()\textcolor{keyword}{ const}
00163 \textcolor{keyword}{    }\{
00164       eigen\_assert(m\_isInitialized && \textcolor{stringliteral}{"ComplexSchur is not initialized."});
00165       \textcolor{keywordflow}{return} m\_matT;
00166     \}
00167 
00190     \textcolor{keyword}{template}<\textcolor{keyword}{typename} InputType>
00191     \hyperlink{group___eigenvalues___module_class_eigen_1_1_complex_schur}{ComplexSchur}& compute(\textcolor{keyword}{const} \hyperlink{group___core___module_struct_eigen_1_1_eigen_base}{EigenBase<InputType>}& matrix, \textcolor{keywordtype}{bool} computeU
       = \textcolor{keyword}{true});
00192     
00210     \textcolor{keyword}{template}<\textcolor{keyword}{typename} HessMatrixType, \textcolor{keyword}{typename} OrthMatrixType>
00211     \hyperlink{group___eigenvalues___module_class_eigen_1_1_complex_schur}{ComplexSchur}& computeFromHessenberg(\textcolor{keyword}{const} HessMatrixType& matrixH, \textcolor{keyword}{const} OrthMatrixType& 
      matrixQ,  \textcolor{keywordtype}{bool} computeU=\textcolor{keyword}{true});
00212 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_schur_8h_source_l00217}\hyperlink{group___eigenvalues___module_a8c5ee15fecfd126fc362c3f2fd28f51e}{00217}     \hyperlink{group__enums_ga85fad7b87587764e5cf6b513a9e0ee5e}{ComputationInfo} \hyperlink{group___eigenvalues___module_a8c5ee15fecfd126fc362c3f2fd28f51e}{info}()\textcolor{keyword}{ const}
00218 \textcolor{keyword}{    }\{
00219       eigen\_assert(m\_isInitialized && \textcolor{stringliteral}{"ComplexSchur is not initialized."});
00220       \textcolor{keywordflow}{return} m\_info;
00221     \}
00222 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_schur_8h_source_l00228}\hyperlink{group___eigenvalues___module_a6ca227fbd5387f3a625351354b8eec44}{00228}     \hyperlink{group___eigenvalues___module_class_eigen_1_1_complex_schur}{ComplexSchur}& \hyperlink{group___eigenvalues___module_a6ca227fbd5387f3a625351354b8eec44}{setMaxIterations}(Index maxIters)
00229     \{
00230       m\_maxIters = maxIters;
00231       \textcolor{keywordflow}{return} *\textcolor{keyword}{this};
00232     \}
00233 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_schur_8h_source_l00235}\hyperlink{group___eigenvalues___module_a2fc0b7bc409a49e7cdb7b6edcfff26eb}{00235}     Index \hyperlink{group___eigenvalues___module_a2fc0b7bc409a49e7cdb7b6edcfff26eb}{getMaxIterations}()
00236     \{
00237       \textcolor{keywordflow}{return} m\_maxIters;
00238     \}
00239 
00245     \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{int} m\_maxIterationsPerRow = 30;
00246 
00247   \textcolor{keyword}{protected}:
00248     ComplexMatrixType m\_matT, m\_matU;
00249     \hyperlink{group___eigenvalues___module}{HessenbergDecomposition<MatrixType>} m\_hess;
00250     \hyperlink{group__enums_ga85fad7b87587764e5cf6b513a9e0ee5e}{ComputationInfo} m\_info;
00251     \textcolor{keywordtype}{bool} m\_isInitialized;
00252     \textcolor{keywordtype}{bool} m\_matUisUptodate;
00253     Index m\_maxIters;
00254 
00255   \textcolor{keyword}{private}:  
00256     \textcolor{keywordtype}{bool} subdiagonalEntryIsNeglegible(Index i);
00257     ComplexScalar computeShift(Index iu, Index iter);
00258     \textcolor{keywordtype}{void} reduceToTriangularForm(\textcolor{keywordtype}{bool} computeU);
00259     \textcolor{keyword}{friend} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1complex__schur__reduce__to__hessenberg}{internal::complex\_schur\_reduce\_to\_hessenberg}<
      MatrixType, NumTraits<Scalar>::IsComplex>;
00260 \};
00261 
00265 template<typename MatrixType>
00266 inline bool \hyperlink{group___eigenvalues___module_class_eigen_1_1_complex_schur}{ComplexSchur}<MatrixType>::subdiagonalEntryIsNeglegible(Index i)
00267 \{
00268   RealScalar d = numext::norm1(m\_matT.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(i,i)) + numext::norm1(m\_matT.
      \hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(i+1,i+1));
00269   RealScalar sd = numext::norm1(m\_matT.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(i+1,i));
00270   \textcolor{keywordflow}{if} (internal::isMuchSmallerThan(sd, d, \hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<RealScalar>::epsilon}()))
00271   \{
00272     m\_matT.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(i+1,i) = ComplexScalar(0);
00273     \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00274   \}
00275   \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00276 \}
00277 
00278 
00280 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>
00281 \textcolor{keyword}{typename} \hyperlink{group___eigenvalues___module_class_eigen_1_1_complex_schur}{ComplexSchur<MatrixType>::ComplexScalar} 
      \hyperlink{group___eigenvalues___module_class_eigen_1_1_complex_schur}{ComplexSchur<MatrixType>::computeShift}(Index iu, Index iter)
00282 \{
00283   \textcolor{keyword}{using} std::abs;
00284   \textcolor{keywordflow}{if} (iter == 10 || iter == 20) 
00285   \{
00286     \textcolor{comment}{// exceptional shift, taken from http://www.netlib.org/eispack/comqr.f}
00287     \textcolor{keywordflow}{return} abs(numext::real(m\_matT.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(iu,iu-1))) + abs(numext::real(m\_matT.
      \hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(iu-1,iu-2)));
00288   \}
00289 
00290   \textcolor{comment}{// compute the shift as one of the eigenvalues of t, the 2x2}
00291   \textcolor{comment}{// diagonal block on the bottom of the active submatrix}
00292   \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<ComplexScalar,2,2>} t = m\_matT.template block<2,2>(iu-1,iu-1);
00293   RealScalar normt = t.cwiseAbs().sum();
00294   t /= normt;     \textcolor{comment}{// the normalization by sf is to avoid under/overflow}
00295 
00296   ComplexScalar b = t.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(0,1) * t.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(1,0);
00297   ComplexScalar c = t.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(0,0) - t.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(1,1);
00298   ComplexScalar disc = sqrt(c*c + RealScalar(4)*b);
00299   ComplexScalar det = t.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(0,0) * t.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(1,1) - b;
00300   ComplexScalar trace = t.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(0,0) + t.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(1,1);
00301   ComplexScalar eival1 = (trace + disc) / RealScalar(2);
00302   ComplexScalar eival2 = (trace - disc) / RealScalar(2);
00303 
00304   \textcolor{keywordflow}{if}(numext::norm1(eival1) > numext::norm1(eival2))
00305     eival2 = det / eival1;
00306   \textcolor{keywordflow}{else}
00307     eival1 = det / eival2;
00308 
00309   \textcolor{comment}{// choose the eigenvalue closest to the bottom entry of the diagonal}
00310   \textcolor{keywordflow}{if}(numext::norm1(eival1-t.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(1,1)) < numext::norm1(eival2-t.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(1,1)))
00311     \textcolor{keywordflow}{return} normt * eival1;
00312   \textcolor{keywordflow}{else}
00313     \textcolor{keywordflow}{return} normt * eival2;
00314 \}
00315 
00316 
00317 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>
00318 \textcolor{keyword}{template}<\textcolor{keyword}{typename} InputType>
00319 \hyperlink{group___eigenvalues___module}{ComplexSchur<MatrixType>}& 
      \hyperlink{group___eigenvalues___module_a3543d2c286563108cd9ace672bbb1c09}{ComplexSchur<MatrixType>::compute}(\textcolor{keyword}{const} 
      \hyperlink{group___core___module_struct_eigen_1_1_eigen_base}{EigenBase<InputType>}& matrix, \textcolor{keywordtype}{bool} computeU)
00320 \{
00321   m\_matUisUptodate = \textcolor{keyword}{false};
00322   eigen\_assert(matrix.\hyperlink{group___core___module_a7b0b45c7351847696c911ce8aa2abbdb}{cols}() == matrix.\hyperlink{group___core___module_a8141320ba8df384426c298b32b000d8e}{rows}());
00323 
00324   \textcolor{keywordflow}{if}(matrix.\hyperlink{group___core___module_a7b0b45c7351847696c911ce8aa2abbdb}{cols}() == 1)
00325   \{
00326     m\_matT = matrix.\hyperlink{group___core___module_a324b16961a11d2ecfd2d1b7dd7946545}{derived}().template cast<ComplexScalar>();
00327     \textcolor{keywordflow}{if}(computeU)  m\_matU = ComplexMatrixType::Identity(1,1);
00328     m\_info = \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea52581b035f4b59c203b8ff999ef5fcea}{Success};
00329     m\_isInitialized = \textcolor{keyword}{true};
00330     m\_matUisUptodate = computeU;
00331     \textcolor{keywordflow}{return} *\textcolor{keyword}{this};
00332   \}
00333 
00334   
      \hyperlink{struct_eigen_1_1internal_1_1complex__schur__reduce__to__hessenberg}{internal::complex\_schur\_reduce\_to\_hessenberg<MatrixType, NumTraits<Scalar>::IsComplex}
      >::run(*\textcolor{keyword}{this}, matrix.\hyperlink{group___core___module_a324b16961a11d2ecfd2d1b7dd7946545}{derived}(), computeU);
00335   computeFromHessenberg(m\_matT, m\_matU, computeU);
00336   \textcolor{keywordflow}{return} *\textcolor{keyword}{this};
00337 \}
00338 
00339 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>
00340 \textcolor{keyword}{template}<\textcolor{keyword}{typename} HessMatrixType, \textcolor{keyword}{typename} OrthMatrixType>
00341 \hyperlink{group___eigenvalues___module}{ComplexSchur<MatrixType>}& 
      \hyperlink{group___eigenvalues___module_a05dfbf329047aba756a844f8fe2de314}{ComplexSchur<MatrixType>::computeFromHessenberg}(\textcolor{keyword}{const} 
      HessMatrixType& matrixH, \textcolor{keyword}{const} OrthMatrixType& matrixQ, \textcolor{keywordtype}{bool} computeU)
00342 \{
00343   m\_matT = matrixH;
00344   \textcolor{keywordflow}{if}(computeU)
00345     m\_matU = matrixQ;
00346   reduceToTriangularForm(computeU);
00347   \textcolor{keywordflow}{return} *\textcolor{keyword}{this};
00348 \}
00349 \textcolor{keyword}{namespace }\hyperlink{namespaceinternal}{internal} \{
00350 
00351 \textcolor{comment}{/* Reduce given matrix to Hessenberg form */}
00352 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType, \textcolor{keywordtype}{bool} IsComplex>
00353 \textcolor{keyword}{struct }complex\_schur\_reduce\_to\_hessenberg
00354 \{
00355   \textcolor{comment}{// this is the implementation for the case IsComplex = true}
00356   \textcolor{keyword}{static} \textcolor{keywordtype}{void} run(\hyperlink{group___eigenvalues___module}{ComplexSchur<MatrixType>}& \_this, \textcolor{keyword}{const} MatrixType& matrix, \textcolor{keywordtype}{bool} 
      computeU)
00357   \{
00358     \_this.m\_hess.\hyperlink{group___eigenvalues___module_a239a6fd42c57aab3c0b048c47fde3004}{compute}(matrix);
00359     \_this.m\_matT = \_this.m\_hess.\hyperlink{group___eigenvalues___module_a8e781d2e22a2304647bcf0ae913cc8ea}{matrixH}();
00360     \textcolor{keywordflow}{if}(computeU)  \_this.m\_matU = \_this.m\_hess.\hyperlink{group___eigenvalues___module_a346441e4902a58d43d698ac3da6ff791}{matrixQ}();
00361   \}
00362 \};
00363 
00364 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>
00365 \textcolor{keyword}{struct }complex\_schur\_reduce\_to\_hessenberg<MatrixType, false>
00366 \{
00367   \textcolor{keyword}{static} \textcolor{keywordtype}{void} run(\hyperlink{group___eigenvalues___module}{ComplexSchur<MatrixType>}& \_this, \textcolor{keyword}{const} MatrixType& matrix, \textcolor{keywordtype}{bool} 
      computeU)
00368   \{
00369     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___eigenvalues___module_class_eigen_1_1_complex_schur}{ComplexSchur<MatrixType>::ComplexScalar} 
      ComplexScalar;
00370 
00371     \textcolor{comment}{// Note: m\_hess is over RealScalar; m\_matT and m\_matU is over ComplexScalar}
00372     \_this.m\_hess.\hyperlink{group___eigenvalues___module_a239a6fd42c57aab3c0b048c47fde3004}{compute}(matrix);
00373     \_this.m\_matT = \_this.m\_hess.\hyperlink{group___eigenvalues___module_a8e781d2e22a2304647bcf0ae913cc8ea}{matrixH}().template cast<ComplexScalar>();
00374     \textcolor{keywordflow}{if}(computeU)  
00375     \{
00376       \textcolor{comment}{// This may cause an allocation which seems to be avoidable}
00377       MatrixType Q = \_this.m\_hess.\hyperlink{group___eigenvalues___module_a346441e4902a58d43d698ac3da6ff791}{matrixQ}(); 
00378       \_this.m\_matU = Q.template cast<ComplexScalar>();
00379     \}
00380   \}
00381 \};
00382 
00383 \} \textcolor{comment}{// end namespace internal}
00384 
00385 \textcolor{comment}{// Reduce the Hessenberg matrix m\_matT to triangular form by QR iteration.}
00386 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>
00387 \textcolor{keywordtype}{void} \hyperlink{group___eigenvalues___module_class_eigen_1_1_complex_schur}{ComplexSchur<MatrixType>::reduceToTriangularForm}(\textcolor{keywordtype}{bool} 
      computeU)
00388 \{  
00389   Index maxIters = m\_maxIters;
00390   \textcolor{keywordflow}{if} (maxIters == -1)
00391     maxIters = m\_maxIterationsPerRow * m\_matT.rows();
00392 
00393   \textcolor{comment}{// The matrix m\_matT is divided in three parts. }
00394   \textcolor{comment}{// Rows 0,...,il-1 are decoupled from the rest because m\_matT(il,il-1) is zero. }
00395   \textcolor{comment}{// Rows il,...,iu is the part we are working on (the active submatrix).}
00396   \textcolor{comment}{// Rows iu+1,...,end are already brought in triangular form.}
00397   Index iu = m\_matT.cols() - 1;
00398   Index il;
00399   Index iter = 0; \textcolor{comment}{// number of iterations we are working on the (iu,iu) element}
00400   Index totalIter = 0; \textcolor{comment}{// number of iterations for whole matrix}
00401 
00402   \textcolor{keywordflow}{while}(\textcolor{keyword}{true})
00403   \{
00404     \textcolor{comment}{// find iu, the bottom row of the active submatrix}
00405     \textcolor{keywordflow}{while}(iu > 0)
00406     \{
00407       \textcolor{keywordflow}{if}(!subdiagonalEntryIsNeglegible(iu-1)) \textcolor{keywordflow}{break};
00408       iter = 0;
00409       --iu;
00410     \}
00411 
00412     \textcolor{comment}{// if iu is zero then we are done; the whole matrix is triangularized}
00413     \textcolor{keywordflow}{if}(iu==0) \textcolor{keywordflow}{break};
00414 
00415     \textcolor{comment}{// if we spent too many iterations, we give up}
00416     iter++;
00417     totalIter++;
00418     \textcolor{keywordflow}{if}(totalIter > maxIters) \textcolor{keywordflow}{break};
00419 
00420     \textcolor{comment}{// find il, the top row of the active submatrix}
00421     il = iu-1;
00422     \textcolor{keywordflow}{while}(il > 0 && !subdiagonalEntryIsNeglegible(il-1))
00423     \{
00424       --il;
00425     \}
00426 
00427     \textcolor{comment}{/* perform the QR step using Givens rotations. The first rotation}
00428 \textcolor{comment}{       creates a bulge; the (il+2,il) element becomes nonzero. This}
00429 \textcolor{comment}{       bulge is chased down to the bottom of the active submatrix. */}
00430 
00431     ComplexScalar shift = computeShift(iu, iter);
00432     \hyperlink{group___jacobi___module_class_eigen_1_1_jacobi_rotation}{JacobiRotation<ComplexScalar>} rot;
00433     rot.\hyperlink{group___jacobi___module_af73c81e9cc139b7e0d877ce553b02ec0}{makeGivens}(m\_matT.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(il,il) - shift, m\_matT.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(il+1,il));
00434     m\_matT.rightCols(m\_matT.cols()-il).applyOnTheLeft(il, il+1, rot.\hyperlink{group___jacobi___module_a89c8ea615f8fa77ddd5810a1e5fde4da}{adjoint}());
00435     m\_matT.topRows((std::min)(il+2,iu)+1).applyOnTheRight(il, il+1, rot);
00436     \textcolor{keywordflow}{if}(computeU) m\_matU.applyOnTheRight(il, il+1, rot);
00437 
00438     \textcolor{keywordflow}{for}(Index i=il+1 ; i<iu ; i++)
00439     \{
00440       rot.\hyperlink{group___jacobi___module_af73c81e9cc139b7e0d877ce553b02ec0}{makeGivens}(m\_matT.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(i,i-1), m\_matT.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(i+1,i-1), &m\_matT.
      \hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(i,i-1));
00441       m\_matT.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(i+1,i-1) = ComplexScalar(0);
00442       m\_matT.rightCols(m\_matT.cols()-i).applyOnTheLeft(i, i+1, rot.\hyperlink{group___jacobi___module_a89c8ea615f8fa77ddd5810a1e5fde4da}{adjoint}());
00443       m\_matT.topRows((std::min)(i+2,iu)+1).applyOnTheRight(i, i+1, rot);
00444       \textcolor{keywordflow}{if}(computeU) m\_matU.applyOnTheRight(i, i+1, rot);
00445     \}
00446   \}
00447 
00448   \textcolor{keywordflow}{if}(totalIter <= maxIters)
00449     m\_info = \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea52581b035f4b59c203b8ff999ef5fcea}{Success};
00450   \textcolor{keywordflow}{else}
00451     m\_info = \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5eaba1c8763d1179778070f365ecc4157a8}{NoConvergence};
00452 
00453   m\_isInitialized = \textcolor{keyword}{true};
00454   m\_matUisUptodate = computeU;
00455 \}
00456 
00457 \} \textcolor{comment}{// end namespace Eigen}
00458 
00459 \textcolor{preprocessor}{#endif // EIGEN\_COMPLEX\_SCHUR\_H}
\end{DoxyCode}
