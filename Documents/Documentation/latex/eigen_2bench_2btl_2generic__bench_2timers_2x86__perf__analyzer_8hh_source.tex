\hypertarget{eigen_2bench_2btl_2generic__bench_2timers_2x86__perf__analyzer_8hh_source}{}\section{eigen/bench/btl/generic\+\_\+bench/timers/x86\+\_\+perf\+\_\+analyzer.hh}
\label{eigen_2bench_2btl_2generic__bench_2timers_2x86__perf__analyzer_8hh_source}\index{x86\+\_\+perf\+\_\+analyzer.\+hh@{x86\+\_\+perf\+\_\+analyzer.\+hh}}

\begin{DoxyCode}
00001 \textcolor{comment}{//=====================================================}
00002 \textcolor{comment}{// File   :  x86\_perf\_analyzer.hh}
00003 \textcolor{comment}{// Author :  L. Plagne <laurent.plagne@edf.fr)>}
00004 \textcolor{comment}{// Copyright (C) EDF R&D,  mar dï¿½c 3 18:59:35 CET 2002}
00005 \textcolor{comment}{//=====================================================}
00006 \textcolor{comment}{//}
00007 \textcolor{comment}{// This program is free software; you can redistribute it and/or}
00008 \textcolor{comment}{// modify it under the terms of the GNU General Public License}
00009 \textcolor{comment}{// as published by the Free Software Foundation; either version 2}
00010 \textcolor{comment}{// of the License, or (at your option) any later version.}
00011 \textcolor{comment}{//}
00012 \textcolor{comment}{// This program is distributed in the hope that it will be useful,}
00013 \textcolor{comment}{// but WITHOUT ANY WARRANTY; without even the implied warranty of}
00014 \textcolor{comment}{// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00015 \textcolor{comment}{// GNU General Public License for more details.}
00016 \textcolor{comment}{// You should have received a copy of the GNU General Public License}
00017 \textcolor{comment}{// along with this program; if not, write to the Free Software}
00018 \textcolor{comment}{// Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.}
00019 \textcolor{comment}{//}
00020 \textcolor{preprocessor}{#ifndef \_X86\_PERF\_ANALYSER\_HH}
00021 \textcolor{preprocessor}{#define \_X86\_PERF\_ANALYSER\_HH}
00022 
00023 \textcolor{preprocessor}{#include "x86\_timer.hh"}
00024 \textcolor{preprocessor}{#include "bench\_parameter.hh"}
00025 
00026 \textcolor{keyword}{template}<\textcolor{keyword}{class} ACTION>
\Hypertarget{eigen_2bench_2btl_2generic__bench_2timers_2x86__perf__analyzer_8hh_source_l00027}\hyperlink{class_x86___perf___analyzer}{00027} \textcolor{keyword}{class }\hyperlink{class_x86___perf___analyzer}{X86\_Perf\_Analyzer}\{
00028 \textcolor{keyword}{public}:
00029   \hyperlink{class_x86___perf___analyzer}{X86\_Perf\_Analyzer}( \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} nb\_sample=DEFAULT\_NB\_SAMPLE):\_nb\_sample(nb\_sample)
      ,\_chronos()
00030   \{
00031     MESSAGE(\textcolor{stringliteral}{"X86\_Perf\_Analyzer Ctor"});
00032     \_chronos.\hyperlink{class_x86___timer_a1beddd8cb10ed89d3dd06d3b233b63e1}{find\_frequency}();
00033   \};
00034   \hyperlink{class_x86___perf___analyzer}{X86\_Perf\_Analyzer}( \textcolor{keyword}{const} \hyperlink{class_x86___perf___analyzer}{X86\_Perf\_Analyzer} & )\{
00035     INFOS(\textcolor{stringliteral}{"Copy Ctor not implemented"});
00036     exit(0);
00037   \};
00038   ~\hyperlink{class_x86___perf___analyzer}{X86\_Perf\_Analyzer}( \textcolor{keywordtype}{void} )\{
00039     MESSAGE(\textcolor{stringliteral}{"X86\_Perf\_Analyzer Dtor"});
00040   \};
00041 
00042 
00043   \textcolor{keyword}{inline} \textcolor{keywordtype}{double} eval\_mflops(\textcolor{keywordtype}{int} size)
00044   \{
00045 
00046     ACTION action(size);
00047 
00048     \textcolor{keywordtype}{int} nb\_loop=5;
00049     \textcolor{keywordtype}{double} calculate\_time=0.0;
00050     \textcolor{keywordtype}{double} baseline\_time=0.0;
00051 
00052     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j=0 ; j < nb\_loop ; j++)\{
00053 
00054       \_chronos.clear();
00055 
00056       \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0 ; i < \_nb\_sample  ; i++)
00057       \{
00058         \_chronos.start();
00059         action.initialize();
00060         action.calculate();
00061         \_chronos.stop();
00062         \_chronos.add\_get\_click();
00063       \}
00064 
00065       calculate\_time += double(\_chronos.get\_shortest\_clicks())/\_chronos.frequency();
00066 
00067       \textcolor{keywordflow}{if} (j==0) action.check\_result();
00068 
00069       \_chronos.clear();
00070 
00071       \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0 ; i < \_nb\_sample  ; i++)
00072       \{
00073         \_chronos.start();
00074         action.initialize();
00075         \_chronos.stop();
00076         \_chronos.add\_get\_click();
00077 
00078       \}
00079 
00080       baseline\_time+=double(\_chronos.get\_shortest\_clicks())/\_chronos.frequency();
00081 
00082     \}
00083 
00084     \textcolor{keywordtype}{double} corrected\_time = (calculate\_time-baseline\_time)/\textcolor{keywordtype}{double}(nb\_loop);
00085 
00086 
00087 \textcolor{comment}{//     INFOS("\_nb\_sample="<<\_nb\_sample);}
00088 \textcolor{comment}{//     INFOS("baseline\_time="<<baseline\_time);}
00089 \textcolor{comment}{//     INFOS("calculate\_time="<<calculate\_time);}
00090 \textcolor{comment}{//     INFOS("corrected\_time="<<corrected\_time);}
00091 
00092 \textcolor{comment}{//    cout << size <<" "<<baseline\_time<<" "<<calculate\_time<<" "<<corrected\_time<<" "<<action.nb\_op\_base()
       << endl;}
00093 
00094     \textcolor{keywordflow}{return} action.nb\_op\_base()/(corrected\_time*1000000.0);
00095     \textcolor{comment}{//return action.nb\_op\_base()/(calculate\_time*1000000.0);}
00096   \}
00097 
00098 \textcolor{keyword}{private}:
00099 
00100   \hyperlink{class_x86___timer}{X86\_Timer} \_chronos;
00101   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \_nb\_sample;
00102 
00103 
00104 \};
00105 
00106 
00107 
00108 \textcolor{preprocessor}{#endif}
\end{DoxyCode}
