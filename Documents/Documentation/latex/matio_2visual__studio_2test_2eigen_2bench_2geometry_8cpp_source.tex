\hypertarget{matio_2visual__studio_2test_2eigen_2bench_2geometry_8cpp_source}{}\section{matio/visual\+\_\+studio/test/eigen/bench/geometry.cpp}
\label{matio_2visual__studio_2test_2eigen_2bench_2geometry_8cpp_source}\index{geometry.\+cpp@{geometry.\+cpp}}

\begin{DoxyCode}
00001 
00002 \textcolor{preprocessor}{#include <iostream>}
00003 \textcolor{preprocessor}{#include <Eigen/Geometry>}
00004 \textcolor{preprocessor}{#include <bench/BenchTimer.h>}
00005 
00006 \textcolor{keyword}{using namespace }\hyperlink{namespacestd}{std};
00007 \textcolor{keyword}{using namespace }\hyperlink{namespace_eigen}{Eigen};
00008 
00009 \textcolor{preprocessor}{#ifndef SCALAR}
00010 \textcolor{preprocessor}{#define SCALAR float}
00011 \textcolor{preprocessor}{#endif}
00012 
00013 \textcolor{preprocessor}{#ifndef SIZE}
00014 \textcolor{preprocessor}{#define SIZE 8}
00015 \textcolor{preprocessor}{#endif}
00016 
00017 \textcolor{keyword}{typedef} SCALAR Scalar;
00018 \textcolor{keyword}{typedef} \hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<Scalar>::Real} RealScalar;
00019 \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<RealScalar,Dynamic,Dynamic>} \hyperlink{group___core___module_class_eigen_1_1_matrix}{A};
00020 \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix}<\textcolor{comment}{/*Real*/}Scalar,\hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Dynamic},\hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Dynamic}> \hyperlink{group___core___module_class_eigen_1_1_matrix}{B};
00021 \textcolor{keyword}{typedef} \hyperlink{group___core___module}{Matrix<Scalar,Dynamic,Dynamic>} \hyperlink{group___core___module}{C};
00022 \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<RealScalar,Dynamic,Dynamic>} \hyperlink{group___core___module_class_eigen_1_1_matrix}{M};
00023 
00024 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Transformation, \textcolor{keyword}{typename} Data>
00025 EIGEN\_DONT\_INLINE \textcolor{keywordtype}{void} transform(\textcolor{keyword}{const} \hyperlink{class_transformation}{Transformation}& t, Data& data)
00026 \{
00027   EIGEN\_ASM\_COMMENT(\textcolor{stringliteral}{"begin"});
00028   data = t * data;
00029   EIGEN\_ASM\_COMMENT(\textcolor{stringliteral}{"end"});
00030 \}
00031 
00032 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Scalar, \textcolor{keyword}{typename} Data>
00033 EIGEN\_DONT\_INLINE \textcolor{keywordtype}{void} transform(\textcolor{keyword}{const} \hyperlink{group___geometry___module_class_eigen_1_1_quaternion}{Quaternion<Scalar>}& t, Data& data)
00034 \{
00035   EIGEN\_ASM\_COMMENT(\textcolor{stringliteral}{"begin quat"});
00036   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0;i<data.cols();++i)
00037     data.col(i) = t * data.col(i);
00038   EIGEN\_ASM\_COMMENT(\textcolor{stringliteral}{"end quat"});
00039 \}
00040 
00041 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T> \textcolor{keyword}{struct }\hyperlink{struct_to_rotation_matrix_wrapper}{ToRotationMatrixWrapper}
00042 \{
00043   \textcolor{keyword}{enum} \{Dim = T::Dim\};
00044   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} T::Scalar Scalar;
00045   \hyperlink{struct_to_rotation_matrix_wrapper}{ToRotationMatrixWrapper}(\textcolor{keyword}{const} \hyperlink{group___sparse_core___module}{T}& o) : object(o) \{\}
00046   \hyperlink{group___sparse_core___module}{T} object;
00047 \};
00048 
00049 \textcolor{keyword}{template}<\textcolor{keyword}{typename} QType, \textcolor{keyword}{typename} Data>
00050 EIGEN\_DONT\_INLINE \textcolor{keywordtype}{void} transform(\textcolor{keyword}{const} \hyperlink{struct_to_rotation_matrix_wrapper}{ToRotationMatrixWrapper<QType>}& t, 
      Data& data)
00051 \{
00052   EIGEN\_ASM\_COMMENT(\textcolor{stringliteral}{"begin quat via mat"});
00053   data = t.object.toRotationMatrix() * data;
00054   EIGEN\_ASM\_COMMENT(\textcolor{stringliteral}{"end quat via mat"});
00055 \}
00056 
00057 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Scalar, \textcolor{keywordtype}{int} Dim, \textcolor{keyword}{typename} Data>
00058 EIGEN\_DONT\_INLINE \textcolor{keywordtype}{void} transform(\textcolor{keyword}{const} \hyperlink{group___geometry___module_class_eigen_1_1_transform}{Transform<Scalar,Dim,Projective>}& t,
       Data& data)
00059 \{
00060   data = (t * data.colwise().homogeneous()).\textcolor{keyword}{template} block<Dim,Data::ColsAtCompileTime>(0,0);
00061 \}
00062 
00063 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T> \textcolor{keyword}{struct }\hyperlink{structget__dim}{get\_dim} \{ \textcolor{keyword}{enum} \{ Dim = T::Dim \}; \};
00064 \textcolor{keyword}{template}<\textcolor{keyword}{typename} S, \textcolor{keywordtype}{int} R, \textcolor{keywordtype}{int} C, \textcolor{keywordtype}{int} O, \textcolor{keywordtype}{int} MR, \textcolor{keywordtype}{int} MC>
00065 \textcolor{keyword}{struct }\hyperlink{structget__dim}{get\_dim}<\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix}<S,R,\hyperlink{group___core___module}{C},O,MR,MC> > \{ \textcolor{keyword}{enum} \{ Dim = R \}; \};
00066 
00067 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Transformation, \textcolor{keywordtype}{int} N>
00068 \textcolor{keyword}{struct }\hyperlink{structbench__impl}{bench\_impl}
00069 \{
00070   \textcolor{keyword}{static} EIGEN\_DONT\_INLINE \textcolor{keywordtype}{void} run(\textcolor{keyword}{const} \hyperlink{class_transformation}{Transformation}& t)
00071   \{
00072     \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<typename Transformation::Scalar,get\_dim<Transformation>::Dim}
      ,N> data;
00073     data.\hyperlink{class_eigen_1_1_plain_object_base_af0e576a0e1aefc9ee346de44cc352ba3}{setRandom}();
00074     \hyperlink{structbench__impl}{bench\_impl<Transformation,N-1>::run}(t);
00075     \hyperlink{class_eigen_1_1_bench_timer}{BenchTimer} timer;
00076     BENCH(timer,10,100000,transform(t,data));
00077     cout.width(9);
00078     cout << timer.\hyperlink{class_eigen_1_1_bench_timer_ae8b673b0fa356d3432c7a65c79e8af0e}{best}() << \textcolor{stringliteral}{" "};
00079   \}
00080 \};
00081 
00082 
00083 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Transformation>
00084 \textcolor{keyword}{struct }\hyperlink{structbench__impl}{bench\_impl}<\hyperlink{class_transformation}{Transformation},0>
00085 \{
00086   \textcolor{keyword}{static} EIGEN\_DONT\_INLINE \textcolor{keywordtype}{void} run(\textcolor{keyword}{const} \hyperlink{class_transformation}{Transformation}&) \{\}
00087 \};
00088 
00089 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Transformation>
00090 EIGEN\_DONT\_INLINE \textcolor{keywordtype}{void} bench(\textcolor{keyword}{const} std::string& msg, \textcolor{keyword}{const} \hyperlink{class_transformation}{Transformation}& t)
00091 \{
00092   cout << msg << \textcolor{stringliteral}{" "};
00093   \hyperlink{structbench__impl}{bench\_impl<Transformation,SIZE>::run}(t);
00094   std::cout << \textcolor{stringliteral}{"\(\backslash\)n"};
00095 \}
00096 
00097 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} ** argv)
00098 \{
00099   \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,3,4>} mat34; mat34.\hyperlink{class_eigen_1_1_plain_object_base_af0e576a0e1aefc9ee346de44cc352ba3}{setRandom}();
00100   \hyperlink{group___geometry___module_class_eigen_1_1_transform}{Transform<Scalar,3,Isometry>} iso3(mat34);
00101   \hyperlink{group___geometry___module_class_eigen_1_1_transform}{Transform<Scalar,3,Affine>} aff3(mat34);
00102   \hyperlink{group___geometry___module_class_eigen_1_1_transform}{Transform<Scalar,3,AffineCompact>} caff3(mat34);
00103   \hyperlink{group___geometry___module_class_eigen_1_1_transform}{Transform<Scalar,3,Projective>} proj3(mat34);
00104   \hyperlink{group___geometry___module_class_eigen_1_1_quaternion}{Quaternion<Scalar>} quat;quat.\hyperlink{group___geometry___module_a113a5ffea680c7427dc1144d7c66efe9}{setIdentity}();
00105   \hyperlink{struct_to_rotation_matrix_wrapper}{ToRotationMatrixWrapper<Quaternion<Scalar>} > quatmat(quat);
00106   \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,3,3>} mat33; mat33.\hyperlink{class_eigen_1_1_plain_object_base_af0e576a0e1aefc9ee346de44cc352ba3}{setRandom}();
00107   
00108   cout.precision(4);
00109   std::cout
00110      << \textcolor{stringliteral}{"N          "};
00111   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0;i<SIZE;++i)
00112   \{
00113     cout.width(9);
00114     cout << i+1 << \textcolor{stringliteral}{" "};
00115   \}
00116   cout << \textcolor{stringliteral}{"\(\backslash\)n"};
00117   
00118   bench(\textcolor{stringliteral}{"matrix 3x3"}, mat33);
00119   bench(\textcolor{stringliteral}{"quaternion"}, quat);
00120   bench(\textcolor{stringliteral}{"quat-mat  "}, quatmat);
00121   bench(\textcolor{stringliteral}{"isometry3 "}, iso3);
00122   bench(\textcolor{stringliteral}{"affine3   "}, aff3);
00123   bench(\textcolor{stringliteral}{"c affine3 "}, caff3);
00124   bench(\textcolor{stringliteral}{"proj3     "}, proj3);
00125 \}
00126 
\end{DoxyCode}
