\hypertarget{eigen_2_eigen_2src_2_sparse_core_2_sparse_diagonal_product_8h_source}{}\section{eigen/\+Eigen/src/\+Sparse\+Core/\+Sparse\+Diagonal\+Product.h}
\label{eigen_2_eigen_2src_2_sparse_core_2_sparse_diagonal_product_8h_source}\index{Sparse\+Diagonal\+Product.\+h@{Sparse\+Diagonal\+Product.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2009-2015 Gael Guennebaud <gael.guennebaud@inria.fr>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#ifndef EIGEN\_SPARSE\_DIAGONAL\_PRODUCT\_H}
00011 \textcolor{preprocessor}{#define EIGEN\_SPARSE\_DIAGONAL\_PRODUCT\_H}
00012 
00013 \textcolor{keyword}{namespace }\hyperlink{namespace_eigen}{Eigen} \{ 
00014 
00015 \textcolor{comment}{// The product of a diagonal matrix with a sparse matrix can be easily}
00016 \textcolor{comment}{// implemented using expression template.}
00017 \textcolor{comment}{// We have two consider very different cases:}
00018 \textcolor{comment}{// 1 - diag * row-major sparse}
00019 \textcolor{comment}{//     => each inner vector <=> scalar * sparse vector product}
00020 \textcolor{comment}{//     => so we can reuse CwiseUnaryOp::InnerIterator}
00021 \textcolor{comment}{// 2 - diag * col-major sparse}
00022 \textcolor{comment}{//     => each inner vector <=> densevector * sparse vector cwise product}
00023 \textcolor{comment}{//     => again, we can reuse specialization of CwiseBinaryOp::InnerIterator}
00024 \textcolor{comment}{//        for that particular case}
00025 \textcolor{comment}{// The two other cases are symmetric.}
00026 
00027 \textcolor{keyword}{namespace }\hyperlink{namespaceinternal}{internal} \{
00028 
00029 \textcolor{keyword}{enum} \{
00030   SDP\_AsScalarProduct,
00031   SDP\_AsCwiseProduct
00032 \};
00033   
00034 \textcolor{keyword}{template}<\textcolor{keyword}{typename} SparseXprType, \textcolor{keyword}{typename} DiagonalCoeffType, \textcolor{keywordtype}{int} SDP\_Tag>
\Hypertarget{eigen_2_eigen_2src_2_sparse_core_2_sparse_diagonal_product_8h_source_l00035}\hyperlink{struct_eigen_1_1internal_1_1sparse__diagonal__product__evaluator}{00035} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1sparse__diagonal__product__evaluator}{sparse\_diagonal\_product\_evaluator};
00036 
00037 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Lhs, \textcolor{keyword}{typename} Rhs, \textcolor{keywordtype}{int} ProductTag>
\Hypertarget{eigen_2_eigen_2src_2_sparse_core_2_sparse_diagonal_product_8h_source_l00038}\hyperlink{struct_eigen_1_1internal_1_1product__evaluator_3_01_product_3_01_lhs_00_01_rhs_00_01_default_pro850b56c5eb8e297547f40d125e705127}{00038} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1product__evaluator}{product\_evaluator}<\hyperlink{group___core___module_class_eigen_1_1_product}{Product}<Lhs, Rhs, DefaultProduct>, ProductTag, 
      \hyperlink{struct_eigen_1_1_diagonal_shape}{DiagonalShape}, \hyperlink{struct_eigen_1_1_sparse_shape}{SparseShape}>
00039   : \textcolor{keyword}{public} \hyperlink{struct_eigen_1_1internal_1_1sparse__diagonal__product__evaluator}{sparse\_diagonal\_product\_evaluator}<Rhs, typename Lhs::DiagonalVe
      ctorType, Rhs::Flags&RowMajorBit?SDP\_AsScalarProduct:SDP\_AsCwiseProduct>
00040 \{
00041   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_product}{Product<Lhs, Rhs, DefaultProduct>} 
      \hyperlink{group___core___module_class_eigen_1_1_product}{XprType};
00042   \textcolor{keyword}{enum} \{ CoeffReadCost = \hyperlink{namespace_eigen_a3163430a1c13173faffde69016b48aaf}{HugeCost}, Flags = Rhs::Flags&\hyperlink{group__flags_gae4f56c2a60bbe4bd2e44c5b19cbe8762}{RowMajorBit}, Alignment = 0 \}; \textcolor{comment}{//
       FIXME CoeffReadCost & Flags}
00043   
00044   \textcolor{keyword}{typedef} 
      \hyperlink{struct_eigen_1_1internal_1_1sparse__diagonal__product__evaluator}{sparse\_diagonal\_product\_evaluator<Rhs, typename Lhs::DiagonalVectorType,
       Rhs::Flags&RowMajorBit?SDP\_AsScalarProduct:SDP\_AsCwiseProduct>}
       \hyperlink{struct_eigen_1_1internal_1_1sparse__diagonal__product__evaluator}{Base};
00045   \textcolor{keyword}{explicit} \hyperlink{struct_eigen_1_1internal_1_1product__evaluator}{product\_evaluator}(\textcolor{keyword}{const} XprType& xpr) : Base(xpr.rhs(), xpr.lhs().diagonal()) \{
      \}
00046 \};
00047 
00048 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Lhs, \textcolor{keyword}{typename} Rhs, \textcolor{keywordtype}{int} ProductTag>
\Hypertarget{eigen_2_eigen_2src_2_sparse_core_2_sparse_diagonal_product_8h_source_l00049}\hyperlink{struct_eigen_1_1internal_1_1product__evaluator_3_01_product_3_01_lhs_00_01_rhs_00_01_default_prod80b2bd6031901e266d576d7eb3e9735}{00049} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1product__evaluator}{product\_evaluator}<\hyperlink{group___core___module_class_eigen_1_1_product}{Product}<Lhs, Rhs, DefaultProduct>, ProductTag, 
      \hyperlink{struct_eigen_1_1_sparse_shape}{SparseShape}, \hyperlink{struct_eigen_1_1_diagonal_shape}{DiagonalShape}>
00050   : \textcolor{keyword}{public} \hyperlink{struct_eigen_1_1internal_1_1sparse__diagonal__product__evaluator}{sparse\_diagonal\_product\_evaluator}<Lhs, Transpose<const typename
       Rhs::DiagonalVectorType>, Lhs::Flags&RowMajorBit?SDP\_AsCwiseProduct:SDP\_AsScalarProduct>
00051 \{
00052   \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_product}{Product<Lhs, Rhs, DefaultProduct>} 
      \hyperlink{group___core___module_class_eigen_1_1_product}{XprType};
00053   \textcolor{keyword}{enum} \{ CoeffReadCost = \hyperlink{namespace_eigen_a3163430a1c13173faffde69016b48aaf}{HugeCost}, Flags = Lhs::Flags&\hyperlink{group__flags_gae4f56c2a60bbe4bd2e44c5b19cbe8762}{RowMajorBit}, Alignment = 0 \}; \textcolor{comment}{//
       FIXME CoeffReadCost & Flags}
00054   
00055   \textcolor{keyword}{typedef} 
      \hyperlink{struct_eigen_1_1internal_1_1sparse__diagonal__product__evaluator}{sparse\_diagonal\_product\_evaluator<Lhs, Transpose<const typename Rhs::DiagonalVectorType>}
      , Lhs::Flags&\hyperlink{group__flags_gae4f56c2a60bbe4bd2e44c5b19cbe8762}{RowMajorBit}?SDP\_AsCwiseProduct:SDP\_AsScalarProduct> \hyperlink{struct_eigen_1_1internal_1_1sparse__diagonal__product__evaluator}{Base};
00056   \textcolor{keyword}{explicit} \hyperlink{struct_eigen_1_1internal_1_1product__evaluator}{product\_evaluator}(\textcolor{keyword}{const} XprType& xpr) : Base(xpr.lhs(), xpr.rhs().diagonal().
      transpose()) \{\}
00057 \};
00058 
00059 \textcolor{keyword}{template}<\textcolor{keyword}{typename} SparseXprType, \textcolor{keyword}{typename} DiagonalCoeffType>
\Hypertarget{eigen_2_eigen_2src_2_sparse_core_2_sparse_diagonal_product_8h_source_l00060}\hyperlink{struct_eigen_1_1internal_1_1sparse__diagonal__product__evaluator_3_01_sparse_xpr_type_00_01_diag3ebd66799ce02a814119c716700b9642}{00060} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1sparse__diagonal__product__evaluator}{sparse\_diagonal\_product\_evaluator}<SparseXprType, DiagonalCoeffType,
       SDP\_AsScalarProduct>
00061 \{
00062 \textcolor{keyword}{protected}:
00063   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1evaluator}{evaluator<SparseXprType>::InnerIterator} 
      SparseXprInnerIterator;
00064   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} SparseXprType::Scalar Scalar;
00065   
00066 \textcolor{keyword}{public}:
\Hypertarget{eigen_2_eigen_2src_2_sparse_core_2_sparse_diagonal_product_8h_source_l00067}\hyperlink{class_eigen_1_1internal_1_1sparse__diagonal__product__evaluator_3_01_sparse_xpr_type_00_01_diagocbb91bd40f7346bf4110a7aa087884f6}{00067}   \textcolor{keyword}{class }\hyperlink{class_eigen_1_1_inner_iterator}{InnerIterator} : \textcolor{keyword}{public} SparseXprInnerIterator
00068   \{
00069   \textcolor{keyword}{public}:
00070     \hyperlink{class_eigen_1_1_inner_iterator}{InnerIterator}(\textcolor{keyword}{const} \hyperlink{struct_eigen_1_1internal_1_1sparse__diagonal__product__evaluator}{sparse\_diagonal\_product\_evaluator} &
      xprEval, \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} outer)
00071       : SparseXprInnerIterator(xprEval.m\_sparseXprImpl, outer),
00072         m\_coeff(xprEval.m\_diagCoeffImpl.coeff(outer))
00073     \{\}
00074     
00075     EIGEN\_STRONG\_INLINE Scalar value()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_coeff * SparseXprInnerIterator::value(); \}
00076   \textcolor{keyword}{protected}:
00077     \textcolor{keyword}{typename} DiagonalCoeffType::Scalar m\_coeff;
00078   \};
00079   
00080   \hyperlink{struct_eigen_1_1internal_1_1sparse__diagonal__product__evaluator}{sparse\_diagonal\_product\_evaluator}(\textcolor{keyword}{const} SparseXprType &sparseXpr, \textcolor{keyword}{const} 
      DiagonalCoeffType &diagCoeff)
00081     : m\_sparseXprImpl(sparseXpr), m\_diagCoeffImpl(diagCoeff)
00082   \{\}
00083 
00084   \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} nonZerosEstimate()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_sparseXprImpl.nonZerosEstimate(); \}
00085     
00086 \textcolor{keyword}{protected}:
00087   \hyperlink{struct_eigen_1_1internal_1_1evaluator}{evaluator<SparseXprType>} m\_sparseXprImpl;
00088   \hyperlink{struct_eigen_1_1internal_1_1evaluator}{evaluator<DiagonalCoeffType>} m\_diagCoeffImpl;
00089 \};
00090 
00091 
00092 \textcolor{keyword}{template}<\textcolor{keyword}{typename} SparseXprType, \textcolor{keyword}{typename} DiagCoeffType>
\Hypertarget{eigen_2_eigen_2src_2_sparse_core_2_sparse_diagonal_product_8h_source_l00093}\hyperlink{struct_eigen_1_1internal_1_1sparse__diagonal__product__evaluator_3_01_sparse_xpr_type_00_01_diag5c533b27b8fe485cf13e7ad699b99003}{00093} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1sparse__diagonal__product__evaluator}{sparse\_diagonal\_product\_evaluator}<SparseXprType, DiagCoeffType, 
      SDP\_AsCwiseProduct>
00094 \{
00095   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} SparseXprType::Scalar Scalar;
00096   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} SparseXprType::StorageIndex StorageIndex;
00097   
00098   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1nested__eval}{nested\_eval}<DiagCoeffType,SparseXprType::IsRowMajor ? 
      SparseXprType::RowsAtCompileTime
00099                                                                        : SparseXprType::ColsAtCompileTime>
      ::type DiagCoeffNested;
00100   
\Hypertarget{eigen_2_eigen_2src_2_sparse_core_2_sparse_diagonal_product_8h_source_l00101}\hyperlink{class_eigen_1_1internal_1_1sparse__diagonal__product__evaluator_3_01_sparse_xpr_type_00_01_diag_f44167c623880e382ac76ec71f78299c}{00101}   \textcolor{keyword}{class }\hyperlink{class_eigen_1_1_inner_iterator}{InnerIterator}
00102   \{
00103     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{struct_eigen_1_1internal_1_1evaluator}{evaluator<SparseXprType>::InnerIterator} 
      SparseXprIter;
00104   \textcolor{keyword}{public}:
00105     \hyperlink{class_eigen_1_1_inner_iterator}{InnerIterator}(\textcolor{keyword}{const} \hyperlink{struct_eigen_1_1internal_1_1sparse__diagonal__product__evaluator}{sparse\_diagonal\_product\_evaluator} &
      xprEval, \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} outer)
00106       : m\_sparseIter(xprEval.m\_sparseXprEval, outer), m\_diagCoeffNested(xprEval.m\_diagCoeffNested)
00107     \{\}
00108     
00109     \textcolor{keyword}{inline} Scalar value()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_sparseIter.value() * m\_diagCoeffNested.coeff(index()); \}
00110     \textcolor{keyword}{inline} StorageIndex index()\textcolor{keyword}{ const  }\{ \textcolor{keywordflow}{return} m\_sparseIter.index(); \}
00111     \textcolor{keyword}{inline} \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} outer()\textcolor{keyword}{ const  }\{ \textcolor{keywordflow}{return} m\_sparseIter.outer(); \}
00112     \textcolor{keyword}{inline} \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} col()\textcolor{keyword}{ const    }\{ \textcolor{keywordflow}{return} SparseXprType::IsRowMajor ? m\_sparseIter.index() : 
      m\_sparseIter.outer(); \}
00113     \textcolor{keyword}{inline} \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} row()\textcolor{keyword}{ const    }\{ \textcolor{keywordflow}{return} SparseXprType::IsRowMajor ? m\_sparseIter.outer() : 
      m\_sparseIter.index(); \}
00114     
00115     EIGEN\_STRONG\_INLINE \hyperlink{class_eigen_1_1_inner_iterator}{InnerIterator}& operator++() \{ ++m\_sparseIter; \textcolor{keywordflow}{return} *\textcolor{keyword}{this}; \}
00116     \textcolor{keyword}{inline} \textcolor{keyword}{operator} bool()\textcolor{keyword}{ const  }\{ \textcolor{keywordflow}{return} m\_sparseIter; \}
00117     
00118   \textcolor{keyword}{protected}:
00119     SparseXprIter m\_sparseIter;
00120     DiagCoeffNested m\_diagCoeffNested;
00121   \};
00122   
00123   \hyperlink{struct_eigen_1_1internal_1_1sparse__diagonal__product__evaluator}{sparse\_diagonal\_product\_evaluator}(\textcolor{keyword}{const} SparseXprType &sparseXpr, \textcolor{keyword}{const} 
      DiagCoeffType &diagCoeff)
00124     : m\_sparseXprEval(sparseXpr), m\_diagCoeffNested(diagCoeff)
00125   \{\}
00126 
00127   \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} nonZerosEstimate()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_sparseXprEval.nonZerosEstimate(); \}
00128     
00129 \textcolor{keyword}{protected}:
00130   \hyperlink{struct_eigen_1_1internal_1_1evaluator}{evaluator<SparseXprType>} m\_sparseXprEval;
00131   DiagCoeffNested m\_diagCoeffNested;
00132 \};
00133 
00134 \} \textcolor{comment}{// end namespace internal}
00135 
00136 \} \textcolor{comment}{// end namespace Eigen}
00137 
00138 \textcolor{preprocessor}{#endif // EIGEN\_SPARSE\_DIAGONAL\_PRODUCT\_H}
\end{DoxyCode}
