\hypertarget{eigen_2_eigen_2src_2_core_2products_2_triangular_matrix_vector_8h_source}{}\section{eigen/\+Eigen/src/\+Core/products/\+Triangular\+Matrix\+Vector.h}
\label{eigen_2_eigen_2src_2_core_2products_2_triangular_matrix_vector_8h_source}\index{Triangular\+Matrix\+Vector.\+h@{Triangular\+Matrix\+Vector.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2009 Gael Guennebaud <gael.guennebaud@inria.fr>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#ifndef EIGEN\_TRIANGULARMATRIXVECTOR\_H}
00011 \textcolor{preprocessor}{#define EIGEN\_TRIANGULARMATRIXVECTOR\_H}
00012 
00013 \textcolor{keyword}{namespace }\hyperlink{namespace_eigen}{Eigen} \{
00014 
00015 \textcolor{keyword}{namespace }\hyperlink{namespaceinternal}{internal} \{
00016 
00017 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Index, \textcolor{keywordtype}{int} Mode, \textcolor{keyword}{typename} LhsScalar, \textcolor{keywordtype}{bool} ConjLhs, \textcolor{keyword}{typename} RhsScalar, \textcolor{keywordtype}{bool} ConjRhs, \textcolor{keywordtype}{int} 
      StorageOrder, \textcolor{keywordtype}{int} Version=Specialized>
\Hypertarget{eigen_2_eigen_2src_2_core_2products_2_triangular_matrix_vector_8h_source_l00018}\hyperlink{struct_eigen_1_1internal_1_1triangular__matrix__vector__product}{00018} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1triangular__matrix__vector__product}{triangular\_matrix\_vector\_product};
00019 
00020 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Index, \textcolor{keywordtype}{int} Mode, \textcolor{keyword}{typename} LhsScalar, \textcolor{keywordtype}{bool} ConjLhs, \textcolor{keyword}{typename} RhsScalar, \textcolor{keywordtype}{bool} ConjRhs, \textcolor{keywordtype}{int} 
      Version>
\Hypertarget{eigen_2_eigen_2src_2_core_2products_2_triangular_matrix_vector_8h_source_l00021}\hyperlink{struct_eigen_1_1internal_1_1triangular__matrix__vector__product_3_01_index_00_01_mode_00_01_lhs_ba3c1ba3cb379196807b17d99fce4e08}{00021} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1triangular__matrix__vector__product}{triangular\_matrix\_vector\_product}<\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index},Mode,LhsScalar,ConjLhs,
      RhsScalar,ConjRhs,\hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor},Version>
00022 \{
00023   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___core___module_struct_eigen_1_1_scalar_binary_op_traits}{ScalarBinaryOpTraits<LhsScalar, RhsScalar>::ReturnType}
       ResScalar;
00024   \textcolor{keyword}{enum} \{
00025     IsLower = ((Mode&\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda891792b8ed394f7607ab16dd716f60e6}{Lower})==\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda891792b8ed394f7607ab16dd716f60e6}{Lower}),
00026     HasUnitDiag = (Mode & \hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cdaddb72f888ac85d5a1c52333e54f9374b}{UnitDiag})==\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cdaddb72f888ac85d5a1c52333e54f9374b}{UnitDiag},
00027     HasZeroDiag = (Mode & \hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda884ff7240392e85aa6e4b3c957e36483}{ZeroDiag})==ZeroDiag
00028   \};
00029   \textcolor{keyword}{static} EIGEN\_DONT\_INLINE  \textcolor{keywordtype}{void} run(\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} \_rows, \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} \_cols, \textcolor{keyword}{const} LhsScalar* \_lhs, 
      \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} lhsStride,
00030                                      \textcolor{keyword}{const} RhsScalar* \_rhs, \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} rhsIncr, ResScalar* \_res, 
      \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} resIncr, \textcolor{keyword}{const} RhsScalar& alpha);
00031 \};
00032 
00033 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Index, \textcolor{keywordtype}{int} Mode, \textcolor{keyword}{typename} LhsScalar, \textcolor{keywordtype}{bool} ConjLhs, \textcolor{keyword}{typename} RhsScalar, \textcolor{keywordtype}{bool} ConjRhs, \textcolor{keywordtype}{int} 
      Version>
00034 EIGEN\_DONT\_INLINE \textcolor{keywordtype}{void} 
      \hyperlink{struct_eigen_1_1internal_1_1triangular__matrix__vector__product}{triangular\_matrix\_vector\_product<Index,Mode,LhsScalar,ConjLhs,RhsScalar,ConjRhs,ColMajor,Version>}
00035 \hyperlink{struct_eigen_1_1internal_1_1triangular__matrix__vector__product}{  ::run}(\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} \_rows, \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} \_cols, \textcolor{keyword}{const} LhsScalar* \_lhs, \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} lhsStride,
00036         \textcolor{keyword}{const} RhsScalar* \_rhs, \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} rhsIncr, ResScalar* \_res, \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} resIncr, \textcolor{keyword}{const} RhsScalar& 
      alpha)
00037   \{
00038     \textcolor{keyword}{static} \textcolor{keyword}{const} \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} PanelWidth = EIGEN\_TUNE\_TRIANGULAR\_PANEL\_WIDTH;
00039     \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} size = (std::min)(\_rows,\_cols);
00040     \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} rows = IsLower ? \_rows : (std::min)(\_rows,\_cols);
00041     \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} cols = IsLower ? (std::min)(\_rows,\_cols) : \_cols;
00042 
00043     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_map}{Map<const Matrix<LhsScalar,Dynamic,Dynamic,ColMajor>}
      , 0, \hyperlink{class_eigen_1_1_outer_stride}{OuterStride<>} > LhsMap;
00044     \textcolor{keyword}{const} LhsMap lhs(\_lhs,rows,cols,\hyperlink{class_eigen_1_1_outer_stride}{OuterStride<>}(lhsStride));
00045     \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{conj\_expr\_if<ConjLhs,LhsMap>::type} cjLhs(lhs);
00046 
00047     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_map}{Map<const Matrix<RhsScalar,Dynamic,1>}, 0, 
      \hyperlink{class_eigen_1_1_inner_stride}{InnerStride<>} > RhsMap;
00048     \textcolor{keyword}{const} RhsMap rhs(\_rhs,cols,\hyperlink{class_eigen_1_1_inner_stride}{InnerStride<>}(rhsIncr));
00049     \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{conj\_expr\_if<ConjRhs,RhsMap>::type} cjRhs(rhs);
00050 
00051     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_map}{Map<Matrix<ResScalar,Dynamic,1>} > ResMap;
00052     ResMap res(\_res,rows);
00053 
00054     \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1internal_1_1const__blas__data__mapper}{const\_blas\_data\_mapper<LhsScalar,Index,ColMajor>}
       LhsMapper;
00055     \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1internal_1_1const__blas__data__mapper}{const\_blas\_data\_mapper<RhsScalar,Index,RowMajor>}
       RhsMapper;
00056 
00057     \textcolor{keywordflow}{for} (\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} pi=0; pi<size; pi+=PanelWidth)
00058     \{
00059       \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} actualPanelWidth = (std::min)(PanelWidth, size-pi);
00060       \textcolor{keywordflow}{for} (\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} k=0; k<actualPanelWidth; ++k)
00061       \{
00062         \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} i = pi + k;
00063         \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} s = IsLower ? ((HasUnitDiag||HasZeroDiag) ? i+1 : i ) : pi;
00064         \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} r = IsLower ? actualPanelWidth-k : k+1;
00065         \textcolor{keywordflow}{if} ((!(HasUnitDiag||HasZeroDiag)) || (--r)>0)
00066           res.segment(s,r) += (alpha * cjRhs.coeff(i)) * cjLhs.\hyperlink{group___sparse_core___module_a3531e3e2098507a069a368d72d46471e}{col}(i).\hyperlink{group___sparse_core___module_adf94a8461a773fb4b0daedaa9980b054}{segment}(s,r);
00067         \textcolor{keywordflow}{if} (HasUnitDiag)
00068           res.coeffRef(i) += alpha * cjRhs.coeff(i);
00069       \}
00070       \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} r = IsLower ? rows - pi - actualPanelWidth : pi;
00071       \textcolor{keywordflow}{if} (r>0)
00072       \{
00073         \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} s = IsLower ? pi+actualPanelWidth : 0;
00074         
      \hyperlink{struct_eigen_1_1internal_1_1general__matrix__vector__product}{
      general\_matrix\_vector\_product<Index,LhsScalar,LhsMapper,ColMajor,ConjLhs,RhsScalar,RhsMapper,ConjRhs,BuiltIn>::run}
      (
00075             r, actualPanelWidth,
00076             LhsMapper(&lhs.coeffRef(s,pi), lhsStride),
00077             RhsMapper(&rhs.coeffRef(pi), rhsIncr),
00078             &res.coeffRef(s), resIncr, alpha);
00079       \}
00080     \}
00081     \textcolor{keywordflow}{if}((!IsLower) && cols>size)
00082     \{
00083       
      \hyperlink{struct_eigen_1_1internal_1_1general__matrix__vector__product}{general\_matrix\_vector\_product<Index,LhsScalar,LhsMapper,ColMajor,ConjLhs,RhsScalar,RhsMapper,ConjRhs>::run}
      (
00084           rows, cols-size,
00085           LhsMapper(&lhs.coeffRef(0,size), lhsStride),
00086           RhsMapper(&rhs.coeffRef(size), rhsIncr),
00087           \_res, resIncr, alpha);
00088     \}
00089   \}
00090 
00091 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Index, \textcolor{keywordtype}{int} Mode, \textcolor{keyword}{typename} LhsScalar, \textcolor{keywordtype}{bool} ConjLhs, \textcolor{keyword}{typename} RhsScalar, \textcolor{keywordtype}{bool} ConjRhs,\textcolor{keywordtype}{int} V
      ersion>
\Hypertarget{eigen_2_eigen_2src_2_core_2products_2_triangular_matrix_vector_8h_source_l00092}\hyperlink{struct_eigen_1_1internal_1_1triangular__matrix__vector__product_3_01_index_00_01_mode_00_01_lhs_ba3b9cdc80cdaeff44c1d1ed32cbe15b}{00092} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1triangular__matrix__vector__product}{triangular\_matrix\_vector\_product}<\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index},Mode,LhsScalar,ConjLhs,
      RhsScalar,ConjRhs,\hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13acfcde9cd8677c5f7caf6bd603666aae3}{RowMajor},Version>
00093 \{
00094   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___core___module_struct_eigen_1_1_scalar_binary_op_traits}{ScalarBinaryOpTraits<LhsScalar, RhsScalar>::ReturnType}
       ResScalar;
00095   \textcolor{keyword}{enum} \{
00096     IsLower = ((Mode&\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda891792b8ed394f7607ab16dd716f60e6}{Lower})==\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda891792b8ed394f7607ab16dd716f60e6}{Lower}),
00097     HasUnitDiag = (Mode & \hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cdaddb72f888ac85d5a1c52333e54f9374b}{UnitDiag})==\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cdaddb72f888ac85d5a1c52333e54f9374b}{UnitDiag},
00098     HasZeroDiag = (Mode & \hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda884ff7240392e85aa6e4b3c957e36483}{ZeroDiag})==ZeroDiag
00099   \};
00100   \textcolor{keyword}{static} EIGEN\_DONT\_INLINE \textcolor{keywordtype}{void} run(\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} \_rows, \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} \_cols, \textcolor{keyword}{const} LhsScalar* \_lhs, 
      \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} lhsStride,
00101                                     \textcolor{keyword}{const} RhsScalar* \_rhs, \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} rhsIncr, ResScalar* \_res, 
      \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} resIncr, \textcolor{keyword}{const} ResScalar& alpha);
00102 \};
00103 
00104 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Index, \textcolor{keywordtype}{int} Mode, \textcolor{keyword}{typename} LhsScalar, \textcolor{keywordtype}{bool} ConjLhs, \textcolor{keyword}{typename} RhsScalar, \textcolor{keywordtype}{bool} ConjRhs,\textcolor{keywordtype}{int} V
      ersion>
00105 EIGEN\_DONT\_INLINE \textcolor{keywordtype}{void} 
      \hyperlink{struct_eigen_1_1internal_1_1triangular__matrix__vector__product}{triangular\_matrix\_vector\_product<Index,Mode,LhsScalar,ConjLhs,RhsScalar,ConjRhs,RowMajor,Version>}
00106 \hyperlink{struct_eigen_1_1internal_1_1triangular__matrix__vector__product}{  ::run}(\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} \_rows, \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} \_cols, \textcolor{keyword}{const} LhsScalar* \_lhs, \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} lhsStride,
00107         \textcolor{keyword}{const} RhsScalar* \_rhs, \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} rhsIncr, ResScalar* \_res, \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} resIncr, \textcolor{keyword}{const} ResScalar& 
      alpha)
00108   \{
00109     \textcolor{keyword}{static} \textcolor{keyword}{const} \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} PanelWidth = EIGEN\_TUNE\_TRIANGULAR\_PANEL\_WIDTH;
00110     \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} diagSize = (std::min)(\_rows,\_cols);
00111     \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} rows = IsLower ? \_rows : diagSize;
00112     \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} cols = IsLower ? diagSize : \_cols;
00113 
00114     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_map}{Map<const Matrix<LhsScalar,Dynamic,Dynamic,RowMajor>}
      , 0, \hyperlink{class_eigen_1_1_outer_stride}{OuterStride<>} > LhsMap;
00115     \textcolor{keyword}{const} LhsMap lhs(\_lhs,rows,cols,\hyperlink{class_eigen_1_1_outer_stride}{OuterStride<>}(lhsStride));
00116     \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{conj\_expr\_if<ConjLhs,LhsMap>::type} cjLhs(lhs);
00117 
00118     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_map}{Map<const Matrix<RhsScalar,Dynamic,1>} > RhsMap;
00119     \textcolor{keyword}{const} RhsMap rhs(\_rhs,cols);
00120     \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{conj\_expr\_if<ConjRhs,RhsMap>::type} cjRhs(rhs);
00121 
00122     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_map}{Map<Matrix<ResScalar,Dynamic,1>}, 0, 
      \hyperlink{class_eigen_1_1_inner_stride}{InnerStride<>} > ResMap;
00123     ResMap res(\_res,rows,\hyperlink{class_eigen_1_1_inner_stride}{InnerStride<>}(resIncr));
00124 
00125     \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1internal_1_1const__blas__data__mapper}{const\_blas\_data\_mapper<LhsScalar,Index,RowMajor>}
       LhsMapper;
00126     \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1internal_1_1const__blas__data__mapper}{const\_blas\_data\_mapper<RhsScalar,Index,RowMajor>}
       RhsMapper;
00127 
00128     \textcolor{keywordflow}{for} (\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} pi=0; pi<diagSize; pi+=PanelWidth)
00129     \{
00130       \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} actualPanelWidth = (std::min)(PanelWidth, diagSize-pi);
00131       \textcolor{keywordflow}{for} (\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} k=0; k<actualPanelWidth; ++k)
00132       \{
00133         \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} i = pi + k;
00134         \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} s = IsLower ? pi  : ((HasUnitDiag||HasZeroDiag) ? i+1 : i);
00135         \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} r = IsLower ? k+1 : actualPanelWidth-k;
00136         \textcolor{keywordflow}{if} ((!(HasUnitDiag||HasZeroDiag)) || (--r)>0)
00137           res.coeffRef(i) += alpha * (cjLhs.\hyperlink{group___sparse_core___module_ae88b0ad6d31daa53e298b9cc4201fdee}{row}(i).\hyperlink{group___sparse_core___module_adf94a8461a773fb4b0daedaa9980b054}{segment}(s,r).cwiseProduct(cjRhs.segment(s,r).
      transpose())).sum();
00138         \textcolor{keywordflow}{if} (HasUnitDiag)
00139           res.coeffRef(i) += alpha * cjRhs.coeff(i);
00140       \}
00141       \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} r = IsLower ? pi : cols - pi - actualPanelWidth;
00142       \textcolor{keywordflow}{if} (r>0)
00143       \{
00144         \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} s = IsLower ? 0 : pi + actualPanelWidth;
00145         
      \hyperlink{struct_eigen_1_1internal_1_1general__matrix__vector__product}{
      general\_matrix\_vector\_product<Index,LhsScalar,LhsMapper,RowMajor,ConjLhs,RhsScalar,RhsMapper,ConjRhs,BuiltIn>::run}
      (
00146             actualPanelWidth, r,
00147             LhsMapper(&lhs.coeffRef(pi,s), lhsStride),
00148             RhsMapper(&rhs.coeffRef(s), rhsIncr),
00149             &res.coeffRef(pi), resIncr, alpha);
00150       \}
00151     \}
00152     \textcolor{keywordflow}{if}(IsLower && rows>diagSize)
00153     \{
00154       
      \hyperlink{struct_eigen_1_1internal_1_1general__matrix__vector__product}{general\_matrix\_vector\_product<Index,LhsScalar,LhsMapper,RowMajor,ConjLhs,RhsScalar,RhsMapper,ConjRhs>::run}
      (
00155             rows-diagSize, cols,
00156             LhsMapper(&lhs.coeffRef(diagSize,0), lhsStride),
00157             RhsMapper(&rhs.coeffRef(0), rhsIncr),
00158             &res.coeffRef(diagSize), resIncr, alpha);
00159     \}
00160   \}
00161 
00162 \textcolor{comment}{/***************************************************************************}
00163 \textcolor{comment}{* Wrapper to product\_triangular\_vector}
00164 \textcolor{comment}{***************************************************************************/}
00165 
00166 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} Mode,\textcolor{keywordtype}{int} StorageOrder>
\Hypertarget{eigen_2_eigen_2src_2_core_2products_2_triangular_matrix_vector_8h_source_l00167}\hyperlink{struct_eigen_1_1internal_1_1trmv__selector}{00167} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1trmv__selector}{trmv\_selector};
00168 
00169 \} \textcolor{comment}{// end namespace internal}
00170 
00171 \textcolor{keyword}{namespace }\hyperlink{namespaceinternal}{internal} \{
00172 
00173 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} Mode, \textcolor{keyword}{typename} Lhs, \textcolor{keyword}{typename} Rhs>
\Hypertarget{eigen_2_eigen_2src_2_core_2products_2_triangular_matrix_vector_8h_source_l00174}\hyperlink{struct_eigen_1_1internal_1_1triangular__product__impl_3_01_mode_00_01true_00_01_lhs_00_01false_00_01_rhs_00_01true_01_4}{00174} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1triangular__product__impl}{triangular\_product\_impl}<Mode,true,Lhs,false,Rhs,true>
00175 \{
00176   \textcolor{keyword}{template}<\textcolor{keyword}{typename} Dest> \textcolor{keyword}{static} \textcolor{keywordtype}{void} run(Dest& dst, \textcolor{keyword}{const} Lhs &lhs, \textcolor{keyword}{const} Rhs &rhs, \textcolor{keyword}{const} \textcolor{keyword}{typename} 
      Dest::Scalar& alpha)
00177   \{
00178     eigen\_assert(dst.rows()==lhs.rows() && dst.cols()==rhs.cols());
00179   
00180     \hyperlink{struct_eigen_1_1internal_1_1trmv__selector}{internal::trmv\_selector<Mode,(int(internal::traits<Lhs>::Flags}
      )&\hyperlink{group__flags_gae4f56c2a60bbe4bd2e44c5b19cbe8762}{RowMajorBit}) ? \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13acfcde9cd8677c5f7caf6bd603666aae3}{RowMajor} : \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor}>::run(lhs, rhs, dst, alpha);
00181   \}
00182 \};
00183 
00184 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} Mode, \textcolor{keyword}{typename} Lhs, \textcolor{keyword}{typename} Rhs>
\Hypertarget{eigen_2_eigen_2src_2_core_2products_2_triangular_matrix_vector_8h_source_l00185}\hyperlink{struct_eigen_1_1internal_1_1triangular__product__impl_3_01_mode_00_01false_00_01_lhs_00_01true_00_01_rhs_00_01false_01_4}{00185} \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1triangular__product__impl}{triangular\_product\_impl}<Mode,false,Lhs,true,Rhs,false>
00186 \{
00187   \textcolor{keyword}{template}<\textcolor{keyword}{typename} Dest> \textcolor{keyword}{static} \textcolor{keywordtype}{void} run(Dest& dst, \textcolor{keyword}{const} Lhs &lhs, \textcolor{keyword}{const} Rhs &rhs, \textcolor{keyword}{const} \textcolor{keyword}{typename} 
      Dest::Scalar& alpha)
00188   \{
00189     eigen\_assert(dst.rows()==lhs.rows() && dst.cols()==rhs.cols());
00190 
00191     \hyperlink{group___core___module_class_eigen_1_1_transpose}{Transpose<Dest>} dstT(dst);
00192     \hyperlink{struct_eigen_1_1internal_1_1trmv__selector}{internal::trmv\_selector}<(Mode & (\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cdaddb72f888ac85d5a1c52333e54f9374b}{UnitDiag}|
      \hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda884ff7240392e85aa6e4b3c957e36483}{ZeroDiag})) | ((Mode & \hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda891792b8ed394f7607ab16dd716f60e6}{Lower}) ? \hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda6bcb58be3b8b8ec84859ce0c5ac0aaec}{Upper} : \hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda891792b8ed394f7607ab16dd716f60e6}{Lower}),
00193                             (int(\hyperlink{struct_eigen_1_1internal_1_1traits}{internal::traits<Rhs>::Flags})&
      \hyperlink{group__flags_gae4f56c2a60bbe4bd2e44c5b19cbe8762}{RowMajorBit}) ? \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor} : \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13acfcde9cd8677c5f7caf6bd603666aae3}{RowMajor}>
00194             ::run(rhs.transpose(),lhs.transpose(), dstT, alpha);
00195   \}
00196 \};
00197 
00198 \} \textcolor{comment}{// end namespace internal}
00199 
00200 \textcolor{keyword}{namespace }\hyperlink{namespaceinternal}{internal} \{
00201 
00202 \textcolor{comment}{// TODO: find a way to factorize this piece of code with gemv\_selector since the logic is exactly the same.}
00203   
\Hypertarget{eigen_2_eigen_2src_2_core_2products_2_triangular_matrix_vector_8h_source_l00204}\hyperlink{struct_eigen_1_1internal_1_1trmv__selector_3_01_mode_00_01_col_major_01_4}{00204} \textcolor{keyword}{template}<\textcolor{keywordtype}{int} Mode> \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1trmv__selector}{trmv\_selector}<Mode,\hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor}>
00205 \{
00206   \textcolor{keyword}{template}<\textcolor{keyword}{typename} Lhs, \textcolor{keyword}{typename} Rhs, \textcolor{keyword}{typename} Dest>
00207   \textcolor{keyword}{static} \textcolor{keywordtype}{void} run(\textcolor{keyword}{const} Lhs &lhs, \textcolor{keyword}{const} Rhs &rhs, Dest& dest, \textcolor{keyword}{const} \textcolor{keyword}{typename} Dest::Scalar& alpha)
00208   \{
00209     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Lhs::Scalar      LhsScalar;
00210     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Rhs::Scalar      RhsScalar;
00211     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Dest::Scalar     ResScalar;
00212     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Dest::RealScalar RealScalar;
00213     
00214     \textcolor{keyword}{typedef} \hyperlink{struct_eigen_1_1internal_1_1blas__traits}{internal::blas\_traits<Lhs>} LhsBlasTraits;
00215     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} LhsBlasTraits::DirectLinearAccessType ActualLhsType;
00216     \textcolor{keyword}{typedef} \hyperlink{struct_eigen_1_1internal_1_1blas__traits}{internal::blas\_traits<Rhs>} RhsBlasTraits;
00217     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} RhsBlasTraits::DirectLinearAccessType ActualRhsType;
00218     
00219     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_map}{Map<Matrix<ResScalar,Dynamic,1>}, EIGEN\_PLAIN\_ENUM\_MIN(AlignedMax
      ,\hyperlink{struct_eigen_1_1internal_1_1packet__traits}{internal::packet\_traits<ResScalar>::size})> MappedDest;
00220 
00221     \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{internal::add\_const\_on\_value\_type<ActualLhsType>::type}
       actualLhs = LhsBlasTraits::extract(lhs);
00222     \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{internal::add\_const\_on\_value\_type<ActualRhsType>::type}
       actualRhs = RhsBlasTraits::extract(rhs);
00223 
00224     ResScalar actualAlpha = alpha * LhsBlasTraits::extractScalarFactor(lhs)
00225                                   * RhsBlasTraits::extractScalarFactor(rhs);
00226 
00227     \textcolor{keyword}{enum} \{
00228       \textcolor{comment}{// FIXME find a way to allow an inner stride on the result if packet\_traits<Scalar>::size==1}
00229       \textcolor{comment}{// on, the other hand it is good for the cache to pack the vector anyways...}
00230       EvalToDestAtCompileTime = Dest::InnerStrideAtCompileTime==1,
00231       ComplexByReal = (\hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<LhsScalar>::IsComplex}) && (!
      \hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<RhsScalar>::IsComplex}),
00232       MightCannotUseDest = (Dest::InnerStrideAtCompileTime!=1) || ComplexByReal
00233     \};
00234 
00235     
      \hyperlink{struct_eigen_1_1internal_1_1gemv__static__vector__if}{gemv\_static\_vector\_if<ResScalar,Dest::SizeAtCompileTime,Dest::MaxSizeAtCompileTime,MightCannotUseDest>}
       static\_dest;
00236 
00237     \textcolor{keywordtype}{bool} alphaIsCompatible = (!ComplexByReal) || (numext::imag(actualAlpha)==RealScalar(0));
00238     \textcolor{keywordtype}{bool} evalToDest = EvalToDestAtCompileTime && alphaIsCompatible;
00239 
00240     RhsScalar compatibleAlpha = \hyperlink{struct_eigen_1_1internal_1_1get__factor}{get\_factor<ResScalar,RhsScalar>::run}(
      actualAlpha);
00241 
00242     ei\_declare\_aligned\_stack\_constructed\_variable(ResScalar,actualDestPtr,dest.size(),
00243                                                   evalToDest ? dest.data() : static\_dest.data());
00244 
00245     \textcolor{keywordflow}{if}(!evalToDest)
00246     \{
00247 \textcolor{preprocessor}{      #ifdef EIGEN\_DENSE\_STORAGE\_CTOR\_PLUGIN}
00248       \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} size = dest.size();
00249       EIGEN\_DENSE\_STORAGE\_CTOR\_PLUGIN
00250 \textcolor{preprocessor}{      #endif}
00251       \textcolor{keywordflow}{if}(!alphaIsCompatible)
00252       \{
00253         MappedDest(actualDestPtr, dest.size()).setZero();
00254         compatibleAlpha = RhsScalar(1);
00255       \}
00256       \textcolor{keywordflow}{else}
00257         MappedDest(actualDestPtr, dest.size()) = dest;
00258     \}
00259 
00260     \hyperlink{struct_eigen_1_1internal_1_1triangular__matrix__vector__product}{internal::triangular\_matrix\_vector\_product}
00261       <\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index},Mode,
00262        LhsScalar, LhsBlasTraits::NeedToConjugate,
00263        RhsScalar, RhsBlasTraits::NeedToConjugate,
00264        \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor}>
00265       ::run(actualLhs.rows(),actualLhs.cols(),
00266             actualLhs.data(),actualLhs.outerStride(),
00267             actualRhs.data(),actualRhs.innerStride(),
00268             actualDestPtr,1,compatibleAlpha);
00269 
00270     \textcolor{keywordflow}{if} (!evalToDest)
00271     \{
00272       \textcolor{keywordflow}{if}(!alphaIsCompatible)
00273         dest += actualAlpha * MappedDest(actualDestPtr, dest.size());
00274       \textcolor{keywordflow}{else}
00275         dest = MappedDest(actualDestPtr, dest.size());
00276     \}
00277   \}
00278 \};
00279 
\Hypertarget{eigen_2_eigen_2src_2_core_2products_2_triangular_matrix_vector_8h_source_l00280}\hyperlink{struct_eigen_1_1internal_1_1trmv__selector_3_01_mode_00_01_row_major_01_4}{00280} \textcolor{keyword}{template}<\textcolor{keywordtype}{int} Mode> \textcolor{keyword}{struct }\hyperlink{struct_eigen_1_1internal_1_1trmv__selector}{trmv\_selector}<Mode,\hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13acfcde9cd8677c5f7caf6bd603666aae3}{RowMajor}>
00281 \{
00282   \textcolor{keyword}{template}<\textcolor{keyword}{typename} Lhs, \textcolor{keyword}{typename} Rhs, \textcolor{keyword}{typename} Dest>
00283   \textcolor{keyword}{static} \textcolor{keywordtype}{void} run(\textcolor{keyword}{const} Lhs &lhs, \textcolor{keyword}{const} Rhs &rhs, Dest& dest, \textcolor{keyword}{const} \textcolor{keyword}{typename} Dest::Scalar& alpha)
00284   \{
00285     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Lhs::Scalar      LhsScalar;
00286     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Rhs::Scalar      RhsScalar;
00287     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Dest::Scalar     ResScalar;
00288     
00289     \textcolor{keyword}{typedef} \hyperlink{struct_eigen_1_1internal_1_1blas__traits}{internal::blas\_traits<Lhs>} LhsBlasTraits;
00290     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} LhsBlasTraits::DirectLinearAccessType ActualLhsType;
00291     \textcolor{keyword}{typedef} \hyperlink{struct_eigen_1_1internal_1_1blas__traits}{internal::blas\_traits<Rhs>} RhsBlasTraits;
00292     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} RhsBlasTraits::DirectLinearAccessType ActualRhsType;
00293     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{internal::remove\_all<ActualRhsType>::type} 
      ActualRhsTypeCleaned;
00294 
00295     \textcolor{keyword}{typename} \hyperlink{group___core___module_class_eigen_1_1_transpose}{add\_const<ActualLhsType>::type} actualLhs = 
      LhsBlasTraits::extract(lhs);
00296     \textcolor{keyword}{typename} \hyperlink{group___core___module_class_eigen_1_1_transpose}{add\_const<ActualRhsType>::type} actualRhs = 
      RhsBlasTraits::extract(rhs);
00297 
00298     ResScalar actualAlpha = alpha * LhsBlasTraits::extractScalarFactor(lhs)
00299                                   * RhsBlasTraits::extractScalarFactor(rhs);
00300 
00301     \textcolor{keyword}{enum} \{
00302       DirectlyUseRhs = ActualRhsTypeCleaned::InnerStrideAtCompileTime==1
00303     \};
00304 
00305     
      \hyperlink{struct_eigen_1_1internal_1_1gemv__static__vector__if}{
      gemv\_static\_vector\_if<RhsScalar,ActualRhsTypeCleaned::SizeAtCompileTime,ActualRhsTypeCleaned::MaxSizeAtCompileTime,!DirectlyUseRhs>}
       static\_rhs;
00306 
00307     ei\_declare\_aligned\_stack\_constructed\_variable(RhsScalar,actualRhsPtr,actualRhs.size(),
00308         DirectlyUseRhs ? \textcolor{keyword}{const\_cast<}RhsScalar*\textcolor{keyword}{>}(actualRhs.data()) : static\_rhs.data());
00309 
00310     \textcolor{keywordflow}{if}(!DirectlyUseRhs)
00311     \{
00312 \textcolor{preprocessor}{      #ifdef EIGEN\_DENSE\_STORAGE\_CTOR\_PLUGIN}
00313       \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} size = actualRhs.size();
00314       EIGEN\_DENSE\_STORAGE\_CTOR\_PLUGIN
00315 \textcolor{preprocessor}{      #endif}
00316       \hyperlink{group___core___module_class_eigen_1_1_map}{Map<typename ActualRhsTypeCleaned::PlainObject>}(
      actualRhsPtr, actualRhs.size()) = actualRhs;
00317     \}
00318 
00319     \hyperlink{struct_eigen_1_1internal_1_1triangular__matrix__vector__product}{internal::triangular\_matrix\_vector\_product}
00320       <\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index},Mode,
00321        LhsScalar, LhsBlasTraits::NeedToConjugate,
00322        RhsScalar, RhsBlasTraits::NeedToConjugate,
00323        \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13acfcde9cd8677c5f7caf6bd603666aae3}{RowMajor}>
00324       ::run(actualLhs.rows(),actualLhs.cols(),
00325             actualLhs.data(),actualLhs.outerStride(),
00326             actualRhsPtr,1,
00327             dest.data(),dest.innerStride(),
00328             actualAlpha);
00329   \}
00330 \};
00331 
00332 \} \textcolor{comment}{// end namespace internal}
00333 
00334 \} \textcolor{comment}{// end namespace Eigen}
00335 
00336 \textcolor{preprocessor}{#endif // EIGEN\_TRIANGULARMATRIXVECTOR\_H}
\end{DoxyCode}
