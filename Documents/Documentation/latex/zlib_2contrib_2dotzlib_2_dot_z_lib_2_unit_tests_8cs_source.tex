\hypertarget{zlib_2contrib_2dotzlib_2_dot_z_lib_2_unit_tests_8cs_source}{}\section{zlib/contrib/dotzlib/\+Dot\+Z\+Lib/\+Unit\+Tests.cs}
\label{zlib_2contrib_2dotzlib_2_dot_z_lib_2_unit_tests_8cs_source}\index{Unit\+Tests.\+cs@{Unit\+Tests.\+cs}}

\begin{DoxyCode}
00001 \textcolor{comment}{//}
00002 \textcolor{comment}{// Â© Copyright Henrik Ravn 2004}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Use, modification and distribution are subject to the Boost Software License, Version 1.0.}
00005 \textcolor{comment}{// (See accompanying file LICENSE\_1\_0.txt or copy at http://www.boost.org/LICENSE\_1\_0.txt)}
00006 \textcolor{comment}{//}
00007 
00008 \textcolor{keyword}{using} \hyperlink{namespace_system}{System};
00009 \textcolor{keyword}{using} \hyperlink{namespace_system}{System}.Collections;
00010 \textcolor{keyword}{using} \hyperlink{namespace_system}{System}.IO;
00011 
00012 \textcolor{comment}{// uncomment the define below to include unit tests}
00013 \textcolor{comment}{//#define nunit}
00014 \textcolor{preprocessor}{#if nunit}
00015 \textcolor{keyword}{using} NUnit.Framework;
00016 
00017 \textcolor{comment}{// Unit tests for the DotZLib class library}
00018 \textcolor{comment}{// ----------------------------------------}
00019 \textcolor{comment}{//}
00020 \textcolor{comment}{// Use this with NUnit 2 from http://www.nunit.org}
00021 \textcolor{comment}{//}
00022 
00023 \textcolor{keyword}{namespace }DotZLibTests
00024 \{
00025     \textcolor{keyword}{using} \hyperlink{namespace_dot_z_lib}{DotZLib};
00026 
00027     \textcolor{comment}{// helper methods}
00028     \textcolor{keyword}{internal} \textcolor{keyword}{class }Utils
00029     \{
00030         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{bool} byteArrEqual( byte[] lhs, byte[] rhs )
00031         \{
00032             \textcolor{keywordflow}{if} (lhs.Length != rhs.Length)
00033                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00034             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = lhs.Length-1; i >= 0; --i)
00035                 \textcolor{keywordflow}{if} (lhs[i] != rhs[i])
00036                     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00037             \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00038         \}
00039 
00040     \}
00041 
00042 
00043     [TestFixture]
00044     \textcolor{keyword}{public} \textcolor{keyword}{class }CircBufferTests
00045     \{
00046 \textcolor{preprocessor}{        #region Circular buffer tests}
00047         [Test]
00048         \textcolor{keyword}{public} \textcolor{keywordtype}{void} SinglePutGet()
00049         \{
00050             CircularBuffer buf = \textcolor{keyword}{new} CircularBuffer(10);
00051             Assert.AreEqual( 0, buf.Size );
00052             Assert.AreEqual( -1, buf.Get() );
00053 
00054             Assert.IsTrue(buf.Put( 1 ));
00055             Assert.AreEqual( 1, buf.Size );
00056             Assert.AreEqual( 1, buf.Get() );
00057             Assert.AreEqual( 0, buf.Size );
00058             Assert.AreEqual( -1, buf.Get() );
00059         \}
00060 
00061         [Test]
00062         \textcolor{keyword}{public} \textcolor{keywordtype}{void} BlockPutGet()
00063         \{
00064             CircularBuffer buf = \textcolor{keyword}{new} CircularBuffer(10);
00065             byte[] arr = \{1,2,3,4,5,6,7,8,9,10\};
00066             Assert.AreEqual( 10, buf.Put(arr,0,10) );
00067             Assert.AreEqual( 10, buf.Size );
00068             Assert.IsFalse( buf.Put(11) );
00069             Assert.AreEqual( 1, buf.Get() );
00070             Assert.IsTrue( buf.Put(11) );
00071 
00072             byte[] arr2 = (byte[])arr.Clone();
00073             Assert.AreEqual( 9, buf.Get(arr2,1,9) );
00074             Assert.IsTrue( Utils.byteArrEqual(arr,arr2) );
00075         \}
00076 
00077 \textcolor{preprocessor}{        #endregion}
00078     \}
00079 
00080     [TestFixture]
00081     \textcolor{keyword}{public} \textcolor{keyword}{class }ChecksumTests
00082     \{
00083 \textcolor{preprocessor}{        #region CRC32 Tests}
00084         [Test]
00085         \textcolor{keyword}{public} \textcolor{keywordtype}{void} CRC32\_Null()
00086         \{
00087             CRC32Checksum crc32 = \textcolor{keyword}{new} CRC32Checksum();
00088             Assert.AreEqual( 0, crc32.Value );
00089 
00090             crc32 = \textcolor{keyword}{new} CRC32Checksum(1);
00091             Assert.AreEqual( 1, crc32.Value );
00092 
00093             crc32 = \textcolor{keyword}{new} CRC32Checksum(556);
00094             Assert.AreEqual( 556, crc32.Value );
00095         \}
00096 
00097         [Test]
00098         \textcolor{keyword}{public} \textcolor{keywordtype}{void} CRC32\_Data()
00099         \{
00100             CRC32Checksum crc32 = \textcolor{keyword}{new} CRC32Checksum();
00101             byte[] data = \{ 1,2,3,4,5,6,7 \};
00102             crc32.Update(data);
00103             Assert.AreEqual( 0x70e46888, crc32.Value  );
00104 
00105             crc32 = \textcolor{keyword}{new} CRC32Checksum();
00106             crc32.Update(\textcolor{stringliteral}{"penguin"});
00107             Assert.AreEqual( 0x0e5c1a120, crc32.Value );
00108 
00109             crc32 = \textcolor{keyword}{new} CRC32Checksum(1);
00110             crc32.Update(\textcolor{stringliteral}{"penguin"});
00111             Assert.AreEqual(0x43b6aa94, crc32.Value);
00112 
00113         \}
00114 \textcolor{preprocessor}{        #endregion}
00115 
00116 \textcolor{preprocessor}{        #region Adler tests}
00117 
00118         [Test]
00119         \textcolor{keyword}{public} \textcolor{keywordtype}{void} Adler\_Null()
00120         \{
00121             AdlerChecksum adler = \textcolor{keyword}{new} AdlerChecksum();
00122             Assert.AreEqual(0, adler.Value);
00123 
00124             adler = \textcolor{keyword}{new} AdlerChecksum(1);
00125             Assert.AreEqual( 1, adler.Value );
00126 
00127             adler = \textcolor{keyword}{new} AdlerChecksum(556);
00128             Assert.AreEqual( 556, adler.Value );
00129         \}
00130 
00131         [Test]
00132         \textcolor{keyword}{public} \textcolor{keywordtype}{void} Adler\_Data()
00133         \{
00134             AdlerChecksum adler = \textcolor{keyword}{new} AdlerChecksum(1);
00135             byte[] data = \{ 1,2,3,4,5,6,7 \};
00136             adler.Update(data);
00137             Assert.AreEqual( 0x5b001d, adler.Value  );
00138 
00139             adler = \textcolor{keyword}{new} AdlerChecksum();
00140             adler.Update(\textcolor{stringliteral}{"penguin"});
00141             Assert.AreEqual(0x0bcf02f6, adler.Value );
00142 
00143             adler = \textcolor{keyword}{new} AdlerChecksum(1);
00144             adler.Update(\textcolor{stringliteral}{"penguin"});
00145             Assert.AreEqual(0x0bd602f7, adler.Value);
00146 
00147         \}
00148 \textcolor{preprocessor}{        #endregion}
00149     \}
00150 
00151     [TestFixture]
00152     \textcolor{keyword}{public} \textcolor{keyword}{class }InfoTests
00153     \{
00154 \textcolor{preprocessor}{        #region Info tests}
00155         [Test]
00156         \textcolor{keyword}{public} \textcolor{keywordtype}{void} Info\_Version()
00157         \{
00158             Info info = \textcolor{keyword}{new} Info();
00159             Assert.AreEqual(\textcolor{stringliteral}{"1.2.11"}, Info.Version);
00160             Assert.AreEqual(32, info.SizeOfUInt);
00161             Assert.AreEqual(32, info.SizeOfULong);
00162             Assert.AreEqual(32, info.SizeOfPointer);
00163             Assert.AreEqual(32, info.SizeOfOffset);
00164         \}
00165 \textcolor{preprocessor}{        #endregion}
00166     \}
00167 
00168     [TestFixture]
00169     \textcolor{keyword}{public} \textcolor{keyword}{class }DeflateInflateTests
00170     \{
00171 \textcolor{preprocessor}{        #region Deflate tests}
00172         [Test]
00173         \textcolor{keyword}{public} \textcolor{keywordtype}{void} Deflate\_Init()
00174         \{
00175             \textcolor{keyword}{using} (Deflater def = \textcolor{keyword}{new} Deflater(\hyperlink{namespace_dot_z_lib_a034f7a1ef9856d8834e6f6b1c53d8a4c}{CompressLevel}.Default))
00176             \{
00177             \}
00178         \}
00179 
00180         \textcolor{keyword}{private} ArrayList compressedData = \textcolor{keyword}{new} ArrayList();
00181         \textcolor{keyword}{private} uint adler1;
00182 
00183         \textcolor{keyword}{private} ArrayList uncompressedData = \textcolor{keyword}{new} ArrayList();
00184         \textcolor{keyword}{private} uint adler2;
00185 
00186         \textcolor{keyword}{public} \textcolor{keywordtype}{void} CDataAvail(byte[] data, \textcolor{keywordtype}{int} startIndex, \textcolor{keywordtype}{int} count)
00187         \{
00188             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < count; ++i)
00189                 compressedData.Add(data[i+startIndex]);
00190         \}
00191 
00192         [Test]
00193         \textcolor{keyword}{public} \textcolor{keywordtype}{void} Deflate\_Compress()
00194         \{
00195             compressedData.Clear();
00196 
00197             byte[] testData = \textcolor{keyword}{new} byte[35000];
00198             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < testData.Length; ++i)
00199                 testData[i] = 5;
00200 
00201             \textcolor{keyword}{using} (Deflater def = \textcolor{keyword}{new} Deflater((CompressLevel)5))
00202             \{
00203                 def.DataAvailable += \textcolor{keyword}{new} \hyperlink{namespace_dot_z_lib_a13a751b897fc2af0be2307e4deb7eb1c}{DataAvailableHandler}(CDataAvail);
00204                 def.Add(testData);
00205                 def.Finish();
00206                 adler1 = def.Checksum;
00207             \}
00208         \}
00209 \textcolor{preprocessor}{        #endregion}
00210 
00211 \textcolor{preprocessor}{        #region Inflate tests}
00212         [Test]
00213         \textcolor{keyword}{public} \textcolor{keywordtype}{void} Inflate\_Init()
00214         \{
00215             \textcolor{keyword}{using} (Inflater inf = \textcolor{keyword}{new} Inflater())
00216             \{
00217             \}
00218         \}
00219 
00220         \textcolor{keyword}{private} \textcolor{keywordtype}{void} DDataAvail(byte[] data, \textcolor{keywordtype}{int} startIndex, \textcolor{keywordtype}{int} count)
00221         \{
00222             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < count; ++i)
00223                 uncompressedData.Add(data[i+startIndex]);
00224         \}
00225 
00226         [Test]
00227         \textcolor{keyword}{public} \textcolor{keywordtype}{void} Inflate\_Expand()
00228         \{
00229             uncompressedData.Clear();
00230 
00231             \textcolor{keyword}{using} (Inflater inf = \textcolor{keyword}{new} Inflater())
00232             \{
00233                 inf.DataAvailable += \textcolor{keyword}{new} \hyperlink{namespace_dot_z_lib_a13a751b897fc2af0be2307e4deb7eb1c}{DataAvailableHandler}(DDataAvail);
00234                 inf.Add((byte[])compressedData.ToArray(typeof(byte)));
00235                 inf.Finish();
00236                 adler2 = inf.Checksum;
00237             \}
00238             Assert.AreEqual( adler1, adler2 );
00239         \}
00240 \textcolor{preprocessor}{        #endregion}
00241     \}
00242 
00243     [TestFixture]
00244     \textcolor{keyword}{public} \textcolor{keyword}{class }GZipStreamTests
00245     \{
00246 \textcolor{preprocessor}{        #region GZipStream test}
00247         [Test]
00248         \textcolor{keyword}{public} \textcolor{keywordtype}{void} GZipStream\_WriteRead()
00249         \{
00250             \textcolor{keyword}{using} (GZipStream gzOut = \textcolor{keyword}{new} GZipStream(\textcolor{stringliteral}{"gzstream.gz"}, 
      \hyperlink{namespace_dot_z_lib_a034f7a1ef9856d8834e6f6b1c53d8a4c}{CompressLevel}.Best))
00251             \{
00252                 BinaryWriter writer = \textcolor{keyword}{new} BinaryWriter(gzOut);
00253                 writer.Write(\textcolor{stringliteral}{"hi there"});
00254                 writer.Write(Math.PI);
00255                 writer.Write(42);
00256             \}
00257 
00258             \textcolor{keyword}{using} (GZipStream gzIn = \textcolor{keyword}{new} GZipStream(\textcolor{stringliteral}{"gzstream.gz"}))
00259             \{
00260                 BinaryReader reader = \textcolor{keyword}{new} BinaryReader(gzIn);
00261                 \textcolor{keywordtype}{string} s = reader.ReadString();
00262                 Assert.AreEqual(\textcolor{stringliteral}{"hi there"},s);
00263                 \textcolor{keywordtype}{double} d = reader.ReadDouble();
00264                 Assert.AreEqual(Math.PI, d);
00265                 \textcolor{keywordtype}{int} i = reader.ReadInt32();
00266                 Assert.AreEqual(42,i);
00267             \}
00268 
00269         \}
00270 \textcolor{preprocessor}{        #endregion}
00271     \}
00272 \}
00273 
00274 \textcolor{preprocessor}{#endif}
\end{DoxyCode}
