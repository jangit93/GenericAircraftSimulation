\hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2test_2cxx11__tensor__ref_8cpp_source}{}\section{matio/visual\+\_\+studio/test/eigen/unsupported/test/cxx11\+\_\+tensor\+\_\+ref.cpp}
\label{matio_2visual__studio_2test_2eigen_2unsupported_2test_2cxx11__tensor__ref_8cpp_source}\index{cxx11\+\_\+tensor\+\_\+ref.\+cpp@{cxx11\+\_\+tensor\+\_\+ref.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2014 Benoit Steiner <benoit.steiner.goog@gmail.com>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#include "main.h"}
00011 
00012 \textcolor{preprocessor}{#include <Eigen/CXX11/Tensor>}
00013 
00014 \textcolor{keyword}{using} \hyperlink{class_eigen_1_1_tensor}{Eigen::Tensor};
00015 \textcolor{keyword}{using} \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13acfcde9cd8677c5f7caf6bd603666aae3}{Eigen::RowMajor};
00016 
00017 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_simple\_lvalue\_ref()
00018 \{
00019   \hyperlink{class_eigen_1_1_tensor}{Tensor<int, 1>} input(6);
00020   input.setRandom();
00021 
00022   TensorRef<Tensor<int, 1>> ref3(input);
00023   TensorRef<Tensor<int, 1>> ref4 = input;
00024 
00025   VERIFY\_IS\_EQUAL(ref3.data(), input.data());
00026   VERIFY\_IS\_EQUAL(ref4.data(), input.data());
00027 
00028   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 6; ++i) \{
00029     VERIFY\_IS\_EQUAL(ref3(i), input(i));
00030     VERIFY\_IS\_EQUAL(ref4(i), input(i));
00031   \}
00032 
00033   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 6; ++i) \{
00034     ref3.coeffRef(i) = i;
00035   \}
00036   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 6; ++i) \{
00037     VERIFY\_IS\_EQUAL(input(i), i);
00038   \}
00039   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 6; ++i) \{
00040     ref4.coeffRef(i) = -i * 2;
00041   \}
00042   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 6; ++i) \{
00043     VERIFY\_IS\_EQUAL(input(i), -i*2);
00044   \}
00045 \}
00046 
00047 
00048 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_simple\_rvalue\_ref()
00049 \{
00050   \hyperlink{class_eigen_1_1_tensor}{Tensor<int, 1>} input1(6);
00051   input1.setRandom();
00052   \hyperlink{class_eigen_1_1_tensor}{Tensor<int, 1>} input2(6);
00053   input2.setRandom();
00054 
00055   TensorRef<Tensor<int, 1>> ref3(input1 + input2);
00056   TensorRef<Tensor<int, 1>> ref4 = input1 + input2;
00057 
00058   VERIFY\_IS\_NOT\_EQUAL(ref3.data(), input1.data());
00059   VERIFY\_IS\_NOT\_EQUAL(ref4.data(), input1.data());
00060   VERIFY\_IS\_NOT\_EQUAL(ref3.data(), input2.data());
00061   VERIFY\_IS\_NOT\_EQUAL(ref4.data(), input2.data());
00062 
00063   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 6; ++i) \{
00064     VERIFY\_IS\_EQUAL(ref3(i), input1(i) + input2(i));
00065     VERIFY\_IS\_EQUAL(ref4(i), input1(i) + input2(i));
00066   \}
00067 \}
00068 
00069 
00070 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_multiple\_dims()
00071 \{
00072   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} input(3,5,7);
00073   input.setRandom();
00074 
00075   TensorRef<Tensor<float, 3>> ref(input);
00076   VERIFY\_IS\_EQUAL(ref.data(), input.data());
00077   VERIFY\_IS\_EQUAL(ref.dimension(0), 3);
00078   VERIFY\_IS\_EQUAL(ref.dimension(1), 5);
00079   VERIFY\_IS\_EQUAL(ref.dimension(2), 7);
00080 
00081   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 3; ++i) \{
00082     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 5; ++j) \{
00083       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 7; ++k) \{
00084         VERIFY\_IS\_EQUAL(ref(i,j,k), input(i,j,k));
00085       \}
00086     \}
00087   \}
00088 \}
00089 
00090 
00091 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_slice()
00092 \{
00093   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 5>} tensor(2,3,5,7,11);
00094   tensor.setRandom();
00095 
00096   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 5>} indices(1,2,3,4,5);
00097   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 5>} sizes(1,1,1,1,1);
00098   TensorRef<Tensor<float, 5>> slice = tensor.slice(indices, sizes);
00099   VERIFY\_IS\_EQUAL(slice(0,0,0,0,0), tensor(1,2,3,4,5));
00100 
00101   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 5>} indices2(1,1,3,4,5);
00102   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 5>} sizes2(1,1,2,2,3);
00103   slice = tensor.slice(indices2, sizes2);
00104   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00105     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 2; ++j) \{
00106       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 3; ++k) \{
00107         VERIFY\_IS\_EQUAL(slice(0,0,i,j,k), tensor(1,1,3+i,4+j,5+k));
00108       \}
00109     \}
00110   \}
00111 
00112   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 5>} indices3(0,0,0,0,0);
00113   \hyperlink{struct_eigen_1_1_d_sizes}{Eigen::DSizes<ptrdiff\_t, 5>} sizes3(2,3,1,1,1);
00114   slice = tensor.slice(indices3, sizes3);
00115   VERIFY\_IS\_EQUAL(slice.data(), tensor.data());
00116 \}
00117 
00118 
00119 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_ref\_of\_ref()
00120 \{
00121   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} input(3,5,7);
00122   input.setRandom();
00123 
00124   TensorRef<Tensor<float, 3>> ref(input);
00125   TensorRef<Tensor<float, 3>> ref\_of\_ref(ref);
00126   TensorRef<Tensor<float, 3>> ref\_of\_ref2;
00127   ref\_of\_ref2 = ref;
00128 
00129   VERIFY\_IS\_EQUAL(ref\_of\_ref.data(), input.data());
00130   VERIFY\_IS\_EQUAL(ref\_of\_ref.dimension(0), 3);
00131   VERIFY\_IS\_EQUAL(ref\_of\_ref.dimension(1), 5);
00132   VERIFY\_IS\_EQUAL(ref\_of\_ref.dimension(2), 7);
00133 
00134   VERIFY\_IS\_EQUAL(ref\_of\_ref2.data(), input.data());
00135   VERIFY\_IS\_EQUAL(ref\_of\_ref2.dimension(0), 3);
00136   VERIFY\_IS\_EQUAL(ref\_of\_ref2.dimension(1), 5);
00137   VERIFY\_IS\_EQUAL(ref\_of\_ref2.dimension(2), 7);
00138 
00139   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 3; ++i) \{
00140     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 5; ++j) \{
00141       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 7; ++k) \{
00142         VERIFY\_IS\_EQUAL(ref\_of\_ref(i,j,k), input(i,j,k));
00143         VERIFY\_IS\_EQUAL(ref\_of\_ref2(i,j,k), input(i,j,k));
00144      \}
00145     \}
00146   \}
00147 \}
00148 
00149 
00150 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_ref\_in\_expr()
00151 \{
00152   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} input(3,5,7);
00153   input.setRandom();
00154   TensorRef<Tensor<float, 3>> input\_ref(input);
00155 
00156   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} result(3,5,7);
00157   result.setRandom();
00158   TensorRef<Tensor<float, 3>> result\_ref(result);
00159 
00160   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 3>} bias(3,5,7);
00161   bias.setRandom();
00162 
00163   result\_ref = input\_ref + bias;
00164   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 3; ++i) \{
00165     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 5; ++j) \{
00166       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 7; ++k) \{
00167         VERIFY\_IS\_EQUAL(result\_ref(i,j,k), input(i,j,k) + bias(i,j,k));
00168         VERIFY\_IS\_NOT\_EQUAL(result(i,j,k), input(i,j,k) + bias(i,j,k));
00169       \}
00170     \}
00171   \}
00172 
00173   result = result\_ref;
00174   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 3; ++i) \{
00175     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 5; ++j) \{
00176       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 7; ++k) \{
00177         VERIFY\_IS\_EQUAL(result(i,j,k), input(i,j,k) + bias(i,j,k));
00178       \}
00179     \}
00180   \}
00181 \}
00182 
00183 
00184 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_coeff\_ref()
00185 \{
00186   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 5>} tensor(2,3,5,7,11);
00187   tensor.setRandom();
00188   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 5>} original = tensor;
00189 
00190   TensorRef<Tensor<float, 4>> slice = tensor.chip(7, 4);
00191   slice.coeffRef(0, 0, 0, 0) = 1.0f;
00192   slice.coeffRef(1, 0, 0, 0) += 2.0f;
00193 
00194   VERIFY\_IS\_EQUAL(tensor(0,0,0,0,7), 1.0f);
00195   VERIFY\_IS\_EQUAL(tensor(1,0,0,0,7), original(1,0,0,0,7) + 2.0f);
00196 \}
00197 
00198 
00199 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_nested\_ops\_with\_ref()
00200 \{
00201   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 4>} t(2, 3, 5, 7);
00202   t.setRandom();
00203   TensorMap<Tensor<const float, 4> > m(t.data(), 2, 3, 5, 7);
00204   array<std::pair<ptrdiff\_t, ptrdiff\_t>, 4> paddings;
00205   paddings[0] = std::make\_pair(0, 0);
00206   paddings[1] = std::make\_pair(2, 1);
00207   paddings[2] = std::make\_pair(3, 4);
00208   paddings[3] = std::make\_pair(0, 0);
00209   DSizes<Eigen::DenseIndex, 4> shuffle\_dims(0, 1, 2, 3);
00210   TensorRef<Tensor<const float, 4> > ref(m.pad(paddings));
00211   array<std::pair<ptrdiff\_t, ptrdiff\_t>, 4> trivial;
00212   trivial[0] = std::make\_pair(0, 0);
00213   trivial[1] = std::make\_pair(0, 0);
00214   trivial[2] = std::make\_pair(0, 0);
00215   trivial[3] = std::make\_pair(0, 0);
00216   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 4>} padded = ref.shuffle(shuffle\_dims).pad(trivial);
00217   VERIFY\_IS\_EQUAL(padded.dimension(0), 2+0);
00218   VERIFY\_IS\_EQUAL(padded.dimension(1), 3+3);
00219   VERIFY\_IS\_EQUAL(padded.dimension(2), 5+7);
00220   VERIFY\_IS\_EQUAL(padded.dimension(3), 7+0);
00221 
00222   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00223     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 6; ++j) \{
00224       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 12; ++k) \{
00225         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} l = 0; l < 7; ++l) \{
00226           \textcolor{keywordflow}{if} (j >= 2 && j < 5 && k >= 3 && k < 8) \{
00227             VERIFY\_IS\_EQUAL(padded(i,j,k,l), t(i,j-2,k-3,l));
00228           \} \textcolor{keywordflow}{else} \{
00229             VERIFY\_IS\_EQUAL(padded(i,j,k,l), 0.0f);
00230           \}
00231         \}
00232       \}
00233     \}
00234   \}
00235 \}
00236 
00237 
00238 \textcolor{keywordtype}{void} test\_cxx11\_tensor\_ref()
00239 \{
00240   CALL\_SUBTEST(test\_simple\_lvalue\_ref());
00241   CALL\_SUBTEST(test\_simple\_rvalue\_ref());
00242   CALL\_SUBTEST(test\_multiple\_dims());
00243   CALL\_SUBTEST(test\_slice());
00244   CALL\_SUBTEST(test\_ref\_of\_ref());
00245   CALL\_SUBTEST(test\_ref\_in\_expr());
00246   CALL\_SUBTEST(test\_coeff\_ref());
00247   CALL\_SUBTEST(test\_nested\_ops\_with\_ref());
00248 \}
\end{DoxyCode}
