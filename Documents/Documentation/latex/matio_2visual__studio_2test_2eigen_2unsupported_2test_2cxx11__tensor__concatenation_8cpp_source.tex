\hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2test_2cxx11__tensor__concatenation_8cpp_source}{}\section{matio/visual\+\_\+studio/test/eigen/unsupported/test/cxx11\+\_\+tensor\+\_\+concatenation.cpp}
\label{matio_2visual__studio_2test_2eigen_2unsupported_2test_2cxx11__tensor__concatenation_8cpp_source}\index{cxx11\+\_\+tensor\+\_\+concatenation.\+cpp@{cxx11\+\_\+tensor\+\_\+concatenation.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2014 Benoit Steiner <benoit.steiner.goog@gmail.com>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#include "main.h"}
00011 
00012 \textcolor{preprocessor}{#include <Eigen/CXX11/Tensor>}
00013 
00014 \textcolor{keyword}{using} \hyperlink{class_eigen_1_1_tensor}{Eigen::Tensor};
00015 
00016 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} DataLayout>
00017 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_dimension\_failures()
00018 \{
00019   \hyperlink{class_eigen_1_1_tensor}{Tensor<int, 3, DataLayout>} left(2, 3, 1);
00020   \hyperlink{class_eigen_1_1_tensor}{Tensor<int, 3, DataLayout>} right(3, 3, 1);
00021   left.setRandom();
00022   right.setRandom();
00023 
00024   \textcolor{comment}{// Okay; other dimensions are equal.}
00025   \hyperlink{class_eigen_1_1_tensor}{Tensor<int, 3, DataLayout>} concatenation = left.concatenate(right, 0);
00026 
00027   \textcolor{comment}{// Dimension mismatches.}
00028   VERIFY\_RAISES\_ASSERT(concatenation = left.concatenate(right, 1));
00029   VERIFY\_RAISES\_ASSERT(concatenation = left.concatenate(right, 2));
00030 
00031   \textcolor{comment}{// Axis > NumDims or < 0.}
00032   VERIFY\_RAISES\_ASSERT(concatenation = left.concatenate(right, 3));
00033   VERIFY\_RAISES\_ASSERT(concatenation = left.concatenate(right, -1));
00034 \}
00035 
00036 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} DataLayout>
00037 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_static\_dimension\_failure()
00038 \{
00039   \hyperlink{class_eigen_1_1_tensor}{Tensor<int, 2, DataLayout>} left(2, 3);
00040   \hyperlink{class_eigen_1_1_tensor}{Tensor<int, 3, DataLayout>} right(2, 3, 1);
00041 
00042 \textcolor{preprocessor}{#ifdef CXX11\_TENSOR\_CONCATENATION\_STATIC\_DIMENSION\_FAILURE}
00043   \textcolor{comment}{// Technically compatible, but we static assert that the inputs have same}
00044   \textcolor{comment}{// NumDims.}
00045   \hyperlink{class_eigen_1_1_tensor}{Tensor<int, 3, DataLayout>} concatenation = left.concatenate(right, 0);
00046 \textcolor{preprocessor}{#endif}
00047 
00048   \textcolor{comment}{// This can be worked around in this case.}
00049   \hyperlink{class_eigen_1_1_tensor}{Tensor<int, 3, DataLayout>} concatenation = left
00050       .reshape(\hyperlink{class_eigen_1_1_tensor}{Tensor<int, 3>::Dimensions}(2, 3, 1))
00051       .concatenate(right, 0);
00052   \hyperlink{class_eigen_1_1_tensor}{Tensor<int, 2, DataLayout>} alternative = left
00053       .concatenate(right.reshape(\hyperlink{class_eigen_1_1_tensor}{Tensor<int, 2>::Dimensions}\{\{\{2, 3\}\}\}), 0);
00054 \}
00055 
00056 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} DataLayout>
00057 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_simple\_concatenation()
00058 \{
00059   \hyperlink{class_eigen_1_1_tensor}{Tensor<int, 3, DataLayout>} left(2, 3, 1);
00060   \hyperlink{class_eigen_1_1_tensor}{Tensor<int, 3, DataLayout>} right(2, 3, 1);
00061   left.setRandom();
00062   right.setRandom();
00063 
00064   \hyperlink{class_eigen_1_1_tensor}{Tensor<int, 3, DataLayout>} concatenation = left.concatenate(right, 0);
00065   VERIFY\_IS\_EQUAL(concatenation.dimension(0), 4);
00066   VERIFY\_IS\_EQUAL(concatenation.dimension(1), 3);
00067   VERIFY\_IS\_EQUAL(concatenation.dimension(2), 1);
00068   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
00069     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00070       VERIFY\_IS\_EQUAL(concatenation(i, j, 0), left(i, j, 0));
00071     \}
00072     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 2; i < 4; ++i) \{
00073       VERIFY\_IS\_EQUAL(concatenation(i, j, 0), right(i - 2, j, 0));
00074     \}
00075   \}
00076 
00077   concatenation = left.concatenate(right, 1);
00078   VERIFY\_IS\_EQUAL(concatenation.dimension(0), 2);
00079   VERIFY\_IS\_EQUAL(concatenation.dimension(1), 6);
00080   VERIFY\_IS\_EQUAL(concatenation.dimension(2), 1);
00081   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00082     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
00083       VERIFY\_IS\_EQUAL(concatenation(i, j, 0), left(i, j, 0));
00084     \}
00085     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 3; j < 6; ++j) \{
00086       VERIFY\_IS\_EQUAL(concatenation(i, j, 0), right(i, j - 3, 0));
00087     \}
00088   \}
00089 
00090   concatenation = left.concatenate(right, 2);
00091   VERIFY\_IS\_EQUAL(concatenation.dimension(0), 2);
00092   VERIFY\_IS\_EQUAL(concatenation.dimension(1), 3);
00093   VERIFY\_IS\_EQUAL(concatenation.dimension(2), 2);
00094   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00095     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
00096       VERIFY\_IS\_EQUAL(concatenation(i, j, 0), left(i, j, 0));
00097       VERIFY\_IS\_EQUAL(concatenation(i, j, 1), right(i, j, 0));
00098     \}
00099   \}
00100 \}
00101 
00102 
00103 \textcolor{comment}{// TODO(phli): Add test once we have a real vectorized implementation.}
00104 \textcolor{comment}{// static void test\_vectorized\_concatenation() \{\}}
00105 
00106 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_concatenation\_as\_lvalue()
00107 \{
00108   \hyperlink{class_eigen_1_1_tensor}{Tensor<int, 2>} t1(2, 3);
00109   \hyperlink{class_eigen_1_1_tensor}{Tensor<int, 2>} t2(2, 3);
00110   t1.setRandom();
00111   t2.setRandom();
00112 
00113   \hyperlink{class_eigen_1_1_tensor}{Tensor<int, 2>} result(4, 3);
00114   result.setRandom();
00115   t1.concatenate(t2, 0) = result;
00116 
00117   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00118     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
00119       VERIFY\_IS\_EQUAL(t1(i, j), result(i, j));
00120       VERIFY\_IS\_EQUAL(t2(i, j), result(i+2, j));
00121     \}
00122   \}
00123 \}
00124 
00125 
00126 \textcolor{keywordtype}{void} test\_cxx11\_tensor\_concatenation()
00127 \{
00128    CALL\_SUBTEST(test\_dimension\_failures<ColMajor>());
00129    CALL\_SUBTEST(test\_dimension\_failures<RowMajor>());
00130    CALL\_SUBTEST(test\_static\_dimension\_failure<ColMajor>());
00131    CALL\_SUBTEST(test\_static\_dimension\_failure<RowMajor>());
00132    CALL\_SUBTEST(test\_simple\_concatenation<ColMajor>());
00133    CALL\_SUBTEST(test\_simple\_concatenation<RowMajor>());
00134    \textcolor{comment}{// CALL\_SUBTEST(test\_vectorized\_concatenation());}
00135    CALL\_SUBTEST(test\_concatenation\_as\_lvalue());
00136 
00137 \}
\end{DoxyCode}
