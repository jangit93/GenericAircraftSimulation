\hypertarget{matio_2visual__studio_2test_2eigen_2test_2vectorization__logic_8cpp_source}{}\section{matio/visual\+\_\+studio/test/eigen/test/vectorization\+\_\+logic.cpp}
\label{matio_2visual__studio_2test_2eigen_2test_2vectorization__logic_8cpp_source}\index{vectorization\+\_\+logic.\+cpp@{vectorization\+\_\+logic.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2015 Gael Guennebaud <gael.guennebaud@inria.fr>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#ifdef EIGEN\_TEST\_PART\_1}
00011 \textcolor{preprocessor}{#define EIGEN\_UNALIGNED\_VECTORIZE 1}
00012 \textcolor{preprocessor}{#endif}
00013 
00014 \textcolor{preprocessor}{#ifdef EIGEN\_TEST\_PART\_2}
00015 \textcolor{preprocessor}{#define EIGEN\_UNALIGNED\_VECTORIZE 0}
00016 \textcolor{preprocessor}{#endif}
00017 
00018 \textcolor{preprocessor}{#ifdef EIGEN\_DEFAULT\_TO\_ROW\_MAJOR}
00019 \textcolor{preprocessor}{#undef EIGEN\_DEFAULT\_TO\_ROW\_MAJOR}
00020 \textcolor{preprocessor}{#endif}
00021 \textcolor{preprocessor}{#define EIGEN\_DEBUG\_ASSIGN}
00022 \textcolor{preprocessor}{#include "main.h"}
00023 \textcolor{preprocessor}{#include <typeinfo>}
00024 
00025 \textcolor{keyword}{using} internal::demangle\_flags;
00026 \textcolor{keyword}{using} internal::demangle\_traversal;
00027 \textcolor{keyword}{using} internal::demangle\_unrolling;
00028 
00029 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Dst, \textcolor{keyword}{typename} Src>
00030 \textcolor{keywordtype}{bool} test\_assign(\textcolor{keyword}{const} Dst&, \textcolor{keyword}{const} Src&, \textcolor{keywordtype}{int} traversal, \textcolor{keywordtype}{int} unrolling)
00031 \{
00032   \textcolor{keyword}{typedef} internal::copy\_using\_evaluator\_traits<internal::evaluator<Dst>,internal::evaluator<Src>, 
      internal::assign\_op<typename Dst::Scalar,typename Src::Scalar> > traits;
00033   \textcolor{keywordtype}{bool} res = traits::Traversal==traversal;
00034   \textcolor{keywordflow}{if}(unrolling==InnerUnrolling+CompleteUnrolling)
00035     res = res && (int(traits::Unrolling)==InnerUnrolling || int(traits::Unrolling)==CompleteUnrolling);
00036   \textcolor{keywordflow}{else}
00037     res = res && int(traits::Unrolling)==unrolling;
00038   \textcolor{keywordflow}{if}(!res)
00039   \{
00040     std::cerr << \textcolor{stringliteral}{"Src: "} << demangle\_flags(Src::Flags) << std::endl;
00041     std::cerr << \textcolor{stringliteral}{"     "} << demangle\_flags(internal::evaluator<Src>::Flags) << std::endl;
00042     std::cerr << \textcolor{stringliteral}{"Dst: "} << demangle\_flags(Dst::Flags) << std::endl;
00043     std::cerr << \textcolor{stringliteral}{"     "} << demangle\_flags(internal::evaluator<Dst>::Flags) << std::endl;
00044     traits::debug();
00045     std::cerr << \textcolor{stringliteral}{" Expected Traversal == "} << demangle\_traversal(traversal)
00046               << \textcolor{stringliteral}{" got "} << demangle\_traversal(traits::Traversal) << \textcolor{stringliteral}{"\(\backslash\)n"};
00047     std::cerr << \textcolor{stringliteral}{" Expected Unrolling == "} << demangle\_unrolling(unrolling)
00048               << \textcolor{stringliteral}{" got "} << demangle\_unrolling(traits::Unrolling) << \textcolor{stringliteral}{"\(\backslash\)n"};
00049   \}
00050   \textcolor{keywordflow}{return} res;
00051 \}
00052 
00053 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Dst, \textcolor{keyword}{typename} Src>
00054 \textcolor{keywordtype}{bool} test\_assign(\textcolor{keywordtype}{int} traversal, \textcolor{keywordtype}{int} unrolling)
00055 \{
00056   \textcolor{keyword}{typedef} internal::copy\_using\_evaluator\_traits<internal::evaluator<Dst>,internal::evaluator<Src>, 
      internal::assign\_op<typename Dst::Scalar,typename Src::Scalar> > traits;
00057   \textcolor{keywordtype}{bool} res = traits::Traversal==traversal && traits::Unrolling==unrolling;
00058   \textcolor{keywordflow}{if}(!res)
00059   \{
00060     std::cerr << \textcolor{stringliteral}{"Src: "} << demangle\_flags(Src::Flags) << std::endl;
00061     std::cerr << \textcolor{stringliteral}{"     "} << demangle\_flags(internal::evaluator<Src>::Flags) << std::endl;
00062     std::cerr << \textcolor{stringliteral}{"Dst: "} << demangle\_flags(Dst::Flags) << std::endl;
00063     std::cerr << \textcolor{stringliteral}{"     "} << demangle\_flags(internal::evaluator<Dst>::Flags) << std::endl;
00064     traits::debug();
00065     std::cerr << \textcolor{stringliteral}{" Expected Traversal == "} << demangle\_traversal(traversal)
00066               << \textcolor{stringliteral}{" got "} << demangle\_traversal(traits::Traversal) << \textcolor{stringliteral}{"\(\backslash\)n"};
00067     std::cerr << \textcolor{stringliteral}{" Expected Unrolling == "} << demangle\_unrolling(unrolling)
00068               << \textcolor{stringliteral}{" got "} << demangle\_unrolling(traits::Unrolling) << \textcolor{stringliteral}{"\(\backslash\)n"};
00069   \}
00070   \textcolor{keywordflow}{return} res;
00071 \}
00072 
00073 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Xpr>
00074 \textcolor{keywordtype}{bool} test\_redux(\textcolor{keyword}{const} Xpr&, \textcolor{keywordtype}{int} traversal, \textcolor{keywordtype}{int} unrolling)
00075 \{
00076   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Xpr::Scalar Scalar;
00077   \textcolor{keyword}{typedef} internal::redux\_traits<internal::scalar\_sum\_op<Scalar,Scalar>,internal::redux\_evaluator<Xpr> > 
      traits;
00078   
00079   \textcolor{keywordtype}{bool} res = traits::Traversal==traversal && traits::Unrolling==unrolling;
00080   \textcolor{keywordflow}{if}(!res)
00081   \{
00082     std::cerr << demangle\_flags(Xpr::Flags) << std::endl;
00083     std::cerr << demangle\_flags(internal::evaluator<Xpr>::Flags) << std::endl;
00084     traits::debug();
00085     
00086     std::cerr << \textcolor{stringliteral}{" Expected Traversal == "} << demangle\_traversal(traversal)
00087               << \textcolor{stringliteral}{" got "} << demangle\_traversal(traits::Traversal) << \textcolor{stringliteral}{"\(\backslash\)n"};
00088     std::cerr << \textcolor{stringliteral}{" Expected Unrolling == "} << demangle\_unrolling(unrolling)
00089               << \textcolor{stringliteral}{" got "} << demangle\_unrolling(traits::Unrolling) << \textcolor{stringliteral}{"\(\backslash\)n"};
00090   \}
00091   \textcolor{keywordflow}{return} res;
00092 \}
00093 
00094 template<typename Scalar, bool Enable = internal::packet\_traits<Scalar>::Vectorizable>
00095 \textcolor{keyword}{struct }\hyperlink{structvectorization__logic}{vectorization\_logic}
00096 \{
00097   \textcolor{keyword}{typedef} internal::packet\_traits<Scalar> PacketTraits;
00098   
00099   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___sparse_core___module}{internal::packet\_traits<Scalar>::type} 
      \hyperlink{struct_eigen_1_1_packet_type}{PacketType};
00100   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{union_eigen_1_1internal_1_1_packet}{internal::unpacket\_traits<PacketType>::half} 
      HalfPacketType;
00101   \textcolor{keyword}{enum} \{
00102     PacketSize = internal::unpacket\_traits<PacketType>::size,
00103     HalfPacketSize = internal::unpacket\_traits<HalfPacketType>::size
00104   \};
00105   \textcolor{keyword}{static} \textcolor{keywordtype}{void} run()
00106   \{
00107     
00108     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,PacketSize,1>} Vector1;
00109     \textcolor{keyword}{typedef} \hyperlink{group___core___module}{Matrix<Scalar,Dynamic,1>} \hyperlink{group___core___module}{VectorX};
00110     \textcolor{keyword}{typedef} \hyperlink{group___core___module}{Matrix<Scalar,Dynamic,Dynamic>} MatrixXX;
00111     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,PacketSize,PacketSize>} Matrix11;
00112     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,2*PacketSize,2*PacketSize>} Matrix22;
00113     \textcolor{keyword}{typedef} 
      \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,(Matrix11::Flags&RowMajorBit)?16:4*PacketSize,(Matrix11::Flags&RowMajorBit)?4*PacketSize:16>}
       Matrix44;
00114     \textcolor{keyword}{typedef} 
      \hyperlink{group___core___module_class_eigen_1_1_matrix}{
      Matrix<Scalar,(Matrix11::Flags&RowMajorBit)?16:4*PacketSize,(Matrix11::Flags&RowMajorBit)?4*PacketSize:16,DontAlign|EIGEN\_DEFAULT\_MATRIX\_STORAGE\_ORDER\_OPTION>}
       Matrix44u;
00115     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,4*PacketSize,4*PacketSize,ColMajor>}
       Matrix44c;
00116     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,4*PacketSize,4*PacketSize,RowMajor>}
       Matrix44r;
00117 
00118     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix}<Scalar,
00119         (PacketSize==8 ? 4 : PacketSize==4 ? 2 : PacketSize==2 ? 1 : \textcolor{comment}{/*PacketSize==1 ?*/} 1),
00120         (PacketSize==8 ? 2 : PacketSize==4 ? 2 : PacketSize==2 ? 2 : \textcolor{comment}{/*PacketSize==1 ?*/} 1)
00121       > Matrix1;
00122 
00123     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix}<Scalar,
00124         (PacketSize==8 ? 4 : PacketSize==4 ? 2 : PacketSize==2 ? 1 : \textcolor{comment}{/*PacketSize==1 ?*/} 1),
00125         (PacketSize==8 ? 2 : PacketSize==4 ? 2 : PacketSize==2 ? 2 : \textcolor{comment}{/*PacketSize==1 ?*/} 1),
00126       \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a40a452614141522dd313363dbbd65726}{DontAlign}|((Matrix1::Flags&\hyperlink{group__flags_gae4f56c2a60bbe4bd2e44c5b19cbe8762}{RowMajorBit})?\hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13acfcde9cd8677c5f7caf6bd603666aae3}{RowMajor}:
      \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor})> Matrix1u;
00127 
00128     \textcolor{comment}{// this type is made such that it can only be vectorized when viewed as a linear 1D vector}
00129     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix}<Scalar,
00130         (PacketSize==8 ? 4 : PacketSize==4 ? 6 : PacketSize==2 ? ((Matrix11::Flags&
      \hyperlink{group__flags_gae4f56c2a60bbe4bd2e44c5b19cbe8762}{RowMajorBit})?2:3) : \textcolor{comment}{/*PacketSize==1 ?*/} 1),
00131         (PacketSize==8 ? 6 : PacketSize==4 ? 2 : PacketSize==2 ? ((Matrix11::Flags&
      \hyperlink{group__flags_gae4f56c2a60bbe4bd2e44c5b19cbe8762}{RowMajorBit})?3:2) : \textcolor{comment}{/*PacketSize==1 ?*/} 3)
00132       > Matrix3;
00133     
00134 \textcolor{preprocessor}{    #if !EIGEN\_GCC\_AND\_ARCH\_DOESNT\_WANT\_STACK\_ALIGNMENT}
00135     VERIFY(test\_assign(Vector1(),Vector1(),
00136       InnerVectorizedTraversal,CompleteUnrolling));
00137     VERIFY(test\_assign(Vector1(),Vector1()+Vector1(),
00138       InnerVectorizedTraversal,CompleteUnrolling));
00139     VERIFY(test\_assign(Vector1(),Vector1().cwiseProduct(Vector1()),
00140       InnerVectorizedTraversal,CompleteUnrolling));
00141     VERIFY(test\_assign(Vector1(),Vector1().\textcolor{keyword}{template} cast<Scalar>(),
00142       InnerVectorizedTraversal,CompleteUnrolling));
00143 
00144 
00145     VERIFY(test\_assign(Vector1(),Vector1(),
00146       InnerVectorizedTraversal,CompleteUnrolling));
00147     VERIFY(test\_assign(Vector1(),Vector1()+Vector1(),
00148       InnerVectorizedTraversal,CompleteUnrolling));
00149     VERIFY(test\_assign(Vector1(),Vector1().cwiseProduct(Vector1()),
00150       InnerVectorizedTraversal,CompleteUnrolling));
00151 
00152     VERIFY(test\_assign(Matrix44(),Matrix44()+Matrix44(),
00153       InnerVectorizedTraversal,InnerUnrolling));
00154 
00155     VERIFY(test\_assign(Matrix44u(),Matrix44()+Matrix44(),
00156       EIGEN\_UNALIGNED\_VECTORIZE ? InnerVectorizedTraversal : LinearTraversal,
00157       EIGEN\_UNALIGNED\_VECTORIZE ? InnerUnrolling : NoUnrolling));
00158 
00159     VERIFY(test\_assign(Matrix1(),Matrix1()+Matrix1(),
00160       (Matrix1::InnerSizeAtCompileTime % PacketSize)==0 ? InnerVectorizedTraversal : 
      LinearVectorizedTraversal,
00161       CompleteUnrolling));
00162 
00163     VERIFY(test\_assign(Matrix1u(),Matrix1()+Matrix1(),
00164       EIGEN\_UNALIGNED\_VECTORIZE ? ((Matrix1::InnerSizeAtCompileTime % PacketSize)==0 ? 
      InnerVectorizedTraversal : LinearVectorizedTraversal)
00165                                 : LinearTraversal, CompleteUnrolling));
00166 
00167     VERIFY(test\_assign(Matrix44c().col(1),Matrix44c().col(2)+Matrix44c().col(3),
00168       InnerVectorizedTraversal,CompleteUnrolling));
00169 
00170     VERIFY(test\_assign(Matrix44r().row(2),Matrix44r().row(1)+Matrix44r().row(1),
00171       InnerVectorizedTraversal,CompleteUnrolling));
00172 
00173     \textcolor{keywordflow}{if}(PacketSize>1)
00174     \{
00175       \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,3,3,ColMajor>} Matrix33c;
00176       \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,3,1,ColMajor>} Vector3;
00177       VERIFY(test\_assign(Matrix33c().row(2),Matrix33c().row(1)+Matrix33c().row(1),
00178         LinearTraversal,CompleteUnrolling));
00179       VERIFY(test\_assign(Vector3(),Vector3()+Vector3(),
00180         EIGEN\_UNALIGNED\_VECTORIZE ? (HalfPacketSize==1 ? InnerVectorizedTraversal : 
      LinearVectorizedTraversal) : (HalfPacketSize==1 ? InnerVectorizedTraversal : LinearTraversal), CompleteUnrolling));
00181       VERIFY(test\_assign(Matrix33c().col(0),Matrix33c().col(1)+Matrix33c().col(1),
00182         EIGEN\_UNALIGNED\_VECTORIZE ? (HalfPacketSize==1 ? InnerVectorizedTraversal : 
      LinearVectorizedTraversal) : (HalfPacketSize==1 ? SliceVectorizedTraversal : LinearTraversal),
00183         ((!EIGEN\_UNALIGNED\_VECTORIZE) && HalfPacketSize==1) ? NoUnrolling : CompleteUnrolling));
00184 
00185       VERIFY(test\_assign(Matrix3(),Matrix3().cwiseProduct(Matrix3()),
00186         LinearVectorizedTraversal,CompleteUnrolling));
00187 
00188       VERIFY(test\_assign(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,17,17>}(),
      \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,17,17>}()+\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,17,17>}(),
00189         HalfPacketSize==1             ? InnerVectorizedTraversal  :
00190         EIGEN\_UNALIGNED\_VECTORIZE ? LinearVectorizedTraversal :
00191                                         LinearTraversal,
00192         NoUnrolling));
00193 
00194       VERIFY(test\_assign(Matrix11(), Matrix11()+Matrix11(),InnerVectorizedTraversal,CompleteUnrolling));
00195 
00196 
00197       VERIFY(test\_assign(Matrix11(),\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,17,17>}().\textcolor{keyword}{template} 
      block<PacketSize,PacketSize>(2,3)+\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,17,17>}().\textcolor{keyword}{template} block<PacketSize,PacketSize>(8,4),
00198         (EIGEN\_UNALIGNED\_VECTORIZE) ? InnerVectorizedTraversal : DefaultTraversal, CompleteUnrolling|
      InnerUnrolling));
00199 
00200       VERIFY(test\_assign(Vector1(),Matrix11()*Vector1(),
00201                          InnerVectorizedTraversal,CompleteUnrolling));
00202 
00203       VERIFY(test\_assign(Matrix11(),Matrix11().lazyProduct(Matrix11()),
00204                          InnerVectorizedTraversal,InnerUnrolling+CompleteUnrolling));
00205     \}
00206 
00207     VERIFY(test\_redux(Vector1(),
00208       LinearVectorizedTraversal,CompleteUnrolling));
00209 
00210     VERIFY(test\_redux(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,PacketSize,3>}(),
00211       LinearVectorizedTraversal,CompleteUnrolling));
00212 
00213     VERIFY(test\_redux(Matrix3(),
00214       LinearVectorizedTraversal,CompleteUnrolling));
00215 
00216     VERIFY(test\_redux(Matrix44(),
00217       LinearVectorizedTraversal,NoUnrolling));
00218 
00219     VERIFY(test\_redux(Matrix44().\textcolor{keyword}{template} block<(Matrix1::Flags&RowMajorBit)?4:PacketSize,(Matrix1::Flags&
      RowMajorBit)?PacketSize:4>(1,2),
00220       DefaultTraversal,CompleteUnrolling));
00221 
00222     VERIFY(test\_redux(Matrix44c().\textcolor{keyword}{template} block<2*PacketSize,1>(1,2),
00223       LinearVectorizedTraversal,CompleteUnrolling));
00224 
00225     VERIFY(test\_redux(Matrix44r().\textcolor{keyword}{template} block<1,2*PacketSize>(2,1),
00226       LinearVectorizedTraversal,CompleteUnrolling));
00227 
00228     VERIFY((test\_assign<
00229             \hyperlink{group___core___module_class_eigen_1_1_map}{Map}<Matrix22, AlignedMax, \hyperlink{class_eigen_1_1_outer_stride}{OuterStride<3*PacketSize>} >,
00230             Matrix22
00231             >(InnerVectorizedTraversal,CompleteUnrolling)));
00232 
00233     VERIFY((test\_assign<
00234             \hyperlink{group___core___module_class_eigen_1_1_map}{Map}<\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix}<Scalar,EIGEN\_PLAIN\_ENUM\_MAX(2,PacketSize),EIGEN\_PLAIN\_ENUM\_MAX(2,PacketSize
      )>, AlignedMax, \hyperlink{class_eigen_1_1_inner_stride}{InnerStride<3*PacketSize>} >,
00235             \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix}<Scalar,EIGEN\_PLAIN\_ENUM\_MAX(2,PacketSize),EIGEN\_PLAIN\_ENUM\_MAX(2,PacketSize)>
00236             >(DefaultTraversal,PacketSize>=8?InnerUnrolling:CompleteUnrolling)));
00237 
00238     VERIFY((test\_assign(Matrix11(), \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix}<Scalar,PacketSize,EIGEN\_PLAIN\_ENUM\_MIN(2,PacketSize)>()*
      \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix}<Scalar,EIGEN\_PLAIN\_ENUM\_MIN(2,PacketSize),PacketSize>(),
00239                         InnerVectorizedTraversal, CompleteUnrolling)));
00240 \textcolor{preprocessor}{    #endif}
00241 
00242     VERIFY(test\_assign(MatrixXX(10,10),MatrixXX(20,20).block(10,10,2,3),
00243       SliceVectorizedTraversal,NoUnrolling));
00244 
00245     VERIFY(test\_redux(VectorX(10),
00246       LinearVectorizedTraversal,NoUnrolling));
00247   \}
00248 \};
00249 
00250 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Scalar> \textcolor{keyword}{struct }\hyperlink{structvectorization__logic}{vectorization\_logic}<Scalar,false>
00251 \{
00252   \textcolor{keyword}{static} \textcolor{keywordtype}{void} run() \{\}
00253 \};
00254 
00255 template<typename Scalar, bool Enable = !internal::is\_same<typename internal::unpacket\_traits<typename
       internal::packet\_traits<Scalar>::type>\hyperlink{struct_eigen_1_1half}{::half},
00256                                                            \textcolor{keyword}{typename} 
      \hyperlink{group___sparse_core___module}{internal::packet\_traits<Scalar>::type}>::value >
00257 \textcolor{keyword}{struct }\hyperlink{structvectorization__logic__half}{vectorization\_logic\_half}
00258 \{
00259   \textcolor{keyword}{typedef} internal::packet\_traits<Scalar> PacketTraits;
00260   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} internal::unpacket\_traits<typename internal::packet\_traits<Scalar>::type>::half 
      PacketType;
00261   \textcolor{keyword}{enum} \{
00262     PacketSize = internal::unpacket\_traits<PacketType>::size
00263   \};
00264   \textcolor{keyword}{static} \textcolor{keywordtype}{void} run()
00265   \{
00266     
00267     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,PacketSize,1>} Vector1;
00268     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,PacketSize,PacketSize>} Matrix11;
00269     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,5*PacketSize,7,ColMajor>} Matrix57;
00270     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,3*PacketSize,5,ColMajor>} Matrix35;
00271     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,5*PacketSize,7,DontAlign|ColMajor>}
       Matrix57u;
00272 \textcolor{comment}{//     typedef
       Matrix<Scalar,(Matrix11::Flags&RowMajorBit)?16:4*PacketSize,(Matrix11::Flags&RowMajorBit)?4*PacketSize:16> Matrix44;}
00273 \textcolor{comment}{//     typedef
       Matrix<Scalar,(Matrix11::Flags&RowMajorBit)?16:4*PacketSize,(Matrix11::Flags&RowMajorBit)?4*PacketSize:16,DontAlign|EIGEN\_DEFAULT\_MATRIX\_STORAGE\_ORDER\_OPTION> Matrix44u;}
00274 \textcolor{comment}{//     typedef Matrix<Scalar,4*PacketSize,4*PacketSize,ColMajor> Matrix44c;}
00275 \textcolor{comment}{//     typedef Matrix<Scalar,4*PacketSize,4*PacketSize,RowMajor> Matrix44r;}
00276 
00277     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix}<Scalar,
00278         (PacketSize==8 ? 4 : PacketSize==4 ? 2 : PacketSize==2 ? 1 : \textcolor{comment}{/*PacketSize==1 ?*/} 1),
00279         (PacketSize==8 ? 2 : PacketSize==4 ? 2 : PacketSize==2 ? 2 : \textcolor{comment}{/*PacketSize==1 ?*/} 1)
00280       > Matrix1;
00281 
00282     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix}<Scalar,
00283         (PacketSize==8 ? 4 : PacketSize==4 ? 2 : PacketSize==2 ? 1 : \textcolor{comment}{/*PacketSize==1 ?*/} 1),
00284         (PacketSize==8 ? 2 : PacketSize==4 ? 2 : PacketSize==2 ? 2 : \textcolor{comment}{/*PacketSize==1 ?*/} 1),
00285       \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a40a452614141522dd313363dbbd65726}{DontAlign}|((Matrix1::Flags&\hyperlink{group__flags_gae4f56c2a60bbe4bd2e44c5b19cbe8762}{RowMajorBit})?\hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13acfcde9cd8677c5f7caf6bd603666aae3}{RowMajor}:ColMajor)> Matrix1u;
00286 
00287     \textcolor{comment}{// this type is made such that it can only be vectorized when viewed as a linear 1D vector}
00288     \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix}<Scalar,
00289         (PacketSize==8 ? 4 : PacketSize==4 ? 6 : PacketSize==2 ? ((Matrix11::Flags&
      \hyperlink{group__flags_gae4f56c2a60bbe4bd2e44c5b19cbe8762}{RowMajorBit})?2:3) : \textcolor{comment}{/*PacketSize==1 ?*/} 1),
00290         (PacketSize==8 ? 6 : PacketSize==4 ? 2 : PacketSize==2 ? ((Matrix11::Flags&RowMajorBit)?3:2) : \textcolor{comment}{/*
      PacketSize==1 ?*/} 3)
00291       > Matrix3;
00292     
00293 \textcolor{preprocessor}{    #if !EIGEN\_GCC\_AND\_ARCH\_DOESNT\_WANT\_STACK\_ALIGNMENT}
00294     VERIFY(test\_assign(Vector1(),Vector1(),
00295       InnerVectorizedTraversal,CompleteUnrolling));
00296     VERIFY(test\_assign(Vector1(),Vector1()+Vector1(),
00297       InnerVectorizedTraversal,CompleteUnrolling));
00298     VERIFY(test\_assign(Vector1(),Vector1().\textcolor{keyword}{template} segment<PacketSize>(0).derived(),
00299       EIGEN\_UNALIGNED\_VECTORIZE ? InnerVectorizedTraversal : LinearVectorizedTraversal,CompleteUnrolling));
00300     VERIFY(test\_assign(Vector1(),Scalar(2.1)*Vector1()-Vector1(),
00301       InnerVectorizedTraversal,CompleteUnrolling));
00302     VERIFY(test\_assign(Vector1(),(Scalar(2.1)*Vector1().\textcolor{keyword}{template} segment<PacketSize>(0)-Vector1().\textcolor{keyword}{template} 
      segment<PacketSize>(0)).derived(),
00303       EIGEN\_UNALIGNED\_VECTORIZE ? InnerVectorizedTraversal : LinearVectorizedTraversal,CompleteUnrolling));
00304     VERIFY(test\_assign(Vector1(),Vector1().cwiseProduct(Vector1()),
00305       InnerVectorizedTraversal,CompleteUnrolling));
00306     VERIFY(test\_assign(Vector1(),Vector1().\textcolor{keyword}{template} cast<Scalar>(),
00307       InnerVectorizedTraversal,CompleteUnrolling));
00308 
00309 
00310     VERIFY(test\_assign(Vector1(),Vector1(),
00311       InnerVectorizedTraversal,CompleteUnrolling));
00312     VERIFY(test\_assign(Vector1(),Vector1()+Vector1(),
00313       InnerVectorizedTraversal,CompleteUnrolling));
00314     VERIFY(test\_assign(Vector1(),Vector1().cwiseProduct(Vector1()),
00315       InnerVectorizedTraversal,CompleteUnrolling));
00316 
00317     VERIFY(test\_assign(Matrix57(),Matrix57()+Matrix57(),
00318       InnerVectorizedTraversal,InnerUnrolling));
00319 
00320     VERIFY(test\_assign(Matrix57u(),Matrix57()+Matrix57(),
00321       EIGEN\_UNALIGNED\_VECTORIZE ? InnerVectorizedTraversal : LinearTraversal,
00322       EIGEN\_UNALIGNED\_VECTORIZE ? InnerUnrolling : NoUnrolling));
00323 
00324     VERIFY(test\_assign(Matrix1u(),Matrix1()+Matrix1(),
00325       EIGEN\_UNALIGNED\_VECTORIZE ? ((Matrix1::InnerSizeAtCompileTime % PacketSize)==0 ? 
      InnerVectorizedTraversal : LinearVectorizedTraversal) : LinearTraversal,CompleteUnrolling));
00326         
00327     \textcolor{keywordflow}{if}(PacketSize>1)
00328     \{
00329       \textcolor{keyword}{typedef} \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,3,3,ColMajor>} Matrix33c;
00330       VERIFY(test\_assign(Matrix33c().row(2),Matrix33c().row(1)+Matrix33c().row(1),
00331         LinearTraversal,CompleteUnrolling));
00332       VERIFY(test\_assign(Matrix33c().col(0),Matrix33c().col(1)+Matrix33c().col(1),
00333         EIGEN\_UNALIGNED\_VECTORIZE ? (PacketSize==1 ? InnerVectorizedTraversal : LinearVectorizedTraversal) 
      : LinearTraversal,CompleteUnrolling));
00334               
00335       VERIFY(test\_assign(Matrix3(),Matrix3().cwiseQuotient(Matrix3()),
00336         PacketTraits::HasDiv ? LinearVectorizedTraversal : LinearTraversal,CompleteUnrolling));
00337         
00338       VERIFY(test\_assign(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,17,17>}(),
      \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,17,17>}()+\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,17,17>}(),
00339         EIGEN\_UNALIGNED\_VECTORIZE ? (PacketSize==1 ? InnerVectorizedTraversal : LinearVectorizedTraversal) 
      : LinearTraversal,
00340         NoUnrolling));
00341         
00342       VERIFY(test\_assign(Matrix11(),\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,17,17>}().\textcolor{keyword}{template} 
      block<PacketSize,PacketSize>(2,3)+\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,17,17>}().\textcolor{keyword}{template} block<PacketSize,PacketSize>(8,4),
00343         EIGEN\_UNALIGNED\_VECTORIZE ? InnerVectorizedTraversal : DefaultTraversal,PacketSize>4?InnerUnrolling
      :CompleteUnrolling));
00344 
00345       VERIFY(test\_assign(Vector1(),Matrix11()*Vector1(),
00346                          InnerVectorizedTraversal,CompleteUnrolling));
00347 
00348       VERIFY(test\_assign(Matrix11(),Matrix11().lazyProduct(Matrix11()),
00349                          InnerVectorizedTraversal,InnerUnrolling+CompleteUnrolling));
00350     \}
00351     
00352     VERIFY(test\_redux(Vector1(),
00353       LinearVectorizedTraversal,CompleteUnrolling));
00354 
00355     VERIFY(test\_redux(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,PacketSize,3>}(),
00356       LinearVectorizedTraversal,CompleteUnrolling));
00357 
00358     VERIFY(test\_redux(Matrix3(),
00359       LinearVectorizedTraversal,CompleteUnrolling));
00360 
00361     VERIFY(test\_redux(Matrix35(),
00362       LinearVectorizedTraversal,CompleteUnrolling));
00363 
00364     VERIFY(test\_redux(Matrix57().\textcolor{keyword}{template} block<PacketSize,3>(1,0),
00365       DefaultTraversal,CompleteUnrolling));
00366 
00367     VERIFY((test\_assign<
00368             \hyperlink{group___core___module_class_eigen_1_1_map}{Map}<\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix}<Scalar,EIGEN\_PLAIN\_ENUM\_MAX(2,PacketSize),EIGEN\_PLAIN\_ENUM\_MAX(2,PacketSize
      )>, AlignedMax, \hyperlink{class_eigen_1_1_inner_stride}{InnerStride<3*PacketSize>} >,
00369             \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix}<Scalar,EIGEN\_PLAIN\_ENUM\_MAX(2,PacketSize),EIGEN\_PLAIN\_ENUM\_MAX(2,PacketSize)>
00370             >(DefaultTraversal,CompleteUnrolling)));
00371 
00372     VERIFY((test\_assign(Matrix57(), \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,5*PacketSize,3>}()*
      \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,3,7>}(),
00373                         InnerVectorizedTraversal, InnerUnrolling|CompleteUnrolling)));
00374 \textcolor{preprocessor}{    #endif}
00375   \}
00376 \};
00377 
00378 \textcolor{keyword}{template}<\textcolor{keyword}{typename} Scalar> \textcolor{keyword}{struct }\hyperlink{structvectorization__logic__half}{vectorization\_logic\_half}<Scalar,false>
00379 \{
00380   \textcolor{keyword}{static} \textcolor{keywordtype}{void} run() \{\}
00381 \};
00382 
00383 \textcolor{keywordtype}{void} test\_vectorization\_logic()
00384 \{
00385 
00386 \textcolor{preprocessor}{#ifdef EIGEN\_VECTORIZE}
00387 
00388   CALL\_SUBTEST( \hyperlink{structvectorization__logic}{vectorization\_logic<int>::run}() );
00389   CALL\_SUBTEST( \hyperlink{structvectorization__logic}{vectorization\_logic<float>::run}() );
00390   CALL\_SUBTEST( \hyperlink{structvectorization__logic}{vectorization\_logic<double>::run}() );
00391   CALL\_SUBTEST( \hyperlink{structvectorization__logic}{vectorization\_logic}<std::complex<float> >::run() );
00392   CALL\_SUBTEST( \hyperlink{structvectorization__logic}{vectorization\_logic}<std::complex<double> >::run() );
00393   
00394   CALL\_SUBTEST( \hyperlink{structvectorization__logic__half}{vectorization\_logic\_half<int>::run}() );
00395   CALL\_SUBTEST( \hyperlink{structvectorization__logic__half}{vectorization\_logic\_half<float>::run}() );
00396   CALL\_SUBTEST( \hyperlink{structvectorization__logic__half}{vectorization\_logic\_half<double>::run}() );
00397   CALL\_SUBTEST( \hyperlink{structvectorization__logic__half}{vectorization\_logic\_half}<std::complex<float> >::run() );
00398   CALL\_SUBTEST( \hyperlink{structvectorization__logic__half}{vectorization\_logic\_half}<std::complex<double> >::run() );
00399   
00400   \textcolor{keywordflow}{if}(internal::packet\_traits<float>::Vectorizable)
00401   \{
00402     VERIFY(test\_assign(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<float,3,3>}(),\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<float,3,3>}()+
      \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<float,3,3>}(),
00403       EIGEN\_UNALIGNED\_VECTORIZE ? LinearVectorizedTraversal : LinearTraversal,CompleteUnrolling));
00404       
00405     VERIFY(test\_redux(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<float,5,2>}(),
00406       EIGEN\_UNALIGNED\_VECTORIZE ? LinearVectorizedTraversal : DefaultTraversal,CompleteUnrolling));
00407   \}
00408   
00409   \textcolor{keywordflow}{if}(internal::packet\_traits<double>::Vectorizable)
00410   \{
00411     VERIFY(test\_assign(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<double,3,3>}(),\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<double,3,3>}()+
      \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<double,3,3>}(),
00412       EIGEN\_UNALIGNED\_VECTORIZE ? LinearVectorizedTraversal : LinearTraversal,CompleteUnrolling));
00413     
00414     VERIFY(test\_redux(\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<double,7,3>}(),
00415       EIGEN\_UNALIGNED\_VECTORIZE ? LinearVectorizedTraversal : DefaultTraversal,CompleteUnrolling));
00416   \}
00417 \textcolor{preprocessor}{#endif // EIGEN\_VECTORIZE}
00418 
00419 \}
\end{DoxyCode}
