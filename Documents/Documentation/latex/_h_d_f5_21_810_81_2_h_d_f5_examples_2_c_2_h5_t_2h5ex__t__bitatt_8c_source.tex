\hypertarget{_h_d_f5_21_810_81_2_h_d_f5_examples_2_c_2_h5_t_2h5ex__t__bitatt_8c_source}{}\section{H\+D\+F5/1.10.1/\+H\+D\+F5\+Examples/\+C/\+H5\+T/h5ex\+\_\+t\+\_\+bitatt.c}
\label{_h_d_f5_21_810_81_2_h_d_f5_examples_2_c_2_h5_t_2h5ex__t__bitatt_8c_source}\index{h5ex\+\_\+t\+\_\+bitatt.\+c@{h5ex\+\_\+t\+\_\+bitatt.\+c}}

\begin{DoxyCode}
00001 \textcolor{comment}{/************************************************************}
00002 \textcolor{comment}{}
00003 \textcolor{comment}{  This example shows how to read and write bitfield}
00004 \textcolor{comment}{  datatypes to an attribute.  The program first writes bit}
00005 \textcolor{comment}{  fields to an attribute with a dataspace of DIM0xDIM1, then}
00006 \textcolor{comment}{  closes the file.  Next, it reopens the file, reads back}
00007 \textcolor{comment}{  the data, and outputs it to the screen.}
00008 \textcolor{comment}{}
00009 \textcolor{comment}{  This file is intended for use with HDF5 Library version 1.8}
00010 \textcolor{comment}{}
00011 \textcolor{comment}{ ************************************************************/}
00012 
00013 \textcolor{preprocessor}{#include "hdf5.h"}
00014 \textcolor{preprocessor}{#include <stdio.h>}
00015 \textcolor{preprocessor}{#include <stdlib.h>}
00016 
00017 \textcolor{preprocessor}{#define FILE            "h5ex\_t\_bitatt.h5"}
00018 \textcolor{preprocessor}{#define DATASET         "DS1"}
00019 \textcolor{preprocessor}{#define ATTRIBUTE       "A1"}
00020 \textcolor{preprocessor}{#define DIM0            4}
00021 \textcolor{preprocessor}{#define DIM1            7}
00022 
00023 \textcolor{keywordtype}{int}
00024 main (\textcolor{keywordtype}{void})
00025 \{
00026     hid\_t           \hyperlink{structfile}{file}, space, dset, attr;    \textcolor{comment}{/* Handles */}
00027     herr\_t          status;
00028     hsize\_t         dims[2] = \{DIM0, DIM1\};
00029     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}   wdata[DIM0][DIM1],          \textcolor{comment}{/* Write buffer */}
00030                     **rdata;                    \textcolor{comment}{/* Read buffer */}
00031     \textcolor{keywordtype}{int}             ndims, A, B, C, D,
00032                     i, j;
00033 
00034     \textcolor{comment}{/*}
00035 \textcolor{comment}{     * Initialize data.  We will manually pack 4 2-bit integers into}
00036 \textcolor{comment}{     * each unsigned char data element.}
00037 \textcolor{comment}{     */}
00038     \textcolor{keywordflow}{for} (i=0; i<DIM0; i++)
00039         \textcolor{keywordflow}{for} (j=0; j<DIM1; j++) \{
00040             wdata[i][j] = 0;
00041             wdata[i][j] |= (i * j - j) & 0x03;          \textcolor{comment}{/* Field "A" */}
00042             wdata[i][j] |= (i & 0x03) << 2;             \textcolor{comment}{/* Field "B" */}
00043             wdata[i][j] |= (j & 0x03) << 4;             \textcolor{comment}{/* Field "C" */}
00044             wdata[i][j] |= ( (i + j) & 0x03 ) <<6;      \textcolor{comment}{/* Field "D" */}
00045         \}
00046 
00047     \textcolor{comment}{/*}
00048 \textcolor{comment}{     * Create a new file using the default properties.}
00049 \textcolor{comment}{     */}
00050     file = H5Fcreate (FILE, H5F\_ACC\_TRUNC, H5P\_DEFAULT, H5P\_DEFAULT);
00051 
00052     \textcolor{comment}{/*}
00053 \textcolor{comment}{     * Create dataset with a null dataspace.}
00054 \textcolor{comment}{     */}
00055     space = H5Screate (H5S\_NULL);
00056     dset = H5Dcreate (file, DATASET, H5T\_STD\_I32LE, space, H5P\_DEFAULT,
00057                 H5P\_DEFAULT, H5P\_DEFAULT);
00058     status = H5Sclose (space);
00059 
00060     \textcolor{comment}{/*}
00061 \textcolor{comment}{     * Create dataspace.  Setting maximum size to NULL sets the maximum}
00062 \textcolor{comment}{     * size to be the current size.}
00063 \textcolor{comment}{     */}
00064     space = H5Screate\_simple (2, dims, NULL);
00065 
00066     \textcolor{comment}{/*}
00067 \textcolor{comment}{     * Create the attribute and write the bitfield data to it.}
00068 \textcolor{comment}{     */}
00069     attr = H5Acreate (dset, ATTRIBUTE, H5T\_STD\_B8BE, space, H5P\_DEFAULT,
00070                 H5P\_DEFAULT);
00071     status = H5Awrite (attr, H5T\_NATIVE\_B8, wdata[0]);
00072 
00073     \textcolor{comment}{/*}
00074 \textcolor{comment}{     * Close and release resources.}
00075 \textcolor{comment}{     */}
00076     status = H5Aclose (attr);
00077     status = H5Dclose (dset);
00078     status = H5Sclose (space);
00079     status = H5Fclose (file);
00080 
00081 
00082     \textcolor{comment}{/*}
00083 \textcolor{comment}{     * Now we begin the read section of this example.  Here we assume}
00084 \textcolor{comment}{     * the attribute has the same name and rank, but can have any size.}
00085 \textcolor{comment}{     * Therefore we must allocate a new array to read in data using}
00086 \textcolor{comment}{     * malloc().}
00087 \textcolor{comment}{     */}
00088 
00089     \textcolor{comment}{/*}
00090 \textcolor{comment}{     * Open file, dataset, and attribute.}
00091 \textcolor{comment}{     */}
00092     file = H5Fopen (FILE, H5F\_ACC\_RDONLY, H5P\_DEFAULT);
00093     dset = H5Dopen (file, DATASET, H5P\_DEFAULT);
00094     attr = H5Aopen (dset, ATTRIBUTE, H5P\_DEFAULT);
00095 
00096     \textcolor{comment}{/*}
00097 \textcolor{comment}{     * Get dataspace and allocate memory for read buffer.  This is a}
00098 \textcolor{comment}{     * two dimensional attribute so the dynamic allocation must be done}
00099 \textcolor{comment}{     * in steps.}
00100 \textcolor{comment}{     */}
00101     space = H5Aget\_space (attr);
00102     ndims = H5Sget\_simple\_extent\_dims (space, dims, NULL);
00103 
00104     \textcolor{comment}{/*}
00105 \textcolor{comment}{     * Allocate array of pointers to rows.}
00106 \textcolor{comment}{     */}
00107     rdata = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} **) malloc (dims[0] * \textcolor{keyword}{sizeof} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *));
00108 
00109     \textcolor{comment}{/*}
00110 \textcolor{comment}{     * Allocate space for bitfield data.}
00111 \textcolor{comment}{     */}
00112     rdata[0] = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *) malloc (dims[0] * dims[1] *
00113                 \textcolor{keyword}{sizeof} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}));
00114 
00115     \textcolor{comment}{/*}
00116 \textcolor{comment}{     * Set the rest of the pointers to rows to the correct addresses.}
00117 \textcolor{comment}{     */}
00118     \textcolor{keywordflow}{for} (i=1; i<dims[0]; i++)
00119         rdata[i] = rdata[0] + i * dims[1];
00120 
00121     \textcolor{comment}{/*}
00122 \textcolor{comment}{     * Read the data.}
00123 \textcolor{comment}{     */}
00124     status = H5Aread (attr, H5T\_NATIVE\_B8, rdata[0]);
00125 
00126     \textcolor{comment}{/*}
00127 \textcolor{comment}{     * Output the data to the screen.}
00128 \textcolor{comment}{     */}
00129     printf (\textcolor{stringliteral}{"%s:\(\backslash\)n"}, ATTRIBUTE);
00130     \textcolor{keywordflow}{for} (i=0; i<dims[0]; i++) \{
00131         printf (\textcolor{stringliteral}{" ["});
00132         \textcolor{keywordflow}{for} (j=0; j<dims[1]; j++)\{
00133             A = rdata[i][j] & 0x03;         \textcolor{comment}{/* Retrieve field "A" */}
00134             B = (rdata[i][j] >> 2) & 0x03;  \textcolor{comment}{/* Retrieve field "B" */}
00135             C = (rdata[i][j] >> 4) & 0x03;  \textcolor{comment}{/* Retrieve field "C" */}
00136             D = (rdata[i][j] >> 6) & 0x03;  \textcolor{comment}{/* Retrieve field "D" */}
00137             printf (\textcolor{stringliteral}{" \{%d, %d, %d, %d\}"}, A, B, C, D);
00138         \}
00139         printf (\textcolor{stringliteral}{" ]\(\backslash\)n"});
00140     \}
00141 
00142     \textcolor{comment}{/*}
00143 \textcolor{comment}{     * Close and release resources.}
00144 \textcolor{comment}{     */}
00145     free (rdata[0]);
00146     free (rdata);
00147     status = H5Aclose (attr);
00148     status = H5Dclose (dset);
00149     status = H5Sclose (space);
00150     status = H5Fclose (file);
00151 
00152     \textcolor{keywordflow}{return} 0;
00153 \}
\end{DoxyCode}
