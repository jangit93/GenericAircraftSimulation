\hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2_c_x_x11_2src_2_tensor_2_tensor_sycl_expr_constructor_8h_source}{}\section{matio/visual\+\_\+studio/test/eigen/unsupported/\+Eigen/\+C\+X\+X11/src/\+Tensor/\+Tensor\+Sycl\+Expr\+Constructor.h}
\label{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2_c_x_x11_2src_2_tensor_2_tensor_sycl_expr_constructor_8h_source}\index{Tensor\+Sycl\+Expr\+Constructor.\+h@{Tensor\+Sycl\+Expr\+Constructor.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Mehdi Goli    Codeplay Software Ltd.}
00005 \textcolor{comment}{// Ralph Potter  Codeplay Software Ltd.}
00006 \textcolor{comment}{// Luke Iwanski  Codeplay Software Ltd.}
00007 \textcolor{comment}{// Contact: <eigen@codeplay.com>}
00008 \textcolor{comment}{//}
00009 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00010 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00011 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00012 
00013 \textcolor{comment}{/*****************************************************************}
00014 \textcolor{comment}{ * TensorSyclExprConstructor.h}
00015 \textcolor{comment}{ *}
00016 \textcolor{comment}{ * \(\backslash\)brief:}
00017 \textcolor{comment}{ *  This file re-create an expression on the SYCL device in order}
00018 \textcolor{comment}{ *  to use the original tensor evaluator.}
00019 \textcolor{comment}{ *}
00020 \textcolor{comment}{*****************************************************************/}
00021 
00022 \textcolor{preprocessor}{#ifndef UNSUPPORTED\_EIGEN\_CXX11\_SRC\_TENSOR\_TENSORSYCL\_EXPR\_CONSTRUCTOR\_HPP}
00023 \textcolor{preprocessor}{#define UNSUPPORTED\_EIGEN\_CXX11\_SRC\_TENSOR\_TENSORSYCL\_EXPR\_CONSTRUCTOR\_HPP}
00024 
00025 \textcolor{keyword}{namespace }\hyperlink{namespace_eigen}{Eigen} \{
00026 \textcolor{keyword}{namespace }TensorSycl \{
00027 \textcolor{keyword}{namespace }\hyperlink{namespaceinternal}{internal} \{
00030 \textcolor{keyword}{template} <\textcolor{keyword}{typename} PtrType, \textcolor{keywordtype}{size\_t} N, \textcolor{keyword}{typename}... Params>
00031 \textcolor{keyword}{struct }EvalToLHSConstructor \{
00032   PtrType expr;
00033   EvalToLHSConstructor(\textcolor{keyword}{const} \hyperlink{structutility_1_1tuple_1_1_tuple}{utility::tuple::Tuple<Params...>} &t): expr((&(
      *(\hyperlink{namespaceutility}{utility}::tuple::get<N>(t).get\_pointer())))) \{\}
00034 \};
00035 
00042 \textcolor{keyword}{template} <\textcolor{keyword}{typename} OrigExpr, \textcolor{keyword}{typename} IndexExpr, \textcolor{keyword}{typename}... Params>
00043 \textcolor{keyword}{struct }ExprConstructor;
00044 
00047 \textcolor{preprocessor}{#define TENSORMAP(CVQual)\(\backslash\)}
00048 \textcolor{preprocessor}{template <typename Scalar\_, int Options\_, int Options2\_, int Options3\_, int NumIndices\_, typename
       IndexType\_,\(\backslash\)}
00049 \textcolor{preprocessor}{template <class> class MakePointer\_, size\_t N, typename... Params>\(\backslash\)}
00050 \textcolor{preprocessor}{struct ExprConstructor< CVQual TensorMap<Tensor<Scalar\_, NumIndices\_, Options\_, IndexType\_>, Options2\_,
       MakeGlobalPointer>,\(\backslash\)}
00051 \textcolor{preprocessor}{CVQual PlaceHolder<CVQual TensorMap<Tensor<Scalar\_, NumIndices\_, Options\_, IndexType\_>, Options3\_,
       MakePointer\_>, N>, Params...>\{\(\backslash\)}
00052 \textcolor{preprocessor}{  typedef  CVQual TensorMap<Tensor<Scalar\_, NumIndices\_, Options\_, IndexType\_>, Options2\_,
       MakeGlobalPointer>  Type;\(\backslash\)}
00053 \textcolor{preprocessor}{  Type expr;\(\backslash\)}
00054 \textcolor{preprocessor}{  template <typename FuncDetector>\(\backslash\)}
00055 \textcolor{preprocessor}{  ExprConstructor(FuncDetector &fd, const utility::tuple::Tuple<Params...> &t)\(\backslash\)}
00056 \textcolor{preprocessor}{  : expr(Type((&(*(utility::tuple::get<N>(t).get\_pointer()))), fd.dimensions())) \{\}\(\backslash\)}
00057 \textcolor{preprocessor}{\};}
00058 
00059 TENSORMAP(\textcolor{keyword}{const})
00060 TENSORMAP()
00061 \textcolor{preprocessor}{#undef TENSORMAP}
00062 
00063 \textcolor{preprocessor}{#define UNARYCATEGORY(CVQual)\(\backslash\)}
00064 \textcolor{preprocessor}{template <template<class, class> class UnaryCategory, typename OP, typename OrigRHSExpr, typename RHSExpr,
       typename... Params>\(\backslash\)}
00065 \textcolor{preprocessor}{struct ExprConstructor<CVQual UnaryCategory<OP, OrigRHSExpr>, CVQual UnaryCategory<OP, RHSExpr>, Params...>
       \{\(\backslash\)}
00066 \textcolor{preprocessor}{  typedef  ExprConstructor<OrigRHSExpr, RHSExpr, Params...> my\_type;\(\backslash\)}
00067 \textcolor{preprocessor}{  my\_type rhsExpr;\(\backslash\)}
00068 \textcolor{preprocessor}{  typedef CVQual UnaryCategory<OP, typename my\_type::Type> Type;\(\backslash\)}
00069 \textcolor{preprocessor}{  Type expr;\(\backslash\)}
00070 \textcolor{preprocessor}{  template <typename FuncDetector>\(\backslash\)}
00071 \textcolor{preprocessor}{  ExprConstructor(FuncDetector &funcD, const utility::tuple::Tuple<Params...> &t)\(\backslash\)}
00072 \textcolor{preprocessor}{  : rhsExpr(funcD.rhsExpr, t), expr(rhsExpr.expr, funcD.func) \{\}\(\backslash\)}
00073 \textcolor{preprocessor}{\};}
00074 
00075 UNARYCATEGORY(\textcolor{keyword}{const})
00076 UNARYCATEGORY()
00077 \textcolor{preprocessor}{#undef UNARYCATEGORY}
00078 
00081 \textcolor{preprocessor}{#define BINARYCATEGORY(CVQual)\(\backslash\)}
00082 \textcolor{preprocessor}{template <template<class, class, class> class BinaryCategory, typename OP, typename OrigLHSExpr, typename
       OrigRHSExpr, typename LHSExpr,\(\backslash\)}
00083 \textcolor{preprocessor}{typename RHSExpr, typename... Params>\(\backslash\)}
00084 \textcolor{preprocessor}{struct ExprConstructor<CVQual BinaryCategory<OP, OrigLHSExpr, OrigRHSExpr>,  CVQual BinaryCategory<OP,
       LHSExpr, RHSExpr>, Params...> \{\(\backslash\)}
00085 \textcolor{preprocessor}{  typedef  ExprConstructor<OrigLHSExpr, LHSExpr, Params...> my\_left\_type;\(\backslash\)}
00086 \textcolor{preprocessor}{  typedef  ExprConstructor<OrigRHSExpr, RHSExpr, Params...> my\_right\_type;\(\backslash\)}
00087 \textcolor{preprocessor}{  typedef  CVQual BinaryCategory<OP, typename my\_left\_type::Type, typename my\_right\_type::Type> Type;\(\backslash\)}
00088 \textcolor{preprocessor}{  my\_left\_type lhsExpr;\(\backslash\)}
00089 \textcolor{preprocessor}{  my\_right\_type rhsExpr;\(\backslash\)}
00090 \textcolor{preprocessor}{  Type expr;\(\backslash\)}
00091 \textcolor{preprocessor}{  template <typename FuncDetector>\(\backslash\)}
00092 \textcolor{preprocessor}{  ExprConstructor(FuncDetector &funcD, const utility::tuple::Tuple<Params...> &t)\(\backslash\)}
00093 \textcolor{preprocessor}{  : lhsExpr(funcD.lhsExpr, t),rhsExpr(funcD.rhsExpr, t), expr(lhsExpr.expr, rhsExpr.expr, funcD.func) \{\}\(\backslash\)}
00094 \textcolor{preprocessor}{\};}
00095 
00096 BINARYCATEGORY(\textcolor{keyword}{const})
00097 BINARYCATEGORY()
00098 \textcolor{preprocessor}{#undef BINARYCATEGORY}
00099 
00102 \textcolor{preprocessor}{#define TERNARYCATEGORY(CVQual)\(\backslash\)}
00103 \textcolor{preprocessor}{template <template <class, class, class, class> class TernaryCategory, typename OP, typename OrigArg1Expr,
       typename OrigArg2Expr,typename OrigArg3Expr,\(\backslash\)}
00104 \textcolor{preprocessor}{typename Arg1Expr, typename Arg2Expr, typename Arg3Expr, typename... Params>\(\backslash\)}
00105 \textcolor{preprocessor}{struct ExprConstructor<CVQual TernaryCategory<OP, OrigArg1Expr, OrigArg2Expr, OrigArg3Expr>, CVQual
       TernaryCategory<OP, Arg1Expr, Arg2Expr, Arg3Expr>, Params...> \{\(\backslash\)}
00106 \textcolor{preprocessor}{  typedef ExprConstructor<OrigArg1Expr, Arg1Expr, Params...> my\_arg1\_type;\(\backslash\)}
00107 \textcolor{preprocessor}{  typedef ExprConstructor<OrigArg2Expr, Arg2Expr, Params...> my\_arg2\_type;\(\backslash\)}
00108 \textcolor{preprocessor}{  typedef ExprConstructor<OrigArg3Expr, Arg3Expr, Params...> my\_arg3\_type;\(\backslash\)}
00109 \textcolor{preprocessor}{  typedef  CVQual TernaryCategory<OP, typename my\_arg1\_type::Type, typename my\_arg2\_type::Type, typename
       my\_arg3\_type::Type> Type;\(\backslash\)}
00110 \textcolor{preprocessor}{  my\_arg1\_type arg1Expr;\(\backslash\)}
00111 \textcolor{preprocessor}{  my\_arg2\_type arg2Expr;\(\backslash\)}
00112 \textcolor{preprocessor}{  my\_arg3\_type arg3Expr;\(\backslash\)}
00113 \textcolor{preprocessor}{  Type expr;\(\backslash\)}
00114 \textcolor{preprocessor}{  template <typename FuncDetector>\(\backslash\)}
00115 \textcolor{preprocessor}{  ExprConstructor(FuncDetector &funcD,const utility::tuple::Tuple<Params...> &t)\(\backslash\)}
00116 \textcolor{preprocessor}{  : arg1Expr(funcD.arg1Expr, t), arg2Expr(funcD.arg2Expr, t), arg3Expr(funcD.arg3Expr, t),
       expr(arg1Expr.expr, arg2Expr.expr, arg3Expr.expr, funcD.func) \{\}\(\backslash\)}
00117 \textcolor{preprocessor}{\};}
00118 
00119 TERNARYCATEGORY(\textcolor{keyword}{const})
00120 TERNARYCATEGORY()
00121 \textcolor{preprocessor}{#undef TERNARYCATEGORY}
00122 
00125 \textcolor{preprocessor}{#define SELECTOP(CVQual)\(\backslash\)}
00126 \textcolor{preprocessor}{template <typename OrigIfExpr, typename OrigThenExpr, typename OrigElseExpr, typename IfExpr, typename
       ThenExpr, typename ElseExpr, typename... Params>\(\backslash\)}
00127 \textcolor{preprocessor}{struct ExprConstructor< CVQual TensorSelectOp<OrigIfExpr, OrigThenExpr, OrigElseExpr>, CVQual
       TensorSelectOp<IfExpr, ThenExpr, ElseExpr>, Params...> \{\(\backslash\)}
00128 \textcolor{preprocessor}{  typedef  ExprConstructor<OrigIfExpr, IfExpr, Params...> my\_if\_type;\(\backslash\)}
00129 \textcolor{preprocessor}{  typedef  ExprConstructor<OrigThenExpr, ThenExpr, Params...> my\_then\_type;\(\backslash\)}
00130 \textcolor{preprocessor}{  typedef  ExprConstructor<OrigElseExpr, ElseExpr, Params...> my\_else\_type;\(\backslash\)}
00131 \textcolor{preprocessor}{  typedef CVQual TensorSelectOp<typename my\_if\_type::Type, typename my\_then\_type::Type, typename
       my\_else\_type::Type> Type;\(\backslash\)}
00132 \textcolor{preprocessor}{  my\_if\_type ifExpr;\(\backslash\)}
00133 \textcolor{preprocessor}{  my\_then\_type thenExpr;\(\backslash\)}
00134 \textcolor{preprocessor}{  my\_else\_type elseExpr;\(\backslash\)}
00135 \textcolor{preprocessor}{  Type expr;\(\backslash\)}
00136 \textcolor{preprocessor}{  template <typename FuncDetector>\(\backslash\)}
00137 \textcolor{preprocessor}{  ExprConstructor(FuncDetector &funcD, const utility::tuple::Tuple<Params...> &t)\(\backslash\)}
00138 \textcolor{preprocessor}{  : ifExpr(funcD.ifExpr, t), thenExpr(funcD.thenExpr, t), elseExpr(funcD.elseExpr, t), expr(ifExpr.expr,
       thenExpr.expr, elseExpr.expr) \{\}\(\backslash\)}
00139 \textcolor{preprocessor}{\};}
00140 
00141 SELECTOP(\textcolor{keyword}{const})
00142 SELECTOP()
00143 \textcolor{preprocessor}{#undef SELECTOP}
00144 
00147 \textcolor{preprocessor}{#define ASSIGN(CVQual)\(\backslash\)}
00148 \textcolor{preprocessor}{template <typename OrigLHSExpr, typename OrigRHSExpr, typename LHSExpr, typename RHSExpr, typename...
       Params>\(\backslash\)}
00149 \textcolor{preprocessor}{struct ExprConstructor<CVQual TensorAssignOp<OrigLHSExpr, OrigRHSExpr>,  CVQual TensorAssignOp<LHSExpr,
       RHSExpr>, Params...> \{\(\backslash\)}
00150 \textcolor{preprocessor}{  typedef ExprConstructor<OrigLHSExpr, LHSExpr, Params...> my\_left\_type;\(\backslash\)}
00151 \textcolor{preprocessor}{  typedef ExprConstructor<OrigRHSExpr, RHSExpr, Params...> my\_right\_type;\(\backslash\)}
00152 \textcolor{preprocessor}{  typedef CVQual TensorAssignOp<typename my\_left\_type::Type, typename my\_right\_type::Type>  Type;\(\backslash\)}
00153 \textcolor{preprocessor}{  my\_left\_type lhsExpr;\(\backslash\)}
00154 \textcolor{preprocessor}{  my\_right\_type rhsExpr;\(\backslash\)}
00155 \textcolor{preprocessor}{  Type expr;\(\backslash\)}
00156 \textcolor{preprocessor}{  template <typename FuncDetector>\(\backslash\)}
00157 \textcolor{preprocessor}{  ExprConstructor(FuncDetector &funcD, const utility::tuple::Tuple<Params...> &t)\(\backslash\)}
00158 \textcolor{preprocessor}{  : lhsExpr(funcD.lhsExpr, t), rhsExpr(funcD.rhsExpr, t), expr(lhsExpr.expr, rhsExpr.expr) \{\}\(\backslash\)}
00159 \textcolor{preprocessor}{ \};}
00160 
00161  ASSIGN(\textcolor{keyword}{const})
00162  ASSIGN()
00163  \textcolor{preprocessor}{#undef ASSIGN}
00164 \textcolor{preprocessor}{#define EVALTO(CVQual)\(\backslash\)}
00167 \textcolor{preprocessor}{template <typename OrigExpr, typename Expr, typename... Params>\(\backslash\)}
00168 \textcolor{preprocessor}{struct ExprConstructor<CVQual TensorEvalToOp<OrigExpr, MakeGlobalPointer>, CVQual TensorEvalToOp<Expr>,
       Params...> \{\(\backslash\)}
00169 \textcolor{preprocessor}{  typedef ExprConstructor<OrigExpr, Expr, Params...> my\_expr\_type;\(\backslash\)}
00170 \textcolor{preprocessor}{  typedef typename TensorEvalToOp<OrigExpr, MakeGlobalPointer>::PointerType my\_buffer\_type;\(\backslash\)}
00171 \textcolor{preprocessor}{  typedef CVQual TensorEvalToOp<typename my\_expr\_type::Type, MakeGlobalPointer> Type;\(\backslash\)}
00172 \textcolor{preprocessor}{  my\_expr\_type nestedExpression;\(\backslash\)}
00173 \textcolor{preprocessor}{  EvalToLHSConstructor<my\_buffer\_type, 0, Params...> buffer;\(\backslash\)}
00174 \textcolor{preprocessor}{  Type expr;\(\backslash\)}
00175 \textcolor{preprocessor}{  template <typename FuncDetector>\(\backslash\)}
00176 \textcolor{preprocessor}{  ExprConstructor(FuncDetector &funcD, const utility::tuple::Tuple<Params...> &t)\(\backslash\)}
00177 \textcolor{preprocessor}{  : nestedExpression(funcD.rhsExpr, t), buffer(t), expr(buffer.expr, nestedExpression.expr) \{\}\(\backslash\)}
00178 \textcolor{preprocessor}{\};}
00179 
00180 EVALTO(\textcolor{keyword}{const})
00181 EVALTO()
00182 \textcolor{preprocessor}{#undef EVALTO}
00183 
00186 \textcolor{preprocessor}{#define FORCEDEVAL(CVQual)\(\backslash\)}
00187 \textcolor{preprocessor}{template <typename OrigExpr, typename DevExpr, size\_t N, typename... Params>\(\backslash\)}
00188 \textcolor{preprocessor}{struct ExprConstructor<CVQual TensorForcedEvalOp<OrigExpr, MakeGlobalPointer>,\(\backslash\)}
00189 \textcolor{preprocessor}{CVQual PlaceHolder<CVQual TensorForcedEvalOp<DevExpr>, N>, Params...> \{\(\backslash\)}
00190 \textcolor{preprocessor}{  typedef CVQual TensorMap<Tensor<typename TensorForcedEvalOp<DevExpr, MakeGlobalPointer>::Scalar,\(\backslash\)}
00191 \textcolor{preprocessor}{  TensorForcedEvalOp<DevExpr, MakeGlobalPointer>::NumDimensions, 0, typename
       TensorForcedEvalOp<DevExpr>::Index>, 0, MakeGlobalPointer> Type;\(\backslash\)}
00192 \textcolor{preprocessor}{  Type expr;\(\backslash\)}
00193 \textcolor{preprocessor}{  template <typename FuncDetector>\(\backslash\)}
00194 \textcolor{preprocessor}{  ExprConstructor(FuncDetector &fd, const utility::tuple::Tuple<Params...> &t)\(\backslash\)}
00195 \textcolor{preprocessor}{  : expr(Type((&(*(utility::tuple::get<N>(t).get\_pointer()))), fd.dimensions())) \{\}\(\backslash\)}
00196 \textcolor{preprocessor}{\};}
00197 
00198 FORCEDEVAL(\textcolor{keyword}{const})
00199 FORCEDEVAL()
00200 \textcolor{preprocessor}{#undef FORCEDEVAL}
00201 
00202 \textcolor{keyword}{template} <\textcolor{keywordtype}{bool} Conds,  \textcolor{keywordtype}{size\_t} X , \textcolor{keywordtype}{size\_t} Y > \textcolor{keyword}{struct }ValueCondition \{
00203   \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} Res =X;
00204 \};
00205 \textcolor{keyword}{template}<\textcolor{keywordtype}{size\_t} X, \textcolor{keywordtype}{size\_t} Y> \textcolor{keyword}{struct }ValueCondition<false, X , Y> \{
00206   \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} Res =Y;
00207 \};
00208 
00210 \textcolor{preprocessor}{#define SYCLREDUCTIONEXPR(CVQual)\(\backslash\)}
00211 \textcolor{preprocessor}{template <typename OP, typename Dim, typename OrigExpr, typename DevExpr, size\_t N, typename... Params>\(\backslash\)}
00212 \textcolor{preprocessor}{struct ExprConstructor<CVQual TensorReductionOp<OP, Dim, OrigExpr, MakeGlobalPointer>,\(\backslash\)}
00213 \textcolor{preprocessor}{CVQual PlaceHolder<CVQual TensorReductionOp<OP, Dim, DevExpr>, N>, Params...> \{\(\backslash\)}
00214 \textcolor{preprocessor}{  static const size\_t NumIndices= ValueCondition< TensorReductionOp<OP, Dim, DevExpr,
       MakeGlobalPointer>::NumDimensions==0,  1, TensorReductionOp<OP, Dim, DevExpr, MakeGlobalPointer>::NumDimensions >::Res;\(\backslash\)}
00215 \textcolor{preprocessor}{  typedef CVQual TensorMap<Tensor<typename TensorReductionOp<OP, Dim, DevExpr, MakeGlobalPointer>::Scalar,\(\backslash\)}
00216 \textcolor{preprocessor}{  NumIndices, 0, typename TensorReductionOp<OP, Dim, DevExpr>::Index>, 0, MakeGlobalPointer> Type;\(\backslash\)}
00217 \textcolor{preprocessor}{  Type expr;\(\backslash\)}
00218 \textcolor{preprocessor}{  template <typename FuncDetector>\(\backslash\)}
00219 \textcolor{preprocessor}{  ExprConstructor(FuncDetector &fd, const utility::tuple::Tuple<Params...> &t)\(\backslash\)}
00220 \textcolor{preprocessor}{  : expr(Type((&(*(utility::tuple::get<N>(t).get\_pointer()))), fd.dimensions())) \{\}\(\backslash\)}
00221 \textcolor{preprocessor}{\};}
00222 
00223 SYCLREDUCTIONEXPR(\textcolor{keyword}{const})
00224 SYCLREDUCTIONEXPR()
00225 \textcolor{preprocessor}{#undef SYCLREDUCTIONEXPR}
00226 
00228 \textcolor{keyword}{template} <\textcolor{keyword}{typename} OrigExpr, \textcolor{keyword}{typename} IndexExpr, \textcolor{keyword}{typename} FuncD, \textcolor{keyword}{typename}... Params>
00229 \textcolor{keyword}{auto} createDeviceExpression(FuncD &funcD, \textcolor{keyword}{const} \hyperlink{structutility_1_1tuple_1_1_tuple}{utility::tuple::Tuple<Params...>}
       &t)
00230     -> decltype(ExprConstructor<OrigExpr, IndexExpr, Params...>(funcD, t)) \{
00231   \textcolor{keywordflow}{return} ExprConstructor<OrigExpr, IndexExpr, Params...>(funcD, t);
00232 \}
00233 
00234 \} 
00235 \} 
00236 \} 
00237 
00238 
00239 \textcolor{preprocessor}{#endif  // UNSUPPORTED\_EIGEN\_CXX11\_SRC\_TENSOR\_TENSORSYCL\_EXPR\_CONSTRUCTOR\_HPP}
\end{DoxyCode}
