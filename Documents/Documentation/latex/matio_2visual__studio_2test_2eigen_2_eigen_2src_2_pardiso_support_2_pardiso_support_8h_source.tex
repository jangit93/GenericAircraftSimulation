\hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_pardiso_support_2_pardiso_support_8h_source}{}\section{matio/visual\+\_\+studio/test/eigen/\+Eigen/src/\+Pardiso\+Support/\+Pardiso\+Support.h}
\label{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_pardiso_support_2_pardiso_support_8h_source}\index{Pardiso\+Support.\+h@{Pardiso\+Support.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{/*}
00002 \textcolor{comment}{ Copyright (c) 2011, Intel Corporation. All rights reserved.}
00003 \textcolor{comment}{}
00004 \textcolor{comment}{ Redistribution and use in source and binary forms, with or without modification,}
00005 \textcolor{comment}{ are permitted provided that the following conditions are met:}
00006 \textcolor{comment}{}
00007 \textcolor{comment}{ * Redistributions of source code must retain the above copyright notice, this}
00008 \textcolor{comment}{   list of conditions and the following disclaimer.}
00009 \textcolor{comment}{ * Redistributions in binary form must reproduce the above copyright notice,}
00010 \textcolor{comment}{   this list of conditions and the following disclaimer in the documentation}
00011 \textcolor{comment}{   and/or other materials provided with the distribution.}
00012 \textcolor{comment}{ * Neither the name of Intel Corporation nor the names of its contributors may}
00013 \textcolor{comment}{   be used to endorse or promote products derived from this software without}
00014 \textcolor{comment}{   specific prior written permission.}
00015 \textcolor{comment}{}
00016 \textcolor{comment}{ THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND}
00017 \textcolor{comment}{ ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED}
00018 \textcolor{comment}{ WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE}
00019 \textcolor{comment}{ DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR}
00020 \textcolor{comment}{ ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES}
00021 \textcolor{comment}{ (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;}
00022 \textcolor{comment}{ LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON}
00023 \textcolor{comment}{ ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT}
00024 \textcolor{comment}{ (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS}
00025 \textcolor{comment}{ SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.}
00026 \textcolor{comment}{}
00027 \textcolor{comment}{ ********************************************************************************}
00028 \textcolor{comment}{ *   Content : Eigen bindings to Intel(R) MKL PARDISO}
00029 \textcolor{comment}{ ********************************************************************************}
00030 \textcolor{comment}{*/}
00031 
00032 \textcolor{preprocessor}{#ifndef EIGEN\_PARDISOSUPPORT\_H}
00033 \textcolor{preprocessor}{#define EIGEN\_PARDISOSUPPORT\_H}
00034 
00035 \textcolor{keyword}{namespace }\hyperlink{namespace_eigen}{Eigen} \{ 
00036 
00037 \textcolor{keyword}{template}<\textcolor{keyword}{typename} \_MatrixType> \textcolor{keyword}{class }PardisoLU;
00038 \textcolor{keyword}{template}<\textcolor{keyword}{typename} \_MatrixType, \textcolor{keywordtype}{int} Options=Upper> \textcolor{keyword}{class }PardisoLLT;
00039 \textcolor{keyword}{template}<\textcolor{keyword}{typename} \_MatrixType, \textcolor{keywordtype}{int} Options=Upper> \textcolor{keyword}{class }PardisoLDLT;
00040 
00041 \textcolor{keyword}{namespace }\hyperlink{namespaceinternal}{internal}
00042 \{
00043   \textcolor{keyword}{template}<\textcolor{keyword}{typename} IndexType>
00044   \textcolor{keyword}{struct }pardiso\_run\_selector
00045   \{
00046     \textcolor{keyword}{static} IndexType run( \_MKL\_DSS\_HANDLE\_t pt, IndexType maxfct, IndexType mnum, IndexType type, IndexType
       phase, IndexType n, \textcolor{keywordtype}{void} *a,
00047                       IndexType *ia, IndexType *ja, IndexType *perm, IndexType nrhs, IndexType *iparm, 
      IndexType msglvl, \textcolor{keywordtype}{void} *b, \textcolor{keywordtype}{void} *x)
00048     \{
00049       IndexType error = 0;
00050       ::pardiso(pt, &maxfct, &mnum, &type, &phase, &n, a, ia, ja, perm, &nrhs, iparm, &msglvl, b, x, &error
      );
00051       \textcolor{keywordflow}{return} error;
00052     \}
00053   \};
00054   \textcolor{keyword}{template}<>
00055   \textcolor{keyword}{struct }pardiso\_run\_selector<long long int>
00056   \{
00057     \textcolor{keyword}{typedef} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} IndexType;
00058     \textcolor{keyword}{static} IndexType run( \_MKL\_DSS\_HANDLE\_t pt, IndexType maxfct, IndexType mnum, IndexType type, IndexType
       phase, IndexType n, \textcolor{keywordtype}{void} *a,
00059                       IndexType *ia, IndexType *ja, IndexType *perm, IndexType nrhs, IndexType *iparm, 
      IndexType msglvl, \textcolor{keywordtype}{void} *b, \textcolor{keywordtype}{void} *x)
00060     \{
00061       IndexType error = 0;
00062       ::pardiso\_64(pt, &maxfct, &mnum, &type, &phase, &n, a, ia, ja, perm, &nrhs, iparm, &msglvl, b, x, &
      error);
00063       \textcolor{keywordflow}{return} error;
00064     \}
00065   \};
00066 
00067   \textcolor{keyword}{template}<\textcolor{keyword}{class} Pardiso> \textcolor{keyword}{struct }pardiso\_traits;
00068 
00069   \textcolor{keyword}{template}<\textcolor{keyword}{typename} \_MatrixType>
00070   \textcolor{keyword}{struct }pardiso\_traits< PardisoLU<\_MatrixType> >
00071   \{
00072     \textcolor{keyword}{typedef} \_MatrixType MatrixType;
00073     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \_MatrixType::Scalar Scalar;
00074     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \_MatrixType::RealScalar RealScalar;
00075     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \_MatrixType::StorageIndex StorageIndex;
00076   \};
00077 
00078   \textcolor{keyword}{template}<\textcolor{keyword}{typename} \_MatrixType, \textcolor{keywordtype}{int} Options>
00079   \textcolor{keyword}{struct }pardiso\_traits< PardisoLLT<\_MatrixType, Options> >
00080   \{
00081     \textcolor{keyword}{typedef} \_MatrixType MatrixType;
00082     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \_MatrixType::Scalar Scalar;
00083     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \_MatrixType::RealScalar RealScalar;
00084     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \_MatrixType::StorageIndex StorageIndex;
00085   \};
00086 
00087   \textcolor{keyword}{template}<\textcolor{keyword}{typename} \_MatrixType, \textcolor{keywordtype}{int} Options>
00088   \textcolor{keyword}{struct }pardiso\_traits< PardisoLDLT<\_MatrixType, Options> >
00089   \{
00090     \textcolor{keyword}{typedef} \_MatrixType MatrixType;
00091     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \_MatrixType::Scalar Scalar;
00092     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \_MatrixType::RealScalar RealScalar;
00093     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \_MatrixType::StorageIndex StorageIndex;    
00094   \};
00095 
00096 \} \textcolor{comment}{// end namespace internal}
00097 
00098 \textcolor{keyword}{template}<\textcolor{keyword}{class} Derived>
00099 \textcolor{keyword}{class }PardisoImpl : \textcolor{keyword}{public} SparseSolverBase<Derived>
00100 \{
00101   \textcolor{keyword}{protected}:
00102     \textcolor{keyword}{typedef} SparseSolverBase<Derived> Base;
00103     \textcolor{keyword}{using} Base::derived;
00104     \textcolor{keyword}{using} Base::m\_isInitialized;
00105     
00106     \textcolor{keyword}{typedef} internal::pardiso\_traits<Derived> Traits;
00107   \textcolor{keyword}{public}:
00108     \textcolor{keyword}{using} Base::\_solve\_impl;
00109     
00110     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Traits::MatrixType MatrixType;
00111     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Traits::Scalar Scalar;
00112     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Traits::RealScalar RealScalar;
00113     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Traits::StorageIndex StorageIndex;
00114     \textcolor{keyword}{typedef} SparseMatrix<Scalar,RowMajor,StorageIndex> SparseMatrixType;
00115     \textcolor{keyword}{typedef} Matrix<Scalar,Dynamic,1> \hyperlink{struct_vector_type}{VectorType};
00116     \textcolor{keyword}{typedef} Matrix<StorageIndex, 1, MatrixType::ColsAtCompileTime> IntRowVectorType;
00117     \textcolor{keyword}{typedef} Matrix<StorageIndex, MatrixType::RowsAtCompileTime, 1> IntColVectorType;
00118     \textcolor{keyword}{typedef} Array<StorageIndex,64,1,DontAlign> ParameterType;
00119     \textcolor{keyword}{enum} \{
00120       ScalarIsComplex = NumTraits<Scalar>::IsComplex,
00121       ColsAtCompileTime = \hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Dynamic},
00122       MaxColsAtCompileTime = \hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Dynamic}
00123     \};
00124 
00125     PardisoImpl()
00126     \{
00127       eigen\_assert((\textcolor{keyword}{sizeof}(StorageIndex) >= \textcolor{keyword}{sizeof}(\_INTEGER\_t) && \textcolor{keyword}{sizeof}(StorageIndex) <= 8) && \textcolor{stringliteral}{"
      Non-supported index type"});
00128       m\_iparm.setZero();
00129       m\_msglvl = 0; \textcolor{comment}{// No output}
00130       m\_isInitialized = \textcolor{keyword}{false};
00131     \}
00132 
00133     ~PardisoImpl()
00134     \{
00135       pardisoRelease();
00136     \}
00137 
00138     \textcolor{keyword}{inline} \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} cols()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_size; \}
00139     \textcolor{keyword}{inline} \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} rows()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_size; \}
00140   
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_pardiso_support_2_pardiso_support_8h_source_l00146}\hyperlink{class_eigen_1_1_pardiso_impl_a7dce1175518593e33d32e30ab0ffee3b}{00146}     \hyperlink{group__enums_ga85fad7b87587764e5cf6b513a9e0ee5e}{ComputationInfo} \hyperlink{class_eigen_1_1_pardiso_impl_a7dce1175518593e33d32e30ab0ffee3b}{info}()\textcolor{keyword}{ const}
00147 \textcolor{keyword}{    }\{
00148       eigen\_assert(m\_isInitialized && \textcolor{stringliteral}{"Decomposition is not initialized."});
00149       \textcolor{keywordflow}{return} m\_info;
00150     \}
00151 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_pardiso_support_2_pardiso_support_8h_source_l00155}\hyperlink{class_eigen_1_1_pardiso_impl_a42a7983796076edc52e0e8d2869610ec}{00155}     ParameterType& \hyperlink{class_eigen_1_1_pardiso_impl_a42a7983796076edc52e0e8d2869610ec}{pardisoParameterArray}()
00156     \{
00157       \textcolor{keywordflow}{return} m\_iparm;
00158     \}
00159     
00166     Derived& analyzePattern(\textcolor{keyword}{const} MatrixType& matrix);
00167     
00174     Derived& factorize(\textcolor{keyword}{const} MatrixType& matrix);
00175 
00176     Derived& compute(\textcolor{keyword}{const} MatrixType& matrix);
00177 
00178     \textcolor{keyword}{template}<\textcolor{keyword}{typename} Rhs,\textcolor{keyword}{typename} Dest>
00179     \textcolor{keywordtype}{void} \_solve\_impl(\textcolor{keyword}{const} \hyperlink{group___core___module_class_eigen_1_1_matrix_base}{MatrixBase<Rhs>} &b, \hyperlink{group___core___module_class_eigen_1_1_matrix_base}{MatrixBase<Dest>} &dest) \textcolor{keyword}{const}
      ;
00180 
00181   \textcolor{keyword}{protected}:
00182     \textcolor{keywordtype}{void} pardisoRelease()
00183     \{
00184       \textcolor{keywordflow}{if}(m\_isInitialized) \textcolor{comment}{// Factorization ran at least once}
00185       \{
00186         \hyperlink{struct_eigen_1_1internal_1_1pardiso__run__selector}{internal::pardiso\_run\_selector<StorageIndex>::run}(
      m\_pt, 1, 1, m\_type, -1, internal::convert\_index<StorageIndex>(m\_size),0, 0, 0, m\_perm.data(), 0,
00187                                                           m\_iparm.data(), m\_msglvl, NULL, NULL);
00188         m\_isInitialized = \textcolor{keyword}{false};
00189       \}
00190     \}
00191 
00192     \textcolor{keywordtype}{void} pardisoInit(\textcolor{keywordtype}{int} type)
00193     \{
00194       m\_type = type;
00195       \textcolor{keywordtype}{bool} symmetric = std::abs(m\_type) < 10;
00196       m\_iparm[0] = 1;   \textcolor{comment}{// No solver default}
00197       m\_iparm[1] = 2;   \textcolor{comment}{// use Metis for the ordering}
00198       m\_iparm[2] = 0;   \textcolor{comment}{// Reserved. Set to zero. (??Numbers of processors, value of OMP\_NUM\_THREADS??)}
00199       m\_iparm[3] = 0;   \textcolor{comment}{// No iterative-direct algorithm}
00200       m\_iparm[4] = 0;   \textcolor{comment}{// No user fill-in reducing permutation}
00201       m\_iparm[5] = 0;   \textcolor{comment}{// Write solution into x, b is left unchanged}
00202       m\_iparm[6] = 0;   \textcolor{comment}{// Not in use}
00203       m\_iparm[7] = 2;   \textcolor{comment}{// Max numbers of iterative refinement steps}
00204       m\_iparm[8] = 0;   \textcolor{comment}{// Not in use}
00205       m\_iparm[9] = 13;  \textcolor{comment}{// Perturb the pivot elements with 1E-13}
00206       m\_iparm[10] = symmetric ? 0 : 1; \textcolor{comment}{// Use nonsymmetric permutation and scaling MPS}
00207       m\_iparm[11] = 0;  \textcolor{comment}{// Not in use}
00208       m\_iparm[12] = symmetric ? 0 : 1;  \textcolor{comment}{// Maximum weighted matching algorithm is switched-off (default for
       symmetric).}
00209                                         \textcolor{comment}{// Try m\_iparm[12] = 1 in case of inappropriate accuracy}
00210       m\_iparm[13] = 0;  \textcolor{comment}{// Output: Number of perturbed pivots}
00211       m\_iparm[14] = 0;  \textcolor{comment}{// Not in use}
00212       m\_iparm[15] = 0;  \textcolor{comment}{// Not in use}
00213       m\_iparm[16] = 0;  \textcolor{comment}{// Not in use}
00214       m\_iparm[17] = -1; \textcolor{comment}{// Output: Number of nonzeros in the factor LU}
00215       m\_iparm[18] = -1; \textcolor{comment}{// Output: Mflops for LU factorization}
00216       m\_iparm[19] = 0;  \textcolor{comment}{// Output: Numbers of CG Iterations}
00217       
00218       m\_iparm[20] = 0;  \textcolor{comment}{// 1x1 pivoting}
00219       m\_iparm[26] = 0;  \textcolor{comment}{// No matrix checker}
00220       m\_iparm[27] = (\textcolor{keyword}{sizeof}(RealScalar) == 4) ? 1 : 0;
00221       m\_iparm[34] = 1;  \textcolor{comment}{// C indexing}
00222       m\_iparm[36] = 0;  \textcolor{comment}{// CSR}
00223       m\_iparm[59] = 0;  \textcolor{comment}{// 0 - In-Core ; 1 - Automatic switch between In-Core and Out-of-Core modes ; 2 -
       Out-of-Core}
00224       
00225       memset(m\_pt, 0, \textcolor{keyword}{sizeof}(m\_pt));
00226     \}
00227 
00228   \textcolor{keyword}{protected}:
00229     \textcolor{comment}{// cached data to reduce reallocation, etc.}
00230     
00231     \textcolor{keywordtype}{void} manageErrorCode(\hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} error)\textcolor{keyword}{ const}
00232 \textcolor{keyword}{    }\{
00233       \textcolor{keywordflow}{switch}(error)
00234       \{
00235         \textcolor{keywordflow}{case} 0:
00236           m\_info = \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea52581b035f4b59c203b8ff999ef5fcea}{Success};
00237           \textcolor{keywordflow}{break};
00238         \textcolor{keywordflow}{case} -4:
00239         \textcolor{keywordflow}{case} -7:
00240           m\_info = \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5eaaf9b736d310a664e7729d163a035cc5f}{NumericalIssue};
00241           \textcolor{keywordflow}{break};
00242         \textcolor{keywordflow}{default}:
00243           m\_info = \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea945604f62795ffc70aedf2bd12ea0434}{InvalidInput};
00244       \}
00245     \}
00246 
00247     \textcolor{keyword}{mutable} SparseMatrixType m\_matrix;
00248     \textcolor{keyword}{mutable} \hyperlink{group__enums_ga85fad7b87587764e5cf6b513a9e0ee5e}{ComputationInfo} m\_info;
00249     \textcolor{keywordtype}{bool} m\_analysisIsOk, m\_factorizationIsOk;
00250     StorageIndex m\_type, m\_msglvl;
00251     \textcolor{keyword}{mutable} \textcolor{keywordtype}{void} *m\_pt[64];
00252     \textcolor{keyword}{mutable} ParameterType m\_iparm;
00253     \textcolor{keyword}{mutable} IntColVectorType m\_perm;
00254     \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} m\_size;
00255     
00256 \};
00257 
00258 \textcolor{keyword}{template}<\textcolor{keyword}{class} Derived>
00259 Derived& \hyperlink{class_eigen_1_1_pardiso_impl}{PardisoImpl<Derived>::compute}(\textcolor{keyword}{const} MatrixType& a)
00260 \{
00261   m\_size = a.rows();
00262   eigen\_assert(a.rows() == a.cols());
00263 
00264   pardisoRelease();
00265   m\_perm.setZero(m\_size);
00266   derived().getMatrix(a);
00267   
00268   \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} error;
00269   error = \hyperlink{struct_eigen_1_1internal_1_1pardiso__run__selector}{internal::pardiso\_run\_selector<StorageIndex>::run}
      (m\_pt, 1, 1, m\_type, 12, internal::convert\_index<StorageIndex>(m\_size),
00270                                                             m\_matrix.valuePtr(), m\_matrix.outerIndexPtr(), 
      m\_matrix.innerIndexPtr(),
00271                                                             m\_perm.data(), 0, m\_iparm.data(), m\_msglvl, 
      NULL, NULL);
00272   manageErrorCode(error);
00273   m\_analysisIsOk = \textcolor{keyword}{true};
00274   m\_factorizationIsOk = \textcolor{keyword}{true};
00275   m\_isInitialized = \textcolor{keyword}{true};
00276   \textcolor{keywordflow}{return} derived();
00277 \}
00278 
00279 \textcolor{keyword}{template}<\textcolor{keyword}{class} Derived>
00280 Derived& \hyperlink{class_eigen_1_1_pardiso_impl_af1773ce06014b55a69cd42daf34eeec4}{PardisoImpl<Derived>::analyzePattern}(\textcolor{keyword}{const} MatrixType& a)
00281 \{
00282   m\_size = a.rows();
00283   eigen\_assert(m\_size == a.cols());
00284 
00285   pardisoRelease();
00286   m\_perm.setZero(m\_size);
00287   derived().getMatrix(a);
00288   
00289   \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} error;
00290   error = \hyperlink{struct_eigen_1_1internal_1_1pardiso__run__selector}{internal::pardiso\_run\_selector<StorageIndex>::run}
      (m\_pt, 1, 1, m\_type, 11, internal::convert\_index<StorageIndex>(m\_size),
00291                                                             m\_matrix.valuePtr(), m\_matrix.outerIndexPtr(), 
      m\_matrix.innerIndexPtr(),
00292                                                             m\_perm.data(), 0, m\_iparm.data(), m\_msglvl, 
      NULL, NULL);
00293   
00294   manageErrorCode(error);
00295   m\_analysisIsOk = \textcolor{keyword}{true};
00296   m\_factorizationIsOk = \textcolor{keyword}{false};
00297   m\_isInitialized = \textcolor{keyword}{true};
00298   \textcolor{keywordflow}{return} derived();
00299 \}
00300 
00301 \textcolor{keyword}{template}<\textcolor{keyword}{class} Derived>
00302 Derived& \hyperlink{class_eigen_1_1_pardiso_impl_a6a4c092c5fb581a946d3c4e5ec347dfb}{PardisoImpl<Derived>::factorize}(\textcolor{keyword}{const} MatrixType& a)
00303 \{
00304   eigen\_assert(m\_analysisIsOk && \textcolor{stringliteral}{"You must first call analyzePattern()"});
00305   eigen\_assert(m\_size == a.rows() && m\_size == a.cols());
00306   
00307   derived().getMatrix(a);
00308 
00309   \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} error;
00310   error = \hyperlink{struct_eigen_1_1internal_1_1pardiso__run__selector}{internal::pardiso\_run\_selector<StorageIndex>::run}
      (m\_pt, 1, 1, m\_type, 22, internal::convert\_index<StorageIndex>(m\_size),
00311                                                             m\_matrix.valuePtr(), m\_matrix.outerIndexPtr(), 
      m\_matrix.innerIndexPtr(),
00312                                                             m\_perm.data(), 0, m\_iparm.data(), m\_msglvl, 
      NULL, NULL);
00313   
00314   manageErrorCode(error);
00315   m\_factorizationIsOk = \textcolor{keyword}{true};
00316   \textcolor{keywordflow}{return} derived();
00317 \}
00318 
00319 \textcolor{keyword}{template}<\textcolor{keyword}{class} Derived>
00320 \textcolor{keyword}{template}<\textcolor{keyword}{typename} BDerived,\textcolor{keyword}{typename} XDerived>
00321 \textcolor{keywordtype}{void} \hyperlink{class_eigen_1_1_pardiso_impl}{PardisoImpl<Derived>::\_solve\_impl}(\textcolor{keyword}{const} 
      \hyperlink{group___core___module_class_eigen_1_1_matrix_base}{MatrixBase<BDerived>} &b, \hyperlink{group___core___module_class_eigen_1_1_matrix_base}{MatrixBase<XDerived>}& x)\textcolor{keyword}{ const}
00322 \textcolor{keyword}{}\{
00323   \textcolor{keywordflow}{if}(m\_iparm[0] == 0) \textcolor{comment}{// Factorization was not computed}
00324   \{
00325     m\_info = \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea945604f62795ffc70aedf2bd12ea0434}{InvalidInput};
00326     \textcolor{keywordflow}{return};
00327   \}
00328 
00329   \textcolor{comment}{//Index n = m\_matrix.rows();}
00330   \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} nrhs = \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}(b.cols());
00331   eigen\_assert(m\_size==b.rows());
00332   eigen\_assert(((\hyperlink{group___core___module_class_eigen_1_1_matrix_base}{MatrixBase<BDerived>::Flags} & 
      \hyperlink{group__flags_gae4f56c2a60bbe4bd2e44c5b19cbe8762}{RowMajorBit}) == 0 || nrhs == 1) && \textcolor{stringliteral}{"Row-major right hand sides are not supported"});
00333   eigen\_assert(((\hyperlink{group___core___module_class_eigen_1_1_matrix_base}{MatrixBase<XDerived>::Flags} & RowMajorBit) == 0 || nrhs == 1) 
      && \textcolor{stringliteral}{"Row-major matrices of unknowns are not supported"});
00334   eigen\_assert(((nrhs == 1) || b.outerStride() == b.rows()));
00335 
00336 
00337 \textcolor{comment}{//  switch (transposed) \{}
00338 \textcolor{comment}{//    case SvNoTrans    : m\_iparm[11] = 0 ; break;}
00339 \textcolor{comment}{//    case SvTranspose  : m\_iparm[11] = 2 ; break;}
00340 \textcolor{comment}{//    case SvAdjoint    : m\_iparm[11] = 1 ; break;}
00341 \textcolor{comment}{//    default:}
00342 \textcolor{comment}{//      //std::cerr << "Eigen: transposition  option \(\backslash\)"" << transposed << "\(\backslash\)" not supported by the PARDISO
       backend\(\backslash\)n";}
00343 \textcolor{comment}{//      m\_iparm[11] = 0;}
00344 \textcolor{comment}{//  \}}
00345 
00346   Scalar* rhs\_ptr = \textcolor{keyword}{const\_cast<}Scalar*\textcolor{keyword}{>}(b.derived().data());
00347   \hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<Scalar,Dynamic,Dynamic,ColMajor>} tmp;
00348   
00349   \textcolor{comment}{// Pardiso cannot solve in-place}
00350   \textcolor{keywordflow}{if}(rhs\_ptr == x.derived().data())
00351   \{
00352     tmp = b;
00353     rhs\_ptr = tmp.\hyperlink{class_eigen_1_1_plain_object_base_ac25699535374b1854cf8494e44ad31b2}{data}();
00354   \}
00355   
00356   \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} error;
00357   error = \hyperlink{struct_eigen_1_1internal_1_1pardiso__run__selector}{internal::pardiso\_run\_selector<StorageIndex>::run}
      (m\_pt, 1, 1, m\_type, 33, internal::convert\_index<StorageIndex>(m\_size),
00358                                                             m\_matrix.valuePtr(), m\_matrix.outerIndexPtr(), 
      m\_matrix.innerIndexPtr(),
00359                                                             m\_perm.data(), 
      internal::convert\_index<StorageIndex>(nrhs), m\_iparm.data(), m\_msglvl,
00360                                                             rhs\_ptr, x.derived().data());
00361 
00362   manageErrorCode(error);
00363 \}
00364 
00365 
00383 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>
00384 \textcolor{keyword}{class }\hyperlink{class_eigen_1_1_pardiso_l_u}{PardisoLU} : \textcolor{keyword}{public} \hyperlink{class_eigen_1_1_pardiso_impl}{PardisoImpl}< PardisoLU<MatrixType> >
00385 \{
00386   \textcolor{keyword}{protected}:
00387     \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1_pardiso_impl}{PardisoImpl<PardisoLU>} Base;
00388     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Base::Scalar Scalar;
00389     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Base::RealScalar RealScalar;
00390     \textcolor{keyword}{using} Base::pardisoInit;
00391     \textcolor{keyword}{using} Base::m\_matrix;
00392     \textcolor{keyword}{friend} \textcolor{keyword}{class }\hyperlink{class_eigen_1_1_pardiso_impl}{PardisoImpl}< PardisoLU<MatrixType> >;
00393 
00394   \textcolor{keyword}{public}:
00395 
00396     \textcolor{keyword}{using} Base::compute;
00397     \textcolor{keyword}{using} Base::solve;
00398 
00399     PardisoLU()
00400       : Base()
00401     \{
00402       pardisoInit(Base::ScalarIsComplex ? 13 : 11);
00403     \}
00404 
00405     \textcolor{keyword}{explicit} PardisoLU(\textcolor{keyword}{const} MatrixType& matrix)
00406       : Base()
00407     \{
00408       pardisoInit(Base::ScalarIsComplex ? 13 : 11);
00409       compute(matrix);
00410     \}
00411   \textcolor{keyword}{protected}:
00412     \textcolor{keywordtype}{void} getMatrix(\textcolor{keyword}{const} MatrixType& matrix)
00413     \{
00414       m\_matrix = matrix;
00415       m\_matrix.makeCompressed();
00416     \}
00417 \};
00418 
00438 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType, \textcolor{keywordtype}{int} \_UpLo>
00439 \textcolor{keyword}{class }\hyperlink{class_eigen_1_1_pardiso_l_l_t}{PardisoLLT} : \textcolor{keyword}{public} \hyperlink{class_eigen_1_1_pardiso_impl}{PardisoImpl}< PardisoLLT<MatrixType,\_UpLo> >
00440 \{
00441   \textcolor{keyword}{protected}:
00442     \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1_pardiso_impl}{PardisoImpl< PardisoLLT<MatrixType,\_UpLo>} > Base;
00443     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Base::Scalar Scalar;
00444     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Base::RealScalar RealScalar;
00445     \textcolor{keyword}{using} Base::pardisoInit;
00446     \textcolor{keyword}{using} Base::m\_matrix;
00447     \textcolor{keyword}{friend} \textcolor{keyword}{class }\hyperlink{class_eigen_1_1_pardiso_impl}{PardisoImpl}< PardisoLLT<MatrixType,\_UpLo> >;
00448 
00449   \textcolor{keyword}{public}:
00450 
00451     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Base::StorageIndex StorageIndex;
00452     \textcolor{keyword}{enum} \{ UpLo = \_UpLo \};
00453     \textcolor{keyword}{using} Base::compute;
00454 
00455     PardisoLLT()
00456       : Base()
00457     \{
00458       pardisoInit(Base::ScalarIsComplex ? 4 : 2);
00459     \}
00460 
00461     \textcolor{keyword}{explicit} PardisoLLT(\textcolor{keyword}{const} MatrixType& matrix)
00462       : Base()
00463     \{
00464       pardisoInit(Base::ScalarIsComplex ? 4 : 2);
00465       compute(matrix);
00466     \}
00467     
00468   \textcolor{keyword}{protected}:
00469     
00470     \textcolor{keywordtype}{void} getMatrix(\textcolor{keyword}{const} MatrixType& matrix)
00471     \{
00472       \textcolor{comment}{// PARDISO supports only upper, row-major matrices}
00473       \hyperlink{group___core___module}{PermutationMatrix<Dynamic,Dynamic,StorageIndex>} p\_null
      ;
00474       m\_matrix.\hyperlink{group___core___module_a0e0fda6e84d69e02432e4770359bb532}{resize}(matrix.rows(), matrix.cols());
00475       m\_matrix.template selfadjointView<Upper>() = matrix.template selfadjointView<UpLo>().twistedBy(p\_null
      );
00476       m\_matrix.makeCompressed();
00477     \}
00478 \};
00479 
00501 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType, \textcolor{keywordtype}{int} Options>
00502 \textcolor{keyword}{class }\hyperlink{class_eigen_1_1_pardiso_l_d_l_t}{PardisoLDLT} : \textcolor{keyword}{public} \hyperlink{class_eigen_1_1_pardiso_impl}{PardisoImpl}< PardisoLDLT<MatrixType,Options> >
00503 \{
00504   \textcolor{keyword}{protected}:
00505     \textcolor{keyword}{typedef} \hyperlink{class_eigen_1_1_pardiso_impl}{PardisoImpl< PardisoLDLT<MatrixType,Options>} > Base
      ;
00506     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Base::Scalar Scalar;
00507     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Base::RealScalar RealScalar;
00508     \textcolor{keyword}{using} Base::pardisoInit;
00509     \textcolor{keyword}{using} Base::m\_matrix;
00510     \textcolor{keyword}{friend} \textcolor{keyword}{class }\hyperlink{class_eigen_1_1_pardiso_impl}{PardisoImpl}< PardisoLDLT<MatrixType,Options> >;
00511 
00512   \textcolor{keyword}{public}:
00513 
00514     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} Base::StorageIndex StorageIndex;
00515     \textcolor{keyword}{using} Base::compute;
00516     \textcolor{keyword}{enum} \{ UpLo = Options&(\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda6bcb58be3b8b8ec84859ce0c5ac0aaec}{Upper}|\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda891792b8ed394f7607ab16dd716f60e6}{Lower}) \};
00517 
00518     PardisoLDLT()
00519       : Base()
00520     \{
00521       pardisoInit(Base::ScalarIsComplex ? ( \textcolor{keywordtype}{bool}(Options&\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda7d30fb969ef6b763c098f0015108cef4}{Symmetric}) ? 6 : -4 ) : -2);
00522     \}
00523 
00524     \textcolor{keyword}{explicit} PardisoLDLT(\textcolor{keyword}{const} MatrixType& matrix)
00525       : Base()
00526     \{
00527       pardisoInit(Base::ScalarIsComplex ? ( \textcolor{keywordtype}{bool}(Options&\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda7d30fb969ef6b763c098f0015108cef4}{Symmetric}) ? 6 : -4 ) : -2);
00528       compute(matrix);
00529     \}
00530     
00531     \textcolor{keywordtype}{void} getMatrix(\textcolor{keyword}{const} MatrixType& matrix)
00532     \{
00533       \textcolor{comment}{// PARDISO supports only upper, row-major matrices}
00534       \hyperlink{group___core___module}{PermutationMatrix<Dynamic,Dynamic,StorageIndex>} p\_null
      ;
00535       m\_matrix.\hyperlink{group___core___module_a0e0fda6e84d69e02432e4770359bb532}{resize}(matrix.rows(), matrix.cols());
00536       m\_matrix.template selfadjointView<Upper>() = matrix.template selfadjointView<UpLo>().twistedBy(p\_null
      );
00537       m\_matrix.makeCompressed();
00538     \}
00539 \};
00540 
00541 \} \textcolor{comment}{// end namespace Eigen}
00542 
00543 \textcolor{preprocessor}{#endif // EIGEN\_PARDISOSUPPORT\_H}
\end{DoxyCode}
