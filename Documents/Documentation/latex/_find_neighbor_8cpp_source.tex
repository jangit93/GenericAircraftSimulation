\hypertarget{_find_neighbor_8cpp_source}{}\section{Find\+Neighbor.\+cpp}
\label{_find_neighbor_8cpp_source}\index{Find\+Neighbor.\+cpp@{Find\+Neighbor.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include "FindNeighbor.h"}
00002 
00003 FindNeighbor::FindNeighbor()
00004 \{
00005 \}
00006 
00007 FindNeighbor::~FindNeighbor()
00008 \{
00009     
00010 \}
00011 
00012 \textcolor{keywordtype}{void} FindNeighbor::initFindNeighbor()
00013 \{
00014     \hyperlink{class_mat_file_reader}{MatFileReader} readNeighborData(\textcolor{stringliteral}{"../Autopilot.mat"});
00015 
00016     MatFileData = readNeighborData.getMatFileInfo(\textcolor{stringliteral}{"AutopilotData"});
00017     Fields = MatFileData.\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0] * MatFileData.\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[1];
00018 
00019     neighbors = \textcolor{keyword}{new} AutopilotStruct[Fields];
00020 
00021     start, stride, edge, copy\_field = 0;
00022     edge = 9;
00023 
00024     \textcolor{keywordflow}{for} (start = 0; start < Fields; start++) \{
00025         neighbors[start].Alt = std::get<2>(readNeighborData.readMatFileStructure(\textcolor{stringliteral}{"Alt"}, start, stride, edge
      , copy\_field));
00026         neighbors[start].Vel = std::get<2>(readNeighborData.readMatFileStructure(\textcolor{stringliteral}{"Vel"}, start, stride, edge
      , copy\_field));
00027         neighbors[start].AltVec = std::get<3>(readNeighborData.readMatFileStructure(\textcolor{stringliteral}{"AltVec"}, start, stride
      , edge, copy\_field));
00028         neighbors[start].VelVec = std::get<3>(readNeighborData.readMatFileStructure(\textcolor{stringliteral}{"VelVec"}, start, stride
      , edge, copy\_field));
00029 
00030         \textcolor{comment}{/*}
00031 \textcolor{comment}{        std::cout << "Alt" << "\(\backslash\)t" << SchedulingPara[start].Alt << "\(\backslash\)n" << std::endl;}
00032 \textcolor{comment}{        std::cout << "Vel" << "\(\backslash\)t" << SchedulingPara[start].Vel << "\(\backslash\)n" << std::endl;}
00033 \textcolor{comment}{        std::cout << "x\_bar" << "\(\backslash\)t" << SchedulingPara[start].x\_bar << "\(\backslash\)n" << std::endl;}
00034 \textcolor{comment}{        std::cout << "u\_bar" << "\(\backslash\)t" << SchedulingPara[start].u\_bar << "\(\backslash\)n" << std::endl;}
00035 \textcolor{comment}{        std::cout << "Kx\_pitch" << "\(\backslash\)t" << SchedulingPara[start].Kx\_pitch << "\(\backslash\)n" << std::endl;}
00036 \textcolor{comment}{        std::cout << "Ke\_pitch" << "\(\backslash\)t" << SchedulingPara[start].Ke\_pitch << "\(\backslash\)n" << std::endl;}
00037 \textcolor{comment}{        std::cout << "Kv\_pitch" << "\(\backslash\)t" << SchedulingPara[start].Kv\_pitch << "\(\backslash\)n" << std::endl;}
00038 \textcolor{comment}{        std::cout << "Kx\_Vel" << "\(\backslash\)t" << SchedulingPara[start].Kx\_Vel << "\(\backslash\)n" << std::endl;}
00039 \textcolor{comment}{        std::cout << "Ke\_Vel" << "\(\backslash\)t" << SchedulingPara[start].Ke\_Vel << "\(\backslash\)n" << std::endl;}
00040 \textcolor{comment}{        std::cout << "Kx\_lat" << "\(\backslash\)t" << SchedulingPara[start].Kx\_lat << "\(\backslash\)n" << std::endl;}
00041 \textcolor{comment}{        */}
00042     \}
00043 \}
00044 
00045 
00046 
00047 Eigen::Vector4d FindNeighbor::BlendingParameters(AirframeStruct & AirframeData)
00048 \{
00049     
00050     \textcolor{comment}{// find neighbours altitude}
00051     std::cout << neighbors[0].AltVec.size() << std::endl;
00052     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < neighbors[0].AltVec.size() - 1; i++) \{
00053         std::cout << -AirframeData.posNED(2) << neighbors[0].AltVec(i + 1) << -AirframeData.posNED(2) << 
      neighbors[0].AltVec(i) - 10 <<  std::endl;
00054         \textcolor{keywordflow}{if} (-AirframeData.posNED(2) < neighbors[0].AltVec(i + 1) && -AirframeData.posNED(2) >= neighbors[0]
      .AltVec(i) - 10) \{
00055 
00056             tempAlt << i, i + 1;
00057 
00058             minAlt = neighbors[1].AltVec(i);
00059             maxAlt = neighbors[0].AltVec(i + 1);
00060             \textcolor{keywordflow}{break};
00061         \}
00062     \}
00063 
00064     \textcolor{comment}{// find neighbours velocity}
00065     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < neighbors[0].VelVec.size() - 1; i++) \{
00066         \textcolor{keywordflow}{if} (AirframeData.velNED.norm() < neighbors[0].VelVec(i + 1) && AirframeData.velNED.norm() >= 
      neighbors[0].VelVec(i) - 10) \{
00067             
00068             tempVel << i, i + 1;
00069 
00070             minVel = neighbors[0].VelVec(i);
00071             maxVel = neighbors[0].VelVec(i + 1);
00072             \textcolor{keywordflow}{break};
00073         \}
00074     \}
00075 
00076     \textcolor{comment}{//calculate blending parameters}
00077     Neighbor = combineVec(tempAlt, tempVel);
00078     std::cout << Neighbor << std::endl;
00079     
00080     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < Neighbor.rows(); i++) \{
00081 
00082         \textcolor{keywordtype}{int} m, n;
00083         m = Neighbor(i, 0);
00084         n = Neighbor(i, 1);
00085         xi(0) = (-AirframeData.posNED(2) - neighbors[n*MatFileData.\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0]+m].Alt) / (maxAlt - minAlt);
00086 
00087         phi\_j(0) = 1 - xi(0)*xi(0)*(3-2* abs(xi(0)));
00088 
00089         xi(1) = (AirframeData.velNED.norm() - neighbors[n*MatFileData.\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0] + m].Vel) / (maxVel - 
      minVel);
00090 
00091         phi\_j(1) = 1 - xi(1)*xi(1)*(3-2 * abs(xi(1)));
00092 
00093         phi(i) = phi\_j(0)*phi\_j(1);
00094     \}
00095 
00096     \textcolor{keywordflow}{return} phi;
00097     std::cout << phi << std::endl;
00098 \}
00099 
00100 Eigen::MatrixXd FindNeighbor::combineVec(Eigen::Vector2d & Alt, Eigen::Vector2d & Vel)
00101 \{
00102     comb.resize(Alt.size()*Vel.size(), 2);
00103     
00104     Vec1.resize(Alt.size()*Alt.size());
00105     Vec1 << Alt, Alt;
00106 
00107     Vec2.resize(Vel.size()*Vel.size());
00108 
00109     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} ii = 0; ii <Vel.size(); ii++) \{
00110         Vec2(ii) = Vel(0);
00111         Vec2(ii + 2) = Vel(1);
00112     \}
00113 
00114     comb << Vec1, Vec2;
00115     
00116     \textcolor{keywordflow}{return} comb;
00117 \}
\end{DoxyCode}
