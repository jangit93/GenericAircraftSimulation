\hypertarget{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_codec_base_8cs_source}{}\section{visual\+\_\+studio/zlib/contrib/dotzlib/\+Dot\+Z\+Lib/\+Codec\+Base.cs}
\label{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_codec_base_8cs_source}\index{Codec\+Base.\+cs@{Codec\+Base.\+cs}}

\begin{DoxyCode}
00001 \textcolor{comment}{//}
00002 \textcolor{comment}{// © Copyright Henrik Ravn 2004}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Use, modification and distribution are subject to the Boost Software License, Version 1.0.}
00005 \textcolor{comment}{// (See accompanying file LICENSE\_1\_0.txt or copy at http://www.boost.org/LICENSE\_1\_0.txt)}
00006 \textcolor{comment}{//}
00007 
00008 \textcolor{keyword}{using} \hyperlink{namespace_system}{System};
00009 \textcolor{keyword}{using} \hyperlink{namespace_system}{System}.Runtime.InteropServices;
00010 
00011 \textcolor{keyword}{namespace }\hyperlink{namespace_dot_z_lib}{DotZLib}
00012 \{
\Hypertarget{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_codec_base_8cs_source_l00016}\hyperlink{class_dot_z_lib_1_1_codec_base}{00016}     \textcolor{keyword}{public} \textcolor{keyword}{abstract} \textcolor{keyword}{class }\hyperlink{class_dot_z_lib_1_1_codec_base}{CodecBase} : \hyperlink{interface_dot_z_lib_1_1_codec}{Codec}, IDisposable
00017     \{
00018 
00019 \textcolor{preprocessor}{        #region Data members}
00020 
00025         \textcolor{keyword}{internal} ZStream \_ztream = \textcolor{keyword}{new} ZStream();
00026 
\Hypertarget{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_codec_base_8cs_source_l00030}\hyperlink{class_dot_z_lib_1_1_codec_base_a9dd3f18cc5e81e1a871279abeda2da84}{00030}         \textcolor{keyword}{protected} \textcolor{keywordtype}{bool} \hyperlink{class_dot_z_lib_1_1_codec_base_a9dd3f18cc5e81e1a871279abeda2da84}{\_isDisposed} = \textcolor{keyword}{false};
00031 
\Hypertarget{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_codec_base_8cs_source_l00035}\hyperlink{class_dot_z_lib_1_1_codec_base_a4e516f01a0660be7dbbbed22d1f6b595}{00035}         \textcolor{keyword}{protected} \textcolor{keyword}{const} \textcolor{keywordtype}{int} \hyperlink{class_dot_z_lib_1_1_codec_base_a4e516f01a0660be7dbbbed22d1f6b595}{kBufferSize} = 16384;
00036 
00037         \textcolor{keyword}{private} byte[] \_outBuffer = \textcolor{keyword}{new} byte[\hyperlink{class_dot_z_lib_1_1_codec_base_a4e516f01a0660be7dbbbed22d1f6b595}{kBufferSize}];
00038         \textcolor{keyword}{private} byte[] \_inBuffer = \textcolor{keyword}{new} byte[\hyperlink{class_dot_z_lib_1_1_codec_base_a4e516f01a0660be7dbbbed22d1f6b595}{kBufferSize}];
00039 
00040         \textcolor{keyword}{private} GCHandle \_hInput;
00041         \textcolor{keyword}{private} GCHandle \_hOutput;
00042 
00043         \textcolor{keyword}{private} uint \_checksum = 0;
00044 
00045 \textcolor{preprocessor}{        #endregion}
00046 
\Hypertarget{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_codec_base_8cs_source_l00050}\hyperlink{class_dot_z_lib_1_1_codec_base_a1e372f5061c8f7c16a55bc41c55ebfa5}{00050}         \textcolor{keyword}{public} \hyperlink{class_dot_z_lib_1_1_codec_base_a1e372f5061c8f7c16a55bc41c55ebfa5}{CodecBase}()
00051         \{
00052             \textcolor{keywordflow}{try}
00053             \{
00054                 \_hInput = GCHandle.Alloc(\_inBuffer, GCHandleType.Pinned);
00055                 \_hOutput = GCHandle.Alloc(\_outBuffer, GCHandleType.Pinned);
00056             \}
00057             \textcolor{keywordflow}{catch} (Exception)
00058             \{
00059                 \hyperlink{class_dot_z_lib_1_1_codec_base_aa0ded075105c5cf6f5f0d61928c90ca6}{CleanUp}(\textcolor{keyword}{false});
00060                 \textcolor{keywordflow}{throw};
00061             \}
00062         \}
00063 
00064 
00065 \textcolor{preprocessor}{        #region Codec Members}
00066 
\Hypertarget{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_codec_base_8cs_source_l00070}\hyperlink{class_dot_z_lib_1_1_codec_base_ad7ec5a193ad07d7c91d2538c51eb33c1}{00070}         \textcolor{keyword}{public} \textcolor{keyword}{event} \hyperlink{namespace_dot_z_lib_a13a751b897fc2af0be2307e4deb7eb1c}{DataAvailableHandler} \hyperlink{class_dot_z_lib_1_1_codec_base_ad7ec5a193ad07d7c91d2538c51eb33c1}{DataAvailable};
00071 
\Hypertarget{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_codec_base_8cs_source_l00075}\hyperlink{class_dot_z_lib_1_1_codec_base_a5c697195bc017ae951858e7c8948f9ae}{00075}         \textcolor{keyword}{protected} \textcolor{keywordtype}{void} \hyperlink{class_dot_z_lib_1_1_codec_base_a5c697195bc017ae951858e7c8948f9ae}{OnDataAvailable}()
00076         \{
00077             \textcolor{keywordflow}{if} (\_ztream.total\_out > 0)
00078             \{
00079                 \textcolor{keywordflow}{if} (DataAvailable != null)
00080                     \hyperlink{class_dot_z_lib_1_1_codec_base_ad7ec5a193ad07d7c91d2538c51eb33c1}{DataAvailable}( \_outBuffer, 0, (\textcolor{keywordtype}{int})\_ztream.total\_out);
00081                 \hyperlink{class_dot_z_lib_1_1_codec_base_a801b625073b21aeaab52ebf9e96dd9c9}{resetOutput}();
00082             \}
00083         \}
00084 
\Hypertarget{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_codec_base_8cs_source_l00090}\hyperlink{class_dot_z_lib_1_1_codec_base_a9131ff23312ada67dbf58f428d562de4}{00090}         \textcolor{keyword}{public} \textcolor{keywordtype}{void} \hyperlink{class_dot_z_lib_1_1_codec_base_a9131ff23312ada67dbf58f428d562de4}{Add}(byte[] data)
00091         \{
00092             \hyperlink{class_dot_z_lib_1_1_codec_base_a9131ff23312ada67dbf58f428d562de4}{Add}(data,0,data.Length);
00093         \}
00094 
00103         \textcolor{keyword}{public} \textcolor{keyword}{abstract} \textcolor{keywordtype}{void} \hyperlink{class_dot_z_lib_1_1_codec_base_a9131ff23312ada67dbf58f428d562de4}{Add}(byte[] data, \textcolor{keywordtype}{int} offset, \textcolor{keywordtype}{int} count);
00104 
00109         \textcolor{keyword}{public} \textcolor{keyword}{abstract} \textcolor{keywordtype}{void} \hyperlink{class_dot_z_lib_1_1_codec_base_abab96cb01a9b983452a31777e3a1e633}{Finish}();
00110 
\Hypertarget{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_codec_base_8cs_source_l00114}\hyperlink{class_dot_z_lib_1_1_codec_base_a3d3d33386fbbfcdc84c5f566a1d302cc}{00114}         \textcolor{keyword}{public} uint \hyperlink{class_dot_z_lib_1_1_codec_base_a3d3d33386fbbfcdc84c5f566a1d302cc}{Checksum} \{ \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} \_checksum; \} \}
00115 
00116 \textcolor{preprocessor}{        #endregion}
00117 
00118 \textcolor{preprocessor}{        #region Destructor & IDisposable stuff}
00119 
00123         ~\hyperlink{class_dot_z_lib_1_1_codec_base}{CodecBase}()
00124         \{
00125             \hyperlink{class_dot_z_lib_1_1_codec_base_aa0ded075105c5cf6f5f0d61928c90ca6}{CleanUp}(\textcolor{keyword}{false});
00126         \}
00127 
\Hypertarget{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_codec_base_8cs_source_l00131}\hyperlink{class_dot_z_lib_1_1_codec_base_ab4bdcee97631d9e80d2bceb01d01f368}{00131}         \textcolor{keyword}{public} \textcolor{keywordtype}{void} \hyperlink{class_dot_z_lib_1_1_codec_base_ab4bdcee97631d9e80d2bceb01d01f368}{Dispose}()
00132         \{
00133             \hyperlink{class_dot_z_lib_1_1_codec_base_aa0ded075105c5cf6f5f0d61928c90ca6}{CleanUp}(\textcolor{keyword}{true});
00134         \}
00135 
00140         \textcolor{keyword}{protected} \textcolor{keyword}{abstract} \textcolor{keywordtype}{void} \hyperlink{class_dot_z_lib_1_1_codec_base_aa0ded075105c5cf6f5f0d61928c90ca6}{CleanUp}();
00141 
00142         \textcolor{comment}{// performs the release of the handles and calls the dereived CleanUp()}
00143         \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{class_dot_z_lib_1_1_codec_base_aa0ded075105c5cf6f5f0d61928c90ca6}{CleanUp}(\textcolor{keywordtype}{bool} isDisposing)
00144         \{
00145             \textcolor{keywordflow}{if} (!\_isDisposed)
00146             \{
00147                 \hyperlink{class_dot_z_lib_1_1_codec_base_aa0ded075105c5cf6f5f0d61928c90ca6}{CleanUp}();
00148                 \textcolor{keywordflow}{if} (\_hInput.IsAllocated)
00149                     \_hInput.Free();
00150                 \textcolor{keywordflow}{if} (\_hOutput.IsAllocated)
00151                     \_hOutput.Free();
00152 
00153                 \_isDisposed = \textcolor{keyword}{true};
00154             \}
00155         \}
00156 
00157 
00158 \textcolor{preprocessor}{        #endregion}
00159 
00160 \textcolor{preprocessor}{        #region Helper methods}
00161 
\Hypertarget{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_codec_base_8cs_source_l00168}\hyperlink{class_dot_z_lib_1_1_codec_base_a8c827f091195356490e7f8b69e0546a7}{00168}         \textcolor{keyword}{protected} \textcolor{keywordtype}{void} \hyperlink{class_dot_z_lib_1_1_codec_base_a8c827f091195356490e7f8b69e0546a7}{copyInput}(byte[] data, \textcolor{keywordtype}{int} startIndex, \textcolor{keywordtype}{int} count)
00169         \{
00170             Array.Copy(data, startIndex, \_inBuffer,0, count);
00171             \_ztream.next\_in = \_hInput.AddrOfPinnedObject();
00172             \_ztream.total\_in = 0;
00173             \_ztream.avail\_in = (uint)count;
00174 
00175         \}
00176 
\Hypertarget{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_codec_base_8cs_source_l00180}\hyperlink{class_dot_z_lib_1_1_codec_base_a801b625073b21aeaab52ebf9e96dd9c9}{00180}         \textcolor{keyword}{protected} \textcolor{keywordtype}{void} \hyperlink{class_dot_z_lib_1_1_codec_base_a801b625073b21aeaab52ebf9e96dd9c9}{resetOutput}()
00181         \{
00182             \_ztream.total\_out = 0;
00183             \_ztream.avail\_out = \hyperlink{class_dot_z_lib_1_1_codec_base_a4e516f01a0660be7dbbbed22d1f6b595}{kBufferSize};
00184             \_ztream.next\_out = \_hOutput.AddrOfPinnedObject();
00185         \}
00186 
\Hypertarget{visual__studio_2zlib_2contrib_2dotzlib_2_dot_z_lib_2_codec_base_8cs_source_l00191}\hyperlink{class_dot_z_lib_1_1_codec_base_a5dfa2dddf3ac857652af7fd8e3d2034d}{00191}         \textcolor{keyword}{protected} \textcolor{keywordtype}{void} \hyperlink{class_dot_z_lib_1_1_codec_base_a5dfa2dddf3ac857652af7fd8e3d2034d}{setChecksum}(uint newSum)
00192         \{
00193             \_checksum = newSum;
00194         \}
00195 \textcolor{preprocessor}{        #endregion}
00196 
00197     \}
00198 \}
\end{DoxyCode}
