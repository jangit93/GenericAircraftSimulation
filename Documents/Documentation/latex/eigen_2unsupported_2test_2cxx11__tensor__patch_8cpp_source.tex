\hypertarget{eigen_2unsupported_2test_2cxx11__tensor__patch_8cpp_source}{}\section{eigen/unsupported/test/cxx11\+\_\+tensor\+\_\+patch.cpp}
\label{eigen_2unsupported_2test_2cxx11__tensor__patch_8cpp_source}\index{cxx11\+\_\+tensor\+\_\+patch.\+cpp@{cxx11\+\_\+tensor\+\_\+patch.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2014 Benoit Steiner <benoit.steiner.goog@gmail.com>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#include "main.h"}
00011 
00012 \textcolor{preprocessor}{#include <Eigen/CXX11/Tensor>}
00013 
00014 \textcolor{keyword}{using} \hyperlink{class_eigen_1_1_tensor}{Eigen::Tensor};
00015 
00016 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} DataLayout>
00017 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_simple\_patch()
00018 \{
00019   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 4, DataLayout>} tensor(2,3,5,7);
00020   tensor.setRandom();
00021   array<ptrdiff\_t, 4> patch\_dims;
00022 
00023   patch\_dims[0] = 1;
00024   patch\_dims[1] = 1;
00025   patch\_dims[2] = 1;
00026   patch\_dims[3] = 1;
00027 
00028   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 5, DataLayout>} no\_patch;
00029   no\_patch = tensor.extract\_patches(patch\_dims);
00030 
00031   \textcolor{keywordflow}{if} (DataLayout == \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor}) \{
00032     VERIFY\_IS\_EQUAL(no\_patch.dimension(0), 1);
00033     VERIFY\_IS\_EQUAL(no\_patch.dimension(1), 1);
00034     VERIFY\_IS\_EQUAL(no\_patch.dimension(2), 1);
00035     VERIFY\_IS\_EQUAL(no\_patch.dimension(3), 1);
00036     VERIFY\_IS\_EQUAL(no\_patch.dimension(4), tensor.size());
00037   \} \textcolor{keywordflow}{else} \{
00038     VERIFY\_IS\_EQUAL(no\_patch.dimension(0), tensor.size());
00039     VERIFY\_IS\_EQUAL(no\_patch.dimension(1), 1);
00040     VERIFY\_IS\_EQUAL(no\_patch.dimension(2), 1);
00041     VERIFY\_IS\_EQUAL(no\_patch.dimension(3), 1);
00042     VERIFY\_IS\_EQUAL(no\_patch.dimension(4), 1);
00043   \}
00044 
00045   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < tensor.size(); ++i) \{
00046     VERIFY\_IS\_EQUAL(tensor.data()[i], no\_patch.data()[i]);
00047   \}
00048 
00049   patch\_dims[0] = 2;
00050   patch\_dims[1] = 3;
00051   patch\_dims[2] = 5;
00052   patch\_dims[3] = 7;
00053   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 5, DataLayout>} single\_patch;
00054   single\_patch = tensor.extract\_patches(patch\_dims);
00055 
00056   \textcolor{keywordflow}{if} (DataLayout == \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor}) \{
00057     VERIFY\_IS\_EQUAL(single\_patch.dimension(0), 2);
00058     VERIFY\_IS\_EQUAL(single\_patch.dimension(1), 3);
00059     VERIFY\_IS\_EQUAL(single\_patch.dimension(2), 5);
00060     VERIFY\_IS\_EQUAL(single\_patch.dimension(3), 7);
00061     VERIFY\_IS\_EQUAL(single\_patch.dimension(4), 1);
00062   \} \textcolor{keywordflow}{else} \{
00063     VERIFY\_IS\_EQUAL(single\_patch.dimension(0), 1);
00064     VERIFY\_IS\_EQUAL(single\_patch.dimension(1), 2);
00065     VERIFY\_IS\_EQUAL(single\_patch.dimension(2), 3);
00066     VERIFY\_IS\_EQUAL(single\_patch.dimension(3), 5);
00067     VERIFY\_IS\_EQUAL(single\_patch.dimension(4), 7);
00068   \}
00069 
00070   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < tensor.size(); ++i) \{
00071     VERIFY\_IS\_EQUAL(tensor.data()[i], single\_patch.data()[i]);
00072   \}
00073 
00074   patch\_dims[0] = 1;
00075   patch\_dims[1] = 2;
00076   patch\_dims[2] = 2;
00077   patch\_dims[3] = 1;
00078   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 5, DataLayout>} twod\_patch;
00079   twod\_patch = tensor.extract\_patches(patch\_dims);
00080 
00081   \textcolor{keywordflow}{if} (DataLayout == \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor}) \{
00082     VERIFY\_IS\_EQUAL(twod\_patch.dimension(0), 1);
00083     VERIFY\_IS\_EQUAL(twod\_patch.dimension(1), 2);
00084     VERIFY\_IS\_EQUAL(twod\_patch.dimension(2), 2);
00085     VERIFY\_IS\_EQUAL(twod\_patch.dimension(3), 1);
00086     VERIFY\_IS\_EQUAL(twod\_patch.dimension(4), 2*2*4*7);
00087   \} \textcolor{keywordflow}{else} \{
00088     VERIFY\_IS\_EQUAL(twod\_patch.dimension(0), 2*2*4*7);
00089     VERIFY\_IS\_EQUAL(twod\_patch.dimension(1), 1);
00090     VERIFY\_IS\_EQUAL(twod\_patch.dimension(2), 2);
00091     VERIFY\_IS\_EQUAL(twod\_patch.dimension(3), 2);
00092     VERIFY\_IS\_EQUAL(twod\_patch.dimension(4), 1);
00093   \}
00094 
00095   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00096     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 2; ++j) \{
00097       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 4; ++k) \{
00098         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} l = 0; l < 7; ++l) \{
00099           \textcolor{keywordtype}{int} patch\_loc;
00100           \textcolor{keywordflow}{if} (DataLayout == \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor}) \{
00101             patch\_loc = i + 2 * (j + 2 * (k + 4 * l));
00102           \} \textcolor{keywordflow}{else} \{
00103             patch\_loc = l + 7 * (k + 4 * (j + 2 * i));
00104           \}
00105           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} x = 0; x < 2; ++x) \{
00106             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} y = 0; y < 2; ++y) \{
00107               \textcolor{keywordflow}{if} (DataLayout == \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor}) \{
00108                 VERIFY\_IS\_EQUAL(tensor(i,j+x,k+y,l), twod\_patch(0,x,y,0,patch\_loc));
00109               \} \textcolor{keywordflow}{else} \{
00110                 VERIFY\_IS\_EQUAL(tensor(i,j+x,k+y,l), twod\_patch(patch\_loc,0,x,y,0));
00111               \}
00112             \}
00113           \}
00114         \}
00115       \}
00116     \}
00117   \}
00118 
00119   patch\_dims[0] = 1;
00120   patch\_dims[1] = 2;
00121   patch\_dims[2] = 3;
00122   patch\_dims[3] = 5;
00123   \hyperlink{class_eigen_1_1_tensor}{Tensor<float, 5, DataLayout>} threed\_patch;
00124   threed\_patch = tensor.extract\_patches(patch\_dims);
00125 
00126   \textcolor{keywordflow}{if} (DataLayout == \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor}) \{
00127     VERIFY\_IS\_EQUAL(threed\_patch.dimension(0), 1);
00128     VERIFY\_IS\_EQUAL(threed\_patch.dimension(1), 2);
00129     VERIFY\_IS\_EQUAL(threed\_patch.dimension(2), 3);
00130     VERIFY\_IS\_EQUAL(threed\_patch.dimension(3), 5);
00131     VERIFY\_IS\_EQUAL(threed\_patch.dimension(4), 2*2*3*3);
00132   \} \textcolor{keywordflow}{else} \{
00133     VERIFY\_IS\_EQUAL(threed\_patch.dimension(0), 2*2*3*3);
00134     VERIFY\_IS\_EQUAL(threed\_patch.dimension(1), 1);
00135     VERIFY\_IS\_EQUAL(threed\_patch.dimension(2), 2);
00136     VERIFY\_IS\_EQUAL(threed\_patch.dimension(3), 3);
00137     VERIFY\_IS\_EQUAL(threed\_patch.dimension(4), 5);
00138   \}
00139 
00140   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; ++i) \{
00141     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 2; ++j) \{
00142       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 3; ++k) \{
00143         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} l = 0; l < 3; ++l) \{
00144           \textcolor{keywordtype}{int} patch\_loc;
00145           \textcolor{keywordflow}{if} (DataLayout == \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor}) \{
00146             patch\_loc = i + 2 * (j + 2 * (k + 3 * l));
00147           \} \textcolor{keywordflow}{else} \{
00148             patch\_loc = l + 3 * (k + 3 * (j + 2 * i));
00149           \}
00150           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} x = 0; x < 2; ++x) \{
00151             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} y = 0; y < 3; ++y) \{
00152               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} z = 0; z < 5; ++z) \{
00153                 \textcolor{keywordflow}{if} (DataLayout == \hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0cbd4bdd0abcfc0224c5fcb5e4f6669a}{ColMajor}) \{
00154                   VERIFY\_IS\_EQUAL(tensor(i,j+x,k+y,l+z), threed\_patch(0,x,y,z,patch\_loc));
00155                 \} \textcolor{keywordflow}{else} \{
00156                   VERIFY\_IS\_EQUAL(tensor(i,j+x,k+y,l+z), threed\_patch(patch\_loc,0,x,y,z));
00157                 \}
00158               \}
00159             \}
00160           \}
00161         \}
00162       \}
00163     \}
00164   \}
00165 \}
00166 
00167 \textcolor{keywordtype}{void} test\_cxx11\_tensor\_patch()
00168 \{
00169    CALL\_SUBTEST(test\_simple\_patch<ColMajor>());
00170    CALL\_SUBTEST(test\_simple\_patch<RowMajor>());
00171    \textcolor{comment}{//   CALL\_SUBTEST(test\_expr\_shuffling());}
00172 \}
\end{DoxyCode}
