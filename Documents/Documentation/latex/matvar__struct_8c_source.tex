\hypertarget{matvar__struct_8c_source}{}\section{matvar\+\_\+struct.\+c}
\label{matvar__struct_8c_source}\index{matvar\+\_\+struct.\+c@{matvar\+\_\+struct.\+c}}

\begin{DoxyCode}
00001 \textcolor{comment}{/*}
00002 \textcolor{comment}{ * Copyright (c) 2012-2018, Christopher C. Hulbert}
00003 \textcolor{comment}{ * All rights reserved.}
00004 \textcolor{comment}{ *}
00005 \textcolor{comment}{ * Redistribution and use in source and binary forms, with or without}
00006 \textcolor{comment}{ * modification, are permitted provided that the following conditions are met:}
00007 \textcolor{comment}{ *}
00008 \textcolor{comment}{ * 1. Redistributions of source code must retain the above copyright notice, this}
00009 \textcolor{comment}{ *    list of conditions and the following disclaimer.}
00010 \textcolor{comment}{ *}
00011 \textcolor{comment}{ * 2. Redistributions in binary form must reproduce the above copyright notice,}
00012 \textcolor{comment}{ *    this list of conditions and the following disclaimer in the documentation}
00013 \textcolor{comment}{ *    and/or other materials provided with the distribution.}
00014 \textcolor{comment}{ *}
00015 \textcolor{comment}{ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"}
00016 \textcolor{comment}{ * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE}
00017 \textcolor{comment}{ * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE}
00018 \textcolor{comment}{ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE}
00019 \textcolor{comment}{ * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL}
00020 \textcolor{comment}{ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR}
00021 \textcolor{comment}{ * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER}
00022 \textcolor{comment}{ * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,}
00023 \textcolor{comment}{ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE}
00024 \textcolor{comment}{ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.}
00025 \textcolor{comment}{ */}
00026 
00027 \textcolor{preprocessor}{#include <stdlib.h>}
00028 \textcolor{preprocessor}{#include <string.h>}
00029 \textcolor{preprocessor}{#if defined(\_MSC\_VER) || defined(\_\_MINGW32\_\_)}
00030 \textcolor{preprocessor}{#   define strdup \_strdup}
00031 \textcolor{preprocessor}{#endif}
00032 \textcolor{preprocessor}{#include "matio\_private.h"}
00033 
00044 \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *
\Hypertarget{matvar__struct_8c_source_l00045}\hyperlink{group___m_a_t_gacecdb682a50977e54ecbdc54ed5c31bf}{00045} \hyperlink{group___m_a_t_gacecdb682a50977e54ecbdc54ed5c31bf}{Mat\_VarCreateStruct}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *name,\textcolor{keywordtype}{int} rank,\textcolor{keywordtype}{size\_t} *dims,\textcolor{keyword}{const} \textcolor{keywordtype}{char} **fields,
00046     \textcolor{keywordtype}{unsigned} nfields)
00047 \{
00048     \textcolor{keywordtype}{int} i, nmemb = 1;
00049     \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar;
00050 
00051     \textcolor{keywordflow}{if} ( NULL == dims )
00052         \textcolor{keywordflow}{return} NULL;
00053 
00054     matvar = \hyperlink{group___m_a_t_gae7c9c3699f6e9c31a9c490300013098c}{Mat\_VarCalloc}();
00055     \textcolor{keywordflow}{if} ( NULL == matvar )
00056         \textcolor{keywordflow}{return} NULL;
00057 
00058     matvar->\hyperlink{group___m_a_t_aeef0466048621cb2c959ba7f6c774d06}{compression} = \hyperlink{group___m_a_t_gga768c318af97bd2567758ecb001ceb7f4a2280b97631ff5dd24dec55261dc587b6}{MAT\_COMPRESSION\_NONE};
00059     \textcolor{keywordflow}{if} ( NULL != name )
00060         matvar->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} = strdup(name);
00061     matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} = rank;
00062     matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims} = (\textcolor{keywordtype}{size\_t}*)malloc(matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}*\textcolor{keyword}{sizeof}(*matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}));
00063     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ ) \{
00064         matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i] = dims[i];
00065         nmemb *= dims[i];
00066     \}
00067     matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} = \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT};
00068     matvar->\hyperlink{group___m_a_t_ab6aafe9bd77f0f077852593dec438144}{data\_type}  = \hyperlink{group___m_a_t_ggacf7b3b879282b7ab3a51190e49bf3453a4f4d5a6e1d42c6aa81ffb810e5da5c85}{MAT\_T\_STRUCT};
00069 
00070     matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} = \textcolor{keyword}{sizeof}(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *);
00071 
00072     \textcolor{keywordflow}{if} ( nfields ) \{
00073         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields} = nfields;
00074         matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames} =
00075             (\textcolor{keywordtype}{char}**)malloc(nfields*\textcolor{keyword}{sizeof}(*matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}));
00076         \textcolor{keywordflow}{if} ( NULL == matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames} ) \{
00077             \hyperlink{group___m_a_t_ga1d14716f7450530fd1c9d02413787f0e}{Mat\_VarFree}(matvar);
00078             matvar = NULL;
00079         \} \textcolor{keywordflow}{else} \{
00080             \textcolor{keywordflow}{for} ( i = 0; i < nfields; i++ ) \{
00081                 \textcolor{keywordflow}{if} ( NULL == fields[i] ) \{
00082                     \hyperlink{group___m_a_t_ga1d14716f7450530fd1c9d02413787f0e}{Mat\_VarFree}(matvar);
00083                     matvar = NULL;
00084                     \textcolor{keywordflow}{break};
00085                 \} \textcolor{keywordflow}{else} \{
00086                     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i] = strdup(fields[i]);
00087                 \}
00088             \}
00089         \}
00090         \textcolor{keywordflow}{if} ( NULL != matvar && nmemb > 0 ) \{
00091             \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **field\_vars;
00092             matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} = nmemb*nfields*matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size};
00093             matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} = malloc(matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes});
00094             field\_vars = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t}**)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
00095             for ( i = 0; i < nfields*nmemb; i++ )
00096                 field\_vars[i] = NULL;
00097         \}
00098     \}
00099 
00100     \textcolor{keywordflow}{return} matvar;
00101 \}
00102 
00113 \textcolor{keywordtype}{int}
\Hypertarget{matvar__struct_8c_source_l00114}\hyperlink{group___m_a_t_gaef5689cace7c4165c3cbf8fa17d1ebcd}{00114} \hyperlink{group___m_a_t_gaef5689cace7c4165c3cbf8fa17d1ebcd}{Mat\_VarAddStructField}(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,\textcolor{keyword}{const} \textcolor{keywordtype}{char} *fieldname)
00115 \{
00116     \textcolor{keywordtype}{int}       i, f, nfields, nmemb, cnt = 0;
00117     \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **new\_data, **old\_data;
00118     \textcolor{keywordtype}{char}     **fieldnames;
00119 
00120     \textcolor{keywordflow}{if} ( matvar == NULL || fieldname == NULL )
00121         \textcolor{keywordflow}{return} -1;
00122     nmemb = 1;
00123     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
00124         nmemb *= matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
00125 
00126     nfields = matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields}+1;
00127     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields} = nfields;
00128     fieldnames = (\textcolor{keywordtype}{char}**)realloc(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames},
00129         nfields*\textcolor{keyword}{sizeof}(*matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}));
00130     \textcolor{keywordflow}{if} ( NULL == fieldnames )
00131         \textcolor{keywordflow}{return} -1;
00132     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames} = fieldnames;
00133     matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[nfields-1] = strdup(fieldname);
00134 
00135     new\_data = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t}**)malloc(nfields*nmemb*\textcolor{keyword}{sizeof}(*new\_data));
00136     \textcolor{keywordflow}{if} ( new\_data == NULL )
00137         \textcolor{keywordflow}{return} -1;
00138 
00139     old\_data = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t}**)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
00140     for ( i = 0; i < nmemb; i++ ) \{
00141         \textcolor{keywordflow}{for} ( f = 0; f < nfields-1; f++ )
00142             new\_data[cnt++] = old\_data[i*(nfields-1)+f];
00143         new\_data[cnt++] = NULL;
00144     \}
00145 
00146     free(matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data});
00147     matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} = new\_data;
00148     matvar->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} = nfields*nmemb*\textcolor{keyword}{sizeof}(*new\_data);
00149 
00150     \textcolor{keywordflow}{return} 0;
00151 \}
00152 
00160 \textcolor{keywordtype}{unsigned}
\Hypertarget{matvar__struct_8c_source_l00161}\hyperlink{group___m_a_t_ga06ba20aa758543d53dc83a1ccbdc2efc}{00161} \hyperlink{group___m_a_t_ga06ba20aa758543d53dc83a1ccbdc2efc}{Mat\_VarGetNumberOfFields}(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar)
00162 \{
00163     \textcolor{keywordtype}{int} nfields;
00164     \textcolor{keywordflow}{if} ( matvar == NULL || matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} != \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT}   ||
00165         NULL == matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal} ) \{
00166         nfields = 0;
00167     \} \textcolor{keywordflow}{else} \{
00168         nfields = matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields};
00169     \}
00170     \textcolor{keywordflow}{return} nfields;
00171 \}
00172 
00181 \textcolor{keywordtype}{char} * \textcolor{keyword}{const} *
\Hypertarget{matvar__struct_8c_source_l00182}\hyperlink{group___m_a_t_ga88bc328e59ce1dd8f43e917c07140803}{00182} \hyperlink{group___m_a_t_ga88bc328e59ce1dd8f43e917c07140803}{Mat\_VarGetStructFieldnames}(\textcolor{keyword}{const} \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar)
00183 \{
00184     \textcolor{keywordflow}{if} ( matvar == NULL || matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} != \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT}   ||
00185         NULL == matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal} ) \{
00186         \textcolor{keywordflow}{return} NULL;
00187     \} \textcolor{keywordflow}{else} \{
00188         \textcolor{keywordflow}{return} matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames};
00189     \}
00190 \}
00191 
00201 \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *
\Hypertarget{matvar__struct_8c_source_l00202}\hyperlink{group___m_a_t_ga03ab2d89f683f9ccb4785fb255b14e0b}{00202} \hyperlink{group___m_a_t_ga03ab2d89f683f9ccb4785fb255b14e0b}{Mat\_VarGetStructFieldByIndex}(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,\textcolor{keywordtype}{size\_t} field\_index,\textcolor{keywordtype}{size\_t}
       index)
00203 \{
00204     \textcolor{keywordtype}{int}       i, nfields;
00205     \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *field = NULL;
00206     \textcolor{keywordtype}{size\_t} nmemb;
00207 
00208     \textcolor{keywordflow}{if} ( matvar == NULL || matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} != \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT}   ||
00209         matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} == 0 )
00210         \textcolor{keywordflow}{return} field;
00211 
00212     nmemb = 1;
00213     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
00214         nmemb *= matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
00215 
00216     nfields = matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields};
00217 
00218     if ( nmemb > 0 && index >= nmemb ) \{
00219         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Mat\_VarGetStructField: structure index out of bounds"});
00220     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( nfields > 0 ) \{
00221         \textcolor{keywordflow}{if} ( field\_index > nfields ) \{
00222             \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Mat\_VarGetStructField: field index out of bounds"});
00223         \} \textcolor{keywordflow}{else} \{
00224             field = *((\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data}+index*nfields+field\_index);
00225         \}
00226     \}
00227 
00228     \textcolor{keywordflow}{return} field;
00229 \}
00230 
00240 \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *
\Hypertarget{matvar__struct_8c_source_l00241}\hyperlink{group___m_a_t_ga619d241b49ce97334a38add60562c7be}{00241} \hyperlink{group___m_a_t_ga619d241b49ce97334a38add60562c7be}{Mat\_VarGetStructFieldByName}(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,\textcolor{keyword}{const} \textcolor{keywordtype}{char} *field\_name,
00242                             \textcolor{keywordtype}{size\_t} index)
00243 \{
00244     \textcolor{keywordtype}{int}       i, nfields, field\_index;
00245     \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *field = NULL;
00246     \textcolor{keywordtype}{size\_t} nmemb;
00247 
00248     \textcolor{keywordflow}{if} ( matvar == NULL || matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} != \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT}   ||
00249         matvar->\hyperlink{group___m_a_t_a9ad1c82e2b568da617e12dc73a26e1f9}{data\_size} == 0 )
00250         \textcolor{keywordflow}{return} field;
00251 
00252     nmemb = 1;
00253     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
00254         nmemb *= matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
00255 
00256     nfields = matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields};
00257     field\_index = -1;
00258     for ( i = 0; i < nfields; i++ ) \{
00259         \textcolor{keywordflow}{if} ( !strcmp(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i],field\_name) ) \{
00260             field\_index = i;
00261             \textcolor{keywordflow}{break};
00262         \}
00263     \}
00264 
00265     \textcolor{keywordflow}{if} ( index >= nmemb ) \{
00266         \hyperlink{group__mat__util_gaf51f2bfbb5580f575e4dd79757e2b80c}{Mat\_Critical}(\textcolor{stringliteral}{"Mat\_VarGetStructField: structure index out of bounds"});
00267     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( field\_index >= 0 ) \{
00268         field = *((\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data}+index*nfields+field\_index);
00269     \}
00270 
00271     \textcolor{keywordflow}{return} field;
00272 \}
00273 
00287 \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *
\Hypertarget{matvar__struct_8c_source_l00288}\hyperlink{group___m_a_t_ga7018bfe6934b96ae32e8f2a1712eefab}{00288} \hyperlink{group___m_a_t_ga7018bfe6934b96ae32e8f2a1712eefab}{Mat\_VarGetStructField}(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,\textcolor{keywordtype}{void} *name\_or\_index,\textcolor{keywordtype}{int} opt,\textcolor{keywordtype}{int} index)
00289 \{
00290     \textcolor{keywordtype}{int}       i, err = 0, nfields, nmemb;
00291     \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *field = NULL;
00292 
00293     nmemb = 1;
00294     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
00295         nmemb *= matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
00296 
00297     nfields = matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields};
00298 
00299     if ( index < 0 || (nmemb > 0 && index >= nmemb ))
00300         err = 1;
00301     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( nfields < 1 )
00302         err = 1;
00303 
00304     \textcolor{keywordflow}{if} ( !err && (opt == \hyperlink{group___m_a_t_gga03158cf3a896ec3d4f306b5e920109b4a69c57994e272a363f56cb3ba888b047e}{MAT\_BY\_INDEX}) ) \{
00305         \textcolor{keywordtype}{size\_t} field\_index = *(\textcolor{keywordtype}{int} *)name\_or\_index;
00306         \textcolor{keywordflow}{if} ( field\_index > 0 )
00307             field = \hyperlink{group___m_a_t_ga03ab2d89f683f9ccb4785fb255b14e0b}{Mat\_VarGetStructFieldByIndex}(matvar,field\_index-1,index);
00308     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( !err && (opt == \hyperlink{group___m_a_t_gga03158cf3a896ec3d4f306b5e920109b4a26c82f22528c705191141491a072db3e}{MAT\_BY\_NAME}) ) \{
00309         field = \hyperlink{group___m_a_t_ga619d241b49ce97334a38add60562c7be}{Mat\_VarGetStructFieldByName}(matvar,(\textcolor{keyword}{const} \textcolor{keywordtype}{char}*)name\_or\_index,
      index);
00310     \}
00311 
00312     \textcolor{keywordflow}{return} field;
00313 \}
00314 
00337 \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *
\Hypertarget{matvar__struct_8c_source_l00338}\hyperlink{group___m_a_t_ga509178d7dc15faf9f7cd0440df6009b9}{00338} \hyperlink{group___m_a_t_ga509178d7dc15faf9f7cd0440df6009b9}{Mat\_VarGetStructs}(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,\textcolor{keywordtype}{int} *start,\textcolor{keywordtype}{int} *stride,\textcolor{keywordtype}{int} *edge,
00339     \textcolor{keywordtype}{int} copy\_fields)
00340 \{
00341     \textcolor{keywordtype}{size\_t} i,j,N,I,nfields,field,idx[10] = \{0,\},cnt[10] = \{0,\},dimp[10] = \{0,\};
00342     \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **fields, *struct\_slab;
00343 
00344     \textcolor{keywordflow}{if} ( (matvar == NULL) || (start == NULL) || (stride == NULL) ||
00345          (edge == NULL) ) \{
00346         \textcolor{keywordflow}{return} NULL;
00347     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} > 9 ) \{
00348         \textcolor{keywordflow}{return} NULL;
00349     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} != \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT} ) \{
00350         \textcolor{keywordflow}{return} NULL;
00351     \}
00352 
00353     struct\_slab = \hyperlink{group___m_a_t_ga7ef80c5d99d7918b2b09db3bea106ecc}{Mat\_VarDuplicate}(matvar,0);
00354     \textcolor{keywordflow}{if} ( !copy\_fields )
00355         struct\_slab->\hyperlink{group___m_a_t_aff20e87a00691c97340ab07656a13ee7}{mem\_conserve} = 1;
00356 
00357     nfields = matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields};
00358 
00359     dimp[0] = matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0];
00360     N = edge[0];
00361     I = start[0];
00362     struct\_slab->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0] = edge[0];
00363     idx[0] = start[0];
00364     \textcolor{keywordflow}{for} ( i = 1; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ ) \{
00365         idx[i]  = start[i];
00366         dimp[i] = dimp[i-1]*matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
00367         N *= edge[i];
00368         I += start[i]*dimp[i-1];
00369         struct\_slab->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i] = edge[i];
00370     \}
00371     I *= nfields;
00372     struct\_slab->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes}    = N*nfields*\textcolor{keyword}{sizeof}(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *);
00373     struct\_slab->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} = malloc(struct\_slab->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes});
00374     \textcolor{keywordflow}{if} ( struct\_slab->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} == NULL ) \{
00375         \hyperlink{group___m_a_t_ga1d14716f7450530fd1c9d02413787f0e}{Mat\_VarFree}(struct\_slab);
00376         \textcolor{keywordflow}{return} NULL;
00377     \}
00378     fields = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t}**)struct\_slab->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
00379     for ( i = 0; i < N; i+=edge[0] ) \{
00380         \textcolor{keywordflow}{for} ( j = 0; j < edge[0]; j++ ) \{
00381             \textcolor{keywordflow}{for} ( field = 0; field < nfields; field++ ) \{
00382                 \textcolor{keywordflow}{if} ( copy\_fields )
00383                     fields[(i+j)*nfields+field] =
00384                          \hyperlink{group___m_a_t_ga7ef80c5d99d7918b2b09db3bea106ecc}{Mat\_VarDuplicate}(*((\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **)matvar->
      \hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} + I),1);
00385                 \textcolor{keywordflow}{else}
00386                     fields[(i+j)*nfields+field] =
00387                         *((\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} + I);
00388                 I++;
00389             \}
00390             I += (stride[0]-1)*nfields;
00391         \}
00392         idx[0] = start[0];
00393         I = idx[0];
00394         cnt[1]++;
00395         idx[1] += stride[1];
00396         \textcolor{keywordflow}{for} ( j = 1; j < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; j++ ) \{
00397             \textcolor{keywordflow}{if} ( cnt[j] == edge[j] ) \{
00398                 cnt[j] = 0;
00399                 idx[j] = start[j];
00400                 cnt[j+1]++;
00401                 idx[j+1] += stride[j+1];
00402             \}
00403             I += idx[j]*dimp[j-1];
00404         \}
00405         I *= nfields;
00406     \}
00407     \textcolor{keywordflow}{return} struct\_slab;
00408 \}
00409 
00427 \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *
\Hypertarget{matvar__struct_8c_source_l00428}\hyperlink{group___m_a_t_gaa56680fb7b2cd3d410f659e945da8141}{00428} \hyperlink{group___m_a_t_gaa56680fb7b2cd3d410f659e945da8141}{Mat\_VarGetStructsLinear}(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,\textcolor{keywordtype}{int} start,\textcolor{keywordtype}{int} stride,\textcolor{keywordtype}{int} edge,
00429     \textcolor{keywordtype}{int} copy\_fields)
00430 \{
00431     \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *struct\_slab;
00432 
00433     \textcolor{comment}{/* FIXME: Check allocations */}
00434     \textcolor{keywordflow}{if} ( matvar == NULL || matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank} > 10 ) \{
00435        struct\_slab = NULL;
00436     \} \textcolor{keywordflow}{else} \{
00437         \textcolor{keywordtype}{int} i, I, field, nfields;
00438         \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **fields;
00439 
00440         struct\_slab = \hyperlink{group___m_a_t_ga7ef80c5d99d7918b2b09db3bea106ecc}{Mat\_VarDuplicate}(matvar,0);
00441         \textcolor{keywordflow}{if} ( !copy\_fields )
00442             struct\_slab->\hyperlink{group___m_a_t_aff20e87a00691c97340ab07656a13ee7}{mem\_conserve} = 1;
00443 
00444         nfields = matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields};
00445 
00446         struct\_slab->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes} = edge*nfields*\textcolor{keyword}{sizeof}(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *);
00447         struct\_slab->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} = malloc(struct\_slab->\hyperlink{group___m_a_t_abf1c844540503be2df9bb3db93cfe307}{nbytes});
00448         struct\_slab->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[0] = edge;
00449         struct\_slab->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[1] = 1;
00450         fields = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t}**)struct\_slab->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
00451         I = start*nfields;
00452         for ( i = 0; i < edge; i++ ) \{
00453             \textcolor{keywordflow}{if} ( copy\_fields ) \{
00454                 \textcolor{keywordflow}{for} ( field = 0; field < nfields; field++ ) \{
00455                     fields[i*nfields+field] =
00456                         \hyperlink{group___m_a_t_ga7ef80c5d99d7918b2b09db3bea106ecc}{Mat\_VarDuplicate}(*((\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **)matvar->
      \hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data}+I),1);
00457                     I++;
00458                 \}
00459             \} \textcolor{keywordflow}{else} \{
00460                 \textcolor{keywordflow}{for} ( field = 0; field < nfields; field++ ) \{
00461                     fields[i*nfields+field] = *((\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **)matvar->
      \hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} + I);
00462                     I++;
00463                 \}
00464             \}
00465             I += (stride-1)*nfields;
00466         \}
00467     \}
00468     \textcolor{keywordflow}{return} struct\_slab;
00469 \}
00470 
00483 \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *
\Hypertarget{matvar__struct_8c_source_l00484}\hyperlink{group___m_a_t_ga3f077a005a8521c7a78927c1a1b4ae45}{00484} \hyperlink{group___m_a_t_ga3f077a005a8521c7a78927c1a1b4ae45}{Mat\_VarSetStructFieldByIndex}(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,\textcolor{keywordtype}{size\_t} field\_index,\textcolor{keywordtype}{size\_t}
       index,
00485     \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *field)
00486 \{
00487     \textcolor{keywordtype}{int}       i, nfields;
00488     \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *old\_field = NULL;
00489     \textcolor{keywordtype}{size\_t} nmemb;
00490 
00491     \textcolor{keywordflow}{if} ( matvar == NULL || matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} != \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT} ||
00492         matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} == NULL )
00493         \textcolor{keywordflow}{return} old\_field;
00494 
00495     nmemb = 1;
00496     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
00497         nmemb *= matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
00498 
00499     nfields = matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields};
00500 
00501     if ( index < nmemb && field\_index < nfields ) \{
00502         \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **fields = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t}**)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
00503         old\_field = fields[index*nfields+field\_index];
00504         fields[index*nfields+field\_index] = field;
00505         if ( NULL != field->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} ) \{
00506             free(field->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
00507         \}
00508         field->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} = strdup(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[field\_index]);
00509     \}
00510 
00511     \textcolor{keywordflow}{return} old\_field;
00512 \}
00513 
00525 \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *
\Hypertarget{matvar__struct_8c_source_l00526}\hyperlink{group___m_a_t_ga702f2b853c605c94a8af50555fc7183b}{00526} \hyperlink{group___m_a_t_ga702f2b853c605c94a8af50555fc7183b}{Mat\_VarSetStructFieldByName}(\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *matvar,\textcolor{keyword}{const} \textcolor{keywordtype}{char} *field\_name,
00527     \textcolor{keywordtype}{size\_t} index,\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *field)
00528 \{
00529     \textcolor{keywordtype}{int}       i, nfields, field\_index;
00530     \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} *old\_field = NULL;
00531     \textcolor{keywordtype}{size\_t} nmemb;
00532 
00533     \textcolor{keywordflow}{if} ( matvar == NULL || matvar->\hyperlink{group___m_a_t_aff13035bf3265dd7d9425e5d40c839d4}{class\_type} != \hyperlink{group___m_a_t_ggad4d60ae7b709fc81bfd744fb4c857c40acb467c7749c80902b798134c729bb521}{MAT\_C\_STRUCT} ||
00534          matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data} == NULL )
00535         \textcolor{keywordflow}{return} old\_field;
00536 
00537     nmemb = 1;
00538     \textcolor{keywordflow}{for} ( i = 0; i < matvar->\hyperlink{group___m_a_t_a84ba70c96ded13cc555fa75b768d9921}{rank}; i++ )
00539         nmemb *= matvar->\hyperlink{group___m_a_t_a8e01234e1c862ce3472bb37f5a09b92c}{dims}[i];
00540 
00541     nfields = matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a93fc447484f455eddf9334f2e9e411c2}{num\_fields};
00542     field\_index = -1;
00543     for ( i = 0; i < nfields; i++ ) \{
00544         \textcolor{keywordflow}{if} ( !strcmp(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[i],field\_name) ) \{
00545             field\_index = i;
00546             \textcolor{keywordflow}{break};
00547         \}
00548     \}
00549 
00550     \textcolor{keywordflow}{if} ( index < nmemb && field\_index >= 0 ) \{
00551         \hyperlink{group___m_a_t_structmatvar__t}{matvar\_t} **fields = (\hyperlink{group___m_a_t_structmatvar__t}{matvar\_t}**)matvar->\hyperlink{group___m_a_t_a5672978efa230bbdecdf38ede781f7fa}{data};
00552         old\_field = fields[index*nfields+field\_index];
00553         fields[index*nfields+field\_index] = field;
00554         if ( NULL != field->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} ) \{
00555             free(field->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name});
00556         \}
00557         field->\hyperlink{group___m_a_t_a5d4b55b041e3b4fb50c04337f05ad909}{name} = strdup(matvar->\hyperlink{group___m_a_t_a6e97e3ed9f40c49322c18561c2a94e92}{internal}->\hyperlink{structmatvar__internal_a7574d000bfc98ad4860ae6590b8d4985}{fieldnames}[field\_index]);
00558     \}
00559 
00560     \textcolor{keywordflow}{return} old\_field;
00561 \}
\end{DoxyCode}
