\hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_eigen_solver_8h_source}{}\section{matio/visual\+\_\+studio/test/eigen/\+Eigen/src/\+Eigenvalues/\+Complex\+Eigen\+Solver.h}
\label{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_eigen_solver_8h_source}\index{Complex\+Eigen\+Solver.\+h@{Complex\+Eigen\+Solver.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2009 Claire Maurice}
00005 \textcolor{comment}{// Copyright (C) 2009 Gael Guennebaud <gael.guennebaud@inria.fr>}
00006 \textcolor{comment}{// Copyright (C) 2010,2012 Jitse Niesen <jitse@maths.leeds.ac.uk>}
00007 \textcolor{comment}{//}
00008 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00009 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00010 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00011 
00012 \textcolor{preprocessor}{#ifndef EIGEN\_COMPLEX\_EIGEN\_SOLVER\_H}
00013 \textcolor{preprocessor}{#define EIGEN\_COMPLEX\_EIGEN\_SOLVER\_H}
00014 
00015 \textcolor{preprocessor}{#include "./ComplexSchur.h"}
00016 
00017 \textcolor{keyword}{namespace }\hyperlink{namespace_eigen}{Eigen} \{ 
00018 
00045 \textcolor{keyword}{template}<\textcolor{keyword}{typename} \_MatrixType> \textcolor{keyword}{class }ComplexEigenSolver
00046 \{
00047   \textcolor{keyword}{public}:
00048 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_eigen_solver_8h_source_l00050}\hyperlink{group___eigenvalues___module_ad61f6278843a601096276c9a72c0252f}{00050}     \textcolor{keyword}{typedef} \_MatrixType \hyperlink{group___eigenvalues___module_ad61f6278843a601096276c9a72c0252f}{MatrixType};
00051 
00052     \textcolor{keyword}{enum} \{
00053       RowsAtCompileTime = MatrixType::RowsAtCompileTime,
00054       ColsAtCompileTime = MatrixType::ColsAtCompileTime,
00055       Options = MatrixType::Options,
00056       MaxRowsAtCompileTime = MatrixType::MaxRowsAtCompileTime,
00057       MaxColsAtCompileTime = MatrixType::MaxColsAtCompileTime
00058     \};
00059 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_eigen_solver_8h_source_l00061}\hyperlink{group___eigenvalues___module_a61035d40c9498bb1d47628cdd4946785}{00061}     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::Scalar \hyperlink{group___eigenvalues___module_a61035d40c9498bb1d47628cdd4946785}{Scalar};
00062     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<Scalar>::Real} RealScalar;
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_eigen_solver_8h_source_l00063}\hyperlink{group___eigenvalues___module_abc0218d8b902af0d6c759bfc0a8a8d74}{00063}     \textcolor{keyword}{typedef} \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index} \hyperlink{group___eigenvalues___module_abc0218d8b902af0d6c759bfc0a8a8d74}{Index}; 
00064 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_eigen_solver_8h_source_l00071}\hyperlink{group___eigenvalues___module_a3604c99a69fac3bee42c88cb2b589143}{00071}     \textcolor{keyword}{typedef} std::complex<RealScalar> \hyperlink{group___eigenvalues___module_a3604c99a69fac3bee42c88cb2b589143}{ComplexScalar};
00072 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_eigen_solver_8h_source_l00078}\hyperlink{group___eigenvalues___module_ad3a663b1ff5200a098dabbbf9b7162b1}{00078}     \textcolor{keyword}{typedef} 
      \hyperlink{group___core___module}{Matrix<ComplexScalar, ColsAtCompileTime, 1, Options&(~RowMajor), MaxColsAtCompileTime, 1>}
       \hyperlink{group___eigenvalues___module_ad3a663b1ff5200a098dabbbf9b7162b1}{EigenvalueType};
00079 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_eigen_solver_8h_source_l00085}\hyperlink{group___eigenvalues___module_a67cd4d20590abfd86b2639c4c8ea3dd6}{00085}     \textcolor{keyword}{typedef} 
      \hyperlink{group___core___module}{Matrix<ComplexScalar, RowsAtCompileTime, ColsAtCompileTime, Options, MaxRowsAtCompileTime,
       MaxColsAtCompileTime>}
       \hyperlink{group___eigenvalues___module_a67cd4d20590abfd86b2639c4c8ea3dd6}{EigenvectorType};
00086 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_eigen_solver_8h_source_l00092}\hyperlink{group___eigenvalues___module_a3322a21574c61eefd450c003515ad802}{00092}     \hyperlink{group___eigenvalues___module_a3322a21574c61eefd450c003515ad802}{ComplexEigenSolver}()
00093             : m\_eivec(),
00094               m\_eivalues(),
00095               m\_schur(),
00096               m\_isInitialized(false),
00097               m\_eigenvectorsOk(false),
00098               m\_matX()
00099     \{\}
00100 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_eigen_solver_8h_source_l00107}\hyperlink{group___eigenvalues___module_a86751f64ebcd5c554551fb5eaaa02db7}{00107}     \textcolor{keyword}{explicit} \hyperlink{group___eigenvalues___module_a86751f64ebcd5c554551fb5eaaa02db7}{ComplexEigenSolver}(Index size)
00108             : m\_eivec(size, size),
00109               m\_eivalues(size),
00110               m\_schur(size),
00111               m\_isInitialized(false),
00112               m\_eigenvectorsOk(false),
00113               m\_matX(size, size)
00114     \{\}
00115 
00125     \textcolor{keyword}{template}<\textcolor{keyword}{typename} InputType>
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_eigen_solver_8h_source_l00126}\hyperlink{group___eigenvalues___module_a748de5c1e7f730e16421e6d451437600}{00126}     \textcolor{keyword}{explicit} \hyperlink{group___eigenvalues___module_a748de5c1e7f730e16421e6d451437600}{ComplexEigenSolver}(\textcolor{keyword}{const} \hyperlink{group___core___module_struct_eigen_1_1_eigen_base}{EigenBase<InputType>}& matrix, \textcolor{keywordtype}{
      bool} computeEigenvectors = \textcolor{keyword}{true})
00127             : m\_eivec(matrix.rows(),matrix.cols()),
00128               m\_eivalues(matrix.cols()),
00129               m\_schur(matrix.rows()),
00130               m\_isInitialized(false),
00131               m\_eigenvectorsOk(false),
00132               m\_matX(matrix.rows(),matrix.cols())
00133     \{
00134       \hyperlink{group___eigenvalues___module_aeb7e38c6db5369f5c974f3786e94c1f0}{compute}(matrix.\hyperlink{group___core___module_a324b16961a11d2ecfd2d1b7dd7946545}{derived}(), computeEigenvectors);
00135     \}
00136 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_eigen_solver_8h_source_l00157}\hyperlink{group___eigenvalues___module_a3aa5e27800349990778da8fa532c1270}{00157}     \textcolor{keyword}{const} EigenvectorType& \hyperlink{group___eigenvalues___module_a3aa5e27800349990778da8fa532c1270}{eigenvectors}()\textcolor{keyword}{ const}
00158 \textcolor{keyword}{    }\{
00159       eigen\_assert(m\_isInitialized && \textcolor{stringliteral}{"ComplexEigenSolver is not initialized."});
00160       eigen\_assert(m\_eigenvectorsOk && \textcolor{stringliteral}{"The eigenvectors have not been computed together with the
       eigenvalues."});
00161       \textcolor{keywordflow}{return} m\_eivec;
00162     \}
00163 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_eigen_solver_8h_source_l00182}\hyperlink{group___eigenvalues___module_a10c25c7620e7faedcd39991cce3a757b}{00182}     \textcolor{keyword}{const} EigenvalueType& \hyperlink{group___eigenvalues___module_a10c25c7620e7faedcd39991cce3a757b}{eigenvalues}()\textcolor{keyword}{ const}
00183 \textcolor{keyword}{    }\{
00184       eigen\_assert(m\_isInitialized && \textcolor{stringliteral}{"ComplexEigenSolver is not initialized."});
00185       \textcolor{keywordflow}{return} m\_eivalues;
00186     \}
00187 
00212     \textcolor{keyword}{template}<\textcolor{keyword}{typename} InputType>
00213     \hyperlink{group___eigenvalues___module_class_eigen_1_1_complex_eigen_solver}{ComplexEigenSolver}& \hyperlink{group___eigenvalues___module_aeb7e38c6db5369f5c974f3786e94c1f0}{compute}(\textcolor{keyword}{const} 
      \hyperlink{group___core___module_struct_eigen_1_1_eigen_base}{EigenBase<InputType>}& matrix, \textcolor{keywordtype}{bool} computeEigenvectors = \textcolor{keyword}{true});
00214 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_eigen_solver_8h_source_l00219}\hyperlink{group___eigenvalues___module_ad4d9d8b90145900b9686d2dabbe46730}{00219}     \hyperlink{group__enums_ga85fad7b87587764e5cf6b513a9e0ee5e}{ComputationInfo} \hyperlink{group___eigenvalues___module_ad4d9d8b90145900b9686d2dabbe46730}{info}()\textcolor{keyword}{ const}
00220 \textcolor{keyword}{    }\{
00221       eigen\_assert(m\_isInitialized && \textcolor{stringliteral}{"ComplexEigenSolver is not initialized."});
00222       \textcolor{keywordflow}{return} m\_schur.\hyperlink{group___eigenvalues___module_a8c5ee15fecfd126fc362c3f2fd28f51e}{info}();
00223     \}
00224 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_eigen_solver_8h_source_l00226}\hyperlink{group___eigenvalues___module_a0c5a974da17774d75be41e351e6bda62}{00226}     \hyperlink{group___eigenvalues___module_class_eigen_1_1_complex_eigen_solver}{ComplexEigenSolver}& \hyperlink{group___eigenvalues___module_a0c5a974da17774d75be41e351e6bda62}{setMaxIterations}(Index maxIters)
00227     \{
00228       m\_schur.\hyperlink{group___eigenvalues___module_a6ca227fbd5387f3a625351354b8eec44}{setMaxIterations}(maxIters);
00229       \textcolor{keywordflow}{return} *\textcolor{keyword}{this};
00230     \}
00231 
\Hypertarget{matio_2visual__studio_2test_2eigen_2_eigen_2src_2_eigenvalues_2_complex_eigen_solver_8h_source_l00233}\hyperlink{group___eigenvalues___module_aeec4754e32bf2d1c650bf3aed110c3d3}{00233}     Index \hyperlink{group___eigenvalues___module_aeec4754e32bf2d1c650bf3aed110c3d3}{getMaxIterations}()
00234     \{
00235       \textcolor{keywordflow}{return} m\_schur.\hyperlink{group___eigenvalues___module_a2fc0b7bc409a49e7cdb7b6edcfff26eb}{getMaxIterations}();
00236     \}
00237 
00238   \textcolor{keyword}{protected}:
00239     
00240     \textcolor{keyword}{static} \textcolor{keywordtype}{void} check\_template\_parameters()
00241     \{
00242       EIGEN\_STATIC\_ASSERT\_NON\_INTEGER(Scalar);
00243     \}
00244     
00245     EigenvectorType m\_eivec;
00246     EigenvalueType m\_eivalues;
00247     \hyperlink{group___eigenvalues___module}{ComplexSchur<MatrixType>} m\_schur;
00248     \textcolor{keywordtype}{bool} m\_isInitialized;
00249     \textcolor{keywordtype}{bool} m\_eigenvectorsOk;
00250     EigenvectorType m\_matX;
00251 
00252   \textcolor{keyword}{private}:
00253     \textcolor{keywordtype}{void} doComputeEigenvectors(RealScalar matrixnorm);
00254     \textcolor{keywordtype}{void} sortEigenvalues(\textcolor{keywordtype}{bool} computeEigenvectors);
00255 \};
00256 
00257 
00258 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>
00259 \textcolor{keyword}{template}<\textcolor{keyword}{typename} InputType>
00260 \hyperlink{group___eigenvalues___module_class_eigen_1_1_complex_eigen_solver}{ComplexEigenSolver<MatrixType>}& 
00261 \hyperlink{group___eigenvalues___module_aeb7e38c6db5369f5c974f3786e94c1f0}{ComplexEigenSolver<MatrixType>::compute}(\textcolor{keyword}{const} 
      \hyperlink{group___core___module_struct_eigen_1_1_eigen_base}{EigenBase<InputType>}& matrix, \textcolor{keywordtype}{bool} computeEigenvectors)
00262 \{
00263   check\_template\_parameters();
00264   
00265   \textcolor{comment}{// this code is inspired from Jampack}
00266   eigen\_assert(matrix.\hyperlink{group___core___module_a7b0b45c7351847696c911ce8aa2abbdb}{cols}() == matrix.\hyperlink{group___core___module_a8141320ba8df384426c298b32b000d8e}{rows}());
00267 
00268   \textcolor{comment}{// Do a complex Schur decomposition, A = U T U^*}
00269   \textcolor{comment}{// The eigenvalues are on the diagonal of T.}
00270   m\_schur.\hyperlink{group___eigenvalues___module_a3543d2c286563108cd9ace672bbb1c09}{compute}(matrix.\hyperlink{group___core___module_a324b16961a11d2ecfd2d1b7dd7946545}{derived}(), computeEigenvectors);
00271 
00272   \textcolor{keywordflow}{if}(m\_schur.\hyperlink{group___eigenvalues___module_a8c5ee15fecfd126fc362c3f2fd28f51e}{info}() == \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea52581b035f4b59c203b8ff999ef5fcea}{Success})
00273   \{
00274     m\_eivalues = m\_schur.\hyperlink{group___eigenvalues___module_add3ab5ed83f7f2f06b79fa910a2d5684}{matrixT}().diagonal();
00275     \textcolor{keywordflow}{if}(computeEigenvectors)
00276       doComputeEigenvectors(m\_schur.\hyperlink{group___eigenvalues___module_add3ab5ed83f7f2f06b79fa910a2d5684}{matrixT}().norm());
00277     sortEigenvalues(computeEigenvectors);
00278   \}
00279 
00280   m\_isInitialized = \textcolor{keyword}{true};
00281   m\_eigenvectorsOk = computeEigenvectors;
00282   \textcolor{keywordflow}{return} *\textcolor{keyword}{this};
00283 \}
00284 
00285 
00286 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>
00287 \textcolor{keywordtype}{void} \hyperlink{group___eigenvalues___module_class_eigen_1_1_complex_eigen_solver}{ComplexEigenSolver<MatrixType>::doComputeEigenvectors}
      (RealScalar matrixnorm)
00288 \{
00289   \textcolor{keyword}{const} \hyperlink{group___eigenvalues___module_abc0218d8b902af0d6c759bfc0a8a8d74}{Index} n = m\_eivalues.size();
00290 
00291   matrixnorm = numext::maxi(matrixnorm,(std::numeric\_limits<RealScalar>::min)());
00292 
00293   \textcolor{comment}{// Compute X such that T = X D X^(-1), where D is the diagonal of T.}
00294   \textcolor{comment}{// The matrix X is unit triangular.}
00295   m\_matX = EigenvectorType::Zero(n, n);
00296   \textcolor{keywordflow}{for}(\hyperlink{group___eigenvalues___module_abc0218d8b902af0d6c759bfc0a8a8d74}{Index} k=n-1 ; k>=0 ; k--)
00297   \{
00298     m\_matX.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(k,k) = \hyperlink{group___eigenvalues___module_a3604c99a69fac3bee42c88cb2b589143}{ComplexScalar}(1.0,0.0);
00299     \textcolor{comment}{// Compute X(i,k) using the (i,k) entry of the equation X T = D X}
00300     \textcolor{keywordflow}{for}(\hyperlink{group___eigenvalues___module_abc0218d8b902af0d6c759bfc0a8a8d74}{Index} i=k-1 ; i>=0 ; i--)
00301     \{
00302       m\_matX.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(i,k) = -m\_schur.\hyperlink{group___eigenvalues___module_add3ab5ed83f7f2f06b79fa910a2d5684}{matrixT}().\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(i,k);
00303       \textcolor{keywordflow}{if}(k-i-1>0)
00304         m\_matX.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(i,k) -= (m\_schur.\hyperlink{group___eigenvalues___module_add3ab5ed83f7f2f06b79fa910a2d5684}{matrixT}().row(i).segment(i+1,k-i-1) * m\_matX.col(k)
      .segment(i+1,k-i-1)).value();
00305       \hyperlink{group___eigenvalues___module_a3604c99a69fac3bee42c88cb2b589143}{ComplexScalar} z = m\_schur.\hyperlink{group___eigenvalues___module_add3ab5ed83f7f2f06b79fa910a2d5684}{matrixT}().\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(i,i) - m\_schur.
      \hyperlink{group___eigenvalues___module_add3ab5ed83f7f2f06b79fa910a2d5684}{matrixT}().\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(k,k);
00306       \textcolor{keywordflow}{if}(z==\hyperlink{group___eigenvalues___module_a3604c99a69fac3bee42c88cb2b589143}{ComplexScalar}(0))
00307       \{
00308         \textcolor{comment}{// If the i-th and k-th eigenvalue are equal, then z equals 0.}
00309         \textcolor{comment}{// Use a small value instead, to prevent division by zero.}
00310         numext::real\_ref(z) = \hyperlink{group___core___module_struct_eigen_1_1_num_traits}{NumTraits<RealScalar>::epsilon}() * matrixnorm;
00311       \}
00312       m\_matX.\hyperlink{class_eigen_1_1_plain_object_base_a25626a55b26a4323565f79d1b7c48ea8}{coeffRef}(i,k) = m\_matX.\hyperlink{class_eigen_1_1_plain_object_base_afbfc12954f16d21aedb7bd839f64a278}{coeff}(i,k) / z;
00313     \}
00314   \}
00315 
00316   \textcolor{comment}{// Compute V as V = U X; now A = U T U^* = U X D X^(-1) U^* = V D V^(-1)}
00317   m\_eivec.noalias() = m\_schur.\hyperlink{group___eigenvalues___module_afed8177cf9836f032d42bdb6c6bc6e01}{matrixU}() * m\_matX;
00318   \textcolor{comment}{// .. and normalize the eigenvectors}
00319   \textcolor{keywordflow}{for}(\hyperlink{group___eigenvalues___module_abc0218d8b902af0d6c759bfc0a8a8d74}{Index} k=0 ; k<n ; k++)
00320   \{
00321     m\_eivec.col(k).normalize();
00322   \}
00323 \}
00324 
00325 
00326 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>
00327 \textcolor{keywordtype}{void} \hyperlink{group___eigenvalues___module_class_eigen_1_1_complex_eigen_solver}{ComplexEigenSolver<MatrixType>::sortEigenvalues}(\textcolor{keywordtype}{bool} 
      computeEigenvectors)
00328 \{
00329   \textcolor{keyword}{const} \hyperlink{group___eigenvalues___module_abc0218d8b902af0d6c759bfc0a8a8d74}{Index} n =  m\_eivalues.size();
00330   \textcolor{keywordflow}{for} (\hyperlink{group___eigenvalues___module_abc0218d8b902af0d6c759bfc0a8a8d74}{Index} i=0; i<n; i++)
00331   \{
00332     \hyperlink{group___eigenvalues___module_abc0218d8b902af0d6c759bfc0a8a8d74}{Index} k;
00333     m\_eivalues.cwiseAbs().tail(n-i).minCoeff(&k);
00334     \textcolor{keywordflow}{if} (k != 0)
00335     \{
00336       k += i;
00337       \hyperlink{endian_8c_a3ca5ecd34b04d6a243c054ac3a57f68d}{std::swap}(m\_eivalues[k],m\_eivalues[i]);
00338       \textcolor{keywordflow}{if}(computeEigenvectors)
00339     m\_eivec.col(i).swap(m\_eivec.col(k));
00340     \}
00341   \}
00342 \}
00343 
00344 \} \textcolor{comment}{// end namespace Eigen}
00345 
00346 \textcolor{preprocessor}{#endif // EIGEN\_COMPLEX\_EIGEN\_SOLVER\_H}
\end{DoxyCode}
