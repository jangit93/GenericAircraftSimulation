\hypertarget{_h_d_f5_21_810_81_2_h_d_f5_examples_2_c_2_h5_t_2h5ex__t__convert_8c_source}{}\section{H\+D\+F5/1.10.1/\+H\+D\+F5\+Examples/\+C/\+H5\+T/h5ex\+\_\+t\+\_\+convert.c}
\label{_h_d_f5_21_810_81_2_h_d_f5_examples_2_c_2_h5_t_2h5ex__t__convert_8c_source}\index{h5ex\+\_\+t\+\_\+convert.\+c@{h5ex\+\_\+t\+\_\+convert.\+c}}

\begin{DoxyCode}
00001 \textcolor{comment}{/************************************************************}
00002 \textcolor{comment}{}
00003 \textcolor{comment}{  This example shows how to convert between different}
00004 \textcolor{comment}{  datatypes in memory.  The program converts DIM0 elements}
00005 \textcolor{comment}{  of compound type sourcetype to desttype, then outputs the}
00006 \textcolor{comment}{  converted data to the screen.  A background buffer is used}
00007 \textcolor{comment}{  to fill in the elements of desttype that are not in}
00008 \textcolor{comment}{  sourcetype.}
00009 \textcolor{comment}{}
00010 \textcolor{comment}{  This file is intended for use with HDF5 Library version 1.8}
00011 \textcolor{comment}{}
00012 \textcolor{comment}{ ************************************************************/}
00013 
00014 \textcolor{preprocessor}{#include "hdf5.h"}
00015 \textcolor{preprocessor}{#include <stdio.h>}
00016 \textcolor{preprocessor}{#include <stdlib.h>}
00017 
00018 \textcolor{preprocessor}{#define DIM0            4}
00019 
\Hypertarget{_h_d_f5_21_810_81_2_h_d_f5_examples_2_c_2_h5_t_2h5ex__t__convert_8c_source_l00020}\hyperlink{structreading__t}{00020} \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{
00021     \textcolor{keywordtype}{double}  temperature;
00022     \textcolor{keywordtype}{double}  pressure;
00023 \} \hyperlink{structreading__t}{reading\_t};                                \textcolor{comment}{/* Source type */}
00024 
00025 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{
00026     \textcolor{keywordtype}{int}     serial\_no;
00027     \textcolor{keywordtype}{char}    *location;
00028     \textcolor{keywordtype}{double}  temperature;
00029     \textcolor{keywordtype}{double}  pressure;
00030 \} \hyperlink{structsensor__t}{sensor\_t};                                 \textcolor{comment}{/* Destination type */}
00031 
00032 \textcolor{keywordtype}{int}
00033 main (\textcolor{keywordtype}{void})
00034 \{
00035     hid\_t       sourcetype, desttype, strtype, space;
00036                                             \textcolor{comment}{/* Handles */}
00037     herr\_t      status;
00038     hsize\_t     dims[1] = \{DIM0\};
00039     \hyperlink{structreading__t}{reading\_t}   *reading;                   \textcolor{comment}{/* Conversion buffer */}
00040     \hyperlink{structsensor__t}{sensor\_t}    *sensor,                    \textcolor{comment}{/* Conversion buffer */}
00041                 bkgrd[DIM0];                \textcolor{comment}{/* Background buffer */}
00042     \textcolor{keywordtype}{int}         i;
00043 
00044     \textcolor{comment}{/*}
00045 \textcolor{comment}{     * Allocate memory for conversion buffer.  We will allocate space}
00046 \textcolor{comment}{     * for it to hold DIM0 elements of the destination type, as the}
00047 \textcolor{comment}{     * type conversion is performed in place.  Of course, if the}
00048 \textcolor{comment}{     * destination type were smaller than the source type, we would}
00049 \textcolor{comment}{     * allocate space to hold DIM0 elements of the source type.}
00050 \textcolor{comment}{     */}
00051     reading = (\hyperlink{structreading__t}{reading\_t} *) malloc (DIM0 * \textcolor{keyword}{sizeof} (\hyperlink{structsensor__t}{sensor\_t}));
00052 
00053     \textcolor{comment}{/*}
00054 \textcolor{comment}{     * Assign the allocated space to a pointer of the destination type,}
00055 \textcolor{comment}{     * to allow the buffer to be accessed correctly after the}
00056 \textcolor{comment}{     * conversion has taken place.}
00057 \textcolor{comment}{     */}
00058     sensor = (\hyperlink{structsensor__t}{sensor\_t} *) reading;
00059 
00060     \textcolor{comment}{/*}
00061 \textcolor{comment}{     * Initialize data.}
00062 \textcolor{comment}{     */}
00063     bkgrd[0].serial\_no = 1153;
00064     bkgrd[0].location = \textcolor{stringliteral}{"Exterior (static)"};
00065     bkgrd[0].temperature = 53.23;
00066     bkgrd[0].pressure = 24.57;
00067     bkgrd[1].serial\_no = 1184;
00068     bkgrd[1].location = \textcolor{stringliteral}{"Intake"};
00069     bkgrd[1].temperature = 55.12;
00070     bkgrd[1].pressure = 22.95;
00071     bkgrd[2].serial\_no = 1027;
00072     bkgrd[2].location = \textcolor{stringliteral}{"Intake manifold"};
00073     bkgrd[2].temperature = 103.55;
00074     bkgrd[2].pressure = 31.23;
00075     bkgrd[3].serial\_no = 1313;
00076     bkgrd[3].location = \textcolor{stringliteral}{"Exhaust manifold"};
00077     bkgrd[3].temperature = 1252.89;
00078     bkgrd[3].pressure = 84.11;
00079 
00080     reading[0].temperature = 54.84;
00081     reading[0].pressure = 24.76;
00082     reading[1].temperature = 56.63;
00083     reading[1].pressure = 23.10;
00084     reading[2].temperature = 102.69;
00085     reading[2].pressure = 30.97;
00086     reading[3].temperature = 1238.27;
00087     reading[3].pressure = 82.15;
00088 
00089     \textcolor{comment}{/*}
00090 \textcolor{comment}{     * Create variable-length string datatype.}
00091 \textcolor{comment}{     */}
00092     strtype = H5Tcopy (H5T\_C\_S1);
00093     status = H5Tset\_size (strtype, H5T\_VARIABLE);
00094 
00095     \textcolor{comment}{/*}
00096 \textcolor{comment}{     * Create the compound datatype for memory.}
00097 \textcolor{comment}{     */}
00098     sourcetype = H5Tcreate (H5T\_COMPOUND, \textcolor{keyword}{sizeof} (\hyperlink{structreading__t}{reading\_t}));
00099     status = H5Tinsert (sourcetype, \textcolor{stringliteral}{"Temperature (F)"},
00100                 HOFFSET (\hyperlink{structreading__t}{reading\_t}, temperature), H5T\_NATIVE\_DOUBLE);
00101     status = H5Tinsert (sourcetype, \textcolor{stringliteral}{"Pressure (inHg)"},
00102                 HOFFSET (\hyperlink{structreading__t}{reading\_t}, pressure), H5T\_NATIVE\_DOUBLE);
00103 
00104     desttype = H5Tcreate (H5T\_COMPOUND, \textcolor{keyword}{sizeof} (\hyperlink{structsensor__t}{sensor\_t}));
00105     status = H5Tinsert (desttype, \textcolor{stringliteral}{"Serial number"},
00106                 HOFFSET (\hyperlink{structsensor__t}{sensor\_t}, serial\_no), H5T\_NATIVE\_INT);
00107     status = H5Tinsert (desttype, \textcolor{stringliteral}{"Location"}, HOFFSET (\hyperlink{structsensor__t}{sensor\_t}, location),
00108                 strtype);
00109     status = H5Tinsert (desttype, \textcolor{stringliteral}{"Temperature (F)"},
00110                 HOFFSET (\hyperlink{structsensor__t}{sensor\_t}, temperature), H5T\_NATIVE\_DOUBLE);
00111     status = H5Tinsert (desttype, \textcolor{stringliteral}{"Pressure (inHg)"},
00112                 HOFFSET (\hyperlink{structsensor__t}{sensor\_t}, pressure), H5T\_NATIVE\_DOUBLE);
00113 
00114     \textcolor{comment}{/*}
00115 \textcolor{comment}{     * Create dataspace.  Setting maximum size to NULL sets the maximum}
00116 \textcolor{comment}{     * size to be the current size.}
00117 \textcolor{comment}{     */}
00118     space = H5Screate\_simple (1, dims, NULL);
00119 
00120     \textcolor{comment}{/*}
00121 \textcolor{comment}{     * Convert the buffer in reading from sourcetype to desttype.}
00122 \textcolor{comment}{     * After this conversion we will use sensor to access the buffer,}
00123 \textcolor{comment}{     * as the buffer now matches its type.}
00124 \textcolor{comment}{     */}
00125     status = H5Tconvert (sourcetype, desttype, DIM0, reading, bkgrd,
00126                 H5P\_DEFAULT);
00127 
00128     \textcolor{comment}{/*}
00129 \textcolor{comment}{     * Output the data to the screen.}
00130 \textcolor{comment}{     */}
00131     \textcolor{keywordflow}{for} (i=0; i<DIM0; i++) \{
00132         printf (\textcolor{stringliteral}{"sensor[%d]:\(\backslash\)n"}, i);
00133         printf (\textcolor{stringliteral}{"Serial number   : %d\(\backslash\)n"}, sensor[i].serial\_no);
00134         printf (\textcolor{stringliteral}{"Location        : %s\(\backslash\)n"}, sensor[i].location);
00135         printf (\textcolor{stringliteral}{"Temperature (F) : %f\(\backslash\)n"}, sensor[i].temperature);
00136         printf (\textcolor{stringliteral}{"Pressure (inHg) : %f\(\backslash\)n\(\backslash\)n"}, sensor[i].pressure);
00137     \}
00138 
00139     \textcolor{comment}{/*}
00140 \textcolor{comment}{     * Close and release resources.  In this case H5Tconvert preserves}
00141 \textcolor{comment}{     * the memory locations of the variable-length strings in}
00142 \textcolor{comment}{     * "location", so we do not need to free those strings as they were}
00143 \textcolor{comment}{     * initialized as string constants.}
00144 \textcolor{comment}{     */}
00145     free (sensor);
00146     status = H5Sclose (space);
00147     status = H5Tclose (sourcetype);
00148     status = H5Tclose (desttype);
00149     status = H5Tclose (strtype);
00150 
00151     \textcolor{keywordflow}{return} 0;
00152 \}
\end{DoxyCode}
