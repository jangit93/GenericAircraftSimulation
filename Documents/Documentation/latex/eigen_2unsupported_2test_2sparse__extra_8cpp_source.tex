\hypertarget{eigen_2unsupported_2test_2sparse__extra_8cpp_source}{}\section{eigen/unsupported/test/sparse\+\_\+extra.cpp}
\label{eigen_2unsupported_2test_2sparse__extra_8cpp_source}\index{sparse\+\_\+extra.\+cpp@{sparse\+\_\+extra.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2008-2010 Gael Guennebaud <g.gael@free.fr>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 
00011 \textcolor{comment}{// import basic and product tests for deprectaed DynamicSparseMatrix}
00012 \textcolor{preprocessor}{#define EIGEN\_NO\_DEPRECATED\_WARNING}
00013 \textcolor{preprocessor}{#include "sparse\_basic.cpp"}
00014 \textcolor{preprocessor}{#include "sparse\_product.cpp"}
00015 \textcolor{preprocessor}{#include <Eigen/SparseExtra>}
00016 
00017 \textcolor{keyword}{template}<\textcolor{keyword}{typename} SetterType,\textcolor{keyword}{typename} DenseType, \textcolor{keyword}{typename} Scalar, \textcolor{keywordtype}{int} Options>
00018 \textcolor{keywordtype}{bool} test\_random\_setter(SparseMatrix<Scalar,Options>& sm, \textcolor{keyword}{const} DenseType& ref, \textcolor{keyword}{const} std::vector<Vector2i>
      & nonzeroCoords)
00019 \{
00020   \{
00021     sm.setZero();
00022     SetterType w(sm);
00023     std::vector<Vector2i> remaining = nonzeroCoords;
00024     \textcolor{keywordflow}{while}(!remaining.empty())
00025     \{
00026       \textcolor{keywordtype}{int} i = internal::random<int>(0,\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(remaining.size())-1);
00027       w(remaining[i].x(),remaining[i].y()) = ref.coeff(remaining[i].x(),remaining[i].y());
00028       remaining[i] = remaining.back();
00029       remaining.pop\_back();
00030     \}
00031   \}
00032   \textcolor{keywordflow}{return} sm.isApprox(ref);
00033 \}
00034 
00035 \textcolor{keyword}{template}<\textcolor{keyword}{typename} SetterType,\textcolor{keyword}{typename} DenseType, \textcolor{keyword}{typename} T>
00036 \textcolor{keywordtype}{bool} test\_random\_setter(DynamicSparseMatrix<T>& sm, \textcolor{keyword}{const} DenseType& ref, \textcolor{keyword}{const} std::vector<Vector2i>& 
      nonzeroCoords)
00037 \{
00038   sm.setZero();
00039   std::vector<Vector2i> remaining = nonzeroCoords;
00040   \textcolor{keywordflow}{while}(!remaining.empty())
00041   \{
00042     \textcolor{keywordtype}{int} i = internal::random<int>(0,\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(remaining.size())-1);
00043     sm.coeffRef(remaining[i].x(),remaining[i].y()) = ref.coeff(remaining[i].x(),remaining[i].y());
00044     remaining[i] = remaining.back();
00045     remaining.pop\_back();
00046   \}
00047   \textcolor{keywordflow}{return} sm.isApprox(ref);
00048 \}
00049 
00050 \textcolor{keyword}{template}<\textcolor{keyword}{typename} SparseMatrixType> \textcolor{keywordtype}{void} sparse\_extra(\textcolor{keyword}{const} SparseMatrixType& ref)
00051 \{
00052   \textcolor{keyword}{const} \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} rows = ref.rows();
00053   \textcolor{keyword}{const} \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index} cols = ref.cols();
00054   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} SparseMatrixType::Scalar Scalar;
00055   \textcolor{keyword}{enum} \{ Flags = SparseMatrixType::Flags \};
00056 
00057   \textcolor{keywordtype}{double} density = (std::max)(8./(rows*cols), 0.01);
00058   \textcolor{keyword}{typedef} Matrix<Scalar,Dynamic,Dynamic> \hyperlink{group___core___module}{DenseMatrix};
00059   \textcolor{keyword}{typedef} Matrix<Scalar,Dynamic,1> \hyperlink{group___core___module}{DenseVector};
00060   Scalar eps = 1e-6;
00061 
00062   SparseMatrixType m(rows, cols);
00063   DenseMatrix refMat = DenseMatrix::Zero(rows, cols);
00064   DenseVector vec1 = DenseVector::Random(rows);
00065 
00066   std::vector<Vector2i> zeroCoords;
00067   std::vector<Vector2i> nonzeroCoords;
00068   initSparse<Scalar>(density, refMat, m, 0, &zeroCoords, &nonzeroCoords);
00069 
00070   \textcolor{keywordflow}{if} (zeroCoords.size()==0 || nonzeroCoords.size()==0)
00071     \textcolor{keywordflow}{return};
00072 
00073   \textcolor{comment}{// test coeff and coeffRef}
00074   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0; i<(int)zeroCoords.size(); ++i)
00075   \{
00076     VERIFY\_IS\_MUCH\_SMALLER\_THAN( m.coeff(zeroCoords[i].x(),zeroCoords[i].y()), eps );
00077     \textcolor{keywordflow}{if}(internal::is\_same<SparseMatrixType,SparseMatrix<Scalar,Flags> >::value)
00078       VERIFY\_RAISES\_ASSERT( m.coeffRef(zeroCoords[0].x(),zeroCoords[0].y()) = 5 );
00079   \}
00080   VERIFY\_IS\_APPROX(m, refMat);
00081 
00082   m.coeffRef(nonzeroCoords[0].x(), nonzeroCoords[0].y()) = Scalar(5);
00083   refMat.coeffRef(nonzeroCoords[0].x(), nonzeroCoords[0].y()) = Scalar(5);
00084 
00085   VERIFY\_IS\_APPROX(m, refMat);
00086 
00087   \textcolor{comment}{// random setter}
00088 \textcolor{comment}{//   \{}
00089 \textcolor{comment}{//     m.setZero();}
00090 \textcolor{comment}{//     VERIFY\_IS\_NOT\_APPROX(m, refMat);}
00091 \textcolor{comment}{//     SparseSetter<SparseMatrixType, RandomAccessPattern> w(m);}
00092 \textcolor{comment}{//     std::vector<Vector2i> remaining = nonzeroCoords;}
00093 \textcolor{comment}{//     while(!remaining.empty())}
00094 \textcolor{comment}{//     \{}
00095 \textcolor{comment}{//       int i = internal::random<int>(0,remaining.size()-1);}
00096 \textcolor{comment}{//       w->coeffRef(remaining[i].x(),remaining[i].y()) = refMat.coeff(remaining[i].x(),remaining[i].y());}
00097 \textcolor{comment}{//       remaining[i] = remaining.back();}
00098 \textcolor{comment}{//       remaining.pop\_back();}
00099 \textcolor{comment}{//     \}}
00100 \textcolor{comment}{//   \}}
00101 \textcolor{comment}{//   VERIFY\_IS\_APPROX(m, refMat);}
00102 
00103     VERIFY(( test\_random\_setter<RandomSetter<SparseMatrixType, StdMapTraits> >(m,refMat,nonzeroCoords) ));
00104 \textcolor{preprocessor}{    #ifdef EIGEN\_UNORDERED\_MAP\_SUPPORT}
00105     VERIFY(( test\_random\_setter<RandomSetter<SparseMatrixType, StdUnorderedMapTraits> >(m,refMat,
      nonzeroCoords) ));
00106 \textcolor{preprocessor}{    #endif}
00107 \textcolor{preprocessor}{    #ifdef \_DENSE\_HASH\_MAP\_H\_}
00108     VERIFY(( test\_random\_setter<RandomSetter<SparseMatrixType, GoogleDenseHashMapTraits> >(m,refMat,
      nonzeroCoords) ));
00109 \textcolor{preprocessor}{    #endif}
00110 \textcolor{preprocessor}{    #ifdef \_SPARSE\_HASH\_MAP\_H\_}
00111     VERIFY(( test\_random\_setter<RandomSetter<SparseMatrixType, GoogleSparseHashMapTraits> >(m,refMat,
      nonzeroCoords) ));
00112 \textcolor{preprocessor}{    #endif}
00113 
00114 
00115   \textcolor{comment}{// test RandomSetter}
00116   \textcolor{comment}{/*\{}
00117 \textcolor{comment}{    SparseMatrixType m1(rows,cols), m2(rows,cols);}
00118 \textcolor{comment}{    DenseMatrix refM1 = DenseMatrix::Zero(rows, rows);}
00119 \textcolor{comment}{    initSparse<Scalar>(density, refM1, m1);}
00120 \textcolor{comment}{    \{}
00121 \textcolor{comment}{      Eigen::RandomSetter<SparseMatrixType > setter(m2);}
00122 \textcolor{comment}{      for (int j=0; j<m1.outerSize(); ++j)}
00123 \textcolor{comment}{        for (typename SparseMatrixType::InnerIterator i(m1,j); i; ++i)}
00124 \textcolor{comment}{          setter(i.index(), j) = i.value();}
00125 \textcolor{comment}{    \}}
00126 \textcolor{comment}{    VERIFY\_IS\_APPROX(m1, m2);}
00127 \textcolor{comment}{  \}*/}
00128 
00129 
00130 \}
00131 
00132 \textcolor{keywordtype}{void} test\_sparse\_extra()
00133 \{
00134   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 0; i < g\_repeat; i++) \{
00135     \textcolor{keywordtype}{int} s = Eigen::internal::random<int>(1,50);
00136     CALL\_SUBTEST\_1( sparse\_extra(SparseMatrix<double>(8, 8)) );
00137     CALL\_SUBTEST\_2( sparse\_extra(SparseMatrix<std::complex<double> >(s, s)) );
00138     CALL\_SUBTEST\_1( sparse\_extra(SparseMatrix<double>(s, s)) );
00139 
00140     CALL\_SUBTEST\_3( sparse\_extra(DynamicSparseMatrix<double>(s, s)) );
00141 \textcolor{comment}{//    CALL\_SUBTEST\_3(( sparse\_basic(DynamicSparseMatrix<double>(s, s)) ));}
00142 \textcolor{comment}{//    CALL\_SUBTEST\_3(( sparse\_basic(DynamicSparseMatrix<double,ColMajor,long int>(s, s)) ));}
00143 
00144     CALL\_SUBTEST\_3( (sparse\_product<DynamicSparseMatrix<float, ColMajor> >()) );
00145     CALL\_SUBTEST\_3( (sparse\_product<DynamicSparseMatrix<float, RowMajor> >()) );
00146   \}
00147 \}
\end{DoxyCode}
