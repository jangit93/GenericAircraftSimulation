\hypertarget{_h_d_f5_21_810_81_2_h_d_f5_examples_2_f_o_r_t_r_a_n_2_h5_d_2h5ex__d__alloc_8f90_source}{}\section{H\+D\+F5/1.10.1/\+H\+D\+F5\+Examples/\+F\+O\+R\+T\+R\+A\+N/\+H5\+D/h5ex\+\_\+d\+\_\+alloc.f90}
\label{_h_d_f5_21_810_81_2_h_d_f5_examples_2_f_o_r_t_r_a_n_2_h5_d_2h5ex__d__alloc_8f90_source}\index{h5ex\+\_\+d\+\_\+alloc.\+f90@{h5ex\+\_\+d\+\_\+alloc.\+f90}}

\begin{DoxyCode}
00001 \textcolor{comment}{! ***********************************************************}
00002 \textcolor{comment}{!}
00003 \textcolor{comment}{!  this example shows how to set the space allocation time}
00004 \textcolor{comment}{!  for a dataset.  the program first creates two datasets,}
00005 \textcolor{comment}{!  one with the default allocation time (late) and one with}
00006 \textcolor{comment}{!  early allocation time, and displays whether each has been}
00007 \textcolor{comment}{!  allocated and their allocation size.  next, it writes data}
00008 \textcolor{comment}{!  to the datasets, and again displays whether each has been}
00009 \textcolor{comment}{!  allocated and their allocation size.}
00010 \textcolor{comment}{!}
00011 \textcolor{comment}{!  this file is intended for use with hdf5 library verion 1.8}
00012 \textcolor{comment}{!}
00013 \textcolor{comment}{! ***********************************************************}
00014 
00015 \textcolor{keyword}{PROGRAM} main
00016 
00017   \textcolor{keywordtype}{USE }hdf5
00018 
00019   \textcolor{keywordtype}{IMPLICIT NONE}
00020 
00021   \textcolor{keywordtype}{CHARACTER(LEN=15)}, \textcolor{keywordtype}{PARAMETER} :: filename = \textcolor{stringliteral}{"h5ex\_d\_alloc.h5"}
00022   \textcolor{keywordtype}{CHARACTER(LEN=3)} , \textcolor{keywordtype}{PARAMETER} :: dataset1 = \textcolor{stringliteral}{"DS1"}
00023   \textcolor{keywordtype}{CHARACTER(LEN=3)} , \textcolor{keywordtype}{PARAMETER} :: dataset2 = \textcolor{stringliteral}{"DS2"}
00024   \textcolor{keywordtype}{INTEGER}          , \textcolor{keywordtype}{PARAMETER} :: dim0     = 4
00025   \textcolor{keywordtype}{INTEGER}          , \textcolor{keywordtype}{PARAMETER} :: dim1     = 7
00026   \textcolor{keywordtype}{INTEGER}          , \textcolor{keywordtype}{PARAMETER} :: fillval  = 99
00027   \textcolor{keywordtype}{INTEGER}          , \textcolor{keywordtype}{PARAMETER} :: rank     = 2
00028 
00029   \textcolor{keywordtype}{INTEGER} :: space\_status
00030   \textcolor{keywordtype}{INTEGER} :: i, j
00031   \textcolor{keywordtype}{INTEGER} :: hdferr
00032   \textcolor{keywordtype}{INTEGER(HID\_T)}   :: \hyperlink{structfile}{file}, space, dset1, dset2, dcpl \textcolor{comment}{! handles}
00033   \textcolor{keywordtype}{INTEGER(HSIZE\_T)} :: storage\_size
00034   \textcolor{keywordtype}{INTEGER(HSIZE\_T)}, \textcolor{keywordtype}{DIMENSION(1:2)}           :: dims = (/dim0, dim1/) \textcolor{comment}{! size write buffer}
00035   \textcolor{keywordtype}{INTEGER}         , \textcolor{keywordtype}{DIMENSION(1:dim0,1:dim1)} :: wdata \textcolor{comment}{! write buffer}
00036   \textcolor{comment}{!}
00037   \textcolor{comment}{! Initialize FORTRAN interface.}
00038   \textcolor{comment}{!}
00039   \textcolor{keyword}{CALL }h5open\_f(hdferr)
00040   \textcolor{comment}{!}
00041   \textcolor{comment}{! Initialize data.}
00042   \textcolor{comment}{!}
00043   \textcolor{keywordflow}{DO} i = 1, dim0
00044      \textcolor{keywordflow}{DO} j = 1, dim1
00045         wdata(i,j) = i*j-j
00046 \textcolor{keywordflow}{     ENDDO}
00047 \textcolor{keywordflow}{  ENDDO}
00048   \textcolor{comment}{!}
00049   \textcolor{comment}{! Create a new file using the default properties.}
00050   \textcolor{comment}{!}
00051   \textcolor{keyword}{CALL }h5fcreate\_f(filename, h5f\_acc\_trunc\_f, \hyperlink{structfile}{file}, hdferr)
00052   \textcolor{comment}{!}
00053   \textcolor{comment}{! Create dataspace. }
00054   \textcolor{comment}{!}
00055   \textcolor{keyword}{CALL }h5screate\_simple\_f(rank, dims, space, hdferr)
00056   \textcolor{comment}{!}
00057   \textcolor{comment}{! Create the dataset creation property list, and set the chunk size.}
00058   \textcolor{comment}{!}
00059   \textcolor{keyword}{CALL }h5pcreate\_f(h5p\_dataset\_create\_f, dcpl, hdferr)
00060   \textcolor{comment}{!}
00061   \textcolor{comment}{! Set the allocation time to "early".  This way we can be sure}
00062   \textcolor{comment}{! that reading from the dataset immediately after creation will}
00063   \textcolor{comment}{! return the fill value.}
00064   \textcolor{comment}{!}
00065   \textcolor{keyword}{CALL }h5pset\_alloc\_time\_f(dcpl, h5d\_alloc\_time\_early\_f,hdferr)
00066   \textcolor{comment}{!}
00067   \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'(/,"Creating datasets...",/)'}) 
00068   \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'(A," has allocation time H5D\_ALLOC\_TIME\_LATE\_F")'}) dataset1
00069   \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'(A," has allocation time H5D\_ALLOC\_TIME\_EARLY\_F"/)'}) dataset2
00070   \textcolor{comment}{!}
00071   \textcolor{comment}{! Create the dataset using the dataset creation property list.}
00072   \textcolor{comment}{!}
00073   \textcolor{keyword}{CALL }h5dcreate\_f(\hyperlink{structfile}{file}, dataset1, h5t\_std\_i32le, space, dset1, hdferr)
00074   \textcolor{keyword}{CALL }h5dcreate\_f(\hyperlink{structfile}{file}, dataset2, h5t\_std\_i32le, space, dset2, hdferr, dcpl)
00075   \textcolor{comment}{! }
00076   \textcolor{comment}{! Retrieve and print space status and storage size for dset1.}
00077   \textcolor{comment}{!}
00078   storage\_size = 0
00079   \textcolor{keyword}{CALL }h5dget\_space\_status\_f(dset1, space\_status, hdferr)
00080   \textcolor{keyword}{CALL }h5dget\_storage\_size\_f(dset1, storage\_size, hdferr)
00081   \textcolor{comment}{!}
00082   \textcolor{keywordflow}{IF}(space\_status.EQ.h5d\_space\_sts\_allocated\_f)\textcolor{keywordflow}{THEN}
00083      \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'("Space for ",A," has been allocated.")'}) dataset1
00084   \textcolor{keywordflow}{ELSE}
00085      \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'("Space for ",A," has not been allocated.")'}) dataset1
00086 \textcolor{keywordflow}{  END IF}
00087   \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'("Storage size for ",A," is: ",I3," bytes.")'}) dataset1, storage\_size
00088   \textcolor{comment}{!}
00089   \textcolor{comment}{! Retrieve and print space status and storage size for dset2.}
00090   \textcolor{comment}{!}
00091   \textcolor{keyword}{CALL }h5dget\_space\_status\_f(dset2, space\_status, hdferr)
00092   \textcolor{keyword}{CALL }h5dget\_storage\_size\_f(dset2, storage\_size, hdferr)
00093   \textcolor{comment}{!}
00094   \textcolor{keywordflow}{IF}(space\_status.EQ.h5d\_space\_sts\_allocated\_f)\textcolor{keywordflow}{THEN}
00095      \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'("Space for ",A," has been allocated.")'}) dataset2
00096   \textcolor{keywordflow}{ELSE}
00097      \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'("Space for ",A," has not been allocated.")'}) dataset2
00098 \textcolor{keywordflow}{  END IF}
00099   \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'("Storage size for ",A," is: ",I3," bytes.")'}) dataset2, storage\_size
00100   \textcolor{comment}{!}
00101   \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'(/,"Writing data...",/)'})
00102   \textcolor{comment}{!}
00103   \textcolor{comment}{! Write the data to the datasets.}
00104   \textcolor{comment}{!}
00105   \textcolor{keyword}{CALL }h5dwrite\_f(dset1, h5t\_native\_integer, wdata, dims, hdferr)
00106   \textcolor{keyword}{CALL }h5dwrite\_f(dset2, h5t\_native\_integer, wdata, dims, hdferr)
00107   \textcolor{comment}{!}
00108   \textcolor{comment}{! Retrieve and print space status and storage size for dset1.}
00109   \textcolor{comment}{!}
00110   \textcolor{keyword}{CALL }h5dget\_space\_status\_f(dset1, space\_status, hdferr)
00111   \textcolor{keyword}{CALL }h5dget\_storage\_size\_f(dset1, storage\_size, hdferr)
00112   \textcolor{comment}{!}
00113   \textcolor{keywordflow}{IF}(space\_status.EQ.h5d\_space\_sts\_allocated\_f)\textcolor{keywordflow}{THEN}
00114      \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'("Space for ",A," has been allocated.")'}) dataset1
00115   \textcolor{keywordflow}{ELSE}
00116      \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'("Space for ",A," has not been allocated.")'}) dataset1
00117 \textcolor{keywordflow}{  END IF}
00118   \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'("Storage size for ",A," is: ",I3," bytes.")'}) dataset1, storage\_size
00119   \textcolor{comment}{!}
00120   \textcolor{comment}{! Retrieve and print space status and storage size for dset2.}
00121   \textcolor{comment}{!}
00122   \textcolor{keyword}{CALL }h5dget\_space\_status\_f(dset2, space\_status, hdferr)
00123   \textcolor{keyword}{CALL }h5dget\_storage\_size\_f(dset2, storage\_size, hdferr)
00124   \textcolor{comment}{!}
00125   \textcolor{keywordflow}{IF}(space\_status.EQ.h5d\_space\_sts\_allocated\_f)\textcolor{keywordflow}{THEN}
00126      \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'("Space for ",A," has been allocated.")'}) dataset2
00127   \textcolor{keywordflow}{ELSE}
00128      \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'("Space for ",A," has not been allocated.")'}) dataset2
00129 \textcolor{keywordflow}{  END IF}
00130   \textcolor{keyword}{WRITE}(*,\textcolor{stringliteral}{'("Storage size for ",A," is: ",I3," bytes.",/)'}) dataset2, storage\_size
00131   \textcolor{comment}{!}
00132   \textcolor{comment}{! Close and release resources.}
00133   \textcolor{comment}{!}
00134   \textcolor{keyword}{CALL }h5pclose\_f(dcpl , hdferr)
00135   \textcolor{keyword}{CALL }h5dclose\_f(dset1, hdferr)
00136   \textcolor{keyword}{CALL }h5dclose\_f(dset2, hdferr)
00137   \textcolor{keyword}{CALL }h5sclose\_f(space, hdferr)
00138   \textcolor{keyword}{CALL }h5fclose\_f(\hyperlink{structfile}{file} , hdferr)
00139   \textcolor{comment}{!}
00140 \textcolor{keyword}{END PROGRAM }main
\end{DoxyCode}
