\hypertarget{matio_2visual__studio_2test_2eigen_2bench_2basicbenchmark_8h_source}{}\section{matio/visual\+\_\+studio/test/eigen/bench/basicbenchmark.h}
\label{matio_2visual__studio_2test_2eigen_2bench_2basicbenchmark_8h_source}\index{basicbenchmark.\+h@{basicbenchmark.\+h}}

\begin{DoxyCode}
00001 
00002 \textcolor{preprocessor}{#ifndef EIGEN\_BENCH\_BASICBENCH\_H}
00003 \textcolor{preprocessor}{#define EIGEN\_BENCH\_BASICBENCH\_H}
00004 
00005 \textcolor{keyword}{enum} \{LazyEval, EarlyEval, OmpEval\};
00006 
00007 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} Mode, \textcolor{keyword}{typename} MatrixType>
00008 \textcolor{keywordtype}{void} benchBasic\_loop(\textcolor{keyword}{const} MatrixType& I, MatrixType& m, \textcolor{keywordtype}{int} iterations) \_\_attribute\_\_((noinline));
00009 
00010 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} Mode, \textcolor{keyword}{typename} MatrixType>
00011 \textcolor{keywordtype}{void} benchBasic\_loop(\textcolor{keyword}{const} MatrixType& I, MatrixType& m, \textcolor{keywordtype}{int} iterations)
00012 \{
00013   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} a = 0; a < iterations; a++)
00014   \{
00015     \textcolor{keywordflow}{if} (Mode==LazyEval)
00016     \{
00017       \textcolor{keyword}{asm}(\textcolor{stringliteral}{"#begin\_bench\_loop LazyEval"});
00018       \textcolor{keywordflow}{if} (MatrixType::SizeAtCompileTime!=\hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Eigen::Dynamic}) \textcolor{keyword}{asm}(\textcolor{stringliteral}{"#fixedsize"});
00019       m = (I + 0.00005 * (m + m.lazy() * m)).eval();
00020     \}
00021     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (Mode==OmpEval)
00022     \{
00023       \textcolor{keyword}{asm}(\textcolor{stringliteral}{"#begin\_bench\_loop OmpEval"});
00024       \textcolor{keywordflow}{if} (MatrixType::SizeAtCompileTime!=\hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Eigen::Dynamic}) \textcolor{keyword}{asm}(\textcolor{stringliteral}{"#fixedsize"});
00025       m = (I + 0.00005 * (m + m.lazy() * m)).evalOMP();
00026     \}
00027     \textcolor{keywordflow}{else}
00028     \{
00029       \textcolor{keyword}{asm}(\textcolor{stringliteral}{"#begin\_bench\_loop EarlyEval"});
00030       \textcolor{keywordflow}{if} (MatrixType::SizeAtCompileTime!=\hyperlink{namespace_eigen_ad81fa7195215a0ce30017dfac309f0b2}{Eigen::Dynamic}) \textcolor{keyword}{asm}(\textcolor{stringliteral}{"#fixedsize"});
00031       m = I + 0.00005 * (m + m * m);
00032     \}
00033     \textcolor{keyword}{asm}(\textcolor{stringliteral}{"#end\_bench\_loop"});
00034   \}
00035 \}
00036 
00037 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} Mode, \textcolor{keyword}{typename} MatrixType>
00038 \textcolor{keywordtype}{double} benchBasic(\textcolor{keyword}{const} MatrixType& mat, \textcolor{keywordtype}{int} size, \textcolor{keywordtype}{int} tries) \_\_attribute\_\_((noinline));
00039 
00040 \textcolor{keyword}{template}<\textcolor{keywordtype}{int} Mode, \textcolor{keyword}{typename} MatrixType>
00041 \textcolor{keywordtype}{double} benchBasic(\textcolor{keyword}{const} MatrixType& mat, \textcolor{keywordtype}{int} iterations, \textcolor{keywordtype}{int} tries)
00042 \{
00043   \textcolor{keyword}{const} \textcolor{keywordtype}{int} rows = mat.rows();
00044   \textcolor{keyword}{const} \textcolor{keywordtype}{int} cols = mat.cols();
00045 
00046   MatrixType I(rows,cols);
00047   MatrixType m(rows,cols);
00048 
00049   initMatrix\_identity(I);
00050 
00051   \hyperlink{class_eigen_1_1_bench_timer}{Eigen::BenchTimer} timer;
00052   \textcolor{keywordflow}{for}(uint t=0; t<tries; ++t)
00053   \{
00054     initMatrix\_random(m);
00055     timer.start();
00056     benchBasic\_loop<Mode>(I, m, iterations);
00057     timer.stop();
00058     cerr << m;
00059   \}
00060   \textcolor{keywordflow}{return} timer.\hyperlink{class_eigen_1_1_bench_timer_a26760f963ed8b64c126159bfea57735e}{value}();
00061 \};
00062 
00063 \textcolor{preprocessor}{#endif // EIGEN\_BENCH\_BASICBENCH\_H}
\end{DoxyCode}
