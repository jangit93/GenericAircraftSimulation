\hypertarget{eigen_2test_2schur__real_8cpp_source}{}\section{eigen/test/schur\+\_\+real.cpp}
\label{eigen_2test_2schur__real_8cpp_source}\index{schur\+\_\+real.\+cpp@{schur\+\_\+real.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}
00002 \textcolor{comment}{// for linear algebra.}
00003 \textcolor{comment}{//}
00004 \textcolor{comment}{// Copyright (C) 2010,2012 Jitse Niesen <jitse@maths.leeds.ac.uk>}
00005 \textcolor{comment}{//}
00006 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}
00007 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}
00008 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}
00009 
00010 \textcolor{preprocessor}{#include "main.h"}
00011 \textcolor{preprocessor}{#include <limits>}
00012 \textcolor{preprocessor}{#include <Eigen/Eigenvalues>}
00013 
00014 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType> \textcolor{keywordtype}{void} verifyIsQuasiTriangular(\textcolor{keyword}{const} MatrixType& \hyperlink{group___sparse_core___module}{T})
00015 \{
00016   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::Index \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index};
00017 
00018   \textcolor{keyword}{const} Index size = T.cols();
00019   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::Scalar Scalar;
00020 
00021   \textcolor{comment}{// Check T is lower Hessenberg}
00022   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} row = 2; row < size; ++row) \{
00023     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} col = 0; col < row - 1; ++col) \{
00024       VERIFY(T(row,col) == Scalar(0));
00025     \}
00026   \}
00027 
00028   \textcolor{comment}{// Check that any non-zero on the subdiagonal is followed by a zero and is}
00029   \textcolor{comment}{// part of a 2x2 diagonal block with imaginary eigenvalues.}
00030   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} row = 1; row < size; ++row) \{
00031     \textcolor{keywordflow}{if} (T(row,row-1) != Scalar(0)) \{
00032       VERIFY(row == size-1 || T(row+1,row) == 0);
00033       Scalar tr = T(row-1,row-1) + T(row,row);
00034       Scalar det = T(row-1,row-1) * T(row,row) - T(row-1,row) * T(row,row-1);
00035       VERIFY(4 * det > tr * tr);
00036     \}
00037   \}
00038 \}
00039 
00040 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType> \textcolor{keywordtype}{void} schur(\textcolor{keywordtype}{int} size = MatrixType::ColsAtCompileTime)
00041 \{
00042   \textcolor{comment}{// Test basic functionality: T is quasi-triangular and A = U T U*}
00043   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} counter = 0; counter < g\_repeat; ++counter) \{
00044     MatrixType \hyperlink{group___core___module_class_eigen_1_1_matrix}{A} = MatrixType::Random(size, size);
00045     \hyperlink{group___eigenvalues___module}{RealSchur<MatrixType>} schurOfA(A);
00046     VERIFY\_IS\_EQUAL(schurOfA.info(), \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea52581b035f4b59c203b8ff999ef5fcea}{Success});
00047     MatrixType U = schurOfA.matrixU();
00048     MatrixType T = schurOfA.matrixT();
00049     verifyIsQuasiTriangular(T);
00050     VERIFY\_IS\_APPROX(A, U * T * U.transpose());
00051   \}
00052 
00053   \textcolor{comment}{// Test asserts when not initialized}
00054   \hyperlink{group___eigenvalues___module}{RealSchur<MatrixType>} rsUninitialized;
00055   VERIFY\_RAISES\_ASSERT(rsUninitialized.matrixT());
00056   VERIFY\_RAISES\_ASSERT(rsUninitialized.matrixU());
00057   VERIFY\_RAISES\_ASSERT(rsUninitialized.info());
00058   
00059   \textcolor{comment}{// Test whether compute() and constructor returns same result}
00060   MatrixType A = MatrixType::Random(size, size);
00061   \hyperlink{group___eigenvalues___module}{RealSchur<MatrixType>} rs1;
00062   rs1.\hyperlink{group___eigenvalues___module_a60caf9ffad11d728ea458c4dd36d0a98}{compute}(A);
00063   \hyperlink{group___eigenvalues___module}{RealSchur<MatrixType>} rs2(A);
00064   VERIFY\_IS\_EQUAL(rs1.\hyperlink{group___eigenvalues___module_a386fd2b1a3a8401eca7183ac074deec8}{info}(), \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea52581b035f4b59c203b8ff999ef5fcea}{Success});
00065   VERIFY\_IS\_EQUAL(rs2.info(), \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea52581b035f4b59c203b8ff999ef5fcea}{Success});
00066   VERIFY\_IS\_EQUAL(rs1.\hyperlink{group___eigenvalues___module_abb78996b43b8642a5f507415730445cb}{matrixT}(), rs2.matrixT());
00067   VERIFY\_IS\_EQUAL(rs1.\hyperlink{group___eigenvalues___module_a85622ccbecff99c8933d21f0a22b22bb}{matrixU}(), rs2.matrixU());
00068 
00069   \textcolor{comment}{// Test maximum number of iterations}
00070   \hyperlink{group___eigenvalues___module}{RealSchur<MatrixType>} rs3;
00071   rs3.\hyperlink{group___eigenvalues___module_ad189e8776ee20a12046694f98b354322}{setMaxIterations}(
      \hyperlink{group___eigenvalues___module_class_eigen_1_1_real_schur}{RealSchur<MatrixType>::m\_maxIterationsPerRow} * size).
      \hyperlink{group___eigenvalues___module_a60caf9ffad11d728ea458c4dd36d0a98}{compute}(A);
00072   VERIFY\_IS\_EQUAL(rs3.info(), \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea52581b035f4b59c203b8ff999ef5fcea}{Success});
00073   VERIFY\_IS\_EQUAL(rs3.matrixT(), rs1.\hyperlink{group___eigenvalues___module_abb78996b43b8642a5f507415730445cb}{matrixT}());
00074   VERIFY\_IS\_EQUAL(rs3.matrixU(), rs1.\hyperlink{group___eigenvalues___module_a85622ccbecff99c8933d21f0a22b22bb}{matrixU}());
00075   \textcolor{keywordflow}{if} (size > 2) \{
00076     rs3.setMaxIterations(1).compute(A);
00077     VERIFY\_IS\_EQUAL(rs3.info(), \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5eaba1c8763d1179778070f365ecc4157a8}{NoConvergence});
00078     VERIFY\_IS\_EQUAL(rs3.getMaxIterations(), 1);
00079   \}
00080 
00081   MatrixType Atriangular = A;
00082   Atriangular.template triangularView<StrictlyLower>().setZero(); 
00083   rs3.setMaxIterations(1).compute(Atriangular); \textcolor{comment}{// triangular matrices do not need any iterations}
00084   VERIFY\_IS\_EQUAL(rs3.info(), \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea52581b035f4b59c203b8ff999ef5fcea}{Success});
00085   VERIFY\_IS\_APPROX(rs3.matrixT(), Atriangular); \textcolor{comment}{// approx because of scaling...}
00086   VERIFY\_IS\_EQUAL(rs3.matrixU(), MatrixType::Identity(size, size));
00087 
00088   \textcolor{comment}{// Test computation of only T, not U}
00089   \hyperlink{group___eigenvalues___module}{RealSchur<MatrixType>} rsOnlyT(A, \textcolor{keyword}{false});
00090   VERIFY\_IS\_EQUAL(rsOnlyT.info(), \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea52581b035f4b59c203b8ff999ef5fcea}{Success});
00091   VERIFY\_IS\_EQUAL(rs1.\hyperlink{group___eigenvalues___module_abb78996b43b8642a5f507415730445cb}{matrixT}(), rsOnlyT.matrixT());
00092   VERIFY\_RAISES\_ASSERT(rsOnlyT.matrixU());
00093 
00094   \textcolor{keywordflow}{if} (size > 2 && size < 20)
00095   \{
00096     \textcolor{comment}{// Test matrix with NaN}
00097     A(0,0) = std::numeric\_limits<typename MatrixType::Scalar>::quiet\_NaN();
00098     \hyperlink{group___eigenvalues___module}{RealSchur<MatrixType>} rsNaN(A);
00099     VERIFY\_IS\_EQUAL(rsNaN.info(), \hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5eaba1c8763d1179778070f365ecc4157a8}{NoConvergence});
00100   \}
00101 \}
00102 
00103 \textcolor{keywordtype}{void} test\_schur\_real()
00104 \{
00105   CALL\_SUBTEST\_1(( schur<Matrix4f>() ));
00106   CALL\_SUBTEST\_2(( schur<MatrixXd>(internal::random<int>(1,EIGEN\_TEST\_MAX\_SIZE/4)) ));
00107   CALL\_SUBTEST\_3(( schur<\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<float, 1, 1>} >() ));
00108   CALL\_SUBTEST\_4(( schur<\hyperlink{group___core___module_class_eigen_1_1_matrix}{Matrix<double, 3, 3, Eigen::RowMajor>} >() ));
00109 
00110   \textcolor{comment}{// Test problem size constructors}
00111   CALL\_SUBTEST\_5(\hyperlink{group___eigenvalues___module_class_eigen_1_1_real_schur}{RealSchur<MatrixXf>}(10));
00112 \}
\end{DoxyCode}
