\hypertarget{_h_d_f5_21_810_81_2include_2_h5_cpkg_8h_source}{}\section{H\+D\+F5/1.10.1/include/\+H5\+Cpkg.h}
\label{_h_d_f5_21_810_81_2include_2_h5_cpkg_8h_source}\index{H5\+Cpkg.\+h@{H5\+Cpkg.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *}
00002 \textcolor{comment}{ * Copyright by The HDF Group.                                               *}
00003 \textcolor{comment}{ * Copyright by the Board of Trustees of the University of Illinois.         *}
00004 \textcolor{comment}{ * All rights reserved.                                                      *}
00005 \textcolor{comment}{ *                                                                           *}
00006 \textcolor{comment}{ * This file is part of HDF5.  The full HDF5 copyright notice, including     *}
00007 \textcolor{comment}{ * terms governing use, modification, and redistribution, is contained in    *}
00008 \textcolor{comment}{ * the COPYING file, which can be found at the root of the source code       *}
00009 \textcolor{comment}{ * distribution tree, or in https://support.hdfgroup.org/ftp/HDF5/releases.  *}
00010 \textcolor{comment}{ * If you do not have access to either file, you may request a copy from     *}
00011 \textcolor{comment}{ * help@hdfgroup.org.                                                        *}
00012 \textcolor{comment}{ * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */}
00013 
00014 \textcolor{comment}{/*}
00015 \textcolor{comment}{ * Programmer: John Mainzer -- 10/12/04}
00016 \textcolor{comment}{ *}
00017 \textcolor{comment}{ * Purpose:     This file contains declarations which are normally visible}
00018 \textcolor{comment}{ *              only within the H5C package.}
00019 \textcolor{comment}{ *}
00020 \textcolor{comment}{ *      Source files outside the H5C package should include}
00021 \textcolor{comment}{ *      H5Cprivate.h instead.}
00022 \textcolor{comment}{ *}
00023 \textcolor{comment}{ *      The one exception to this rule is test/cache.c.  The test}
00024 \textcolor{comment}{ *      code is easier to write if it can look at the cache's}
00025 \textcolor{comment}{ *      internal data structures.  Indeed, this is the main}
00026 \textcolor{comment}{ *      reason why this file was created.}
00027 \textcolor{comment}{ */}
00028 
00029 \textcolor{preprocessor}{#if !(defined H5C\_FRIEND || defined H5C\_MODULE)}
00030 \textcolor{preprocessor}{#error "Do not include this file outside the H5C package!"}
00031 \textcolor{preprocessor}{#endif}
00032 
00033 \textcolor{preprocessor}{#ifndef \_H5Cpkg\_H}
00034 \textcolor{preprocessor}{#define \_H5Cpkg\_H}
00035 
00036 \textcolor{comment}{/* Get package's private header */}
00037 \textcolor{preprocessor}{#include "H5Cprivate.h"}
00038 
00039 \textcolor{comment}{/* Other private headers needed by this file */}
00040 \textcolor{preprocessor}{#include "H5SLprivate.h"}        \textcolor{comment}{/* Skip lists */}
00041 
00042 \textcolor{comment}{/**************************/}
00043 \textcolor{comment}{/* Package Private Macros */}
00044 \textcolor{comment}{/**************************/}
00045 
00046 \textcolor{comment}{/* Number of epoch markers active */}
00047 \textcolor{preprocessor}{#define H5C\_\_MAX\_EPOCH\_MARKERS                  10}
00048 
00049 \textcolor{comment}{/* Cache configuration settings */}
00050 \textcolor{preprocessor}{#define H5C\_\_HASH\_TABLE\_LEN     (64 * 1024) }\textcolor{comment}{/* must be a power of 2 */}\textcolor{preprocessor}{}
00051 \textcolor{preprocessor}{#define H5C\_\_H5C\_T\_MAGIC    0x005CAC0E}
00052 
00053 \textcolor{comment}{/* Initial allocated size of the "flush\_dep\_parent" array */}
00054 \textcolor{preprocessor}{#define H5C\_FLUSH\_DEP\_PARENT\_INIT 8}
00055 
00056 \textcolor{comment}{/****************************************************************************}
00057 \textcolor{comment}{ *}
00058 \textcolor{comment}{ * We maintain doubly linked lists of instances of H5C\_cache\_entry\_t for a}
00059 \textcolor{comment}{ * variety of reasons -- protected list, LRU list, and the clean and dirty}
00060 \textcolor{comment}{ * LRU lists at present.  The following macros support linking and unlinking}
00061 \textcolor{comment}{ * of instances of H5C\_cache\_entry\_t by both their regular and auxilary next}
00062 \textcolor{comment}{ * and previous pointers.}
00063 \textcolor{comment}{ *}
00064 \textcolor{comment}{ * The size and length fields are also maintained.}
00065 \textcolor{comment}{ *}
00066 \textcolor{comment}{ * Note that the relevant pair of prev and next pointers are presumed to be}
00067 \textcolor{comment}{ * NULL on entry in the insertion macros.}
00068 \textcolor{comment}{ *}
00069 \textcolor{comment}{ * Finally, observe that the sanity checking macros evaluate to the empty}
00070 \textcolor{comment}{ * string when H5C\_DO\_SANITY\_CHECKS is FALSE.  They also contain calls}
00071 \textcolor{comment}{ * to the HGOTO\_ERROR macro, which may not be appropriate in all cases.}
00072 \textcolor{comment}{ * If so, we will need versions of the insertion and deletion macros which}
00073 \textcolor{comment}{ * do not reference the sanity checking macros.}
00074 \textcolor{comment}{ *                          JRM - 5/5/04}
00075 \textcolor{comment}{ *}
00076 \textcolor{comment}{ * Changes:}
00077 \textcolor{comment}{ *}
00078 \textcolor{comment}{ *  - Removed the line:}
00079 \textcolor{comment}{ *}
00080 \textcolor{comment}{ *        ( ( (Size) == (entry\_ptr)->size ) && ( (len) != 1 ) ) ||}
00081 \textcolor{comment}{ *}
00082 \textcolor{comment}{ *    from the H5C\_\_DLL\_PRE\_REMOVE\_SC macro.  With the addition of the}
00083 \textcolor{comment}{ *    epoch markers used in the age out based cache size reduction algorithm,}
00084 \textcolor{comment}{ *    this invariant need not hold, as the epoch markers are of size 0.}
00085 \textcolor{comment}{ *}
00086 \textcolor{comment}{ *    One could argue that I should have given the epoch markers a positive}
00087 \textcolor{comment}{ *    size, but this would break the index\_size = LRU\_list\_size + pl\_size}
00088 \textcolor{comment}{ *    + pel\_size invariant.}
00089 \textcolor{comment}{ *}
00090 \textcolor{comment}{ *    Alternatively, I could pass the current decr\_mode in to the macro,}
00091 \textcolor{comment}{ *    and just skip the check whenever epoch markers may be in use.}
00092 \textcolor{comment}{ *}
00093 \textcolor{comment}{ *    However, any size errors should be caught when the cache is flushed}
00094 \textcolor{comment}{ *    and destroyed.  Until we are tracking such an error, this should be}
00095 \textcolor{comment}{ *    good enough.}
00096 \textcolor{comment}{ *                                                     JRM - 12/9/04}
00097 \textcolor{comment}{ *}
00098 \textcolor{comment}{ *}
00099 \textcolor{comment}{ *  - In the H5C\_\_DLL\_PRE\_INSERT\_SC macro, replaced the lines:}
00100 \textcolor{comment}{ *}
00101 \textcolor{comment}{ *    ( ( (len) == 1 ) &&}
00102 \textcolor{comment}{ *      ( ( (head\_ptr) != (tail\_ptr) ) || ( (Size) <= 0 ) ||}
00103 \textcolor{comment}{ *        ( (head\_ptr) == NULL ) || ( (head\_ptr)->size != (Size) )}
00104 \textcolor{comment}{ *      )}
00105 \textcolor{comment}{ *    ) ||}
00106 \textcolor{comment}{ *}
00107 \textcolor{comment}{ *    with:}
00108 \textcolor{comment}{ *}
00109 \textcolor{comment}{ *    ( ( (len) == 1 ) &&}
00110 \textcolor{comment}{ *      ( ( (head\_ptr) != (tail\_ptr) ) ||}
00111 \textcolor{comment}{ *        ( (head\_ptr) == NULL ) || ( (head\_ptr)->size != (Size) )}
00112 \textcolor{comment}{ *      )}
00113 \textcolor{comment}{ *    ) ||}
00114 \textcolor{comment}{ *}
00115 \textcolor{comment}{ *    Epoch markers have size 0, so we can now have a non-empty list with}
00116 \textcolor{comment}{ *    zero size.  Hence the "( (Size) <= 0 )" clause cause false failures}
00117 \textcolor{comment}{ *    in the sanity check.  Since "Size" is typically a size\_t, it can't}
00118 \textcolor{comment}{ *    take on negative values, and thus the revised clause "( (Size) < 0 )"}
00119 \textcolor{comment}{ *    caused compiler warnings.}
00120 \textcolor{comment}{ *                                                     JRM - 12/22/04}
00121 \textcolor{comment}{ *}
00122 \textcolor{comment}{ *  - In the H5C\_\_DLL\_SC macro, replaced the lines:}
00123 \textcolor{comment}{ *}
00124 \textcolor{comment}{ *    ( ( (len) == 1 ) &&}
00125 \textcolor{comment}{ *      ( ( (head\_ptr) != (tail\_ptr) ) || ( (cache\_ptr)->size <= 0 ) ||}
00126 \textcolor{comment}{ *        ( (head\_ptr) == NULL ) || ( (head\_ptr)->size != (Size) )}
00127 \textcolor{comment}{ *      )}
00128 \textcolor{comment}{ *    ) ||}
00129 \textcolor{comment}{ *}
00130 \textcolor{comment}{ *    with}
00131 \textcolor{comment}{ *}
00132 \textcolor{comment}{ *    ( ( (len) == 1 ) &&}
00133 \textcolor{comment}{ *      ( ( (head\_ptr) != (tail\_ptr) ) ||}
00134 \textcolor{comment}{ *        ( (head\_ptr) == NULL ) || ( (head\_ptr)->size != (Size) )}
00135 \textcolor{comment}{ *      )}
00136 \textcolor{comment}{ *    ) ||}
00137 \textcolor{comment}{ *}
00138 \textcolor{comment}{ *    Epoch markers have size 0, so we can now have a non-empty list with}
00139 \textcolor{comment}{ *    zero size.  Hence the "( (Size) <= 0 )" clause cause false failures}
00140 \textcolor{comment}{ *    in the sanity check.  Since "Size" is typically a size\_t, it can't}
00141 \textcolor{comment}{ *    take on negative values, and thus the revised clause "( (Size) < 0 )"}
00142 \textcolor{comment}{ *    caused compiler warnings.}
00143 \textcolor{comment}{ *                                                     JRM - 1/10/05}
00144 \textcolor{comment}{ *}
00145 \textcolor{comment}{ *  - Added the H5C\_\_DLL\_UPDATE\_FOR\_SIZE\_CHANGE macro and the associated}
00146 \textcolor{comment}{ *    sanity checking macros.  These macro are used to update the size of}
00147 \textcolor{comment}{ *    a DLL when one of its entries changes size.}
00148 \textcolor{comment}{ *}
00149 \textcolor{comment}{ *                          JRM - 9/8/05}
00150 \textcolor{comment}{ *}
00151 \textcolor{comment}{ *  - Added macros supporting the index list -- a doubly liked list of }
00152 \textcolor{comment}{ *    all entries in the index.  This list is necessary to reduce the }
00153 \textcolor{comment}{ *    cost of visiting all entries in the cache, which was previously}
00154 \textcolor{comment}{ *    done via a scan of the hash table.}
00155 \textcolor{comment}{ *}
00156 \textcolor{comment}{ *                          JRM - 10/15/15}
00157 \textcolor{comment}{ *}
00158 \textcolor{comment}{ ****************************************************************************/}
00159 
00160 \textcolor{preprocessor}{#if H5C\_DO\_SANITY\_CHECKS}
00161 
00162 \textcolor{preprocessor}{#define H5C\_\_DLL\_PRE\_REMOVE\_SC(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fv) \(\backslash\)}
00163 \textcolor{preprocessor}{if ( ( (head\_ptr) == NULL ) ||                                               \(\backslash\)}
00164 \textcolor{preprocessor}{     ( (tail\_ptr) == NULL ) ||                                               \(\backslash\)}
00165 \textcolor{preprocessor}{     ( (entry\_ptr) == NULL ) ||                                              \(\backslash\)}
00166 \textcolor{preprocessor}{     ( (len) <= 0 ) ||                                                       \(\backslash\)}
00167 \textcolor{preprocessor}{     ( (Size) < (entry\_ptr)->size ) ||                                       \(\backslash\)}
00168 \textcolor{preprocessor}{     ( ( (entry\_ptr)->prev == NULL ) && ( (head\_ptr) != (entry\_ptr) ) ) ||   \(\backslash\)}
00169 \textcolor{preprocessor}{     ( ( (entry\_ptr)->next == NULL ) && ( (tail\_ptr) != (entry\_ptr) ) ) ||   \(\backslash\)}
00170 \textcolor{preprocessor}{     ( ( (len) == 1 ) &&                                                     \(\backslash\)}
00171 \textcolor{preprocessor}{       ( ! ( ( (head\_ptr) == (entry\_ptr) ) &&                                \(\backslash\)}
00172 \textcolor{preprocessor}{             ( (tail\_ptr) == (entry\_ptr) ) &&                                \(\backslash\)}
00173 \textcolor{preprocessor}{             ( (entry\_ptr)->next == NULL ) &&                                \(\backslash\)}
00174 \textcolor{preprocessor}{             ( (entry\_ptr)->prev == NULL ) &&                                \(\backslash\)}
00175 \textcolor{preprocessor}{             ( (Size) == (entry\_ptr)->size )                                 \(\backslash\)}
00176 \textcolor{preprocessor}{           )                                                                 \(\backslash\)}
00177 \textcolor{preprocessor}{       )                                                                     \(\backslash\)}
00178 \textcolor{preprocessor}{     )                                                                       \(\backslash\)}
00179 \textcolor{preprocessor}{   ) \{                                                                       \(\backslash\)}
00180 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, (fv), "DLL pre remove SC failed")     \(\backslash\)}
00181 \textcolor{preprocessor}{\}}
00182 
00183 \textcolor{preprocessor}{#define H5C\_\_DLL\_SC(head\_ptr, tail\_ptr, len, Size, fv)                   \(\backslash\)}
00184 \textcolor{preprocessor}{if ( ( ( ( (head\_ptr) == NULL ) || ( (tail\_ptr) == NULL ) ) &&           \(\backslash\)}
00185 \textcolor{preprocessor}{       ( (head\_ptr) != (tail\_ptr) )                                      \(\backslash\)}
00186 \textcolor{preprocessor}{     ) ||                                                                \(\backslash\)}
00187 \textcolor{preprocessor}{     ( (len) < 0 ) ||                                                    \(\backslash\)}
00188 \textcolor{preprocessor}{     ( (Size) < 0 ) ||                                                   \(\backslash\)}
00189 \textcolor{preprocessor}{     ( ( (len) == 1 ) &&                                                 \(\backslash\)}
00190 \textcolor{preprocessor}{       ( ( (head\_ptr) != (tail\_ptr) ) ||                                 \(\backslash\)}
00191 \textcolor{preprocessor}{         ( (head\_ptr) == NULL ) || ( (head\_ptr)->size != (Size) )        \(\backslash\)}
00192 \textcolor{preprocessor}{       )                                                                 \(\backslash\)}
00193 \textcolor{preprocessor}{     ) ||                                                                \(\backslash\)}
00194 \textcolor{preprocessor}{     ( ( (len) >= 1 ) &&                                                 \(\backslash\)}
00195 \textcolor{preprocessor}{       ( ( (head\_ptr) == NULL ) || ( (head\_ptr)->prev != NULL ) ||       \(\backslash\)}
00196 \textcolor{preprocessor}{         ( (tail\_ptr) == NULL ) || ( (tail\_ptr)->next != NULL )          \(\backslash\)}
00197 \textcolor{preprocessor}{       )                                                                 \(\backslash\)}
00198 \textcolor{preprocessor}{     )                                                                   \(\backslash\)}
00199 \textcolor{preprocessor}{   ) \{                                                                   \(\backslash\)}
00200 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, (fv), "DLL sanity check failed")  \(\backslash\)}
00201 \textcolor{preprocessor}{\}}
00202 
00203 \textcolor{preprocessor}{#define H5C\_\_DLL\_PRE\_INSERT\_SC(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fv) \(\backslash\)}
00204 \textcolor{preprocessor}{if ( ( (entry\_ptr) == NULL ) ||                                              \(\backslash\)}
00205 \textcolor{preprocessor}{     ( (entry\_ptr)->next != NULL ) ||                                        \(\backslash\)}
00206 \textcolor{preprocessor}{     ( (entry\_ptr)->prev != NULL ) ||                                        \(\backslash\)}
00207 \textcolor{preprocessor}{     ( ( ( (head\_ptr) == NULL ) || ( (tail\_ptr) == NULL ) ) &&               \(\backslash\)}
00208 \textcolor{preprocessor}{       ( (head\_ptr) != (tail\_ptr) )                                          \(\backslash\)}
00209 \textcolor{preprocessor}{     ) ||                                                                    \(\backslash\)}
00210 \textcolor{preprocessor}{     ( ( (len) == 1 ) &&                                                     \(\backslash\)}
00211 \textcolor{preprocessor}{       ( ( (head\_ptr) != (tail\_ptr) ) ||                                     \(\backslash\)}
00212 \textcolor{preprocessor}{         ( (head\_ptr) == NULL ) || ( (head\_ptr)->size != (Size) )            \(\backslash\)}
00213 \textcolor{preprocessor}{       )                                                                     \(\backslash\)}
00214 \textcolor{preprocessor}{     ) ||                                                                    \(\backslash\)}
00215 \textcolor{preprocessor}{     ( ( (len) >= 1 ) &&                                                     \(\backslash\)}
00216 \textcolor{preprocessor}{       ( ( (head\_ptr) == NULL ) || ( (head\_ptr)->prev != NULL ) ||           \(\backslash\)}
00217 \textcolor{preprocessor}{         ( (tail\_ptr) == NULL ) || ( (tail\_ptr)->next != NULL )              \(\backslash\)}
00218 \textcolor{preprocessor}{       )                                                                     \(\backslash\)}
00219 \textcolor{preprocessor}{     )                                                                       \(\backslash\)}
00220 \textcolor{preprocessor}{   ) \{                                                                       \(\backslash\)}
00221 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, (fv), "DLL pre insert SC failed")     \(\backslash\)}
00222 \textcolor{preprocessor}{\}}
00223 
00224 \textcolor{preprocessor}{#define H5C\_\_DLL\_PRE\_SIZE\_UPDATE\_SC(dll\_len, dll\_size, old\_size, new\_size)    \(\backslash\)}
00225 \textcolor{preprocessor}{if ( ( (dll\_len) <= 0 ) ||                                                    \(\backslash\)}
00226 \textcolor{preprocessor}{     ( (dll\_size) <= 0 ) ||                                                   \(\backslash\)}
00227 \textcolor{preprocessor}{     ( (old\_size) <= 0 ) ||                                                   \(\backslash\)}
00228 \textcolor{preprocessor}{     ( (old\_size) > (dll\_size) ) ||                                           \(\backslash\)}
00229 \textcolor{preprocessor}{     ( (new\_size) <= 0 ) ||                                                   \(\backslash\)}
00230 \textcolor{preprocessor}{     ( ( (dll\_len) == 1 ) && ( (old\_size) != (dll\_size) ) ) ) \{               \(\backslash\)}
00231 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, FAIL, "DLL pre size update SC failed") \(\backslash\)}
00232 \textcolor{preprocessor}{\}}
00233 
00234 \textcolor{preprocessor}{#define H5C\_\_DLL\_POST\_SIZE\_UPDATE\_SC(dll\_len, dll\_size, old\_size, new\_size)    \(\backslash\)}
00235 \textcolor{preprocessor}{if ( ( (new\_size) > (dll\_size) ) ||                                            \(\backslash\)}
00236 \textcolor{preprocessor}{     ( ( (dll\_len) == 1 ) && ( (new\_size) != (dll\_size) ) ) ) \{                \(\backslash\)}
00237 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, FAIL, "DLL post size update SC failed") \(\backslash\)}
00238 \textcolor{preprocessor}{\}}
00239 
00240 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_DO\_SANITY\_CHECKS */}\textcolor{preprocessor}{}
00241 
00242 \textcolor{preprocessor}{#define H5C\_\_DLL\_PRE\_REMOVE\_SC(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fv)}
00243 \textcolor{preprocessor}{#define H5C\_\_DLL\_SC(head\_ptr, tail\_ptr, len, Size, fv)}
00244 \textcolor{preprocessor}{#define H5C\_\_DLL\_PRE\_INSERT\_SC(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fv)}
00245 \textcolor{preprocessor}{#define H5C\_\_DLL\_PRE\_SIZE\_UPDATE\_SC(dll\_len, dll\_size, old\_size, new\_size)}
00246 \textcolor{preprocessor}{#define H5C\_\_DLL\_POST\_SIZE\_UPDATE\_SC(dll\_len, dll\_size, old\_size, new\_size)}
00247 
00248 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_DO\_SANITY\_CHECKS */}\textcolor{preprocessor}{}
00249 
00250 
00251 \textcolor{preprocessor}{#define H5C\_\_DLL\_APPEND(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fail\_val) \(\backslash\)}
00252 \textcolor{preprocessor}{\{                                                                           \(\backslash\)}
00253 \textcolor{preprocessor}{    H5C\_\_DLL\_PRE\_INSERT\_SC(entry\_ptr, head\_ptr, tail\_ptr, len, Size,        \(\backslash\)}
00254 \textcolor{preprocessor}{                           fail\_val)                                        \(\backslash\)}
00255 \textcolor{preprocessor}{    if ( (head\_ptr) == NULL )                                               \(\backslash\)}
00256 \textcolor{preprocessor}{    \{                                                                       \(\backslash\)}
00257 \textcolor{preprocessor}{       (head\_ptr) = (entry\_ptr);                                            \(\backslash\)}
00258 \textcolor{preprocessor}{       (tail\_ptr) = (entry\_ptr);                                            \(\backslash\)}
00259 \textcolor{preprocessor}{    \}                                                                       \(\backslash\)}
00260 \textcolor{preprocessor}{    else                                                                    \(\backslash\)}
00261 \textcolor{preprocessor}{    \{                                                                       \(\backslash\)}
00262 \textcolor{preprocessor}{       (tail\_ptr)->next = (entry\_ptr);                                      \(\backslash\)}
00263 \textcolor{preprocessor}{       (entry\_ptr)->prev = (tail\_ptr);                                      \(\backslash\)}
00264 \textcolor{preprocessor}{       (tail\_ptr) = (entry\_ptr);                                            \(\backslash\)}
00265 \textcolor{preprocessor}{    \}                                                                       \(\backslash\)}
00266 \textcolor{preprocessor}{    (len)++;                                                                \(\backslash\)}
00267 \textcolor{preprocessor}{    (Size) += (entry\_ptr)->size;                                            \(\backslash\)}
00268 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_DLL\_APPEND() */}\textcolor{preprocessor}{}
00269 
00270 \textcolor{preprocessor}{#define H5C\_\_DLL\_PREPEND(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fail\_val) \(\backslash\)}
00271 \textcolor{preprocessor}{\{                                                                            \(\backslash\)}
00272 \textcolor{preprocessor}{    H5C\_\_DLL\_PRE\_INSERT\_SC(entry\_ptr, head\_ptr, tail\_ptr, len, Size,         \(\backslash\)}
00273 \textcolor{preprocessor}{                           fail\_val)                                         \(\backslash\)}
00274 \textcolor{preprocessor}{    if ( (head\_ptr) == NULL )                                                \(\backslash\)}
00275 \textcolor{preprocessor}{    \{                                                                        \(\backslash\)}
00276 \textcolor{preprocessor}{       (head\_ptr) = (entry\_ptr);                                             \(\backslash\)}
00277 \textcolor{preprocessor}{       (tail\_ptr) = (entry\_ptr);                                             \(\backslash\)}
00278 \textcolor{preprocessor}{    \}                                                                        \(\backslash\)}
00279 \textcolor{preprocessor}{    else                                                                     \(\backslash\)}
00280 \textcolor{preprocessor}{    \{                                                                        \(\backslash\)}
00281 \textcolor{preprocessor}{       (head\_ptr)->prev = (entry\_ptr);                                       \(\backslash\)}
00282 \textcolor{preprocessor}{       (entry\_ptr)->next = (head\_ptr);                                       \(\backslash\)}
00283 \textcolor{preprocessor}{       (head\_ptr) = (entry\_ptr);                                             \(\backslash\)}
00284 \textcolor{preprocessor}{    \}                                                                        \(\backslash\)}
00285 \textcolor{preprocessor}{    (len)++;                                                                 \(\backslash\)}
00286 \textcolor{preprocessor}{    (Size) += entry\_ptr->size;                                               \(\backslash\)}
00287 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_DLL\_PREPEND() */}\textcolor{preprocessor}{}
00288 
00289 \textcolor{preprocessor}{#define H5C\_\_DLL\_REMOVE(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fail\_val) \(\backslash\)}
00290 \textcolor{preprocessor}{\{                                                                           \(\backslash\)}
00291 \textcolor{preprocessor}{    H5C\_\_DLL\_PRE\_REMOVE\_SC(entry\_ptr, head\_ptr, tail\_ptr, len, Size,        \(\backslash\)}
00292 \textcolor{preprocessor}{                           fail\_val)                                        \(\backslash\)}
00293 \textcolor{preprocessor}{    \{                                                                       \(\backslash\)}
00294 \textcolor{preprocessor}{       if ( (head\_ptr) == (entry\_ptr) )                                     \(\backslash\)}
00295 \textcolor{preprocessor}{       \{                                                                    \(\backslash\)}
00296 \textcolor{preprocessor}{          (head\_ptr) = (entry\_ptr)->next;                                   \(\backslash\)}
00297 \textcolor{preprocessor}{          if ( (head\_ptr) != NULL )                                         \(\backslash\)}
00298 \textcolor{preprocessor}{             (head\_ptr)->prev = NULL;                                       \(\backslash\)}
00299 \textcolor{preprocessor}{       \}                                                                    \(\backslash\)}
00300 \textcolor{preprocessor}{       else                                                                 \(\backslash\)}
00301 \textcolor{preprocessor}{          (entry\_ptr)->prev->next = (entry\_ptr)->next;                      \(\backslash\)}
00302 \textcolor{preprocessor}{       if ( (tail\_ptr) == (entry\_ptr) )                                     \(\backslash\)}
00303 \textcolor{preprocessor}{       \{                                                                    \(\backslash\)}
00304 \textcolor{preprocessor}{          (tail\_ptr) = (entry\_ptr)->prev;                                   \(\backslash\)}
00305 \textcolor{preprocessor}{          if ( (tail\_ptr) != NULL )                                         \(\backslash\)}
00306 \textcolor{preprocessor}{             (tail\_ptr)->next = NULL;                                       \(\backslash\)}
00307 \textcolor{preprocessor}{       \}                                                                    \(\backslash\)}
00308 \textcolor{preprocessor}{       else                                                                 \(\backslash\)}
00309 \textcolor{preprocessor}{          (entry\_ptr)->next->prev = (entry\_ptr)->prev;                      \(\backslash\)}
00310 \textcolor{preprocessor}{       entry\_ptr->next = NULL;                                              \(\backslash\)}
00311 \textcolor{preprocessor}{       entry\_ptr->prev = NULL;                                              \(\backslash\)}
00312 \textcolor{preprocessor}{       (len)--;                                                             \(\backslash\)}
00313 \textcolor{preprocessor}{       (Size) -= entry\_ptr->size;                                           \(\backslash\)}
00314 \textcolor{preprocessor}{    \}                                                                       \(\backslash\)}
00315 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_DLL\_REMOVE() */}\textcolor{preprocessor}{}
00316 
00317 \textcolor{preprocessor}{#define H5C\_\_DLL\_UPDATE\_FOR\_SIZE\_CHANGE(dll\_len, dll\_size, old\_size, new\_size) \(\backslash\)}
00318 \textcolor{preprocessor}{\{                                                                              \(\backslash\)}
00319 \textcolor{preprocessor}{    H5C\_\_DLL\_PRE\_SIZE\_UPDATE\_SC(dll\_len, dll\_size, old\_size, new\_size)         \(\backslash\)}
00320 \textcolor{preprocessor}{    (dll\_size) -= (old\_size);                                                  \(\backslash\)}
00321 \textcolor{preprocessor}{    (dll\_size) += (new\_size);                                                  \(\backslash\)}
00322 \textcolor{preprocessor}{    H5C\_\_DLL\_POST\_SIZE\_UPDATE\_SC(dll\_len, dll\_size, old\_size, new\_size)        \(\backslash\)}
00323 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_DLL\_UPDATE\_FOR\_SIZE\_CHANGE() */}\textcolor{preprocessor}{}
00324 
00325 \textcolor{preprocessor}{#if H5C\_DO\_SANITY\_CHECKS}
00326 
00327 \textcolor{preprocessor}{#define H5C\_\_AUX\_DLL\_PRE\_REMOVE\_SC(entry\_ptr, hd\_ptr, tail\_ptr, len, Size, fv) \(\backslash\)}
00328 \textcolor{preprocessor}{if ( ( (hd\_ptr) == NULL ) ||                                                   \(\backslash\)}
00329 \textcolor{preprocessor}{     ( (tail\_ptr) == NULL ) ||                                                 \(\backslash\)}
00330 \textcolor{preprocessor}{     ( (entry\_ptr) == NULL ) ||                                                \(\backslash\)}
00331 \textcolor{preprocessor}{     ( (len) <= 0 ) ||                                                         \(\backslash\)}
00332 \textcolor{preprocessor}{     ( (Size) < (entry\_ptr)->size ) ||                                         \(\backslash\)}
00333 \textcolor{preprocessor}{     ( ( (Size) == (entry\_ptr)->size ) && ( ! ( (len) == 1 ) ) ) ||            \(\backslash\)}
00334 \textcolor{preprocessor}{     ( ( (entry\_ptr)->aux\_prev == NULL ) && ( (hd\_ptr) != (entry\_ptr) ) ) ||   \(\backslash\)}
00335 \textcolor{preprocessor}{     ( ( (entry\_ptr)->aux\_next == NULL ) && ( (tail\_ptr) != (entry\_ptr) ) ) || \(\backslash\)}
00336 \textcolor{preprocessor}{     ( ( (len) == 1 ) &&                                                       \(\backslash\)}
00337 \textcolor{preprocessor}{       ( ! ( ( (hd\_ptr) == (entry\_ptr) ) && ( (tail\_ptr) == (entry\_ptr) ) &&   \(\backslash\)}
00338 \textcolor{preprocessor}{             ( (entry\_ptr)->aux\_next == NULL ) &&                              \(\backslash\)}
00339 \textcolor{preprocessor}{             ( (entry\_ptr)->aux\_prev == NULL ) &&                              \(\backslash\)}
00340 \textcolor{preprocessor}{             ( (Size) == (entry\_ptr)->size )                                   \(\backslash\)}
00341 \textcolor{preprocessor}{           )                                                                   \(\backslash\)}
00342 \textcolor{preprocessor}{       )                                                                       \(\backslash\)}
00343 \textcolor{preprocessor}{     )                                                                         \(\backslash\)}
00344 \textcolor{preprocessor}{   ) \{                                                                         \(\backslash\)}
00345 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, (fv), "aux DLL pre remove SC failed")   \(\backslash\)}
00346 \textcolor{preprocessor}{\}}
00347 
00348 \textcolor{preprocessor}{#define H5C\_\_AUX\_DLL\_SC(head\_ptr, tail\_ptr, len, Size, fv)                  \(\backslash\)}
00349 \textcolor{preprocessor}{if ( ( ( ( (head\_ptr) == NULL ) || ( (tail\_ptr) == NULL ) ) &&              \(\backslash\)}
00350 \textcolor{preprocessor}{       ( (head\_ptr) != (tail\_ptr) )                                         \(\backslash\)}
00351 \textcolor{preprocessor}{     ) ||                                                                   \(\backslash\)}
00352 \textcolor{preprocessor}{     ( (len) < 0 ) ||                                                       \(\backslash\)}
00353 \textcolor{preprocessor}{     ( (Size) < 0 ) ||                                                      \(\backslash\)}
00354 \textcolor{preprocessor}{     ( ( (len) == 1 ) &&                                                    \(\backslash\)}
00355 \textcolor{preprocessor}{       ( ( (head\_ptr) != (tail\_ptr) ) || ( (Size) <= 0 ) ||                 \(\backslash\)}
00356 \textcolor{preprocessor}{         ( (head\_ptr) == NULL ) || ( (head\_ptr)->size != (Size) )           \(\backslash\)}
00357 \textcolor{preprocessor}{       )                                                                    \(\backslash\)}
00358 \textcolor{preprocessor}{     ) ||                                                                   \(\backslash\)}
00359 \textcolor{preprocessor}{     ( ( (len) >= 1 ) &&                                                    \(\backslash\)}
00360 \textcolor{preprocessor}{       ( ( (head\_ptr) == NULL ) || ( (head\_ptr)->aux\_prev != NULL ) ||      \(\backslash\)}
00361 \textcolor{preprocessor}{         ( (tail\_ptr) == NULL ) || ( (tail\_ptr)->aux\_next != NULL )         \(\backslash\)}
00362 \textcolor{preprocessor}{       )                                                                    \(\backslash\)}
00363 \textcolor{preprocessor}{     )                                                                      \(\backslash\)}
00364 \textcolor{preprocessor}{   ) \{                                                                      \(\backslash\)}
00365 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, (fv), "AUX DLL sanity check failed") \(\backslash\)}
00366 \textcolor{preprocessor}{\}}
00367 
00368 \textcolor{preprocessor}{#define H5C\_\_AUX\_DLL\_PRE\_INSERT\_SC(entry\_ptr, hd\_ptr, tail\_ptr, len, Size, fv) \(\backslash\)}
00369 \textcolor{preprocessor}{if ( ( (entry\_ptr) == NULL ) ||                                                \(\backslash\)}
00370 \textcolor{preprocessor}{     ( (entry\_ptr)->aux\_next != NULL ) ||                                      \(\backslash\)}
00371 \textcolor{preprocessor}{     ( (entry\_ptr)->aux\_prev != NULL ) ||                                      \(\backslash\)}
00372 \textcolor{preprocessor}{     ( ( ( (hd\_ptr) == NULL ) || ( (tail\_ptr) == NULL ) ) &&                   \(\backslash\)}
00373 \textcolor{preprocessor}{       ( (hd\_ptr) != (tail\_ptr) )                                              \(\backslash\)}
00374 \textcolor{preprocessor}{     ) ||                                                                      \(\backslash\)}
00375 \textcolor{preprocessor}{     ( ( (len) == 1 ) &&                                                       \(\backslash\)}
00376 \textcolor{preprocessor}{       ( ( (hd\_ptr) != (tail\_ptr) ) || ( (Size) <= 0 ) ||                      \(\backslash\)}
00377 \textcolor{preprocessor}{         ( (hd\_ptr) == NULL ) || ( (hd\_ptr)->size != (Size) )                  \(\backslash\)}
00378 \textcolor{preprocessor}{       )                                                                       \(\backslash\)}
00379 \textcolor{preprocessor}{     ) ||                                                                      \(\backslash\)}
00380 \textcolor{preprocessor}{     ( ( (len) >= 1 ) &&                                                       \(\backslash\)}
00381 \textcolor{preprocessor}{       ( ( (hd\_ptr) == NULL ) || ( (hd\_ptr)->aux\_prev != NULL ) ||             \(\backslash\)}
00382 \textcolor{preprocessor}{         ( (tail\_ptr) == NULL ) || ( (tail\_ptr)->aux\_next != NULL )            \(\backslash\)}
00383 \textcolor{preprocessor}{       )                                                                       \(\backslash\)}
00384 \textcolor{preprocessor}{     )                                                                         \(\backslash\)}
00385 \textcolor{preprocessor}{   ) \{                                                                         \(\backslash\)}
00386 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, (fv), "AUX DLL pre insert SC failed")   \(\backslash\)}
00387 \textcolor{preprocessor}{\}}
00388 
00389 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_DO\_SANITY\_CHECKS */}\textcolor{preprocessor}{}
00390 
00391 \textcolor{preprocessor}{#define H5C\_\_AUX\_DLL\_PRE\_REMOVE\_SC(entry\_ptr, hd\_ptr, tail\_ptr, len, Size, fv)}
00392 \textcolor{preprocessor}{#define H5C\_\_AUX\_DLL\_SC(head\_ptr, tail\_ptr, len, Size, fv)}
00393 \textcolor{preprocessor}{#define H5C\_\_AUX\_DLL\_PRE\_INSERT\_SC(entry\_ptr, hd\_ptr, tail\_ptr, len, Size, fv)}
00394 
00395 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_DO\_SANITY\_CHECKS */}\textcolor{preprocessor}{}
00396 
00397 
00398 \textcolor{preprocessor}{#define H5C\_\_AUX\_DLL\_APPEND(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fail\_val)\(\backslash\)}
00399 \textcolor{preprocessor}{\{                                                                              \(\backslash\)}
00400 \textcolor{preprocessor}{    H5C\_\_AUX\_DLL\_PRE\_INSERT\_SC(entry\_ptr, head\_ptr, tail\_ptr, len, Size,       \(\backslash\)}
00401 \textcolor{preprocessor}{                               fail\_val)                                       \(\backslash\)}
00402 \textcolor{preprocessor}{    if ( (head\_ptr) == NULL )                                                  \(\backslash\)}
00403 \textcolor{preprocessor}{    \{                                                                          \(\backslash\)}
00404 \textcolor{preprocessor}{       (head\_ptr) = (entry\_ptr);                                               \(\backslash\)}
00405 \textcolor{preprocessor}{       (tail\_ptr) = (entry\_ptr);                                               \(\backslash\)}
00406 \textcolor{preprocessor}{    \}                                                                          \(\backslash\)}
00407 \textcolor{preprocessor}{    else                                                                       \(\backslash\)}
00408 \textcolor{preprocessor}{    \{                                                                          \(\backslash\)}
00409 \textcolor{preprocessor}{       (tail\_ptr)->aux\_next = (entry\_ptr);                                     \(\backslash\)}
00410 \textcolor{preprocessor}{       (entry\_ptr)->aux\_prev = (tail\_ptr);                                     \(\backslash\)}
00411 \textcolor{preprocessor}{       (tail\_ptr) = (entry\_ptr);                                               \(\backslash\)}
00412 \textcolor{preprocessor}{    \}                                                                          \(\backslash\)}
00413 \textcolor{preprocessor}{    (len)++;                                                                   \(\backslash\)}
00414 \textcolor{preprocessor}{    (Size) += entry\_ptr->size;                                                 \(\backslash\)}
00415 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_AUX\_DLL\_APPEND() */}\textcolor{preprocessor}{}
00416 
00417 \textcolor{preprocessor}{#define H5C\_\_AUX\_DLL\_PREPEND(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fv)   \(\backslash\)}
00418 \textcolor{preprocessor}{\{                                                                            \(\backslash\)}
00419 \textcolor{preprocessor}{    H5C\_\_AUX\_DLL\_PRE\_INSERT\_SC(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fv) \(\backslash\)}
00420 \textcolor{preprocessor}{    if ( (head\_ptr) == NULL )                                                \(\backslash\)}
00421 \textcolor{preprocessor}{    \{                                                                        \(\backslash\)}
00422 \textcolor{preprocessor}{       (head\_ptr) = (entry\_ptr);                                             \(\backslash\)}
00423 \textcolor{preprocessor}{       (tail\_ptr) = (entry\_ptr);                                             \(\backslash\)}
00424 \textcolor{preprocessor}{    \}                                                                        \(\backslash\)}
00425 \textcolor{preprocessor}{    else                                                                     \(\backslash\)}
00426 \textcolor{preprocessor}{    \{                                                                        \(\backslash\)}
00427 \textcolor{preprocessor}{       (head\_ptr)->aux\_prev = (entry\_ptr);                                   \(\backslash\)}
00428 \textcolor{preprocessor}{       (entry\_ptr)->aux\_next = (head\_ptr);                                   \(\backslash\)}
00429 \textcolor{preprocessor}{       (head\_ptr) = (entry\_ptr);                                             \(\backslash\)}
00430 \textcolor{preprocessor}{    \}                                                                        \(\backslash\)}
00431 \textcolor{preprocessor}{    (len)++;                                                                 \(\backslash\)}
00432 \textcolor{preprocessor}{    (Size) += entry\_ptr->size;                                               \(\backslash\)}
00433 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_AUX\_DLL\_PREPEND() */}\textcolor{preprocessor}{}
00434 
00435 \textcolor{preprocessor}{#define H5C\_\_AUX\_DLL\_REMOVE(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fv)    \(\backslash\)}
00436 \textcolor{preprocessor}{\{                                                                            \(\backslash\)}
00437 \textcolor{preprocessor}{    H5C\_\_AUX\_DLL\_PRE\_REMOVE\_SC(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fv) \(\backslash\)}
00438 \textcolor{preprocessor}{    \{                                                                        \(\backslash\)}
00439 \textcolor{preprocessor}{       if ( (head\_ptr) == (entry\_ptr) )                                      \(\backslash\)}
00440 \textcolor{preprocessor}{       \{                                                                     \(\backslash\)}
00441 \textcolor{preprocessor}{          (head\_ptr) = (entry\_ptr)->aux\_next;                                \(\backslash\)}
00442 \textcolor{preprocessor}{          if ( (head\_ptr) != NULL )                                          \(\backslash\)}
00443 \textcolor{preprocessor}{             (head\_ptr)->aux\_prev = NULL;                                    \(\backslash\)}
00444 \textcolor{preprocessor}{       \}                                                                     \(\backslash\)}
00445 \textcolor{preprocessor}{       else                                                                  \(\backslash\)}
00446 \textcolor{preprocessor}{          (entry\_ptr)->aux\_prev->aux\_next = (entry\_ptr)->aux\_next;           \(\backslash\)}
00447 \textcolor{preprocessor}{       if ( (tail\_ptr) == (entry\_ptr) )                                      \(\backslash\)}
00448 \textcolor{preprocessor}{       \{                                                                     \(\backslash\)}
00449 \textcolor{preprocessor}{          (tail\_ptr) = (entry\_ptr)->aux\_prev;                                \(\backslash\)}
00450 \textcolor{preprocessor}{          if ( (tail\_ptr) != NULL )                                          \(\backslash\)}
00451 \textcolor{preprocessor}{             (tail\_ptr)->aux\_next = NULL;                                    \(\backslash\)}
00452 \textcolor{preprocessor}{       \}                                                                     \(\backslash\)}
00453 \textcolor{preprocessor}{       else                                                                  \(\backslash\)}
00454 \textcolor{preprocessor}{          (entry\_ptr)->aux\_next->aux\_prev = (entry\_ptr)->aux\_prev;           \(\backslash\)}
00455 \textcolor{preprocessor}{       entry\_ptr->aux\_next = NULL;                                           \(\backslash\)}
00456 \textcolor{preprocessor}{       entry\_ptr->aux\_prev = NULL;                                           \(\backslash\)}
00457 \textcolor{preprocessor}{       (len)--;                                                              \(\backslash\)}
00458 \textcolor{preprocessor}{       (Size) -= entry\_ptr->size;                                            \(\backslash\)}
00459 \textcolor{preprocessor}{    \}                                                                        \(\backslash\)}
00460 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_AUX\_DLL\_REMOVE() */}\textcolor{preprocessor}{}
00461 
00462 \textcolor{preprocessor}{#if H5C\_DO\_SANITY\_CHECKS}
00463 
00464 \textcolor{preprocessor}{#define H5C\_\_IL\_DLL\_PRE\_REMOVE\_SC(entry\_ptr, hd\_ptr, tail\_ptr, len, Size, fv) \(\backslash\)}
00465 \textcolor{preprocessor}{if ( ( (hd\_ptr) == NULL ) ||                                                  \(\backslash\)}
00466 \textcolor{preprocessor}{     ( (tail\_ptr) == NULL ) ||                                                \(\backslash\)}
00467 \textcolor{preprocessor}{     ( (entry\_ptr) == NULL ) ||                                               \(\backslash\)}
00468 \textcolor{preprocessor}{     ( (len) <= 0 ) ||                                                        \(\backslash\)}
00469 \textcolor{preprocessor}{     ( (Size) < (entry\_ptr)->size ) ||                                        \(\backslash\)}
00470 \textcolor{preprocessor}{     ( ( (Size) == (entry\_ptr)->size ) && ( ! ( (len) == 1 ) ) ) ||           \(\backslash\)}
00471 \textcolor{preprocessor}{     ( ( (entry\_ptr)->il\_prev == NULL ) && ( (hd\_ptr) != (entry\_ptr) ) ) ||   \(\backslash\)}
00472 \textcolor{preprocessor}{     ( ( (entry\_ptr)->il\_next == NULL ) && ( (tail\_ptr) != (entry\_ptr) ) ) || \(\backslash\)}
00473 \textcolor{preprocessor}{     ( ( (len) == 1 ) &&                                                      \(\backslash\)}
00474 \textcolor{preprocessor}{       ( ! ( ( (hd\_ptr) == (entry\_ptr) ) && ( (tail\_ptr) == (entry\_ptr) ) &&  \(\backslash\)}
00475 \textcolor{preprocessor}{             ( (entry\_ptr)->il\_next == NULL ) &&                              \(\backslash\)}
00476 \textcolor{preprocessor}{             ( (entry\_ptr)->il\_prev == NULL ) &&                              \(\backslash\)}
00477 \textcolor{preprocessor}{             ( (Size) == (entry\_ptr)->size )                                  \(\backslash\)}
00478 \textcolor{preprocessor}{           )                                                                  \(\backslash\)}
00479 \textcolor{preprocessor}{       )                                                                      \(\backslash\)}
00480 \textcolor{preprocessor}{     )                                                                        \(\backslash\)}
00481 \textcolor{preprocessor}{   ) \{                                                                        \(\backslash\)}
00482 \textcolor{preprocessor}{    HDassert(0 && "il DLL pre remove SC failed");                             \(\backslash\)}
00483 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, (fv), "il DLL pre remove SC failed")   \(\backslash\)}
00484 \textcolor{preprocessor}{\}}
00485 
00486 \textcolor{preprocessor}{#define H5C\_\_IL\_DLL\_PRE\_INSERT\_SC(entry\_ptr, hd\_ptr, tail\_ptr, len, Size, fv) \(\backslash\)}
00487 \textcolor{preprocessor}{if ( ( (entry\_ptr) == NULL ) ||                                               \(\backslash\)}
00488 \textcolor{preprocessor}{     ( (entry\_ptr)->il\_next != NULL ) ||                                      \(\backslash\)}
00489 \textcolor{preprocessor}{     ( (entry\_ptr)->il\_prev != NULL ) ||                                      \(\backslash\)}
00490 \textcolor{preprocessor}{     ( ( ( (hd\_ptr) == NULL ) || ( (tail\_ptr) == NULL ) ) &&                  \(\backslash\)}
00491 \textcolor{preprocessor}{       ( (hd\_ptr) != (tail\_ptr) )                                             \(\backslash\)}
00492 \textcolor{preprocessor}{     ) ||                                                                     \(\backslash\)}
00493 \textcolor{preprocessor}{     ( ( (len) == 1 ) &&                                                      \(\backslash\)}
00494 \textcolor{preprocessor}{       ( ( (hd\_ptr) != (tail\_ptr) ) || ( (Size) <= 0 ) ||                     \(\backslash\)}
00495 \textcolor{preprocessor}{         ( (hd\_ptr) == NULL ) || ( (hd\_ptr)->size != (Size) )                 \(\backslash\)}
00496 \textcolor{preprocessor}{       )                                                                      \(\backslash\)}
00497 \textcolor{preprocessor}{     ) ||                                                                     \(\backslash\)}
00498 \textcolor{preprocessor}{     ( ( (len) >= 1 ) &&                                                      \(\backslash\)}
00499 \textcolor{preprocessor}{       ( ( (hd\_ptr) == NULL ) || ( (hd\_ptr)->il\_prev != NULL ) ||             \(\backslash\)}
00500 \textcolor{preprocessor}{         ( (tail\_ptr) == NULL ) || ( (tail\_ptr)->il\_next != NULL )            \(\backslash\)}
00501 \textcolor{preprocessor}{       )                                                                      \(\backslash\)}
00502 \textcolor{preprocessor}{     )                                                                        \(\backslash\)}
00503 \textcolor{preprocessor}{   ) \{                                                                        \(\backslash\)}
00504 \textcolor{preprocessor}{    HDassert(0 && "IL DLL pre insert SC failed");                             \(\backslash\)}
00505 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, (fv), "IL DLL pre insert SC failed")   \(\backslash\)}
00506 \textcolor{preprocessor}{\}}
00507 
00508 \textcolor{preprocessor}{#define H5C\_\_IL\_DLL\_SC(head\_ptr, tail\_ptr, len, Size, fv)                  \(\backslash\)}
00509 \textcolor{preprocessor}{if ( ( ( ( (head\_ptr) == NULL ) || ( (tail\_ptr) == NULL ) ) &&             \(\backslash\)}
00510 \textcolor{preprocessor}{       ( (head\_ptr) != (tail\_ptr) )                                        \(\backslash\)}
00511 \textcolor{preprocessor}{     ) ||                                                                  \(\backslash\)}
00512 \textcolor{preprocessor}{     ( ( (len) == 1 ) &&                                                   \(\backslash\)}
00513 \textcolor{preprocessor}{       ( ( (head\_ptr) != (tail\_ptr) ) ||                                   \(\backslash\)}
00514 \textcolor{preprocessor}{         ( (head\_ptr) == NULL ) || ( (head\_ptr)->size != (Size) )          \(\backslash\)}
00515 \textcolor{preprocessor}{       )                                                                   \(\backslash\)}
00516 \textcolor{preprocessor}{     ) ||                                                                  \(\backslash\)}
00517 \textcolor{preprocessor}{     ( ( (len) >= 1 ) &&                                                   \(\backslash\)}
00518 \textcolor{preprocessor}{       ( ( (head\_ptr) == NULL ) || ( (head\_ptr)->il\_prev != NULL ) ||      \(\backslash\)}
00519 \textcolor{preprocessor}{         ( (tail\_ptr) == NULL ) || ( (tail\_ptr)->il\_next != NULL )         \(\backslash\)}
00520 \textcolor{preprocessor}{       )                                                                   \(\backslash\)}
00521 \textcolor{preprocessor}{     )                                                                     \(\backslash\)}
00522 \textcolor{preprocessor}{   ) \{                                                                     \(\backslash\)}
00523 \textcolor{preprocessor}{    HDassert(0 && "IL DLL sanity check failed");                           \(\backslash\)}
00524 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, (fv), "IL DLL sanity check failed") \(\backslash\)}
00525 \textcolor{preprocessor}{\}}
00526 
00527 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_DO\_SANITY\_CHECKS */}\textcolor{preprocessor}{}
00528 
00529 \textcolor{preprocessor}{#define H5C\_\_IL\_DLL\_PRE\_REMOVE\_SC(entry\_ptr, hd\_ptr, tail\_ptr, len, Size, fv)}
00530 \textcolor{preprocessor}{#define H5C\_\_IL\_DLL\_PRE\_INSERT\_SC(entry\_ptr, hd\_ptr, tail\_ptr, len, Size, fv)}
00531 \textcolor{preprocessor}{#define H5C\_\_IL\_DLL\_SC(head\_ptr, tail\_ptr, len, Size, fv)}
00532 
00533 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_DO\_SANITY\_CHECKS */}\textcolor{preprocessor}{}
00534 
00535 
00536 \textcolor{preprocessor}{#define H5C\_\_IL\_DLL\_APPEND(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fail\_val)\(\backslash\)}
00537 \textcolor{preprocessor}{\{                                                                             \(\backslash\)}
00538 \textcolor{preprocessor}{    H5C\_\_IL\_DLL\_PRE\_INSERT\_SC(entry\_ptr, head\_ptr, tail\_ptr, len, Size,       \(\backslash\)}
00539 \textcolor{preprocessor}{                               fail\_val)                                      \(\backslash\)}
00540 \textcolor{preprocessor}{    if ( (head\_ptr) == NULL )                                                 \(\backslash\)}
00541 \textcolor{preprocessor}{    \{                                                                         \(\backslash\)}
00542 \textcolor{preprocessor}{       (head\_ptr) = (entry\_ptr);                                              \(\backslash\)}
00543 \textcolor{preprocessor}{       (tail\_ptr) = (entry\_ptr);                                              \(\backslash\)}
00544 \textcolor{preprocessor}{    \}                                                                         \(\backslash\)}
00545 \textcolor{preprocessor}{    else                                                                      \(\backslash\)}
00546 \textcolor{preprocessor}{    \{                                                                         \(\backslash\)}
00547 \textcolor{preprocessor}{       (tail\_ptr)->il\_next = (entry\_ptr);                                     \(\backslash\)}
00548 \textcolor{preprocessor}{       (entry\_ptr)->il\_prev = (tail\_ptr);                                     \(\backslash\)}
00549 \textcolor{preprocessor}{       (tail\_ptr) = (entry\_ptr);                                              \(\backslash\)}
00550 \textcolor{preprocessor}{    \}                                                                         \(\backslash\)}
00551 \textcolor{preprocessor}{    (len)++;                                                                  \(\backslash\)}
00552 \textcolor{preprocessor}{    (Size) += entry\_ptr->size;                                                \(\backslash\)}
00553 \textcolor{preprocessor}{    H5C\_\_IL\_DLL\_SC(head\_ptr, tail\_ptr, len, Size, fail\_val)                   \(\backslash\)}
00554 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_IL\_DLL\_APPEND() */}\textcolor{preprocessor}{}
00555 
00556 \textcolor{preprocessor}{#define H5C\_\_IL\_DLL\_REMOVE(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fv)    \(\backslash\)}
00557 \textcolor{preprocessor}{\{                                                                           \(\backslash\)}
00558 \textcolor{preprocessor}{    H5C\_\_IL\_DLL\_PRE\_REMOVE\_SC(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fv) \(\backslash\)}
00559 \textcolor{preprocessor}{    \{                                                                       \(\backslash\)}
00560 \textcolor{preprocessor}{       if ( (head\_ptr) == (entry\_ptr) )                                     \(\backslash\)}
00561 \textcolor{preprocessor}{       \{                                                                    \(\backslash\)}
00562 \textcolor{preprocessor}{          (head\_ptr) = (entry\_ptr)->il\_next;                                \(\backslash\)}
00563 \textcolor{preprocessor}{          if ( (head\_ptr) != NULL )                                         \(\backslash\)}
00564 \textcolor{preprocessor}{             (head\_ptr)->il\_prev = NULL;                                    \(\backslash\)}
00565 \textcolor{preprocessor}{       \}                                                                    \(\backslash\)}
00566 \textcolor{preprocessor}{       else                                                                 \(\backslash\)}
00567 \textcolor{preprocessor}{          (entry\_ptr)->il\_prev->il\_next = (entry\_ptr)->il\_next;             \(\backslash\)}
00568 \textcolor{preprocessor}{       if ( (tail\_ptr) == (entry\_ptr) )                                     \(\backslash\)}
00569 \textcolor{preprocessor}{       \{                                                                    \(\backslash\)}
00570 \textcolor{preprocessor}{          (tail\_ptr) = (entry\_ptr)->il\_prev;                                \(\backslash\)}
00571 \textcolor{preprocessor}{          if ( (tail\_ptr) != NULL )                                         \(\backslash\)}
00572 \textcolor{preprocessor}{             (tail\_ptr)->il\_next = NULL;                                    \(\backslash\)}
00573 \textcolor{preprocessor}{       \}                                                                    \(\backslash\)}
00574 \textcolor{preprocessor}{       else                                                                 \(\backslash\)}
00575 \textcolor{preprocessor}{          (entry\_ptr)->il\_next->il\_prev = (entry\_ptr)->il\_prev;             \(\backslash\)}
00576 \textcolor{preprocessor}{       entry\_ptr->il\_next = NULL;                                           \(\backslash\)}
00577 \textcolor{preprocessor}{       entry\_ptr->il\_prev = NULL;                                           \(\backslash\)}
00578 \textcolor{preprocessor}{       (len)--;                                                             \(\backslash\)}
00579 \textcolor{preprocessor}{       (Size) -= entry\_ptr->size;                                           \(\backslash\)}
00580 \textcolor{preprocessor}{    \}                                                                       \(\backslash\)}
00581 \textcolor{preprocessor}{    H5C\_\_IL\_DLL\_SC(head\_ptr, tail\_ptr, len, Size, fv)                       \(\backslash\)}
00582 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_IL\_DLL\_REMOVE() */}\textcolor{preprocessor}{}
00583 
00584 
00585 \textcolor{comment}{/***********************************************************************}
00586 \textcolor{comment}{ *}
00587 \textcolor{comment}{ * Stats collection macros}
00588 \textcolor{comment}{ *}
00589 \textcolor{comment}{ * The following macros must handle stats collection when this collection}
00590 \textcolor{comment}{ * is enabled, and evaluate to the empty string when it is not.}
00591 \textcolor{comment}{ *}
00592 \textcolor{comment}{ * The sole exception to this rule is}
00593 \textcolor{comment}{ * H5C\_\_UPDATE\_CACHE\_HIT\_RATE\_STATS(), which is always active as}
00594 \textcolor{comment}{ * the cache hit rate stats are always collected and available.}
00595 \textcolor{comment}{ *}
00596 \textcolor{comment}{ ***********************************************************************/}
00597 
00598 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_CACHE\_HIT\_RATE\_STATS(cache\_ptr, hit) \(\backslash\)}
00599 \textcolor{preprocessor}{        (cache\_ptr->cache\_accesses)++;                   \(\backslash\)}
00600 \textcolor{preprocessor}{        if ( hit ) \{                                     \(\backslash\)}
00601 \textcolor{preprocessor}{            (cache\_ptr->cache\_hits)++;                   \(\backslash\)}
00602 \textcolor{preprocessor}{        \}                                                \(\backslash\)}
00603 \textcolor{preprocessor}{}
00604 \textcolor{preprocessor}{#if H5C\_COLLECT\_CACHE\_STATS}
00605 
00606 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_MAX\_INDEX\_SIZE\_STATS(cache\_ptr)                        \(\backslash\)}
00607 \textcolor{preprocessor}{        if ( (cache\_ptr)->index\_size > (cache\_ptr)->max\_index\_size )       \(\backslash\)}
00608 \textcolor{preprocessor}{            (cache\_ptr)->max\_index\_size = (cache\_ptr)->index\_size;         \(\backslash\)}
00609 \textcolor{preprocessor}{        if ( (cache\_ptr)->clean\_index\_size >                               \(\backslash\)}
00610 \textcolor{preprocessor}{                (cache\_ptr)->max\_clean\_index\_size )                        \(\backslash\)}
00611 \textcolor{preprocessor}{            (cache\_ptr)->max\_clean\_index\_size =                            \(\backslash\)}
00612 \textcolor{preprocessor}{                (cache\_ptr)->clean\_index\_size;                             \(\backslash\)}
00613 \textcolor{preprocessor}{        if ( (cache\_ptr)->dirty\_index\_size >                               \(\backslash\)}
00614 \textcolor{preprocessor}{                (cache\_ptr)->max\_dirty\_index\_size )                        \(\backslash\)}
00615 \textcolor{preprocessor}{            (cache\_ptr)->max\_dirty\_index\_size =                            \(\backslash\)}
00616 \textcolor{preprocessor}{                (cache\_ptr)->dirty\_index\_size;}
00617 
00618 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_DIRTY\_PIN(cache\_ptr, entry\_ptr) \(\backslash\)}
00619 \textcolor{preprocessor}{    (((cache\_ptr)->dirty\_pins)[(entry\_ptr)->type->id])++;}
00620 
00621 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_UNPROTECT(cache\_ptr)                   \(\backslash\)}
00622 \textcolor{preprocessor}{        if ( (cache\_ptr)->slist\_len > (cache\_ptr)->max\_slist\_len )   \(\backslash\)}
00623 \textcolor{preprocessor}{        (cache\_ptr)->max\_slist\_len = (cache\_ptr)->slist\_len;     \(\backslash\)}
00624 \textcolor{preprocessor}{        if ( (cache\_ptr)->slist\_size > (cache\_ptr)->max\_slist\_size ) \(\backslash\)}
00625 \textcolor{preprocessor}{        (cache\_ptr)->max\_slist\_size = (cache\_ptr)->slist\_size;   \(\backslash\)}
00626 \textcolor{preprocessor}{    if ( (cache\_ptr)->pel\_len > (cache\_ptr)->max\_pel\_len )       \(\backslash\)}
00627 \textcolor{preprocessor}{        (cache\_ptr)->max\_pel\_len = (cache\_ptr)->pel\_len;         \(\backslash\)}
00628 \textcolor{preprocessor}{    if ( (cache\_ptr)->pel\_size > (cache\_ptr)->max\_pel\_size )     \(\backslash\)}
00629 \textcolor{preprocessor}{        (cache\_ptr)->max\_pel\_size = (cache\_ptr)->pel\_size;}
00630 
00631 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_MOVE(cache\_ptr, entry\_ptr)               \(\backslash\)}
00632 \textcolor{preprocessor}{    if ( cache\_ptr->flush\_in\_progress )                            \(\backslash\)}
00633 \textcolor{preprocessor}{            ((cache\_ptr)->cache\_flush\_moves[(entry\_ptr)->type->id])++; \(\backslash\)}
00634 \textcolor{preprocessor}{        if ( entry\_ptr->flush\_in\_progress )                            \(\backslash\)}
00635 \textcolor{preprocessor}{            ((cache\_ptr)->entry\_flush\_moves[(entry\_ptr)->type->id])++; \(\backslash\)}
00636 \textcolor{preprocessor}{    (((cache\_ptr)->moves)[(entry\_ptr)->type->id])++;               \(\backslash\)}
00637 \textcolor{preprocessor}{        (cache\_ptr)->entries\_relocated\_counter++;}
00638 
00639 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_ENTRY\_SIZE\_CHANGE(cache\_ptr, entry\_ptr, new\_size)\(\backslash\)}
00640 \textcolor{preprocessor}{    if ( cache\_ptr->flush\_in\_progress )                                    \(\backslash\)}
00641 \textcolor{preprocessor}{            ((cache\_ptr)->cache\_flush\_size\_changes[(entry\_ptr)->type->id])++;  \(\backslash\)}
00642 \textcolor{preprocessor}{        if ( entry\_ptr->flush\_in\_progress )                                    \(\backslash\)}
00643 \textcolor{preprocessor}{            ((cache\_ptr)->entry\_flush\_size\_changes[(entry\_ptr)->type->id])++;  \(\backslash\)}
00644 \textcolor{preprocessor}{    if ( (entry\_ptr)->size < (new\_size) ) \{                                \(\backslash\)}
00645 \textcolor{preprocessor}{        ((cache\_ptr)->size\_increases[(entry\_ptr)->type->id])++;            \(\backslash\)}
00646 \textcolor{preprocessor}{            H5C\_\_UPDATE\_MAX\_INDEX\_SIZE\_STATS(cache\_ptr)                        \(\backslash\)}
00647 \textcolor{preprocessor}{            if ( (cache\_ptr)->slist\_size > (cache\_ptr)->max\_slist\_size )       \(\backslash\)}
00648 \textcolor{preprocessor}{                (cache\_ptr)->max\_slist\_size = (cache\_ptr)->slist\_size;         \(\backslash\)}
00649 \textcolor{preprocessor}{            if ( (cache\_ptr)->pl\_size > (cache\_ptr)->max\_pl\_size )             \(\backslash\)}
00650 \textcolor{preprocessor}{                (cache\_ptr)->max\_pl\_size = (cache\_ptr)->pl\_size;               \(\backslash\)}
00651 \textcolor{preprocessor}{    \} else if ( (entry\_ptr)->size > (new\_size) ) \{                         \(\backslash\)}
00652 \textcolor{preprocessor}{        ((cache\_ptr)->size\_decreases[(entry\_ptr)->type->id])++;            \(\backslash\)}
00653 \textcolor{preprocessor}{    \}}
00654 
00655 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_HT\_INSERTION(cache\_ptr) \(\backslash\)}
00656 \textcolor{preprocessor}{    (cache\_ptr)->total\_ht\_insertions++;}
00657 
00658 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_HT\_DELETION(cache\_ptr) \(\backslash\)}
00659 \textcolor{preprocessor}{    (cache\_ptr)->total\_ht\_deletions++;}
00660 
00661 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_HT\_SEARCH(cache\_ptr, success, depth)  \(\backslash\)}
00662 \textcolor{preprocessor}{    if ( success ) \{                                            \(\backslash\)}
00663 \textcolor{preprocessor}{        (cache\_ptr)->successful\_ht\_searches++;                  \(\backslash\)}
00664 \textcolor{preprocessor}{        (cache\_ptr)->total\_successful\_ht\_search\_depth += depth; \(\backslash\)}
00665 \textcolor{preprocessor}{    \} else \{                                                    \(\backslash\)}
00666 \textcolor{preprocessor}{        (cache\_ptr)->failed\_ht\_searches++;                      \(\backslash\)}
00667 \textcolor{preprocessor}{        (cache\_ptr)->total\_failed\_ht\_search\_depth += depth;     \(\backslash\)}
00668 \textcolor{preprocessor}{    \}}
00669 
00670 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_UNPIN(cache\_ptr, entry\_ptr) \(\backslash\)}
00671 \textcolor{preprocessor}{    ((cache\_ptr)->unpins)[(entry\_ptr)->type->id]++;}
00672 
00673 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_SLIST\_SCAN\_RESTART(cache\_ptr) \(\backslash\)}
00674 \textcolor{preprocessor}{    ((cache\_ptr)->slist\_scan\_restarts)++;}
00675 
00676 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_LRU\_SCAN\_RESTART(cache\_ptr) \(\backslash\)}
00677 \textcolor{preprocessor}{    ((cache\_ptr)->LRU\_scan\_restarts)++;}
00678 
00679 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_INDEX\_SCAN\_RESTART(cache\_ptr) \(\backslash\)}
00680 \textcolor{preprocessor}{    ((cache\_ptr)->index\_scan\_restarts)++;}
00681 
00682 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_CACHE\_IMAGE\_CREATE(cache\_ptr) \(\backslash\)}
00683 \textcolor{preprocessor}{\{                                                           \(\backslash\)}
00684 \textcolor{preprocessor}{    (cache\_ptr)->images\_created++;                          \(\backslash\)}
00685 \textcolor{preprocessor}{\}}
00686 
00687 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_CACHE\_IMAGE\_READ(cache\_ptr)  \(\backslash\)}
00688 \textcolor{preprocessor}{\{                                                          \(\backslash\)}
00689 \textcolor{preprocessor}{    }\textcolor{comment}{/* make sure image len is still good */}\textcolor{preprocessor}{                \(\backslash\)}
00690 \textcolor{preprocessor}{    HDassert((cache\_ptr)->image\_len > 0);                  \(\backslash\)}
00691 \textcolor{preprocessor}{    (cache\_ptr)->images\_read++;                            \(\backslash\)}
00692 \textcolor{preprocessor}{\}}
00693 
00694 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_CACHE\_IMAGE\_LOAD(cache\_ptr)  \(\backslash\)}
00695 \textcolor{preprocessor}{\{                                                          \(\backslash\)}
00696 \textcolor{preprocessor}{    }\textcolor{comment}{/* make sure image len is still good */}\textcolor{preprocessor}{                \(\backslash\)}
00697 \textcolor{preprocessor}{    HDassert((cache\_ptr)->image\_len > 0);                  \(\backslash\)}
00698 \textcolor{preprocessor}{    (cache\_ptr)->images\_loaded++;                          \(\backslash\)}
00699 \textcolor{preprocessor}{    (cache\_ptr)->last\_image\_size = (cache\_ptr)->image\_len; \(\backslash\)}
00700 \textcolor{preprocessor}{\}}
00701 
00702 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_PREFETCH(cache\_ptr, dirty) \(\backslash\)}
00703 \textcolor{preprocessor}{\{                                                        \(\backslash\)}
00704 \textcolor{preprocessor}{    (cache\_ptr)->prefetches++;                           \(\backslash\)}
00705 \textcolor{preprocessor}{    if ( dirty )                                         \(\backslash\)}
00706 \textcolor{preprocessor}{        (cache\_ptr)->dirty\_prefetches++;                 \(\backslash\)}
00707 \textcolor{preprocessor}{\}}
00708 
00709 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_PREFETCH\_HIT(cache\_ptr) \(\backslash\)}
00710 \textcolor{preprocessor}{\{                                                     \(\backslash\)}
00711 \textcolor{preprocessor}{    (cache\_ptr)->prefetch\_hits++;                     \(\backslash\)}
00712 \textcolor{preprocessor}{\}}
00713 
00714 \textcolor{preprocessor}{#if H5C\_COLLECT\_CACHE\_ENTRY\_STATS}
00715 
00716 \textcolor{preprocessor}{#define H5C\_\_RESET\_CACHE\_ENTRY\_STATS(entry\_ptr) \(\backslash\)}
00717 \textcolor{preprocessor}{\{                                           \(\backslash\)}
00718 \textcolor{preprocessor}{    (entry\_ptr)->accesses = 0;              \(\backslash\)}
00719 \textcolor{preprocessor}{    (entry\_ptr)->clears   = 0;              \(\backslash\)}
00720 \textcolor{preprocessor}{    (entry\_ptr)->flushes  = 0;              \(\backslash\)}
00721 \textcolor{preprocessor}{    (entry\_ptr)->pins     = 0;              \(\backslash\)}
00722 \textcolor{preprocessor}{\}}
00723 
00724 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_CLEAR(cache\_ptr, entry\_ptr)        \(\backslash\)}
00725 \textcolor{preprocessor}{\{                                                                \(\backslash\)}
00726 \textcolor{preprocessor}{    (((cache\_ptr)->clears)[(entry\_ptr)->type->id])++;            \(\backslash\)}
00727 \textcolor{preprocessor}{    if((entry\_ptr)->is\_pinned)                                   \(\backslash\)}
00728 \textcolor{preprocessor}{        (((cache\_ptr)->pinned\_clears)[(entry\_ptr)->type->id])++; \(\backslash\)}
00729 \textcolor{preprocessor}{    ((entry\_ptr)->clears)++;                                     \(\backslash\)}
00730 \textcolor{preprocessor}{\}}
00731 
00732 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_FLUSH(cache\_ptr, entry\_ptr)         \(\backslash\)}
00733 \textcolor{preprocessor}{\{                                                                 \(\backslash\)}
00734 \textcolor{preprocessor}{    (((cache\_ptr)->flushes)[(entry\_ptr)->type->id])++;            \(\backslash\)}
00735 \textcolor{preprocessor}{    if((entry\_ptr)->is\_pinned)                                    \(\backslash\)}
00736 \textcolor{preprocessor}{        (((cache\_ptr)->pinned\_flushes)[(entry\_ptr)->type->id])++; \(\backslash\)}
00737 \textcolor{preprocessor}{    ((entry\_ptr)->flushes)++;                                     \(\backslash\)}
00738 \textcolor{preprocessor}{\}}
00739 
00740 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_EVICTION(cache\_ptr, entry\_ptr, take\_ownership) \(\backslash\)}
00741 \textcolor{preprocessor}{\{                                                                            \(\backslash\)}
00742 \textcolor{preprocessor}{    if ( take\_ownership )                                                    \(\backslash\)}
00743 \textcolor{preprocessor}{        (((cache\_ptr)->take\_ownerships)[(entry\_ptr)->type->id])++;           \(\backslash\)}
00744 \textcolor{preprocessor}{    else                                                                     \(\backslash\)}
00745 \textcolor{preprocessor}{        (((cache\_ptr)->evictions)[(entry\_ptr)->type->id])++;                 \(\backslash\)}
00746 \textcolor{preprocessor}{    if ( (entry\_ptr)->accesses >                                         \(\backslash\)}
00747 \textcolor{preprocessor}{            ((cache\_ptr)->max\_accesses)[(entry\_ptr)->type->id] )         \(\backslash\)}
00748 \textcolor{preprocessor}{        ((cache\_ptr)->max\_accesses)[(entry\_ptr)->type->id] =             \(\backslash\)}
00749 \textcolor{preprocessor}{            (entry\_ptr)->accesses;                                       \(\backslash\)}
00750 \textcolor{preprocessor}{    if ( (entry\_ptr)->accesses <                                         \(\backslash\)}
00751 \textcolor{preprocessor}{            ((cache\_ptr)->min\_accesses)[(entry\_ptr)->type->id] )         \(\backslash\)}
00752 \textcolor{preprocessor}{        ((cache\_ptr)->min\_accesses)[(entry\_ptr)->type->id] =             \(\backslash\)}
00753 \textcolor{preprocessor}{            (entry\_ptr)->accesses;                                       \(\backslash\)}
00754 \textcolor{preprocessor}{    if ( (entry\_ptr)->clears >                                           \(\backslash\)}
00755 \textcolor{preprocessor}{             ((cache\_ptr)->max\_clears)[(entry\_ptr)->type->id] )          \(\backslash\)}
00756 \textcolor{preprocessor}{            ((cache\_ptr)->max\_clears)[(entry\_ptr)->type->id]             \(\backslash\)}
00757 \textcolor{preprocessor}{                 = (entry\_ptr)->clears;                                  \(\backslash\)}
00758 \textcolor{preprocessor}{    if ( (entry\_ptr)->flushes >                                          \(\backslash\)}
00759 \textcolor{preprocessor}{            ((cache\_ptr)->max\_flushes)[(entry\_ptr)->type->id] )          \(\backslash\)}
00760 \textcolor{preprocessor}{        ((cache\_ptr)->max\_flushes)[(entry\_ptr)->type->id]                \(\backslash\)}
00761 \textcolor{preprocessor}{            = (entry\_ptr)->flushes;                                      \(\backslash\)}
00762 \textcolor{preprocessor}{    if ( (entry\_ptr)->size >                                             \(\backslash\)}
00763 \textcolor{preprocessor}{            ((cache\_ptr)->max\_size)[(entry\_ptr)->type->id] )             \(\backslash\)}
00764 \textcolor{preprocessor}{        ((cache\_ptr)->max\_size)[(entry\_ptr)->type->id]                   \(\backslash\)}
00765 \textcolor{preprocessor}{            = (entry\_ptr)->size;                                         \(\backslash\)}
00766 \textcolor{preprocessor}{    if ( (entry\_ptr)->pins >                                             \(\backslash\)}
00767 \textcolor{preprocessor}{            ((cache\_ptr)->max\_pins)[(entry\_ptr)->type->id] )             \(\backslash\)}
00768 \textcolor{preprocessor}{        ((cache\_ptr)->max\_pins)[(entry\_ptr)->type->id]                   \(\backslash\)}
00769 \textcolor{preprocessor}{            = (entry\_ptr)->pins;                                         \(\backslash\)}
00770 \textcolor{preprocessor}{\}}
00771 
00772 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_INSERTION(cache\_ptr, entry\_ptr)        \(\backslash\)}
00773 \textcolor{preprocessor}{\{                                                                    \(\backslash\)}
00774 \textcolor{preprocessor}{    (((cache\_ptr)->insertions)[(entry\_ptr)->type->id])++;            \(\backslash\)}
00775 \textcolor{preprocessor}{    if ( (entry\_ptr)->is\_pinned ) \{                                  \(\backslash\)}
00776 \textcolor{preprocessor}{        (((cache\_ptr)->pinned\_insertions)[(entry\_ptr)->type->id])++; \(\backslash\)}
00777 \textcolor{preprocessor}{        ((cache\_ptr)->pins)[(entry\_ptr)->type->id]++;                \(\backslash\)}
00778 \textcolor{preprocessor}{        (entry\_ptr)->pins++;                                         \(\backslash\)}
00779 \textcolor{preprocessor}{        if ( (cache\_ptr)->pel\_len > (cache\_ptr)->max\_pel\_len )       \(\backslash\)}
00780 \textcolor{preprocessor}{            (cache\_ptr)->max\_pel\_len = (cache\_ptr)->pel\_len;         \(\backslash\)}
00781 \textcolor{preprocessor}{        if ( (cache\_ptr)->pel\_size > (cache\_ptr)->max\_pel\_size )     \(\backslash\)}
00782 \textcolor{preprocessor}{            (cache\_ptr)->max\_pel\_size = (cache\_ptr)->pel\_size;       \(\backslash\)}
00783 \textcolor{preprocessor}{    \}                                                                \(\backslash\)}
00784 \textcolor{preprocessor}{    if ( (cache\_ptr)->index\_len > (cache\_ptr)->max\_index\_len )       \(\backslash\)}
00785 \textcolor{preprocessor}{        (cache\_ptr)->max\_index\_len = (cache\_ptr)->index\_len;         \(\backslash\)}
00786 \textcolor{preprocessor}{    H5C\_\_UPDATE\_MAX\_INDEX\_SIZE\_STATS(cache\_ptr)                      \(\backslash\)}
00787 \textcolor{preprocessor}{    if ( (cache\_ptr)->slist\_len > (cache\_ptr)->max\_slist\_len )       \(\backslash\)}
00788 \textcolor{preprocessor}{        (cache\_ptr)->max\_slist\_len = (cache\_ptr)->slist\_len;         \(\backslash\)}
00789 \textcolor{preprocessor}{    if ( (cache\_ptr)->slist\_size > (cache\_ptr)->max\_slist\_size )     \(\backslash\)}
00790 \textcolor{preprocessor}{        (cache\_ptr)->max\_slist\_size = (cache\_ptr)->slist\_size;       \(\backslash\)}
00791 \textcolor{preprocessor}{    if ( (entry\_ptr)->size >                                         \(\backslash\)}
00792 \textcolor{preprocessor}{            ((cache\_ptr)->max\_size)[(entry\_ptr)->type->id] )         \(\backslash\)}
00793 \textcolor{preprocessor}{        ((cache\_ptr)->max\_size)[(entry\_ptr)->type->id]               \(\backslash\)}
00794 \textcolor{preprocessor}{             = (entry\_ptr)->size;                                    \(\backslash\)}
00795 \textcolor{preprocessor}{    cache\_ptr->entries\_inserted\_counter++;                           \(\backslash\)}
00796 \textcolor{preprocessor}{\}}
00797 
00798 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_PROTECT(cache\_ptr, entry\_ptr, hit)            \(\backslash\)}
00799 \textcolor{preprocessor}{\{                                                                           \(\backslash\)}
00800 \textcolor{preprocessor}{    if ( hit )                                                              \(\backslash\)}
00801 \textcolor{preprocessor}{        ((cache\_ptr)->hits)[(entry\_ptr)->type->id]++;                       \(\backslash\)}
00802 \textcolor{preprocessor}{    else                                                                    \(\backslash\)}
00803 \textcolor{preprocessor}{        ((cache\_ptr)->misses)[(entry\_ptr)->type->id]++;                     \(\backslash\)}
00804 \textcolor{preprocessor}{    if ( ! ((entry\_ptr)->is\_read\_only) ) \{                                  \(\backslash\)}
00805 \textcolor{preprocessor}{        ((cache\_ptr)->write\_protects)[(entry\_ptr)->type->id]++;             \(\backslash\)}
00806 \textcolor{preprocessor}{    \} else \{                                                                \(\backslash\)}
00807 \textcolor{preprocessor}{        ((cache\_ptr)->read\_protects)[(entry\_ptr)->type->id]++;              \(\backslash\)}
00808 \textcolor{preprocessor}{        if ( ((entry\_ptr)->ro\_ref\_count) >                                  \(\backslash\)}
00809 \textcolor{preprocessor}{                ((cache\_ptr)->max\_read\_protects)[(entry\_ptr)->type->id] )   \(\backslash\)}
00810 \textcolor{preprocessor}{            ((cache\_ptr)->max\_read\_protects)[(entry\_ptr)->type->id] =       \(\backslash\)}
00811 \textcolor{preprocessor}{                    ((entry\_ptr)->ro\_ref\_count);                            \(\backslash\)}
00812 \textcolor{preprocessor}{    \}                                                                       \(\backslash\)}
00813 \textcolor{preprocessor}{    if ( (cache\_ptr)->index\_len > (cache\_ptr)->max\_index\_len )              \(\backslash\)}
00814 \textcolor{preprocessor}{        (cache\_ptr)->max\_index\_len = (cache\_ptr)->index\_len;                \(\backslash\)}
00815 \textcolor{preprocessor}{    H5C\_\_UPDATE\_MAX\_INDEX\_SIZE\_STATS(cache\_ptr)                             \(\backslash\)}
00816 \textcolor{preprocessor}{    if ( (cache\_ptr)->pl\_len > (cache\_ptr)->max\_pl\_len )                    \(\backslash\)}
00817 \textcolor{preprocessor}{        (cache\_ptr)->max\_pl\_len = (cache\_ptr)->pl\_len;                      \(\backslash\)}
00818 \textcolor{preprocessor}{    if ( (cache\_ptr)->pl\_size > (cache\_ptr)->max\_pl\_size )                  \(\backslash\)}
00819 \textcolor{preprocessor}{        (cache\_ptr)->max\_pl\_size = (cache\_ptr)->pl\_size;                    \(\backslash\)}
00820 \textcolor{preprocessor}{    if ( (entry\_ptr)->size >                                                \(\backslash\)}
00821 \textcolor{preprocessor}{            ((cache\_ptr)->max\_size)[(entry\_ptr)->type->id] )                \(\backslash\)}
00822 \textcolor{preprocessor}{        ((cache\_ptr)->max\_size)[(entry\_ptr)->type->id] = (entry\_ptr)->size; \(\backslash\)}
00823 \textcolor{preprocessor}{    ((entry\_ptr)->accesses)++;                                              \(\backslash\)}
00824 \textcolor{preprocessor}{\}}
00825 
00826 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_PIN(cache\_ptr, entry\_ptr)      \(\backslash\)}
00827 \textcolor{preprocessor}{\{                                                            \(\backslash\)}
00828 \textcolor{preprocessor}{    ((cache\_ptr)->pins)[(entry\_ptr)->type->id]++;            \(\backslash\)}
00829 \textcolor{preprocessor}{    (entry\_ptr)->pins++;                                     \(\backslash\)}
00830 \textcolor{preprocessor}{    if ( (cache\_ptr)->pel\_len > (cache\_ptr)->max\_pel\_len )   \(\backslash\)}
00831 \textcolor{preprocessor}{        (cache\_ptr)->max\_pel\_len = (cache\_ptr)->pel\_len;     \(\backslash\)}
00832 \textcolor{preprocessor}{    if ( (cache\_ptr)->pel\_size > (cache\_ptr)->max\_pel\_size ) \(\backslash\)}
00833 \textcolor{preprocessor}{        (cache\_ptr)->max\_pel\_size = (cache\_ptr)->pel\_size;   \(\backslash\)}
00834 \textcolor{preprocessor}{\}}
00835 
00836 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_COLLECT\_CACHE\_ENTRY\_STATS */}\textcolor{preprocessor}{}
00837 
00838 \textcolor{preprocessor}{#define H5C\_\_RESET\_CACHE\_ENTRY\_STATS(entry\_ptr)}
00839 
00840 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_CLEAR(cache\_ptr, entry\_ptr)         \(\backslash\)}
00841 \textcolor{preprocessor}{\{                                                                 \(\backslash\)}
00842 \textcolor{preprocessor}{    (((cache\_ptr)->clears)[(entry\_ptr)->type->id])++;             \(\backslash\)}
00843 \textcolor{preprocessor}{    if((entry\_ptr)->is\_pinned)                                    \(\backslash\)}
00844 \textcolor{preprocessor}{        (((cache\_ptr)->pinned\_clears)[(entry\_ptr)->type->id])++;  \(\backslash\)}
00845 \textcolor{preprocessor}{\}}
00846 
00847 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_FLUSH(cache\_ptr, entry\_ptr)         \(\backslash\)}
00848 \textcolor{preprocessor}{\{                                                                 \(\backslash\)}
00849 \textcolor{preprocessor}{    (((cache\_ptr)->flushes)[(entry\_ptr)->type->id])++;            \(\backslash\)}
00850 \textcolor{preprocessor}{    if ( (entry\_ptr)->is\_pinned )                                 \(\backslash\)}
00851 \textcolor{preprocessor}{        (((cache\_ptr)->pinned\_flushes)[(entry\_ptr)->type->id])++; \(\backslash\)}
00852 \textcolor{preprocessor}{\}}
00853 
00854 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_EVICTION(cache\_ptr, entry\_ptr, take\_ownership) \(\backslash\)}
00855 \textcolor{preprocessor}{\{                                                                            \(\backslash\)}
00856 \textcolor{preprocessor}{    if ( take\_ownership )                                                    \(\backslash\)}
00857 \textcolor{preprocessor}{        (((cache\_ptr)->take\_ownerships)[(entry\_ptr)->type->id])++;           \(\backslash\)}
00858 \textcolor{preprocessor}{    else                                                                     \(\backslash\)}
00859 \textcolor{preprocessor}{        (((cache\_ptr)->evictions)[(entry\_ptr)->type->id])++;                 \(\backslash\)}
00860 \textcolor{preprocessor}{\}}
00861 
00862 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_INSERTION(cache\_ptr, entry\_ptr)        \(\backslash\)}
00863 \textcolor{preprocessor}{\{                                                                    \(\backslash\)}
00864 \textcolor{preprocessor}{    (((cache\_ptr)->insertions)[(entry\_ptr)->type->id])++;            \(\backslash\)}
00865 \textcolor{preprocessor}{    if ( (entry\_ptr)->is\_pinned ) \{                                  \(\backslash\)}
00866 \textcolor{preprocessor}{        (((cache\_ptr)->pinned\_insertions)[(entry\_ptr)->type->id])++; \(\backslash\)}
00867 \textcolor{preprocessor}{        ((cache\_ptr)->pins)[(entry\_ptr)->type->id]++;                \(\backslash\)}
00868 \textcolor{preprocessor}{        if ( (cache\_ptr)->pel\_len > (cache\_ptr)->max\_pel\_len )       \(\backslash\)}
00869 \textcolor{preprocessor}{            (cache\_ptr)->max\_pel\_len = (cache\_ptr)->pel\_len;         \(\backslash\)}
00870 \textcolor{preprocessor}{        if ( (cache\_ptr)->pel\_size > (cache\_ptr)->max\_pel\_size )     \(\backslash\)}
00871 \textcolor{preprocessor}{            (cache\_ptr)->max\_pel\_size = (cache\_ptr)->pel\_size;       \(\backslash\)}
00872 \textcolor{preprocessor}{    \}                                                                \(\backslash\)}
00873 \textcolor{preprocessor}{    if ( (cache\_ptr)->index\_len > (cache\_ptr)->max\_index\_len )       \(\backslash\)}
00874 \textcolor{preprocessor}{        (cache\_ptr)->max\_index\_len = (cache\_ptr)->index\_len;         \(\backslash\)}
00875 \textcolor{preprocessor}{    H5C\_\_UPDATE\_MAX\_INDEX\_SIZE\_STATS(cache\_ptr)                      \(\backslash\)}
00876 \textcolor{preprocessor}{    if ( (cache\_ptr)->slist\_len > (cache\_ptr)->max\_slist\_len )       \(\backslash\)}
00877 \textcolor{preprocessor}{        (cache\_ptr)->max\_slist\_len = (cache\_ptr)->slist\_len;         \(\backslash\)}
00878 \textcolor{preprocessor}{    if ( (cache\_ptr)->slist\_size > (cache\_ptr)->max\_slist\_size )     \(\backslash\)}
00879 \textcolor{preprocessor}{        (cache\_ptr)->max\_slist\_size = (cache\_ptr)->slist\_size;       \(\backslash\)}
00880 \textcolor{preprocessor}{    cache\_ptr->entries\_inserted\_counter++;                           \(\backslash\)}
00881 \textcolor{preprocessor}{\}}
00882 
00883 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_PROTECT(cache\_ptr, entry\_ptr, hit)            \(\backslash\)}
00884 \textcolor{preprocessor}{\{                                                                           \(\backslash\)}
00885 \textcolor{preprocessor}{    if ( hit )                                                              \(\backslash\)}
00886 \textcolor{preprocessor}{        ((cache\_ptr)->hits)[(entry\_ptr)->type->id]++;                       \(\backslash\)}
00887 \textcolor{preprocessor}{    else                                                                    \(\backslash\)}
00888 \textcolor{preprocessor}{        ((cache\_ptr)->misses)[(entry\_ptr)->type->id]++;                     \(\backslash\)}
00889 \textcolor{preprocessor}{    if ( ! ((entry\_ptr)->is\_read\_only) )                                    \(\backslash\)}
00890 \textcolor{preprocessor}{        ((cache\_ptr)->write\_protects)[(entry\_ptr)->type->id]++;             \(\backslash\)}
00891 \textcolor{preprocessor}{    else \{                                                                  \(\backslash\)}
00892 \textcolor{preprocessor}{        ((cache\_ptr)->read\_protects)[(entry\_ptr)->type->id]++;              \(\backslash\)}
00893 \textcolor{preprocessor}{        if ( ((entry\_ptr)->ro\_ref\_count) >                                  \(\backslash\)}
00894 \textcolor{preprocessor}{                ((cache\_ptr)->max\_read\_protects)[(entry\_ptr)->type->id] )   \(\backslash\)}
00895 \textcolor{preprocessor}{            ((cache\_ptr)->max\_read\_protects)[(entry\_ptr)->type->id] =       \(\backslash\)}
00896 \textcolor{preprocessor}{                    ((entry\_ptr)->ro\_ref\_count);                            \(\backslash\)}
00897 \textcolor{preprocessor}{    \}                                                                       \(\backslash\)}
00898 \textcolor{preprocessor}{    if ( (cache\_ptr)->index\_len > (cache\_ptr)->max\_index\_len )              \(\backslash\)}
00899 \textcolor{preprocessor}{        (cache\_ptr)->max\_index\_len = (cache\_ptr)->index\_len;                \(\backslash\)}
00900 \textcolor{preprocessor}{    H5C\_\_UPDATE\_MAX\_INDEX\_SIZE\_STATS(cache\_ptr)                             \(\backslash\)}
00901 \textcolor{preprocessor}{    if ( (cache\_ptr)->pl\_len > (cache\_ptr)->max\_pl\_len )                    \(\backslash\)}
00902 \textcolor{preprocessor}{        (cache\_ptr)->max\_pl\_len = (cache\_ptr)->pl\_len;                      \(\backslash\)}
00903 \textcolor{preprocessor}{    if ( (cache\_ptr)->pl\_size > (cache\_ptr)->max\_pl\_size )                  \(\backslash\)}
00904 \textcolor{preprocessor}{        (cache\_ptr)->max\_pl\_size = (cache\_ptr)->pl\_size;                    \(\backslash\)}
00905 \textcolor{preprocessor}{\}}
00906 
00907 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_PIN(cache\_ptr, entry\_ptr)      \(\backslash\)}
00908 \textcolor{preprocessor}{\{                                                            \(\backslash\)}
00909 \textcolor{preprocessor}{    ((cache\_ptr)->pins)[(entry\_ptr)->type->id]++;            \(\backslash\)}
00910 \textcolor{preprocessor}{    if ( (cache\_ptr)->pel\_len > (cache\_ptr)->max\_pel\_len )   \(\backslash\)}
00911 \textcolor{preprocessor}{        (cache\_ptr)->max\_pel\_len = (cache\_ptr)->pel\_len;     \(\backslash\)}
00912 \textcolor{preprocessor}{    if ( (cache\_ptr)->pel\_size > (cache\_ptr)->max\_pel\_size ) \(\backslash\)}
00913 \textcolor{preprocessor}{        (cache\_ptr)->max\_pel\_size = (cache\_ptr)->pel\_size;   \(\backslash\)}
00914 \textcolor{preprocessor}{\}}
00915 
00916 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_COLLECT\_CACHE\_ENTRY\_STATS */}\textcolor{preprocessor}{}
00917 
00918 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_COLLECT\_CACHE\_STATS */}\textcolor{preprocessor}{}
00919 
00920 \textcolor{preprocessor}{#define H5C\_\_RESET\_CACHE\_ENTRY\_STATS(entry\_ptr)}
00921 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_DIRTY\_PIN(cache\_ptr, entry\_ptr)}
00922 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_UNPROTECT(cache\_ptr)}
00923 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_MOVE(cache\_ptr, entry\_ptr)}
00924 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_ENTRY\_SIZE\_CHANGE(cache\_ptr, entry\_ptr, new\_size)}
00925 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_HT\_INSERTION(cache\_ptr)}
00926 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_HT\_DELETION(cache\_ptr)}
00927 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_HT\_SEARCH(cache\_ptr, success, depth)}
00928 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_INSERTION(cache\_ptr, entry\_ptr)}
00929 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_CLEAR(cache\_ptr, entry\_ptr)}
00930 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_FLUSH(cache\_ptr, entry\_ptr)}
00931 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_EVICTION(cache\_ptr, entry\_ptr, take\_ownership)}
00932 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_PROTECT(cache\_ptr, entry\_ptr, hit)}
00933 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_PIN(cache\_ptr, entry\_ptr)}
00934 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_UNPIN(cache\_ptr, entry\_ptr)}
00935 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_SLIST\_SCAN\_RESTART(cache\_ptr)}
00936 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_LRU\_SCAN\_RESTART(cache\_ptr)}
00937 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_INDEX\_SCAN\_RESTART(cache\_ptr)}
00938 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_CACHE\_IMAGE\_CREATE(cache\_ptr)}
00939 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_CACHE\_IMAGE\_READ(cache\_ptr)}
00940 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_CACHE\_IMAGE\_LOAD(cache\_ptr)}
00941 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_PREFETCH(cache\_ptr, dirty)}
00942 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_STATS\_FOR\_PREFETCH\_HIT(cache\_ptr)}
00943 
00944 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_COLLECT\_CACHE\_STATS */}\textcolor{preprocessor}{}
00945 
00946 
00947 \textcolor{comment}{/***********************************************************************}
00948 \textcolor{comment}{ *}
00949 \textcolor{comment}{ * Hash table access and manipulation macros:}
00950 \textcolor{comment}{ *}
00951 \textcolor{comment}{ * The following macros handle searches, insertions, and deletion in}
00952 \textcolor{comment}{ * the hash table.}
00953 \textcolor{comment}{ *}
00954 \textcolor{comment}{ * When modifying these macros, remember to modify the similar macros}
00955 \textcolor{comment}{ * in tst/cache.c}
00956 \textcolor{comment}{ *}
00957 \textcolor{comment}{ * Changes:}
00958 \textcolor{comment}{ *}
00959 \textcolor{comment}{ *   - Updated existing index macros and sanity check macros to maintain}
00960 \textcolor{comment}{ *     the clean\_index\_size and dirty\_index\_size fields of H5C\_t.  Also}
00961 \textcolor{comment}{ *     added macros to allow us to track entry cleans and dirties.}
00962 \textcolor{comment}{ *}
00963 \textcolor{comment}{ *                          JRM -- 11/5/08}
00964 \textcolor{comment}{ *}
00965 \textcolor{comment}{ *   - Updated existing index macros and sanity check macros to maintain }
00966 \textcolor{comment}{ *     the index\_ring\_len, index\_ring\_size, clean\_index\_ring\_size, and}
00967 \textcolor{comment}{ *     dirty\_index\_ring\_size fields of H5C\_t.}
00968 \textcolor{comment}{ *}
00969 \textcolor{comment}{ *                      JRM -- 9/1/15}
00970 \textcolor{comment}{ *}
00971 \textcolor{comment}{ *   - Updated existing index macros and sanity checks macros to }
00972 \textcolor{comment}{ *     maintain an doubly linked list of all entries in the index.}
00973 \textcolor{comment}{ *     This is necessary to reduce the computational cost of visiting}
00974 \textcolor{comment}{ *     all entries in the index, which used to be done by scanning }
00975 \textcolor{comment}{ *     the hash table.}
00976 \textcolor{comment}{ *}
00977 \textcolor{comment}{ *                                              JRM -- 10/15/15}
00978 \textcolor{comment}{ *}
00979 \textcolor{comment}{ ***********************************************************************/}
00980 
00981 \textcolor{comment}{/* H5C\_\_HASH\_TABLE\_LEN is defined in H5Cpkg.h.  It mut be a power of two. */}
00982 
00983 \textcolor{preprocessor}{#define H5C\_\_HASH\_MASK      ((size\_t)(H5C\_\_HASH\_TABLE\_LEN - 1) << 3)}
00984 
00985 \textcolor{preprocessor}{#define H5C\_\_HASH\_FCN(x)    (int)((unsigned)((x) & H5C\_\_HASH\_MASK) >> 3)}
00986 
00987 \textcolor{preprocessor}{#if H5C\_DO\_SANITY\_CHECKS}
00988 
00989 \textcolor{preprocessor}{#define H5C\_\_PRE\_HT\_INSERT\_SC(cache\_ptr, entry\_ptr, fail\_val)           \(\backslash\)}
00990 \textcolor{preprocessor}{if ( ( (cache\_ptr) == NULL ) ||                                         \(\backslash\)}
00991 \textcolor{preprocessor}{     ( (cache\_ptr)->magic != H5C\_\_H5C\_T\_MAGIC ) ||                      \(\backslash\)}
00992 \textcolor{preprocessor}{     ( (entry\_ptr) == NULL ) ||                                         \(\backslash\)}
00993 \textcolor{preprocessor}{     ( ! H5F\_addr\_defined((entry\_ptr)->addr) ) ||                       \(\backslash\)}
00994 \textcolor{preprocessor}{     ( (entry\_ptr)->ht\_next != NULL ) ||                                \(\backslash\)}
00995 \textcolor{preprocessor}{     ( (entry\_ptr)->ht\_prev != NULL ) ||                                \(\backslash\)}
00996 \textcolor{preprocessor}{     ( (entry\_ptr)->size <= 0 ) ||                                      \(\backslash\)}
00997 \textcolor{preprocessor}{     ( H5C\_\_HASH\_FCN((entry\_ptr)->addr) < 0 ) ||                        \(\backslash\)}
00998 \textcolor{preprocessor}{     ( H5C\_\_HASH\_FCN((entry\_ptr)->addr) >= H5C\_\_HASH\_TABLE\_LEN ) ||     \(\backslash\)}
00999 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size !=                                       \(\backslash\)}
01000 \textcolor{preprocessor}{       ((cache\_ptr)->clean\_index\_size +                                 \(\backslash\)}
01001 \textcolor{preprocessor}{    (cache\_ptr)->dirty\_index\_size) ) ||                             \(\backslash\)}
01002 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size < ((cache\_ptr)->clean\_index\_size) ) ||   \(\backslash\)}
01003 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size < ((cache\_ptr)->dirty\_index\_size) ) ||   \(\backslash\)}
01004 \textcolor{preprocessor}{     ( (entry\_ptr)->ring <= H5C\_RING\_UNDEFINED ) ||                     \(\backslash\)}
01005 \textcolor{preprocessor}{     ( (entry\_ptr)->ring >= H5C\_RING\_NTYPES ) ||                        \(\backslash\)}
01006 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_len[(entry\_ptr)->ring] >                 \(\backslash\)}
01007 \textcolor{preprocessor}{       (cache\_ptr)->index\_len ) ||                                      \(\backslash\)}
01008 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] >                \(\backslash\)}
01009 \textcolor{preprocessor}{       (cache\_ptr)->index\_size ) ||                                     \(\backslash\)}
01010 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] !=               \(\backslash\)}
01011 \textcolor{preprocessor}{       ((cache\_ptr)->clean\_index\_ring\_size[(entry\_ptr)->ring] +         \(\backslash\)}
01012 \textcolor{preprocessor}{        (cache\_ptr)->dirty\_index\_ring\_size[(entry\_ptr)->ring]) ) ||     \(\backslash\)}
01013 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_len != (cache\_ptr)->il\_len ) ||               \(\backslash\)}
01014 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size != (cache\_ptr)->il\_size ) ) \{            \(\backslash\)}
01015 \textcolor{preprocessor}{    HDassert(FALSE);                                                    \(\backslash\)}
01016 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, fail\_val, "pre HT insert SC failed") \(\backslash\)}
01017 \textcolor{preprocessor}{\}}
01018 
01019 \textcolor{preprocessor}{#define H5C\_\_POST\_HT\_INSERT\_SC(cache\_ptr, entry\_ptr, fail\_val)          \(\backslash\)}
01020 \textcolor{preprocessor}{if ( ( (cache\_ptr) == NULL ) ||                                         \(\backslash\)}
01021 \textcolor{preprocessor}{     ( (cache\_ptr)->magic != H5C\_\_H5C\_T\_MAGIC ) ||                      \(\backslash\)}
01022 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size !=                                       \(\backslash\)}
01023 \textcolor{preprocessor}{       ((cache\_ptr)->clean\_index\_size +                                 \(\backslash\)}
01024 \textcolor{preprocessor}{    (cache\_ptr)->dirty\_index\_size) ) ||                             \(\backslash\)}
01025 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size < ((cache\_ptr)->clean\_index\_size) ) ||   \(\backslash\)}
01026 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size < ((cache\_ptr)->dirty\_index\_size) ) ||   \(\backslash\)}
01027 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_len[(entry\_ptr)->ring] == 0 ) ||         \(\backslash\)}
01028 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_len[(entry\_ptr)->ring] >                 \(\backslash\)}
01029 \textcolor{preprocessor}{       (cache\_ptr)->index\_len ) ||                                      \(\backslash\)}
01030 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] >                \(\backslash\)}
01031 \textcolor{preprocessor}{       (cache\_ptr)->index\_size ) ||                                     \(\backslash\)}
01032 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] !=               \(\backslash\)}
01033 \textcolor{preprocessor}{       ((cache\_ptr)->clean\_index\_ring\_size[(entry\_ptr)->ring] +         \(\backslash\)}
01034 \textcolor{preprocessor}{        (cache\_ptr)->dirty\_index\_ring\_size[(entry\_ptr)->ring]) ) ||     \(\backslash\)}
01035 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_len != (cache\_ptr)->il\_len ) ||               \(\backslash\)}
01036 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size != (cache\_ptr)->il\_size) ) \{             \(\backslash\)}
01037 \textcolor{preprocessor}{    HDassert(FALSE);                                                    \(\backslash\)}
01038 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, fail\_val, "post HT insert SC failed") \(\backslash\)}
01039 \textcolor{preprocessor}{\}}
01040 
01041 \textcolor{preprocessor}{#define H5C\_\_PRE\_HT\_REMOVE\_SC(cache\_ptr, entry\_ptr)                     \(\backslash\)}
01042 \textcolor{preprocessor}{if ( ( (cache\_ptr) == NULL ) ||                                         \(\backslash\)}
01043 \textcolor{preprocessor}{     ( (cache\_ptr)->magic != H5C\_\_H5C\_T\_MAGIC ) ||                      \(\backslash\)}
01044 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_len < 1 ) ||                                  \(\backslash\)}
01045 \textcolor{preprocessor}{     ( (entry\_ptr) == NULL ) ||                                         \(\backslash\)}
01046 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size < (entry\_ptr)->size ) ||                 \(\backslash\)}
01047 \textcolor{preprocessor}{     ( ! H5F\_addr\_defined((entry\_ptr)->addr) ) ||                       \(\backslash\)}
01048 \textcolor{preprocessor}{     ( (entry\_ptr)->size <= 0 ) ||                                      \(\backslash\)}
01049 \textcolor{preprocessor}{     ( H5C\_\_HASH\_FCN((entry\_ptr)->addr) < 0 ) ||                        \(\backslash\)}
01050 \textcolor{preprocessor}{     ( H5C\_\_HASH\_FCN((entry\_ptr)->addr) >= H5C\_\_HASH\_TABLE\_LEN ) ||     \(\backslash\)}
01051 \textcolor{preprocessor}{     ( ((cache\_ptr)->index)[(H5C\_\_HASH\_FCN((entry\_ptr)->addr))]         \(\backslash\)}
01052 \textcolor{preprocessor}{       == NULL ) ||                                                     \(\backslash\)}
01053 \textcolor{preprocessor}{     ( ( ((cache\_ptr)->index)[(H5C\_\_HASH\_FCN((entry\_ptr)->addr))]       \(\backslash\)}
01054 \textcolor{preprocessor}{       != (entry\_ptr) ) &&                                              \(\backslash\)}
01055 \textcolor{preprocessor}{       ( (entry\_ptr)->ht\_prev == NULL ) ) ||                            \(\backslash\)}
01056 \textcolor{preprocessor}{     ( ( ((cache\_ptr)->index)[(H5C\_\_HASH\_FCN((entry\_ptr)->addr))] ==    \(\backslash\)}
01057 \textcolor{preprocessor}{         (entry\_ptr) ) &&                                               \(\backslash\)}
01058 \textcolor{preprocessor}{       ( (entry\_ptr)->ht\_prev != NULL ) ) ||                            \(\backslash\)}
01059 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size !=                                       \(\backslash\)}
01060 \textcolor{preprocessor}{       ((cache\_ptr)->clean\_index\_size +                                 \(\backslash\)}
01061 \textcolor{preprocessor}{    (cache\_ptr)->dirty\_index\_size) ) ||                             \(\backslash\)}
01062 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size < ((cache\_ptr)->clean\_index\_size) ) ||   \(\backslash\)}
01063 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size < ((cache\_ptr)->dirty\_index\_size) ) ||   \(\backslash\)}
01064 \textcolor{preprocessor}{     ( (entry\_ptr)->ring <= H5C\_RING\_UNDEFINED ) ||                     \(\backslash\)}
01065 \textcolor{preprocessor}{     ( (entry\_ptr)->ring >= H5C\_RING\_NTYPES ) ||                        \(\backslash\)}
01066 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_len[(entry\_ptr)->ring] <= 0 ) ||         \(\backslash\)}
01067 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_len[(entry\_ptr)->ring] >                 \(\backslash\)}
01068 \textcolor{preprocessor}{       (cache\_ptr)->index\_len ) ||                                      \(\backslash\)}
01069 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] <                \(\backslash\)}
01070 \textcolor{preprocessor}{       (entry\_ptr)->size ) ||                                           \(\backslash\)}
01071 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] >                \(\backslash\)}
01072 \textcolor{preprocessor}{       (cache\_ptr)->index\_size ) ||                                     \(\backslash\)}
01073 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] !=               \(\backslash\)}
01074 \textcolor{preprocessor}{       ((cache\_ptr)->clean\_index\_ring\_size[(entry\_ptr)->ring] +         \(\backslash\)}
01075 \textcolor{preprocessor}{        (cache\_ptr)->dirty\_index\_ring\_size[(entry\_ptr)->ring]) ) ||     \(\backslash\)}
01076 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_len != (cache\_ptr)->il\_len ) ||               \(\backslash\)}
01077 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size != (cache\_ptr)->il\_size ) ) \{            \(\backslash\)}
01078 \textcolor{preprocessor}{    HDassert(FALSE);                                                    \(\backslash\)}
01079 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, FAIL, "pre HT remove SC failed") \(\backslash\)}
01080 \textcolor{preprocessor}{\}}
01081 
01082 \textcolor{preprocessor}{#define H5C\_\_POST\_HT\_REMOVE\_SC(cache\_ptr, entry\_ptr)                     \(\backslash\)}
01083 \textcolor{preprocessor}{if ( ( (cache\_ptr) == NULL ) ||                                          \(\backslash\)}
01084 \textcolor{preprocessor}{     ( (cache\_ptr)->magic != H5C\_\_H5C\_T\_MAGIC ) ||                       \(\backslash\)}
01085 \textcolor{preprocessor}{     ( (entry\_ptr) == NULL ) ||                                          \(\backslash\)}
01086 \textcolor{preprocessor}{     ( ! H5F\_addr\_defined((entry\_ptr)->addr) ) ||                        \(\backslash\)}
01087 \textcolor{preprocessor}{     ( (entry\_ptr)->size <= 0 ) ||                                       \(\backslash\)}
01088 \textcolor{preprocessor}{     ( (entry\_ptr)->ht\_prev != NULL ) ||                                 \(\backslash\)}
01089 \textcolor{preprocessor}{     ( (entry\_ptr)->ht\_prev != NULL ) ||                                 \(\backslash\)}
01090 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size !=                                        \(\backslash\)}
01091 \textcolor{preprocessor}{       ((cache\_ptr)->clean\_index\_size +                                  \(\backslash\)}
01092 \textcolor{preprocessor}{    (cache\_ptr)->dirty\_index\_size) ) ||                              \(\backslash\)}
01093 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size < ((cache\_ptr)->clean\_index\_size) ) ||    \(\backslash\)}
01094 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size < ((cache\_ptr)->dirty\_index\_size) ) ||    \(\backslash\)}
01095 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_len[(entry\_ptr)->ring] >                  \(\backslash\)}
01096 \textcolor{preprocessor}{       (cache\_ptr)->index\_len ) ||                                       \(\backslash\)}
01097 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] >                 \(\backslash\)}
01098 \textcolor{preprocessor}{       (cache\_ptr)->index\_size ) ||                                      \(\backslash\)}
01099 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] !=                \(\backslash\)}
01100 \textcolor{preprocessor}{       ((cache\_ptr)->clean\_index\_ring\_size[(entry\_ptr)->ring] +          \(\backslash\)}
01101 \textcolor{preprocessor}{        (cache\_ptr)->dirty\_index\_ring\_size[(entry\_ptr)->ring]) ) ||      \(\backslash\)}
01102 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_len != (cache\_ptr)->il\_len ) ||                \(\backslash\)}
01103 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size != (cache\_ptr)->il\_size ) ) \{             \(\backslash\)}
01104 \textcolor{preprocessor}{    HDassert(FALSE);                                                     \(\backslash\)}
01105 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, FAIL, "post HT remove SC failed") \(\backslash\)}
01106 \textcolor{preprocessor}{\}}
01107 
01108 \textcolor{comment}{/* (Keep in sync w/H5C\_TEST\_\_PRE\_HT\_SEARCH\_SC macro in test/cache\_common.h -QAK) */}
01109 \textcolor{preprocessor}{#define H5C\_\_PRE\_HT\_SEARCH\_SC(cache\_ptr, Addr, fail\_val)                    \(\backslash\)}
01110 \textcolor{preprocessor}{if ( ( (cache\_ptr) == NULL ) ||                                             \(\backslash\)}
01111 \textcolor{preprocessor}{     ( (cache\_ptr)->magic != H5C\_\_H5C\_T\_MAGIC ) ||                          \(\backslash\)}
01112 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size !=                                           \(\backslash\)}
01113 \textcolor{preprocessor}{       ((cache\_ptr)->clean\_index\_size + (cache\_ptr)->dirty\_index\_size) ) || \(\backslash\)}
01114 \textcolor{preprocessor}{     ( ! H5F\_addr\_defined(Addr) ) ||                                        \(\backslash\)}
01115 \textcolor{preprocessor}{     ( H5C\_\_HASH\_FCN(Addr) < 0 ) ||                                         \(\backslash\)}
01116 \textcolor{preprocessor}{     ( H5C\_\_HASH\_FCN(Addr) >= H5C\_\_HASH\_TABLE\_LEN ) ) \{                     \(\backslash\)}
01117 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, fail\_val, "pre HT search SC failed") \(\backslash\)}
01118 \textcolor{preprocessor}{\}}
01119 
01120 \textcolor{comment}{/* (Keep in sync w/H5C\_TEST\_\_POST\_SUC\_HT\_SEARCH\_SC macro in test/cache\_common.h -QAK) */}
01121 \textcolor{preprocessor}{#define H5C\_\_POST\_SUC\_HT\_SEARCH\_SC(cache\_ptr, entry\_ptr, k, fail\_val)       \(\backslash\)}
01122 \textcolor{preprocessor}{if ( ( (cache\_ptr) == NULL ) ||                                             \(\backslash\)}
01123 \textcolor{preprocessor}{     ( (cache\_ptr)->magic != H5C\_\_H5C\_T\_MAGIC ) ||                          \(\backslash\)}
01124 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_len < 1 ) ||                                      \(\backslash\)}
01125 \textcolor{preprocessor}{     ( (entry\_ptr) == NULL ) ||                                             \(\backslash\)}
01126 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size < (entry\_ptr)->size ) ||                     \(\backslash\)}
01127 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size !=                                           \(\backslash\)}
01128 \textcolor{preprocessor}{       ((cache\_ptr)->clean\_index\_size + (cache\_ptr)->dirty\_index\_size) ) || \(\backslash\)}
01129 \textcolor{preprocessor}{     ( (entry\_ptr)->size <= 0 ) ||                                          \(\backslash\)}
01130 \textcolor{preprocessor}{     ( ((cache\_ptr)->index)[k] == NULL ) ||                                 \(\backslash\)}
01131 \textcolor{preprocessor}{     ( ( ((cache\_ptr)->index)[k] != (entry\_ptr) ) &&                        \(\backslash\)}
01132 \textcolor{preprocessor}{       ( (entry\_ptr)->ht\_prev == NULL ) ) ||                                \(\backslash\)}
01133 \textcolor{preprocessor}{     ( ( ((cache\_ptr)->index)[k] == (entry\_ptr) ) &&                        \(\backslash\)}
01134 \textcolor{preprocessor}{       ( (entry\_ptr)->ht\_prev != NULL ) ) ||                                \(\backslash\)}
01135 \textcolor{preprocessor}{     ( ( (entry\_ptr)->ht\_prev != NULL ) &&                                  \(\backslash\)}
01136 \textcolor{preprocessor}{       ( (entry\_ptr)->ht\_prev->ht\_next != (entry\_ptr) ) ) ||                \(\backslash\)}
01137 \textcolor{preprocessor}{     ( ( (entry\_ptr)->ht\_next != NULL ) &&                                  \(\backslash\)}
01138 \textcolor{preprocessor}{       ( (entry\_ptr)->ht\_next->ht\_prev != (entry\_ptr) ) ) ) \{               \(\backslash\)}
01139 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, fail\_val, "post successful HT search SC failed") \(\backslash\)}
01140 \textcolor{preprocessor}{\}}
01141 
01142 \textcolor{comment}{/* (Keep in sync w/H5C\_TEST\_\_POST\_HT\_SHIFT\_TO\_FRONT macro in test/cache\_common.h -QAK) */}
01143 \textcolor{preprocessor}{#define H5C\_\_POST\_HT\_SHIFT\_TO\_FRONT(cache\_ptr, entry\_ptr, k, fail\_val) \(\backslash\)}
01144 \textcolor{preprocessor}{if ( ( (cache\_ptr) == NULL ) ||                                        \(\backslash\)}
01145 \textcolor{preprocessor}{     ( ((cache\_ptr)->index)[k] != (entry\_ptr) ) ||                     \(\backslash\)}
01146 \textcolor{preprocessor}{     ( (entry\_ptr)->ht\_prev != NULL ) ) \{                              \(\backslash\)}
01147 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, fail\_val, "post HT shift to front SC failed") \(\backslash\)}
01148 \textcolor{preprocessor}{\}}
01149 
01150 \textcolor{preprocessor}{#define H5C\_\_PRE\_HT\_ENTRY\_SIZE\_CHANGE\_SC(cache\_ptr, old\_size, new\_size, \(\backslash\)}
01151 \textcolor{preprocessor}{                                 entry\_ptr, was\_clean)          \(\backslash\)}
01152 \textcolor{preprocessor}{if ( ( (cache\_ptr) == NULL ) ||                                         \(\backslash\)}
01153 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_len <= 0 ) ||                                 \(\backslash\)}
01154 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size <= 0 ) ||                                \(\backslash\)}
01155 \textcolor{preprocessor}{     ( (new\_size) <= 0 ) ||                                             \(\backslash\)}
01156 \textcolor{preprocessor}{     ( (old\_size) > (cache\_ptr)->index\_size ) ||                        \(\backslash\)}
01157 \textcolor{preprocessor}{     ( ( (cache\_ptr)->index\_len == 1 ) &&                               \(\backslash\)}
01158 \textcolor{preprocessor}{       ( (cache\_ptr)->index\_size != (old\_size) ) ) ||                   \(\backslash\)}
01159 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size !=                                       \(\backslash\)}
01160 \textcolor{preprocessor}{       ((cache\_ptr)->clean\_index\_size +                                 \(\backslash\)}
01161 \textcolor{preprocessor}{        (cache\_ptr)->dirty\_index\_size) ) ||                             \(\backslash\)}
01162 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size < ((cache\_ptr)->clean\_index\_size) ) ||   \(\backslash\)}
01163 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size < ((cache\_ptr)->dirty\_index\_size) ) ||   \(\backslash\)}
01164 \textcolor{preprocessor}{     ( ( !( was\_clean ) ||                                              \(\backslash\)}
01165 \textcolor{preprocessor}{        ( (cache\_ptr)->clean\_index\_size < (old\_size) ) ) &&         \(\backslash\)}
01166 \textcolor{preprocessor}{      ( ( (was\_clean) ) ||                                          \(\backslash\)}
01167 \textcolor{preprocessor}{        ( (cache\_ptr)->dirty\_index\_size < (old\_size) ) ) ) ||       \(\backslash\)}
01168 \textcolor{preprocessor}{     ( (entry\_ptr) == NULL ) ||                                         \(\backslash\)}
01169 \textcolor{preprocessor}{     ( (entry\_ptr)->ring <= H5C\_RING\_UNDEFINED ) ||                     \(\backslash\)}
01170 \textcolor{preprocessor}{     ( (entry\_ptr)->ring >= H5C\_RING\_NTYPES ) ||                        \(\backslash\)}
01171 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_len[(entry\_ptr)->ring] <= 0 ) ||         \(\backslash\)}
01172 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_len[(entry\_ptr)->ring] >                 \(\backslash\)}
01173 \textcolor{preprocessor}{       (cache\_ptr)->index\_len ) ||                                      \(\backslash\)}
01174 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] >                \(\backslash\)}
01175 \textcolor{preprocessor}{       (cache\_ptr)->index\_size ) ||                                     \(\backslash\)}
01176 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] !=               \(\backslash\)}
01177 \textcolor{preprocessor}{       ((cache\_ptr)->clean\_index\_ring\_size[(entry\_ptr)->ring] +         \(\backslash\)}
01178 \textcolor{preprocessor}{        (cache\_ptr)->dirty\_index\_ring\_size[(entry\_ptr)->ring]) ) ||     \(\backslash\)}
01179 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_len != (cache\_ptr)->il\_len ) ||               \(\backslash\)}
01180 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size != (cache\_ptr)->il\_size ) ) \{            \(\backslash\)}
01181 \textcolor{preprocessor}{    HDassert(FALSE);                                                    \(\backslash\)}
01182 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, FAIL, "pre HT entry size change SC failed") \(\backslash\)}
01183 \textcolor{preprocessor}{\}}
01184 
01185 \textcolor{preprocessor}{#define H5C\_\_POST\_HT\_ENTRY\_SIZE\_CHANGE\_SC(cache\_ptr, old\_size, new\_size,  \(\backslash\)}
01186 \textcolor{preprocessor}{                                  entry\_ptr)                      \(\backslash\)}
01187 \textcolor{preprocessor}{if ( ( (cache\_ptr) == NULL ) ||                                           \(\backslash\)}
01188 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_len <= 0 ) ||                                   \(\backslash\)}
01189 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size <= 0 ) ||                                  \(\backslash\)}
01190 \textcolor{preprocessor}{     ( (new\_size) > (cache\_ptr)->index\_size ) ||                          \(\backslash\)}
01191 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size !=                                         \(\backslash\)}
01192 \textcolor{preprocessor}{      ((cache\_ptr)->clean\_index\_size +                                \(\backslash\)}
01193 \textcolor{preprocessor}{           (cache\_ptr)->dirty\_index\_size) ) ||                            \(\backslash\)}
01194 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size < ((cache\_ptr)->clean\_index\_size) ) ||     \(\backslash\)}
01195 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size < ((cache\_ptr)->dirty\_index\_size) ) ||     \(\backslash\)}
01196 \textcolor{preprocessor}{     ( ( !((entry\_ptr)->is\_dirty ) ||                                     \(\backslash\)}
01197 \textcolor{preprocessor}{        ( (cache\_ptr)->dirty\_index\_size < (new\_size) ) ) &&           \(\backslash\)}
01198 \textcolor{preprocessor}{      ( ( ((entry\_ptr)->is\_dirty)  ) ||                               \(\backslash\)}
01199 \textcolor{preprocessor}{        ( (cache\_ptr)->clean\_index\_size < (new\_size) ) ) ) ||         \(\backslash\)}
01200 \textcolor{preprocessor}{     ( ( (cache\_ptr)->index\_len == 1 ) &&                                 \(\backslash\)}
01201 \textcolor{preprocessor}{       ( (cache\_ptr)->index\_size != (new\_size) ) ) ||                     \(\backslash\)}
01202 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_len[(entry\_ptr)->ring] >                   \(\backslash\)}
01203 \textcolor{preprocessor}{       (cache\_ptr)->index\_len ) ||                                        \(\backslash\)}
01204 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] >                  \(\backslash\)}
01205 \textcolor{preprocessor}{       (cache\_ptr)->index\_size ) ||                                       \(\backslash\)}
01206 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] !=                 \(\backslash\)}
01207 \textcolor{preprocessor}{       ((cache\_ptr)->clean\_index\_ring\_size[(entry\_ptr)->ring] +           \(\backslash\)}
01208 \textcolor{preprocessor}{        (cache\_ptr)->dirty\_index\_ring\_size[(entry\_ptr)->ring]) ) ||       \(\backslash\)}
01209 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_len != (cache\_ptr)->il\_len ) ||                 \(\backslash\)}
01210 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size != (cache\_ptr)->il\_size ) ) \{              \(\backslash\)}
01211 \textcolor{preprocessor}{    HDassert(FALSE);                                                      \(\backslash\)}
01212 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, FAIL, "post HT entry size change SC failed") \(\backslash\)}
01213 \textcolor{preprocessor}{\}}
01214 
01215 \textcolor{preprocessor}{#define H5C\_\_PRE\_HT\_UPDATE\_FOR\_ENTRY\_CLEAN\_SC(cache\_ptr, entry\_ptr)           \(\backslash\)}
01216 \textcolor{preprocessor}{if (                                                                          \(\backslash\)}
01217 \textcolor{preprocessor}{    ( (cache\_ptr) == NULL ) ||                                                \(\backslash\)}
01218 \textcolor{preprocessor}{    ( (cache\_ptr)->magic != H5C\_\_H5C\_T\_MAGIC ) ||                             \(\backslash\)}
01219 \textcolor{preprocessor}{    ( (cache\_ptr)->index\_len <= 0 ) ||                                        \(\backslash\)}
01220 \textcolor{preprocessor}{    ( (entry\_ptr) == NULL ) ||                                                \(\backslash\)}
01221 \textcolor{preprocessor}{    ( (entry\_ptr)->is\_dirty != FALSE ) ||                                     \(\backslash\)}
01222 \textcolor{preprocessor}{    ( (cache\_ptr)->index\_size < (entry\_ptr)->size ) ||                        \(\backslash\)}
01223 \textcolor{preprocessor}{    ( (cache\_ptr)->dirty\_index\_size < (entry\_ptr)->size ) ||                  \(\backslash\)}
01224 \textcolor{preprocessor}{    ( (cache\_ptr)->index\_size !=                                              \(\backslash\)}
01225 \textcolor{preprocessor}{       ((cache\_ptr)->clean\_index\_size + (cache\_ptr)->dirty\_index\_size) ) ||   \(\backslash\)}
01226 \textcolor{preprocessor}{    ( (cache\_ptr)->index\_size < ((cache\_ptr)->clean\_index\_size) ) ||          \(\backslash\)}
01227 \textcolor{preprocessor}{    ( (cache\_ptr)->index\_size < ((cache\_ptr)->dirty\_index\_size) ) ||          \(\backslash\)}
01228 \textcolor{preprocessor}{    ( (entry\_ptr)->ring <= H5C\_RING\_UNDEFINED ) ||                            \(\backslash\)}
01229 \textcolor{preprocessor}{    ( (entry\_ptr)->ring >= H5C\_RING\_NTYPES ) ||                               \(\backslash\)}
01230 \textcolor{preprocessor}{    ( (cache\_ptr)->index\_ring\_len[(entry\_ptr)->ring] <= 0 ) ||                \(\backslash\)}
01231 \textcolor{preprocessor}{    ( (cache\_ptr)->index\_ring\_len[(entry\_ptr)->ring] >                        \(\backslash\)}
01232 \textcolor{preprocessor}{      (cache\_ptr)->index\_len ) ||                                             \(\backslash\)}
01233 \textcolor{preprocessor}{    ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] >                       \(\backslash\)}
01234 \textcolor{preprocessor}{      (cache\_ptr)->index\_size ) ||                                            \(\backslash\)}
01235 \textcolor{preprocessor}{    ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] !=                      \(\backslash\)}
01236 \textcolor{preprocessor}{      ((cache\_ptr)->clean\_index\_ring\_size[(entry\_ptr)->ring] +                \(\backslash\)}
01237 \textcolor{preprocessor}{       (cache\_ptr)->dirty\_index\_ring\_size[(entry\_ptr)->ring]) ) ) \{           \(\backslash\)}
01238 \textcolor{preprocessor}{    HDassert(FALSE);                                                          \(\backslash\)}
01239 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, FAIL, "pre HT update for entry clean SC failed") \(\backslash\)}
01240 \textcolor{preprocessor}{\}}
01241 
01242 \textcolor{preprocessor}{#define H5C\_\_PRE\_HT\_UPDATE\_FOR\_ENTRY\_DIRTY\_SC(cache\_ptr, entry\_ptr)           \(\backslash\)}
01243 \textcolor{preprocessor}{if (                                                                          \(\backslash\)}
01244 \textcolor{preprocessor}{    ( (cache\_ptr) == NULL ) ||                                                \(\backslash\)}
01245 \textcolor{preprocessor}{    ( (cache\_ptr)->magic != H5C\_\_H5C\_T\_MAGIC ) ||                             \(\backslash\)}
01246 \textcolor{preprocessor}{    ( (cache\_ptr)->index\_len <= 0 ) ||                                        \(\backslash\)}
01247 \textcolor{preprocessor}{    ( (entry\_ptr) == NULL ) ||                                                \(\backslash\)}
01248 \textcolor{preprocessor}{    ( (entry\_ptr)->is\_dirty != TRUE ) ||                                      \(\backslash\)}
01249 \textcolor{preprocessor}{    ( (cache\_ptr)->index\_size < (entry\_ptr)->size ) ||                        \(\backslash\)}
01250 \textcolor{preprocessor}{    ( (cache\_ptr)->clean\_index\_size < (entry\_ptr)->size ) ||                  \(\backslash\)}
01251 \textcolor{preprocessor}{    ( (cache\_ptr)->index\_size !=                                              \(\backslash\)}
01252 \textcolor{preprocessor}{       ((cache\_ptr)->clean\_index\_size + (cache\_ptr)->dirty\_index\_size) ) ||   \(\backslash\)}
01253 \textcolor{preprocessor}{    ( (cache\_ptr)->index\_size < ((cache\_ptr)->clean\_index\_size) ) ||          \(\backslash\)}
01254 \textcolor{preprocessor}{    ( (cache\_ptr)->index\_size < ((cache\_ptr)->dirty\_index\_size) ) ||          \(\backslash\)}
01255 \textcolor{preprocessor}{    ( (entry\_ptr)->ring <= H5C\_RING\_UNDEFINED ) ||                            \(\backslash\)}
01256 \textcolor{preprocessor}{    ( (entry\_ptr)->ring >= H5C\_RING\_NTYPES ) ||                               \(\backslash\)}
01257 \textcolor{preprocessor}{    ( (cache\_ptr)->index\_ring\_len[(entry\_ptr)->ring] <= 0 ) ||                \(\backslash\)}
01258 \textcolor{preprocessor}{    ( (cache\_ptr)->index\_ring\_len[(entry\_ptr)->ring] >                        \(\backslash\)}
01259 \textcolor{preprocessor}{      (cache\_ptr)->index\_len ) ||                                             \(\backslash\)}
01260 \textcolor{preprocessor}{    ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] >                       \(\backslash\)}
01261 \textcolor{preprocessor}{      (cache\_ptr)->index\_size ) ||                                            \(\backslash\)}
01262 \textcolor{preprocessor}{    ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] !=                      \(\backslash\)}
01263 \textcolor{preprocessor}{      ((cache\_ptr)->clean\_index\_ring\_size[(entry\_ptr)->ring] +                \(\backslash\)}
01264 \textcolor{preprocessor}{       (cache\_ptr)->dirty\_index\_ring\_size[(entry\_ptr)->ring]) ) ) \{           \(\backslash\)}
01265 \textcolor{preprocessor}{    HDassert(FALSE);                                                          \(\backslash\)}
01266 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, FAIL, "pre HT update for entry dirty SC failed") \(\backslash\)}
01267 \textcolor{preprocessor}{\}}
01268 
01269 \textcolor{preprocessor}{#define H5C\_\_POST\_HT\_UPDATE\_FOR\_ENTRY\_CLEAN\_SC(cache\_ptr, entry\_ptr)        \(\backslash\)}
01270 \textcolor{preprocessor}{if ( ( (cache\_ptr)->index\_size !=                                           \(\backslash\)}
01271 \textcolor{preprocessor}{       ((cache\_ptr)->clean\_index\_size + (cache\_ptr)->dirty\_index\_size) ) || \(\backslash\)}
01272 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size < ((cache\_ptr)->clean\_index\_size) ) ||       \(\backslash\)}
01273 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size < ((cache\_ptr)->dirty\_index\_size) ) ||       \(\backslash\)}
01274 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_len[(entry\_ptr)->ring] >                     \(\backslash\)}
01275 \textcolor{preprocessor}{       (cache\_ptr)->index\_len ) ||                                          \(\backslash\)}
01276 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] >                    \(\backslash\)}
01277 \textcolor{preprocessor}{       (cache\_ptr)->index\_size ) ||                                         \(\backslash\)}
01278 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] !=                   \(\backslash\)}
01279 \textcolor{preprocessor}{       ((cache\_ptr)->clean\_index\_ring\_size[(entry\_ptr)->ring] +             \(\backslash\)}
01280 \textcolor{preprocessor}{        (cache\_ptr)->dirty\_index\_ring\_size[(entry\_ptr)->ring]) ) ) \{        \(\backslash\)}
01281 \textcolor{preprocessor}{    HDassert(FALSE);                                                        \(\backslash\)}
01282 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, FAIL, "post HT update for entry clean SC failed") \(\backslash\)}
01283 \textcolor{preprocessor}{\}}
01284 
01285 \textcolor{preprocessor}{#define H5C\_\_POST\_HT\_UPDATE\_FOR\_ENTRY\_DIRTY\_SC(cache\_ptr, entry\_ptr)        \(\backslash\)}
01286 \textcolor{preprocessor}{if ( ( (cache\_ptr)->index\_size !=                                           \(\backslash\)}
01287 \textcolor{preprocessor}{       ((cache\_ptr)->clean\_index\_size + (cache\_ptr)->dirty\_index\_size) ) || \(\backslash\)}
01288 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size < ((cache\_ptr)->clean\_index\_size) ) ||       \(\backslash\)}
01289 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_size < ((cache\_ptr)->dirty\_index\_size) ) ||       \(\backslash\)}
01290 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_len[(entry\_ptr)->ring] >                     \(\backslash\)}
01291 \textcolor{preprocessor}{       (cache\_ptr)->index\_len ) ||                                          \(\backslash\)}
01292 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] >                    \(\backslash\)}
01293 \textcolor{preprocessor}{       (cache\_ptr)->index\_size ) ||                                         \(\backslash\)}
01294 \textcolor{preprocessor}{     ( (cache\_ptr)->index\_ring\_size[(entry\_ptr)->ring] !=                   \(\backslash\)}
01295 \textcolor{preprocessor}{       ((cache\_ptr)->clean\_index\_ring\_size[(entry\_ptr)->ring] +             \(\backslash\)}
01296 \textcolor{preprocessor}{        (cache\_ptr)->dirty\_index\_ring\_size[(entry\_ptr)->ring]) ) ) \{        \(\backslash\)}
01297 \textcolor{preprocessor}{    HDassert(FALSE);                                                        \(\backslash\)}
01298 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, FAIL, "post HT update for entry dirty SC failed") \(\backslash\)}
01299 \textcolor{preprocessor}{\}}
01300 
01301 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_DO\_SANITY\_CHECKS */}\textcolor{preprocessor}{}
01302 
01303 \textcolor{preprocessor}{#define H5C\_\_PRE\_HT\_INSERT\_SC(cache\_ptr, entry\_ptr, fail\_val)}
01304 \textcolor{preprocessor}{#define H5C\_\_POST\_HT\_INSERT\_SC(cache\_ptr, entry\_ptr, fail\_val)}
01305 \textcolor{preprocessor}{#define H5C\_\_PRE\_HT\_REMOVE\_SC(cache\_ptr, entry\_ptr)}
01306 \textcolor{preprocessor}{#define H5C\_\_POST\_HT\_REMOVE\_SC(cache\_ptr, entry\_ptr)}
01307 \textcolor{preprocessor}{#define H5C\_\_PRE\_HT\_SEARCH\_SC(cache\_ptr, Addr, fail\_val)}
01308 \textcolor{preprocessor}{#define H5C\_\_POST\_SUC\_HT\_SEARCH\_SC(cache\_ptr, entry\_ptr, k, fail\_val)}
01309 \textcolor{preprocessor}{#define H5C\_\_POST\_HT\_SHIFT\_TO\_FRONT(cache\_ptr, entry\_ptr, k, fail\_val)}
01310 \textcolor{preprocessor}{#define H5C\_\_PRE\_HT\_UPDATE\_FOR\_ENTRY\_CLEAN\_SC(cache\_ptr, entry\_ptr)}
01311 \textcolor{preprocessor}{#define H5C\_\_PRE\_HT\_UPDATE\_FOR\_ENTRY\_DIRTY\_SC(cache\_ptr, entry\_ptr)}
01312 \textcolor{preprocessor}{#define H5C\_\_PRE\_HT\_ENTRY\_SIZE\_CHANGE\_SC(cache\_ptr, old\_size, new\_size, \(\backslash\)}
01313 \textcolor{preprocessor}{                                 entry\_ptr, was\_clean)}
01314 \textcolor{preprocessor}{#define H5C\_\_POST\_HT\_ENTRY\_SIZE\_CHANGE\_SC(cache\_ptr, old\_size, new\_size, \(\backslash\)}
01315 \textcolor{preprocessor}{                                  entry\_ptr)}
01316 \textcolor{preprocessor}{#define H5C\_\_POST\_HT\_UPDATE\_FOR\_ENTRY\_CLEAN\_SC(cache\_ptr, entry\_ptr)}
01317 \textcolor{preprocessor}{#define H5C\_\_POST\_HT\_UPDATE\_FOR\_ENTRY\_DIRTY\_SC(cache\_ptr, entry\_ptr)}
01318 
01319 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_DO\_SANITY\_CHECKS */}\textcolor{preprocessor}{}
01320 
01321 
01322 \textcolor{preprocessor}{#define H5C\_\_INSERT\_IN\_INDEX(cache\_ptr, entry\_ptr, fail\_val)                 \(\backslash\)}
01323 \textcolor{preprocessor}{\{                                                                            \(\backslash\)}
01324 \textcolor{preprocessor}{    int k;                                                                   \(\backslash\)}
01325 \textcolor{preprocessor}{    H5C\_\_PRE\_HT\_INSERT\_SC(cache\_ptr, entry\_ptr, fail\_val)                    \(\backslash\)}
01326 \textcolor{preprocessor}{    k = H5C\_\_HASH\_FCN((entry\_ptr)->addr);                                    \(\backslash\)}
01327 \textcolor{preprocessor}{    if(((cache\_ptr)->index)[k] != NULL) \{                                    \(\backslash\)}
01328 \textcolor{preprocessor}{        (entry\_ptr)->ht\_next = ((cache\_ptr)->index)[k];                      \(\backslash\)}
01329 \textcolor{preprocessor}{        (entry\_ptr)->ht\_next->ht\_prev = (entry\_ptr);                         \(\backslash\)}
01330 \textcolor{preprocessor}{    \}                                                                        \(\backslash\)}
01331 \textcolor{preprocessor}{    ((cache\_ptr)->index)[k] = (entry\_ptr);                                   \(\backslash\)}
01332 \textcolor{preprocessor}{    (cache\_ptr)->index\_len++;                                                \(\backslash\)}
01333 \textcolor{preprocessor}{    (cache\_ptr)->index\_size += (entry\_ptr)->size;                            \(\backslash\)}
01334 \textcolor{preprocessor}{    ((cache\_ptr)->index\_ring\_len[entry\_ptr->ring])++;                        \(\backslash\)}
01335 \textcolor{preprocessor}{    ((cache\_ptr)->index\_ring\_size[entry\_ptr->ring])                          \(\backslash\)}
01336 \textcolor{preprocessor}{            += (entry\_ptr)->size;                                            \(\backslash\)}
01337 \textcolor{preprocessor}{    if((entry\_ptr)->is\_dirty) \{                                              \(\backslash\)}
01338 \textcolor{preprocessor}{        (cache\_ptr)->dirty\_index\_size += (entry\_ptr)->size;                  \(\backslash\)}
01339 \textcolor{preprocessor}{        ((cache\_ptr)->dirty\_index\_ring\_size[entry\_ptr->ring])                \(\backslash\)}
01340 \textcolor{preprocessor}{                += (entry\_ptr)->size;                                        \(\backslash\)}
01341 \textcolor{preprocessor}{    \} else \{                                                                 \(\backslash\)}
01342 \textcolor{preprocessor}{        (cache\_ptr)->clean\_index\_size += (entry\_ptr)->size;                  \(\backslash\)}
01343 \textcolor{preprocessor}{        ((cache\_ptr)->clean\_index\_ring\_size[entry\_ptr->ring])                \(\backslash\)}
01344 \textcolor{preprocessor}{                += (entry\_ptr)->size;                                        \(\backslash\)}
01345 \textcolor{preprocessor}{    \}                                                                        \(\backslash\)}
01346 \textcolor{preprocessor}{    if((entry\_ptr)->flush\_me\_last) \{                                         \(\backslash\)}
01347 \textcolor{preprocessor}{        (cache\_ptr)->num\_last\_entries++;                                     \(\backslash\)}
01348 \textcolor{preprocessor}{        HDassert((cache\_ptr)->num\_last\_entries <= 2);                        \(\backslash\)}
01349 \textcolor{preprocessor}{    \}                                                                        \(\backslash\)}
01350 \textcolor{preprocessor}{    H5C\_\_IL\_DLL\_APPEND((entry\_ptr), (cache\_ptr)->il\_head,                    \(\backslash\)}
01351 \textcolor{preprocessor}{                       (cache\_ptr)->il\_tail, (cache\_ptr)->il\_len,            \(\backslash\)}
01352 \textcolor{preprocessor}{                       (cache\_ptr)->il\_size, fail\_val)                       \(\backslash\)}
01353 \textcolor{preprocessor}{    H5C\_\_UPDATE\_STATS\_FOR\_HT\_INSERTION(cache\_ptr)                            \(\backslash\)}
01354 \textcolor{preprocessor}{    H5C\_\_POST\_HT\_INSERT\_SC(cache\_ptr, entry\_ptr, fail\_val)                   \(\backslash\)}
01355 \textcolor{preprocessor}{\}}
01356 
01357 \textcolor{preprocessor}{#define H5C\_\_DELETE\_FROM\_INDEX(cache\_ptr, entry\_ptr, fail\_val)               \(\backslash\)}
01358 \textcolor{preprocessor}{\{                                                                            \(\backslash\)}
01359 \textcolor{preprocessor}{    int k;                                                                   \(\backslash\)}
01360 \textcolor{preprocessor}{    H5C\_\_PRE\_HT\_REMOVE\_SC(cache\_ptr, entry\_ptr)                              \(\backslash\)}
01361 \textcolor{preprocessor}{    k = H5C\_\_HASH\_FCN((entry\_ptr)->addr);                                    \(\backslash\)}
01362 \textcolor{preprocessor}{    if((entry\_ptr)->ht\_next)                                                 \(\backslash\)}
01363 \textcolor{preprocessor}{        (entry\_ptr)->ht\_next->ht\_prev = (entry\_ptr)->ht\_prev;                \(\backslash\)}
01364 \textcolor{preprocessor}{    if((entry\_ptr)->ht\_prev)                                                 \(\backslash\)}
01365 \textcolor{preprocessor}{        (entry\_ptr)->ht\_prev->ht\_next = (entry\_ptr)->ht\_next;                \(\backslash\)}
01366 \textcolor{preprocessor}{    if(((cache\_ptr)->index)[k] == (entry\_ptr))                               \(\backslash\)}
01367 \textcolor{preprocessor}{        ((cache\_ptr)->index)[k] = (entry\_ptr)->ht\_next;                      \(\backslash\)}
01368 \textcolor{preprocessor}{    (entry\_ptr)->ht\_next = NULL;                                             \(\backslash\)}
01369 \textcolor{preprocessor}{    (entry\_ptr)->ht\_prev = NULL;                                             \(\backslash\)}
01370 \textcolor{preprocessor}{    (cache\_ptr)->index\_len--;                                                \(\backslash\)}
01371 \textcolor{preprocessor}{    (cache\_ptr)->index\_size -= (entry\_ptr)->size;                            \(\backslash\)}
01372 \textcolor{preprocessor}{    ((cache\_ptr)->index\_ring\_len[entry\_ptr->ring])--;                        \(\backslash\)}
01373 \textcolor{preprocessor}{    ((cache\_ptr)->index\_ring\_size[entry\_ptr->ring])                          \(\backslash\)}
01374 \textcolor{preprocessor}{            -= (entry\_ptr)->size;                                            \(\backslash\)}
01375 \textcolor{preprocessor}{    if((entry\_ptr)->is\_dirty) \{                                              \(\backslash\)}
01376 \textcolor{preprocessor}{        (cache\_ptr)->dirty\_index\_size -= (entry\_ptr)->size;                  \(\backslash\)}
01377 \textcolor{preprocessor}{        ((cache\_ptr)->dirty\_index\_ring\_size[entry\_ptr->ring])                \(\backslash\)}
01378 \textcolor{preprocessor}{                -= (entry\_ptr)->size;                                        \(\backslash\)}
01379 \textcolor{preprocessor}{    \} else \{                                                                 \(\backslash\)}
01380 \textcolor{preprocessor}{        (cache\_ptr)->clean\_index\_size -= (entry\_ptr)->size;                  \(\backslash\)}
01381 \textcolor{preprocessor}{        ((cache\_ptr)->clean\_index\_ring\_size[entry\_ptr->ring])                \(\backslash\)}
01382 \textcolor{preprocessor}{                -= (entry\_ptr)->size;                                        \(\backslash\)}
01383 \textcolor{preprocessor}{    \}                                                                        \(\backslash\)}
01384 \textcolor{preprocessor}{    if((entry\_ptr)->flush\_me\_last) \{                                         \(\backslash\)}
01385 \textcolor{preprocessor}{        (cache\_ptr)->num\_last\_entries--;                                     \(\backslash\)}
01386 \textcolor{preprocessor}{        HDassert((cache\_ptr)->num\_last\_entries <= 1);                        \(\backslash\)}
01387 \textcolor{preprocessor}{    \}                                                                        \(\backslash\)}
01388 \textcolor{preprocessor}{    H5C\_\_IL\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->il\_head,                    \(\backslash\)}
01389 \textcolor{preprocessor}{                       (cache\_ptr)->il\_tail, (cache\_ptr)->il\_len,            \(\backslash\)}
01390 \textcolor{preprocessor}{                       (cache\_ptr)->il\_size, fail\_val)                       \(\backslash\)}
01391 \textcolor{preprocessor}{    H5C\_\_UPDATE\_STATS\_FOR\_HT\_DELETION(cache\_ptr)                             \(\backslash\)}
01392 \textcolor{preprocessor}{    H5C\_\_POST\_HT\_REMOVE\_SC(cache\_ptr, entry\_ptr)                             \(\backslash\)}
01393 \textcolor{preprocessor}{\}}
01394 
01395 \textcolor{preprocessor}{#define H5C\_\_SEARCH\_INDEX(cache\_ptr, Addr, entry\_ptr, fail\_val)             \(\backslash\)}
01396 \textcolor{preprocessor}{\{                                                                           \(\backslash\)}
01397 \textcolor{preprocessor}{    int k;                                                                  \(\backslash\)}
01398 \textcolor{preprocessor}{    int depth = 0;                                                          \(\backslash\)}
01399 \textcolor{preprocessor}{    H5C\_\_PRE\_HT\_SEARCH\_SC(cache\_ptr, Addr, fail\_val)                        \(\backslash\)}
01400 \textcolor{preprocessor}{    k = H5C\_\_HASH\_FCN(Addr);                                                \(\backslash\)}
01401 \textcolor{preprocessor}{    entry\_ptr = ((cache\_ptr)->index)[k];                                    \(\backslash\)}
01402 \textcolor{preprocessor}{    while(entry\_ptr) \{                                                      \(\backslash\)}
01403 \textcolor{preprocessor}{        if(H5F\_addr\_eq(Addr, (entry\_ptr)->addr)) \{                          \(\backslash\)}
01404 \textcolor{preprocessor}{            H5C\_\_POST\_SUC\_HT\_SEARCH\_SC(cache\_ptr, entry\_ptr, k, fail\_val)   \(\backslash\)}
01405 \textcolor{preprocessor}{            if(entry\_ptr != ((cache\_ptr)->index)[k]) \{                      \(\backslash\)}
01406 \textcolor{preprocessor}{                if((entry\_ptr)->ht\_next)                                    \(\backslash\)}
01407 \textcolor{preprocessor}{                    (entry\_ptr)->ht\_next->ht\_prev = (entry\_ptr)->ht\_prev;   \(\backslash\)}
01408 \textcolor{preprocessor}{                HDassert((entry\_ptr)->ht\_prev != NULL);                     \(\backslash\)}
01409 \textcolor{preprocessor}{                (entry\_ptr)->ht\_prev->ht\_next = (entry\_ptr)->ht\_next;       \(\backslash\)}
01410 \textcolor{preprocessor}{                ((cache\_ptr)->index)[k]->ht\_prev = (entry\_ptr);             \(\backslash\)}
01411 \textcolor{preprocessor}{                (entry\_ptr)->ht\_next = ((cache\_ptr)->index)[k];             \(\backslash\)}
01412 \textcolor{preprocessor}{                (entry\_ptr)->ht\_prev = NULL;                                \(\backslash\)}
01413 \textcolor{preprocessor}{                ((cache\_ptr)->index)[k] = (entry\_ptr);                      \(\backslash\)}
01414 \textcolor{preprocessor}{                H5C\_\_POST\_HT\_SHIFT\_TO\_FRONT(cache\_ptr, entry\_ptr, k, fail\_val) \(\backslash\)}
01415 \textcolor{preprocessor}{            \}                                                               \(\backslash\)}
01416 \textcolor{preprocessor}{            break;                                                          \(\backslash\)}
01417 \textcolor{preprocessor}{        \}                                                                   \(\backslash\)}
01418 \textcolor{preprocessor}{        (entry\_ptr) = (entry\_ptr)->ht\_next;                                 \(\backslash\)}
01419 \textcolor{preprocessor}{        (depth)++;                                                          \(\backslash\)}
01420 \textcolor{preprocessor}{    \}                                                                       \(\backslash\)}
01421 \textcolor{preprocessor}{    H5C\_\_UPDATE\_STATS\_FOR\_HT\_SEARCH(cache\_ptr, (entry\_ptr != NULL), depth)  \(\backslash\)}
01422 \textcolor{preprocessor}{\}}
01423 
01424 \textcolor{preprocessor}{#define H5C\_\_SEARCH\_INDEX\_NO\_STATS(cache\_ptr, Addr, entry\_ptr, fail\_val)    \(\backslash\)}
01425 \textcolor{preprocessor}{\{                                                                           \(\backslash\)}
01426 \textcolor{preprocessor}{    int k;                                                                  \(\backslash\)}
01427 \textcolor{preprocessor}{    H5C\_\_PRE\_HT\_SEARCH\_SC(cache\_ptr, Addr, fail\_val)                        \(\backslash\)}
01428 \textcolor{preprocessor}{    k = H5C\_\_HASH\_FCN(Addr);                                                \(\backslash\)}
01429 \textcolor{preprocessor}{    entry\_ptr = ((cache\_ptr)->index)[k];                                    \(\backslash\)}
01430 \textcolor{preprocessor}{    while(entry\_ptr) \{                                                      \(\backslash\)}
01431 \textcolor{preprocessor}{        if(H5F\_addr\_eq(Addr, (entry\_ptr)->addr)) \{                          \(\backslash\)}
01432 \textcolor{preprocessor}{            H5C\_\_POST\_SUC\_HT\_SEARCH\_SC(cache\_ptr, entry\_ptr, k, fail\_val)   \(\backslash\)}
01433 \textcolor{preprocessor}{            if(entry\_ptr != ((cache\_ptr)->index)[k]) \{                      \(\backslash\)}
01434 \textcolor{preprocessor}{                if((entry\_ptr)->ht\_next)                                    \(\backslash\)}
01435 \textcolor{preprocessor}{                    (entry\_ptr)->ht\_next->ht\_prev = (entry\_ptr)->ht\_prev;   \(\backslash\)}
01436 \textcolor{preprocessor}{                HDassert((entry\_ptr)->ht\_prev != NULL);                     \(\backslash\)}
01437 \textcolor{preprocessor}{                (entry\_ptr)->ht\_prev->ht\_next = (entry\_ptr)->ht\_next;       \(\backslash\)}
01438 \textcolor{preprocessor}{                ((cache\_ptr)->index)[k]->ht\_prev = (entry\_ptr);             \(\backslash\)}
01439 \textcolor{preprocessor}{                (entry\_ptr)->ht\_next = ((cache\_ptr)->index)[k];             \(\backslash\)}
01440 \textcolor{preprocessor}{                (entry\_ptr)->ht\_prev = NULL;                                \(\backslash\)}
01441 \textcolor{preprocessor}{                ((cache\_ptr)->index)[k] = (entry\_ptr);                      \(\backslash\)}
01442 \textcolor{preprocessor}{                H5C\_\_POST\_HT\_SHIFT\_TO\_FRONT(cache\_ptr, entry\_ptr, k, fail\_val) \(\backslash\)}
01443 \textcolor{preprocessor}{            \}                                                               \(\backslash\)}
01444 \textcolor{preprocessor}{            break;                                                          \(\backslash\)}
01445 \textcolor{preprocessor}{        \}                                                                   \(\backslash\)}
01446 \textcolor{preprocessor}{        (entry\_ptr) = (entry\_ptr)->ht\_next;                                 \(\backslash\)}
01447 \textcolor{preprocessor}{    \}                                                                       \(\backslash\)}
01448 \textcolor{preprocessor}{\}}
01449 
01450 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_INDEX\_FOR\_ENTRY\_CLEAN(cache\_ptr, entry\_ptr)   \(\backslash\)}
01451 \textcolor{preprocessor}{\{                                                                 \(\backslash\)}
01452 \textcolor{preprocessor}{    H5C\_\_PRE\_HT\_UPDATE\_FOR\_ENTRY\_CLEAN\_SC(cache\_ptr, entry\_ptr);  \(\backslash\)}
01453 \textcolor{preprocessor}{    (cache\_ptr)->dirty\_index\_size -= (entry\_ptr)->size;           \(\backslash\)}
01454 \textcolor{preprocessor}{    ((cache\_ptr)->dirty\_index\_ring\_size[entry\_ptr->ring])         \(\backslash\)}
01455 \textcolor{preprocessor}{        -= (entry\_ptr)->size;                             \(\backslash\)}
01456 \textcolor{preprocessor}{    (cache\_ptr)->clean\_index\_size += (entry\_ptr)->size;           \(\backslash\)}
01457 \textcolor{preprocessor}{    ((cache\_ptr)->clean\_index\_ring\_size[entry\_ptr->ring])         \(\backslash\)}
01458 \textcolor{preprocessor}{        += (entry\_ptr)->size;                             \(\backslash\)}
01459 \textcolor{preprocessor}{    H5C\_\_POST\_HT\_UPDATE\_FOR\_ENTRY\_CLEAN\_SC(cache\_ptr, entry\_ptr); \(\backslash\)}
01460 \textcolor{preprocessor}{\}}
01461 
01462 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_INDEX\_FOR\_ENTRY\_DIRTY(cache\_ptr, entry\_ptr)   \(\backslash\)}
01463 \textcolor{preprocessor}{\{                                                                 \(\backslash\)}
01464 \textcolor{preprocessor}{    H5C\_\_PRE\_HT\_UPDATE\_FOR\_ENTRY\_DIRTY\_SC(cache\_ptr, entry\_ptr);  \(\backslash\)}
01465 \textcolor{preprocessor}{    (cache\_ptr)->clean\_index\_size -= (entry\_ptr)->size;           \(\backslash\)}
01466 \textcolor{preprocessor}{    ((cache\_ptr)->clean\_index\_ring\_size[entry\_ptr->ring])         \(\backslash\)}
01467 \textcolor{preprocessor}{        -= (entry\_ptr)->size;                             \(\backslash\)}
01468 \textcolor{preprocessor}{    (cache\_ptr)->dirty\_index\_size += (entry\_ptr)->size;           \(\backslash\)}
01469 \textcolor{preprocessor}{    ((cache\_ptr)->dirty\_index\_ring\_size[entry\_ptr->ring])         \(\backslash\)}
01470 \textcolor{preprocessor}{        += (entry\_ptr)->size;                             \(\backslash\)}
01471 \textcolor{preprocessor}{    H5C\_\_POST\_HT\_UPDATE\_FOR\_ENTRY\_DIRTY\_SC(cache\_ptr, entry\_ptr); \(\backslash\)}
01472 \textcolor{preprocessor}{\}}
01473 
01474 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_INDEX\_FOR\_SIZE\_CHANGE(cache\_ptr, old\_size, new\_size,    \(\backslash\)}
01475 \textcolor{preprocessor}{                                  entry\_ptr, was\_clean)             \(\backslash\)}
01476 \textcolor{preprocessor}{\{                                                                           \(\backslash\)}
01477 \textcolor{preprocessor}{    H5C\_\_PRE\_HT\_ENTRY\_SIZE\_CHANGE\_SC(cache\_ptr, old\_size, new\_size,         \(\backslash\)}
01478 \textcolor{preprocessor}{                             entry\_ptr, was\_clean)                  \(\backslash\)}
01479 \textcolor{preprocessor}{    (cache\_ptr)->index\_size -= (old\_size);                                  \(\backslash\)}
01480 \textcolor{preprocessor}{    (cache\_ptr)->index\_size += (new\_size);                                  \(\backslash\)}
01481 \textcolor{preprocessor}{    ((cache\_ptr)->index\_ring\_size[entry\_ptr->ring]) -= (old\_size);          \(\backslash\)}
01482 \textcolor{preprocessor}{    ((cache\_ptr)->index\_ring\_size[entry\_ptr->ring]) += (new\_size);          \(\backslash\)}
01483 \textcolor{preprocessor}{    if(was\_clean) \{                                                         \(\backslash\)}
01484 \textcolor{preprocessor}{        (cache\_ptr)->clean\_index\_size -= (old\_size);                        \(\backslash\)}
01485 \textcolor{preprocessor}{        ((cache\_ptr)->clean\_index\_ring\_size[entry\_ptr->ring])-= (old\_size); \(\backslash\)}
01486 \textcolor{preprocessor}{    \} else \{                                                                \(\backslash\)}
01487 \textcolor{preprocessor}{    (cache\_ptr)->dirty\_index\_size -= (old\_size);                        \(\backslash\)}
01488 \textcolor{preprocessor}{        ((cache\_ptr)->dirty\_index\_ring\_size[entry\_ptr->ring])-= (old\_size); \(\backslash\)}
01489 \textcolor{preprocessor}{    \}                                                                       \(\backslash\)}
01490 \textcolor{preprocessor}{    if((entry\_ptr)->is\_dirty) \{                                             \(\backslash\)}
01491 \textcolor{preprocessor}{        (cache\_ptr)->dirty\_index\_size += (new\_size);                        \(\backslash\)}
01492 \textcolor{preprocessor}{        ((cache\_ptr)->dirty\_index\_ring\_size[entry\_ptr->ring])+= (new\_size); \(\backslash\)}
01493 \textcolor{preprocessor}{    \} else \{                                                                \(\backslash\)}
01494 \textcolor{preprocessor}{    (cache\_ptr)->clean\_index\_size += (new\_size);                        \(\backslash\)}
01495 \textcolor{preprocessor}{        ((cache\_ptr)->clean\_index\_ring\_size[entry\_ptr->ring])+= (new\_size); \(\backslash\)}
01496 \textcolor{preprocessor}{    \}                                                                       \(\backslash\)}
01497 \textcolor{preprocessor}{    H5C\_\_DLL\_UPDATE\_FOR\_SIZE\_CHANGE((cache\_ptr)->il\_len,                    \(\backslash\)}
01498 \textcolor{preprocessor}{                                    (cache\_ptr)->il\_size,                   \(\backslash\)}
01499 \textcolor{preprocessor}{                                    (old\_size), (new\_size))                 \(\backslash\)}
01500 \textcolor{preprocessor}{    H5C\_\_POST\_HT\_ENTRY\_SIZE\_CHANGE\_SC(cache\_ptr, old\_size, new\_size,        \(\backslash\)}
01501 \textcolor{preprocessor}{                                      entry\_ptr)                            \(\backslash\)}
01502 \textcolor{preprocessor}{\}}
01503 
01504 
01505 \textcolor{comment}{/**************************************************************************}
01506 \textcolor{comment}{ *}
01507 \textcolor{comment}{ * Skip list insertion and deletion macros:}
01508 \textcolor{comment}{ *}
01509 \textcolor{comment}{ * These used to be functions, but I converted them to macros to avoid some}
01510 \textcolor{comment}{ * function call overhead.}
01511 \textcolor{comment}{ *}
01512 \textcolor{comment}{ **************************************************************************/}
01513 
01514 \textcolor{comment}{/*-------------------------------------------------------------------------}
01515 \textcolor{comment}{ *}
01516 \textcolor{comment}{ * Macro:   H5C\_\_INSERT\_ENTRY\_IN\_SLIST}
01517 \textcolor{comment}{ *}
01518 \textcolor{comment}{ * Purpose:     Insert the specified instance of H5C\_cache\_entry\_t into}
01519 \textcolor{comment}{ *      the skip list in the specified instance of H5C\_t.  Update}
01520 \textcolor{comment}{ *      the associated length and size fields.}
01521 \textcolor{comment}{ *}
01522 \textcolor{comment}{ * Return:      N/A}
01523 \textcolor{comment}{ *}
01524 \textcolor{comment}{ * Programmer:  John Mainzer, 5/10/04}
01525 \textcolor{comment}{ *}
01526 \textcolor{comment}{ * Modifications:}
01527 \textcolor{comment}{ *}
01528 \textcolor{comment}{ *      JRM -- 7/21/04}
01529 \textcolor{comment}{ *      Updated function to set the in\_tree flag when inserting}
01530 \textcolor{comment}{ *      an entry into the tree.  Also modified the function to}
01531 \textcolor{comment}{ *      update the tree size and len fields instead of the similar}
01532 \textcolor{comment}{ *      index fields.}
01533 \textcolor{comment}{ *}
01534 \textcolor{comment}{ *      All of this is part of the modifications to support the}
01535 \textcolor{comment}{ *      hash table.}
01536 \textcolor{comment}{ *}
01537 \textcolor{comment}{ *      JRM -- 7/27/04}
01538 \textcolor{comment}{ *      Converted the function H5C\_insert\_entry\_in\_tree() into}
01539 \textcolor{comment}{ *      the macro H5C\_\_INSERT\_ENTRY\_IN\_TREE in the hopes of}
01540 \textcolor{comment}{ *      wringing a little more speed out of the cache.}
01541 \textcolor{comment}{ *}
01542 \textcolor{comment}{ *      Note that we don't bother to check if the entry is already}
01543 \textcolor{comment}{ *      in the tree -- if it is, H5SL\_insert() will fail.}
01544 \textcolor{comment}{ *}
01545 \textcolor{comment}{ *      QAK -- 11/27/04}
01546 \textcolor{comment}{ *      Switched over to using skip list routines.}
01547 \textcolor{comment}{ *}
01548 \textcolor{comment}{ *      JRM -- 6/27/06}
01549 \textcolor{comment}{ *      Added fail\_val parameter.}
01550 \textcolor{comment}{ *}
01551 \textcolor{comment}{ *      JRM -- 8/25/06}
01552 \textcolor{comment}{ *      Added the H5C\_DO\_SANITY\_CHECKS version of the macro.}
01553 \textcolor{comment}{ *}
01554 \textcolor{comment}{ *      This version maintains the slist\_len\_increase and}
01555 \textcolor{comment}{ *      slist\_size\_increase fields that are used in sanity}
01556 \textcolor{comment}{ *      checks in the flush routines.}
01557 \textcolor{comment}{ *}
01558 \textcolor{comment}{ *      All this is needed as the fractal heap needs to be}
01559 \textcolor{comment}{ *      able to dirty, resize and/or move entries during the}
01560 \textcolor{comment}{ *      flush.}
01561 \textcolor{comment}{ *}
01562 \textcolor{comment}{ *      JRM -- 12/13/14}
01563 \textcolor{comment}{ *      Added code to set cache\_ptr->slist\_changed to TRUE }
01564 \textcolor{comment}{ *      when an entry is inserted in the slist.}
01565 \textcolor{comment}{ *}
01566 \textcolor{comment}{ *      JRM -- 9/1/15}
01567 \textcolor{comment}{ *      Added code to maintain the cache\_ptr->slist\_ring\_len}
01568 \textcolor{comment}{ *      and cache\_ptr->slist\_ring\_size arrays.}
01569 \textcolor{comment}{ *}
01570 \textcolor{comment}{ *-------------------------------------------------------------------------}
01571 \textcolor{comment}{ */}
01572 
01573 \textcolor{preprocessor}{#if H5C\_DO\_SLIST\_SANITY\_CHECKS}
01574 \textcolor{preprocessor}{#define ENTRY\_IN\_SLIST(cache\_ptr, entry\_ptr) \(\backslash\)}
01575 \textcolor{preprocessor}{    H5C\_entry\_in\_skip\_list((cache\_ptr), (entry\_ptr))}
01576 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_DO\_SLIST\_SANITY\_CHECKS */}\textcolor{preprocessor}{}
01577 \textcolor{preprocessor}{#define ENTRY\_IN\_SLIST(cache\_ptr, entry\_ptr) FALSE}
01578 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_DO\_SLIST\_SANITY\_CHECKS */}\textcolor{preprocessor}{}
01579 
01580 \textcolor{preprocessor}{#if H5C\_DO\_SANITY\_CHECKS}
01581 
01582 \textcolor{preprocessor}{#define H5C\_\_INSERT\_ENTRY\_IN\_SLIST(cache\_ptr, entry\_ptr, fail\_val)             \(\backslash\)}
01583 \textcolor{preprocessor}{\{                                                                              \(\backslash\)}
01584 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                                   \(\backslash\)}
01585 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                        \(\backslash\)}
01586 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                                   \(\backslash\)}
01587 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                         \(\backslash\)}
01588 \textcolor{preprocessor}{    HDassert( H5F\_addr\_defined((entry\_ptr)->addr) );                           \(\backslash\)}
01589 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->in\_slist) );                                      \(\backslash\)}
01590 \textcolor{preprocessor}{    HDassert( !ENTRY\_IN\_SLIST((cache\_ptr), (entry\_ptr)) );                     \(\backslash\)}
01591 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->ring > H5C\_RING\_UNDEFINED );                        \(\backslash\)}
01592 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->ring < H5C\_RING\_NTYPES );                           \(\backslash\)}
01593 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_ring\_len[(entry\_ptr)->ring] <=                \(\backslash\)}
01594 \textcolor{preprocessor}{              (cache\_ptr)->slist\_len );                                        \(\backslash\)}
01595 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_ring\_size[(entry\_ptr)->ring] <=               \(\backslash\)}
01596 \textcolor{preprocessor}{              (cache\_ptr)->slist\_size );                                       \(\backslash\)}
01597 \textcolor{preprocessor}{                                                                               \(\backslash\)}
01598 \textcolor{preprocessor}{    if(H5SL\_insert((cache\_ptr)->slist\_ptr, entry\_ptr, &(entry\_ptr)->addr) < 0) \(\backslash\)}
01599 \textcolor{preprocessor}{        HGOTO\_ERROR(H5E\_CACHE, H5E\_BADVALUE, (fail\_val), "can't insert entry in skip list") \(\backslash\)}
01600 \textcolor{preprocessor}{                                                                               \(\backslash\)}
01601 \textcolor{preprocessor}{    (entry\_ptr)->in\_slist = TRUE;                                              \(\backslash\)}
01602 \textcolor{preprocessor}{    (cache\_ptr)->slist\_changed = TRUE;                                         \(\backslash\)}
01603 \textcolor{preprocessor}{    (cache\_ptr)->slist\_len++;                                                  \(\backslash\)}
01604 \textcolor{preprocessor}{    (cache\_ptr)->slist\_size += (entry\_ptr)->size;                              \(\backslash\)}
01605 \textcolor{preprocessor}{    ((cache\_ptr)->slist\_ring\_len[(entry\_ptr)->ring])++;                        \(\backslash\)}
01606 \textcolor{preprocessor}{    ((cache\_ptr)->slist\_ring\_size[(entry\_ptr)->ring]) += (entry\_ptr)->size;    \(\backslash\)}
01607 \textcolor{preprocessor}{    (cache\_ptr)->slist\_len\_increase++;                                         \(\backslash\)}
01608 \textcolor{preprocessor}{    (cache\_ptr)->slist\_size\_increase += (int64\_t)((entry\_ptr)->size);          \(\backslash\)}
01609 \textcolor{preprocessor}{                                                                               \(\backslash\)}
01610 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_len > 0 );                                    \(\backslash\)}
01611 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_size > 0 );                                   \(\backslash\)}
01612 \textcolor{preprocessor}{                                                                               \(\backslash\)}
01613 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_INSERT\_ENTRY\_IN\_SLIST */}\textcolor{preprocessor}{}
01614 
01615 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_DO\_SANITY\_CHECKS */}\textcolor{preprocessor}{}
01616 
01617 \textcolor{preprocessor}{#define H5C\_\_INSERT\_ENTRY\_IN\_SLIST(cache\_ptr, entry\_ptr, fail\_val)             \(\backslash\)}
01618 \textcolor{preprocessor}{\{                                                                              \(\backslash\)}
01619 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                                   \(\backslash\)}
01620 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                        \(\backslash\)}
01621 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                                   \(\backslash\)}
01622 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                         \(\backslash\)}
01623 \textcolor{preprocessor}{    HDassert( H5F\_addr\_defined((entry\_ptr)->addr) );                           \(\backslash\)}
01624 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->in\_slist) );                                      \(\backslash\)}
01625 \textcolor{preprocessor}{    HDassert( !ENTRY\_IN\_SLIST((cache\_ptr), (entry\_ptr)) );                     \(\backslash\)}
01626 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->ring > H5C\_RING\_UNDEFINED );                        \(\backslash\)}
01627 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->ring < H5C\_RING\_NTYPES );                           \(\backslash\)}
01628 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_ring\_len[(entry\_ptr)->ring] <=                \(\backslash\)}
01629 \textcolor{preprocessor}{              (cache\_ptr)->slist\_len );                                        \(\backslash\)}
01630 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_ring\_size[(entry\_ptr)->ring] <=               \(\backslash\)}
01631 \textcolor{preprocessor}{              (cache\_ptr)->slist\_size );                                       \(\backslash\)}
01632 \textcolor{preprocessor}{                                                                               \(\backslash\)}
01633 \textcolor{preprocessor}{    if(H5SL\_insert((cache\_ptr)->slist\_ptr, entry\_ptr, &(entry\_ptr)->addr) < 0) \(\backslash\)}
01634 \textcolor{preprocessor}{        HGOTO\_ERROR(H5E\_CACHE, H5E\_BADVALUE, (fail\_val), "can't insert entry in skip list") \(\backslash\)}
01635 \textcolor{preprocessor}{                                                                               \(\backslash\)}
01636 \textcolor{preprocessor}{    (entry\_ptr)->in\_slist = TRUE;                                              \(\backslash\)}
01637 \textcolor{preprocessor}{    (cache\_ptr)->slist\_changed = TRUE;                                         \(\backslash\)}
01638 \textcolor{preprocessor}{    (cache\_ptr)->slist\_len++;                                                  \(\backslash\)}
01639 \textcolor{preprocessor}{    (cache\_ptr)->slist\_size += (entry\_ptr)->size;                              \(\backslash\)}
01640 \textcolor{preprocessor}{    ((cache\_ptr)->slist\_ring\_len[(entry\_ptr)->ring])++;                        \(\backslash\)}
01641 \textcolor{preprocessor}{    ((cache\_ptr)->slist\_ring\_size[(entry\_ptr)->ring]) += (entry\_ptr)->size;    \(\backslash\)}
01642 \textcolor{preprocessor}{                                                                               \(\backslash\)}
01643 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_len > 0 );                                    \(\backslash\)}
01644 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_size > 0 );                                   \(\backslash\)}
01645 \textcolor{preprocessor}{                                                                               \(\backslash\)}
01646 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_INSERT\_ENTRY\_IN\_SLIST */}\textcolor{preprocessor}{}
01647 
01648 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_DO\_SANITY\_CHECKS */}\textcolor{preprocessor}{}
01649 
01650 
01651 \textcolor{comment}{/*-------------------------------------------------------------------------}
01652 \textcolor{comment}{ *}
01653 \textcolor{comment}{ * Function:    H5C\_\_REMOVE\_ENTRY\_FROM\_SLIST}
01654 \textcolor{comment}{ *}
01655 \textcolor{comment}{ * Purpose:     Remove the specified instance of H5C\_cache\_entry\_t from the}
01656 \textcolor{comment}{ *      index skip list in the specified instance of H5C\_t.  Update}
01657 \textcolor{comment}{ *      the associated length and size fields.}
01658 \textcolor{comment}{ *}
01659 \textcolor{comment}{ * Return:      N/A}
01660 \textcolor{comment}{ *}
01661 \textcolor{comment}{ * Programmer:  John Mainzer, 5/10/04}
01662 \textcolor{comment}{ *}
01663 \textcolor{comment}{ *-------------------------------------------------------------------------}
01664 \textcolor{comment}{ */}
01665 
01666 \textcolor{preprocessor}{#if H5C\_DO\_SANITY\_CHECKS}
01667 \textcolor{preprocessor}{#define H5C\_\_REMOVE\_ENTRY\_FROM\_SLIST(cache\_ptr, entry\_ptr, during\_flush)    \(\backslash\)}
01668 \textcolor{preprocessor}{\{                                                                           \(\backslash\)}
01669 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                                \(\backslash\)}
01670 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                     \(\backslash\)}
01671 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                                \(\backslash\)}
01672 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                               \(\backslash\)}
01673 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                           \(\backslash\)}
01674 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                      \(\backslash\)}
01675 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->in\_slist );                                      \(\backslash\)}
01676 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_ptr );                                     \(\backslash\)}
01677 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->ring > H5C\_RING\_UNDEFINED );                     \(\backslash\)}
01678 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->ring < H5C\_RING\_NTYPES );                        \(\backslash\)}
01679 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_ring\_len[(entry\_ptr)->ring] <=             \(\backslash\)}
01680 \textcolor{preprocessor}{              (cache\_ptr)->slist\_len );                                     \(\backslash\)}
01681 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_ring\_size[(entry\_ptr)->ring] <=            \(\backslash\)}
01682 \textcolor{preprocessor}{              (cache\_ptr)->slist\_size );                                    \(\backslash\)}
01683 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01684 \textcolor{preprocessor}{    if ( H5SL\_remove((cache\_ptr)->slist\_ptr, &(entry\_ptr)->addr)            \(\backslash\)}
01685 \textcolor{preprocessor}{             != (entry\_ptr) )                                               \(\backslash\)}
01686 \textcolor{preprocessor}{        HGOTO\_ERROR(H5E\_CACHE, H5E\_BADVALUE, FAIL, "can't delete entry from skip list") \(\backslash\)}
01687 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01688 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_len > 0 );                                 \(\backslash\)}
01689 \textcolor{preprocessor}{    if(!(during\_flush))                                                     \(\backslash\)}
01690 \textcolor{preprocessor}{        (cache\_ptr)->slist\_changed = TRUE;                                  \(\backslash\)}
01691 \textcolor{preprocessor}{    (cache\_ptr)->slist\_len--;                                               \(\backslash\)}
01692 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_size >= (entry\_ptr)->size );               \(\backslash\)}
01693 \textcolor{preprocessor}{    (cache\_ptr)->slist\_size -= (entry\_ptr)->size;                           \(\backslash\)}
01694 \textcolor{preprocessor}{    ((cache\_ptr)->slist\_ring\_len[(entry\_ptr)->ring])--;                     \(\backslash\)}
01695 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_ring\_size[(entry\_ptr->ring)] >=            \(\backslash\)}
01696 \textcolor{preprocessor}{              (entry\_ptr)->size );                                          \(\backslash\)}
01697 \textcolor{preprocessor}{    ((cache\_ptr)->slist\_ring\_size[(entry\_ptr)->ring]) -= (entry\_ptr)->size; \(\backslash\)}
01698 \textcolor{preprocessor}{    (cache\_ptr)->slist\_len\_increase--;                                      \(\backslash\)}
01699 \textcolor{preprocessor}{    (cache\_ptr)->slist\_size\_increase -= (int64\_t)((entry\_ptr)->size);       \(\backslash\)}
01700 \textcolor{preprocessor}{    (entry\_ptr)->in\_slist = FALSE;                                          \(\backslash\)}
01701 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_REMOVE\_ENTRY\_FROM\_SLIST */}\textcolor{preprocessor}{}
01702 
01703 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_DO\_SANITY\_CHECKS */}\textcolor{preprocessor}{}
01704 
01705 \textcolor{preprocessor}{#define H5C\_\_REMOVE\_ENTRY\_FROM\_SLIST(cache\_ptr, entry\_ptr, during\_flush)    \(\backslash\)}
01706 \textcolor{preprocessor}{\{                                                                           \(\backslash\)}
01707 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                                \(\backslash\)}
01708 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                     \(\backslash\)}
01709 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                                \(\backslash\)}
01710 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                               \(\backslash\)}
01711 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                           \(\backslash\)}
01712 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->in\_slist );                                      \(\backslash\)}
01713 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_ptr );                                     \(\backslash\)}
01714 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->ring > H5C\_RING\_UNDEFINED );                     \(\backslash\)}
01715 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->ring < H5C\_RING\_NTYPES );                        \(\backslash\)}
01716 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_ring\_len[(entry\_ptr)->ring] <=             \(\backslash\)}
01717 \textcolor{preprocessor}{              (cache\_ptr)->slist\_len );                                     \(\backslash\)}
01718 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_ring\_size[(entry\_ptr)->ring] <=            \(\backslash\)}
01719 \textcolor{preprocessor}{              (cache\_ptr)->slist\_size );                                    \(\backslash\)}
01720 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01721 \textcolor{preprocessor}{    if ( H5SL\_remove((cache\_ptr)->slist\_ptr, &(entry\_ptr)->addr)            \(\backslash\)}
01722 \textcolor{preprocessor}{             != (entry\_ptr) )                                               \(\backslash\)}
01723 \textcolor{preprocessor}{        HGOTO\_ERROR(H5E\_CACHE, H5E\_BADVALUE, FAIL, "can't delete entry from skip list") \(\backslash\)}
01724 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01725 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_len > 0 );                                 \(\backslash\)}
01726 \textcolor{preprocessor}{    if(!(during\_flush))                                                     \(\backslash\)}
01727 \textcolor{preprocessor}{        (cache\_ptr)->slist\_changed = TRUE;                                  \(\backslash\)}
01728 \textcolor{preprocessor}{    (cache\_ptr)->slist\_len--;                                               \(\backslash\)}
01729 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_size >= (entry\_ptr)->size );               \(\backslash\)}
01730 \textcolor{preprocessor}{    (cache\_ptr)->slist\_size -= (entry\_ptr)->size;                           \(\backslash\)}
01731 \textcolor{preprocessor}{    ((cache\_ptr)->slist\_ring\_len[(entry\_ptr)->ring])--;                     \(\backslash\)}
01732 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_ring\_size[(entry\_ptr->ring)] >=            \(\backslash\)}
01733 \textcolor{preprocessor}{              (entry\_ptr)->size );                                          \(\backslash\)}
01734 \textcolor{preprocessor}{    ((cache\_ptr)->slist\_ring\_size[(entry\_ptr)->ring]) -= (entry\_ptr)->size; \(\backslash\)}
01735 \textcolor{preprocessor}{    (entry\_ptr)->in\_slist = FALSE;                                          \(\backslash\)}
01736 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_REMOVE\_ENTRY\_FROM\_SLIST */}\textcolor{preprocessor}{}
01737 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_DO\_SANITY\_CHECKS */}\textcolor{preprocessor}{}
01738 
01739 
01740 \textcolor{comment}{/*-------------------------------------------------------------------------}
01741 \textcolor{comment}{ *}
01742 \textcolor{comment}{ * Function:    H5C\_\_UPDATE\_SLIST\_FOR\_SIZE\_CHANGE}
01743 \textcolor{comment}{ *}
01744 \textcolor{comment}{ * Purpose:     Update cache\_ptr->slist\_size for a change in the size of}
01745 \textcolor{comment}{ *      and entry in the slist.}
01746 \textcolor{comment}{ *}
01747 \textcolor{comment}{ * Return:      N/A}
01748 \textcolor{comment}{ *}
01749 \textcolor{comment}{ * Programmer:  John Mainzer, 9/07/05}
01750 \textcolor{comment}{ *}
01751 \textcolor{comment}{ * Modifications:}
01752 \textcolor{comment}{ *}
01753 \textcolor{comment}{ *      JRM -- 8/27/06}
01754 \textcolor{comment}{ *      Added the H5C\_DO\_SANITY\_CHECKS version of the macro.}
01755 \textcolor{comment}{ *}
01756 \textcolor{comment}{ *      This version maintains the slist\_size\_increase field}
01757 \textcolor{comment}{ *      that are used in sanity checks in the flush routines.}
01758 \textcolor{comment}{ *}
01759 \textcolor{comment}{ *      All this is needed as the fractal heap needs to be}
01760 \textcolor{comment}{ *      able to dirty, resize and/or move entries during the}
01761 \textcolor{comment}{ *      flush.}
01762 \textcolor{comment}{ *}
01763 \textcolor{comment}{ *      JRM -- 12/13/14}
01764 \textcolor{comment}{ *      Note that we do not set cache\_ptr->slist\_changed to TRUE }
01765 \textcolor{comment}{ *      in this case, as the structure of the slist is not}
01766 \textcolor{comment}{ *      modified.}
01767 \textcolor{comment}{ *}
01768 \textcolor{comment}{ *      JRM -- 9/1/15}
01769 \textcolor{comment}{ *      Added code to maintain the cache\_ptr->slist\_ring\_len}
01770 \textcolor{comment}{ *      and cache\_ptr->slist\_ring\_size arrays.}
01771 \textcolor{comment}{ *}
01772 \textcolor{comment}{ *-------------------------------------------------------------------------}
01773 \textcolor{comment}{ */}
01774 
01775 \textcolor{preprocessor}{#if H5C\_DO\_SANITY\_CHECKS}
01776 
01777 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_SLIST\_FOR\_SIZE\_CHANGE(cache\_ptr, old\_size, new\_size)      \(\backslash\)}
01778 \textcolor{preprocessor}{\{                                                                             \(\backslash\)}
01779 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                                  \(\backslash\)}
01780 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                       \(\backslash\)}
01781 \textcolor{preprocessor}{    HDassert( (old\_size) > 0 );                                               \(\backslash\)}
01782 \textcolor{preprocessor}{    HDassert( (new\_size) > 0 );                                               \(\backslash\)}
01783 \textcolor{preprocessor}{    HDassert( (old\_size) <= (cache\_ptr)->slist\_size );                        \(\backslash\)}
01784 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_len > 0 );                                   \(\backslash\)}
01785 \textcolor{preprocessor}{    HDassert( ((cache\_ptr)->slist\_len > 1) ||                                 \(\backslash\)}
01786 \textcolor{preprocessor}{              ( (cache\_ptr)->slist\_size == (old\_size) ) );                    \(\backslash\)}
01787 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->ring > H5C\_RING\_UNDEFINED );                       \(\backslash\)}
01788 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->ring < H5C\_RING\_NTYPES );                          \(\backslash\)}
01789 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_ring\_len[(entry\_ptr)->ring] <=               \(\backslash\)}
01790 \textcolor{preprocessor}{              (cache\_ptr)->slist\_len );                                       \(\backslash\)}
01791 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_ring\_size[(entry\_ptr)->ring] <=              \(\backslash\)}
01792 \textcolor{preprocessor}{              (cache\_ptr)->slist\_size );                                      \(\backslash\)}
01793 \textcolor{preprocessor}{                                                                              \(\backslash\)}
01794 \textcolor{preprocessor}{    (cache\_ptr)->slist\_size -= (old\_size);                                    \(\backslash\)}
01795 \textcolor{preprocessor}{    (cache\_ptr)->slist\_size += (new\_size);                                    \(\backslash\)}
01796 \textcolor{preprocessor}{                                                                              \(\backslash\)}
01797 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_ring\_size[(entry\_ptr->ring)] >=(old\_size) ); \(\backslash\)}
01798 \textcolor{preprocessor}{    ((cache\_ptr)->slist\_ring\_size[(entry\_ptr)->ring]) -= (old\_size);          \(\backslash\)}
01799 \textcolor{preprocessor}{    ((cache\_ptr)->slist\_ring\_size[(entry\_ptr)->ring]) += (new\_size);          \(\backslash\)}
01800 \textcolor{preprocessor}{                                                                              \(\backslash\)}
01801 \textcolor{preprocessor}{    (cache\_ptr)->slist\_size\_increase -= (int64\_t)(old\_size);                  \(\backslash\)}
01802 \textcolor{preprocessor}{    (cache\_ptr)->slist\_size\_increase += (int64\_t)(new\_size);                  \(\backslash\)}
01803 \textcolor{preprocessor}{                                                                              \(\backslash\)}
01804 \textcolor{preprocessor}{    HDassert( (new\_size) <= (cache\_ptr)->slist\_size );                        \(\backslash\)}
01805 \textcolor{preprocessor}{    HDassert( ( (cache\_ptr)->slist\_len > 1 ) ||                               \(\backslash\)}
01806 \textcolor{preprocessor}{              ( (cache\_ptr)->slist\_size == (new\_size) ) );                    \(\backslash\)}
01807 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_UPDATE\_SLIST\_FOR\_SIZE\_CHANGE */}\textcolor{preprocessor}{}
01808 
01809 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_DO\_SANITY\_CHECKS */}\textcolor{preprocessor}{}
01810 
01811 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_SLIST\_FOR\_SIZE\_CHANGE(cache\_ptr, old\_size, new\_size)      \(\backslash\)}
01812 \textcolor{preprocessor}{\{                                                                             \(\backslash\)}
01813 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                                  \(\backslash\)}
01814 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                       \(\backslash\)}
01815 \textcolor{preprocessor}{    HDassert( (old\_size) > 0 );                                               \(\backslash\)}
01816 \textcolor{preprocessor}{    HDassert( (new\_size) > 0 );                                               \(\backslash\)}
01817 \textcolor{preprocessor}{    HDassert( (old\_size) <= (cache\_ptr)->slist\_size );                        \(\backslash\)}
01818 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_len > 0 );                                   \(\backslash\)}
01819 \textcolor{preprocessor}{    HDassert( ((cache\_ptr)->slist\_len > 1) ||                                 \(\backslash\)}
01820 \textcolor{preprocessor}{              ( (cache\_ptr)->slist\_size == (old\_size) ) );                    \(\backslash\)}
01821 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->ring > H5C\_RING\_UNDEFINED );                       \(\backslash\)}
01822 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->ring < H5C\_RING\_NTYPES );                          \(\backslash\)}
01823 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_ring\_len[(entry\_ptr)->ring] <=               \(\backslash\)}
01824 \textcolor{preprocessor}{              (cache\_ptr)->slist\_len );                                       \(\backslash\)}
01825 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_ring\_size[(entry\_ptr)->ring] <=              \(\backslash\)}
01826 \textcolor{preprocessor}{              (cache\_ptr)->slist\_size );                                      \(\backslash\)}
01827 \textcolor{preprocessor}{                                                                              \(\backslash\)}
01828 \textcolor{preprocessor}{    (cache\_ptr)->slist\_size -= (old\_size);                                    \(\backslash\)}
01829 \textcolor{preprocessor}{    (cache\_ptr)->slist\_size += (new\_size);                                    \(\backslash\)}
01830 \textcolor{preprocessor}{                                                                              \(\backslash\)}
01831 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->slist\_ring\_size[(entry\_ptr->ring)] >=(old\_size) ); \(\backslash\)}
01832 \textcolor{preprocessor}{    ((cache\_ptr)->slist\_ring\_size[(entry\_ptr)->ring]) -= (old\_size);          \(\backslash\)}
01833 \textcolor{preprocessor}{    ((cache\_ptr)->slist\_ring\_size[(entry\_ptr)->ring]) += (new\_size);          \(\backslash\)}
01834 \textcolor{preprocessor}{                                                                              \(\backslash\)}
01835 \textcolor{preprocessor}{    HDassert( (new\_size) <= (cache\_ptr)->slist\_size );                        \(\backslash\)}
01836 \textcolor{preprocessor}{    HDassert( ( (cache\_ptr)->slist\_len > 1 ) ||                               \(\backslash\)}
01837 \textcolor{preprocessor}{              ( (cache\_ptr)->slist\_size == (new\_size) ) );                    \(\backslash\)}
01838 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_UPDATE\_SLIST\_FOR\_SIZE\_CHANGE */}\textcolor{preprocessor}{}
01839 
01840 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_DO\_SANITY\_CHECKS */}\textcolor{preprocessor}{}
01841 
01842 
01843 \textcolor{comment}{/**************************************************************************}
01844 \textcolor{comment}{ *}
01845 \textcolor{comment}{ * Replacement policy update macros:}
01846 \textcolor{comment}{ *}
01847 \textcolor{comment}{ * These used to be functions, but I converted them to macros to avoid some}
01848 \textcolor{comment}{ * function call overhead.}
01849 \textcolor{comment}{ *}
01850 \textcolor{comment}{ **************************************************************************/}
01851 
01852 \textcolor{comment}{/*-------------------------------------------------------------------------}
01853 \textcolor{comment}{ *}
01854 \textcolor{comment}{ * Macro:   H5C\_\_FAKE\_RP\_FOR\_MOST\_RECENT\_ACCESS}
01855 \textcolor{comment}{ *}
01856 \textcolor{comment}{ * Purpose:     For efficiency, we sometimes change the order of flushes --}
01857 \textcolor{comment}{ *      but doing so can confuse the replacement policy.  This}
01858 \textcolor{comment}{ *      macro exists to allow us to specify an entry as the}
01859 \textcolor{comment}{ *      most recently touched so we can repair any such}
01860 \textcolor{comment}{ *      confusion.}
01861 \textcolor{comment}{ *}
01862 \textcolor{comment}{ *      At present, we only support the modified LRU policy, so}
01863 \textcolor{comment}{ *      this function deals with that case unconditionally.  If}
01864 \textcolor{comment}{ *      we ever support other replacement policies, the macro}
01865 \textcolor{comment}{ *      should switch on the current policy and act accordingly.}
01866 \textcolor{comment}{ *}
01867 \textcolor{comment}{ * Return:      N/A}
01868 \textcolor{comment}{ *}
01869 \textcolor{comment}{ * Programmer:  John Mainzer, 10/13/05}
01870 \textcolor{comment}{ *}
01871 \textcolor{comment}{ * Modifications:}
01872 \textcolor{comment}{ *}
01873 \textcolor{comment}{ *      JRM -- 3/20/06}
01874 \textcolor{comment}{ *      Modified macro to ignore pinned entries.  Pinned entries}
01875 \textcolor{comment}{ *      do not appear in the data structures maintained by the}
01876 \textcolor{comment}{ *      replacement policy code, and thus this macro has nothing}
01877 \textcolor{comment}{ *      to do if called for such an entry.}
01878 \textcolor{comment}{ *}
01879 \textcolor{comment}{ *      JRM -- 3/28/07}
01880 \textcolor{comment}{ *      Added sanity checks using the new is\_read\_only and}
01881 \textcolor{comment}{ *      ro\_ref\_count fields of struct H5C\_cache\_entry\_t.}
01882 \textcolor{comment}{ *}
01883 \textcolor{comment}{ *-------------------------------------------------------------------------}
01884 \textcolor{comment}{ */}
01885 
01886 \textcolor{preprocessor}{#if H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS}
01887 
01888 \textcolor{preprocessor}{#define H5C\_\_FAKE\_RP\_FOR\_MOST\_RECENT\_ACCESS(cache\_ptr, entry\_ptr, fail\_val) \(\backslash\)}
01889 \textcolor{preprocessor}{\{                                                                           \(\backslash\)}
01890 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                                \(\backslash\)}
01891 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                     \(\backslash\)}
01892 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                                \(\backslash\)}
01893 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_protected) );                               \(\backslash\)}
01894 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                               \(\backslash\)}
01895 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                           \(\backslash\)}
01896 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                      \(\backslash\)}
01897 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01898 \textcolor{preprocessor}{    if ( ! ((entry\_ptr)->is\_pinned) ) \{                                     \(\backslash\)}
01899 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01900 \textcolor{preprocessor}{        }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                                    \(\backslash\)}
01901 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01902 \textcolor{preprocessor}{        }\textcolor{comment}{/* remove the entry from the LRU list, and re-insert it at the head.\(\backslash\)}
01903 \textcolor{comment}{     */}\textcolor{preprocessor}{                                                                 \(\backslash\)}
01904 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01905 \textcolor{preprocessor}{        H5C\_\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,             \(\backslash\)}
01906 \textcolor{preprocessor}{                        (cache\_ptr)->LRU\_tail\_ptr,                          \(\backslash\)}
01907 \textcolor{preprocessor}{            (cache\_ptr)->LRU\_list\_len,                          \(\backslash\)}
01908 \textcolor{preprocessor}{                        (cache\_ptr)->LRU\_list\_size, (fail\_val))             \(\backslash\)}
01909 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01910 \textcolor{preprocessor}{        H5C\_\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,            \(\backslash\)}
01911 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_tail\_ptr,                         \(\backslash\)}
01912 \textcolor{preprocessor}{             (cache\_ptr)->LRU\_list\_len,                         \(\backslash\)}
01913 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_list\_size, (fail\_val))            \(\backslash\)}
01914 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01915 \textcolor{preprocessor}{        }\textcolor{comment}{/* Use the dirty flag to infer whether the entry is on the clean or \(\backslash\)}
01916 \textcolor{comment}{         * dirty LRU list, and remove it.  Then insert it at the head of    \(\backslash\)}
01917 \textcolor{comment}{         * the same LRU list.                                               \(\backslash\)}
01918 \textcolor{comment}{         *                                                                  \(\backslash\)}
01919 \textcolor{comment}{         * At least initially, all entries should be clean.  That may       \(\backslash\)}
01920 \textcolor{comment}{         * change, so we may as well deal with both cases now.              \(\backslash\)}
01921 \textcolor{comment}{         */}\textcolor{preprocessor}{                                                                 \(\backslash\)}
01922 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01923 \textcolor{preprocessor}{        if ( (entry\_ptr)->is\_dirty ) \{                                      \(\backslash\)}
01924 \textcolor{preprocessor}{            H5C\_\_AUX\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->dLRU\_head\_ptr,    \(\backslash\)}
01925 \textcolor{preprocessor}{                                (cache\_ptr)->dLRU\_tail\_ptr,                 \(\backslash\)}
01926 \textcolor{preprocessor}{                                (cache\_ptr)->dLRU\_list\_len,                 \(\backslash\)}
01927 \textcolor{preprocessor}{                                (cache\_ptr)->dLRU\_list\_size, (fail\_val))    \(\backslash\)}
01928 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01929 \textcolor{preprocessor}{            H5C\_\_AUX\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->dLRU\_head\_ptr,   \(\backslash\)}
01930 \textcolor{preprocessor}{                                 (cache\_ptr)->dLRU\_tail\_ptr,                \(\backslash\)}
01931 \textcolor{preprocessor}{                                 (cache\_ptr)->dLRU\_list\_len,                \(\backslash\)}
01932 \textcolor{preprocessor}{                                 (cache\_ptr)->dLRU\_list\_size, (fail\_val))   \(\backslash\)}
01933 \textcolor{preprocessor}{        \} else \{                                                            \(\backslash\)}
01934 \textcolor{preprocessor}{            H5C\_\_AUX\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->cLRU\_head\_ptr,    \(\backslash\)}
01935 \textcolor{preprocessor}{                                (cache\_ptr)->cLRU\_tail\_ptr,                 \(\backslash\)}
01936 \textcolor{preprocessor}{                                (cache\_ptr)->cLRU\_list\_len,                 \(\backslash\)}
01937 \textcolor{preprocessor}{                                (cache\_ptr)->cLRU\_list\_size, (fail\_val))    \(\backslash\)}
01938 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01939 \textcolor{preprocessor}{            H5C\_\_AUX\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->cLRU\_head\_ptr,   \(\backslash\)}
01940 \textcolor{preprocessor}{                                 (cache\_ptr)->cLRU\_tail\_ptr,                \(\backslash\)}
01941 \textcolor{preprocessor}{                                 (cache\_ptr)->cLRU\_list\_len,                \(\backslash\)}
01942 \textcolor{preprocessor}{                                 (cache\_ptr)->cLRU\_list\_size, (fail\_val))   \(\backslash\)}
01943 \textcolor{preprocessor}{        \}                                                                   \(\backslash\)}
01944 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01945 \textcolor{preprocessor}{        }\textcolor{comment}{/* End modified LRU specific code. */}\textcolor{preprocessor}{                               \(\backslash\)}
01946 \textcolor{preprocessor}{    \}                                                                       \(\backslash\)}
01947 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_FAKE\_RP\_FOR\_MOST\_RECENT\_ACCESS */}\textcolor{preprocessor}{}
01948 
01949 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
01950 
01951 \textcolor{preprocessor}{#define H5C\_\_FAKE\_RP\_FOR\_MOST\_RECENT\_ACCESS(cache\_ptr, entry\_ptr, fail\_val) \(\backslash\)}
01952 \textcolor{preprocessor}{\{                                                                           \(\backslash\)}
01953 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                                \(\backslash\)}
01954 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                     \(\backslash\)}
01955 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                                \(\backslash\)}
01956 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_protected) );                               \(\backslash\)}
01957 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                               \(\backslash\)}
01958 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                           \(\backslash\)}
01959 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                      \(\backslash\)}
01960 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01961 \textcolor{preprocessor}{    if ( ! ((entry\_ptr)->is\_pinned) ) \{                                     \(\backslash\)}
01962 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01963 \textcolor{preprocessor}{        }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                                    \(\backslash\)}
01964 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01965 \textcolor{preprocessor}{        }\textcolor{comment}{/* remove the entry from the LRU list, and re-insert it at the head \(\backslash\)}
01966 \textcolor{comment}{     */}\textcolor{preprocessor}{                                                                 \(\backslash\)}
01967 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01968 \textcolor{preprocessor}{        H5C\_\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,             \(\backslash\)}
01969 \textcolor{preprocessor}{                        (cache\_ptr)->LRU\_tail\_ptr,                          \(\backslash\)}
01970 \textcolor{preprocessor}{            (cache\_ptr)->LRU\_list\_len,                          \(\backslash\)}
01971 \textcolor{preprocessor}{                        (cache\_ptr)->LRU\_list\_size, (fail\_val))             \(\backslash\)}
01972 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01973 \textcolor{preprocessor}{        H5C\_\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,            \(\backslash\)}
01974 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_tail\_ptr,                         \(\backslash\)}
01975 \textcolor{preprocessor}{             (cache\_ptr)->LRU\_list\_len,                         \(\backslash\)}
01976 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_list\_size, (fail\_val))            \(\backslash\)}
01977 \textcolor{preprocessor}{                                                                            \(\backslash\)}
01978 \textcolor{preprocessor}{        }\textcolor{comment}{/* End modified LRU specific code. */}\textcolor{preprocessor}{                               \(\backslash\)}
01979 \textcolor{preprocessor}{    \}                                                                       \(\backslash\)}
01980 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_FAKE\_RP\_FOR\_MOST\_RECENT\_ACCESS */}\textcolor{preprocessor}{}
01981 
01982 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
01983 
01984 
01985 \textcolor{comment}{/*-------------------------------------------------------------------------}
01986 \textcolor{comment}{ *}
01987 \textcolor{comment}{ * Macro:   H5C\_\_UPDATE\_RP\_FOR\_EVICTION}
01988 \textcolor{comment}{ *}
01989 \textcolor{comment}{ * Purpose:     Update the replacement policy data structures for an}
01990 \textcolor{comment}{ *      eviction of the specified cache entry.}
01991 \textcolor{comment}{ *}
01992 \textcolor{comment}{ *      At present, we only support the modified LRU policy, so}
01993 \textcolor{comment}{ *      this function deals with that case unconditionally.  If}
01994 \textcolor{comment}{ *      we ever support other replacement policies, the function}
01995 \textcolor{comment}{ *      should switch on the current policy and act accordingly.}
01996 \textcolor{comment}{ *}
01997 \textcolor{comment}{ * Return:      Non-negative on success/Negative on failure.}
01998 \textcolor{comment}{ *}
01999 \textcolor{comment}{ * Programmer:  John Mainzer, 5/10/04}
02000 \textcolor{comment}{ *}
02001 \textcolor{comment}{ * Modifications:}
02002 \textcolor{comment}{ *}
02003 \textcolor{comment}{ *      JRM - 7/27/04}
02004 \textcolor{comment}{ *      Converted the function H5C\_update\_rp\_for\_eviction() to the}
02005 \textcolor{comment}{ *      macro H5C\_\_UPDATE\_RP\_FOR\_EVICTION in an effort to squeeze}
02006 \textcolor{comment}{ *      a bit more performance out of the cache.}
02007 \textcolor{comment}{ *}
02008 \textcolor{comment}{ *      At least for the first cut, I am leaving the comments and}
02009 \textcolor{comment}{ *      white space in the macro.  If they cause dificulties with}
02010 \textcolor{comment}{ *      the pre-processor, I'll have to remove them.}
02011 \textcolor{comment}{ *}
02012 \textcolor{comment}{ *      JRM - 7/28/04}
02013 \textcolor{comment}{ *      Split macro into two version, one supporting the clean and}
02014 \textcolor{comment}{ *      dirty LRU lists, and the other not.  Yet another attempt}
02015 \textcolor{comment}{ *      at optimization.}
02016 \textcolor{comment}{ *}
02017 \textcolor{comment}{ *      JRM - 3/20/06}
02018 \textcolor{comment}{ *      Pinned entries can't be evicted, so this entry should never}
02019 \textcolor{comment}{ *      be called on a pinned entry.  Added assert to verify this.}
02020 \textcolor{comment}{ *}
02021 \textcolor{comment}{ *      JRM -- 3/28/07}
02022 \textcolor{comment}{ *      Added sanity checks for the new is\_read\_only and}
02023 \textcolor{comment}{ *      ro\_ref\_count fields of struct H5C\_cache\_entry\_t.}
02024 \textcolor{comment}{ *}
02025 \textcolor{comment}{ *-------------------------------------------------------------------------}
02026 \textcolor{comment}{ */}
02027 
02028 \textcolor{preprocessor}{#if H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS}
02029 
02030 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_RP\_FOR\_EVICTION(cache\_ptr, entry\_ptr, fail\_val)          \(\backslash\)}
02031 \textcolor{preprocessor}{\{                                                                            \(\backslash\)}
02032 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                                 \(\backslash\)}
02033 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                      \(\backslash\)}
02034 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                                 \(\backslash\)}
02035 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_protected) );                                \(\backslash\)}
02036 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                                \(\backslash\)}
02037 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                            \(\backslash\)}
02038 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_pinned) );                                   \(\backslash\)}
02039 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                       \(\backslash\)}
02040 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02041 \textcolor{preprocessor}{    }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                                         \(\backslash\)}
02042 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02043 \textcolor{preprocessor}{    }\textcolor{comment}{/* remove the entry from the LRU list. */}\textcolor{preprocessor}{                                \(\backslash\)}
02044 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02045 \textcolor{preprocessor}{    H5C\_\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,                  \(\backslash\)}
02046 \textcolor{preprocessor}{                    (cache\_ptr)->LRU\_tail\_ptr, (cache\_ptr)->LRU\_list\_len,    \(\backslash\)}
02047 \textcolor{preprocessor}{                    (cache\_ptr)->LRU\_list\_size, (fail\_val))                  \(\backslash\)}
02048 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02049 \textcolor{preprocessor}{    }\textcolor{comment}{/* If the entry is clean when it is evicted, it should be on the         \(\backslash\)}
02050 \textcolor{comment}{     * clean LRU list, if it was dirty, it should be on the dirty LRU list.  \(\backslash\)}
02051 \textcolor{comment}{     * Remove it from the appropriate list according to the value of the     \(\backslash\)}
02052 \textcolor{comment}{     * dirty flag.                                                           \(\backslash\)}
02053 \textcolor{comment}{     */}\textcolor{preprocessor}{                                                                      \(\backslash\)}
02054 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02055 \textcolor{preprocessor}{    if ( (entry\_ptr)->is\_dirty ) \{                                           \(\backslash\)}
02056 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02057 \textcolor{preprocessor}{        H5C\_\_AUX\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->dLRU\_head\_ptr,         \(\backslash\)}
02058 \textcolor{preprocessor}{                            (cache\_ptr)->dLRU\_tail\_ptr,                      \(\backslash\)}
02059 \textcolor{preprocessor}{                            (cache\_ptr)->dLRU\_list\_len,                      \(\backslash\)}
02060 \textcolor{preprocessor}{                            (cache\_ptr)->dLRU\_list\_size, (fail\_val))         \(\backslash\)}
02061 \textcolor{preprocessor}{    \} else \{                                                                 \(\backslash\)}
02062 \textcolor{preprocessor}{        H5C\_\_AUX\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->cLRU\_head\_ptr,         \(\backslash\)}
02063 \textcolor{preprocessor}{                            (cache\_ptr)->cLRU\_tail\_ptr,                      \(\backslash\)}
02064 \textcolor{preprocessor}{                            (cache\_ptr)->cLRU\_list\_len,                      \(\backslash\)}
02065 \textcolor{preprocessor}{                            (cache\_ptr)->cLRU\_list\_size, (fail\_val))         \(\backslash\)}
02066 \textcolor{preprocessor}{    \}                                                                        \(\backslash\)}
02067 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02068 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_UPDATE\_RP\_FOR\_EVICTION */}\textcolor{preprocessor}{}
02069 
02070 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
02071 
02072 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_RP\_FOR\_EVICTION(cache\_ptr, entry\_ptr, fail\_val)          \(\backslash\)}
02073 \textcolor{preprocessor}{\{                                                                            \(\backslash\)}
02074 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                                 \(\backslash\)}
02075 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                      \(\backslash\)}
02076 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                                 \(\backslash\)}
02077 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_protected) );                                \(\backslash\)}
02078 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                                \(\backslash\)}
02079 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                            \(\backslash\)}
02080 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_pinned) );                                   \(\backslash\)}
02081 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                       \(\backslash\)}
02082 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02083 \textcolor{preprocessor}{    }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                                         \(\backslash\)}
02084 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02085 \textcolor{preprocessor}{    }\textcolor{comment}{/* remove the entry from the LRU list. */}\textcolor{preprocessor}{                                \(\backslash\)}
02086 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02087 \textcolor{preprocessor}{    H5C\_\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,                  \(\backslash\)}
02088 \textcolor{preprocessor}{                    (cache\_ptr)->LRU\_tail\_ptr, (cache\_ptr)->LRU\_list\_len,    \(\backslash\)}
02089 \textcolor{preprocessor}{                    (cache\_ptr)->LRU\_list\_size, (fail\_val))                  \(\backslash\)}
02090 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02091 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_UPDATE\_RP\_FOR\_EVICTION */}\textcolor{preprocessor}{}
02092 
02093 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
02094 
02095 
02096 \textcolor{comment}{/*-------------------------------------------------------------------------}
02097 \textcolor{comment}{ *}
02098 \textcolor{comment}{ * Macro:   H5C\_\_UPDATE\_RP\_FOR\_FLUSH}
02099 \textcolor{comment}{ *}
02100 \textcolor{comment}{ * Purpose:     Update the replacement policy data structures for a flush}
02101 \textcolor{comment}{ *      of the specified cache entry.}
02102 \textcolor{comment}{ *}
02103 \textcolor{comment}{ *      At present, we only support the modified LRU policy, so}
02104 \textcolor{comment}{ *      this function deals with that case unconditionally.  If}
02105 \textcolor{comment}{ *      we ever support other replacement policies, the function}
02106 \textcolor{comment}{ *      should switch on the current policy and act accordingly.}
02107 \textcolor{comment}{ *}
02108 \textcolor{comment}{ * Return:      N/A}
02109 \textcolor{comment}{ *}
02110 \textcolor{comment}{ * Programmer:  John Mainzer, 5/6/04}
02111 \textcolor{comment}{ *}
02112 \textcolor{comment}{ * Modifications:}
02113 \textcolor{comment}{ *}
02114 \textcolor{comment}{ *      JRM - 7/27/04}
02115 \textcolor{comment}{ *      Converted the function H5C\_update\_rp\_for\_flush() to the}
02116 \textcolor{comment}{ *      macro H5C\_\_UPDATE\_RP\_FOR\_FLUSH in an effort to squeeze}
02117 \textcolor{comment}{ *      a bit more performance out of the cache.}
02118 \textcolor{comment}{ *}
02119 \textcolor{comment}{ *      At least for the first cut, I am leaving the comments and}
02120 \textcolor{comment}{ *      white space in the macro.  If they cause dificulties with}
02121 \textcolor{comment}{ *      pre-processor, I'll have to remove them.}
02122 \textcolor{comment}{ *}
02123 \textcolor{comment}{ *      JRM - 7/28/04}
02124 \textcolor{comment}{ *      Split macro into two versions, one supporting the clean and}
02125 \textcolor{comment}{ *      dirty LRU lists, and the other not.  Yet another attempt}
02126 \textcolor{comment}{ *      at optimization.}
02127 \textcolor{comment}{ *}
02128 \textcolor{comment}{ *      JRM - 3/20/06}
02129 \textcolor{comment}{ *      While pinned entries can be flushed, they don't reside in}
02130 \textcolor{comment}{ *      the replacement policy data structures when unprotected.}
02131 \textcolor{comment}{ *      Thus I modified this macro to do nothing if the entry is}
02132 \textcolor{comment}{ *      pinned.}
02133 \textcolor{comment}{ *}
02134 \textcolor{comment}{ *      JRM - 3/28/07}
02135 \textcolor{comment}{ *      Added sanity checks based on the new is\_read\_only and}
02136 \textcolor{comment}{ *      ro\_ref\_count fields of struct H5C\_cache\_entry\_t.}
02137 \textcolor{comment}{ *}
02138 \textcolor{comment}{ *-------------------------------------------------------------------------}
02139 \textcolor{comment}{ */}
02140 
02141 \textcolor{preprocessor}{#if H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS}
02142 
02143 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_RP\_FOR\_FLUSH(cache\_ptr, entry\_ptr, fail\_val)            \(\backslash\)}
02144 \textcolor{preprocessor}{\{                                                                           \(\backslash\)}
02145 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                                \(\backslash\)}
02146 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                     \(\backslash\)}
02147 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                                \(\backslash\)}
02148 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_protected) );                               \(\backslash\)}
02149 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                               \(\backslash\)}
02150 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                           \(\backslash\)}
02151 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                      \(\backslash\)}
02152 \textcolor{preprocessor}{                                                                            \(\backslash\)}
02153 \textcolor{preprocessor}{    if ( ! ((entry\_ptr)->is\_pinned) ) \{                                     \(\backslash\)}
02154 \textcolor{preprocessor}{                                                                            \(\backslash\)}
02155 \textcolor{preprocessor}{        }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                                    \(\backslash\)}
02156 \textcolor{preprocessor}{                                                                            \(\backslash\)}
02157 \textcolor{preprocessor}{        }\textcolor{comment}{/* remove the entry from the LRU list, and re-insert it at the      \(\backslash\)}
02158 \textcolor{comment}{     * head.                                                            \(\backslash\)}
02159 \textcolor{comment}{     */}\textcolor{preprocessor}{                                                                 \(\backslash\)}
02160 \textcolor{preprocessor}{                                                                            \(\backslash\)}
02161 \textcolor{preprocessor}{        H5C\_\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,             \(\backslash\)}
02162 \textcolor{preprocessor}{                        (cache\_ptr)->LRU\_tail\_ptr,                          \(\backslash\)}
02163 \textcolor{preprocessor}{            (cache\_ptr)->LRU\_list\_len,                          \(\backslash\)}
02164 \textcolor{preprocessor}{                        (cache\_ptr)->LRU\_list\_size, (fail\_val))             \(\backslash\)}
02165 \textcolor{preprocessor}{                                                                            \(\backslash\)}
02166 \textcolor{preprocessor}{        H5C\_\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,            \(\backslash\)}
02167 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_tail\_ptr,                         \(\backslash\)}
02168 \textcolor{preprocessor}{             (cache\_ptr)->LRU\_list\_len,                         \(\backslash\)}
02169 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_list\_size, (fail\_val))            \(\backslash\)}
02170 \textcolor{preprocessor}{                                                                            \(\backslash\)}
02171 \textcolor{preprocessor}{        }\textcolor{comment}{/* since the entry is being flushed or cleared, one would think     \(\backslash\)}
02172 \textcolor{comment}{     * that it must be dirty -- but that need not be the case.  Use the \(\backslash\)}
02173 \textcolor{comment}{     * dirty flag to infer whether the entry is on the clean or dirty   \(\backslash\)}
02174 \textcolor{comment}{     * LRU list, and remove it.  Then insert it at the head of the      \(\backslash\)}
02175 \textcolor{comment}{     * clean LRU list.                                                  \(\backslash\)}
02176 \textcolor{comment}{         *                                                                  \(\backslash\)}
02177 \textcolor{comment}{         * The function presumes that a dirty entry will be either cleared  \(\backslash\)}
02178 \textcolor{comment}{     * or flushed shortly, so it is OK if we put a dirty entry on the   \(\backslash\)}
02179 \textcolor{comment}{     * clean LRU list.                                                  \(\backslash\)}
02180 \textcolor{comment}{         */}\textcolor{preprocessor}{                                                                 \(\backslash\)}
02181 \textcolor{preprocessor}{                                                                            \(\backslash\)}
02182 \textcolor{preprocessor}{        if ( (entry\_ptr)->is\_dirty ) \{                                      \(\backslash\)}
02183 \textcolor{preprocessor}{            H5C\_\_AUX\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->dLRU\_head\_ptr,    \(\backslash\)}
02184 \textcolor{preprocessor}{                                (cache\_ptr)->dLRU\_tail\_ptr,                 \(\backslash\)}
02185 \textcolor{preprocessor}{                                (cache\_ptr)->dLRU\_list\_len,                 \(\backslash\)}
02186 \textcolor{preprocessor}{                                (cache\_ptr)->dLRU\_list\_size, (fail\_val))    \(\backslash\)}
02187 \textcolor{preprocessor}{        \} else \{                                                            \(\backslash\)}
02188 \textcolor{preprocessor}{            H5C\_\_AUX\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->cLRU\_head\_ptr,    \(\backslash\)}
02189 \textcolor{preprocessor}{                                (cache\_ptr)->cLRU\_tail\_ptr,                 \(\backslash\)}
02190 \textcolor{preprocessor}{                                (cache\_ptr)->cLRU\_list\_len,                 \(\backslash\)}
02191 \textcolor{preprocessor}{                                (cache\_ptr)->cLRU\_list\_size, (fail\_val))    \(\backslash\)}
02192 \textcolor{preprocessor}{        \}                                                                   \(\backslash\)}
02193 \textcolor{preprocessor}{                                                                            \(\backslash\)}
02194 \textcolor{preprocessor}{        H5C\_\_AUX\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->cLRU\_head\_ptr,       \(\backslash\)}
02195 \textcolor{preprocessor}{                             (cache\_ptr)->cLRU\_tail\_ptr,                    \(\backslash\)}
02196 \textcolor{preprocessor}{                             (cache\_ptr)->cLRU\_list\_len,                    \(\backslash\)}
02197 \textcolor{preprocessor}{                             (cache\_ptr)->cLRU\_list\_size, (fail\_val))       \(\backslash\)}
02198 \textcolor{preprocessor}{                                                                            \(\backslash\)}
02199 \textcolor{preprocessor}{        }\textcolor{comment}{/* End modified LRU specific code. */}\textcolor{preprocessor}{                               \(\backslash\)}
02200 \textcolor{preprocessor}{    \}                                                                       \(\backslash\)}
02201 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_UPDATE\_RP\_FOR\_FLUSH */}\textcolor{preprocessor}{}
02202 
02203 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
02204 
02205 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_RP\_FOR\_FLUSH(cache\_ptr, entry\_ptr, fail\_val)            \(\backslash\)}
02206 \textcolor{preprocessor}{\{                                                                           \(\backslash\)}
02207 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                                \(\backslash\)}
02208 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                     \(\backslash\)}
02209 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                                \(\backslash\)}
02210 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_protected) );                               \(\backslash\)}
02211 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                               \(\backslash\)}
02212 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                           \(\backslash\)}
02213 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                      \(\backslash\)}
02214 \textcolor{preprocessor}{                                                                            \(\backslash\)}
02215 \textcolor{preprocessor}{    if ( ! ((entry\_ptr)->is\_pinned) ) \{                                     \(\backslash\)}
02216 \textcolor{preprocessor}{                                                                            \(\backslash\)}
02217 \textcolor{preprocessor}{        }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                                    \(\backslash\)}
02218 \textcolor{preprocessor}{                                                                            \(\backslash\)}
02219 \textcolor{preprocessor}{        }\textcolor{comment}{/* remove the entry from the LRU list, and re-insert it at the      \(\backslash\)}
02220 \textcolor{comment}{     * head.                                                            \(\backslash\)}
02221 \textcolor{comment}{     */}\textcolor{preprocessor}{                                                                 \(\backslash\)}
02222 \textcolor{preprocessor}{                                                                            \(\backslash\)}
02223 \textcolor{preprocessor}{        H5C\_\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,             \(\backslash\)}
02224 \textcolor{preprocessor}{                        (cache\_ptr)->LRU\_tail\_ptr,                          \(\backslash\)}
02225 \textcolor{preprocessor}{            (cache\_ptr)->LRU\_list\_len,                          \(\backslash\)}
02226 \textcolor{preprocessor}{                        (cache\_ptr)->LRU\_list\_size, (fail\_val))             \(\backslash\)}
02227 \textcolor{preprocessor}{                                                                            \(\backslash\)}
02228 \textcolor{preprocessor}{        H5C\_\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,            \(\backslash\)}
02229 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_tail\_ptr,                         \(\backslash\)}
02230 \textcolor{preprocessor}{             (cache\_ptr)->LRU\_list\_len,                         \(\backslash\)}
02231 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_list\_size, (fail\_val))            \(\backslash\)}
02232 \textcolor{preprocessor}{                                                                            \(\backslash\)}
02233 \textcolor{preprocessor}{        }\textcolor{comment}{/* End modified LRU specific code. */}\textcolor{preprocessor}{                               \(\backslash\)}
02234 \textcolor{preprocessor}{    \}                                                                       \(\backslash\)}
02235 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_UPDATE\_RP\_FOR\_FLUSH */}\textcolor{preprocessor}{}
02236 
02237 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
02238 
02239 
02240 \textcolor{comment}{/*-------------------------------------------------------------------------}
02241 \textcolor{comment}{ *}
02242 \textcolor{comment}{ * Macro:   H5C\_\_UPDATE\_RP\_FOR\_INSERT\_APPEND}
02243 \textcolor{comment}{ *}
02244 \textcolor{comment}{ * Purpose:     Update the replacement policy data structures for an}
02245 \textcolor{comment}{ *      insertion of the specified cache entry.  }
02246 \textcolor{comment}{ *}
02247 \textcolor{comment}{ *      Unlike H5C\_\_UPDATE\_RP\_FOR\_INSERTION below, mark the }
02248 \textcolor{comment}{ *      new entry as the LEAST recently used entry, not the }
02249 \textcolor{comment}{ *      most recently used.  }
02250 \textcolor{comment}{ *}
02251 \textcolor{comment}{ *      For now at least, this macro should only be used in }
02252 \textcolor{comment}{ *      the reconstruction of the metadata cache from a cache }
02253 \textcolor{comment}{ *      image block.}
02254 \textcolor{comment}{ *}
02255 \textcolor{comment}{ *      At present, we only support the modified LRU policy, so}
02256 \textcolor{comment}{ *      this function deals with that case unconditionally.  If}
02257 \textcolor{comment}{ *      we ever support other replacement policies, the function}
02258 \textcolor{comment}{ *      should switch on the current policy and act accordingly.}
02259 \textcolor{comment}{ *}
02260 \textcolor{comment}{ * Return:      N/A}
02261 \textcolor{comment}{ *}
02262 \textcolor{comment}{ * Programmer:  John Mainzer, 8/15/15}
02263 \textcolor{comment}{ *}
02264 \textcolor{comment}{ *-------------------------------------------------------------------------}
02265 \textcolor{comment}{ */}
02266 
02267 \textcolor{preprocessor}{#if H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS}
02268 
02269 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_RP\_FOR\_INSERT\_APPEND(cache\_ptr, entry\_ptr, fail\_val)   \(\backslash\)}
02270 \textcolor{preprocessor}{\{                                                                          \(\backslash\)}
02271 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                               \(\backslash\)}
02272 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                    \(\backslash\)}
02273 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                               \(\backslash\)}
02274 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_protected) );                              \(\backslash\)}
02275 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                              \(\backslash\)}
02276 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                          \(\backslash\)}
02277 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                     \(\backslash\)}
02278 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02279 \textcolor{preprocessor}{    if ( (entry\_ptr)->is\_pinned ) \{                                        \(\backslash\)}
02280 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02281 \textcolor{preprocessor}{        H5C\_\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->pel\_head\_ptr,           \(\backslash\)}
02282 \textcolor{preprocessor}{                         (cache\_ptr)->pel\_tail\_ptr,                        \(\backslash\)}
02283 \textcolor{preprocessor}{                         (cache\_ptr)->pel\_len,                             \(\backslash\)}
02284 \textcolor{preprocessor}{                         (cache\_ptr)->pel\_size, (fail\_val))                \(\backslash\)}
02285 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02286 \textcolor{preprocessor}{    \} else \{                                                               \(\backslash\)}
02287 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02288 \textcolor{preprocessor}{        }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                                   \(\backslash\)}
02289 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02290 \textcolor{preprocessor}{        }\textcolor{comment}{/* insert the entry at the tail of the LRU list. */}\textcolor{preprocessor}{                \(\backslash\)}
02291 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02292 \textcolor{preprocessor}{        H5C\_\_DLL\_APPEND((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,            \(\backslash\)}
02293 \textcolor{preprocessor}{                        (cache\_ptr)->LRU\_tail\_ptr,                         \(\backslash\)}
02294 \textcolor{preprocessor}{                (cache\_ptr)->LRU\_list\_len,                         \(\backslash\)}
02295 \textcolor{preprocessor}{                        (cache\_ptr)->LRU\_list\_size, (fail\_val))            \(\backslash\)}
02296 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02297 \textcolor{preprocessor}{        }\textcolor{comment}{/* insert the entry at the tail of the clean or dirty LRU list as  \(\backslash\)}
02298 \textcolor{comment}{         * appropriate.                                                    \(\backslash\)}
02299 \textcolor{comment}{         */}\textcolor{preprocessor}{                                                                \(\backslash\)}
02300 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02301 \textcolor{preprocessor}{        if ( entry\_ptr->is\_dirty ) \{                                       \(\backslash\)}
02302 \textcolor{preprocessor}{            H5C\_\_AUX\_DLL\_APPEND((entry\_ptr), (cache\_ptr)->dLRU\_head\_ptr,   \(\backslash\)}
02303 \textcolor{preprocessor}{                                (cache\_ptr)->dLRU\_tail\_ptr,                \(\backslash\)}
02304 \textcolor{preprocessor}{                                (cache\_ptr)->dLRU\_list\_len,                \(\backslash\)}
02305 \textcolor{preprocessor}{                                (cache\_ptr)->dLRU\_list\_size, (fail\_val))   \(\backslash\)}
02306 \textcolor{preprocessor}{        \} else \{                                                           \(\backslash\)}
02307 \textcolor{preprocessor}{            H5C\_\_AUX\_DLL\_APPEND((entry\_ptr), (cache\_ptr)->cLRU\_head\_ptr,   \(\backslash\)}
02308 \textcolor{preprocessor}{                                (cache\_ptr)->cLRU\_tail\_ptr,                \(\backslash\)}
02309 \textcolor{preprocessor}{                                (cache\_ptr)->cLRU\_list\_len,                \(\backslash\)}
02310 \textcolor{preprocessor}{                                (cache\_ptr)->cLRU\_list\_size, (fail\_val))   \(\backslash\)}
02311 \textcolor{preprocessor}{        \}                                                                  \(\backslash\)}
02312 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02313 \textcolor{preprocessor}{        }\textcolor{comment}{/* End modified LRU specific code. */}\textcolor{preprocessor}{                              \(\backslash\)}
02314 \textcolor{preprocessor}{    \}                                                                      \(\backslash\)}
02315 \textcolor{preprocessor}{\}}
02316 
02317 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
02318 
02319 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_RP\_FOR\_INSERT\_APPEND(cache\_ptr, entry\_ptr, fail\_val)   \(\backslash\)}
02320 \textcolor{preprocessor}{\{                                                                          \(\backslash\)}
02321 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                               \(\backslash\)}
02322 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                    \(\backslash\)}
02323 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                               \(\backslash\)}
02324 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_protected) );                              \(\backslash\)}
02325 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                              \(\backslash\)}
02326 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                          \(\backslash\)}
02327 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                     \(\backslash\)}
02328 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02329 \textcolor{preprocessor}{    if ( (entry\_ptr)->is\_pinned ) \{                                        \(\backslash\)}
02330 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02331 \textcolor{preprocessor}{        H5C\_\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->pel\_head\_ptr,           \(\backslash\)}
02332 \textcolor{preprocessor}{                         (cache\_ptr)->pel\_tail\_ptr,                        \(\backslash\)}
02333 \textcolor{preprocessor}{                         (cache\_ptr)->pel\_len,                             \(\backslash\)}
02334 \textcolor{preprocessor}{                         (cache\_ptr)->pel\_size, (fail\_val))                \(\backslash\)}
02335 \textcolor{preprocessor}{                                                                       \(\backslash\)}
02336 \textcolor{preprocessor}{    \} else \{                                                               \(\backslash\)}
02337 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02338 \textcolor{preprocessor}{        }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                                   \(\backslash\)}
02339 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02340 \textcolor{preprocessor}{        }\textcolor{comment}{/* insert the entry at the tail of the LRU list. */}\textcolor{preprocessor}{                \(\backslash\)}
02341 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02342 \textcolor{preprocessor}{        H5C\_\_DLL\_APPEND((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,            \(\backslash\)}
02343 \textcolor{preprocessor}{                        (cache\_ptr)->LRU\_tail\_ptr,                         \(\backslash\)}
02344 \textcolor{preprocessor}{            (cache\_ptr)->LRU\_list\_len,                         \(\backslash\)}
02345 \textcolor{preprocessor}{                        (cache\_ptr)->LRU\_list\_size, (fail\_val))            \(\backslash\)}
02346 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02347 \textcolor{preprocessor}{        }\textcolor{comment}{/* End modified LRU specific code. */}\textcolor{preprocessor}{                              \(\backslash\)}
02348 \textcolor{preprocessor}{    \}                                                                      \(\backslash\)}
02349 \textcolor{preprocessor}{\}}
02350 
02351 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
02352 
02353 
02354 \textcolor{comment}{/*-------------------------------------------------------------------------}
02355 \textcolor{comment}{ *}
02356 \textcolor{comment}{ * Macro:   H5C\_\_UPDATE\_RP\_FOR\_INSERTION}
02357 \textcolor{comment}{ *}
02358 \textcolor{comment}{ * Purpose:     Update the replacement policy data structures for an}
02359 \textcolor{comment}{ *      insertion of the specified cache entry.}
02360 \textcolor{comment}{ *}
02361 \textcolor{comment}{ *      At present, we only support the modified LRU policy, so}
02362 \textcolor{comment}{ *      this function deals with that case unconditionally.  If}
02363 \textcolor{comment}{ *      we ever support other replacement policies, the function}
02364 \textcolor{comment}{ *      should switch on the current policy and act accordingly.}
02365 \textcolor{comment}{ *}
02366 \textcolor{comment}{ * Return:      N/A}
02367 \textcolor{comment}{ *}
02368 \textcolor{comment}{ * Programmer:  John Mainzer, 5/17/04}
02369 \textcolor{comment}{ *}
02370 \textcolor{comment}{ * Modifications:}
02371 \textcolor{comment}{ *}
02372 \textcolor{comment}{ *      JRM - 7/27/04}
02373 \textcolor{comment}{ *      Converted the function H5C\_update\_rp\_for\_insertion() to the}
02374 \textcolor{comment}{ *      macro H5C\_\_UPDATE\_RP\_FOR\_INSERTION in an effort to squeeze}
02375 \textcolor{comment}{ *      a bit more performance out of the cache.}
02376 \textcolor{comment}{ *}
02377 \textcolor{comment}{ *      At least for the first cut, I am leaving the comments and}
02378 \textcolor{comment}{ *      white space in the macro.  If they cause dificulties with}
02379 \textcolor{comment}{ *      pre-processor, I'll have to remove them.}
02380 \textcolor{comment}{ *}
02381 \textcolor{comment}{ *      JRM - 7/28/04}
02382 \textcolor{comment}{ *      Split macro into two version, one supporting the clean and}
02383 \textcolor{comment}{ *      dirty LRU lists, and the other not.  Yet another attempt}
02384 \textcolor{comment}{ *      at optimization.}
02385 \textcolor{comment}{ *}
02386 \textcolor{comment}{ *      JRM - 3/10/06}
02387 \textcolor{comment}{ *      This macro should never be called on a pinned entry.}
02388 \textcolor{comment}{ *      Inserted an assert to verify this.}
02389 \textcolor{comment}{ *}
02390 \textcolor{comment}{ *      JRM - 8/9/06}
02391 \textcolor{comment}{ *      Not any more.  We must now allow insertion of pinned}
02392 \textcolor{comment}{ *      entries.  Updated macro to support this.}
02393 \textcolor{comment}{ *}
02394 \textcolor{comment}{ *      JRM - 3/28/07}
02395 \textcolor{comment}{ *      Added sanity checks using the new is\_read\_only and}
02396 \textcolor{comment}{ *      ro\_ref\_count fields of struct H5C\_cache\_entry\_t.}
02397 \textcolor{comment}{ *}
02398 \textcolor{comment}{ *-------------------------------------------------------------------------}
02399 \textcolor{comment}{ */}
02400 
02401 \textcolor{preprocessor}{#if H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS}
02402 
02403 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_RP\_FOR\_INSERTION(cache\_ptr, entry\_ptr, fail\_val)       \(\backslash\)}
02404 \textcolor{preprocessor}{\{                                                                          \(\backslash\)}
02405 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                               \(\backslash\)}
02406 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                    \(\backslash\)}
02407 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                               \(\backslash\)}
02408 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_protected) );                              \(\backslash\)}
02409 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                              \(\backslash\)}
02410 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                          \(\backslash\)}
02411 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                     \(\backslash\)}
02412 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02413 \textcolor{preprocessor}{    if ( (entry\_ptr)->is\_pinned ) \{                                        \(\backslash\)}
02414 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02415 \textcolor{preprocessor}{        H5C\_\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->pel\_head\_ptr,           \(\backslash\)}
02416 \textcolor{preprocessor}{                         (cache\_ptr)->pel\_tail\_ptr,                        \(\backslash\)}
02417 \textcolor{preprocessor}{                         (cache\_ptr)->pel\_len,                             \(\backslash\)}
02418 \textcolor{preprocessor}{                         (cache\_ptr)->pel\_size, (fail\_val))                \(\backslash\)}
02419 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02420 \textcolor{preprocessor}{    \} else \{                                                               \(\backslash\)}
02421 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02422 \textcolor{preprocessor}{        }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                                   \(\backslash\)}
02423 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02424 \textcolor{preprocessor}{        }\textcolor{comment}{/* insert the entry at the head of the LRU list. */}\textcolor{preprocessor}{                \(\backslash\)}
02425 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02426 \textcolor{preprocessor}{        H5C\_\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,           \(\backslash\)}
02427 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_tail\_ptr,                        \(\backslash\)}
02428 \textcolor{preprocessor}{             (cache\_ptr)->LRU\_list\_len,                        \(\backslash\)}
02429 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_list\_size, (fail\_val))           \(\backslash\)}
02430 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02431 \textcolor{preprocessor}{        }\textcolor{comment}{/* insert the entry at the head of the clean or dirty LRU list as  \(\backslash\)}
02432 \textcolor{comment}{         * appropriate.                                                    \(\backslash\)}
02433 \textcolor{comment}{         */}\textcolor{preprocessor}{                                                                \(\backslash\)}
02434 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02435 \textcolor{preprocessor}{        if ( entry\_ptr->is\_dirty ) \{                                       \(\backslash\)}
02436 \textcolor{preprocessor}{            H5C\_\_AUX\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->dLRU\_head\_ptr,  \(\backslash\)}
02437 \textcolor{preprocessor}{                                 (cache\_ptr)->dLRU\_tail\_ptr,               \(\backslash\)}
02438 \textcolor{preprocessor}{                                 (cache\_ptr)->dLRU\_list\_len,               \(\backslash\)}
02439 \textcolor{preprocessor}{                                 (cache\_ptr)->dLRU\_list\_size, (fail\_val))  \(\backslash\)}
02440 \textcolor{preprocessor}{        \} else \{                                                           \(\backslash\)}
02441 \textcolor{preprocessor}{            H5C\_\_AUX\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->cLRU\_head\_ptr,  \(\backslash\)}
02442 \textcolor{preprocessor}{                                 (cache\_ptr)->cLRU\_tail\_ptr,               \(\backslash\)}
02443 \textcolor{preprocessor}{                                 (cache\_ptr)->cLRU\_list\_len,               \(\backslash\)}
02444 \textcolor{preprocessor}{                                 (cache\_ptr)->cLRU\_list\_size, (fail\_val))  \(\backslash\)}
02445 \textcolor{preprocessor}{        \}                                                                  \(\backslash\)}
02446 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02447 \textcolor{preprocessor}{        }\textcolor{comment}{/* End modified LRU specific code. */}\textcolor{preprocessor}{                              \(\backslash\)}
02448 \textcolor{preprocessor}{    \}                                                                      \(\backslash\)}
02449 \textcolor{preprocessor}{\}}
02450 
02451 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
02452 
02453 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_RP\_FOR\_INSERTION(cache\_ptr, entry\_ptr, fail\_val)       \(\backslash\)}
02454 \textcolor{preprocessor}{\{                                                                          \(\backslash\)}
02455 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                               \(\backslash\)}
02456 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                    \(\backslash\)}
02457 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                               \(\backslash\)}
02458 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_protected) );                              \(\backslash\)}
02459 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                              \(\backslash\)}
02460 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                          \(\backslash\)}
02461 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                     \(\backslash\)}
02462 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02463 \textcolor{preprocessor}{    if ( (entry\_ptr)->is\_pinned ) \{                                        \(\backslash\)}
02464 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02465 \textcolor{preprocessor}{        H5C\_\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->pel\_head\_ptr,           \(\backslash\)}
02466 \textcolor{preprocessor}{                         (cache\_ptr)->pel\_tail\_ptr,                        \(\backslash\)}
02467 \textcolor{preprocessor}{                         (cache\_ptr)->pel\_len,                             \(\backslash\)}
02468 \textcolor{preprocessor}{                         (cache\_ptr)->pel\_size, (fail\_val))                \(\backslash\)}
02469 \textcolor{preprocessor}{                                                                       \(\backslash\)}
02470 \textcolor{preprocessor}{    \} else \{                                                               \(\backslash\)}
02471 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02472 \textcolor{preprocessor}{        }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                                   \(\backslash\)}
02473 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02474 \textcolor{preprocessor}{        }\textcolor{comment}{/* insert the entry at the head of the LRU list. */}\textcolor{preprocessor}{                \(\backslash\)}
02475 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02476 \textcolor{preprocessor}{        H5C\_\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,           \(\backslash\)}
02477 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_tail\_ptr,                        \(\backslash\)}
02478 \textcolor{preprocessor}{             (cache\_ptr)->LRU\_list\_len,                        \(\backslash\)}
02479 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_list\_size, (fail\_val))           \(\backslash\)}
02480 \textcolor{preprocessor}{                                                                           \(\backslash\)}
02481 \textcolor{preprocessor}{        }\textcolor{comment}{/* End modified LRU specific code. */}\textcolor{preprocessor}{                              \(\backslash\)}
02482 \textcolor{preprocessor}{    \}                                                                      \(\backslash\)}
02483 \textcolor{preprocessor}{\}}
02484 
02485 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
02486 
02487 
02488 \textcolor{comment}{/*-------------------------------------------------------------------------}
02489 \textcolor{comment}{ *}
02490 \textcolor{comment}{ * Macro:   H5C\_\_UPDATE\_RP\_FOR\_PROTECT}
02491 \textcolor{comment}{ *}
02492 \textcolor{comment}{ * Purpose:     Update the replacement policy data structures for a}
02493 \textcolor{comment}{ *      protect of the specified cache entry.}
02494 \textcolor{comment}{ *}
02495 \textcolor{comment}{ *      To do this, unlink the specified entry from any data}
02496 \textcolor{comment}{ *      structures used by the replacement policy, and add the}
02497 \textcolor{comment}{ *      entry to the protected list.}
02498 \textcolor{comment}{ *}
02499 \textcolor{comment}{ *      At present, we only support the modified LRU policy, so}
02500 \textcolor{comment}{ *      this function deals with that case unconditionally.  If}
02501 \textcolor{comment}{ *      we ever support other replacement policies, the function}
02502 \textcolor{comment}{ *      should switch on the current policy and act accordingly.}
02503 \textcolor{comment}{ *}
02504 \textcolor{comment}{ * Return:      N/A}
02505 \textcolor{comment}{ *}
02506 \textcolor{comment}{ * Programmer:  John Mainzer, 5/17/04}
02507 \textcolor{comment}{ *}
02508 \textcolor{comment}{ * Modifications:}
02509 \textcolor{comment}{ *}
02510 \textcolor{comment}{ *      JRM - 7/27/04}
02511 \textcolor{comment}{ *      Converted the function H5C\_update\_rp\_for\_protect() to the}
02512 \textcolor{comment}{ *      macro H5C\_\_UPDATE\_RP\_FOR\_PROTECT in an effort to squeeze}
02513 \textcolor{comment}{ *      a bit more performance out of the cache.}
02514 \textcolor{comment}{ *}
02515 \textcolor{comment}{ *      At least for the first cut, I am leaving the comments and}
02516 \textcolor{comment}{ *      white space in the macro.  If they cause dificulties with}
02517 \textcolor{comment}{ *      pre-processor, I'll have to remove them.}
02518 \textcolor{comment}{ *}
02519 \textcolor{comment}{ *      JRM - 7/28/04}
02520 \textcolor{comment}{ *      Split macro into two version, one supporting the clean and}
02521 \textcolor{comment}{ *      dirty LRU lists, and the other not.  Yet another attempt}
02522 \textcolor{comment}{ *      at optimization.}
02523 \textcolor{comment}{ *}
02524 \textcolor{comment}{ *      JRM - 3/17/06}
02525 \textcolor{comment}{ *      Modified macro to attempt to remove pinned entriese from}
02526 \textcolor{comment}{ *      the pinned entry list instead of from the data structures}
02527 \textcolor{comment}{ *      maintained by the replacement policy.}
02528 \textcolor{comment}{ *}
02529 \textcolor{comment}{ *      JRM - 3/28/07}
02530 \textcolor{comment}{ *      Added sanity checks based on the new is\_read\_only and}
02531 \textcolor{comment}{ *      ro\_ref\_count fields of struct H5C\_cache\_entry\_t.}
02532 \textcolor{comment}{ *}
02533 \textcolor{comment}{ *-------------------------------------------------------------------------}
02534 \textcolor{comment}{ */}
02535 
02536 \textcolor{preprocessor}{#if H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS}
02537 
02538 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_RP\_FOR\_PROTECT(cache\_ptr, entry\_ptr, fail\_val)        \(\backslash\)}
02539 \textcolor{preprocessor}{\{                                                                         \(\backslash\)}
02540 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                              \(\backslash\)}
02541 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                   \(\backslash\)}
02542 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                              \(\backslash\)}
02543 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_protected) );                             \(\backslash\)}
02544 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                             \(\backslash\)}
02545 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                         \(\backslash\)}
02546 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                    \(\backslash\)}
02547 \textcolor{preprocessor}{                                      \(\backslash\)}
02548 \textcolor{preprocessor}{    if ( (entry\_ptr)->is\_pinned ) \{                                       \(\backslash\)}
02549 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02550 \textcolor{preprocessor}{        H5C\_\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->pel\_head\_ptr,           \(\backslash\)}
02551 \textcolor{preprocessor}{                        (cache\_ptr)->pel\_tail\_ptr,            \(\backslash\)}
02552 \textcolor{preprocessor}{            (cache\_ptr)->pel\_len,                             \(\backslash\)}
02553 \textcolor{preprocessor}{                        (cache\_ptr)->pel\_size, (fail\_val))                \(\backslash\)}
02554 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02555 \textcolor{preprocessor}{    \} else \{                                                              \(\backslash\)}
02556 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02557 \textcolor{preprocessor}{        }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                                  \(\backslash\)}
02558 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02559 \textcolor{preprocessor}{        }\textcolor{comment}{/* remove the entry from the LRU list. */}\textcolor{preprocessor}{                         \(\backslash\)}
02560 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02561 \textcolor{preprocessor}{        H5C\_\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,           \(\backslash\)}
02562 \textcolor{preprocessor}{                        (cache\_ptr)->LRU\_tail\_ptr,                        \(\backslash\)}
02563 \textcolor{preprocessor}{            (cache\_ptr)->LRU\_list\_len,                        \(\backslash\)}
02564 \textcolor{preprocessor}{                        (cache\_ptr)->LRU\_list\_size, (fail\_val))           \(\backslash\)}
02565 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02566 \textcolor{preprocessor}{        }\textcolor{comment}{/* Similarly, remove the entry from the clean or dirty LRU list   \(\backslash\)}
02567 \textcolor{comment}{         * as appropriate.                                                \(\backslash\)}
02568 \textcolor{comment}{         */}\textcolor{preprocessor}{                                                               \(\backslash\)}
02569 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02570 \textcolor{preprocessor}{        if ( (entry\_ptr)->is\_dirty ) \{                                    \(\backslash\)}
02571 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02572 \textcolor{preprocessor}{            H5C\_\_AUX\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->dLRU\_head\_ptr,  \(\backslash\)}
02573 \textcolor{preprocessor}{                                (cache\_ptr)->dLRU\_tail\_ptr,               \(\backslash\)}
02574 \textcolor{preprocessor}{                                (cache\_ptr)->dLRU\_list\_len,               \(\backslash\)}
02575 \textcolor{preprocessor}{                                (cache\_ptr)->dLRU\_list\_size, (fail\_val))  \(\backslash\)}
02576 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02577 \textcolor{preprocessor}{        \} else \{                                                          \(\backslash\)}
02578 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02579 \textcolor{preprocessor}{            H5C\_\_AUX\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->cLRU\_head\_ptr,  \(\backslash\)}
02580 \textcolor{preprocessor}{                                (cache\_ptr)->cLRU\_tail\_ptr,               \(\backslash\)}
02581 \textcolor{preprocessor}{                                (cache\_ptr)->cLRU\_list\_len,               \(\backslash\)}
02582 \textcolor{preprocessor}{                                (cache\_ptr)->cLRU\_list\_size, (fail\_val))  \(\backslash\)}
02583 \textcolor{preprocessor}{        \}                                                                 \(\backslash\)}
02584 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02585 \textcolor{preprocessor}{        }\textcolor{comment}{/* End modified LRU specific code. */}\textcolor{preprocessor}{                             \(\backslash\)}
02586 \textcolor{preprocessor}{    \}                                                                     \(\backslash\)}
02587 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02588 \textcolor{preprocessor}{    }\textcolor{comment}{/* Regardless of the replacement policy, or whether the entry is      \(\backslash\)}
02589 \textcolor{comment}{     * pinned, now add the entry to the protected list.                   \(\backslash\)}
02590 \textcolor{comment}{     */}\textcolor{preprocessor}{                                                                   \(\backslash\)}
02591 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02592 \textcolor{preprocessor}{    H5C\_\_DLL\_APPEND((entry\_ptr), (cache\_ptr)->pl\_head\_ptr,                \(\backslash\)}
02593 \textcolor{preprocessor}{                    (cache\_ptr)->pl\_tail\_ptr,                             \(\backslash\)}
02594 \textcolor{preprocessor}{                    (cache\_ptr)->pl\_len,                                  \(\backslash\)}
02595 \textcolor{preprocessor}{                    (cache\_ptr)->pl\_size, (fail\_val))                     \(\backslash\)}
02596 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_UPDATE\_RP\_FOR\_PROTECT */}\textcolor{preprocessor}{}
02597 
02598 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
02599 
02600 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_RP\_FOR\_PROTECT(cache\_ptr, entry\_ptr, fail\_val)        \(\backslash\)}
02601 \textcolor{preprocessor}{\{                                                                         \(\backslash\)}
02602 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                              \(\backslash\)}
02603 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                   \(\backslash\)}
02604 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                              \(\backslash\)}
02605 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_protected) );                             \(\backslash\)}
02606 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                             \(\backslash\)}
02607 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                         \(\backslash\)}
02608 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                    \(\backslash\)}
02609 \textcolor{preprocessor}{                                      \(\backslash\)}
02610 \textcolor{preprocessor}{    if ( (entry\_ptr)->is\_pinned ) \{                                       \(\backslash\)}
02611 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02612 \textcolor{preprocessor}{        H5C\_\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->pel\_head\_ptr,           \(\backslash\)}
02613 \textcolor{preprocessor}{                        (cache\_ptr)->pel\_tail\_ptr,            \(\backslash\)}
02614 \textcolor{preprocessor}{            (cache\_ptr)->pel\_len,                             \(\backslash\)}
02615 \textcolor{preprocessor}{                        (cache\_ptr)->pel\_size, (fail\_val))                \(\backslash\)}
02616 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02617 \textcolor{preprocessor}{    \} else \{                                                              \(\backslash\)}
02618 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02619 \textcolor{preprocessor}{        }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                                  \(\backslash\)}
02620 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02621 \textcolor{preprocessor}{        }\textcolor{comment}{/* remove the entry from the LRU list. */}\textcolor{preprocessor}{                         \(\backslash\)}
02622 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02623 \textcolor{preprocessor}{        H5C\_\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,           \(\backslash\)}
02624 \textcolor{preprocessor}{                        (cache\_ptr)->LRU\_tail\_ptr,                        \(\backslash\)}
02625 \textcolor{preprocessor}{            (cache\_ptr)->LRU\_list\_len,                        \(\backslash\)}
02626 \textcolor{preprocessor}{                        (cache\_ptr)->LRU\_list\_size, (fail\_val))           \(\backslash\)}
02627 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02628 \textcolor{preprocessor}{        }\textcolor{comment}{/* End modified LRU specific code. */}\textcolor{preprocessor}{                             \(\backslash\)}
02629 \textcolor{preprocessor}{    \}                                                                     \(\backslash\)}
02630 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02631 \textcolor{preprocessor}{    }\textcolor{comment}{/* Regardless of the replacement policy, or whether the entry is      \(\backslash\)}
02632 \textcolor{comment}{     * pinned, now add the entry to the protected list.                   \(\backslash\)}
02633 \textcolor{comment}{     */}\textcolor{preprocessor}{                                                                   \(\backslash\)}
02634 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02635 \textcolor{preprocessor}{    H5C\_\_DLL\_APPEND((entry\_ptr), (cache\_ptr)->pl\_head\_ptr,                \(\backslash\)}
02636 \textcolor{preprocessor}{                    (cache\_ptr)->pl\_tail\_ptr,                             \(\backslash\)}
02637 \textcolor{preprocessor}{                    (cache\_ptr)->pl\_len,                                  \(\backslash\)}
02638 \textcolor{preprocessor}{                    (cache\_ptr)->pl\_size, (fail\_val))                     \(\backslash\)}
02639 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_UPDATE\_RP\_FOR\_PROTECT */}\textcolor{preprocessor}{}
02640 
02641 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
02642 
02643 
02644 \textcolor{comment}{/*-------------------------------------------------------------------------}
02645 \textcolor{comment}{ *}
02646 \textcolor{comment}{ * Macro:   H5C\_\_UPDATE\_RP\_FOR\_MOVE}
02647 \textcolor{comment}{ *}
02648 \textcolor{comment}{ * Purpose:     Update the replacement policy data structures for a}
02649 \textcolor{comment}{ *      move of the specified cache entry.}
02650 \textcolor{comment}{ *}
02651 \textcolor{comment}{ *      At present, we only support the modified LRU policy, so}
02652 \textcolor{comment}{ *      this function deals with that case unconditionally.  If}
02653 \textcolor{comment}{ *      we ever support other replacement policies, the function}
02654 \textcolor{comment}{ *      should switch on the current policy and act accordingly.}
02655 \textcolor{comment}{ *}
02656 \textcolor{comment}{ * Return:      N/A}
02657 \textcolor{comment}{ *}
02658 \textcolor{comment}{ * Programmer:  John Mainzer, 5/17/04}
02659 \textcolor{comment}{ *}
02660 \textcolor{comment}{ *-------------------------------------------------------------------------}
02661 \textcolor{comment}{ */}
02662 
02663 \textcolor{preprocessor}{#if H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS}
02664 
02665 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_RP\_FOR\_MOVE(cache\_ptr, entry\_ptr, was\_dirty, fail\_val) \(\backslash\)}
02666 \textcolor{preprocessor}{\{                                                                            \(\backslash\)}
02667 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                                 \(\backslash\)}
02668 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                      \(\backslash\)}
02669 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                                 \(\backslash\)}
02670 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                                \(\backslash\)}
02671 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                            \(\backslash\)}
02672 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                       \(\backslash\)}
02673 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02674 \textcolor{preprocessor}{    if ( ! ( (entry\_ptr)->is\_pinned ) && ! ( (entry\_ptr->is\_protected ) ) ) \{ \(\backslash\)}
02675 \textcolor{preprocessor}{                                                                         \(\backslash\)}
02676 \textcolor{preprocessor}{        }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                                     \(\backslash\)}
02677 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02678 \textcolor{preprocessor}{        }\textcolor{comment}{/* remove the entry from the LRU list, and re-insert it at the head. \(\backslash\)}
02679 \textcolor{comment}{     */}\textcolor{preprocessor}{                                                                  \(\backslash\)}
02680 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02681 \textcolor{preprocessor}{            H5C\_\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,          \(\backslash\)}
02682 \textcolor{preprocessor}{                             (cache\_ptr)->LRU\_tail\_ptr,                      \(\backslash\)}
02683 \textcolor{preprocessor}{                 (cache\_ptr)->LRU\_list\_len,                      \(\backslash\)}
02684 \textcolor{preprocessor}{                             (cache\_ptr)->LRU\_list\_size, (fail\_val))         \(\backslash\)}
02685 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02686 \textcolor{preprocessor}{        H5C\_\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,             \(\backslash\)}
02687 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_tail\_ptr,                          \(\backslash\)}
02688 \textcolor{preprocessor}{             (cache\_ptr)->LRU\_list\_len,                          \(\backslash\)}
02689 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_list\_size, (fail\_val))             \(\backslash\)}
02690 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02691 \textcolor{preprocessor}{            }\textcolor{comment}{/* remove the entry from either the clean or dirty LUR list as   \(\backslash\)}
02692 \textcolor{comment}{             * indicated by the was\_dirty parameter                          \(\backslash\)}
02693 \textcolor{comment}{             */}\textcolor{preprocessor}{                                                              \(\backslash\)}
02694 \textcolor{preprocessor}{            if ( was\_dirty ) \{                                               \(\backslash\)}
02695 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02696 \textcolor{preprocessor}{                H5C\_\_AUX\_DLL\_REMOVE((entry\_ptr),                             \(\backslash\)}
02697 \textcolor{preprocessor}{                     (cache\_ptr)->dLRU\_head\_ptr,             \(\backslash\)}
02698 \textcolor{preprocessor}{                                     (cache\_ptr)->dLRU\_tail\_ptr,             \(\backslash\)}
02699 \textcolor{preprocessor}{                                     (cache\_ptr)->dLRU\_list\_len,             \(\backslash\)}
02700 \textcolor{preprocessor}{                                     (cache\_ptr)->dLRU\_list\_size,            \(\backslash\)}
02701 \textcolor{preprocessor}{                     (fail\_val))                             \(\backslash\)}
02702 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02703 \textcolor{preprocessor}{            \} else \{                                                         \(\backslash\)}
02704 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02705 \textcolor{preprocessor}{                H5C\_\_AUX\_DLL\_REMOVE((entry\_ptr),                             \(\backslash\)}
02706 \textcolor{preprocessor}{                     (cache\_ptr)->cLRU\_head\_ptr,             \(\backslash\)}
02707 \textcolor{preprocessor}{                                     (cache\_ptr)->cLRU\_tail\_ptr,             \(\backslash\)}
02708 \textcolor{preprocessor}{                                     (cache\_ptr)->cLRU\_list\_len,             \(\backslash\)}
02709 \textcolor{preprocessor}{                                     (cache\_ptr)->cLRU\_list\_size,            \(\backslash\)}
02710 \textcolor{preprocessor}{                     (fail\_val))                             \(\backslash\)}
02711 \textcolor{preprocessor}{            \}                                                                \(\backslash\)}
02712 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02713 \textcolor{preprocessor}{            }\textcolor{comment}{/* insert the entry at the head of either the clean or dirty     \(\backslash\)}
02714 \textcolor{comment}{         * LRU list as appropriate.                                      \(\backslash\)}
02715 \textcolor{comment}{             */}\textcolor{preprocessor}{                                                              \(\backslash\)}
02716 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02717 \textcolor{preprocessor}{            if ( (entry\_ptr)->is\_dirty ) \{                                   \(\backslash\)}
02718 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02719 \textcolor{preprocessor}{                H5C\_\_AUX\_DLL\_PREPEND((entry\_ptr),                            \(\backslash\)}
02720 \textcolor{preprocessor}{                      (cache\_ptr)->dLRU\_head\_ptr,            \(\backslash\)}
02721 \textcolor{preprocessor}{                                      (cache\_ptr)->dLRU\_tail\_ptr,            \(\backslash\)}
02722 \textcolor{preprocessor}{                                      (cache\_ptr)->dLRU\_list\_len,            \(\backslash\)}
02723 \textcolor{preprocessor}{                                      (cache\_ptr)->dLRU\_list\_size,           \(\backslash\)}
02724 \textcolor{preprocessor}{                      (fail\_val))                            \(\backslash\)}
02725 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02726 \textcolor{preprocessor}{            \} else \{                                                         \(\backslash\)}
02727 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02728 \textcolor{preprocessor}{                H5C\_\_AUX\_DLL\_PREPEND((entry\_ptr),                            \(\backslash\)}
02729 \textcolor{preprocessor}{                      (cache\_ptr)->cLRU\_head\_ptr,            \(\backslash\)}
02730 \textcolor{preprocessor}{                                      (cache\_ptr)->cLRU\_tail\_ptr,            \(\backslash\)}
02731 \textcolor{preprocessor}{                                      (cache\_ptr)->cLRU\_list\_len,            \(\backslash\)}
02732 \textcolor{preprocessor}{                                      (cache\_ptr)->cLRU\_list\_size,           \(\backslash\)}
02733 \textcolor{preprocessor}{                      (fail\_val))                            \(\backslash\)}
02734 \textcolor{preprocessor}{            \}                                                                \(\backslash\)}
02735 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02736 \textcolor{preprocessor}{            }\textcolor{comment}{/* End modified LRU specific code. */}\textcolor{preprocessor}{                            \(\backslash\)}
02737 \textcolor{preprocessor}{        \}                                                                    \(\backslash\)}
02738 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_UPDATE\_RP\_FOR\_MOVE */}\textcolor{preprocessor}{}
02739 
02740 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
02741 
02742 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_RP\_FOR\_MOVE(cache\_ptr, entry\_ptr, was\_dirty, fail\_val) \(\backslash\)}
02743 \textcolor{preprocessor}{\{                                                                            \(\backslash\)}
02744 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                                 \(\backslash\)}
02745 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                      \(\backslash\)}
02746 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                                 \(\backslash\)}
02747 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                                \(\backslash\)}
02748 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                            \(\backslash\)}
02749 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                       \(\backslash\)}
02750 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02751 \textcolor{preprocessor}{    if ( ! ( (entry\_ptr)->is\_pinned ) && ! ( (entry\_ptr->is\_protected ) ) ) \{ \(\backslash\)}
02752 \textcolor{preprocessor}{                                                                         \(\backslash\)}
02753 \textcolor{preprocessor}{        }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                                     \(\backslash\)}
02754 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02755 \textcolor{preprocessor}{        }\textcolor{comment}{/* remove the entry from the LRU list, and re-insert it at the head. \(\backslash\)}
02756 \textcolor{comment}{     */}\textcolor{preprocessor}{                                                                  \(\backslash\)}
02757 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02758 \textcolor{preprocessor}{            H5C\_\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,          \(\backslash\)}
02759 \textcolor{preprocessor}{                             (cache\_ptr)->LRU\_tail\_ptr,                      \(\backslash\)}
02760 \textcolor{preprocessor}{                 (cache\_ptr)->LRU\_list\_len,                      \(\backslash\)}
02761 \textcolor{preprocessor}{                             (cache\_ptr)->LRU\_list\_size, (fail\_val))         \(\backslash\)}
02762 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02763 \textcolor{preprocessor}{            H5C\_\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,         \(\backslash\)}
02764 \textcolor{preprocessor}{                              (cache\_ptr)->LRU\_tail\_ptr,                     \(\backslash\)}
02765 \textcolor{preprocessor}{                  (cache\_ptr)->LRU\_list\_len,                     \(\backslash\)}
02766 \textcolor{preprocessor}{                              (cache\_ptr)->LRU\_list\_size, (fail\_val))        \(\backslash\)}
02767 \textcolor{preprocessor}{                                                                             \(\backslash\)}
02768 \textcolor{preprocessor}{            }\textcolor{comment}{/* End modified LRU specific code. */}\textcolor{preprocessor}{                            \(\backslash\)}
02769 \textcolor{preprocessor}{        \}                                                                    \(\backslash\)}
02770 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_UPDATE\_RP\_FOR\_MOVE */}\textcolor{preprocessor}{}
02771 
02772 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
02773 
02774 
02775 \textcolor{comment}{/*-------------------------------------------------------------------------}
02776 \textcolor{comment}{ *}
02777 \textcolor{comment}{ * Macro:   H5C\_\_UPDATE\_RP\_FOR\_SIZE\_CHANGE}
02778 \textcolor{comment}{ *}
02779 \textcolor{comment}{ * Purpose:     Update the replacement policy data structures for a}
02780 \textcolor{comment}{ *      size change of the specified cache entry.}
02781 \textcolor{comment}{ *}
02782 \textcolor{comment}{ *      To do this, determine if the entry is pinned.  If it is,}
02783 \textcolor{comment}{ *      update the size of the pinned entry list.}
02784 \textcolor{comment}{ *}
02785 \textcolor{comment}{ *      If it isn't pinned, the entry must handled by the}
02786 \textcolor{comment}{ *      replacement policy.  Update the appropriate replacement}
02787 \textcolor{comment}{ *      policy data structures.}
02788 \textcolor{comment}{ *}
02789 \textcolor{comment}{ *      At present, we only support the modified LRU policy, so}
02790 \textcolor{comment}{ *      this function deals with that case unconditionally.  If}
02791 \textcolor{comment}{ *      we ever support other replacement policies, the function}
02792 \textcolor{comment}{ *      should switch on the current policy and act accordingly.}
02793 \textcolor{comment}{ *}
02794 \textcolor{comment}{ * Return:      N/A}
02795 \textcolor{comment}{ *}
02796 \textcolor{comment}{ * Programmer:  John Mainzer, 8/23/06}
02797 \textcolor{comment}{ *}
02798 \textcolor{comment}{ * Modifications:}
02799 \textcolor{comment}{ *}
02800 \textcolor{comment}{ *      JRM -- 3/28/07}
02801 \textcolor{comment}{ *      Added sanity checks based on the new is\_read\_only and}
02802 \textcolor{comment}{ *      ro\_ref\_count fields of struct H5C\_cache\_entry\_t.}
02803 \textcolor{comment}{ *}
02804 \textcolor{comment}{ *-------------------------------------------------------------------------}
02805 \textcolor{comment}{ */}
02806 
02807 \textcolor{preprocessor}{#if H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS}
02808 
02809 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_RP\_FOR\_SIZE\_CHANGE(cache\_ptr, entry\_ptr, new\_size)    \(\backslash\)}
02810 \textcolor{preprocessor}{\{                                                                         \(\backslash\)}
02811 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                              \(\backslash\)}
02812 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                   \(\backslash\)}
02813 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                              \(\backslash\)}
02814 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_protected) );                             \(\backslash\)}
02815 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                             \(\backslash\)}
02816 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                         \(\backslash\)}
02817 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                    \(\backslash\)}
02818 \textcolor{preprocessor}{    HDassert( new\_size > 0 );                                             \(\backslash\)}
02819 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02820 \textcolor{preprocessor}{    if ( (entry\_ptr)->coll\_access ) \{                                     \(\backslash\)}
02821 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02822 \textcolor{preprocessor}{    H5C\_\_DLL\_UPDATE\_FOR\_SIZE\_CHANGE((cache\_ptr)->coll\_list\_len,       \(\backslash\)}
02823 \textcolor{preprocessor}{                            (cache\_ptr)->coll\_list\_size,      \(\backslash\)}
02824 \textcolor{preprocessor}{                            (entry\_ptr)->size,                \(\backslash\)}
02825 \textcolor{preprocessor}{                    (new\_size));                      \(\backslash\)}
02826 \textcolor{preprocessor}{                                                                      \(\backslash\)}
02827 \textcolor{preprocessor}{    \}                                                                     \(\backslash\)}
02828 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02829 \textcolor{preprocessor}{    if ( (entry\_ptr)->is\_pinned ) \{                                       \(\backslash\)}
02830 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02831 \textcolor{preprocessor}{    H5C\_\_DLL\_UPDATE\_FOR\_SIZE\_CHANGE((cache\_ptr)->pel\_len,             \(\backslash\)}
02832 \textcolor{preprocessor}{                            (cache\_ptr)->pel\_size,            \(\backslash\)}
02833 \textcolor{preprocessor}{                            (entry\_ptr)->size,                \(\backslash\)}
02834 \textcolor{preprocessor}{                    (new\_size));                      \(\backslash\)}
02835 \textcolor{preprocessor}{                                                                      \(\backslash\)}
02836 \textcolor{preprocessor}{    \} else \{                                                              \(\backslash\)}
02837 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02838 \textcolor{preprocessor}{        }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                                  \(\backslash\)}
02839 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02840 \textcolor{preprocessor}{    }\textcolor{comment}{/* Update the size of the LRU list */}\textcolor{preprocessor}{                             \(\backslash\)}
02841 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02842 \textcolor{preprocessor}{    H5C\_\_DLL\_UPDATE\_FOR\_SIZE\_CHANGE((cache\_ptr)->LRU\_list\_len,        \(\backslash\)}
02843 \textcolor{preprocessor}{                            (cache\_ptr)->LRU\_list\_size,       \(\backslash\)}
02844 \textcolor{preprocessor}{                            (entry\_ptr)->size,                \(\backslash\)}
02845 \textcolor{preprocessor}{                    (new\_size));                      \(\backslash\)}
02846 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02847 \textcolor{preprocessor}{        }\textcolor{comment}{/* Similarly, update the size of the clean or dirty LRU list as   \(\backslash\)}
02848 \textcolor{comment}{     * appropriate.  At present, the entry must be clean, but that    \(\backslash\)}
02849 \textcolor{comment}{     * could change.                                                  \(\backslash\)}
02850 \textcolor{comment}{         */}\textcolor{preprocessor}{                                                               \(\backslash\)}
02851 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02852 \textcolor{preprocessor}{        if ( (entry\_ptr)->is\_dirty ) \{                                    \(\backslash\)}
02853 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02854 \textcolor{preprocessor}{        H5C\_\_DLL\_UPDATE\_FOR\_SIZE\_CHANGE((cache\_ptr)->dLRU\_list\_len,   \(\backslash\)}
02855 \textcolor{preprocessor}{                                (cache\_ptr)->dLRU\_list\_size,  \(\backslash\)}
02856 \textcolor{preprocessor}{                                (entry\_ptr)->size,            \(\backslash\)}
02857 \textcolor{preprocessor}{                        (new\_size));                  \(\backslash\)}
02858 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02859 \textcolor{preprocessor}{        \} else \{                                                          \(\backslash\)}
02860 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02861 \textcolor{preprocessor}{        H5C\_\_DLL\_UPDATE\_FOR\_SIZE\_CHANGE((cache\_ptr)->cLRU\_list\_len,   \(\backslash\)}
02862 \textcolor{preprocessor}{                                (cache\_ptr)->cLRU\_list\_size,  \(\backslash\)}
02863 \textcolor{preprocessor}{                                (entry\_ptr)->size,            \(\backslash\)}
02864 \textcolor{preprocessor}{                        (new\_size));                  \(\backslash\)}
02865 \textcolor{preprocessor}{        \}                                                                 \(\backslash\)}
02866 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02867 \textcolor{preprocessor}{        }\textcolor{comment}{/* End modified LRU specific code. */}\textcolor{preprocessor}{                             \(\backslash\)}
02868 \textcolor{preprocessor}{    \}                                                                     \(\backslash\)}
02869 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02870 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_UPDATE\_RP\_FOR\_SIZE\_CHANGE */}\textcolor{preprocessor}{}
02871 
02872 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
02873 
02874 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_RP\_FOR\_SIZE\_CHANGE(cache\_ptr, entry\_ptr, new\_size)    \(\backslash\)}
02875 \textcolor{preprocessor}{\{                                                                         \(\backslash\)}
02876 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                              \(\backslash\)}
02877 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                   \(\backslash\)}
02878 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                              \(\backslash\)}
02879 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_protected) );                             \(\backslash\)}
02880 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                             \(\backslash\)}
02881 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                         \(\backslash\)}
02882 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                    \(\backslash\)}
02883 \textcolor{preprocessor}{    HDassert( new\_size > 0 );                                             \(\backslash\)}
02884 \textcolor{preprocessor}{                                      \(\backslash\)}
02885 \textcolor{preprocessor}{    if ( (entry\_ptr)->is\_pinned ) \{                                       \(\backslash\)}
02886 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02887 \textcolor{preprocessor}{    H5C\_\_DLL\_UPDATE\_FOR\_SIZE\_CHANGE((cache\_ptr)->pel\_len,             \(\backslash\)}
02888 \textcolor{preprocessor}{                            (cache\_ptr)->pel\_size,            \(\backslash\)}
02889 \textcolor{preprocessor}{                            (entry\_ptr)->size,                \(\backslash\)}
02890 \textcolor{preprocessor}{                    (new\_size));                      \(\backslash\)}
02891 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02892 \textcolor{preprocessor}{    \} else \{                                                              \(\backslash\)}
02893 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02894 \textcolor{preprocessor}{        }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                                  \(\backslash\)}
02895 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02896 \textcolor{preprocessor}{    }\textcolor{comment}{/* Update the size of the LRU list */}\textcolor{preprocessor}{                             \(\backslash\)}
02897 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02898 \textcolor{preprocessor}{    H5C\_\_DLL\_UPDATE\_FOR\_SIZE\_CHANGE((cache\_ptr)->LRU\_list\_len,        \(\backslash\)}
02899 \textcolor{preprocessor}{                            (cache\_ptr)->LRU\_list\_size,       \(\backslash\)}
02900 \textcolor{preprocessor}{                            (entry\_ptr)->size,                \(\backslash\)}
02901 \textcolor{preprocessor}{                    (new\_size));                      \(\backslash\)}
02902 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02903 \textcolor{preprocessor}{        }\textcolor{comment}{/* End modified LRU specific code. */}\textcolor{preprocessor}{                             \(\backslash\)}
02904 \textcolor{preprocessor}{    \}                                                                     \(\backslash\)}
02905 \textcolor{preprocessor}{                                                                          \(\backslash\)}
02906 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_UPDATE\_RP\_FOR\_SIZE\_CHANGE */}\textcolor{preprocessor}{}
02907 
02908 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
02909 
02910 
02911 \textcolor{comment}{/*-------------------------------------------------------------------------}
02912 \textcolor{comment}{ *}
02913 \textcolor{comment}{ * Macro:   H5C\_\_UPDATE\_RP\_FOR\_UNPIN}
02914 \textcolor{comment}{ *}
02915 \textcolor{comment}{ * Purpose:     Update the replacement policy data structures for an}
02916 \textcolor{comment}{ *      unpin of the specified cache entry.}
02917 \textcolor{comment}{ *}
02918 \textcolor{comment}{ *      To do this, unlink the specified entry from the protected}
02919 \textcolor{comment}{ *      entry list, and re-insert it in the data structures used}
02920 \textcolor{comment}{ *      by the current replacement policy.}
02921 \textcolor{comment}{ *}
02922 \textcolor{comment}{ *      At present, we only support the modified LRU policy, so}
02923 \textcolor{comment}{ *      this function deals with that case unconditionally.  If}
02924 \textcolor{comment}{ *      we ever support other replacement policies, the macro}
02925 \textcolor{comment}{ *      should switch on the current policy and act accordingly.}
02926 \textcolor{comment}{ *}
02927 \textcolor{comment}{ * Return:      N/A}
02928 \textcolor{comment}{ *}
02929 \textcolor{comment}{ * Programmer:  John Mainzer, 3/22/06}
02930 \textcolor{comment}{ *}
02931 \textcolor{comment}{ * Modifications:}
02932 \textcolor{comment}{ *}
02933 \textcolor{comment}{ *      JRM -- 3/28/07}
02934 \textcolor{comment}{ *      Added sanity checks based on the new is\_read\_only and}
02935 \textcolor{comment}{ *      ro\_ref\_count fields of struct H5C\_cache\_entry\_t.}
02936 \textcolor{comment}{ *}
02937 \textcolor{comment}{ *-------------------------------------------------------------------------}
02938 \textcolor{comment}{ */}
02939 
02940 \textcolor{preprocessor}{#if H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS}
02941 
02942 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_RP\_FOR\_UNPIN(cache\_ptr, entry\_ptr, fail\_val)       \(\backslash\)}
02943 \textcolor{preprocessor}{\{                                                                      \(\backslash\)}
02944 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                           \(\backslash\)}
02945 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                \(\backslash\)}
02946 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                           \(\backslash\)}
02947 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_protected) );                          \(\backslash\)}
02948 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                          \(\backslash\)}
02949 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                      \(\backslash\)}
02950 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->is\_pinned);                                 \(\backslash\)}
02951 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                 \(\backslash\)}
02952 \textcolor{preprocessor}{                                                                       \(\backslash\)}
02953 \textcolor{preprocessor}{    }\textcolor{comment}{/* Regardless of the replacement policy, remove the entry from the \(\backslash\)}
02954 \textcolor{comment}{     * pinned entry list.                                              \(\backslash\)}
02955 \textcolor{comment}{     */}\textcolor{preprocessor}{                                                                \(\backslash\)}
02956 \textcolor{preprocessor}{    H5C\_\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->pel\_head\_ptr,            \(\backslash\)}
02957 \textcolor{preprocessor}{                    (cache\_ptr)->pel\_tail\_ptr, (cache\_ptr)->pel\_len,   \(\backslash\)}
02958 \textcolor{preprocessor}{                    (cache\_ptr)->pel\_size, (fail\_val))                 \(\backslash\)}
02959 \textcolor{preprocessor}{                                                                       \(\backslash\)}
02960 \textcolor{preprocessor}{    }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                                   \(\backslash\)}
02961 \textcolor{preprocessor}{                                                                       \(\backslash\)}
02962 \textcolor{preprocessor}{    }\textcolor{comment}{/* insert the entry at the head of the LRU list. */}\textcolor{preprocessor}{                \(\backslash\)}
02963 \textcolor{preprocessor}{                                                                       \(\backslash\)}
02964 \textcolor{preprocessor}{    H5C\_\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,           \(\backslash\)}
02965 \textcolor{preprocessor}{                     (cache\_ptr)->LRU\_tail\_ptr,                        \(\backslash\)}
02966 \textcolor{preprocessor}{                     (cache\_ptr)->LRU\_list\_len,                        \(\backslash\)}
02967 \textcolor{preprocessor}{                     (cache\_ptr)->LRU\_list\_size, (fail\_val))           \(\backslash\)}
02968 \textcolor{preprocessor}{                                                                       \(\backslash\)}
02969 \textcolor{preprocessor}{    }\textcolor{comment}{/* Similarly, insert the entry at the head of either the clean     \(\backslash\)}
02970 \textcolor{comment}{     * or dirty LRU list as appropriate.                               \(\backslash\)}
02971 \textcolor{comment}{     */}\textcolor{preprocessor}{                                                                \(\backslash\)}
02972 \textcolor{preprocessor}{                                                                       \(\backslash\)}
02973 \textcolor{preprocessor}{    if ( (entry\_ptr)->is\_dirty ) \{                                     \(\backslash\)}
02974 \textcolor{preprocessor}{                                                                       \(\backslash\)}
02975 \textcolor{preprocessor}{        H5C\_\_AUX\_DLL\_PREPEND((entry\_ptr),                              \(\backslash\)}
02976 \textcolor{preprocessor}{                              (cache\_ptr)->dLRU\_head\_ptr,              \(\backslash\)}
02977 \textcolor{preprocessor}{                              (cache\_ptr)->dLRU\_tail\_ptr,              \(\backslash\)}
02978 \textcolor{preprocessor}{                              (cache\_ptr)->dLRU\_list\_len,              \(\backslash\)}
02979 \textcolor{preprocessor}{                              (cache\_ptr)->dLRU\_list\_size,             \(\backslash\)}
02980 \textcolor{preprocessor}{                              (fail\_val))                              \(\backslash\)}
02981 \textcolor{preprocessor}{                                                                       \(\backslash\)}
02982 \textcolor{preprocessor}{    \} else \{                                                           \(\backslash\)}
02983 \textcolor{preprocessor}{                                                                       \(\backslash\)}
02984 \textcolor{preprocessor}{        H5C\_\_AUX\_DLL\_PREPEND((entry\_ptr),                              \(\backslash\)}
02985 \textcolor{preprocessor}{                              (cache\_ptr)->cLRU\_head\_ptr,              \(\backslash\)}
02986 \textcolor{preprocessor}{                              (cache\_ptr)->cLRU\_tail\_ptr,              \(\backslash\)}
02987 \textcolor{preprocessor}{                              (cache\_ptr)->cLRU\_list\_len,              \(\backslash\)}
02988 \textcolor{preprocessor}{                              (cache\_ptr)->cLRU\_list\_size,             \(\backslash\)}
02989 \textcolor{preprocessor}{                              (fail\_val))                              \(\backslash\)}
02990 \textcolor{preprocessor}{     \}                                                                 \(\backslash\)}
02991 \textcolor{preprocessor}{                                                                       \(\backslash\)}
02992 \textcolor{preprocessor}{    }\textcolor{comment}{/* End modified LRU specific code. */}\textcolor{preprocessor}{                              \(\backslash\)}
02993 \textcolor{preprocessor}{                                                                       \(\backslash\)}
02994 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_UPDATE\_RP\_FOR\_UNPIN */}\textcolor{preprocessor}{}
02995 
02996 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
02997 
02998 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_RP\_FOR\_UNPIN(cache\_ptr, entry\_ptr, fail\_val)       \(\backslash\)}
02999 \textcolor{preprocessor}{\{                                                                      \(\backslash\)}
03000 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                           \(\backslash\)}
03001 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                \(\backslash\)}
03002 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                           \(\backslash\)}
03003 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_protected) );                          \(\backslash\)}
03004 \textcolor{preprocessor}{    HDassert( !((entry\_ptr)->is\_read\_only) );                          \(\backslash\)}
03005 \textcolor{preprocessor}{    HDassert( ((entry\_ptr)->ro\_ref\_count) == 0 );                      \(\backslash\)}
03006 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->is\_pinned);                                 \(\backslash\)}
03007 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                 \(\backslash\)}
03008 \textcolor{preprocessor}{                                                                       \(\backslash\)}
03009 \textcolor{preprocessor}{    }\textcolor{comment}{/* Regardless of the replacement policy, remove the entry from the \(\backslash\)}
03010 \textcolor{comment}{     * pinned entry list.                                              \(\backslash\)}
03011 \textcolor{comment}{     */}\textcolor{preprocessor}{                                                                \(\backslash\)}
03012 \textcolor{preprocessor}{    H5C\_\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->pel\_head\_ptr,            \(\backslash\)}
03013 \textcolor{preprocessor}{                    (cache\_ptr)->pel\_tail\_ptr, (cache\_ptr)->pel\_len,   \(\backslash\)}
03014 \textcolor{preprocessor}{                    (cache\_ptr)->pel\_size, (fail\_val))                 \(\backslash\)}
03015 \textcolor{preprocessor}{                                                                       \(\backslash\)}
03016 \textcolor{preprocessor}{        }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                               \(\backslash\)}
03017 \textcolor{preprocessor}{                                                                       \(\backslash\)}
03018 \textcolor{preprocessor}{        }\textcolor{comment}{/* insert the entry at the head of the LRU list. */}\textcolor{preprocessor}{            \(\backslash\)}
03019 \textcolor{preprocessor}{                                                                       \(\backslash\)}
03020 \textcolor{preprocessor}{        H5C\_\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,       \(\backslash\)}
03021 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_tail\_ptr,                    \(\backslash\)}
03022 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_list\_len,                    \(\backslash\)}
03023 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_list\_size, (fail\_val))       \(\backslash\)}
03024 \textcolor{preprocessor}{                                                                       \(\backslash\)}
03025 \textcolor{preprocessor}{        }\textcolor{comment}{/* End modified LRU specific code. */}\textcolor{preprocessor}{                          \(\backslash\)}
03026 \textcolor{preprocessor}{                                                                       \(\backslash\)}
03027 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_UPDATE\_RP\_FOR\_UNPIN */}\textcolor{preprocessor}{}
03028 
03029 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
03030 
03031 
03032 \textcolor{comment}{/*-------------------------------------------------------------------------}
03033 \textcolor{comment}{ *}
03034 \textcolor{comment}{ * Macro:   H5C\_\_UPDATE\_RP\_FOR\_UNPROTECT}
03035 \textcolor{comment}{ *}
03036 \textcolor{comment}{ * Purpose:     Update the replacement policy data structures for an}
03037 \textcolor{comment}{ *      unprotect of the specified cache entry.}
03038 \textcolor{comment}{ *}
03039 \textcolor{comment}{ *      To do this, unlink the specified entry from the protected}
03040 \textcolor{comment}{ *      list, and re-insert it in the data structures used by the}
03041 \textcolor{comment}{ *      current replacement policy.}
03042 \textcolor{comment}{ *}
03043 \textcolor{comment}{ *      At present, we only support the modified LRU policy, so}
03044 \textcolor{comment}{ *      this function deals with that case unconditionally.  If}
03045 \textcolor{comment}{ *      we ever support other replacement policies, the function}
03046 \textcolor{comment}{ *      should switch on the current policy and act accordingly.}
03047 \textcolor{comment}{ *}
03048 \textcolor{comment}{ * Return:      N/A}
03049 \textcolor{comment}{ *}
03050 \textcolor{comment}{ * Programmer:  John Mainzer, 5/19/04}
03051 \textcolor{comment}{ *}
03052 \textcolor{comment}{ * Modifications:}
03053 \textcolor{comment}{ *}
03054 \textcolor{comment}{ *      JRM - 7/27/04}
03055 \textcolor{comment}{ *      Converted the function H5C\_update\_rp\_for\_unprotect() to}
03056 \textcolor{comment}{ *      the macro H5C\_\_UPDATE\_RP\_FOR\_UNPROTECT in an effort to}
03057 \textcolor{comment}{ *      squeeze a bit more performance out of the cache.}
03058 \textcolor{comment}{ *}
03059 \textcolor{comment}{ *      At least for the first cut, I am leaving the comments and}
03060 \textcolor{comment}{ *      white space in the macro.  If they cause dificulties with}
03061 \textcolor{comment}{ *      pre-processor, I'll have to remove them.}
03062 \textcolor{comment}{ *}
03063 \textcolor{comment}{ *      JRM - 7/28/04}
03064 \textcolor{comment}{ *      Split macro into two version, one supporting the clean and}
03065 \textcolor{comment}{ *      dirty LRU lists, and the other not.  Yet another attempt}
03066 \textcolor{comment}{ *      at optimization.}
03067 \textcolor{comment}{ *}
03068 \textcolor{comment}{ *      JRM - 3/17/06}
03069 \textcolor{comment}{ *      Modified macro to put pinned entries on the pinned entry}
03070 \textcolor{comment}{ *      list instead of inserting them in the data structures}
03071 \textcolor{comment}{ *      maintained by the replacement policy.}
03072 \textcolor{comment}{ *}
03073 \textcolor{comment}{ *-------------------------------------------------------------------------}
03074 \textcolor{comment}{ */}
03075 
03076 \textcolor{preprocessor}{#if H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS}
03077 
03078 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_RP\_FOR\_UNPROTECT(cache\_ptr, entry\_ptr, fail\_val)       \(\backslash\)}
03079 \textcolor{preprocessor}{\{                                                                          \(\backslash\)}
03080 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                               \(\backslash\)}
03081 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                    \(\backslash\)}
03082 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                               \(\backslash\)}
03083 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->is\_protected);                                  \(\backslash\)}
03084 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                     \(\backslash\)}
03085 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03086 \textcolor{preprocessor}{    }\textcolor{comment}{/* Regardless of the replacement policy, remove the entry from the     \(\backslash\)}
03087 \textcolor{comment}{     * protected list.                                                     \(\backslash\)}
03088 \textcolor{comment}{     */}\textcolor{preprocessor}{                                                                    \(\backslash\)}
03089 \textcolor{preprocessor}{    H5C\_\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->pl\_head\_ptr,                 \(\backslash\)}
03090 \textcolor{preprocessor}{                    (cache\_ptr)->pl\_tail\_ptr, (cache\_ptr)->pl\_len,         \(\backslash\)}
03091 \textcolor{preprocessor}{                    (cache\_ptr)->pl\_size, (fail\_val))                      \(\backslash\)}
03092 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03093 \textcolor{preprocessor}{    if ( (entry\_ptr)->is\_pinned ) \{                                        \(\backslash\)}
03094 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03095 \textcolor{preprocessor}{        H5C\_\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->pel\_head\_ptr,           \(\backslash\)}
03096 \textcolor{preprocessor}{                         (cache\_ptr)->pel\_tail\_ptr,                        \(\backslash\)}
03097 \textcolor{preprocessor}{                         (cache\_ptr)->pel\_len,                             \(\backslash\)}
03098 \textcolor{preprocessor}{                         (cache\_ptr)->pel\_size, (fail\_val))                \(\backslash\)}
03099 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03100 \textcolor{preprocessor}{    \} else \{                                                               \(\backslash\)}
03101 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03102 \textcolor{preprocessor}{        }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                                   \(\backslash\)}
03103 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03104 \textcolor{preprocessor}{        }\textcolor{comment}{/* insert the entry at the head of the LRU list. */}\textcolor{preprocessor}{                \(\backslash\)}
03105 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03106 \textcolor{preprocessor}{        H5C\_\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,           \(\backslash\)}
03107 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_tail\_ptr,                        \(\backslash\)}
03108 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_list\_len,                        \(\backslash\)}
03109 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_list\_size, (fail\_val))           \(\backslash\)}
03110 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03111 \textcolor{preprocessor}{        }\textcolor{comment}{/* Similarly, insert the entry at the head of either the clean or  \(\backslash\)}
03112 \textcolor{comment}{         * dirty LRU list as appropriate.                                  \(\backslash\)}
03113 \textcolor{comment}{         */}\textcolor{preprocessor}{                                                                \(\backslash\)}
03114 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03115 \textcolor{preprocessor}{        if ( (entry\_ptr)->is\_dirty ) \{                                     \(\backslash\)}
03116 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03117 \textcolor{preprocessor}{            H5C\_\_AUX\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->dLRU\_head\_ptr,  \(\backslash\)}
03118 \textcolor{preprocessor}{                                 (cache\_ptr)->dLRU\_tail\_ptr,               \(\backslash\)}
03119 \textcolor{preprocessor}{                                 (cache\_ptr)->dLRU\_list\_len,               \(\backslash\)}
03120 \textcolor{preprocessor}{                                 (cache\_ptr)->dLRU\_list\_size, (fail\_val))  \(\backslash\)}
03121 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03122 \textcolor{preprocessor}{        \} else \{                                                           \(\backslash\)}
03123 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03124 \textcolor{preprocessor}{            H5C\_\_AUX\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->cLRU\_head\_ptr,  \(\backslash\)}
03125 \textcolor{preprocessor}{                                 (cache\_ptr)->cLRU\_tail\_ptr,               \(\backslash\)}
03126 \textcolor{preprocessor}{                                 (cache\_ptr)->cLRU\_list\_len,               \(\backslash\)}
03127 \textcolor{preprocessor}{                                 (cache\_ptr)->cLRU\_list\_size, (fail\_val))  \(\backslash\)}
03128 \textcolor{preprocessor}{        \}                                                                  \(\backslash\)}
03129 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03130 \textcolor{preprocessor}{        }\textcolor{comment}{/* End modified LRU specific code. */}\textcolor{preprocessor}{                              \(\backslash\)}
03131 \textcolor{preprocessor}{    \}                                                                      \(\backslash\)}
03132 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03133 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_UPDATE\_RP\_FOR\_UNPROTECT */}\textcolor{preprocessor}{}
03134 
03135 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
03136 
03137 \textcolor{preprocessor}{#define H5C\_\_UPDATE\_RP\_FOR\_UNPROTECT(cache\_ptr, entry\_ptr, fail\_val)       \(\backslash\)}
03138 \textcolor{preprocessor}{\{                                                                          \(\backslash\)}
03139 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                               \(\backslash\)}
03140 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                    \(\backslash\)}
03141 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                               \(\backslash\)}
03142 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->is\_protected);                                  \(\backslash\)}
03143 \textcolor{preprocessor}{    HDassert( (entry\_ptr)->size > 0 );                                     \(\backslash\)}
03144 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03145 \textcolor{preprocessor}{    }\textcolor{comment}{/* Regardless of the replacement policy, remove the entry from the     \(\backslash\)}
03146 \textcolor{comment}{     * protected list.                                                     \(\backslash\)}
03147 \textcolor{comment}{     */}\textcolor{preprocessor}{                                                                    \(\backslash\)}
03148 \textcolor{preprocessor}{    H5C\_\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->pl\_head\_ptr,                 \(\backslash\)}
03149 \textcolor{preprocessor}{                    (cache\_ptr)->pl\_tail\_ptr, (cache\_ptr)->pl\_len,         \(\backslash\)}
03150 \textcolor{preprocessor}{                    (cache\_ptr)->pl\_size, (fail\_val))                      \(\backslash\)}
03151 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03152 \textcolor{preprocessor}{    if ( (entry\_ptr)->is\_pinned ) \{                                        \(\backslash\)}
03153 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03154 \textcolor{preprocessor}{        H5C\_\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->pel\_head\_ptr,           \(\backslash\)}
03155 \textcolor{preprocessor}{                         (cache\_ptr)->pel\_tail\_ptr,                        \(\backslash\)}
03156 \textcolor{preprocessor}{                         (cache\_ptr)->pel\_len,                             \(\backslash\)}
03157 \textcolor{preprocessor}{                         (cache\_ptr)->pel\_size, (fail\_val))                \(\backslash\)}
03158 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03159 \textcolor{preprocessor}{    \} else \{                                                               \(\backslash\)}
03160 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03161 \textcolor{preprocessor}{        }\textcolor{comment}{/* modified LRU specific code */}\textcolor{preprocessor}{                                   \(\backslash\)}
03162 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03163 \textcolor{preprocessor}{        }\textcolor{comment}{/* insert the entry at the head of the LRU list. */}\textcolor{preprocessor}{                \(\backslash\)}
03164 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03165 \textcolor{preprocessor}{        H5C\_\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->LRU\_head\_ptr,           \(\backslash\)}
03166 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_tail\_ptr,                        \(\backslash\)}
03167 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_list\_len,                        \(\backslash\)}
03168 \textcolor{preprocessor}{                         (cache\_ptr)->LRU\_list\_size, (fail\_val))           \(\backslash\)}
03169 \textcolor{preprocessor}{                                                                           \(\backslash\)}
03170 \textcolor{preprocessor}{        }\textcolor{comment}{/* End modified LRU specific code. */}\textcolor{preprocessor}{                              \(\backslash\)}
03171 \textcolor{preprocessor}{    \}                                                                      \(\backslash\)}
03172 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_UPDATE\_RP\_FOR\_UNPROTECT */}\textcolor{preprocessor}{}
03173 
03174 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_MAINTAIN\_CLEAN\_AND\_DIRTY\_LRU\_LISTS */}\textcolor{preprocessor}{}
03175 
03176 \textcolor{preprocessor}{#ifdef H5\_HAVE\_PARALLEL}
03177 
03178 \textcolor{preprocessor}{#if H5C\_DO\_SANITY\_CHECKS}
03179 
03180 \textcolor{preprocessor}{#define H5C\_\_COLL\_DLL\_PRE\_REMOVE\_SC(entry\_ptr, hd\_ptr, tail\_ptr, len, Size, fv) \(\backslash\)}
03181 \textcolor{preprocessor}{if ( ( (hd\_ptr) == NULL ) ||                                                   \(\backslash\)}
03182 \textcolor{preprocessor}{     ( (tail\_ptr) == NULL ) ||                                                 \(\backslash\)}
03183 \textcolor{preprocessor}{     ( (entry\_ptr) == NULL ) ||                                                \(\backslash\)}
03184 \textcolor{preprocessor}{     ( (len) <= 0 ) ||                                                         \(\backslash\)}
03185 \textcolor{preprocessor}{     ( (Size) < (entry\_ptr)->size ) ||                                         \(\backslash\)}
03186 \textcolor{preprocessor}{     ( ( (Size) == (entry\_ptr)->size ) && ( ! ( (len) == 1 ) ) ) ||            \(\backslash\)}
03187 \textcolor{preprocessor}{     ( ( (entry\_ptr)->coll\_prev == NULL ) && ( (hd\_ptr) != (entry\_ptr) ) ) ||  \(\backslash\)}
03188 \textcolor{preprocessor}{     ( ( (entry\_ptr)->coll\_next == NULL ) && ( (tail\_ptr) != (entry\_ptr) ) ) || \(\backslash\)}
03189 \textcolor{preprocessor}{     ( ( (len) == 1 ) &&                                                       \(\backslash\)}
03190 \textcolor{preprocessor}{       ( ! ( ( (hd\_ptr) == (entry\_ptr) ) && ( (tail\_ptr) == (entry\_ptr) ) &&   \(\backslash\)}
03191 \textcolor{preprocessor}{             ( (entry\_ptr)->coll\_next == NULL ) &&                             \(\backslash\)}
03192 \textcolor{preprocessor}{             ( (entry\_ptr)->coll\_prev == NULL ) &&                             \(\backslash\)}
03193 \textcolor{preprocessor}{             ( (Size) == (entry\_ptr)->size )                                   \(\backslash\)}
03194 \textcolor{preprocessor}{           )                                                                   \(\backslash\)}
03195 \textcolor{preprocessor}{       )                                                                       \(\backslash\)}
03196 \textcolor{preprocessor}{     )                                                                         \(\backslash\)}
03197 \textcolor{preprocessor}{   ) \{                                                                         \(\backslash\)}
03198 \textcolor{preprocessor}{    HDassert(0 && "coll DLL pre remove SC failed");                            \(\backslash\)}
03199 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, (fv), "coll DLL pre remove SC failed")  \(\backslash\)}
03200 \textcolor{preprocessor}{\}}
03201 
03202 \textcolor{preprocessor}{#define H5C\_\_COLL\_DLL\_SC(head\_ptr, tail\_ptr, len, Size, fv)                 \(\backslash\)}
03203 \textcolor{preprocessor}{if ( ( ( ( (head\_ptr) == NULL ) || ( (tail\_ptr) == NULL ) ) &&              \(\backslash\)}
03204 \textcolor{preprocessor}{       ( (head\_ptr) != (tail\_ptr) )                                         \(\backslash\)}
03205 \textcolor{preprocessor}{     ) ||                                                                   \(\backslash\)}
03206 \textcolor{preprocessor}{     ( (len) < 0 ) ||                                                       \(\backslash\)}
03207 \textcolor{preprocessor}{     ( (Size) < 0 ) ||                                                      \(\backslash\)}
03208 \textcolor{preprocessor}{     ( ( (len) == 1 ) &&                                                    \(\backslash\)}
03209 \textcolor{preprocessor}{       ( ( (head\_ptr) != (tail\_ptr) ) || ( (Size) <= 0 ) ||                 \(\backslash\)}
03210 \textcolor{preprocessor}{         ( (head\_ptr) == NULL ) || ( (head\_ptr)->size != (Size) )           \(\backslash\)}
03211 \textcolor{preprocessor}{       )                                                                    \(\backslash\)}
03212 \textcolor{preprocessor}{     ) ||                                                                   \(\backslash\)}
03213 \textcolor{preprocessor}{     ( ( (len) >= 1 ) &&                                                    \(\backslash\)}
03214 \textcolor{preprocessor}{       ( ( (head\_ptr) == NULL ) || ( (head\_ptr)->coll\_prev != NULL ) ||     \(\backslash\)}
03215 \textcolor{preprocessor}{         ( (tail\_ptr) == NULL ) || ( (tail\_ptr)->coll\_next != NULL )        \(\backslash\)}
03216 \textcolor{preprocessor}{       )                                                                    \(\backslash\)}
03217 \textcolor{preprocessor}{     )                                                                      \(\backslash\)}
03218 \textcolor{preprocessor}{   ) \{                                                                      \(\backslash\)}
03219 \textcolor{preprocessor}{    HDassert(0 && "COLL DLL sanity check failed");                          \(\backslash\)}
03220 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, (fv), "COLL DLL sanity check failed") \(\backslash\)}
03221 \textcolor{preprocessor}{\}}
03222 
03223 \textcolor{preprocessor}{#define H5C\_\_COLL\_DLL\_PRE\_INSERT\_SC(entry\_ptr, hd\_ptr, tail\_ptr, len, Size, fv) \(\backslash\)}
03224 \textcolor{preprocessor}{if ( ( (entry\_ptr) == NULL ) ||                                                \(\backslash\)}
03225 \textcolor{preprocessor}{     ( (entry\_ptr)->coll\_next != NULL ) ||                                     \(\backslash\)}
03226 \textcolor{preprocessor}{     ( (entry\_ptr)->coll\_prev != NULL ) ||                                     \(\backslash\)}
03227 \textcolor{preprocessor}{     ( ( ( (hd\_ptr) == NULL ) || ( (tail\_ptr) == NULL ) ) &&                   \(\backslash\)}
03228 \textcolor{preprocessor}{       ( (hd\_ptr) != (tail\_ptr) )                                              \(\backslash\)}
03229 \textcolor{preprocessor}{     ) ||                                                                      \(\backslash\)}
03230 \textcolor{preprocessor}{     ( ( (len) == 1 ) &&                                                       \(\backslash\)}
03231 \textcolor{preprocessor}{       ( ( (hd\_ptr) != (tail\_ptr) ) || ( (Size) <= 0 ) ||                      \(\backslash\)}
03232 \textcolor{preprocessor}{         ( (hd\_ptr) == NULL ) || ( (hd\_ptr)->size != (Size) )                  \(\backslash\)}
03233 \textcolor{preprocessor}{       )                                                                       \(\backslash\)}
03234 \textcolor{preprocessor}{     ) ||                                                                      \(\backslash\)}
03235 \textcolor{preprocessor}{     ( ( (len) >= 1 ) &&                                                       \(\backslash\)}
03236 \textcolor{preprocessor}{       ( ( (hd\_ptr) == NULL ) || ( (hd\_ptr)->coll\_prev != NULL ) ||            \(\backslash\)}
03237 \textcolor{preprocessor}{         ( (tail\_ptr) == NULL ) || ( (tail\_ptr)->coll\_next != NULL )           \(\backslash\)}
03238 \textcolor{preprocessor}{       )                                                                       \(\backslash\)}
03239 \textcolor{preprocessor}{     )                                                                         \(\backslash\)}
03240 \textcolor{preprocessor}{   ) \{                                                                         \(\backslash\)}
03241 \textcolor{preprocessor}{    HDassert(0 && "COLL DLL pre insert SC failed");                            \(\backslash\)}
03242 \textcolor{preprocessor}{    HGOTO\_ERROR(H5E\_CACHE, H5E\_SYSTEM, (fv), "COLL DLL pre insert SC failed")  \(\backslash\)}
03243 \textcolor{preprocessor}{\}}
03244 
03245 \textcolor{preprocessor}{#else }\textcolor{comment}{/* H5C\_DO\_SANITY\_CHECKS */}\textcolor{preprocessor}{}
03246 
03247 \textcolor{preprocessor}{#define H5C\_\_COLL\_DLL\_PRE\_REMOVE\_SC(entry\_ptr, hd\_ptr, tail\_ptr, len, Size, fv)}
03248 \textcolor{preprocessor}{#define H5C\_\_COLL\_DLL\_SC(head\_ptr, tail\_ptr, len, Size, fv)}
03249 \textcolor{preprocessor}{#define H5C\_\_COLL\_DLL\_PRE\_INSERT\_SC(entry\_ptr, hd\_ptr, tail\_ptr, len, Size, fv)}
03250 
03251 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_DO\_SANITY\_CHECKS */}\textcolor{preprocessor}{}
03252 
03253 
03254 \textcolor{preprocessor}{#define H5C\_\_COLL\_DLL\_APPEND(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fail\_val) \(\backslash\)}
03255 \textcolor{preprocessor}{\{                                                                            \(\backslash\)}
03256 \textcolor{preprocessor}{    H5C\_\_COLL\_DLL\_PRE\_INSERT\_SC(entry\_ptr, head\_ptr, tail\_ptr, len, Size,    \(\backslash\)}
03257 \textcolor{preprocessor}{                               fail\_val)                                     \(\backslash\)}
03258 \textcolor{preprocessor}{    if ( (head\_ptr) == NULL )                                                \(\backslash\)}
03259 \textcolor{preprocessor}{    \{                                                                        \(\backslash\)}
03260 \textcolor{preprocessor}{       (head\_ptr) = (entry\_ptr);                                             \(\backslash\)}
03261 \textcolor{preprocessor}{       (tail\_ptr) = (entry\_ptr);                                             \(\backslash\)}
03262 \textcolor{preprocessor}{    \}                                                                        \(\backslash\)}
03263 \textcolor{preprocessor}{    else                                                                     \(\backslash\)}
03264 \textcolor{preprocessor}{    \{                                                                        \(\backslash\)}
03265 \textcolor{preprocessor}{       (tail\_ptr)->coll\_next = (entry\_ptr);                                  \(\backslash\)}
03266 \textcolor{preprocessor}{       (entry\_ptr)->coll\_prev = (tail\_ptr);                                  \(\backslash\)}
03267 \textcolor{preprocessor}{       (tail\_ptr) = (entry\_ptr);                                             \(\backslash\)}
03268 \textcolor{preprocessor}{    \}                                                                        \(\backslash\)}
03269 \textcolor{preprocessor}{    (len)++;                                                                 \(\backslash\)}
03270 \textcolor{preprocessor}{    (Size) += entry\_ptr->size;                                               \(\backslash\)}
03271 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_COLL\_DLL\_APPEND() */}\textcolor{preprocessor}{}
03272 
03273 \textcolor{preprocessor}{#define H5C\_\_COLL\_DLL\_PREPEND(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fv)  \(\backslash\)}
03274 \textcolor{preprocessor}{\{                                                                            \(\backslash\)}
03275 \textcolor{preprocessor}{    H5C\_\_COLL\_DLL\_PRE\_INSERT\_SC(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fv)\(\backslash\)}
03276 \textcolor{preprocessor}{    if ( (head\_ptr) == NULL )                                                \(\backslash\)}
03277 \textcolor{preprocessor}{    \{                                                                        \(\backslash\)}
03278 \textcolor{preprocessor}{       (head\_ptr) = (entry\_ptr);                                             \(\backslash\)}
03279 \textcolor{preprocessor}{       (tail\_ptr) = (entry\_ptr);                                             \(\backslash\)}
03280 \textcolor{preprocessor}{    \}                                                                        \(\backslash\)}
03281 \textcolor{preprocessor}{    else                                                                     \(\backslash\)}
03282 \textcolor{preprocessor}{    \{                                                                        \(\backslash\)}
03283 \textcolor{preprocessor}{       (head\_ptr)->coll\_prev = (entry\_ptr);                                  \(\backslash\)}
03284 \textcolor{preprocessor}{       (entry\_ptr)->coll\_next = (head\_ptr);                                  \(\backslash\)}
03285 \textcolor{preprocessor}{       (head\_ptr) = (entry\_ptr);                                             \(\backslash\)}
03286 \textcolor{preprocessor}{    \}                                                                        \(\backslash\)}
03287 \textcolor{preprocessor}{    (len)++;                                                                 \(\backslash\)}
03288 \textcolor{preprocessor}{    (Size) += entry\_ptr->size;                                               \(\backslash\)}
03289 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_COLL\_DLL\_PREPEND() */}\textcolor{preprocessor}{}
03290 
03291 \textcolor{preprocessor}{#define H5C\_\_COLL\_DLL\_REMOVE(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fv)   \(\backslash\)}
03292 \textcolor{preprocessor}{\{                                                                            \(\backslash\)}
03293 \textcolor{preprocessor}{    H5C\_\_COLL\_DLL\_PRE\_REMOVE\_SC(entry\_ptr, head\_ptr, tail\_ptr, len, Size, fv)\(\backslash\)}
03294 \textcolor{preprocessor}{    \{                                                                        \(\backslash\)}
03295 \textcolor{preprocessor}{       if ( (head\_ptr) == (entry\_ptr) )                                      \(\backslash\)}
03296 \textcolor{preprocessor}{       \{                                                                     \(\backslash\)}
03297 \textcolor{preprocessor}{          (head\_ptr) = (entry\_ptr)->coll\_next;                               \(\backslash\)}
03298 \textcolor{preprocessor}{          if ( (head\_ptr) != NULL )                                          \(\backslash\)}
03299 \textcolor{preprocessor}{             (head\_ptr)->coll\_prev = NULL;                                   \(\backslash\)}
03300 \textcolor{preprocessor}{       \}                                                                     \(\backslash\)}
03301 \textcolor{preprocessor}{       else                                                                  \(\backslash\)}
03302 \textcolor{preprocessor}{       \{                                                                     \(\backslash\)}
03303 \textcolor{preprocessor}{          (entry\_ptr)->coll\_prev->coll\_next = (entry\_ptr)->coll\_next;        \(\backslash\)}
03304 \textcolor{preprocessor}{       \}                                                                     \(\backslash\)}
03305 \textcolor{preprocessor}{       if ( (tail\_ptr) == (entry\_ptr) )                                      \(\backslash\)}
03306 \textcolor{preprocessor}{       \{                                                                     \(\backslash\)}
03307 \textcolor{preprocessor}{          (tail\_ptr) = (entry\_ptr)->coll\_prev;                               \(\backslash\)}
03308 \textcolor{preprocessor}{          if ( (tail\_ptr) != NULL )                                          \(\backslash\)}
03309 \textcolor{preprocessor}{             (tail\_ptr)->coll\_next = NULL;                                   \(\backslash\)}
03310 \textcolor{preprocessor}{       \}                                                                     \(\backslash\)}
03311 \textcolor{preprocessor}{       else                                                                  \(\backslash\)}
03312 \textcolor{preprocessor}{          (entry\_ptr)->coll\_next->coll\_prev = (entry\_ptr)->coll\_prev;        \(\backslash\)}
03313 \textcolor{preprocessor}{       entry\_ptr->coll\_next = NULL;                                          \(\backslash\)}
03314 \textcolor{preprocessor}{       entry\_ptr->coll\_prev = NULL;                                          \(\backslash\)}
03315 \textcolor{preprocessor}{       (len)--;                                                              \(\backslash\)}
03316 \textcolor{preprocessor}{       (Size) -= entry\_ptr->size;                                            \(\backslash\)}
03317 \textcolor{preprocessor}{    \}                                                                        \(\backslash\)}
03318 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_COLL\_DLL\_REMOVE() */}\textcolor{preprocessor}{}
03319 
03320 
03321 \textcolor{comment}{/*-------------------------------------------------------------------------}
03322 \textcolor{comment}{ *}
03323 \textcolor{comment}{ * Macro:   H5C\_\_INSERT\_IN\_COLL\_LIST}
03324 \textcolor{comment}{ *}
03325 \textcolor{comment}{ * Purpose:     Insert entry into collective entries list}
03326 \textcolor{comment}{ *}
03327 \textcolor{comment}{ * Return:      N/A}
03328 \textcolor{comment}{ *}
03329 \textcolor{comment}{ * Programmer:  Mohamad Chaarawi}
03330 \textcolor{comment}{ *}
03331 \textcolor{comment}{ *-------------------------------------------------------------------------}
03332 \textcolor{comment}{ */}
03333 
03334 \textcolor{preprocessor}{#define H5C\_\_INSERT\_IN\_COLL\_LIST(cache\_ptr, entry\_ptr, fail\_val)        \(\backslash\)}
03335 \textcolor{preprocessor}{\{                                                                       \(\backslash\)}
03336 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                            \(\backslash\)}
03337 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                 \(\backslash\)}
03338 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                            \(\backslash\)}
03339 \textcolor{preprocessor}{                                                                        \(\backslash\)}
03340 \textcolor{preprocessor}{    }\textcolor{comment}{/* insert the entry at the head of the list. */}\textcolor{preprocessor}{                     \(\backslash\)}
03341 \textcolor{preprocessor}{                                                                        \(\backslash\)}
03342 \textcolor{preprocessor}{    H5C\_\_COLL\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->coll\_head\_ptr,      \(\backslash\)}
03343 \textcolor{preprocessor}{                          (cache\_ptr)->coll\_tail\_ptr,                   \(\backslash\)}
03344 \textcolor{preprocessor}{                          (cache\_ptr)->coll\_list\_len,                   \(\backslash\)}
03345 \textcolor{preprocessor}{                          (cache\_ptr)->coll\_list\_size,                  \(\backslash\)}
03346 \textcolor{preprocessor}{                          (fail\_val))                                   \(\backslash\)}
03347 \textcolor{preprocessor}{                                                                        \(\backslash\)}
03348 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_INSERT\_IN\_COLL\_LIST */}\textcolor{preprocessor}{}
03349 
03350 
03351 \textcolor{comment}{/*-------------------------------------------------------------------------}
03352 \textcolor{comment}{ *}
03353 \textcolor{comment}{ * Macro:   H5C\_\_REMOVE\_FROM\_COLL\_LIST}
03354 \textcolor{comment}{ *}
03355 \textcolor{comment}{ * Purpose:     Remove entry from collective entries list}
03356 \textcolor{comment}{ *}
03357 \textcolor{comment}{ * Return:      N/A}
03358 \textcolor{comment}{ *}
03359 \textcolor{comment}{ * Programmer:  Mohamad Chaarawi}
03360 \textcolor{comment}{ *}
03361 \textcolor{comment}{ *-------------------------------------------------------------------------}
03362 \textcolor{comment}{ */}
03363 
03364 \textcolor{preprocessor}{#define H5C\_\_REMOVE\_FROM\_COLL\_LIST(cache\_ptr, entry\_ptr, fail\_val)      \(\backslash\)}
03365 \textcolor{preprocessor}{\{                                                                       \(\backslash\)}
03366 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                            \(\backslash\)}
03367 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                 \(\backslash\)}
03368 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                            \(\backslash\)}
03369 \textcolor{preprocessor}{                                                                        \(\backslash\)}
03370 \textcolor{preprocessor}{    }\textcolor{comment}{/* remove the entry from the list. */}\textcolor{preprocessor}{                               \(\backslash\)}
03371 \textcolor{preprocessor}{                                                                        \(\backslash\)}
03372 \textcolor{preprocessor}{    H5C\_\_COLL\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->coll\_head\_ptr,       \(\backslash\)}
03373 \textcolor{preprocessor}{                         (cache\_ptr)->coll\_tail\_ptr,                    \(\backslash\)}
03374 \textcolor{preprocessor}{                         (cache\_ptr)->coll\_list\_len,                    \(\backslash\)}
03375 \textcolor{preprocessor}{                         (cache\_ptr)->coll\_list\_size,                   \(\backslash\)}
03376 \textcolor{preprocessor}{                         (fail\_val))                                    \(\backslash\)}
03377 \textcolor{preprocessor}{                                                                        \(\backslash\)}
03378 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_REMOVE\_FROM\_COLL\_LIST */}\textcolor{preprocessor}{}
03379 
03380 
03381 \textcolor{comment}{/*-------------------------------------------------------------------------}
03382 \textcolor{comment}{ *}
03383 \textcolor{comment}{ * Macro:   H5C\_\_MOVE\_TO\_TOP\_IN\_COLL\_LIST}
03384 \textcolor{comment}{ *}
03385 \textcolor{comment}{ * Purpose:     Update entry position in collective entries list}
03386 \textcolor{comment}{ *}
03387 \textcolor{comment}{ * Return:      N/A}
03388 \textcolor{comment}{ *}
03389 \textcolor{comment}{ * Programmer:  Mohamad Chaarawi}
03390 \textcolor{comment}{ *}
03391 \textcolor{comment}{ *-------------------------------------------------------------------------}
03392 \textcolor{comment}{ */}
03393 
03394 \textcolor{preprocessor}{#define H5C\_\_MOVE\_TO\_TOP\_IN\_COLL\_LIST(cache\_ptr, entry\_ptr, fail\_val)   \(\backslash\)}
03395 \textcolor{preprocessor}{\{                                                                       \(\backslash\)}
03396 \textcolor{preprocessor}{    HDassert( (cache\_ptr) );                                            \(\backslash\)}
03397 \textcolor{preprocessor}{    HDassert( (cache\_ptr)->magic == H5C\_\_H5C\_T\_MAGIC );                 \(\backslash\)}
03398 \textcolor{preprocessor}{    HDassert( (entry\_ptr) );                                            \(\backslash\)}
03399 \textcolor{preprocessor}{                                                                        \(\backslash\)}
03400 \textcolor{preprocessor}{    }\textcolor{comment}{/* Remove entry and insert at the head of the list. */}\textcolor{preprocessor}{              \(\backslash\)}
03401 \textcolor{preprocessor}{    H5C\_\_COLL\_DLL\_REMOVE((entry\_ptr), (cache\_ptr)->coll\_head\_ptr,       \(\backslash\)}
03402 \textcolor{preprocessor}{                         (cache\_ptr)->coll\_tail\_ptr,                    \(\backslash\)}
03403 \textcolor{preprocessor}{                         (cache\_ptr)->coll\_list\_len,                    \(\backslash\)}
03404 \textcolor{preprocessor}{                         (cache\_ptr)->coll\_list\_size,                   \(\backslash\)}
03405 \textcolor{preprocessor}{                         (fail\_val))                                    \(\backslash\)}
03406 \textcolor{preprocessor}{                                                                        \(\backslash\)}
03407 \textcolor{preprocessor}{    H5C\_\_COLL\_DLL\_PREPEND((entry\_ptr), (cache\_ptr)->coll\_head\_ptr,      \(\backslash\)}
03408 \textcolor{preprocessor}{                          (cache\_ptr)->coll\_tail\_ptr,                   \(\backslash\)}
03409 \textcolor{preprocessor}{                          (cache\_ptr)->coll\_list\_len,                   \(\backslash\)}
03410 \textcolor{preprocessor}{                          (cache\_ptr)->coll\_list\_size,                  \(\backslash\)}
03411 \textcolor{preprocessor}{                          (fail\_val))                                   \(\backslash\)}
03412 \textcolor{preprocessor}{                                                                        \(\backslash\)}
03413 \textcolor{preprocessor}{\} }\textcolor{comment}{/* H5C\_\_MOVE\_TO\_TOP\_IN\_COLL\_LIST */}\textcolor{preprocessor}{}
03414 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5\_HAVE\_PARALLEL */}\textcolor{preprocessor}{}
03415 
03416 
03417 \textcolor{comment}{/****************************/}
03418 \textcolor{comment}{/* Package Private Typedefs */}
03419 \textcolor{comment}{/****************************/}
03420 
03421 \textcolor{comment}{/****************************************************************************}
03422 \textcolor{comment}{ *}
03423 \textcolor{comment}{ * structure H5C\_tag\_info\_t}
03424 \textcolor{comment}{ *}
03425 \textcolor{comment}{ * Structure about each set of tagged entries for an object in the file.}
03426 \textcolor{comment}{ *}
03427 \textcolor{comment}{ * Each H5C\_tag\_info\_t struct corresponds to a particular object in the file.}
03428 \textcolor{comment}{ *}
03429 \textcolor{comment}{ * Each H5C\_cache\_entry struct in the linked list of entries for this tag}
03430 \textcolor{comment}{ *      also contains a pointer back to the H5C\_tag\_info\_t struct for the}
03431 \textcolor{comment}{ *      overall object.}
03432 \textcolor{comment}{ *}
03433 \textcolor{comment}{ *}
03434 \textcolor{comment}{ * The fields of this structure are discussed individually below:}
03435 \textcolor{comment}{ *}
03436 \textcolor{comment}{ * tag: Address (i.e. "tag") of the object header for all the entries}
03437 \textcolor{comment}{ *              corresponding to parts of that object.}
03438 \textcolor{comment}{ *}
03439 \textcolor{comment}{ * head: Head of doubly-linked list of all entries belonging to the tag.}
03440 \textcolor{comment}{ *}
03441 \textcolor{comment}{ * entry\_cnt: Number of entries on linked list of entries for this tag.}
03442 \textcolor{comment}{ *}
03443 \textcolor{comment}{ * corked: Boolean flag indicating whether entries for this object can be}
03444 \textcolor{comment}{ *      evicted.}
03445 \textcolor{comment}{ *}
03446 \textcolor{comment}{ ****************************************************************************/}
\Hypertarget{_h_d_f5_21_810_81_2include_2_h5_cpkg_8h_source_l03447}\hyperlink{struct_h5_c__tag__info__t}{03447} \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\hyperlink{struct_h5_c__tag__info__t}{H5C\_tag\_info\_t} \{
03448     haddr\_t tag;                \textcolor{comment}{/* Tag (address) of the entries (must be first, for skiplist) */}
03449     H5C\_cache\_entry\_t *head;    \textcolor{comment}{/* Head of the list of entries for this tag */}
03450     \textcolor{keywordtype}{size\_t} entry\_cnt;           \textcolor{comment}{/* Number of entries on list */}
03451     hbool\_t corked;             \textcolor{comment}{/* Whether this object is corked */}
03452 \} \hyperlink{struct_h5_c__tag__info__t}{H5C\_tag\_info\_t};
03453 
03454 
03455 \textcolor{comment}{/****************************************************************************}
03456 \textcolor{comment}{ *}
03457 \textcolor{comment}{ * structure H5C\_t}
03458 \textcolor{comment}{ *}
03459 \textcolor{comment}{ * Catchall structure for all variables specific to an instance of the cache.}
03460 \textcolor{comment}{ *}
03461 \textcolor{comment}{ * While the individual fields of the structure are discussed below, the}
03462 \textcolor{comment}{ * following overview may be helpful.}
03463 \textcolor{comment}{ *}
03464 \textcolor{comment}{ * Entries in the cache are stored in an instance of H5TB\_TREE, indexed on}
03465 \textcolor{comment}{ * the entry's disk address.  While the H5TB\_TREE is less efficient than}
03466 \textcolor{comment}{ * hash table, it keeps the entries in address sorted order.  As flushes}
03467 \textcolor{comment}{ * in parallel mode are more efficient if they are issued in increasing}
03468 \textcolor{comment}{ * address order, this is a significant benefit.  Also the H5TB\_TREE code}
03469 \textcolor{comment}{ * was readily available, which reduced development time.}
03470 \textcolor{comment}{ *}
03471 \textcolor{comment}{ * While the cache was designed with multiple replacement policies in mind,}
03472 \textcolor{comment}{ * at present only a modified form of LRU is supported.}
03473 \textcolor{comment}{ *}
03474 \textcolor{comment}{ *                                              JRM - 4/26/04}
03475 \textcolor{comment}{ *}
03476 \textcolor{comment}{ * Profiling has indicated that searches in the instance of H5TB\_TREE are}
03477 \textcolor{comment}{ * too expensive.  To deal with this issue, I have augmented the cache}
03478 \textcolor{comment}{ * with a hash table in which all entries will be stored.  Given the}
03479 \textcolor{comment}{ * advantages of flushing entries in increasing address order, the TBBT}
03480 \textcolor{comment}{ * is retained, but only dirty entries are stored in it.  At least for}
03481 \textcolor{comment}{ * now, we will leave entries in the TBBT after they are flushed.}
03482 \textcolor{comment}{ *}
03483 \textcolor{comment}{ * Note that index\_size and index\_len now refer to the total size of}
03484 \textcolor{comment}{ * and number of entries in the hash table.}
03485 \textcolor{comment}{ *}
03486 \textcolor{comment}{ *                      JRM - 7/19/04}
03487 \textcolor{comment}{ *}
03488 \textcolor{comment}{ * The TBBT has since been replaced with a skip list.  This change}
03489 \textcolor{comment}{ * greatly predates this note.}
03490 \textcolor{comment}{ *}
03491 \textcolor{comment}{ *                      JRM - 9/26/05}
03492 \textcolor{comment}{ *}
03493 \textcolor{comment}{ * magic:   Unsigned 32 bit integer always set to H5C\_\_H5C\_T\_MAGIC. }
03494 \textcolor{comment}{ *      This field is used to validate pointers to instances of}
03495 \textcolor{comment}{ *      H5C\_t.}
03496 \textcolor{comment}{ *}
03497 \textcolor{comment}{ * flush\_in\_progress: Boolean flag indicating whether a flush is in}
03498 \textcolor{comment}{ *      progress.}
03499 \textcolor{comment}{ *}
03500 \textcolor{comment}{ * trace\_file\_ptr:  File pointer pointing to the trace file, which is used}
03501 \textcolor{comment}{ *              to record cache operations for use in simulations and design}
03502 \textcolor{comment}{ *              studies.  This field will usually be NULL, indicating that}
03503 \textcolor{comment}{ *              no trace file should be recorded.}
03504 \textcolor{comment}{ *}
03505 \textcolor{comment}{ *              Since much of the code supporting the parallel metadata}
03506 \textcolor{comment}{ *              cache is in H5AC, we don't write the trace file from}
03507 \textcolor{comment}{ *              H5C.  Instead, H5AC reads the trace\_file\_ptr as needed.}
03508 \textcolor{comment}{ *}
03509 \textcolor{comment}{ *              When we get to using H5C in other places, we may add}
03510 \textcolor{comment}{ *              code to write trace file data at the H5C level as well.}
03511 \textcolor{comment}{ *}
03512 \textcolor{comment}{ * logging\_enabled: Boolean flag indicating whether cache logging}
03513 \textcolor{comment}{ *              which is used to record cache operations for use in}
03514 \textcolor{comment}{ *              debugging and performance analysis. When this flag is set}
03515 \textcolor{comment}{ *              to TRUE, it means that the log file is open and ready to}
03516 \textcolor{comment}{ *              receive log entries. It does NOT mean that cache operations}
03517 \textcolor{comment}{ *              are currently being recorded. That is controlled by the}
03518 \textcolor{comment}{ *              currently\_logging flag (below).}
03519 \textcolor{comment}{ *}
03520 \textcolor{comment}{ *              Since much of the code supporting the parallel metadata}
03521 \textcolor{comment}{ *              cache is in H5AC, we don't write the trace file from}
03522 \textcolor{comment}{ *              H5C.  Instead, H5AC reads the trace\_file\_ptr as needed.}
03523 \textcolor{comment}{ *}
03524 \textcolor{comment}{ *              When we get to using H5C in other places, we may add}
03525 \textcolor{comment}{ *              code to write trace file data at the H5C level as well.}
03526 \textcolor{comment}{ *}
03527 \textcolor{comment}{ * currently\_logging: Boolean flag that indicates if cache operations are}
03528 \textcolor{comment}{ *              currently being logged. This flag is flipped by the}
03529 \textcolor{comment}{ *              H5Fstart/stop\_mdc\_logging functions.}
03530 \textcolor{comment}{ *}
03531 \textcolor{comment}{ * log\_file\_ptr:  File pointer pointing to the log file. The I/O functions}
03532 \textcolor{comment}{ *              in stdio.h are used to write to the log file regardless of}
03533 \textcolor{comment}{ *              the VFD selected.}
03534 \textcolor{comment}{ *}
03535 \textcolor{comment}{ * aux\_ptr: Pointer to void used to allow wrapper code to associate}
03536 \textcolor{comment}{ *      its data with an instance of H5C\_t.  The H5C cache code}
03537 \textcolor{comment}{ *      sets this field to NULL, and otherwise leaves it alone.}
03538 \textcolor{comment}{ *}
03539 \textcolor{comment}{ * max\_type\_id: Integer field containing the maximum type id number assigned}
03540 \textcolor{comment}{ *      to a type of entry in the cache.  All type ids from 0 to}
03541 \textcolor{comment}{ *      max\_type\_id inclusive must be defined.  The names of the}
03542 \textcolor{comment}{ *      types are stored in the type\_name\_table discussed below, and}
03543 \textcolor{comment}{ *      indexed by the ids.}
03544 \textcolor{comment}{ *}
03545 \textcolor{comment}{ * class\_table\_ptr: Pointer to an array of H5C\_class\_t of length}
03546 \textcolor{comment}{ *              max\_type\_id + 1.  Entry classes for the cache.}
03547 \textcolor{comment}{ *}
03548 \textcolor{comment}{ * max\_cache\_size:  Nominal maximum number of bytes that may be stored in the}
03549 \textcolor{comment}{ *              cache.  This value should be viewed as a soft limit, as the}
03550 \textcolor{comment}{ *              cache can exceed this value under the following circumstances:}
03551 \textcolor{comment}{ *}
03552 \textcolor{comment}{ *              a) All entries in the cache are protected, and the cache is}
03553 \textcolor{comment}{ *                 asked to insert a new entry.  In this case the new entry}
03554 \textcolor{comment}{ *                 will be created.  If this causes the cache to exceed}
03555 \textcolor{comment}{ *                 max\_cache\_size, it will do so.  The cache will attempt}
03556 \textcolor{comment}{ *                 to reduce its size as entries are unprotected.}
03557 \textcolor{comment}{ *}
03558 \textcolor{comment}{ *              b) When running in parallel mode, the cache may not be}
03559 \textcolor{comment}{ *         permitted to flush a dirty entry in response to a read.}
03560 \textcolor{comment}{ *         If there are no clean entries available to evict, the}
03561 \textcolor{comment}{ *         cache will exceed its maximum size.  Again the cache}
03562 \textcolor{comment}{ *                 will attempt to reduce its size to the max\_cache\_size}
03563 \textcolor{comment}{ *                 limit on the next cache write.}
03564 \textcolor{comment}{ *}
03565 \textcolor{comment}{ *      c) When an entry increases in size, the cache may exceed}
03566 \textcolor{comment}{ *         the max\_cache\_size limit until the next time the cache}
03567 \textcolor{comment}{ *         attempts to load or insert an entry.}
03568 \textcolor{comment}{ *}
03569 \textcolor{comment}{ *      d) When the evictions\_enabled field is false (see below),}
03570 \textcolor{comment}{ *         the cache size will increase without limit until the}
03571 \textcolor{comment}{ *         field is set to true.}
03572 \textcolor{comment}{ *}
03573 \textcolor{comment}{ * min\_clean\_size: Nominal minimum number of clean bytes in the cache.}
03574 \textcolor{comment}{ *              The cache attempts to maintain this number of bytes of}
03575 \textcolor{comment}{ *              clean data so as to avoid case b) above.  Again, this is}
03576 \textcolor{comment}{ *              a soft limit.}
03577 \textcolor{comment}{ *}
03578 \textcolor{comment}{ * close\_warning\_received: Boolean flag indicating that a file closing }
03579 \textcolor{comment}{ *      warning has been received.}
03580 \textcolor{comment}{ *}
03581 \textcolor{comment}{ *}
03582 \textcolor{comment}{ * In addition to the call back functions required for each entry, the}
03583 \textcolor{comment}{ * cache requires the following call back functions for this instance of}
03584 \textcolor{comment}{ * the cache as a whole:}
03585 \textcolor{comment}{ *}
03586 \textcolor{comment}{ * check\_write\_permitted:  In certain applications, the cache may not}
03587 \textcolor{comment}{ *      be allowed to write to disk at certain time.  If specified,}
03588 \textcolor{comment}{ *      the check\_write\_permitted function is used to determine if}
03589 \textcolor{comment}{ *      a write is permissible at any given point in time.}
03590 \textcolor{comment}{ *}
03591 \textcolor{comment}{ *      If no such function is specified (i.e. this field is NULL),}
03592 \textcolor{comment}{ *      the cache uses the following write\_permitted field to}
03593 \textcolor{comment}{ *      determine whether writes are permitted.}
03594 \textcolor{comment}{ *}
03595 \textcolor{comment}{ * write\_permitted: If check\_write\_permitted is NULL, this boolean flag}
03596 \textcolor{comment}{ *      indicates whether writes are permitted.}
03597 \textcolor{comment}{ *}
03598 \textcolor{comment}{ * log\_flush:   If provided, this function is called whenever a dirty}
03599 \textcolor{comment}{ *      entry is flushed to disk.}
03600 \textcolor{comment}{ *}
03601 \textcolor{comment}{ *}
03602 \textcolor{comment}{ * In cases where memory is plentiful, and performance is an issue, it may}
03603 \textcolor{comment}{ * be useful to disable all cache evictions, and thereby postpone metadata}
03604 \textcolor{comment}{ * writes.  The following field is used to implement this.}
03605 \textcolor{comment}{ *}
03606 \textcolor{comment}{ * evictions\_enabled:  Boolean flag that is initialized to TRUE.  When}
03607 \textcolor{comment}{ *      this flag is set to FALSE, the metadata cache will not}
03608 \textcolor{comment}{ *      attempt to evict entries to make space for newly protected}
03609 \textcolor{comment}{ *      entries, and instead the will grow without limit.}
03610 \textcolor{comment}{ *      }
03611 \textcolor{comment}{ *      Needless to say, this feature must be used with care.}
03612 \textcolor{comment}{ *}
03613 \textcolor{comment}{ *}
03614 \textcolor{comment}{ * The cache requires an index to facilitate searching for entries.  The}
03615 \textcolor{comment}{ * following fields support that index.}
03616 \textcolor{comment}{ *}
03617 \textcolor{comment}{ * Addendum:  JRM -- 10/14/15}
03618 \textcolor{comment}{ *}
03619 \textcolor{comment}{ * We sometimes need to visit all entries in the cache.  In the past, this}
03620 \textcolor{comment}{ * was done by scanning the hash table.  However, this is expensive, and }
03621 \textcolor{comment}{ * we have come to scan the hash table often enough that it has become a }
03622 \textcolor{comment}{ * performance issue.  To repair this, I have added code to maintain a }
03623 \textcolor{comment}{ * list of all entries in the index -- call this list the index list.  }
03624 \textcolor{comment}{ *}
03625 \textcolor{comment}{ * The index list is maintained by the same macros that maintain the }
03626 \textcolor{comment}{ * index, and must have the same length and size as the index proper.}
03627 \textcolor{comment}{ *}
03628 \textcolor{comment}{ * index\_len:   Number of entries currently in the hash table used to index}
03629 \textcolor{comment}{ *      the cache.}
03630 \textcolor{comment}{ *}
03631 \textcolor{comment}{ * index\_size:  Number of bytes of cache entries currently stored in the}
03632 \textcolor{comment}{ *              hash table used to index the cache.}
03633 \textcolor{comment}{ *}
03634 \textcolor{comment}{ *              This value should not be mistaken for footprint of the}
03635 \textcolor{comment}{ *              cache in memory.  The average cache entry is small, and}
03636 \textcolor{comment}{ *              the cache has a considerable overhead.  Multiplying the}
03637 \textcolor{comment}{ *              index\_size by three should yield a conservative estimate}
03638 \textcolor{comment}{ *              of the cache's memory footprint.}
03639 \textcolor{comment}{ *}
03640 \textcolor{comment}{ * index\_ring\_len: Array of integer of length H5C\_RING\_NTYPES used to }
03641 \textcolor{comment}{ *      maintain a count of entries in the index by ring.  Note }
03642 \textcolor{comment}{ *      that the sum of all the cells in this array must equal }
03643 \textcolor{comment}{ *      the value stored in index\_len above.}
03644 \textcolor{comment}{ *}
03645 \textcolor{comment}{ * index\_ring\_size: Array of size\_t of length H5C\_RING\_NTYPES used to }
03646 \textcolor{comment}{ *      maintain the sum of the sizes of all entries in the index}
03647 \textcolor{comment}{ *      by ring.  Note that the sum of all cells in this array must}
03648 \textcolor{comment}{ *      equal the value stored in index\_size above.}
03649 \textcolor{comment}{ *}
03650 \textcolor{comment}{ * clean\_index\_size: Number of bytes of clean entries currently stored in}
03651 \textcolor{comment}{ *      the hash table.  Note that the index\_size field (above)}
03652 \textcolor{comment}{ *      is also the sum of the sizes of all entries in the cache.}
03653 \textcolor{comment}{ *      Thus we should have the invariant that clean\_index\_size +}
03654 \textcolor{comment}{ *      dirty\_index\_size == index\_size.}
03655 \textcolor{comment}{ *}
03656 \textcolor{comment}{ *      WARNING:}
03657 \textcolor{comment}{ *}
03658 \textcolor{comment}{ *         The value of the clean\_index\_size must not be mistaken}
03659 \textcolor{comment}{ *         for the current clean size of the cache.  Rather, the}
03660 \textcolor{comment}{ *         clean size of the cache is the current value of}
03661 \textcolor{comment}{ *         clean\_index\_size plus the amount of empty space (if any)}
03662 \textcolor{comment}{ *                 in the cache.}
03663 \textcolor{comment}{ *}
03664 \textcolor{comment}{ * clean\_index\_ring\_size: Array of size\_t of length H5C\_RING\_NTYPES used to}
03665 \textcolor{comment}{ *      maintain the sum of the sizes of all clean entries in the }
03666 \textcolor{comment}{ *      index by ring.  Note that the sum of all cells in this array }
03667 \textcolor{comment}{ *      must equal the value stored in clean\_index\_size above.}
03668 \textcolor{comment}{ *}
03669 \textcolor{comment}{ * dirty\_index\_size: Number of bytes of dirty entries currently stored in}
03670 \textcolor{comment}{ *      the hash table.  Note that the index\_size field (above)}
03671 \textcolor{comment}{ *      is also the sum of the sizes of all entries in the cache.}
03672 \textcolor{comment}{ *      Thus we should have the invariant that clean\_index\_size +}
03673 \textcolor{comment}{ *      dirty\_index\_size == index\_size.}
03674 \textcolor{comment}{ *}
03675 \textcolor{comment}{ * dirty\_index\_ring\_size: Array of size\_t of length H5C\_RING\_NTYPES used to}
03676 \textcolor{comment}{ *      maintain the sum of the sizes of all dirty entries in the }
03677 \textcolor{comment}{ *      index by ring.  Note that the sum of all cells in this array }
03678 \textcolor{comment}{ *      must equal the value stored in dirty\_index\_size above.}
03679 \textcolor{comment}{ *}
03680 \textcolor{comment}{ * index:   Array of pointer to H5C\_cache\_entry\_t of size}
03681 \textcolor{comment}{ *      H5C\_\_HASH\_TABLE\_LEN.  At present, this value is a power}
03682 \textcolor{comment}{ *      of two, not the usual prime number.}
03683 \textcolor{comment}{ *}
03684 \textcolor{comment}{ *      I hope that the variable size of cache elements, the large}
03685 \textcolor{comment}{ *      hash table size, and the way in which HDF5 allocates space}
03686 \textcolor{comment}{ *      will combine to avoid problems with periodicity.  If so, we}
03687 \textcolor{comment}{ *      can use a trivial hash function (a bit-and and a 3 bit left}
03688 \textcolor{comment}{ *      shift) with some small savings.}
03689 \textcolor{comment}{ *}
03690 \textcolor{comment}{ *      If not, it will become evident in the statistics. Changing}
03691 \textcolor{comment}{ *      to the usual prime number length hash table will require}
03692 \textcolor{comment}{ *      changing the H5C\_\_HASH\_FCN macro and the deletion of the}
03693 \textcolor{comment}{ *      H5C\_\_HASH\_MASK #define.  No other changes should be required.}
03694 \textcolor{comment}{ *}
03695 \textcolor{comment}{ * il\_len:  Number of entries on the index list.  }
03696 \textcolor{comment}{ *}
03697 \textcolor{comment}{ *      This must always be equal to index\_len.  As such, this }
03698 \textcolor{comment}{ *      field is redundant.  However, the existing linked list }
03699 \textcolor{comment}{ *      management macros expect to maintain a length field, so }
03700 \textcolor{comment}{ *      this field exists primarily to avoid adding complexity to}
03701 \textcolor{comment}{ *      these macros.}
03702 \textcolor{comment}{ *}
03703 \textcolor{comment}{ * il\_size:     Number of bytes of cache entries currently stored in the}
03704 \textcolor{comment}{ *      index list.}
03705 \textcolor{comment}{ *}
03706 \textcolor{comment}{ *      This must always be equal to index\_size.  As such, this }
03707 \textcolor{comment}{ *      field is redundant.  However, the existing linked list }
03708 \textcolor{comment}{ *      management macros expect to maintain a size field, so }
03709 \textcolor{comment}{ *      this field exists primarily to avoid adding complexity to}
03710 \textcolor{comment}{ *      these macros.}
03711 \textcolor{comment}{ *}
03712 \textcolor{comment}{ * il\_head: Pointer to the head of the doubly linked list of entries in}
03713 \textcolor{comment}{ *              the index list.  Note that cache entries on this list are }
03714 \textcolor{comment}{ *      linked by their il\_next and il\_prev fields.}
03715 \textcolor{comment}{ *}
03716 \textcolor{comment}{ *              This field is NULL if the index is empty.}
03717 \textcolor{comment}{ *}
03718 \textcolor{comment}{ * il\_tail: Pointer to the tail of the doubly linked list of entries in}
03719 \textcolor{comment}{ *              the index list.  Note that cache entries on this list are }
03720 \textcolor{comment}{ *              linked by their il\_next and il\_prev fields.}
03721 \textcolor{comment}{ *}
03722 \textcolor{comment}{ *              This field is NULL if the index is empty.}
03723 \textcolor{comment}{ *}
03724 \textcolor{comment}{ *}
03725 \textcolor{comment}{ * With the addition of the take ownership flag, it is possible that }
03726 \textcolor{comment}{ * an entry may be removed from the cache as the result of the flush of }
03727 \textcolor{comment}{ * a second entry.  In general, this causes little trouble, but it is }
03728 \textcolor{comment}{ * possible that the entry removed may be the next entry in the scan of }
03729 \textcolor{comment}{ * a list.  In this case, we must be able to detect the fact that the }
03730 \textcolor{comment}{ * entry has been removed, so that the scan doesn't attempt to proceed with}
03731 \textcolor{comment}{ * an entry that is no longer in the cache.}
03732 \textcolor{comment}{ *}
03733 \textcolor{comment}{ * The following fields are maintained to facilitate this.}
03734 \textcolor{comment}{ *}
03735 \textcolor{comment}{ * entries\_removed\_counter: Counter that is incremented each time an}
03736 \textcolor{comment}{ *      entry is removed from the cache by any means (eviction, }
03737 \textcolor{comment}{ *      expungement, or take ownership at this point in time).}
03738 \textcolor{comment}{ *      Functions that perform scans on lists may set this field}
03739 \textcolor{comment}{ *      to zero prior to calling H5C\_\_flush\_single\_entry().  }
03740 \textcolor{comment}{ *      Unexpected changes to the counter indicate that an entry }
03741 \textcolor{comment}{ *      was removed from the cache as a side effect of the flush.}
03742 \textcolor{comment}{ *}
03743 \textcolor{comment}{ * last\_entry\_removed\_ptr:  Pointer to the instance of H5C\_cache\_entry\_t}
03744 \textcolor{comment}{ *      which contained the last entry to be removed from the cache,}
03745 \textcolor{comment}{ *      or NULL if there either is no such entry, or if a function}
03746 \textcolor{comment}{ *      performing a scan of a list has set this field to NULL prior}
03747 \textcolor{comment}{ *      to calling H5C\_\_flush\_single\_entry().}
03748 \textcolor{comment}{ *}
03749 \textcolor{comment}{ *      WARNING!!! This field must NEVER be dereferenced.  It is }
03750 \textcolor{comment}{ *      maintained to allow functions that perform scans of lists}
03751 \textcolor{comment}{ *      to compare this pointer with their pointers to next, thus}
03752 \textcolor{comment}{ *      allowing them to avoid unnecessary restarts of scans if the}
03753 \textcolor{comment}{ *      pointers don't match, and if entries\_removed\_counter is }
03754 \textcolor{comment}{ *      one.}
03755 \textcolor{comment}{ *}
03756 \textcolor{comment}{ * entry\_watched\_for\_removal:   Pointer to an instance of H5C\_cache\_entry\_t}
03757 \textcolor{comment}{ *      which contains the 'next' entry for an iteration.  Removing}
03758 \textcolor{comment}{ *              this entry must trigger a rescan of the iteration, so each}
03759 \textcolor{comment}{ *              entry removed from the cache is compared against this pointer}
03760 \textcolor{comment}{ *              and the pointer is reset to NULL if the watched entry is removed.}
03761 \textcolor{comment}{ *              (This functions similarly to a "dead man's switch")}
03762 \textcolor{comment}{ *}
03763 \textcolor{comment}{ *}
03764 \textcolor{comment}{ * When we flush the cache, we need to write entries out in increasing}
03765 \textcolor{comment}{ * address order.  An instance of a skip list is used to store dirty entries in}
03766 \textcolor{comment}{ * sorted order.  Whether it is cheaper to sort the dirty entries as needed,}
03767 \textcolor{comment}{ * or to maintain the list is an open question.  At a guess, it depends}
03768 \textcolor{comment}{ * on how frequently the cache is flushed.  We will see how it goes.}
03769 \textcolor{comment}{ *}
03770 \textcolor{comment}{ * For now at least, I will not remove dirty entries from the list as they}
03771 \textcolor{comment}{ * are flushed. (this has been changed -- dirty entries are now removed from}
03772 \textcolor{comment}{ * the skip list as they are flushed.  JRM - 10/25/05)}
03773 \textcolor{comment}{ *}
03774 \textcolor{comment}{ * slist\_changed: Boolean flag used to indicate whether the contents of }
03775 \textcolor{comment}{ *      the slist has changed since the last time this flag was}
03776 \textcolor{comment}{ *      reset.  This is used in the cache flush code to detect }
03777 \textcolor{comment}{ *      conditions in which pre-serialize or serialize callbacks}
03778 \textcolor{comment}{ *      have modified the slist -- which obliges us to restart }
03779 \textcolor{comment}{ *      the scan of the slist from the beginning.}
03780 \textcolor{comment}{ *}
03781 \textcolor{comment}{ * slist\_len:   Number of entries currently in the skip list}
03782 \textcolor{comment}{ *              used to maintain a sorted list of dirty entries in the}
03783 \textcolor{comment}{ *              cache.}
03784 \textcolor{comment}{ *}
03785 \textcolor{comment}{ * slist\_size:  Number of bytes of cache entries currently stored in the}
03786 \textcolor{comment}{ *              skip list used to maintain a sorted list of}
03787 \textcolor{comment}{ *              dirty entries in the cache.}
03788 \textcolor{comment}{ *}
03789 \textcolor{comment}{ * slist\_ring\_len: Array of integer of length H5C\_RING\_NTYPES used to }
03790 \textcolor{comment}{ *      maintain a count of entries in the slist by ring.  Note }
03791 \textcolor{comment}{ *      that the sum of all the cells in this array must equal }
03792 \textcolor{comment}{ *      the value stored in slist\_len above.}
03793 \textcolor{comment}{ *}
03794 \textcolor{comment}{ * slist\_ring\_size: Array of size\_t of length H5C\_RING\_NTYPES used to}
03795 \textcolor{comment}{ *              maintain the sum of the sizes of all entries in the }
03796 \textcolor{comment}{ *      slist by ring.  Note that the sum of all cells in this }
03797 \textcolor{comment}{ *      array must equal the value stored in slist\_size above.}
03798 \textcolor{comment}{ *}
03799 \textcolor{comment}{ * slist\_ptr:   pointer to the instance of H5SL\_t used maintain a sorted}
03800 \textcolor{comment}{ *              list of dirty entries in the cache.  This sorted list has}
03801 \textcolor{comment}{ *              two uses:}
03802 \textcolor{comment}{ *}
03803 \textcolor{comment}{ *              a) It allows us to flush dirty entries in increasing address}
03804 \textcolor{comment}{ *                 order, which results in significant savings.}
03805 \textcolor{comment}{ *}
03806 \textcolor{comment}{ *              b) It facilitates checking for adjacent dirty entries when}
03807 \textcolor{comment}{ *                 attempting to evict entries from the cache.  While we}
03808 \textcolor{comment}{ *                 don't use this at present, I hope that this will allow}
03809 \textcolor{comment}{ *                 some optimizations when I get to it.}
03810 \textcolor{comment}{ *}
03811 \textcolor{comment}{ * num\_last\_entries: The number of entries in the cache that can only be}
03812 \textcolor{comment}{ *      flushed after all other entries in the cache have}
03813 \textcolor{comment}{ *              been flushed. At this time, this will only ever be}
03814 \textcolor{comment}{ *              one entry (the superblock), and the code has been}
03815 \textcolor{comment}{ *              protected with HDasserts to enforce this. This restraint}
03816 \textcolor{comment}{ *              can certainly be relaxed in the future if the need for}
03817 \textcolor{comment}{ *              multiple entries being flushed last arises, though}
03818 \textcolor{comment}{ *              explicit tests for that case should be added when said}
03819 \textcolor{comment}{ *              HDasserts are removed.}
03820 \textcolor{comment}{ *}
03821 \textcolor{comment}{ *      Update: There are now two possible last entries}
03822 \textcolor{comment}{ *      (superblock and file driver info message).  This}
03823 \textcolor{comment}{ *      number will probably increase as we add superblock}
03824 \textcolor{comment}{ *      messages.   JRM -- 11/18/14}
03825 \textcolor{comment}{ *}
03826 \textcolor{comment}{ * With the addition of the fractal heap, the cache must now deal with}
03827 \textcolor{comment}{ * the case in which entries may be dirtied, moved, or have their sizes}
03828 \textcolor{comment}{ * changed during a flush.  To allow sanity checks in this situation, the}
03829 \textcolor{comment}{ * following two fields have been added.  They are only compiled in when}
03830 \textcolor{comment}{ * H5C\_DO\_SANITY\_CHECKS is TRUE.}
03831 \textcolor{comment}{ *}
03832 \textcolor{comment}{ * slist\_len\_increase: Number of entries that have been added to the}
03833 \textcolor{comment}{ *      slist since the last time this field was set to zero.}
03834 \textcolor{comment}{ *      Note that this value can be negative.}
03835 \textcolor{comment}{ *}
03836 \textcolor{comment}{ * slist\_size\_increase: Total size of all entries that have been added}
03837 \textcolor{comment}{ *      to the slist since the last time this field was set to}
03838 \textcolor{comment}{ *      zero.  Note that this value can be negative.}
03839 \textcolor{comment}{ *}
03840 \textcolor{comment}{ * Cache entries belonging to a particular object are "tagged" with that}
03841 \textcolor{comment}{ * object's base object header address.}
03842 \textcolor{comment}{ *}
03843 \textcolor{comment}{ * The following fields are maintained to facilitate this.}
03844 \textcolor{comment}{ *}
03845 \textcolor{comment}{ * tag\_list: A skip list to track entries that belong to an object.}
03846 \textcolor{comment}{ *                Each H5C\_tag\_info\_t struct on the tag list corresponds to}
03847 \textcolor{comment}{ *                a particular object in the file.  Tagged entries can be}
03848 \textcolor{comment}{ *                flushed or evicted as a group, or corked to prevent entries}
03849 \textcolor{comment}{ *                from being evicted from the cache.}
03850 \textcolor{comment}{ *}
03851 \textcolor{comment}{ *                "Global" entries, like the superblock and the file's}
03852 \textcolor{comment}{ *                freelist, as well as shared entries like global}
03853 \textcolor{comment}{ *                heaps and shared object header messages, are not tagged.}
03854 \textcolor{comment}{ *}
03855 \textcolor{comment}{ * ignore\_tags: Boolean flag to disable tag validation during entry insertion.}
03856 \textcolor{comment}{ *}
03857 \textcolor{comment}{ * When a cache entry is protected, it must be removed from the LRU}
03858 \textcolor{comment}{ * list(s) as it cannot be either flushed or evicted until it is unprotected.}
03859 \textcolor{comment}{ * The following fields are used to implement the protected list (pl).}
03860 \textcolor{comment}{ *}
03861 \textcolor{comment}{ * pl\_len:      Number of entries currently residing on the protected list.}
03862 \textcolor{comment}{ *}
03863 \textcolor{comment}{ * pl\_size:     Number of bytes of cache entries currently residing on the}
03864 \textcolor{comment}{ *              protected list.}
03865 \textcolor{comment}{ *}
03866 \textcolor{comment}{ * pl\_head\_ptr: Pointer to the head of the doubly linked list of protected}
03867 \textcolor{comment}{ *              entries.  Note that cache entries on this list are linked}
03868 \textcolor{comment}{ *              by their next and prev fields.}
03869 \textcolor{comment}{ *}
03870 \textcolor{comment}{ *              This field is NULL if the list is empty.}
03871 \textcolor{comment}{ *}
03872 \textcolor{comment}{ * pl\_tail\_ptr: Pointer to the tail of the doubly linked list of protected}
03873 \textcolor{comment}{ *              entries.  Note that cache entries on this list are linked}
03874 \textcolor{comment}{ *              by their next and prev fields.}
03875 \textcolor{comment}{ *}
03876 \textcolor{comment}{ *              This field is NULL if the list is empty.}
03877 \textcolor{comment}{ *}
03878 \textcolor{comment}{ *}
03879 \textcolor{comment}{ * For very frequently used entries, the protect/unprotect overhead can}
03880 \textcolor{comment}{ * become burdensome.  To avoid this overhead, I have modified the cache}
03881 \textcolor{comment}{ * to allow entries to be "pinned".  A pinned entry is similar to a}
03882 \textcolor{comment}{ * protected entry, in the sense that it cannot be evicted, and that}
03883 \textcolor{comment}{ * the entry can be modified at any time.}
03884 \textcolor{comment}{ *}
03885 \textcolor{comment}{ * Pinning an entry has the following implications:}
03886 \textcolor{comment}{ *}
03887 \textcolor{comment}{ *  1) A pinned entry cannot be evicted.  Thus unprotected}
03888 \textcolor{comment}{ *         pinned entries reside in the pinned entry list, instead}
03889 \textcolor{comment}{ *         of the LRU list(s) (or other lists maintained by the current}
03890 \textcolor{comment}{ *         replacement policy code).}
03891 \textcolor{comment}{ *}
03892 \textcolor{comment}{ *      2) A pinned entry can be accessed or modified at any time.}
03893 \textcolor{comment}{ *         This places an additional burden on the associated pre-serialize}
03894 \textcolor{comment}{ *     and serialize callbacks, which must ensure the the entry is in }
03895 \textcolor{comment}{ *     a consistant state before creating an image of it.}
03896 \textcolor{comment}{ *}
03897 \textcolor{comment}{ *      3) A pinned entry can be marked as dirty (and possibly}
03898 \textcolor{comment}{ *         change size) while it is unprotected.}
03899 \textcolor{comment}{ *}
03900 \textcolor{comment}{ *      4) The flush-destroy code must allow pinned entries to}
03901 \textcolor{comment}{ *         be unpinned (and possibly unprotected) during the}
03902 \textcolor{comment}{ *         flush.}
03903 \textcolor{comment}{ *}
03904 \textcolor{comment}{ * Since pinned entries cannot be evicted, they must be kept on a pinned}
03905 \textcolor{comment}{ * entry list (pel), instead of being entrusted to the replacement policy }
03906 \textcolor{comment}{ * code.}
03907 \textcolor{comment}{ *}
03908 \textcolor{comment}{ * Maintaining the pinned entry list requires the following fields:}
03909 \textcolor{comment}{ *}
03910 \textcolor{comment}{ * pel\_len: Number of entries currently residing on the pinned}
03911 \textcolor{comment}{ *      entry list.}
03912 \textcolor{comment}{ *}
03913 \textcolor{comment}{ * pel\_size:    Number of bytes of cache entries currently residing on}
03914 \textcolor{comment}{ *      the pinned entry list.}
03915 \textcolor{comment}{ *}
03916 \textcolor{comment}{ * pel\_head\_ptr: Pointer to the head of the doubly linked list of pinned}
03917 \textcolor{comment}{ *      but not protected entries.  Note that cache entries on}
03918 \textcolor{comment}{ *      this list are linked by their next and prev fields.}
03919 \textcolor{comment}{ *}
03920 \textcolor{comment}{ *              This field is NULL if the list is empty.}
03921 \textcolor{comment}{ *}
03922 \textcolor{comment}{ * pel\_tail\_ptr: Pointer to the tail of the doubly linked list of pinned}
03923 \textcolor{comment}{ *      but not protected entries.  Note that cache entries on}
03924 \textcolor{comment}{ *      this list are linked by their next and prev fields.}
03925 \textcolor{comment}{ *}
03926 \textcolor{comment}{ *              This field is NULL if the list is empty.}
03927 \textcolor{comment}{ *}
03928 \textcolor{comment}{ *}
03929 \textcolor{comment}{ * The cache must have a replacement policy, and the fields supporting this}
03930 \textcolor{comment}{ * policy must be accessible from this structure.}
03931 \textcolor{comment}{ *}
03932 \textcolor{comment}{ * While there has been interest in several replacement policies for}
03933 \textcolor{comment}{ * this cache, the initial development schedule is tight.  Thus I have}
03934 \textcolor{comment}{ * elected to support only a modified LRU (least recently used) policy }
03935 \textcolor{comment}{ * for the first cut.}
03936 \textcolor{comment}{ *}
03937 \textcolor{comment}{ * To further simplify matters, I have simply included the fields needed}
03938 \textcolor{comment}{ * by the modified LRU in this structure.  When and if we add support for}
03939 \textcolor{comment}{ * other policies, it will probably be easiest to just add the necessary}
03940 \textcolor{comment}{ * fields to this structure as well -- we only create one instance of this}
03941 \textcolor{comment}{ * structure per file, so the overhead is not excessive.}
03942 \textcolor{comment}{ *}
03943 \textcolor{comment}{ *}
03944 \textcolor{comment}{ * Fields supporting the modified LRU policy:}
03945 \textcolor{comment}{ *}
03946 \textcolor{comment}{ * See most any OS text for a discussion of the LRU replacement policy.}
03947 \textcolor{comment}{ *}
03948 \textcolor{comment}{ * When operating in parallel mode, we must ensure that a read does not}
03949 \textcolor{comment}{ * cause a write.  If it does, the process will hang, as the write will}
03950 \textcolor{comment}{ * be collective and the other processes will not know to participate.}
03951 \textcolor{comment}{ *}
03952 \textcolor{comment}{ * To deal with this issue, I have modified the usual LRU policy by adding}
03953 \textcolor{comment}{ * clean and dirty LRU lists to the usual LRU list.  In general, these }
03954 \textcolor{comment}{ * lists are only exist in parallel builds.}
03955 \textcolor{comment}{ *}
03956 \textcolor{comment}{ * The clean LRU list is simply the regular LRU list with all dirty cache}
03957 \textcolor{comment}{ * entries removed.}
03958 \textcolor{comment}{ *}
03959 \textcolor{comment}{ * Similarly, the dirty LRU list is the regular LRU list with all the clean}
03960 \textcolor{comment}{ * cache entries removed.}
03961 \textcolor{comment}{ *}
03962 \textcolor{comment}{ * When reading in parallel mode, we evict from the clean LRU list only.}
03963 \textcolor{comment}{ * This implies that we must try to ensure that the clean LRU list is}
03964 \textcolor{comment}{ * reasonably well stocked at all times.}
03965 \textcolor{comment}{ *}
03966 \textcolor{comment}{ * We attempt to do this by trying to flush enough entries on each write}
03967 \textcolor{comment}{ * to keep the cLRU\_list\_size >= min\_clean\_size.}
03968 \textcolor{comment}{ *}
03969 \textcolor{comment}{ * Even if we start with a completely clean cache, a sequence of protects}
03970 \textcolor{comment}{ * without unprotects can empty the clean LRU list.  In this case, the}
03971 \textcolor{comment}{ * cache must grow temporarily.  At the next sync point, we will attempt to}
03972 \textcolor{comment}{ * evict enough entries to reduce index\_size to less than max\_cache\_size.}
03973 \textcolor{comment}{ * While this will usually be possible, all bets are off if enough entries}
03974 \textcolor{comment}{ * are protected.}
03975 \textcolor{comment}{ *}
03976 \textcolor{comment}{ * Discussions of the individual fields used by the modified LRU replacement}
03977 \textcolor{comment}{ * policy follow:}
03978 \textcolor{comment}{ *}
03979 \textcolor{comment}{ * LRU\_list\_len:  Number of cache entries currently on the LRU list.}
03980 \textcolor{comment}{ *}
03981 \textcolor{comment}{ *              Observe that LRU\_list\_len + pl\_len + pel\_len must always }
03982 \textcolor{comment}{ *      equal index\_len.}
03983 \textcolor{comment}{ *}
03984 \textcolor{comment}{ * LRU\_list\_size:  Number of bytes of cache entries currently residing on the}
03985 \textcolor{comment}{ *              LRU list.}
03986 \textcolor{comment}{ *}
03987 \textcolor{comment}{ *              Observe that LRU\_list\_size + pl\_size + pel\_size must always }
03988 \textcolor{comment}{ *      equal index\_size.}
03989 \textcolor{comment}{ *}
03990 \textcolor{comment}{ * LRU\_head\_ptr:  Pointer to the head of the doubly linked LRU list.  Cache}
03991 \textcolor{comment}{ *              entries on this list are linked by their next and prev fields.}
03992 \textcolor{comment}{ *}
03993 \textcolor{comment}{ *              This field is NULL if the list is empty.}
03994 \textcolor{comment}{ *}
03995 \textcolor{comment}{ * LRU\_tail\_ptr:  Pointer to the tail of the doubly linked LRU list.  Cache}
03996 \textcolor{comment}{ *              entries on this list are linked by their next and prev fields.}
03997 \textcolor{comment}{ *}
03998 \textcolor{comment}{ *              This field is NULL if the list is empty.}
03999 \textcolor{comment}{ *}
04000 \textcolor{comment}{ * cLRU\_list\_len: Number of cache entries currently on the clean LRU list.}
04001 \textcolor{comment}{ *}
04002 \textcolor{comment}{ *              Observe that cLRU\_list\_len + dLRU\_list\_len must always}
04003 \textcolor{comment}{ *              equal LRU\_list\_len.}
04004 \textcolor{comment}{ *}
04005 \textcolor{comment}{ * cLRU\_list\_size:  Number of bytes of cache entries currently residing on}
04006 \textcolor{comment}{ *              the clean LRU list.}
04007 \textcolor{comment}{ *}
04008 \textcolor{comment}{ *              Observe that cLRU\_list\_size + dLRU\_list\_size must always}
04009 \textcolor{comment}{ *              equal LRU\_list\_size.}
04010 \textcolor{comment}{ *}
04011 \textcolor{comment}{ * cLRU\_head\_ptr:  Pointer to the head of the doubly linked clean LRU list.}
04012 \textcolor{comment}{ *              Cache entries on this list are linked by their aux\_next and}
04013 \textcolor{comment}{ *              aux\_prev fields.}
04014 \textcolor{comment}{ *}
04015 \textcolor{comment}{ *              This field is NULL if the list is empty.}
04016 \textcolor{comment}{ *}
04017 \textcolor{comment}{ * cLRU\_tail\_ptr:  Pointer to the tail of the doubly linked clean LRU list.}
04018 \textcolor{comment}{ *              Cache entries on this list are linked by their aux\_next and}
04019 \textcolor{comment}{ *              aux\_prev fields.}
04020 \textcolor{comment}{ *}
04021 \textcolor{comment}{ *              This field is NULL if the list is empty.}
04022 \textcolor{comment}{ *}
04023 \textcolor{comment}{ * dLRU\_list\_len: Number of cache entries currently on the dirty LRU list.}
04024 \textcolor{comment}{ *}
04025 \textcolor{comment}{ *              Observe that cLRU\_list\_len + dLRU\_list\_len must always}
04026 \textcolor{comment}{ *              equal LRU\_list\_len.}
04027 \textcolor{comment}{ *}
04028 \textcolor{comment}{ * dLRU\_list\_size:  Number of cache entries currently on the dirty LRU list.}
04029 \textcolor{comment}{ *}
04030 \textcolor{comment}{ *              Observe that cLRU\_list\_len + dLRU\_list\_len must always}
04031 \textcolor{comment}{ *              equal LRU\_list\_len.}
04032 \textcolor{comment}{ *}
04033 \textcolor{comment}{ * dLRU\_head\_ptr:  Pointer to the head of the doubly linked dirty LRU list.}
04034 \textcolor{comment}{ *              Cache entries on this list are linked by their aux\_next and}
04035 \textcolor{comment}{ *              aux\_prev fields.}
04036 \textcolor{comment}{ *}
04037 \textcolor{comment}{ *              This field is NULL if the list is empty.}
04038 \textcolor{comment}{ *}
04039 \textcolor{comment}{ * dLRU\_tail\_ptr:  Pointer to the tail of the doubly linked dirty LRU list.}
04040 \textcolor{comment}{ *              Cache entries on this list are linked by their aux\_next and}
04041 \textcolor{comment}{ *              aux\_prev fields.}
04042 \textcolor{comment}{ *}
04043 \textcolor{comment}{ *              This field is NULL if the list is empty.}
04044 \textcolor{comment}{ *}
04045 \textcolor{comment}{ *}
04046 \textcolor{comment}{ * Automatic cache size adjustment:}
04047 \textcolor{comment}{ *}
04048 \textcolor{comment}{ * While the default cache size is adequate for most cases, we can run into}
04049 \textcolor{comment}{ * cases where the default is too small.  Ideally, we will let the user}
04050 \textcolor{comment}{ * adjust the cache size as required.  However, this is not possible in all}
04051 \textcolor{comment}{ * cases.  Thus I have added automatic cache size adjustment code.}
04052 \textcolor{comment}{ *}
04053 \textcolor{comment}{ * The configuration for the automatic cache size adjustment is stored in}
04054 \textcolor{comment}{ * the structure described below:}
04055 \textcolor{comment}{ *}
04056 \textcolor{comment}{ * size\_increase\_possible:  Depending on the configuration data given}
04057 \textcolor{comment}{ *      in the resize\_ctl field, it may or may not be possible}
04058 \textcolor{comment}{ *      to increase the size of the cache.  Rather than test for}
04059 \textcolor{comment}{ *      all the ways this can happen, we simply set this flag when}
04060 \textcolor{comment}{ *      we receive a new configuration.}
04061 \textcolor{comment}{ *}
04062 \textcolor{comment}{ * flash\_size\_increase\_possible: Depending on the configuration data given}
04063 \textcolor{comment}{ *              in the resize\_ctl field, it may or may not be possible}
04064 \textcolor{comment}{ *              for a flash size increase to occur.  We set this flag}
04065 \textcolor{comment}{ *              whenever we receive a new configuration so as to avoid}
04066 \textcolor{comment}{ *              repeated calculations.}
04067 \textcolor{comment}{ *}
04068 \textcolor{comment}{ * flash\_size\_increase\_threshold: If a flash cache size increase is possible,}
04069 \textcolor{comment}{ *              this field is used to store the minimum size of a new entry}
04070 \textcolor{comment}{ *              or size increase needed to trigger a flash cache size}
04071 \textcolor{comment}{ *              increase.  Note that this field must be updated whenever}
04072 \textcolor{comment}{ *              the size of the cache is changed.}
04073 \textcolor{comment}{ *}
04074 \textcolor{comment}{ * size\_decrease\_possible:  Depending on the configuration data given}
04075 \textcolor{comment}{ *              in the resize\_ctl field, it may or may not be possible}
04076 \textcolor{comment}{ *              to decrease the size of the cache.  Rather than test for}
04077 \textcolor{comment}{ *              all the ways this can happen, we simply set this flag when}
04078 \textcolor{comment}{ *              we receive a new configuration.}
04079 \textcolor{comment}{ *}
04080 \textcolor{comment}{ * resize\_enabled:  This is another convenience flag which is set whenever}
04081 \textcolor{comment}{ *      a new set of values for resize\_ctl are provided.  Very}
04082 \textcolor{comment}{ *      simply,}
04083 \textcolor{comment}{ *}
04084 \textcolor{comment}{ *          resize\_enabled = size\_increase\_possible ||}
04085 \textcolor{comment}{ *                                   size\_decrease\_possible;}
04086 \textcolor{comment}{ *}
04087 \textcolor{comment}{ * cache\_full:  Boolean flag used to keep track of whether the cache is}
04088 \textcolor{comment}{ *      full, so we can refrain from increasing the size of a}
04089 \textcolor{comment}{ *      cache which hasn't used up the space allotted to it.}
04090 \textcolor{comment}{ *}
04091 \textcolor{comment}{ *      The field is initialized to FALSE, and then set to TRUE}
04092 \textcolor{comment}{ *      whenever we attempt to make space in the cache.}
04093 \textcolor{comment}{ *}
04094 \textcolor{comment}{ * size\_decreased:  Boolean flag set to TRUE whenever the maximum cache}
04095 \textcolor{comment}{ *      size is decreased.  The flag triggers a call to}
04096 \textcolor{comment}{ *      H5C\_\_make\_space\_in\_cache() on the next call to H5C\_protect().}
04097 \textcolor{comment}{ *}
04098 \textcolor{comment}{ * resize\_in\_progress: As the metadata cache has become re-entrant, it is }
04099 \textcolor{comment}{ *      possible that a protect may trigger a call to }
04100 \textcolor{comment}{ *      H5C\_\_auto\_adjust\_cache\_size(), which may trigger a flush,}
04101 \textcolor{comment}{ *      which may trigger a protect, which will result in another }
04102 \textcolor{comment}{ *      call to H5C\_\_auto\_adjust\_cache\_size().  }
04103 \textcolor{comment}{ *}
04104 \textcolor{comment}{ *      The resize\_in\_progress boolean flag is used to detect this,}
04105 \textcolor{comment}{ *      and to prevent the infinite recursion that would otherwise}
04106 \textcolor{comment}{ *      occur.}
04107 \textcolor{comment}{ *}
04108 \textcolor{comment}{ *      Note that this issue is not hypothetical -- this field }
04109 \textcolor{comment}{ *      was added 12/29/15 to fix a bug exposed in the testing }
04110 \textcolor{comment}{ *      of changes to the file driver info superblock extension}
04111 \textcolor{comment}{ *      management code needed to support rings.}
04112 \textcolor{comment}{ *}
04113 \textcolor{comment}{ * msic\_in\_progress: As the metadata cache has become re-entrant, and as}
04114 \textcolor{comment}{ *              the free space manager code has become more tightly }
04115 \textcolor{comment}{ *              integrated with the metadata cache, it is possible that }
04116 \textcolor{comment}{ *              a call to H5C\_insert\_entry() may trigger a call to }
04117 \textcolor{comment}{ *              H5C\_make\_space\_in\_cache(), which, via H5C\_\_flush\_single\_entry()}
04118 \textcolor{comment}{ *              and client callbacks, may trigger an infinite regression}
04119 \textcolor{comment}{ *              of calls to H5C\_make\_space\_in\_cache().}
04120 \textcolor{comment}{ *}
04121 \textcolor{comment}{ *              The msic\_in\_progress boolean flag is used to detect this,}
04122 \textcolor{comment}{ *              and prevent the infinite regression that would otherwise}
04123 \textcolor{comment}{ *              occur.}
04124 \textcolor{comment}{ *}
04125 \textcolor{comment}{ *              Note that this is issue is not hypothetical -- this field }
04126 \textcolor{comment}{ *              was added 2/16/17 to address this issue when it was }
04127 \textcolor{comment}{ *              exposed by modifications to test/fheap.c to cause it to }
04128 \textcolor{comment}{ *              use paged allocation.}
04129 \textcolor{comment}{ *}
04130 \textcolor{comment}{ * resize\_ctl:  Instance of H5C\_auto\_size\_ctl\_t containing configuration}
04131 \textcolor{comment}{ *      data for automatic cache resizing.}
04132 \textcolor{comment}{ *}
04133 \textcolor{comment}{ * epoch\_markers\_active:  Integer field containing the number of epoch}
04134 \textcolor{comment}{ *      markers currently in use in the LRU list.  This value}
04135 \textcolor{comment}{ *      must be in the range [0, H5C\_\_MAX\_EPOCH\_MARKERS - 1].}
04136 \textcolor{comment}{ *}
04137 \textcolor{comment}{ * epoch\_marker\_active:  Array of boolean of length H5C\_\_MAX\_EPOCH\_MARKERS.}
04138 \textcolor{comment}{ *      This array is used to track which epoch markers are currently}
04139 \textcolor{comment}{ *      in use.}
04140 \textcolor{comment}{ *}
04141 \textcolor{comment}{ * epoch\_marker\_ringbuf:  Array of int of length H5C\_\_MAX\_EPOCH\_MARKERS + 1.}
04142 \textcolor{comment}{ *}
04143 \textcolor{comment}{ *      To manage the epoch marker cache entries, it is necessary}
04144 \textcolor{comment}{ *      to track their order in the LRU list.  This is done with}
04145 \textcolor{comment}{ *      epoch\_marker\_ringbuf.  When markers are inserted at the}
04146 \textcolor{comment}{ *      head of the LRU list, the index of the marker in the}
04147 \textcolor{comment}{ *      epoch\_markers array is inserted at the tail of the ring}
04148 \textcolor{comment}{ *      buffer.  When it becomes the epoch\_marker\_active'th marker}
04149 \textcolor{comment}{ *      in the LRU list, it will have worked its way to the head}
04150 \textcolor{comment}{ *      of the ring buffer as well.  This allows us to remove it}
04151 \textcolor{comment}{ *      without scanning the LRU list if such is required.}
04152 \textcolor{comment}{ *}
04153 \textcolor{comment}{ * epoch\_marker\_ringbuf\_first: Integer field containing the index of the}
04154 \textcolor{comment}{ *      first entry in the ring buffer.}
04155 \textcolor{comment}{ *}
04156 \textcolor{comment}{ * epoch\_marker\_ringbuf\_last: Integer field containing the index of the}
04157 \textcolor{comment}{ *      last entry in the ring buffer.}
04158 \textcolor{comment}{ *}
04159 \textcolor{comment}{ * epoch\_marker\_ringbuf\_size: Integer field containing the number of entries}
04160 \textcolor{comment}{ *      in the ring buffer.}
04161 \textcolor{comment}{ *}
04162 \textcolor{comment}{ * epoch\_markers:  Array of instances of H5C\_cache\_entry\_t of length}
04163 \textcolor{comment}{ *      H5C\_\_MAX\_EPOCH\_MARKERS.  The entries are used as markers}
04164 \textcolor{comment}{ *      in the LRU list to identify cache entries that haven't}
04165 \textcolor{comment}{ *      been accessed for some (small) specified number of}
04166 \textcolor{comment}{ *      epochs.  These entries (if any) can then be evicted and}
04167 \textcolor{comment}{ *      the cache size reduced -- ideally without evicting any}
04168 \textcolor{comment}{ *      of the current working set.  Needless to say, the epoch}
04169 \textcolor{comment}{ *      length and the number of epochs before an unused entry}
04170 \textcolor{comment}{ *      must be chosen so that all, or almost all, the working}
04171 \textcolor{comment}{ *      set will be accessed before the limit.}
04172 \textcolor{comment}{ *}
04173 \textcolor{comment}{ *      Epoch markers only appear in the LRU list, never in}
04174 \textcolor{comment}{ *      the index or slist.  While they are of type}
04175 \textcolor{comment}{ *      H5C\_\_EPOCH\_MARKER\_TYPE, and have associated class}
04176 \textcolor{comment}{ *      functions, these functions should never be called.}
04177 \textcolor{comment}{ *}
04178 \textcolor{comment}{ *      The addr fields of these instances of H5C\_cache\_entry\_t}
04179 \textcolor{comment}{ *      are set to the index of the instance in the epoch\_markers}
04180 \textcolor{comment}{ *      array, the size is set to 0, and the type field points}
04181 \textcolor{comment}{ *      to the constant structure epoch\_marker\_class defined}
04182 \textcolor{comment}{ *      in H5C.c.  The next and prev fields are used as usual}
04183 \textcolor{comment}{ *      to link the entry into the LRU list.}
04184 \textcolor{comment}{ *}
04185 \textcolor{comment}{ *      All other fields are unused.}
04186 \textcolor{comment}{ *}
04187 \textcolor{comment}{ *}
04188 \textcolor{comment}{ * Cache hit rate collection fields:}
04189 \textcolor{comment}{ *}
04190 \textcolor{comment}{ * We supply the current cache hit rate on request, so we must keep a}
04191 \textcolor{comment}{ * simple cache hit rate computation regardless of whether statistics}
04192 \textcolor{comment}{ * collection is enabled.  The following fields support this capability.}
04193 \textcolor{comment}{ *}
04194 \textcolor{comment}{ * cache\_hits: Number of cache hits since the last time the cache hit}
04195 \textcolor{comment}{ *  rate statistics were reset.  Note that when automatic cache}
04196 \textcolor{comment}{ *  re-sizing is enabled, this field will be reset every automatic}
04197 \textcolor{comment}{ *  resize epoch.}
04198 \textcolor{comment}{ *}
04199 \textcolor{comment}{ * cache\_accesses: Number of times the cache has been accessed while}
04200 \textcolor{comment}{ *  since the last since the last time the cache hit rate statistics}
04201 \textcolor{comment}{ *  were reset.  Note that when automatic cache re-sizing is enabled,}
04202 \textcolor{comment}{ *  this field will be reset every automatic resize epoch.}
04203 \textcolor{comment}{ *}
04204 \textcolor{comment}{ *}
04205 \textcolor{comment}{ * Metadata cache image management related fields.}
04206 \textcolor{comment}{ *}
04207 \textcolor{comment}{ * image\_ctl:   Instance of H5C\_cache\_image\_ctl\_t containing configuration}
04208 \textcolor{comment}{ *      data for generation of a cache image on file close.}
04209 \textcolor{comment}{ *}
04210 \textcolor{comment}{ * serialization\_in\_progress:  Boolean field that is set to TRUE iff}
04211 \textcolor{comment}{ *      the cache is in the process of being serialized.  This }
04212 \textcolor{comment}{ *      field is needed to support the H5C\_serialization\_in\_progress()}
04213 \textcolor{comment}{ *      call, which is in turn required for sanity checks in some}
04214 \textcolor{comment}{ *      cache clients.}
04215 \textcolor{comment}{ *}
04216 \textcolor{comment}{ * load\_image:  Boolean flag indicating that the metadata cache image }
04217 \textcolor{comment}{ *      superblock extension message exists and should be }
04218 \textcolor{comment}{ *      read, and the image block read and decoded on the next}
04219 \textcolor{comment}{ *      call to H5C\_protect().  }
04220 \textcolor{comment}{ *}
04221 \textcolor{comment}{ * image\_loaded:  Boolean flag indicating that the metadata cache has }
04222 \textcolor{comment}{ *              loaded the metadata cache image as directed by the }
04223 \textcolor{comment}{ *              MDC cache image superblock extension message.}
04224 \textcolor{comment}{ *}
04225 \textcolor{comment}{ * delete\_image: Boolean flag indicating whether the metadata cache image}
04226 \textcolor{comment}{ *      superblock message should be deleted and the cache image}
04227 \textcolor{comment}{ *      file space freed after they have been read and decoded.}
04228 \textcolor{comment}{ *}
04229 \textcolor{comment}{ *      This flag should be set to TRUE iff the file is opened }
04230 \textcolor{comment}{ *      R/W and there is a cache image to be read.}
04231 \textcolor{comment}{ *}
04232 \textcolor{comment}{ * image\_addr:  haddr\_t containing the base address of the on disk }
04233 \textcolor{comment}{ *      metadata cache image, or HADDR\_UNDEF if that value is }
04234 \textcolor{comment}{ *      undefined.  Note that this field is used both in the }
04235 \textcolor{comment}{ *      construction and write, and the read and decode of }
04236 \textcolor{comment}{ *      metadata cache image blocks.}
04237 \textcolor{comment}{ *}
04238 \textcolor{comment}{ * image\_len:   hsize\_t containing the size of the on disk metadata cache }
04239 \textcolor{comment}{ *      image, or zero if that value is undefined.  Note that this }
04240 \textcolor{comment}{ *      field is used both in the construction and write, and the }
04241 \textcolor{comment}{ *      read and decode of metadata cache image blocks.}
04242 \textcolor{comment}{ *}
04243 \textcolor{comment}{ * image\_data\_len:  size\_t containing the number of bytes of data in the }
04244 \textcolor{comment}{ *      on disk metadata cache image, or zero if that value is }
04245 \textcolor{comment}{ *      undefined.}
04246 \textcolor{comment}{ *}
04247 \textcolor{comment}{ *      In most cases, this value is the same as the image\_len}
04248 \textcolor{comment}{ *      above.  It exists to allow for metadata cache image blocks}
04249 \textcolor{comment}{ *      that are larger than the actual image.  Thus in all }
04250 \textcolor{comment}{ *      cases image\_data\_len <= image\_len.}
04251 \textcolor{comment}{ *}
04252 \textcolor{comment}{ * To create the metadata cache image, we must first serialize all the}
04253 \textcolor{comment}{ * entries in the metadata cache.  This is done by a scan of the index.}
04254 \textcolor{comment}{ * As entries must be serialized in increasing flush dependency height}
04255 \textcolor{comment}{ * order, we scan the index repeatedly, once for each flush dependency}
04256 \textcolor{comment}{ * height in increasing order.}
04257 \textcolor{comment}{ *}
04258 \textcolor{comment}{ * This operation is complicated by the fact that entries other the the}
04259 \textcolor{comment}{ * target may be inserted, loaded, relocated, or removed from the cache }
04260 \textcolor{comment}{ * (either by eviction or the take ownership flag) as the result of a }
04261 \textcolor{comment}{ * pre\_serialize or serialize callback.  While entry removals are not }
04262 \textcolor{comment}{ * a problem for the scan of the index, insertions, loads, and relocations}
04263 \textcolor{comment}{ * are.  Hence the entries loaded, inserted, and relocated counters }
04264 \textcolor{comment}{ * listed below have been implemented to allow these conditions to be }
04265 \textcolor{comment}{ * detected and dealt with by restarting the scan.}
04266 \textcolor{comment}{ *}
04267 \textcolor{comment}{ * The serialization operation is further complicated by the fact that }
04268 \textcolor{comment}{ * the flush dependency height of a given entry may increase (as the }
04269 \textcolor{comment}{ * result of an entry load or insert) or decrease (as the result of an }
04270 \textcolor{comment}{ * entry removal -- via either eviction or the take ownership flag).  The}
04271 \textcolor{comment}{ * entry\_fd\_height\_change\_counter field is maintained to allow detection}
04272 \textcolor{comment}{ * of this condition, and a restart of the scan when it occurs.}
04273 \textcolor{comment}{ *}
04274 \textcolor{comment}{ * Note that all these new fields would work just as well as booleans.}
04275 \textcolor{comment}{ *}
04276 \textcolor{comment}{ * entries\_loaded\_counter: Number of entries loaded into the cache }
04277 \textcolor{comment}{ *      since the last time this field was reset.}
04278 \textcolor{comment}{ *}
04279 \textcolor{comment}{ * entries\_inserted\_counter: Number of entries inserted into the cache }
04280 \textcolor{comment}{ *      since the last time this field was reset.}
04281 \textcolor{comment}{ *}
04282 \textcolor{comment}{ * entries relocated\_counter: Number of entries whose base address has}
04283 \textcolor{comment}{ *      been changed since the last time this field was reset.}
04284 \textcolor{comment}{ *}
04285 \textcolor{comment}{ * entry\_fd\_height\_change\_counter: Number of entries whose flush dependency}
04286 \textcolor{comment}{ *      height has changed since the last time this field was reset.}
04287 \textcolor{comment}{ *}
04288 \textcolor{comment}{ * The following fields are used assemble the cache image prior to }
04289 \textcolor{comment}{ * writing it to disk.}
04290 \textcolor{comment}{ *}
04291 \textcolor{comment}{ * num\_entries\_in\_image: Unsigned integer field containing the number of entries}
04292 \textcolor{comment}{ *      to be copied into the metadata cache image.  Note that }
04293 \textcolor{comment}{ *      this value will be less than the number of entries in }
04294 \textcolor{comment}{ *      the cache, and the superblock and its related entries }
04295 \textcolor{comment}{ *      are not written to the metadata cache image.}
04296 \textcolor{comment}{ *}
04297 \textcolor{comment}{ * image\_entries: Pointer to a dynamically allocated array of instance of}
04298 \textcolor{comment}{ *      H5C\_image\_entry\_t of length num\_entries\_in\_image, or NULL}
04299 \textcolor{comment}{ *      if that array does not exist.  This array is used to}
04300 \textcolor{comment}{ *      assemble entry data to be included in the image, and to }
04301 \textcolor{comment}{ *      sort them by flush dependency height and LRU rank.}
04302 \textcolor{comment}{ * }
04303 \textcolor{comment}{ * image\_buffer: Pointer to the dynamically allocated buffer of length}
04304 \textcolor{comment}{ *      image\_len in which the metadata cache image is assembled, }
04305 \textcolor{comment}{ *      or NULL if that buffer does not exist.}
04306 \textcolor{comment}{ *}
04307 \textcolor{comment}{ *}
04308 \textcolor{comment}{ * Free Space Manager Related fields:}
04309 \textcolor{comment}{ *}
04310 \textcolor{comment}{ * The free space managers must be informed when we are about to close }
04311 \textcolor{comment}{ * or flush the file so that they order themselves accordingly.  This used}
04312 \textcolor{comment}{ * to be done much later in the close process, but with cache image and }
04313 \textcolor{comment}{ * page buffering, this is no longer viable, as we must finalize the on }
04314 \textcolor{comment}{ * disk image of all metadata much sooner.}
04315 \textcolor{comment}{ *}
04316 \textcolor{comment}{ * This is handled by the H5MF\_settle\_raw\_data\_fsm() and}
04317 \textcolor{comment}{ * H5MF\_settle\_meta\_data\_FSM() routines.  As these calls are expensive,}
04318 \textcolor{comment}{ * the following fields are used to track whether the target free space}
04319 \textcolor{comment}{ * managers are clean.}
04320 \textcolor{comment}{ *}
04321 \textcolor{comment}{ * They are also used in sanity checking, as once a free space manager is}
04322 \textcolor{comment}{ * settled, it should not become unsettled (i.e. be asked to allocate or}
04323 \textcolor{comment}{ * free file space) either ever (in the case of a file close) or until the}
04324 \textcolor{comment}{ * flush is complete.}
04325 \textcolor{comment}{ *}
04326 \textcolor{comment}{ * rdfsm\_settled:  Boolean flag indicating whether the raw data free space}
04327 \textcolor{comment}{ *      manager is settled -- i.e. whether the correct space has }
04328 \textcolor{comment}{ *      been allocated for it in the file.}
04329 \textcolor{comment}{ *}
04330 \textcolor{comment}{ *      Note that the name of this field is deceptive.  In the }
04331 \textcolor{comment}{ *      multi file case, the flag applies to all free space }
04332 \textcolor{comment}{ *      managers that are not involved in allocating space for}
04333 \textcolor{comment}{ *      free space manager metadata.}
04334 \textcolor{comment}{ *}
04335 \textcolor{comment}{ * mdfsm\_settled:  Boolean flag indicating whether the meta data free space}
04336 \textcolor{comment}{ *              manager is settled -- i.e. whether the correct space has}
04337 \textcolor{comment}{ *              been allocated for it in the file.}
04338 \textcolor{comment}{ *}
04339 \textcolor{comment}{ *              Note that the name of this field is deceptive.  In the }
04340 \textcolor{comment}{ *              multi file case, the flag applies only to free space }
04341 \textcolor{comment}{ *      managers that are involved in allocating space for free }
04342 \textcolor{comment}{ *      space managers.}
04343 \textcolor{comment}{ *}
04344 \textcolor{comment}{ *}
04345 \textcolor{comment}{ * Statistics collection fields:}
04346 \textcolor{comment}{ *}
04347 \textcolor{comment}{ * When enabled, these fields are used to collect statistics as described}
04348 \textcolor{comment}{ * below.  The first set are collected only when H5C\_COLLECT\_CACHE\_STATS}
04349 \textcolor{comment}{ * is true.}
04350 \textcolor{comment}{ *}
04351 \textcolor{comment}{ * hits:        Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The cells}
04352 \textcolor{comment}{ *      are used to record the number of times an entry with type id}
04353 \textcolor{comment}{ *      equal to the array index has been in cache when requested in}
04354 \textcolor{comment}{ *      the current epoch.}
04355 \textcolor{comment}{ *}
04356 \textcolor{comment}{ * misses:      Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The cells}
04357 \textcolor{comment}{ *      are used to record the number of times an entry with type id}
04358 \textcolor{comment}{ *      equal to the array index has not been in cache when}
04359 \textcolor{comment}{ *      requested in the current epoch.}
04360 \textcolor{comment}{ *}
04361 \textcolor{comment}{ * write\_protects:  Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The}
04362 \textcolor{comment}{ *      cells are used to record the number of times an entry with}
04363 \textcolor{comment}{ *      type id equal to the array index has been write protected}
04364 \textcolor{comment}{ *      in the current epoch.}
04365 \textcolor{comment}{ *}
04366 \textcolor{comment}{ *      Observe that (hits + misses) = (write\_protects + read\_protects).}
04367 \textcolor{comment}{ *}
04368 \textcolor{comment}{ * read\_protects: Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The}
04369 \textcolor{comment}{ *      cells are used to record the number of times an entry with}
04370 \textcolor{comment}{ *      type id equal to the array index has been read protected in}
04371 \textcolor{comment}{ *      the current epoch.}
04372 \textcolor{comment}{ *}
04373 \textcolor{comment}{ *              Observe that (hits + misses) = (write\_protects + read\_protects).}
04374 \textcolor{comment}{ *}
04375 \textcolor{comment}{ * max\_read\_protects:  Array of int32 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.}
04376 \textcolor{comment}{ *      The cells are used to maximum number of simultaneous read}
04377 \textcolor{comment}{ *      protects on any entry with type id equal to the array index}
04378 \textcolor{comment}{ *      in the current epoch.}
04379 \textcolor{comment}{ *}
04380 \textcolor{comment}{ * insertions:  Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The cells}
04381 \textcolor{comment}{ *      are used to record the number of times an entry with type}
04382 \textcolor{comment}{ *      id equal to the array index has been inserted into the}
04383 \textcolor{comment}{ *      cache in the current epoch.}
04384 \textcolor{comment}{ *}
04385 \textcolor{comment}{ * pinned\_insertions:  Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1. }
04386 \textcolor{comment}{ *      The cells are used to record the number of times an entry}
04387 \textcolor{comment}{ *      with type id equal to the array index has been inserted}
04388 \textcolor{comment}{ *      pinned into the cache in the current epoch.}
04389 \textcolor{comment}{ *}
04390 \textcolor{comment}{ * clears:      Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The cells}
04391 \textcolor{comment}{ *      are used to record the number of times a dirty entry with type}
04392 \textcolor{comment}{ *      id equal to the array index has been cleared in the current}
04393 \textcolor{comment}{ *      epoch.}
04394 \textcolor{comment}{ *}
04395 \textcolor{comment}{ * flushes:     Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The cells}
04396 \textcolor{comment}{ *      are used to record the number of times an entry with type id}
04397 \textcolor{comment}{ *      equal to the array index has been written to disk in the}
04398 \textcolor{comment}{ *              current epoch.}
04399 \textcolor{comment}{ *}
04400 \textcolor{comment}{ * evictions:   Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The cells}
04401 \textcolor{comment}{ *      are used to record the number of times an entry with type id}
04402 \textcolor{comment}{ *      equal to the array index has been evicted from the cache in}
04403 \textcolor{comment}{ *      the current epoch.}
04404 \textcolor{comment}{ *}
04405 \textcolor{comment}{ * take\_ownerships: Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The }
04406 \textcolor{comment}{ *      cells are used to record the number of times an entry with }
04407 \textcolor{comment}{ *      type id equal to the array index has been removed from the }
04408 \textcolor{comment}{ *      cache via the H5C\_\_TAKE\_OWNERSHIP\_FLAG in the current epoch.}
04409 \textcolor{comment}{ *}
04410 \textcolor{comment}{ * moves:       Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The cells}
04411 \textcolor{comment}{ *      are used to record the number of times an entry with type}
04412 \textcolor{comment}{ *      id equal to the array index has been moved in the current}
04413 \textcolor{comment}{ *      epoch.}
04414 \textcolor{comment}{ *}
04415 \textcolor{comment}{ * entry\_flush\_moves: Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1. }
04416 \textcolor{comment}{ *      The cells are used to record the number of times an entry}
04417 \textcolor{comment}{ *      with type id equal to the array index has been moved}
04418 \textcolor{comment}{ *      during its pre-serialize callback in the current epoch.}
04419 \textcolor{comment}{ *}
04420 \textcolor{comment}{ * cache\_flush\_moves: Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1. }
04421 \textcolor{comment}{ *      The cells are used to record the number of times an entry}
04422 \textcolor{comment}{ *      with type id equal to the array index has been moved}
04423 \textcolor{comment}{ *      during a cache flush in the current epoch.}
04424 \textcolor{comment}{ *}
04425 \textcolor{comment}{ * pins:        Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The cells}
04426 \textcolor{comment}{ *      are used to record the number of times an entry with type}
04427 \textcolor{comment}{ *      id equal to the array index has been pinned in the current}
04428 \textcolor{comment}{ *      epoch.}
04429 \textcolor{comment}{ *}
04430 \textcolor{comment}{ * unpins:      Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The cells}
04431 \textcolor{comment}{ *      are used to record the number of times an entry with type}
04432 \textcolor{comment}{ *      id equal to the array index has been unpinned in the current}
04433 \textcolor{comment}{ *      epoch.}
04434 \textcolor{comment}{ *}
04435 \textcolor{comment}{ * dirty\_pins:  Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The cells}
04436 \textcolor{comment}{ *      are used to record the number of times an entry with type}
04437 \textcolor{comment}{ *      id equal to the array index has been marked dirty while pinned}
04438 \textcolor{comment}{ *      in the current epoch.}
04439 \textcolor{comment}{ *}
04440 \textcolor{comment}{ * pinned\_flushes:  Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The}
04441 \textcolor{comment}{ *      cells are used to record the number of times an  entry}
04442 \textcolor{comment}{ *      with type id equal to the array index has been flushed while}
04443 \textcolor{comment}{ *      pinned in the current epoch.}
04444 \textcolor{comment}{ *}
04445 \textcolor{comment}{ * pinned\_clears:  Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The}
04446 \textcolor{comment}{ *      cells are used to record the number of times an  entry}
04447 \textcolor{comment}{ *      with type id equal to the array index has been cleared while}
04448 \textcolor{comment}{ *      pinned in the current epoch.}
04449 \textcolor{comment}{ *}
04450 \textcolor{comment}{ * size\_increases:  Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.}
04451 \textcolor{comment}{ *      The cells are used to record the number of times an entry}
04452 \textcolor{comment}{ *      with type id equal to the array index has increased in}
04453 \textcolor{comment}{ *      size in the current epoch.}
04454 \textcolor{comment}{ *}
04455 \textcolor{comment}{ * size\_decreases:  Array of int64 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.}
04456 \textcolor{comment}{ *      The cells are used to record the number of times an entry}
04457 \textcolor{comment}{ *      with type id equal to the array index has decreased in}
04458 \textcolor{comment}{ *      size in the current epoch.}
04459 \textcolor{comment}{ *}
04460 \textcolor{comment}{ * entry\_flush\_size\_changes:  Array of int64 of length}
04461 \textcolor{comment}{ *      H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The cells are used to record}
04462 \textcolor{comment}{ *      the number of times an entry with type id equal to the}
04463 \textcolor{comment}{ *      array index has changed size while in its pre-serialize }
04464 \textcolor{comment}{ *      callback.}
04465 \textcolor{comment}{ *}
04466 \textcolor{comment}{ * cache\_flush\_size\_changes:  Array of int64 of length}
04467 \textcolor{comment}{ *      H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The cells are used to record}
04468 \textcolor{comment}{ *      the number of times an entry with type id equal to the}
04469 \textcolor{comment}{ *      array index has changed size during a cache flush}
04470 \textcolor{comment}{ *}
04471 \textcolor{comment}{ * total\_ht\_insertions: Number of times entries have been inserted into the}
04472 \textcolor{comment}{ *      hash table in the current epoch.}
04473 \textcolor{comment}{ *}
04474 \textcolor{comment}{ * total\_ht\_deletions: Number of times entries have been deleted from the}
04475 \textcolor{comment}{ *              hash table in the current epoch.}
04476 \textcolor{comment}{ *}
04477 \textcolor{comment}{ * successful\_ht\_searches: int64 containing the total number of successful}
04478 \textcolor{comment}{ *      searches of the hash table in the current epoch.}
04479 \textcolor{comment}{ *}
04480 \textcolor{comment}{ * total\_successful\_ht\_search\_depth: int64 containing the total number of}
04481 \textcolor{comment}{ *      entries other than the targets examined in successful}
04482 \textcolor{comment}{ *      searches of the hash table in the current epoch.}
04483 \textcolor{comment}{ *}
04484 \textcolor{comment}{ * failed\_ht\_searches: int64 containing the total number of unsuccessful}
04485 \textcolor{comment}{ *              searches of the hash table in the current epoch.}
04486 \textcolor{comment}{ *}
04487 \textcolor{comment}{ * total\_failed\_ht\_search\_depth: int64 containing the total number of}
04488 \textcolor{comment}{ *              entries examined in unsuccessful searches of the hash}
04489 \textcolor{comment}{ *      table in the current epoch.}
04490 \textcolor{comment}{ *}
04491 \textcolor{comment}{ * max\_index\_len:  Largest value attained by the index\_len field in the}
04492 \textcolor{comment}{ *              current epoch.}
04493 \textcolor{comment}{ *}
04494 \textcolor{comment}{ * max\_index\_size:  Largest value attained by the index\_size field in the}
04495 \textcolor{comment}{ *              current epoch.}
04496 \textcolor{comment}{ *}
04497 \textcolor{comment}{ * max\_clean\_index\_size: Largest value attained by the clean\_index\_size field}
04498 \textcolor{comment}{ *      in the current epoch.}
04499 \textcolor{comment}{ *}
04500 \textcolor{comment}{ * max\_dirty\_index\_size: Largest value attained by the dirty\_index\_size field}
04501 \textcolor{comment}{ *      in the current epoch.}
04502 \textcolor{comment}{ *}
04503 \textcolor{comment}{ * max\_slist\_len:  Largest value attained by the slist\_len field in the}
04504 \textcolor{comment}{ *              current epoch.}
04505 \textcolor{comment}{ *}
04506 \textcolor{comment}{ * max\_slist\_size:  Largest value attained by the slist\_size field in the}
04507 \textcolor{comment}{ *              current epoch.}
04508 \textcolor{comment}{ *}
04509 \textcolor{comment}{ * max\_pl\_len:  Largest value attained by the pl\_len field in the}
04510 \textcolor{comment}{ *              current epoch.}
04511 \textcolor{comment}{ *}
04512 \textcolor{comment}{ * max\_pl\_size: Largest value attained by the pl\_size field in the}
04513 \textcolor{comment}{ *              current epoch.}
04514 \textcolor{comment}{ *}
04515 \textcolor{comment}{ * max\_pel\_len: Largest value attained by the pel\_len field in the}
04516 \textcolor{comment}{ *              current epoch.}
04517 \textcolor{comment}{ *}
04518 \textcolor{comment}{ * max\_pel\_size: Largest value attained by the pel\_size field in the}
04519 \textcolor{comment}{ *              current epoch.}
04520 \textcolor{comment}{ *}
04521 \textcolor{comment}{ * calls\_to\_msic: Total number of calls to H5C\_\_make\_space\_in\_cache}
04522 \textcolor{comment}{ *}
04523 \textcolor{comment}{ * total\_entries\_skipped\_in\_msic: Number of clean entries skipped while}
04524 \textcolor{comment}{ *              enforcing the min\_clean\_fraction in H5C\_\_make\_space\_in\_cache().}
04525 \textcolor{comment}{ *}
04526 \textcolor{comment}{ * total\_dirty\_pf\_entries\_skipped\_in\_msic: Number of dirty prefetched entries}
04527 \textcolor{comment}{ *              skipped in H5C\_\_make\_space\_in\_cache().  Note that this can }
04528 \textcolor{comment}{ *              only occur when a file is opened R/O with a cache image}
04529 \textcolor{comment}{ *              containing dirty entries.}
04530 \textcolor{comment}{ *}
04531 \textcolor{comment}{ * total\_entries\_scanned\_in\_msic: Number of clean entries skipped while}
04532 \textcolor{comment}{ *              enforcing the min\_clean\_fraction in H5C\_\_make\_space\_in\_cache().}
04533 \textcolor{comment}{ *}
04534 \textcolor{comment}{ * max\_entries\_skipped\_in\_msic: Maximum number of clean entries skipped}
04535 \textcolor{comment}{ *              in any one call to H5C\_\_make\_space\_in\_cache().}
04536 \textcolor{comment}{ *}
04537 \textcolor{comment}{ * max\_dirty\_pf\_entries\_skipped\_in\_msic: Maximum number of dirty prefetched}
04538 \textcolor{comment}{ *              entries skipped in any one call to H5C\_\_make\_space\_in\_cache().}
04539 \textcolor{comment}{ *              Note that this can only occur when the file is opened }
04540 \textcolor{comment}{ *              R/O with a cache image containing dirty entries.}
04541 \textcolor{comment}{ *}
04542 \textcolor{comment}{ * max\_entries\_scanned\_in\_msic: Maximum number of entries scanned over}
04543 \textcolor{comment}{ *              in any one call to H5C\_\_make\_space\_in\_cache().}
04544 \textcolor{comment}{ *}
04545 \textcolor{comment}{ * entries\_scanned\_to\_make\_space: Number of entries scanned only when looking}
04546 \textcolor{comment}{ *              for entries to evict in order to make space in cache.}
04547 \textcolor{comment}{ *}
04548 \textcolor{comment}{ *}
04549 \textcolor{comment}{ * The following fields track statistics on cache images.  }
04550 \textcolor{comment}{ *}
04551 \textcolor{comment}{ * images\_created:  Integer field containing the number of cache images}
04552 \textcolor{comment}{ *      created since the last time statistics were reset.  }
04553 \textcolor{comment}{ *}
04554 \textcolor{comment}{ *      At present, this field must always be either 0 or 1.}
04555 \textcolor{comment}{ *      Further, since cache images are only created at file }
04556 \textcolor{comment}{ *      close, this field should only be set at that time.}
04557 \textcolor{comment}{ *}
04558 \textcolor{comment}{ * images\_read: Integer field containing the number of cache images }
04559 \textcolor{comment}{ *              read from file.  Note that reading an image is different}
04560 \textcolor{comment}{ *              from loading it -- reading the image means just that,}
04561 \textcolor{comment}{ *              while loading the image refers to decoding it and loading}
04562 \textcolor{comment}{ *              it into the metadata cache.}
04563 \textcolor{comment}{ *}
04564 \textcolor{comment}{ *              In the serial case, image\_read should always equal }
04565 \textcolor{comment}{ *              images\_loaded.  However, in the parallel case, the }
04566 \textcolor{comment}{ *              image should only be read by process 0.  All other }
04567 \textcolor{comment}{ *              processes should receive the cache image via a broadcast}
04568 \textcolor{comment}{ *              from process 0.}
04569 \textcolor{comment}{ *}
04570 \textcolor{comment}{ * images\_loaded:  Integer field containing the number of cache images}
04571 \textcolor{comment}{ *      loaded since the last time statistics were reset.}
04572 \textcolor{comment}{ *}
04573 \textcolor{comment}{ *      At present, this field must always be either 0 or 1.}
04574 \textcolor{comment}{ *      Further, since cache images are only loaded at the }
04575 \textcolor{comment}{ *      time of the first protect or on file close, this value}
04576 \textcolor{comment}{ *      should only change on those events.}
04577 \textcolor{comment}{ *}
04578 \textcolor{comment}{ * last\_image\_size:  Size of the most recently loaded metadata cache image}
04579 \textcolor{comment}{ *             loaded into the cache, or zero if no image has been}
04580 \textcolor{comment}{ *             loaded.  }
04581 \textcolor{comment}{ *}
04582 \textcolor{comment}{ *             At present, at most one cache image can be loaded into }
04583 \textcolor{comment}{ *             the metadata cache for any given file, and this image}
04584 \textcolor{comment}{ *             will be loaded either on the first protect, or on file}
04585 \textcolor{comment}{ *             close if no entry is protected before then.}
04586 \textcolor{comment}{ *}
04587 \textcolor{comment}{ *}
04588 \textcolor{comment}{ * Fields for tracking prefetched entries.  Note that flushes and evictions}
04589 \textcolor{comment}{ * of prefetched entries are tracked in the flushes and evictions arrays }
04590 \textcolor{comment}{ * discused above.}
04591 \textcolor{comment}{ *}
04592 \textcolor{comment}{ * prefetches:  Number of prefetched entries that are loaded to the }
04593 \textcolor{comment}{ *      cache.}
04594 \textcolor{comment}{ *}
04595 \textcolor{comment}{ * dirty\_prefetches:  Number of dirty prefetched entries that are loaded}
04596 \textcolor{comment}{ *      into the cache.}
04597 \textcolor{comment}{ *}
04598 \textcolor{comment}{ * prefetch\_hits:  Number of prefetched entries that are actually used.}
04599 \textcolor{comment}{ *}
04600 \textcolor{comment}{ * }
04601 \textcolor{comment}{ * As entries are now capable of moving, loading, dirtying, and deleting }
04602 \textcolor{comment}{ * other entries in their pre\_serialize and serialize callbacks, it has }
04603 \textcolor{comment}{ * been necessary to insert code to restart scans of lists so as to avoid }
04604 \textcolor{comment}{ * improper behavior if the next entry in the list is the target of one on }
04605 \textcolor{comment}{ * these operations.}
04606 \textcolor{comment}{ *}
04607 \textcolor{comment}{ * The following fields are use to count such occurances.  They are used }
04608 \textcolor{comment}{ * both in tests (to verify that the scan has been restarted), and to }
04609 \textcolor{comment}{ * obtain estimates of how frequently these restarts occur.}
04610 \textcolor{comment}{ *}
04611 \textcolor{comment}{ * slist\_scan\_restarts: Number of times a scan of the slist (that contains}
04612 \textcolor{comment}{ *      calls to H5C\_\_flush\_single\_entry()) has been restarted to }
04613 \textcolor{comment}{ *      avoid potential issues with change of status of the next }
04614 \textcolor{comment}{ *      entry in the scan.}
04615 \textcolor{comment}{ *}
04616 \textcolor{comment}{ * LRU\_scan\_restarts: Number of times a scan of the LRU list (that contains}
04617 \textcolor{comment}{ *              calls to H5C\_\_flush\_single\_entry()) has been restarted to }
04618 \textcolor{comment}{ *              avoid potential issues with change of status of the next }
04619 \textcolor{comment}{ *              entry in the scan.}
04620 \textcolor{comment}{ *}
04621 \textcolor{comment}{ * index\_scan\_restarts: Number of times a scan of the index has been }
04622 \textcolor{comment}{ *      restarted to avoid potential issues with load, insertion}
04623 \textcolor{comment}{ *      or change in flush dependency height of an entry other }
04624 \textcolor{comment}{ *      than the target entry as the result of call(s) to the}
04625 \textcolor{comment}{ *      pre\_serialize or serialize callbacks.}
04626 \textcolor{comment}{ *}
04627 \textcolor{comment}{ *      Note that at present, this condition can only be triggerd}
04628 \textcolor{comment}{ *      by a call to H5C\_serialize\_single\_entry().}
04629 \textcolor{comment}{ *}
04630 \textcolor{comment}{ * The remaining stats are collected only when both H5C\_COLLECT\_CACHE\_STATS}
04631 \textcolor{comment}{ * and H5C\_COLLECT\_CACHE\_ENTRY\_STATS are true.}
04632 \textcolor{comment}{ *}
04633 \textcolor{comment}{ * max\_accesses: Array of int32 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The cells}
04634 \textcolor{comment}{ *      are used to record the maximum number of times any single}
04635 \textcolor{comment}{ *      entry with type id equal to the array index has been}
04636 \textcolor{comment}{ *      accessed in the current epoch.}
04637 \textcolor{comment}{ *}
04638 \textcolor{comment}{ * min\_accesses: Array of int32 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The cells}
04639 \textcolor{comment}{ *      are used to record the minimum number of times any single}
04640 \textcolor{comment}{ *      entry with type id equal to the array index has been}
04641 \textcolor{comment}{ *      accessed in the current epoch.}
04642 \textcolor{comment}{ *}
04643 \textcolor{comment}{ * max\_clears:  Array of int32 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The cells}
04644 \textcolor{comment}{ *      are used to record the maximum number of times any single}
04645 \textcolor{comment}{ *      entry with type id equal to the array index has been cleared}
04646 \textcolor{comment}{ *      in the current epoch.}
04647 \textcolor{comment}{ *}
04648 \textcolor{comment}{ * max\_flushes: Array of int32 of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The cells}
04649 \textcolor{comment}{ *      are used to record the maximum number of times any single}
04650 \textcolor{comment}{ *      entry with type id equal to the array index has been}
04651 \textcolor{comment}{ *      flushed in the current epoch.}
04652 \textcolor{comment}{ *}
04653 \textcolor{comment}{ * max\_size:    Array of size\_t of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The cells}
04654 \textcolor{comment}{ *              are used to record the maximum size of any single entry}
04655 \textcolor{comment}{ *      with type id equal to the array index that has resided in}
04656 \textcolor{comment}{ *      the cache in the current epoch.}
04657 \textcolor{comment}{ *}
04658 \textcolor{comment}{ * max\_pins:    Array of size\_t of length H5C\_\_MAX\_NUM\_TYPE\_IDS + 1.  The cells}
04659 \textcolor{comment}{ *              are used to record the maximum number of times that any single}
04660 \textcolor{comment}{ *              entry with type id equal to the array index that has been}
04661 \textcolor{comment}{ *              marked as pinned in the cache in the current epoch.}
04662 \textcolor{comment}{ *}
04663 \textcolor{comment}{ *}
04664 \textcolor{comment}{ * Fields supporting testing:}
04665 \textcolor{comment}{ *}
04666 \textcolor{comment}{ * prefix   Array of char used to prefix debugging output.  The}
04667 \textcolor{comment}{ *      field is intended to allow marking of output of with}
04668 \textcolor{comment}{ *      the processes mpi rank.}
04669 \textcolor{comment}{ *}
04670 \textcolor{comment}{ * get\_entry\_ptr\_from\_addr\_counter: Counter used to track the number of}
04671 \textcolor{comment}{ *              times the H5C\_get\_entry\_ptr\_from\_addr() function has been}
04672 \textcolor{comment}{ *              called successfully.  This field is only defined when}
04673 \textcolor{comment}{ *              NDEBUG is not #defined.}
04674 \textcolor{comment}{ *}
04675 \textcolor{comment}{ ****************************************************************************/}
\Hypertarget{_h_d_f5_21_810_81_2include_2_h5_cpkg_8h_source_l04676}\hyperlink{struct_h5_c__t}{04676} \textcolor{keyword}{struct }\hyperlink{struct_h5_c__t}{H5C\_t} \{
04677     uint32\_t            magic;
04678     hbool\_t         flush\_in\_progress;
04679     FILE *          trace\_file\_ptr;
04680     hbool\_t                     logging\_enabled;
04681     hbool\_t                     currently\_logging;
04682     FILE *          log\_file\_ptr;
04683     \textcolor{keywordtype}{void} *          aux\_ptr;
04684     int32\_t         max\_type\_id;
04685     \textcolor{keyword}{const} H5C\_class\_t * \textcolor{keyword}{const}   *class\_table\_ptr;
04686     \textcolor{keywordtype}{size\_t}                      max\_cache\_size;
04687     \textcolor{keywordtype}{size\_t}                      min\_clean\_size;
04688     H5C\_write\_permitted\_func\_t  check\_write\_permitted;
04689     hbool\_t         write\_permitted;
04690     H5C\_log\_flush\_func\_t    log\_flush;
04691     hbool\_t         evictions\_enabled;
04692     hbool\_t         close\_warning\_received;
04693 
04694     \textcolor{comment}{/* Fields for maintaining [hash table] index of entries */}
04695     uint32\_t                    index\_len;
04696     \textcolor{keywordtype}{size\_t}                      index\_size;
04697     uint32\_t            index\_ring\_len[H5C\_RING\_NTYPES];
04698     \textcolor{keywordtype}{size\_t}          index\_ring\_size[H5C\_RING\_NTYPES];
04699     \textcolor{keywordtype}{size\_t}          clean\_index\_size;
04700     \textcolor{keywordtype}{size\_t}          clean\_index\_ring\_size[H5C\_RING\_NTYPES];
04701     \textcolor{keywordtype}{size\_t}          dirty\_index\_size;
04702     \textcolor{keywordtype}{size\_t}          dirty\_index\_ring\_size[H5C\_RING\_NTYPES];
04703     H5C\_cache\_entry\_t *         index[H5C\_\_HASH\_TABLE\_LEN];
04704     uint32\_t                    il\_len;
04705     \textcolor{keywordtype}{size\_t}                      il\_size;
04706     H5C\_cache\_entry\_t *         il\_head;
04707     H5C\_cache\_entry\_t *         il\_tail;
04708 
04709     \textcolor{comment}{/* Fields to detect entries removed during scans */}
04710     int64\_t         entries\_removed\_counter;
04711     H5C\_cache\_entry\_t *     last\_entry\_removed\_ptr;
04712     H5C\_cache\_entry\_t *     entry\_watched\_for\_removal;
04713 
04714     \textcolor{comment}{/* Fields for maintaining list of in-order entries, for flushing */}
04715     hbool\_t         slist\_changed;
04716     uint32\_t                    slist\_len;
04717     \textcolor{keywordtype}{size\_t}                      slist\_size;
04718     uint32\_t            slist\_ring\_len[H5C\_RING\_NTYPES];
04719     \textcolor{keywordtype}{size\_t}          slist\_ring\_size[H5C\_RING\_NTYPES];
04720     H5SL\_t *                    slist\_ptr;
04721     uint32\_t                    num\_last\_entries;
04722 \textcolor{preprocessor}{#if H5C\_DO\_SANITY\_CHECKS}
04723     int32\_t         slist\_len\_increase;
04724     ssize\_t         slist\_size\_increase;
04725 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_DO\_SANITY\_CHECKS */}\textcolor{preprocessor}{}
04726 
04727     \textcolor{comment}{/* Fields for maintaining list of tagged entries */}
04728     H5SL\_t *                    tag\_list;
04729     hbool\_t                     ignore\_tags;
04730 
04731     \textcolor{comment}{/* Fields for tracking protected entries */}
04732     uint32\_t                    pl\_len;
04733     \textcolor{keywordtype}{size\_t}                      pl\_size;
04734     H5C\_cache\_entry\_t *         pl\_head\_ptr;
04735     H5C\_cache\_entry\_t *     pl\_tail\_ptr;
04736 
04737     \textcolor{comment}{/* Fields for tracking pinned entries */}
04738     uint32\_t                    pel\_len;
04739     \textcolor{keywordtype}{size\_t}                      pel\_size;
04740     H5C\_cache\_entry\_t *         pel\_head\_ptr;
04741     H5C\_cache\_entry\_t *     pel\_tail\_ptr;
04742 
04743     \textcolor{comment}{/* Fields for complete LRU list of entries */}
04744     uint32\_t                    LRU\_list\_len;
04745     \textcolor{keywordtype}{size\_t}                      LRU\_list\_size;
04746     H5C\_cache\_entry\_t *     LRU\_head\_ptr;
04747     H5C\_cache\_entry\_t *     LRU\_tail\_ptr;
04748 
04749     \textcolor{comment}{/* Fields for clean LRU list of entries */}
04750     uint32\_t                    cLRU\_list\_len;
04751     \textcolor{keywordtype}{size\_t}                      cLRU\_list\_size;
04752     H5C\_cache\_entry\_t *     cLRU\_head\_ptr;
04753     H5C\_cache\_entry\_t *     cLRU\_tail\_ptr;
04754 
04755     \textcolor{comment}{/* Fields for dirty LRU list of entries */}
04756     uint32\_t                    dLRU\_list\_len;
04757     \textcolor{keywordtype}{size\_t}                      dLRU\_list\_size;
04758     H5C\_cache\_entry\_t *     dLRU\_head\_ptr;
04759     H5C\_cache\_entry\_t *         dLRU\_tail\_ptr;
04760 
04761 \textcolor{preprocessor}{#ifdef H5\_HAVE\_PARALLEL}
04762     \textcolor{comment}{/* Fields for collective metadata reads */}
04763     uint32\_t                    coll\_list\_len;
04764     \textcolor{keywordtype}{size\_t}                      coll\_list\_size;
04765     H5C\_cache\_entry\_t *     coll\_head\_ptr;
04766     H5C\_cache\_entry\_t *     coll\_tail\_ptr;
04767 
04768     \textcolor{comment}{/* Fields for collective metadata writes */}
04769     H5SL\_t *                    coll\_write\_list;
04770 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5\_HAVE\_PARALLEL */}\textcolor{preprocessor}{}
04771 
04772     \textcolor{comment}{/* Fields for automatic cache size adjustment */}
04773     hbool\_t         size\_increase\_possible;
04774     hbool\_t         flash\_size\_increase\_possible;
04775     \textcolor{keywordtype}{size\_t}          flash\_size\_increase\_threshold;
04776     hbool\_t         size\_decrease\_possible;
04777     hbool\_t         resize\_enabled;
04778     hbool\_t         cache\_full;
04779     hbool\_t         size\_decreased;
04780     hbool\_t         resize\_in\_progress;
04781     hbool\_t         msic\_in\_progress;
04782     H5C\_auto\_size\_ctl\_t     resize\_ctl;
04783 
04784     \textcolor{comment}{/* Fields for epoch markers used in automatic cache size adjustment */}
04785     int32\_t         epoch\_markers\_active;
04786     hbool\_t         epoch\_marker\_active[H5C\_\_MAX\_EPOCH\_MARKERS];
04787     int32\_t         epoch\_marker\_ringbuf[H5C\_\_MAX\_EPOCH\_MARKERS+1];
04788     int32\_t         epoch\_marker\_ringbuf\_first;
04789     int32\_t         epoch\_marker\_ringbuf\_last;
04790     int32\_t         epoch\_marker\_ringbuf\_size;
04791     H5C\_cache\_entry\_t       epoch\_markers[H5C\_\_MAX\_EPOCH\_MARKERS];
04792 
04793     \textcolor{comment}{/* Fields for cache hit rate collection */}
04794     int64\_t         cache\_hits;
04795     int64\_t         cache\_accesses;
04796 
04797     \textcolor{comment}{/* fields supporting generation of a cache image on file close */}
04798     H5C\_cache\_image\_ctl\_t   image\_ctl;
04799     hbool\_t         serialization\_in\_progress;
04800     hbool\_t         load\_image;
04801     hbool\_t                     image\_loaded;
04802     hbool\_t         delete\_image;
04803     haddr\_t             image\_addr;
04804     hsize\_t         image\_len;
04805     hsize\_t         image\_data\_len;
04806     int64\_t         entries\_loaded\_counter;
04807     int64\_t         entries\_inserted\_counter;
04808     int64\_t         entries\_relocated\_counter;
04809     int64\_t         entry\_fd\_height\_change\_counter;
04810     uint32\_t            num\_entries\_in\_image;
04811     H5C\_image\_entry\_t *     image\_entries;
04812     \textcolor{keywordtype}{void} *                      image\_buffer;
04813 
04814     \textcolor{comment}{/* Free Space Manager Related fields */}
04815     hbool\_t             rdfsm\_settled;
04816     hbool\_t         mdfsm\_settled;
04817 
04818 \textcolor{preprocessor}{#if H5C\_COLLECT\_CACHE\_STATS}
04819     \textcolor{comment}{/* stats fields */}
04820     int64\_t                     hits[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04821     int64\_t                     misses[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04822     int64\_t                     write\_protects[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04823     int64\_t                     read\_protects[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04824     int32\_t                     max\_read\_protects[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04825     int64\_t                     insertions[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04826     int64\_t                     pinned\_insertions[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04827     int64\_t                     clears[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04828     int64\_t                     flushes[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04829     int64\_t                     evictions[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04830     int64\_t                     take\_ownerships[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04831     int64\_t                     moves[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04832     int64\_t                     entry\_flush\_moves[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04833     int64\_t                     cache\_flush\_moves[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04834     int64\_t                     pins[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04835     int64\_t                     unpins[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04836     int64\_t                     dirty\_pins[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04837     int64\_t                     pinned\_flushes[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04838     int64\_t                     pinned\_clears[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04839     int64\_t                     size\_increases[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04840     int64\_t                     size\_decreases[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04841     int64\_t                     entry\_flush\_size\_changes[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04842     int64\_t                     cache\_flush\_size\_changes[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04843 
04844     \textcolor{comment}{/* Fields for hash table operations */}
04845     int64\_t         total\_ht\_insertions;
04846     int64\_t         total\_ht\_deletions;
04847     int64\_t         successful\_ht\_searches;
04848     int64\_t         total\_successful\_ht\_search\_depth;
04849     int64\_t         failed\_ht\_searches;
04850     int64\_t         total\_failed\_ht\_search\_depth;
04851     uint32\_t                    max\_index\_len;
04852     \textcolor{keywordtype}{size\_t}                      max\_index\_size;
04853     \textcolor{keywordtype}{size\_t}                      max\_clean\_index\_size;
04854     \textcolor{keywordtype}{size\_t}                      max\_dirty\_index\_size;
04855 
04856     \textcolor{comment}{/* Fields for in-order skip list */}
04857     uint32\_t                    max\_slist\_len;
04858     \textcolor{keywordtype}{size\_t}                      max\_slist\_size;
04859 
04860     \textcolor{comment}{/* Fields for protected entry list */}
04861     uint32\_t                    max\_pl\_len;
04862     \textcolor{keywordtype}{size\_t}                      max\_pl\_size;
04863 
04864     \textcolor{comment}{/* Fields for pinned entry list */}
04865     uint32\_t                    max\_pel\_len;
04866     \textcolor{keywordtype}{size\_t}                      max\_pel\_size;
04867 
04868     \textcolor{comment}{/* Fields for tracking 'make space in cache' (msic) operations */}
04869     int64\_t                     calls\_to\_msic;
04870     int64\_t                     total\_entries\_skipped\_in\_msic;
04871     int64\_t                     total\_dirty\_pf\_entries\_skipped\_in\_msic;
04872     int64\_t                     total\_entries\_scanned\_in\_msic;
04873     int32\_t                     max\_entries\_skipped\_in\_msic;
04874     int32\_t                     max\_dirty\_pf\_entries\_skipped\_in\_msic;
04875     int32\_t                     max\_entries\_scanned\_in\_msic;
04876     int64\_t                     entries\_scanned\_to\_make\_space;
04877  
04878     \textcolor{comment}{/* Fields for tracking skip list scan restarts */}
04879     int64\_t         slist\_scan\_restarts;
04880     int64\_t         LRU\_scan\_restarts;
04881     int64\_t         index\_scan\_restarts;
04882 
04883     \textcolor{comment}{/* Fields for tracking cache image operations */}
04884     int32\_t         images\_created;
04885     int32\_t         images\_read;
04886     int32\_t         images\_loaded;
04887     hsize\_t         last\_image\_size;
04888 
04889     \textcolor{comment}{/* Fields for tracking prefetched entries */}
04890     int64\_t         prefetches;
04891     int64\_t         dirty\_prefetches;
04892     int64\_t         prefetch\_hits;
04893 
04894 \textcolor{preprocessor}{#if H5C\_COLLECT\_CACHE\_ENTRY\_STATS}
04895     int32\_t                     max\_accesses[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04896     int32\_t                     min\_accesses[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04897     int32\_t                     max\_clears[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04898     int32\_t                     max\_flushes[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04899     \textcolor{keywordtype}{size\_t}                      max\_size[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04900     int32\_t                     max\_pins[H5C\_\_MAX\_NUM\_TYPE\_IDS + 1];
04901 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_COLLECT\_CACHE\_ENTRY\_STATS */}\textcolor{preprocessor}{}
04902 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_COLLECT\_CACHE\_STATS */}\textcolor{preprocessor}{}
04903 
04904     \textcolor{keywordtype}{char}            prefix[H5C\_\_PREFIX\_LEN];
04905 
04906 \textcolor{preprocessor}{#ifndef NDEBUG}
04907     int64\_t                     get\_entry\_ptr\_from\_addr\_counter;
04908 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* NDEBUG */}\textcolor{preprocessor}{}
04909 \};
04910 
04911 \textcolor{comment}{/* Define typedef for tagged cache entry iteration callbacks */}
04912 \textcolor{keyword}{typedef} int (*H5C\_tag\_iter\_cb\_t)(H5C\_cache\_entry\_t *entry, \textcolor{keywordtype}{void} *ctx);
04913 
04914 
04915 \textcolor{comment}{/*****************************/}
04916 \textcolor{comment}{/* Package Private Variables */}
04917 \textcolor{comment}{/*****************************/}
04918 
04919 
04920 \textcolor{comment}{/******************************/}
04921 \textcolor{comment}{/* Package Private Prototypes */}
04922 \textcolor{comment}{/******************************/}
04923 H5\_DLL herr\_t H5C\_\_prep\_image\_for\_file\_close(\hyperlink{struct_h5_f__t}{H5F\_t} *f, hid\_t dxpl\_id,
04924     hbool\_t *image\_generated);
04925 H5\_DLL herr\_t H5C\_\_deserialize\_prefetched\_entry(\hyperlink{struct_h5_f__t}{H5F\_t} *f, hid\_t dxpl\_id,
04926     \hyperlink{struct_h5_c__t}{H5C\_t} * cache\_ptr, H5C\_cache\_entry\_t** entry\_ptr\_ptr, 
04927     \textcolor{keyword}{const} H5C\_class\_t * type, haddr\_t addr, \textcolor{keywordtype}{void} * udata);
04928 
04929 \textcolor{comment}{/* General routines */}
04930 H5\_DLL herr\_t H5C\_\_flush\_single\_entry(\hyperlink{struct_h5_f__t}{H5F\_t} *f, hid\_t dxpl\_id,
04931     H5C\_cache\_entry\_t *entry\_ptr, \textcolor{keywordtype}{unsigned} flags);
04932 H5\_DLL herr\_t H5C\_\_generate\_cache\_image(\hyperlink{struct_h5_f__t}{H5F\_t} *f, hid\_t dxpl\_id, \hyperlink{struct_h5_c__t}{H5C\_t} *cache\_ptr);
04933 H5\_DLL herr\_t H5C\_\_load\_cache\_image(\hyperlink{struct_h5_f__t}{H5F\_t} *f, hid\_t dxpl\_id);
04934 H5\_DLL herr\_t H5C\_\_mark\_flush\_dep\_serialized(H5C\_cache\_entry\_t * entry\_ptr);
04935 H5\_DLL herr\_t H5C\_\_mark\_flush\_dep\_unserialized(H5C\_cache\_entry\_t * entry\_ptr);
04936 H5\_DLL herr\_t H5C\_\_make\_space\_in\_cache(\hyperlink{struct_h5_f__t}{H5F\_t} * f, hid\_t dxpl\_id,
04937     \textcolor{keywordtype}{size\_t}  space\_needed, hbool\_t write\_permitted);
04938 H5\_DLL herr\_t H5C\_\_flush\_marked\_entries(\hyperlink{struct_h5_f__t}{H5F\_t} * f, hid\_t dxpl\_id);
04939 H5\_DLL herr\_t H5C\_\_generate\_image(\hyperlink{struct_h5_f__t}{H5F\_t} *f, \hyperlink{struct_h5_c__t}{H5C\_t} *cache\_ptr,
04940     H5C\_cache\_entry\_t *entry\_ptr, hid\_t dxpl\_id);
04941 H5\_DLL herr\_t H5C\_\_serialize\_cache(\hyperlink{struct_h5_f__t}{H5F\_t} *f, hid\_t dxpl\_id);
04942 H5\_DLL herr\_t H5C\_\_iter\_tagged\_entries(\hyperlink{struct_h5_c__t}{H5C\_t} *cache, haddr\_t tag, hbool\_t match\_global,
04943     H5C\_tag\_iter\_cb\_t cb, \textcolor{keywordtype}{void} *cb\_ctx);
04944 
04945 \textcolor{comment}{/* Routines for operating on entry tags */}
04946 H5\_DLL herr\_t H5C\_\_tag\_entry(\hyperlink{struct_h5_c__t}{H5C\_t} * cache\_ptr, H5C\_cache\_entry\_t * entry\_ptr,
04947     hid\_t dxpl\_id);
04948 H5\_DLL herr\_t H5C\_\_untag\_entry(\hyperlink{struct_h5_c__t}{H5C\_t} *cache, H5C\_cache\_entry\_t *entry);
04949 
04950 \textcolor{comment}{/* Testing functions */}
04951 \textcolor{preprocessor}{#ifdef H5C\_TESTING}
04952 H5\_DLL herr\_t H5C\_\_verify\_cork\_tag\_test(hid\_t fid, haddr\_t tag, hbool\_t status);
04953 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* H5C\_TESTING */}\textcolor{preprocessor}{}
04954 
04955 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* \_H5Cpkg\_H */}\textcolor{preprocessor}{}
04956 
\end{DoxyCode}
