\hypertarget{matio_2visual__studio_2test_2eigen_2bench_2btl_2actions_2action__matrix__vector__product_8hh_source}{}\section{matio/visual\+\_\+studio/test/eigen/bench/btl/actions/action\+\_\+matrix\+\_\+vector\+\_\+product.hh}
\label{matio_2visual__studio_2test_2eigen_2bench_2btl_2actions_2action__matrix__vector__product_8hh_source}\index{action\+\_\+matrix\+\_\+vector\+\_\+product.\+hh@{action\+\_\+matrix\+\_\+vector\+\_\+product.\+hh}}

\begin{DoxyCode}
00001 \textcolor{comment}{//=====================================================}
00002 \textcolor{comment}{// File   :  action\_matrix\_vector\_product.hh}
00003 \textcolor{comment}{// Author :  L. Plagne <laurent.plagne@edf.fr)>}
00004 \textcolor{comment}{// Copyright (C) EDF R&D,  lun sep 30 14:23:19 CEST 2002}
00005 \textcolor{comment}{//=====================================================}
00006 \textcolor{comment}{//}
00007 \textcolor{comment}{// This program is free software; you can redistribute it and/or}
00008 \textcolor{comment}{// modify it under the terms of the GNU General Public License}
00009 \textcolor{comment}{// as published by the Free Software Foundation; either version 2}
00010 \textcolor{comment}{// of the License, or (at your option) any later version.}
00011 \textcolor{comment}{//}
00012 \textcolor{comment}{// This program is distributed in the hope that it will be useful,}
00013 \textcolor{comment}{// but WITHOUT ANY WARRANTY; without even the implied warranty of}
00014 \textcolor{comment}{// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00015 \textcolor{comment}{// GNU General Public License for more details.}
00016 \textcolor{comment}{// You should have received a copy of the GNU General Public License}
00017 \textcolor{comment}{// along with this program; if not, write to the Free Software}
00018 \textcolor{comment}{// Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.}
00019 \textcolor{comment}{//}
00020 \textcolor{preprocessor}{#ifndef ACTION\_MATRIX\_VECTOR\_PRODUCT}
00021 \textcolor{preprocessor}{#define ACTION\_MATRIX\_VECTOR\_PRODUCT}
00022 \textcolor{preprocessor}{#include "utilities.h"}
00023 \textcolor{preprocessor}{#include "STL\_interface.hh"}
00024 \textcolor{preprocessor}{#include <string>}
00025 \textcolor{preprocessor}{#include "init/init\_function.hh"}
00026 \textcolor{preprocessor}{#include "init/init\_vector.hh"}
00027 \textcolor{preprocessor}{#include "init/init\_matrix.hh"}
00028 
00029 \textcolor{keyword}{using namespace }\hyperlink{namespacestd}{std};
00030 
00031 \textcolor{keyword}{template}<\textcolor{keyword}{class} Interface>
00032 \textcolor{keyword}{class }\hyperlink{class_action__matrix__vector__product}{Action\_matrix\_vector\_product} \{
00033 
00034 public :
00035 
00036   \textcolor{comment}{// Ctor}
00037 
00038   BTL\_DONT\_INLINE \hyperlink{class_action__matrix__vector__product}{Action\_matrix\_vector\_product}( \textcolor{keywordtype}{int} size ):\_size(size)
00039   \{
00040     MESSAGE(\textcolor{stringliteral}{"Action\_matrix\_vector\_product Ctor"});
00041 
00042     \textcolor{comment}{// STL matrix and vector initialization}
00043 
00044     init\_matrix<pseudo\_random>(A\_stl,\_size);
00045     init\_vector<pseudo\_random>(B\_stl,\_size);
00046     init\_vector<null\_function>(X\_stl,\_size);
00047     init\_vector<null\_function>(resu\_stl,\_size);
00048 
00049     \textcolor{comment}{// generic matrix and vector initialization}
00050 
00051     Interface::matrix\_from\_stl(A\_ref,A\_stl);
00052     Interface::matrix\_from\_stl(A,A\_stl);
00053     Interface::vector\_from\_stl(B\_ref,B\_stl);
00054     Interface::vector\_from\_stl(B,B\_stl);
00055     Interface::vector\_from\_stl(X\_ref,X\_stl);
00056     Interface::vector\_from\_stl(X,X\_stl);
00057 
00058   \}
00059 
00060   \textcolor{comment}{// invalidate copy ctor}
00061 
00062   \hyperlink{class_action__matrix__vector__product}{Action\_matrix\_vector\_product}( \textcolor{keyword}{const}  
      \hyperlink{class_action__matrix__vector__product}{Action\_matrix\_vector\_product} & )
00063   \{
00064     INFOS(\textcolor{stringliteral}{"illegal call to Action\_matrix\_vector\_product Copy Ctor"});
00065     exit(1);
00066   \}
00067 
00068   \textcolor{comment}{// Dtor}
00069 
00070   BTL\_DONT\_INLINE ~\hyperlink{class_action__matrix__vector__product}{Action\_matrix\_vector\_product}( \textcolor{keywordtype}{void} )\{
00071 
00072     MESSAGE(\textcolor{stringliteral}{"Action\_matrix\_vector\_product Dtor"});
00073 
00074     \textcolor{comment}{// deallocation}
00075 
00076     Interface::free\_matrix(A,\_size);
00077     Interface::free\_vector(B);
00078     Interface::free\_vector(X);
00079 
00080     Interface::free\_matrix(A\_ref,\_size);
00081     Interface::free\_vector(B\_ref);
00082     Interface::free\_vector(X\_ref);
00083 
00084   \}
00085 
00086   \textcolor{comment}{// action name}
00087 
00088   \textcolor{keyword}{static} \textcolor{keyword}{inline} std::string name( \textcolor{keywordtype}{void} )
00089   \{
00090     \textcolor{keywordflow}{return} \textcolor{stringliteral}{"matrix\_vector\_"} + Interface::name();
00091   \}
00092 
00093   \textcolor{keywordtype}{double} nb\_op\_base( \textcolor{keywordtype}{void} )\{
00094     \textcolor{keywordflow}{return} 2.0*\_size*\_size;
00095   \}
00096 
00097   BTL\_DONT\_INLINE  \textcolor{keywordtype}{void} initialize( \textcolor{keywordtype}{void} )\{
00098 
00099     Interface::copy\_matrix(A\_ref,A,\_size);
00100     Interface::copy\_vector(B\_ref,B,\_size);
00101     Interface::copy\_vector(X\_ref,X,\_size);
00102 
00103   \}
00104 
00105   BTL\_DONT\_INLINE \textcolor{keywordtype}{void} calculate( \textcolor{keywordtype}{void} ) \{
00106       BTL\_ASM\_COMMENT(\textcolor{stringliteral}{"#begin matrix\_vector\_product"});
00107       Interface::matrix\_vector\_product(A,B,X,\_size);
00108       BTL\_ASM\_COMMENT(\textcolor{stringliteral}{"end matrix\_vector\_product"});
00109   \}
00110 
00111   BTL\_DONT\_INLINE \textcolor{keywordtype}{void} check\_result( \textcolor{keywordtype}{void} )\{
00112 
00113     \textcolor{comment}{// calculation check}
00114 
00115     Interface::vector\_to\_stl(X,resu\_stl);
00116 
00117     \hyperlink{class_s_t_l__interface}{STL\_interface<typename Interface::real\_type>::matrix\_vector\_product}
      (A\_stl,B\_stl,X\_stl,\_size);
00118 
00119     \textcolor{keyword}{typename} Interface::real\_type error=
00120       \hyperlink{class_s_t_l__interface}{STL\_interface<typename Interface::real\_type>::norm\_diff}
      (X\_stl,resu\_stl);
00121 
00122     \textcolor{keywordflow}{if} (error>1.e-5)\{
00123       INFOS(\textcolor{stringliteral}{"WRONG CALCULATION...residual="} << error);
00124       exit(0);
00125     \}
00126 
00127   \}
00128 
00129 private :
00130 
00131   \textcolor{keyword}{typename} Interface::stl\_matrix A\_stl;
00132   \textcolor{keyword}{typename} Interface::stl\_vector B\_stl;
00133   \textcolor{keyword}{typename} Interface::stl\_vector X\_stl;
00134   \textcolor{keyword}{typename} Interface::stl\_vector resu\_stl;
00135 
00136   \textcolor{keyword}{typename} Interface::gene\_matrix A\_ref;
00137   \textcolor{keyword}{typename} Interface::gene\_vector B\_ref;
00138   \textcolor{keyword}{typename} Interface::gene\_vector X\_ref;
00139 
00140   \textcolor{keyword}{typename} Interface::gene\_matrix A;
00141   \textcolor{keyword}{typename} Interface::gene\_vector B;
00142   \textcolor{keyword}{typename} Interface::gene\_vector X;
00143 
00144 
00145   \textcolor{keywordtype}{int} \_size;
00146 
00147 \};
00148 
00149 
00150 \textcolor{preprocessor}{#endif}
00151 
00152 
00153 
\end{DoxyCode}
