\hypertarget{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_non_linear_optimization_2covar_8h_source}{}\section{matio/visual\+\_\+studio/test/eigen/unsupported/\+Eigen/src/\+Non\+Linear\+Optimization/covar.h}
\label{matio_2visual__studio_2test_2eigen_2unsupported_2_eigen_2src_2_non_linear_optimization_2covar_8h_source}\index{covar.\+h@{covar.\+h}}

\begin{DoxyCode}
00001 \textcolor{keyword}{namespace }\hyperlink{namespace_eigen}{Eigen} \{ 
00002 
00003 \textcolor{keyword}{namespace }\hyperlink{namespaceinternal}{internal} \{
00004 
00005 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Scalar>
00006 \textcolor{keywordtype}{void} covar(
00007         \hyperlink{group___core___module}{Matrix< Scalar, Dynamic, Dynamic >} &r,
00008         \textcolor{keyword}{const} VectorXi &ipvt,
00009         Scalar tol = std::sqrt(NumTraits<Scalar>::epsilon()) )
00010 \{
00011     \textcolor{keyword}{using} std::abs;
00012     \textcolor{keyword}{typedef} DenseIndex \hyperlink{namespace_eigen_a62e77e0933482dafde8fe197d9a2cfde}{Index};
00013 
00014     \textcolor{comment}{/* Local variables */}
00015     Index i, j, k, l, ii, jj;
00016     \textcolor{keywordtype}{bool} sing;
00017     Scalar temp;
00018 
00019     \textcolor{comment}{/* Function Body */}
00020     \textcolor{keyword}{const} Index n = r.cols();
00021     \textcolor{keyword}{const} Scalar tolr = tol * abs(r(0,0));
00022     \hyperlink{group___core___module}{Matrix< Scalar, Dynamic, 1 >} wa(n);
00023     eigen\_assert(ipvt.size()==n);
00024 
00025     \textcolor{comment}{/* form the inverse of r in the full upper triangle of r. */}
00026     l = -1;
00027     \textcolor{keywordflow}{for} (k = 0; k < n; ++k)
00028         \textcolor{keywordflow}{if} (abs(r(k,k)) > tolr) \{
00029             r(k,k) = 1. / r(k,k);
00030             \textcolor{keywordflow}{for} (j = 0; j <= k-1; ++j) \{
00031                 temp = r(k,k) * r(j,k);
00032                 r(j,k) = 0.;
00033                 r.col(k).head(j+1) -= r.col(j).head(j+1) * temp;
00034             \}
00035             l = k;
00036         \}
00037 
00038     \textcolor{comment}{/* form the full upper triangle of the inverse of (r transpose)*r */}
00039     \textcolor{comment}{/* in the full upper triangle of r. */}
00040     \textcolor{keywordflow}{for} (k = 0; k <= l; ++k) \{
00041         \textcolor{keywordflow}{for} (j = 0; j <= k-1; ++j)
00042             r.col(j).head(j+1) += r.col(k).head(j+1) * r(j,k);
00043         r.col(k).head(k+1) *= r(k,k);
00044     \}
00045 
00046     \textcolor{comment}{/* form the full lower triangle of the covariance matrix */}
00047     \textcolor{comment}{/* in the strict lower triangle of r and in wa. */}
00048     \textcolor{keywordflow}{for} (j = 0; j < n; ++j) \{
00049         jj = ipvt[j];
00050         sing = j > l;
00051         \textcolor{keywordflow}{for} (i = 0; i <= j; ++i) \{
00052             \textcolor{keywordflow}{if} (sing)
00053                 r(i,j) = 0.;
00054             ii = ipvt[i];
00055             \textcolor{keywordflow}{if} (ii > jj)
00056                 r(ii,jj) = r(i,j);
00057             \textcolor{keywordflow}{if} (ii < jj)
00058                 r(jj,ii) = r(i,j);
00059         \}
00060         wa[jj] = r(j,j);
00061     \}
00062 
00063     \textcolor{comment}{/* symmetrize the covariance matrix in r. */}
00064     r.topLeftCorner(n,n).template triangularView<StrictlyUpper>() = r.topLeftCorner(n,n).transpose();
00065     r.diagonal() = wa;
00066 \}
00067 
00068 \} \textcolor{comment}{// end namespace internal}
00069 
00070 \} \textcolor{comment}{// end namespace Eigen}
\end{DoxyCode}
