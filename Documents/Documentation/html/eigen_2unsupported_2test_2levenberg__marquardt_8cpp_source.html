<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Generic Aircraft Simulation: levenberg_marquardt.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.PNG"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Generic Aircraft Simulation
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_0410cc66ecdc83992f6b50fdca162067.html">eigen</a></li><li class="navelem"><a class="el" href="dir_8859b5d197b430ae4da55195dc216850.html">unsupported</a></li><li class="navelem"><a class="el" href="dir_7ec1e1bf4cacafc1d59bd3d38a29e111.html">test</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">eigen/unsupported/test/levenberg_marquardt.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// This file is part of Eigen, a lightweight C++ template library</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// for linear algebra.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// Copyright (C) 2009 Thomas Capricelli &lt;orzel@freehackers.org&gt;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// Copyright (C) 2012 desire Nuentsa &lt;desire.nuentsa_wakam@inria.fr</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// This Source Code Form is subject to the terms of the Mozilla</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// Public License v. 2.0. If a copy of the MPL was not distributed</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// FIXME: These tests all check for hard-coded values. Ideally, parameters and start estimates should be randomized.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;main.h&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;unsupported/Eigen/LevenbergMarquardt&gt;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">// This disables some useless Warnings on MSVC.</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">// It is intended to be done for this test only.</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;Eigen/src/Core/util/DisableStupidWarnings.h&gt;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">using</span> std::sqrt;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">// tolerance for chekcing number of iterations</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#define LM_EVAL_COUNT_TOL 4/3</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno"><a class="line" href="structlmder__functor.html">   29</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structlmder__functor.html">lmder_functor</a> : DenseFunctor&lt;double&gt;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;{</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <a class="code" href="structlmder__functor.html">lmder_functor</a>(<span class="keywordtype">void</span>): DenseFunctor&lt;double&gt;(3,15) {}</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordtype">int</span> operator()(<span class="keyword">const</span> VectorXd &amp;x, VectorXd &amp;fvec)<span class="keyword"> const</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        <span class="keywordtype">double</span> tmp1, tmp2, tmp3;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> y[15] = {1.4e-1, 1.8e-1, 2.2e-1, 2.5e-1, 2.9e-1, 3.2e-1, 3.5e-1,</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;            3.9e-1, 3.7e-1, 5.8e-1, 7.3e-1, 9.6e-1, 1.34, 2.1, 4.39};</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; values(); i++)</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        {</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;            tmp1 = i+1;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;            tmp2 = 16 - i - 1;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;            tmp3 = (i&gt;=8)? tmp2 : tmp1;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;            fvec[i] = y[i] - (x[0] + tmp1/(x[1]*tmp2 + x[2]*tmp3));</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        }</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    }</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordtype">int</span> df(<span class="keyword">const</span> VectorXd &amp;x, MatrixXd &amp;fjac)<span class="keyword"> const</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="keywordtype">double</span> tmp1, tmp2, tmp3, tmp4;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; values(); i++)</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        {</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;            tmp1 = i+1;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;            tmp2 = 16 - i - 1;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            tmp3 = (i&gt;=8)? tmp2 : tmp1;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            tmp4 = (x[1]*tmp2 + x[2]*tmp3); tmp4 = tmp4*tmp4;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;            fjac(i,0) = -1;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;            fjac(i,1) = tmp1*tmp2/tmp4;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;            fjac(i,2) = tmp1*tmp3/tmp4;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        }</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    }</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;};</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="keywordtype">void</span> testLmder1()</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;{</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordtype">int</span> n=3, info;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  VectorXd x;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="comment">/* the following starting values provide a rough fit. */</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  x.setConstant(n, 1.);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <a class="code" href="structlmder__functor.html">lmder_functor</a> functor;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  LevenbergMarquardt&lt;lmder_functor&gt; lm(functor);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  info = lm.lmder1(x);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 6);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 5);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">// check norm</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  VERIFY_IS_APPROX(lm.fvec().blueNorm(), 0.09063596);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  VectorXd x_ref(n);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  x_ref &lt;&lt; 0.08241058, 1.133037, 2.343695;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  VERIFY_IS_APPROX(x, x_ref);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;}</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="keywordtype">void</span> testLmder()</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;{</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> m=15, n=3;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="keywordtype">int</span> info;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordtype">double</span> fnorm, covfac;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  VectorXd x;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="comment">/* the following starting values provide a rough fit. */</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  x.setConstant(n, 1.);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <a class="code" href="structlmder__functor.html">lmder_functor</a> functor;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  LevenbergMarquardt&lt;lmder_functor&gt; lm(functor);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="comment">// check return values</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 6);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 5);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="comment">// check norm</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  fnorm = lm.fvec().blueNorm();</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  VERIFY_IS_APPROX(fnorm, 0.09063596);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  VectorXd x_ref(n);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  x_ref &lt;&lt; 0.08241058, 1.133037, 2.343695;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  VERIFY_IS_APPROX(x, x_ref);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="comment">// check covariance</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  covfac = fnorm*fnorm/(m-n);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  internal::covar(lm.matrixR(), lm.permutation().indices()); <span class="comment">// TODO : move this as a function of lm</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  MatrixXd cov_ref(n,n);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  cov_ref &lt;&lt;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      0.0001531202,   0.002869941,  -0.002656662,</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      0.002869941,    0.09480935,   -0.09098995,</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      -0.002656662,   -0.09098995,    0.08778727;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">//  std::cout &lt;&lt; fjac*covfac &lt;&lt; std::endl;</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  MatrixXd cov;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  cov =  covfac*lm.matrixR().topLeftCorner&lt;n,n&gt;();</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  VERIFY_IS_APPROX( cov, cov_ref);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="comment">// TODO: why isn&#39;t this allowed ? :</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="comment">// VERIFY_IS_APPROX( covfac*fjac.topLeftCorner&lt;n,n&gt;() , cov_ref);</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;}</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="structlmdif__functor.html">  141</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structlmdif__functor.html">lmdif_functor</a> : DenseFunctor&lt;double&gt;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;{</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <a class="code" href="structlmdif__functor.html">lmdif_functor</a>(<span class="keywordtype">void</span>) : DenseFunctor&lt;double&gt;(3,15) {}</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordtype">int</span> operator()(<span class="keyword">const</span> VectorXd &amp;x, VectorXd &amp;fvec)<span class="keyword"> const</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordtype">double</span> tmp1,tmp2,tmp3;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> y[15]={1.4e-1,1.8e-1,2.2e-1,2.5e-1,2.9e-1,3.2e-1,3.5e-1,3.9e-1,</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            3.7e-1,5.8e-1,7.3e-1,9.6e-1,1.34e0,2.1e0,4.39e0};</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        assert(x.size()==3);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        assert(fvec.size()==15);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordflow">for</span> (i=0; i&lt;15; i++)</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            tmp1 = i+1;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            tmp2 = 15 - i;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            tmp3 = tmp1;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            <span class="keywordflow">if</span> (i &gt;= 8) tmp3 = tmp2;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            fvec[i] = y[i] - (x[0] + tmp1/(x[1]*tmp2 + x[2]*tmp3));</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        }</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    }</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;};</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="keywordtype">void</span> testLmdif1()</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;{</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> n=3;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keywordtype">int</span> info;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  VectorXd x(n), fvec(15);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="comment">/* the following starting values provide a rough fit. */</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  x.setConstant(n, 1.);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <a class="code" href="structlmdif__functor.html">lmdif_functor</a> functor;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  DenseIndex nfev;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  info = LevenbergMarquardt&lt;lmdif_functor&gt;::lmdif1(functor, x, &amp;nfev);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">//   VERIFY_IS_EQUAL(nfev, 26);</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="comment">// check norm</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  functor(x, fvec);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  VERIFY_IS_APPROX(fvec.blueNorm(), 0.09063596);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  VectorXd x_ref(n);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  x_ref &lt;&lt; 0.0824106, 1.1330366, 2.3436947;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  VERIFY_IS_APPROX(x, x_ref);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;}</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="keywordtype">void</span> testLmdif()</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;{</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> m=15, n=3;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keywordtype">int</span> info;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keywordtype">double</span> fnorm, covfac;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  VectorXd x(n);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="comment">/* the following starting values provide a rough fit. */</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  x.setConstant(n, 1.);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <a class="code" href="structlmdif__functor.html">lmdif_functor</a> functor;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  NumericalDiff&lt;lmdif_functor&gt; numDiff(functor);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  LevenbergMarquardt&lt;NumericalDiff&lt;lmdif_functor&gt; &gt; lm(numDiff);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="comment">// check return values</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">//   VERIFY_IS_EQUAL(lm.nfev(), 26);</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="comment">// check norm</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  fnorm = lm.fvec().blueNorm();</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  VERIFY_IS_APPROX(fnorm, 0.09063596);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  VectorXd x_ref(n);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  x_ref &lt;&lt; 0.08241058, 1.133037, 2.343695;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  VERIFY_IS_APPROX(x, x_ref);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="comment">// check covariance</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  covfac = fnorm*fnorm/(m-n);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  internal::covar(lm.matrixR(), lm.permutation().indices()); <span class="comment">// TODO : move this as a function of lm</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  MatrixXd cov_ref(n,n);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  cov_ref &lt;&lt;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      0.0001531202,   0.002869942,  -0.002656662,</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      0.002869942,    0.09480937,   -0.09098997,</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      -0.002656662,   -0.09098997,    0.08778729;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">//  std::cout &lt;&lt; fjac*covfac &lt;&lt; std::endl;</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  MatrixXd cov;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  cov =  covfac*lm.matrixR().topLeftCorner&lt;n,n&gt;();</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  VERIFY_IS_APPROX( cov, cov_ref);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="comment">// TODO: why isn&#39;t this allowed ? :</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="comment">// VERIFY_IS_APPROX( covfac*fjac.topLeftCorner&lt;n,n&gt;() , cov_ref);</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;}</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno"><a class="line" href="structchwirut2__functor.html">  244</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structchwirut2__functor.html">chwirut2_functor</a> : DenseFunctor&lt;double&gt;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;{</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="structchwirut2__functor.html">chwirut2_functor</a>(<span class="keywordtype">void</span>) : DenseFunctor&lt;double&gt;(3,54) {}</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> m_x[54];</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> m_y[54];</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordtype">int</span> operator()(<span class="keyword">const</span> VectorXd &amp;b, VectorXd &amp;fvec)</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        assert(b.size()==3);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        assert(fvec.size()==54);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keywordflow">for</span>(i=0; i&lt;54; i++) {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            <span class="keywordtype">double</span> x = m_x[i];</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            fvec[i] = exp(-b[0]*x)/(b[1]+b[2]*x) - m_y[i];</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    }</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordtype">int</span> df(<span class="keyword">const</span> VectorXd &amp;b, MatrixXd &amp;fjac)</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    {</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        assert(b.size()==3);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        assert(fjac.rows()==54);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        assert(fjac.cols()==3);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;54; i++) {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <span class="keywordtype">double</span> x = m_x[i];</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            <span class="keywordtype">double</span> factor = 1./(b[1]+b[2]*x);</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            <span class="keywordtype">double</span> e = exp(-b[0]*x);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            fjac(i,0) = -x*e*factor;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            fjac(i,1) = -e*factor*factor;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            fjac(i,2) = -x*e*factor*factor;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        }</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    }</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;};</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> chwirut2_functor::m_x[54] = { 0.500E0, 1.000E0, 1.750E0, 3.750E0, 5.750E0, 0.875E0, 2.250E0, 3.250E0, 5.250E0, 0.750E0, 1.750E0, 2.750E0, 4.750E0, 0.625E0, 1.250E0, 2.250E0, 4.250E0, .500E0, 3.000E0, .750E0, 3.000E0, 1.500E0, 6.000E0, 3.000E0, 6.000E0, 1.500E0, 3.000E0, .500E0, 2.000E0, 4.000E0, .750E0, 2.000E0, 5.000E0, .750E0, 2.250E0, 3.750E0, 5.750E0, 3.000E0, .750E0, 2.500E0, 4.000E0, .750E0, 2.500E0, 4.000E0, .750E0, 2.500E0, 4.000E0, .500E0, 6.000E0, 3.000E0, .500E0, 2.750E0, .500E0, 1.750E0};</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> chwirut2_functor::m_y[54] = { 92.9000E0 ,57.1000E0 ,31.0500E0 ,11.5875E0 ,8.0250E0 ,63.6000E0 ,21.4000E0 ,14.2500E0 ,8.4750E0 ,63.8000E0 ,26.8000E0 ,16.4625E0 ,7.1250E0 ,67.3000E0 ,41.0000E0 ,21.1500E0 ,8.1750E0 ,81.5000E0 ,13.1200E0 ,59.9000E0 ,14.6200E0 ,32.9000E0 ,5.4400E0 ,12.5600E0 ,5.4400E0 ,32.0000E0 ,13.9500E0 ,75.8000E0 ,20.0000E0 ,10.4200E0 ,59.5000E0 ,21.6700E0 ,8.5500E0 ,62.0000E0 ,20.2000E0 ,7.7600E0 ,3.7500E0 ,11.8100E0 ,54.7000E0 ,23.7000E0 ,11.5500E0 ,61.3000E0 ,17.7000E0 ,8.7400E0 ,59.2000E0 ,16.3000E0 ,8.6200E0 ,81.0000E0 ,4.8700E0 ,14.6200E0 ,81.7000E0 ,17.1700E0 ,81.3000E0 ,28.9000E0  };</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">// http://www.itl.nist.gov/div898/strd/nls/data/chwirut2.shtml</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="keywordtype">void</span> testNistChwirut2(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;{</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> n=3;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  LevenbergMarquardtSpace::Status info;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  VectorXd x(n);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">   * First try</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  x&lt;&lt; 0.1, 0.01, 0.02;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <a class="code" href="structchwirut2__functor.html">chwirut2_functor</a> functor;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  LevenbergMarquardt&lt;chwirut2_functor&gt; lm(functor);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">//   VERIFY_IS_EQUAL(lm.nfev(), 10);</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 8);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 5.1304802941E+02);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  VERIFY_IS_APPROX(x[0], 1.6657666537E-01);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  VERIFY_IS_APPROX(x[1], 5.1653291286E-03);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  VERIFY_IS_APPROX(x[2], 1.2150007096E-02);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">   * Second try</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  x&lt;&lt; 0.15, 0.008, 0.010;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  lm.resetParameters();</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  lm.setFtol(1.E6*NumTraits&lt;double&gt;::epsilon());</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  lm.setXtol(1.E6*NumTraits&lt;double&gt;::epsilon());</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">//   VERIFY_IS_EQUAL(lm.nfev(), 7);</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 6);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 5.1304802941E+02);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  VERIFY_IS_APPROX(x[0], 1.6657666537E-01);</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  VERIFY_IS_APPROX(x[1], 5.1653291286E-03);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  VERIFY_IS_APPROX(x[2], 1.2150007096E-02);</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;}</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno"><a class="line" href="structmisra1a__functor.html">  331</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structmisra1a__functor.html">misra1a_functor</a> : DenseFunctor&lt;double&gt;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;{</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <a class="code" href="structmisra1a__functor.html">misra1a_functor</a>(<span class="keywordtype">void</span>) : DenseFunctor&lt;double&gt;(2,14) {}</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> m_x[14];</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> m_y[14];</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordtype">int</span> operator()(<span class="keyword">const</span> VectorXd &amp;b, VectorXd &amp;fvec)</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    {</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        assert(b.size()==2);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        assert(fvec.size()==14);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;14; i++) {</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            fvec[i] = b[0]*(1.-exp(-b[1]*m_x[i])) - m_y[i] ;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        }</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    }</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordtype">int</span> df(<span class="keyword">const</span> VectorXd &amp;b, MatrixXd &amp;fjac)</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    {</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        assert(b.size()==2);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        assert(fjac.rows()==14);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        assert(fjac.cols()==2);</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;14; i++) {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            fjac(i,0) = (1.-exp(-b[1]*m_x[i]));</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            fjac(i,1) = (b[0]*m_x[i]*exp(-b[1]*m_x[i]));</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        }</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    }</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;};</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> misra1a_functor::m_x[14] = { 77.6E0, 114.9E0, 141.1E0, 190.8E0, 239.9E0, 289.0E0, 332.8E0, 378.4E0, 434.8E0, 477.3E0, 536.8E0, 593.1E0, 689.1E0, 760.0E0};</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> misra1a_functor::m_y[14] = { 10.07E0, 14.73E0, 17.94E0, 23.93E0, 29.61E0, 35.18E0, 40.02E0, 44.82E0, 50.76E0, 55.05E0, 61.01E0, 66.40E0, 75.47E0, 81.78E0};</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">// http://www.itl.nist.gov/div898/strd/nls/data/misra1a.shtml</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="keywordtype">void</span> testNistMisra1a(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;{</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> n=2;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="keywordtype">int</span> info;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  VectorXd x(n);</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">   * First try</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  x&lt;&lt; 500., 0.0001;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <a class="code" href="structmisra1a__functor.html">misra1a_functor</a> functor;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  LevenbergMarquardt&lt;misra1a_functor&gt; lm(functor);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 19);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 15);</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 1.2455138894E-01);</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  VERIFY_IS_APPROX(x[0], 2.3894212918E+02);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  VERIFY_IS_APPROX(x[1], 5.5015643181E-04);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">   * Second try</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  x&lt;&lt; 250., 0.0005;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 5);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 4);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 1.2455138894E-01);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  VERIFY_IS_APPROX(x[0], 2.3894212918E+02);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  VERIFY_IS_APPROX(x[1], 5.5015643181E-04);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;}</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno"><a class="line" href="structhahn1__functor.html">  405</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structhahn1__functor.html">hahn1_functor</a> : DenseFunctor&lt;double&gt;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;{</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <a class="code" href="structhahn1__functor.html">hahn1_functor</a>(<span class="keywordtype">void</span>) : DenseFunctor&lt;double&gt;(7,236) {}</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> m_x[236];</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordtype">int</span> operator()(<span class="keyword">const</span> VectorXd &amp;b, VectorXd &amp;fvec)</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    {</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> m_y[236] = { .591E0 , 1.547E0 , 2.902E0 , 2.894E0 , 4.703E0 , 6.307E0 , 7.03E0  , 7.898E0 , 9.470E0 , 9.484E0 , 10.072E0 , 10.163E0 , 11.615E0 , 12.005E0 , 12.478E0 , 12.982E0 , 12.970E0 , 13.926E0 , 14.452E0 , 14.404E0 , 15.190E0 , 15.550E0 , 15.528E0 , 15.499E0 , 16.131E0 , 16.438E0 , 16.387E0 , 16.549E0 , 16.872E0 , 16.830E0 , 16.926E0 , 16.907E0 , 16.966E0 , 17.060E0 , 17.122E0 , 17.311E0 , 17.355E0 , 17.668E0 , 17.767E0 , 17.803E0 , 17.765E0 , 17.768E0 , 17.736E0 , 17.858E0 , 17.877E0 , 17.912E0 , 18.046E0 , 18.085E0 , 18.291E0 , 18.357E0 , 18.426E0 , 18.584E0 , 18.610E0 , 18.870E0 , 18.795E0 , 19.111E0 , .367E0 , .796E0 , 0.892E0 , 1.903E0 , 2.150E0 , 3.697E0 , 5.870E0 , 6.421E0 , 7.422E0 , 9.944E0 , 11.023E0 , 11.87E0  , 12.786E0 , 14.067E0 , 13.974E0 , 14.462E0 , 14.464E0 , 15.381E0 , 15.483E0 , 15.59E0  , 16.075E0 , 16.347E0 , 16.181E0 , 16.915E0 , 17.003E0 , 16.978E0 , 17.756E0 , 17.808E0 , 17.868E0 , 18.481E0 , 18.486E0 , 19.090E0 , 16.062E0 , 16.337E0 , 16.345E0 ,</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        16.388E0 , 17.159E0 , 17.116E0 , 17.164E0 , 17.123E0 , 17.979E0 , 17.974E0 , 18.007E0 , 17.993E0 , 18.523E0 , 18.669E0 , 18.617E0 , 19.371E0 , 19.330E0 , 0.080E0 , 0.248E0 , 1.089E0 , 1.418E0 , 2.278E0 , 3.624E0 , 4.574E0 , 5.556E0 , 7.267E0 , 7.695E0 , 9.136E0 , 9.959E0 , 9.957E0 , 11.600E0 , 13.138E0 , 13.564E0 , 13.871E0 , 13.994E0 , 14.947E0 , 15.473E0 , 15.379E0 , 15.455E0 , 15.908E0 , 16.114E0 , 17.071E0 , 17.135E0 , 17.282E0 , 17.368E0 , 17.483E0 , 17.764E0 , 18.185E0 , 18.271E0 , 18.236E0 , 18.237E0 , 18.523E0 , 18.627E0 , 18.665E0 , 19.086E0 , 0.214E0 , 0.943E0 , 1.429E0 , 2.241E0 , 2.951E0 , 3.782E0 , 4.757E0 , 5.602E0 , 7.169E0 , 8.920E0 , 10.055E0 , 12.035E0 , 12.861E0 , 13.436E0 , 14.167E0 , 14.755E0 , 15.168E0 , 15.651E0 , 15.746E0 , 16.216E0 , 16.445E0 , 16.965E0 , 17.121E0 , 17.206E0 , 17.250E0 , 17.339E0 , 17.793E0 , 18.123E0 , 18.49E0  , 18.566E0 , 18.645E0 , 18.706E0 , 18.924E0 , 19.1E0   , 0.375E0 , 0.471E0 , 1.504E0 , 2.204E0 , 2.813E0 , 4.765E0 , 9.835E0 , 10.040E0 , 11.946E0 , </div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;12.596E0 , </div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;13.303E0 , 13.922E0 , 14.440E0 , 14.951E0 , 15.627E0 , 15.639E0 , 15.814E0 , 16.315E0 , 16.334E0 , 16.430E0 , 16.423E0 , 17.024E0 , 17.009E0 , 17.165E0 , 17.134E0 , 17.349E0 , 17.576E0 , 17.848E0 , 18.090E0 , 18.276E0 , 18.404E0 , 18.519E0 , 19.133E0 , 19.074E0 , 19.239E0 , 19.280E0 , 19.101E0 , 19.398E0 , 19.252E0 , 19.89E0  , 20.007E0 , 19.929E0 , 19.268E0 , 19.324E0 , 20.049E0 , 20.107E0 , 20.062E0 , 20.065E0 , 19.286E0 , 19.972E0 , 20.088E0 , 20.743E0 , 20.83E0  , 20.935E0 , 21.035E0 , 20.93E0  , 21.074E0 , 21.085E0 , 20.935E0 };</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="comment">//        int called=0; printf(&quot;call hahn1_functor with  iflag=%d, called=%d\n&quot;, iflag, called); if (iflag==1) called++;</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        assert(b.size()==7);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        assert(fvec.size()==236);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;236; i++) {</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            <span class="keywordtype">double</span> x=m_x[i], xx=x*x, xxx=xx*x;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            fvec[i] = (b[0]+b[1]*x+b[2]*xx+b[3]*xxx) / (1.+b[4]*x+b[5]*xx+b[6]*xxx) - m_y[i];</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        }</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    }</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordtype">int</span> df(<span class="keyword">const</span> VectorXd &amp;b, MatrixXd &amp;fjac)</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        assert(b.size()==7);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        assert(fjac.rows()==236);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        assert(fjac.cols()==7);</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;236; i++) {</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            <span class="keywordtype">double</span> x=m_x[i], xx=x*x, xxx=xx*x;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            <span class="keywordtype">double</span> fact = 1./(1.+b[4]*x+b[5]*xx+b[6]*xxx);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            fjac(i,0) = 1.*fact;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            fjac(i,1) = x*fact;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            fjac(i,2) = xx*fact;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            fjac(i,3) = xxx*fact;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            fact = - (b[0]+b[1]*x+b[2]*xx+b[3]*xxx) * fact * fact;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            fjac(i,4) = x*fact;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            fjac(i,5) = xx*fact;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            fjac(i,6) = xxx*fact;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        }</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    }</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;};</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> hahn1_functor::m_x[236] = { 24.41E0 , 34.82E0 , 44.09E0 , 45.07E0 , 54.98E0 , 65.51E0 , 70.53E0 , 75.70E0 , 89.57E0 , 91.14E0 , 96.40E0 , 97.19E0 , 114.26E0 , 120.25E0 , 127.08E0 , 133.55E0 , 133.61E0 , 158.67E0 , 172.74E0 , 171.31E0 , 202.14E0 , 220.55E0 , 221.05E0 , 221.39E0 , 250.99E0 , 268.99E0 , 271.80E0 , 271.97E0 , 321.31E0 , 321.69E0 , 330.14E0 , 333.03E0 , 333.47E0 , 340.77E0 , 345.65E0 , 373.11E0 , 373.79E0 , 411.82E0 , 419.51E0 , 421.59E0 , 422.02E0 , 422.47E0 , 422.61E0 , 441.75E0 , 447.41E0 , 448.7E0  , 472.89E0 , 476.69E0 , 522.47E0 , 522.62E0 , 524.43E0 , 546.75E0 , 549.53E0 , 575.29E0 , 576.00E0 , 625.55E0 , 20.15E0 , 28.78E0 , 29.57E0 , 37.41E0 , 39.12E0 , 50.24E0 , 61.38E0 , 66.25E0 , 73.42E0 , 95.52E0 , 107.32E0 , 122.04E0 , 134.03E0 , 163.19E0 , 163.48E0 , 175.70E0 , 179.86E0 , 211.27E0 , 217.78E0 , 219.14E0 , 262.52E0 , 268.01E0 , 268.62E0 , 336.25E0 , 337.23E0 , 339.33E0 , 427.38E0 , 428.58E0 , 432.68E0 , 528.99E0 , 531.08E0 , 628.34E0 , 253.24E0 , 273.13E0 , 273.66E0 ,</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;282.10E0 , 346.62E0 , 347.19E0 , 348.78E0 , 351.18E0 , 450.10E0 , 450.35E0 , 451.92E0 , 455.56E0 , 552.22E0 , 553.56E0 , 555.74E0 , 652.59E0 , 656.20E0 , 14.13E0 , 20.41E0 , 31.30E0 , 33.84E0 , 39.70E0 , 48.83E0 , 54.50E0 , 60.41E0 , 72.77E0 , 75.25E0 , 86.84E0 , 94.88E0 , 96.40E0 , 117.37E0 , 139.08E0 , 147.73E0 , 158.63E0 , 161.84E0 , 192.11E0 , 206.76E0 , 209.07E0 , 213.32E0 , 226.44E0 , 237.12E0 , 330.90E0 , 358.72E0 , 370.77E0 , 372.72E0 , 396.24E0 , 416.59E0 , 484.02E0 , 495.47E0 , 514.78E0 , 515.65E0 , 519.47E0 , 544.47E0 , 560.11E0 , 620.77E0 , 18.97E0 , 28.93E0 , 33.91E0 , 40.03E0 , 44.66E0 , 49.87E0 , 55.16E0 , 60.90E0 , 72.08E0 , 85.15E0 , 97.06E0 , 119.63E0 , 133.27E0 , 143.84E0 , 161.91E0 , 180.67E0 , 198.44E0 , 226.86E0 , 229.65E0 , 258.27E0 , 273.77E0 , 339.15E0 , 350.13E0 , 362.75E0 , 371.03E0 , 393.32E0 , 448.53E0 , 473.78E0 , 511.12E0 , 524.70E0 , 548.75E0 , 551.64E0 , 574.02E0 , 623.86E0 , 21.46E0 , 24.33E0 , 33.43E0 , 39.22E0 , 44.18E0 , 55.02E0 , 94.33E0 , 96.44E0 , 118.82E0 , 128.48E0 ,</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;141.94E0 , 156.92E0 , 171.65E0 , 190.00E0 , 223.26E0 , 223.88E0 , 231.50E0 , 265.05E0 , 269.44E0 , 271.78E0 , 273.46E0 , 334.61E0 , 339.79E0 , 349.52E0 , 358.18E0 , 377.98E0 , 394.77E0 , 429.66E0 , 468.22E0 , 487.27E0 , 519.54E0 , 523.03E0 , 612.99E0 , 638.59E0 , 641.36E0 , 622.05E0 , 631.50E0 , 663.97E0 , 646.9E0  , 748.29E0 , 749.21E0 , 750.14E0 , 647.04E0 , 646.89E0 , 746.9E0  , 748.43E0 , 747.35E0 , 749.27E0 , 647.61E0 , 747.78E0 , 750.51E0 , 851.37E0 , 845.97E0 , 847.54E0 , 849.93E0 , 851.61E0 , 849.75E0 , 850.98E0 , 848.23E0};</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">// http://www.itl.nist.gov/div898/strd/nls/data/hahn1.shtml</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="keywordtype">void</span> testNistHahn1(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;{</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span>  n=7;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="keywordtype">int</span> info;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  VectorXd x(n);</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">   * First try</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  x&lt;&lt; 10., -1., .05, -.00001, -.05, .001, -.000001;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <a class="code" href="structhahn1__functor.html">hahn1_functor</a> functor;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  LevenbergMarquardt&lt;hahn1_functor&gt; lm(functor);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 11);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 10);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 1.5324382854E+00);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  VERIFY_IS_APPROX(x[0], 1.0776351733E+00);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  VERIFY_IS_APPROX(x[1],-1.2269296921E-01);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  VERIFY_IS_APPROX(x[2], 4.0863750610E-03);</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  VERIFY_IS_APPROX(x[3],-1.426264e-06); <span class="comment">// shoulde be : -1.4262662514E-06</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  VERIFY_IS_APPROX(x[4],-5.7609940901E-03);</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  VERIFY_IS_APPROX(x[5], 2.4053735503E-04);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  VERIFY_IS_APPROX(x[6],-1.2314450199E-07);</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">   * Second try</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  x&lt;&lt; .1, -.1, .005, -.000001, -.005, .0001, -.0000001;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">//   VERIFY_IS_EQUAL(lm.nfev(), 11);</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 10);</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 1.5324382854E+00);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  VERIFY_IS_APPROX(x[0], 1.077640); <span class="comment">// should be :  1.0776351733E+00</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  VERIFY_IS_APPROX(x[1], -0.1226933); <span class="comment">// should be : -1.2269296921E-01</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  VERIFY_IS_APPROX(x[2], 0.004086383); <span class="comment">// should be : 4.0863750610E-03</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  VERIFY_IS_APPROX(x[3], -1.426277e-06); <span class="comment">// shoulde be : -1.4262662514E-06</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  VERIFY_IS_APPROX(x[4],-5.7609940901E-03);</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  VERIFY_IS_APPROX(x[5], 0.00024053772); <span class="comment">// should be : 2.4053735503E-04</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  VERIFY_IS_APPROX(x[6], -1.231450e-07); <span class="comment">// should be : -1.2314450199E-07</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;}</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno"><a class="line" href="structmisra1d__functor.html">  507</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structmisra1d__functor.html">misra1d_functor</a> : DenseFunctor&lt;double&gt;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;{</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <a class="code" href="structmisra1d__functor.html">misra1d_functor</a>(<span class="keywordtype">void</span>) : DenseFunctor&lt;double&gt;(2,14) {}</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> x[14];</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> y[14];</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordtype">int</span> operator()(<span class="keyword">const</span> VectorXd &amp;b, VectorXd &amp;fvec)</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    {</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        assert(b.size()==2);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        assert(fvec.size()==14);</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;14; i++) {</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            fvec[i] = b[0]*b[1]*x[i]/(1.+b[1]*x[i]) - y[i];</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        }</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    }</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordtype">int</span> df(<span class="keyword">const</span> VectorXd &amp;b, MatrixXd &amp;fjac)</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    {</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        assert(b.size()==2);</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        assert(fjac.rows()==14);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        assert(fjac.cols()==2);</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;14; i++) {</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            <span class="keywordtype">double</span> den = 1.+b[1]*x[i];</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            fjac(i,0) = b[1]*x[i] / den;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            fjac(i,1) = b[0]*x[i]*(den-b[1]*x[i])/den/den;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        }</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    }</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;};</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> misra1d_functor::x[14] = { 77.6E0, 114.9E0, 141.1E0, 190.8E0, 239.9E0, 289.0E0, 332.8E0, 378.4E0, 434.8E0, 477.3E0, 536.8E0, 593.1E0, 689.1E0, 760.0E0};</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> misra1d_functor::y[14] = { 10.07E0, 14.73E0, 17.94E0, 23.93E0, 29.61E0, 35.18E0, 40.02E0, 44.82E0, 50.76E0, 55.05E0, 61.01E0, 66.40E0, 75.47E0, 81.78E0};</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">// http://www.itl.nist.gov/div898/strd/nls/data/misra1d.shtml</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="keywordtype">void</span> testNistMisra1d(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;{</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> n=2;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="keywordtype">int</span> info;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  VectorXd x(n);</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">   * First try</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  x&lt;&lt; 500., 0.0001;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <a class="code" href="structmisra1d__functor.html">misra1d_functor</a> functor;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  LevenbergMarquardt&lt;misra1d_functor&gt; lm(functor);</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 9);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 7);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 5.6419295283E-02);</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  VERIFY_IS_APPROX(x[0], 4.3736970754E+02);</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  VERIFY_IS_APPROX(x[1], 3.0227324449E-04);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">   * Second try</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  x&lt;&lt; 450., 0.0003;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 4);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 3);</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 5.6419295283E-02);</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  VERIFY_IS_APPROX(x[0], 4.3736970754E+02);</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  VERIFY_IS_APPROX(x[1], 3.0227324449E-04);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;}</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00583"></a><span class="lineno"><a class="line" href="structlanczos1__functor.html">  583</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structlanczos1__functor.html">lanczos1_functor</a> : DenseFunctor&lt;double&gt;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;{</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <a class="code" href="structlanczos1__functor.html">lanczos1_functor</a>(<span class="keywordtype">void</span>) : DenseFunctor&lt;double&gt;(6,24) {}</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> x[24];</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> y[24];</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordtype">int</span> operator()(<span class="keyword">const</span> VectorXd &amp;b, VectorXd &amp;fvec)</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    {</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        assert(b.size()==6);</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        assert(fvec.size()==24);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;24; i++)</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            fvec[i] = b[0]*exp(-b[1]*x[i]) + b[2]*exp(-b[3]*x[i]) + b[4]*exp(-b[5]*x[i])  - y[i];</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    }</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordtype">int</span> df(<span class="keyword">const</span> VectorXd &amp;b, MatrixXd &amp;fjac)</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    {</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        assert(b.size()==6);</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        assert(fjac.rows()==24);</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        assert(fjac.cols()==6);</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;24; i++) {</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            fjac(i,0) = exp(-b[1]*x[i]);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            fjac(i,1) = -b[0]*x[i]*exp(-b[1]*x[i]);</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            fjac(i,2) = exp(-b[3]*x[i]);</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            fjac(i,3) = -b[2]*x[i]*exp(-b[3]*x[i]);</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            fjac(i,4) = exp(-b[5]*x[i]);</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            fjac(i,5) = -b[4]*x[i]*exp(-b[5]*x[i]);</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        }</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    }</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;};</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> lanczos1_functor::x[24] = { 0.000000000000E+00, 5.000000000000E-02, 1.000000000000E-01, 1.500000000000E-01, 2.000000000000E-01, 2.500000000000E-01, 3.000000000000E-01, 3.500000000000E-01, 4.000000000000E-01, 4.500000000000E-01, 5.000000000000E-01, 5.500000000000E-01, 6.000000000000E-01, 6.500000000000E-01, 7.000000000000E-01, 7.500000000000E-01, 8.000000000000E-01, 8.500000000000E-01, 9.000000000000E-01, 9.500000000000E-01, 1.000000000000E+00, 1.050000000000E+00, 1.100000000000E+00, 1.150000000000E+00 };</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> lanczos1_functor::y[24] = { 2.513400000000E+00 ,2.044333373291E+00 ,1.668404436564E+00 ,1.366418021208E+00 ,1.123232487372E+00 ,9.268897180037E-01 ,7.679338563728E-01 ,6.388775523106E-01 ,5.337835317402E-01 ,4.479363617347E-01 ,3.775847884350E-01 ,3.197393199326E-01 ,2.720130773746E-01 ,2.324965529032E-01 ,1.996589546065E-01 ,1.722704126914E-01 ,1.493405660168E-01 ,1.300700206922E-01 ,1.138119324644E-01 ,1.000415587559E-01 ,8.833209084540E-02 ,7.833544019350E-02 ,6.976693743449E-02 ,6.239312536719E-02 };</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment">// http://www.itl.nist.gov/div898/strd/nls/data/lanczos1.shtml</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="keywordtype">void</span> testNistLanczos1(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;{</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> n=6;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  LevenbergMarquardtSpace::Status info;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  VectorXd x(n);</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment">   * First try</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  x&lt;&lt; 1.2, 0.3, 5.6, 5.5, 6.5, 7.6;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <a class="code" href="structlanczos1__functor.html">lanczos1_functor</a> functor;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  LevenbergMarquardt&lt;lanczos1_functor&gt; lm(functor);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  VERIFY_IS_EQUAL(info, LevenbergMarquardtSpace::RelativeErrorTooSmall);</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 79);</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 72);</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  VERIFY(lm.fvec().squaredNorm() &lt;= 1.4307867721E-25);</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  VERIFY_IS_APPROX(x[0], 9.5100000027E-02);</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  VERIFY_IS_APPROX(x[1], 1.0000000001E+00);</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  VERIFY_IS_APPROX(x[2], 8.6070000013E-01);</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  VERIFY_IS_APPROX(x[3], 3.0000000002E+00);</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  VERIFY_IS_APPROX(x[4], 1.5575999998E+00);</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  VERIFY_IS_APPROX(x[5], 5.0000000001E+00);</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">   * Second try</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  x&lt;&lt; 0.5, 0.7, 3.6, 4.2, 4., 6.3;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  VERIFY_IS_EQUAL(info, LevenbergMarquardtSpace::RelativeErrorTooSmall);</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 9);</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 8);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  VERIFY(lm.fvec().squaredNorm() &lt;= 1.4307867721E-25);</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  VERIFY_IS_APPROX(x[0], 9.5100000027E-02);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  VERIFY_IS_APPROX(x[1], 1.0000000001E+00);</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  VERIFY_IS_APPROX(x[2], 8.6070000013E-01);</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  VERIFY_IS_APPROX(x[3], 3.0000000002E+00);</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  VERIFY_IS_APPROX(x[4], 1.5575999998E+00);</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  VERIFY_IS_APPROX(x[5], 5.0000000001E+00);</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;}</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno"><a class="line" href="structrat42__functor.html">  669</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structrat42__functor.html">rat42_functor</a> : DenseFunctor&lt;double&gt;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;{</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <a class="code" href="structrat42__functor.html">rat42_functor</a>(<span class="keywordtype">void</span>) : DenseFunctor&lt;double&gt;(3,9) {}</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> x[9];</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> y[9];</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="keywordtype">int</span> operator()(<span class="keyword">const</span> VectorXd &amp;b, VectorXd &amp;fvec)</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    {</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        assert(b.size()==3);</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        assert(fvec.size()==9);</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;9; i++) {</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            fvec[i] = b[0] / (1.+exp(b[1]-b[2]*x[i])) - y[i];</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        }</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    }</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordtype">int</span> df(<span class="keyword">const</span> VectorXd &amp;b, MatrixXd &amp;fjac)</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    {</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        assert(b.size()==3);</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        assert(fjac.rows()==9);</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        assert(fjac.cols()==3);</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;9; i++) {</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            <span class="keywordtype">double</span> e = exp(b[1]-b[2]*x[i]);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            fjac(i,0) = 1./(1.+e);</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            fjac(i,1) = -b[0]*e/(1.+e)/(1.+e);</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            fjac(i,2) = +b[0]*e*x[i]/(1.+e)/(1.+e);</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        }</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    }</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;};</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> rat42_functor::x[9] = { 9.000E0, 14.000E0, 21.000E0, 28.000E0, 42.000E0, 57.000E0, 63.000E0, 70.000E0, 79.000E0 };</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> rat42_functor::y[9] = { 8.930E0 ,10.800E0 ,18.590E0 ,22.330E0 ,39.350E0 ,56.110E0 ,61.730E0 ,64.620E0 ,67.080E0 };</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">// http://www.itl.nist.gov/div898/strd/nls/data/ratkowsky2.shtml</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="keywordtype">void</span> testNistRat42(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;{</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> n=3;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  LevenbergMarquardtSpace::Status info;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  VectorXd x(n);</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="comment">   * First try</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  x&lt;&lt; 100., 1., 0.1;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <a class="code" href="structrat42__functor.html">rat42_functor</a> functor;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  LevenbergMarquardt&lt;rat42_functor&gt; lm(functor);</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  VERIFY_IS_EQUAL(info, LevenbergMarquardtSpace::RelativeReductionTooSmall);</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 10);</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 8);</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 8.0565229338E+00);</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  VERIFY_IS_APPROX(x[0], 7.2462237576E+01);</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  VERIFY_IS_APPROX(x[1], 2.6180768402E+00);</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  VERIFY_IS_APPROX(x[2], 6.7359200066E-02);</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment">   * Second try</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  x&lt;&lt; 75., 2.5, 0.07;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  VERIFY_IS_EQUAL(info, LevenbergMarquardtSpace::RelativeReductionTooSmall);</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 6);</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 5);</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 8.0565229338E+00);</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  VERIFY_IS_APPROX(x[0], 7.2462237576E+01);</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  VERIFY_IS_APPROX(x[1], 2.6180768402E+00);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  VERIFY_IS_APPROX(x[2], 6.7359200066E-02);</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;}</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div><div class="line"><a name="l00748"></a><span class="lineno"><a class="line" href="struct_m_g_h10__functor.html">  748</a></span>&#160;<span class="keyword">struct </span><a class="code" href="struct_m_g_h10__functor.html">MGH10_functor</a> : DenseFunctor&lt;double&gt;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;{</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <a class="code" href="struct_m_g_h10__functor.html">MGH10_functor</a>(<span class="keywordtype">void</span>) : DenseFunctor&lt;double&gt;(3,16) {}</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> x[16];</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> y[16];</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="keywordtype">int</span> operator()(<span class="keyword">const</span> VectorXd &amp;b, VectorXd &amp;fvec)</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    {</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        assert(b.size()==3);</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        assert(fvec.size()==16);</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;16; i++)</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            fvec[i] =  b[0] * exp(b[1]/(x[i]+b[2])) - y[i];</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    }</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordtype">int</span> df(<span class="keyword">const</span> VectorXd &amp;b, MatrixXd &amp;fjac)</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    {</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        assert(b.size()==3);</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        assert(fjac.rows()==16);</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        assert(fjac.cols()==3);</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;16; i++) {</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            <span class="keywordtype">double</span> factor = 1./(x[i]+b[2]);</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            <span class="keywordtype">double</span> e = exp(b[1]*factor);</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            fjac(i,0) = e;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            fjac(i,1) = b[0]*factor*e;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            fjac(i,2) = -b[1]*b[0]*factor*factor*e;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        }</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    }</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;};</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> MGH10_functor::x[16] = { 5.000000E+01, 5.500000E+01, 6.000000E+01, 6.500000E+01, 7.000000E+01, 7.500000E+01, 8.000000E+01, 8.500000E+01, 9.000000E+01, 9.500000E+01, 1.000000E+02, 1.050000E+02, 1.100000E+02, 1.150000E+02, 1.200000E+02, 1.250000E+02 };</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> MGH10_functor::y[16] = { 3.478000E+04, 2.861000E+04, 2.365000E+04, 1.963000E+04, 1.637000E+04, 1.372000E+04, 1.154000E+04, 9.744000E+03, 8.261000E+03, 7.030000E+03, 6.005000E+03, 5.147000E+03, 4.427000E+03, 3.820000E+03, 3.307000E+03, 2.872000E+03 };</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment">// http://www.itl.nist.gov/div898/strd/nls/data/mgh10.shtml</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="keywordtype">void</span> testNistMGH10(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;{</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> n=3;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  LevenbergMarquardtSpace::Status info;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  VectorXd x(n);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="comment">   * First try</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  x&lt;&lt; 2., 400000., 25000.;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  <a class="code" href="struct_m_g_h10__functor.html">MGH10_functor</a> functor;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  LevenbergMarquardt&lt;MGH10_functor&gt; lm(functor);</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  ++g_test_level;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  VERIFY_IS_EQUAL(info, LevenbergMarquardtSpace::RelativeReductionTooSmall);</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  --g_test_level;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="comment">// was: VERIFY_IS_EQUAL(info, 1);</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 8.7945855171E+01);</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  VERIFY_IS_APPROX(x[0], 5.6096364710E-03);</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  VERIFY_IS_APPROX(x[1], 6.1813463463E+03);</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  VERIFY_IS_APPROX(x[2], 3.4522363462E+02);</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  </div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  ++g_test_level;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 284 );</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 249 );</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  --g_test_level;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  VERIFY(lm.nfev() &lt; 284 * LM_EVAL_COUNT_TOL);</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  VERIFY(lm.njev() &lt; 249 * LM_EVAL_COUNT_TOL);</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="comment">   * Second try</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  x&lt;&lt; 0.02, 4000., 250.;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  ++g_test_level;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  VERIFY_IS_EQUAL(info, LevenbergMarquardtSpace::RelativeReductionTooSmall);</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  <span class="comment">// was: VERIFY_IS_EQUAL(info, 1);</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  --g_test_level;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 8.7945855171E+01);</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  VERIFY_IS_APPROX(x[0], 5.6096364710E-03);</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  VERIFY_IS_APPROX(x[1], 6.1813463463E+03);</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  VERIFY_IS_APPROX(x[2], 3.4522363462E+02);</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  </div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  ++g_test_level;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 126);</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 116);</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  --g_test_level;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  VERIFY(lm.nfev() &lt; 126 * LM_EVAL_COUNT_TOL);</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  VERIFY(lm.njev() &lt; 116 * LM_EVAL_COUNT_TOL);</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;}</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div><div class="line"><a name="l00844"></a><span class="lineno"><a class="line" href="struct_box_b_o_d__functor.html">  844</a></span>&#160;<span class="keyword">struct </span><a class="code" href="struct_box_b_o_d__functor.html">BoxBOD_functor</a> : DenseFunctor&lt;double&gt;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;{</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <a class="code" href="struct_box_b_o_d__functor.html">BoxBOD_functor</a>(<span class="keywordtype">void</span>) : DenseFunctor&lt;double&gt;(2,6) {}</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> x[6];</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keywordtype">int</span> operator()(<span class="keyword">const</span> VectorXd &amp;b, VectorXd &amp;fvec)</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    {</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> y[6] = { 109., 149., 149., 191., 213., 224. };</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        assert(b.size()==2);</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        assert(fvec.size()==6);</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;6; i++)</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;            fvec[i] =  b[0]*(1.-exp(-b[1]*x[i])) - y[i];</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    }</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="keywordtype">int</span> df(<span class="keyword">const</span> VectorXd &amp;b, MatrixXd &amp;fjac)</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    {</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        assert(b.size()==2);</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        assert(fjac.rows()==6);</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        assert(fjac.cols()==2);</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;6; i++) {</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            <span class="keywordtype">double</span> e = exp(-b[1]*x[i]);</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;            fjac(i,0) = 1.-e;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;            fjac(i,1) = b[0]*x[i]*e;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        }</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    }</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;};</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> BoxBOD_functor::x[6] = { 1., 2., 3., 5., 7., 10. };</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment">// http://www.itl.nist.gov/div898/strd/nls/data/boxbod.shtml</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="keywordtype">void</span> testNistBoxBOD(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;{</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> n=2;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="keywordtype">int</span> info;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  VectorXd x(n);</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="comment">   * First try</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  x&lt;&lt; 1., 1.;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <a class="code" href="struct_box_b_o_d__functor.html">BoxBOD_functor</a> functor;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  LevenbergMarquardt&lt;BoxBOD_functor&gt; lm(functor);</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  lm.setFtol(1.E6*NumTraits&lt;double&gt;::epsilon());</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  lm.setXtol(1.E6*NumTraits&lt;double&gt;::epsilon());</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  lm.setFactor(10);</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 1.1680088766E+03);</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  VERIFY_IS_APPROX(x[0], 2.1380940889E+02);</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  VERIFY_IS_APPROX(x[1], 5.4723748542E-01);</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  </div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  VERIFY(lm.nfev() &lt; 31); <span class="comment">// 31</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  VERIFY(lm.njev() &lt; 25); <span class="comment">// 25</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="comment">   * Second try</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  x&lt;&lt; 100., 0.75;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  lm.resetParameters();</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  lm.setFtol(NumTraits&lt;double&gt;::epsilon());</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  lm.setXtol( NumTraits&lt;double&gt;::epsilon());</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  VERIFY_IS_EQUAL(info, 1); </div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  ++g_test_level;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 16 );</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 15 );</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  --g_test_level;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  VERIFY(lm.nfev() &lt; 16 * LM_EVAL_COUNT_TOL);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  VERIFY(lm.njev() &lt; 15 * LM_EVAL_COUNT_TOL);</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 1.1680088766E+03);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  VERIFY_IS_APPROX(x[0], 2.1380940889E+02);</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  VERIFY_IS_APPROX(x[1], 5.4723748542E-01);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;}</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div><div class="line"><a name="l00928"></a><span class="lineno"><a class="line" href="struct_m_g_h17__functor.html">  928</a></span>&#160;<span class="keyword">struct </span><a class="code" href="struct_m_g_h17__functor.html">MGH17_functor</a> : DenseFunctor&lt;double&gt;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;{</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <a class="code" href="struct_m_g_h17__functor.html">MGH17_functor</a>(<span class="keywordtype">void</span>) : DenseFunctor&lt;double&gt;(5,33) {}</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> x[33];</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> y[33];</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <span class="keywordtype">int</span> operator()(<span class="keyword">const</span> VectorXd &amp;b, VectorXd &amp;fvec)</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    {</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        assert(b.size()==5);</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        assert(fvec.size()==33);</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;33; i++)</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;            fvec[i] =  b[0] + b[1]*exp(-b[3]*x[i]) +  b[2]*exp(-b[4]*x[i]) - y[i];</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    }</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="keywordtype">int</span> df(<span class="keyword">const</span> VectorXd &amp;b, MatrixXd &amp;fjac)</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    {</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        assert(b.size()==5);</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        assert(fjac.rows()==33);</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        assert(fjac.cols()==5);</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;33; i++) {</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;            fjac(i,0) = 1.;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;            fjac(i,1) = exp(-b[3]*x[i]);</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;            fjac(i,2) = exp(-b[4]*x[i]);</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;            fjac(i,3) = -x[i]*b[1]*exp(-b[3]*x[i]);</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;            fjac(i,4) = -x[i]*b[2]*exp(-b[4]*x[i]);</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        }</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    }</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;};</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> MGH17_functor::x[33] = { 0.000000E+00, 1.000000E+01, 2.000000E+01, 3.000000E+01, 4.000000E+01, 5.000000E+01, 6.000000E+01, 7.000000E+01, 8.000000E+01, 9.000000E+01, 1.000000E+02, 1.100000E+02, 1.200000E+02, 1.300000E+02, 1.400000E+02, 1.500000E+02, 1.600000E+02, 1.700000E+02, 1.800000E+02, 1.900000E+02, 2.000000E+02, 2.100000E+02, 2.200000E+02, 2.300000E+02, 2.400000E+02, 2.500000E+02, 2.600000E+02, 2.700000E+02, 2.800000E+02, 2.900000E+02, 3.000000E+02, 3.100000E+02, 3.200000E+02 };</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> MGH17_functor::y[33] = { 8.440000E-01, 9.080000E-01, 9.320000E-01, 9.360000E-01, 9.250000E-01, 9.080000E-01, 8.810000E-01, 8.500000E-01, 8.180000E-01, 7.840000E-01, 7.510000E-01, 7.180000E-01, 6.850000E-01, 6.580000E-01, 6.280000E-01, 6.030000E-01, 5.800000E-01, 5.580000E-01, 5.380000E-01, 5.220000E-01, 5.060000E-01, 4.900000E-01, 4.780000E-01, 4.670000E-01, 4.570000E-01, 4.480000E-01, 4.380000E-01, 4.310000E-01, 4.240000E-01, 4.200000E-01, 4.140000E-01, 4.110000E-01, 4.060000E-01 };</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="comment">// http://www.itl.nist.gov/div898/strd/nls/data/mgh17.shtml</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="keywordtype">void</span> testNistMGH17(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;{</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> n=5;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <span class="keywordtype">int</span> info;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  VectorXd x(n);</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="comment">   * First try</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  x&lt;&lt; 50., 150., -100., 1., 2.;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  <a class="code" href="struct_m_g_h17__functor.html">MGH17_functor</a> functor;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  LevenbergMarquardt&lt;MGH17_functor&gt; lm(functor);</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  lm.setFtol(NumTraits&lt;double&gt;::epsilon());</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  lm.setXtol(NumTraits&lt;double&gt;::epsilon());</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  lm.setMaxfev(1000);</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 5.4648946975E-05);</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  VERIFY_IS_APPROX(x[0], 3.7541005211E-01);</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  VERIFY_IS_APPROX(x[1], 1.9358469127E+00);</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  VERIFY_IS_APPROX(x[2], -1.4646871366E+00);</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  VERIFY_IS_APPROX(x[3], 1.2867534640E-02);</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  VERIFY_IS_APPROX(x[4], 2.2122699662E-02);</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  </div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="comment">// check return value</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="comment">//   VERIFY_IS_EQUAL(info, 2);  //FIXME Use (lm.info() == Success)</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  VERIFY(lm.nfev() &lt; 700 ); <span class="comment">// 602</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  VERIFY(lm.njev() &lt; 600 ); <span class="comment">// 545</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="comment">   * Second try</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  x&lt;&lt; 0.5  ,1.5  ,-1   ,0.01 ,0.02;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  lm.resetParameters();</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 18);</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 15);</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 5.4648946975E-05);</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  VERIFY_IS_APPROX(x[0], 3.7541005211E-01);</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  VERIFY_IS_APPROX(x[1], 1.9358469127E+00);</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  VERIFY_IS_APPROX(x[2], -1.4646871366E+00);</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  VERIFY_IS_APPROX(x[3], 1.2867534640E-02);</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  VERIFY_IS_APPROX(x[4], 2.2122699662E-02);</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;}</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;</div><div class="line"><a name="l01015"></a><span class="lineno"><a class="line" href="struct_m_g_h09__functor.html"> 1015</a></span>&#160;<span class="keyword">struct </span><a class="code" href="struct_m_g_h09__functor.html">MGH09_functor</a> : DenseFunctor&lt;double&gt;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;{</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <a class="code" href="struct_m_g_h09__functor.html">MGH09_functor</a>(<span class="keywordtype">void</span>) : DenseFunctor&lt;double&gt;(4,11) {}</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> _x[11];</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> y[11];</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="keywordtype">int</span> operator()(<span class="keyword">const</span> VectorXd &amp;b, VectorXd &amp;fvec)</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    {</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;        assert(b.size()==4);</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        assert(fvec.size()==11);</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;11; i++) {</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;            <span class="keywordtype">double</span> x = _x[i], xx=x*x;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;            fvec[i] = b[0]*(xx+x*b[1])/(xx+x*b[2]+b[3]) - y[i];</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        }</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    }</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <span class="keywordtype">int</span> df(<span class="keyword">const</span> VectorXd &amp;b, MatrixXd &amp;fjac)</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    {</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        assert(b.size()==4);</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        assert(fjac.rows()==11);</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        assert(fjac.cols()==4);</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;11; i++) {</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;            <span class="keywordtype">double</span> x = _x[i], xx=x*x;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;            <span class="keywordtype">double</span> factor = 1./(xx+x*b[2]+b[3]);</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;            fjac(i,0) = (xx+x*b[1]) * factor;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;            fjac(i,1) = b[0]*x* factor;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;            fjac(i,2) = - b[0]*(xx+x*b[1]) * x * factor * factor;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;            fjac(i,3) = - b[0]*(xx+x*b[1]) * factor * factor;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;        }</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    }</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;};</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> MGH09_functor::_x[11] = { 4., 2., 1., 5.E-1 , 2.5E-01, 1.670000E-01, 1.250000E-01,  1.E-01, 8.330000E-02, 7.140000E-02, 6.250000E-02 };</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> MGH09_functor::y[11] = { 1.957000E-01, 1.947000E-01, 1.735000E-01, 1.600000E-01, 8.440000E-02, 6.270000E-02, 4.560000E-02, 3.420000E-02, 3.230000E-02, 2.350000E-02, 2.460000E-02 };</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="comment">// http://www.itl.nist.gov/div898/strd/nls/data/mgh09.shtml</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="keywordtype">void</span> testNistMGH09(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;{</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> n=4;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  <span class="keywordtype">int</span> info;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  VectorXd x(n);</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment">   * First try</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  x&lt;&lt; 25., 39, 41.5, 39.;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  <a class="code" href="struct_m_g_h09__functor.html">MGH09_functor</a> functor;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  LevenbergMarquardt&lt;MGH09_functor&gt; lm(functor);</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  lm.setMaxfev(1000);</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 3.0750560385E-04);</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;  VERIFY_IS_APPROX(x[0], 0.1928077089); <span class="comment">// should be 1.9280693458E-01</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  VERIFY_IS_APPROX(x[1], 0.19126423573); <span class="comment">// should be 1.9128232873E-01</span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  VERIFY_IS_APPROX(x[2], 0.12305309914); <span class="comment">// should be 1.2305650693E-01</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  VERIFY_IS_APPROX(x[3], 0.13605395375); <span class="comment">// should be 1.3606233068E-01</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  VERIFY_IS_EQUAL(info, 1); </div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  VERIFY(lm.nfev() &lt; 510 ); <span class="comment">// 490</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  VERIFY(lm.njev() &lt; 400 ); <span class="comment">// 376</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment">   * Second try</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  x&lt;&lt; 0.25, 0.39, 0.415, 0.39;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  lm.resetParameters();</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 18);</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 16);</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 3.0750560385E-04);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  VERIFY_IS_APPROX(x[0], 0.19280781); <span class="comment">// should be 1.9280693458E-01</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  VERIFY_IS_APPROX(x[1], 0.19126265); <span class="comment">// should be 1.9128232873E-01</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  VERIFY_IS_APPROX(x[2], 0.12305280); <span class="comment">// should be 1.2305650693E-01</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  VERIFY_IS_APPROX(x[3], 0.13605322); <span class="comment">// should be 1.3606233068E-01</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;}</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div><div class="line"><a name="l01102"></a><span class="lineno"><a class="line" href="struct_bennett5__functor.html"> 1102</a></span>&#160;<span class="keyword">struct </span><a class="code" href="struct_bennett5__functor.html">Bennett5_functor</a> : DenseFunctor&lt;double&gt;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;{</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <a class="code" href="struct_bennett5__functor.html">Bennett5_functor</a>(<span class="keywordtype">void</span>) : DenseFunctor&lt;double&gt;(3,154) {}</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> x[154];</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> y[154];</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <span class="keywordtype">int</span> operator()(<span class="keyword">const</span> VectorXd &amp;b, VectorXd &amp;fvec)</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    {</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        assert(b.size()==3);</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        assert(fvec.size()==154);</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;154; i++)</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;            fvec[i] = b[0]* pow(b[1]+x[i],-1./b[2]) - y[i];</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    }</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <span class="keywordtype">int</span> df(<span class="keyword">const</span> VectorXd &amp;b, MatrixXd &amp;fjac)</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    {</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        assert(b.size()==3);</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        assert(fjac.rows()==154);</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        assert(fjac.cols()==3);</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;154; i++) {</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;            <span class="keywordtype">double</span> e = pow(b[1]+x[i],-1./b[2]);</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;            fjac(i,0) = e;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;            fjac(i,1) = - b[0]*e/b[2]/(b[1]+x[i]);</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;            fjac(i,2) = b[0]*e*<a class="code" href="structlog.html">log</a>(b[1]+x[i])/b[2]/b[2];</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        }</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    }</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;};</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> Bennett5_functor::x[154] = { 7.447168E0, 8.102586E0, 8.452547E0, 8.711278E0, 8.916774E0, 9.087155E0, 9.232590E0, 9.359535E0, 9.472166E0, 9.573384E0, 9.665293E0, 9.749461E0, 9.827092E0, 9.899128E0, 9.966321E0, 10.029280E0, 10.088510E0, 10.144430E0, 10.197380E0, 10.247670E0, 10.295560E0, 10.341250E0, 10.384950E0, 10.426820E0, 10.467000E0, 10.505640E0, 10.542830E0, 10.578690E0, 10.613310E0, 10.646780E0, 10.679150E0, 10.710520E0, 10.740920E0, 10.770440E0, 10.799100E0, 10.826970E0, 10.854080E0, 10.880470E0, 10.906190E0, 10.931260E0, 10.955720E0, 10.979590E0, 11.002910E0, 11.025700E0, 11.047980E0, 11.069770E0, 11.091100E0, 11.111980E0, 11.132440E0, 11.152480E0, 11.172130E0, 11.191410E0, 11.210310E0, 11.228870E0, 11.247090E0, 11.264980E0, 11.282560E0, 11.299840E0, 11.316820E0, 11.333520E0, 11.349940E0, 11.366100E0, 11.382000E0, 11.397660E0, 11.413070E0, 11.428240E0, 11.443200E0, 11.457930E0, 11.472440E0, 11.486750E0, 11.500860E0, 11.514770E0, 11.528490E0, 11.542020E0, 11.555380E0, 11.568550E0,</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;11.581560E0, 11.594420E0, 11.607121E0, 11.619640E0, 11.632000E0, 11.644210E0, 11.656280E0, 11.668200E0, 11.679980E0, 11.691620E0, 11.703130E0, 11.714510E0, 11.725760E0, 11.736880E0, 11.747890E0, 11.758780E0, 11.769550E0, 11.780200E0, 11.790730E0, 11.801160E0, 11.811480E0, 11.821700E0, 11.831810E0, 11.841820E0, 11.851730E0, 11.861550E0, 11.871270E0, 11.880890E0, 11.890420E0, 11.899870E0, 11.909220E0, 11.918490E0, 11.927680E0, 11.936780E0, 11.945790E0, 11.954730E0, 11.963590E0, 11.972370E0, 11.981070E0, 11.989700E0, 11.998260E0, 12.006740E0, 12.015150E0, 12.023490E0, 12.031760E0, 12.039970E0, 12.048100E0, 12.056170E0, 12.064180E0, 12.072120E0, 12.080010E0, 12.087820E0, 12.095580E0, 12.103280E0, 12.110920E0, 12.118500E0, 12.126030E0, 12.133500E0, 12.140910E0, 12.148270E0, 12.155570E0, 12.162830E0, 12.170030E0, 12.177170E0, 12.184270E0, 12.191320E0, 12.198320E0, 12.205270E0, 12.212170E0, 12.219030E0, 12.225840E0, 12.232600E0, 12.239320E0, 12.245990E0, 12.252620E0, 12.259200E0, 12.265750E0, 12.272240E0 };</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> Bennett5_functor::y[154] = { -34.834702E0 ,-34.393200E0 ,-34.152901E0 ,-33.979099E0 ,-33.845901E0 ,-33.732899E0 ,-33.640301E0 ,-33.559200E0 ,-33.486801E0 ,-33.423100E0 ,-33.365101E0 ,-33.313000E0 ,-33.260899E0 ,-33.217400E0 ,-33.176899E0 ,-33.139198E0 ,-33.101601E0 ,-33.066799E0 ,-33.035000E0 ,-33.003101E0 ,-32.971298E0 ,-32.942299E0 ,-32.916302E0 ,-32.890202E0 ,-32.864101E0 ,-32.841000E0 ,-32.817799E0 ,-32.797501E0 ,-32.774300E0 ,-32.757000E0 ,-32.733799E0 ,-32.716400E0 ,-32.699100E0 ,-32.678799E0 ,-32.661400E0 ,-32.644001E0 ,-32.626701E0 ,-32.612202E0 ,-32.597698E0 ,-32.583199E0 ,-32.568699E0 ,-32.554298E0 ,-32.539799E0 ,-32.525299E0 ,-32.510799E0 ,-32.499199E0 ,-32.487598E0 ,-32.473202E0 ,-32.461601E0 ,-32.435501E0 ,-32.435501E0 ,-32.426800E0 ,-32.412300E0 ,-32.400799E0 ,-32.392101E0 ,-32.380501E0 ,-32.366001E0 ,-32.357300E0 ,-32.348598E0 ,-32.339901E0 ,-32.328400E0 ,-32.319698E0 ,-32.311001E0 ,-32.299400E0 ,-32.290699E0 ,-32.282001E0 ,-32.273300E0 ,-32.264599E0 ,-32.256001E0 ,-32.247299E0</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;,-32.238602E0 ,-32.229900E0 ,-32.224098E0 ,-32.215401E0 ,-32.203800E0 ,-32.198002E0 ,-32.189400E0 ,-32.183601E0 ,-32.174900E0 ,-32.169102E0 ,-32.163300E0 ,-32.154598E0 ,-32.145901E0 ,-32.140099E0 ,-32.131401E0 ,-32.125599E0 ,-32.119801E0 ,-32.111198E0 ,-32.105400E0 ,-32.096699E0 ,-32.090900E0 ,-32.088001E0 ,-32.079300E0 ,-32.073502E0 ,-32.067699E0 ,-32.061901E0 ,-32.056099E0 ,-32.050301E0 ,-32.044498E0 ,-32.038799E0 ,-32.033001E0 ,-32.027199E0 ,-32.024300E0 ,-32.018501E0 ,-32.012699E0 ,-32.004002E0 ,-32.001099E0 ,-31.995300E0 ,-31.989500E0 ,-31.983700E0 ,-31.977900E0 ,-31.972099E0 ,-31.969299E0 ,-31.963501E0 ,-31.957701E0 ,-31.951900E0 ,-31.946100E0 ,-31.940300E0 ,-31.937401E0 ,-31.931601E0 ,-31.925800E0 ,-31.922899E0 ,-31.917101E0 ,-31.911301E0 ,-31.908400E0 ,-31.902599E0 ,-31.896900E0 ,-31.893999E0 ,-31.888201E0 ,-31.885300E0 ,-31.882401E0 ,-31.876600E0 ,-31.873699E0 ,-31.867901E0 ,-31.862101E0 ,-31.859200E0 ,-31.856300E0 ,-31.850500E0 ,-31.844700E0 ,-31.841801E0 ,-31.838900E0 ,-31.833099E0 ,-31.830200E0 ,</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;-31.827299E0 ,-31.821600E0 ,-31.818701E0 ,-31.812901E0 ,-31.809999E0 ,-31.807100E0 ,-31.801300E0 ,-31.798401E0 ,-31.795500E0 ,-31.789700E0 ,-31.786800E0 };</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="comment">// http://www.itl.nist.gov/div898/strd/nls/data/bennett5.shtml</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="keywordtype">void</span> testNistBennett5(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;{</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span>  n=3;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  <span class="keywordtype">int</span> info;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;  VectorXd x(n);</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="comment">   * First try</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;  x&lt;&lt; -2000., 50., 0.8;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  <a class="code" href="struct_bennett5__functor.html">Bennett5_functor</a> functor;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  LevenbergMarquardt&lt;Bennett5_functor&gt; lm(functor);</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  lm.setMaxfev(1000);</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 758);</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 744);</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 5.2404744073E-04);</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;  VERIFY_IS_APPROX(x[0], -2.5235058043E+03);</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  VERIFY_IS_APPROX(x[1], 4.6736564644E+01);</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  VERIFY_IS_APPROX(x[2], 9.3218483193E-01);</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="comment">   * Second try</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  x&lt;&lt; -1500., 45., 0.85;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  lm.resetParameters();</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 203);</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 192);</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 5.2404744073E-04);</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  VERIFY_IS_APPROX(x[0], -2523.3007865); <span class="comment">// should be -2.5235058043E+03</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  VERIFY_IS_APPROX(x[1], 46.735705771); <span class="comment">// should be 4.6736564644E+01);</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  VERIFY_IS_APPROX(x[2], 0.93219881891); <span class="comment">// should be 9.3218483193E-01);</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;}</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;</div><div class="line"><a name="l01183"></a><span class="lineno"><a class="line" href="structthurber__functor.html"> 1183</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structthurber__functor.html">thurber_functor</a> : DenseFunctor&lt;double&gt;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;{</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <a class="code" href="structthurber__functor.html">thurber_functor</a>(<span class="keywordtype">void</span>) : DenseFunctor&lt;double&gt;(7,37) {}</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> _x[37];</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> _y[37];</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="keywordtype">int</span> operator()(<span class="keyword">const</span> VectorXd &amp;b, VectorXd &amp;fvec)</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    {</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;        <span class="comment">//        int called=0; printf(&quot;call hahn1_functor with  iflag=%d, called=%d\n&quot;, iflag, called); if (iflag==1) called++;</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        assert(b.size()==7);</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;        assert(fvec.size()==37);</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;37; i++) {</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;            <span class="keywordtype">double</span> x=_x[i], xx=x*x, xxx=xx*x;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;            fvec[i] = (b[0]+b[1]*x+b[2]*xx+b[3]*xxx) / (1.+b[4]*x+b[5]*xx+b[6]*xxx) - _y[i];</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        }</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    }</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keywordtype">int</span> df(<span class="keyword">const</span> VectorXd &amp;b, MatrixXd &amp;fjac)</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    {</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;        assert(b.size()==7);</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        assert(fjac.rows()==37);</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        assert(fjac.cols()==7);</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;37; i++) {</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;            <span class="keywordtype">double</span> x=_x[i], xx=x*x, xxx=xx*x;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;            <span class="keywordtype">double</span> fact = 1./(1.+b[4]*x+b[5]*xx+b[6]*xxx);</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;            fjac(i,0) = 1.*fact;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;            fjac(i,1) = x*fact;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;            fjac(i,2) = xx*fact;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;            fjac(i,3) = xxx*fact;</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;            fact = - (b[0]+b[1]*x+b[2]*xx+b[3]*xxx) * fact * fact;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;            fjac(i,4) = x*fact;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;            fjac(i,5) = xx*fact;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;            fjac(i,6) = xxx*fact;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;        }</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    }</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;};</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> thurber_functor::_x[37] = { -3.067E0, -2.981E0, -2.921E0, -2.912E0, -2.840E0, -2.797E0, -2.702E0, -2.699E0, -2.633E0, -2.481E0, -2.363E0, -2.322E0, -1.501E0, -1.460E0, -1.274E0, -1.212E0, -1.100E0, -1.046E0, -0.915E0, -0.714E0, -0.566E0, -0.545E0, -0.400E0, -0.309E0, -0.109E0, -0.103E0, 0.010E0, 0.119E0, 0.377E0, 0.790E0, 0.963E0, 1.006E0, 1.115E0, 1.572E0, 1.841E0, 2.047E0, 2.200E0 };</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> thurber_functor::_y[37] = { 80.574E0, 84.248E0, 87.264E0, 87.195E0, 89.076E0, 89.608E0, 89.868E0, 90.101E0, 92.405E0, 95.854E0, 100.696E0, 101.060E0, 401.672E0, 390.724E0, 567.534E0, 635.316E0, 733.054E0, 759.087E0, 894.206E0, 990.785E0, 1090.109E0, 1080.914E0, 1122.643E0, 1178.351E0, 1260.531E0, 1273.514E0, 1288.339E0, 1327.543E0, 1353.863E0, 1414.509E0, 1425.208E0, 1421.384E0, 1442.962E0, 1464.350E0, 1468.705E0, 1447.894E0, 1457.628E0};</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;<span class="comment">// http://www.itl.nist.gov/div898/strd/nls/data/thurber.shtml</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="keywordtype">void</span> testNistThurber(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;{</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> n=7;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  <span class="keywordtype">int</span> info;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  VectorXd x(n);</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;<span class="comment">   * First try</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  x&lt;&lt; 1000 ,1000 ,400 ,40 ,0.7,0.3,0.0 ;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  <a class="code" href="structthurber__functor.html">thurber_functor</a> functor;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  LevenbergMarquardt&lt;thurber_functor&gt; lm(functor);</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  lm.setFtol(1.E4*NumTraits&lt;double&gt;::epsilon());</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  lm.setXtol(1.E4*NumTraits&lt;double&gt;::epsilon());</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 39);</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 36);</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 5.6427082397E+03);</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  VERIFY_IS_APPROX(x[0], 1.2881396800E+03);</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  VERIFY_IS_APPROX(x[1], 1.4910792535E+03);</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  VERIFY_IS_APPROX(x[2], 5.8323836877E+02);</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;  VERIFY_IS_APPROX(x[3], 7.5416644291E+01);</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;  VERIFY_IS_APPROX(x[4], 9.6629502864E-01);</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  VERIFY_IS_APPROX(x[5], 3.9797285797E-01);</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  VERIFY_IS_APPROX(x[6], 4.9727297349E-02);</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="comment">   * Second try</span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  x&lt;&lt; 1300 ,1500 ,500  ,75   ,1    ,0.4  ,0.05  ;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  lm.resetParameters();</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  lm.setFtol(1.E4*NumTraits&lt;double&gt;::epsilon());</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  lm.setXtol(1.E4*NumTraits&lt;double&gt;::epsilon());</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 29);</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 28);</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 5.6427082397E+03);</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  VERIFY_IS_APPROX(x[0], 1.2881396800E+03);</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  VERIFY_IS_APPROX(x[1], 1.4910792535E+03);</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;  VERIFY_IS_APPROX(x[2], 5.8323836877E+02);</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  VERIFY_IS_APPROX(x[3], 7.5416644291E+01);</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;  VERIFY_IS_APPROX(x[4], 9.6629502864E-01);</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  VERIFY_IS_APPROX(x[5], 3.9797285797E-01);</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;  VERIFY_IS_APPROX(x[6], 4.9727297349E-02);</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;}</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;</div><div class="line"><a name="l01282"></a><span class="lineno"><a class="line" href="structrat43__functor.html"> 1282</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structrat43__functor.html">rat43_functor</a> : DenseFunctor&lt;double&gt;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;{</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    <a class="code" href="structrat43__functor.html">rat43_functor</a>(<span class="keywordtype">void</span>) : DenseFunctor&lt;double&gt;(4,15) {}</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> x[15];</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> y[15];</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <span class="keywordtype">int</span> operator()(<span class="keyword">const</span> VectorXd &amp;b, VectorXd &amp;fvec)</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    {</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        assert(b.size()==4);</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        assert(fvec.size()==15);</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;15; i++)</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;            fvec[i] = b[0] * pow(1.+exp(b[1]-b[2]*x[i]),-1./b[3]) - y[i];</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    }</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="keywordtype">int</span> df(<span class="keyword">const</span> VectorXd &amp;b, MatrixXd &amp;fjac)</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    {</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        assert(b.size()==4);</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        assert(fjac.rows()==15);</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        assert(fjac.cols()==4);</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;15; i++) {</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;            <span class="keywordtype">double</span> e = exp(b[1]-b[2]*x[i]);</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;            <span class="keywordtype">double</span> power = -1./b[3];</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            fjac(i,0) = pow(1.+e, power);</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;            fjac(i,1) = power*b[0]*e*pow(1.+e, power-1.);</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;            fjac(i,2) = -power*b[0]*e*x[i]*pow(1.+e, power-1.);</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;            fjac(i,3) = b[0]*power*power*<a class="code" href="structlog.html">log</a>(1.+e)*pow(1.+e, power);</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;        }</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    }</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;};</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> rat43_functor::x[15] = { 1., 2., 3., 4., 5., 6., 7., 8., 9., 10., 11., 12., 13., 14., 15. };</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> rat43_functor::y[15] = { 16.08, 33.83, 65.80, 97.20, 191.55, 326.20, 386.87, 520.53, 590.03, 651.92, 724.93, 699.56, 689.96, 637.56, 717.41 };</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="comment">// http://www.itl.nist.gov/div898/strd/nls/data/ratkowsky3.shtml</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="keywordtype">void</span> testNistRat43(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;{</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> n=4;</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  <span class="keywordtype">int</span> info;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;  VectorXd x(n);</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="comment">   * First try</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  x&lt;&lt; 100., 10., 1., 1.;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  <a class="code" href="structrat43__functor.html">rat43_functor</a> functor;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;  LevenbergMarquardt&lt;rat43_functor&gt; lm(functor);</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;  lm.setFtol(1.E6*NumTraits&lt;double&gt;::epsilon());</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;  lm.setXtol(1.E6*NumTraits&lt;double&gt;::epsilon());</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 27);</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 20);</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 8.7864049080E+03);</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;  VERIFY_IS_APPROX(x[0], 6.9964151270E+02);</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;  VERIFY_IS_APPROX(x[1], 5.2771253025E+00);</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;  VERIFY_IS_APPROX(x[2], 7.5962938329E-01);</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;  VERIFY_IS_APPROX(x[3], 1.2792483859E+00);</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="comment">   * Second try</span></div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  x&lt;&lt; 700., 5., 0.75, 1.3;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;  lm.resetParameters();</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;  lm.setFtol(1.E5*NumTraits&lt;double&gt;::epsilon());</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;  lm.setXtol(1.E5*NumTraits&lt;double&gt;::epsilon());</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 9);</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 8);</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 8.7864049080E+03);</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;  VERIFY_IS_APPROX(x[0], 6.9964151270E+02);</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  VERIFY_IS_APPROX(x[1], 5.2771253025E+00);</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;  VERIFY_IS_APPROX(x[2], 7.5962938329E-01);</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  VERIFY_IS_APPROX(x[3], 1.2792483859E+00);</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;}</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;</div><div class="line"><a name="l01370"></a><span class="lineno"><a class="line" href="structeckerle4__functor.html"> 1370</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structeckerle4__functor.html">eckerle4_functor</a> : DenseFunctor&lt;double&gt;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;{</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    <a class="code" href="structeckerle4__functor.html">eckerle4_functor</a>(<span class="keywordtype">void</span>) : DenseFunctor&lt;double&gt;(3,35) {}</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> x[35];</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> y[35];</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    <span class="keywordtype">int</span> operator()(<span class="keyword">const</span> VectorXd &amp;b, VectorXd &amp;fvec)</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    {</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        assert(b.size()==3);</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;        assert(fvec.size()==35);</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;35; i++)</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;            fvec[i] = b[0]/b[1] * exp(-0.5*(x[i]-b[2])*(x[i]-b[2])/(b[1]*b[1])) - y[i];</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    }</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    <span class="keywordtype">int</span> df(<span class="keyword">const</span> VectorXd &amp;b, MatrixXd &amp;fjac)</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    {</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;        assert(b.size()==3);</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;        assert(fjac.rows()==35);</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;        assert(fjac.cols()==3);</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;35; i++) {</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;            <span class="keywordtype">double</span> b12 = b[1]*b[1];</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;            <span class="keywordtype">double</span> e = exp(-0.5*(x[i]-b[2])*(x[i]-b[2])/b12);</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;            fjac(i,0) = e / b[1];</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;            fjac(i,1) = ((x[i]-b[2])*(x[i]-b[2])/b12-1.) * b[0]*e/b12;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;            fjac(i,2) = (x[i]-b[2])*e*b[0]/b[1]/b12;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;        }</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    }</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;};</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> eckerle4_functor::x[35] = { 400.0, 405.0, 410.0, 415.0, 420.0, 425.0, 430.0, 435.0, 436.5, 438.0, 439.5, 441.0, 442.5, 444.0, 445.5, 447.0, 448.5, 450.0, 451.5, 453.0, 454.5, 456.0, 457.5, 459.0, 460.5, 462.0, 463.5, 465.0, 470.0, 475.0, 480.0, 485.0, 490.0, 495.0, 500.0};</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> eckerle4_functor::y[35] = { 0.0001575, 0.0001699, 0.0002350, 0.0003102, 0.0004917, 0.0008710, 0.0017418, 0.0046400, 0.0065895, 0.0097302, 0.0149002, 0.0237310, 0.0401683, 0.0712559, 0.1264458, 0.2073413, 0.2902366, 0.3445623, 0.3698049, 0.3668534, 0.3106727, 0.2078154, 0.1164354, 0.0616764, 0.0337200, 0.0194023, 0.0117831, 0.0074357, 0.0022732, 0.0008800, 0.0004579, 0.0002345, 0.0001586, 0.0001143, 0.0000710 };</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="comment">// http://www.itl.nist.gov/div898/strd/nls/data/eckerle4.shtml</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;<span class="keywordtype">void</span> testNistEckerle4(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;{</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> n=3;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;  <span class="keywordtype">int</span> info;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  VectorXd x(n);</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="comment">   * First try</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;  x&lt;&lt; 1., 10., 500.;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  <a class="code" href="structeckerle4__functor.html">eckerle4_functor</a> functor;</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  LevenbergMarquardt&lt;eckerle4_functor&gt; lm(functor);</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 18);</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 15);</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 1.4635887487E-03);</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  VERIFY_IS_APPROX(x[0], 1.5543827178);</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;  VERIFY_IS_APPROX(x[1], 4.0888321754);</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  VERIFY_IS_APPROX(x[2], 4.5154121844E+02);</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="comment">   * Second try</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  x&lt;&lt; 1.5, 5., 450.;</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;  <span class="comment">// do the computation</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;  info = lm.minimize(x);</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;  <span class="comment">// check return value</span></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;  VERIFY_IS_EQUAL(info, 1);</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  VERIFY_IS_EQUAL(lm.nfev(), 7);</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;  VERIFY_IS_EQUAL(lm.njev(), 6);</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  <span class="comment">// check norm^2</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  VERIFY_IS_APPROX(lm.fvec().squaredNorm(), 1.4635887487E-03);</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  <span class="comment">// check x</span></div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  VERIFY_IS_APPROX(x[0], 1.5543827178);</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  VERIFY_IS_APPROX(x[1], 4.0888321754);</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  VERIFY_IS_APPROX(x[2], 4.5154121844E+02);</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;}</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="keywordtype">void</span> test_levenberg_marquardt()</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;{</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <span class="comment">// Tests using the examples provided by (c)minpack</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    CALL_SUBTEST(testLmder1());</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    CALL_SUBTEST(testLmder());</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    CALL_SUBTEST(testLmdif1());</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;<span class="comment">//     CALL_SUBTEST(testLmstr1());</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="comment">//     CALL_SUBTEST(testLmstr());</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    CALL_SUBTEST(testLmdif());</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <span class="comment">// NIST tests, level of difficulty = &quot;Lower&quot;</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    CALL_SUBTEST(testNistMisra1a());</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    CALL_SUBTEST(testNistChwirut2());</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <span class="comment">// NIST tests, level of difficulty = &quot;Average&quot;</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    CALL_SUBTEST(testNistHahn1());</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    CALL_SUBTEST(testNistMisra1d());</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    CALL_SUBTEST(testNistMGH17());</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    CALL_SUBTEST(testNistLanczos1());</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="comment">//     // NIST tests, level of difficulty = &quot;Higher&quot;</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    CALL_SUBTEST(testNistRat42());</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;    CALL_SUBTEST(testNistMGH10());</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    CALL_SUBTEST(testNistBoxBOD());</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;<span class="comment">//     CALL_SUBTEST(testNistMGH09());</span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    CALL_SUBTEST(testNistBennett5());</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    CALL_SUBTEST(testNistThurber());</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    CALL_SUBTEST(testNistRat43());</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    CALL_SUBTEST(testNistEckerle4());</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;}</div><div class="ttc" id="structrat43__functor_html"><div class="ttname"><a href="structrat43__functor.html">rat43_functor</a></div><div class="ttdef"><b>Definition:</b> <a href="eigen_2unsupported_2test_2levenberg__marquardt_8cpp_source.html#l01282">eigen/unsupported/test/levenberg_marquardt.cpp:1282</a></div></div>
<div class="ttc" id="structlanczos1__functor_html"><div class="ttname"><a href="structlanczos1__functor.html">lanczos1_functor</a></div><div class="ttdef"><b>Definition:</b> <a href="eigen_2unsupported_2test_2levenberg__marquardt_8cpp_source.html#l00583">eigen/unsupported/test/levenberg_marquardt.cpp:583</a></div></div>
<div class="ttc" id="structthurber__functor_html"><div class="ttname"><a href="structthurber__functor.html">thurber_functor</a></div><div class="ttdef"><b>Definition:</b> <a href="eigen_2unsupported_2test_2levenberg__marquardt_8cpp_source.html#l01183">eigen/unsupported/test/levenberg_marquardt.cpp:1183</a></div></div>
<div class="ttc" id="structeckerle4__functor_html"><div class="ttname"><a href="structeckerle4__functor.html">eckerle4_functor</a></div><div class="ttdef"><b>Definition:</b> <a href="eigen_2unsupported_2test_2levenberg__marquardt_8cpp_source.html#l01370">eigen/unsupported/test/levenberg_marquardt.cpp:1370</a></div></div>
<div class="ttc" id="structchwirut2__functor_html"><div class="ttname"><a href="structchwirut2__functor.html">chwirut2_functor</a></div><div class="ttdef"><b>Definition:</b> <a href="eigen_2unsupported_2test_2levenberg__marquardt_8cpp_source.html#l00244">eigen/unsupported/test/levenberg_marquardt.cpp:244</a></div></div>
<div class="ttc" id="structlog_html"><div class="ttname"><a href="structlog.html">log</a></div><div class="ttdef"><b>Definition:</b> <a href="visual__studio_2zlib_2examples_2gzlog_8c_source.html#l00289">visual_studio/zlib/examples/gzlog.c:289</a></div></div>
<div class="ttc" id="structrat42__functor_html"><div class="ttname"><a href="structrat42__functor.html">rat42_functor</a></div><div class="ttdef"><b>Definition:</b> <a href="eigen_2unsupported_2test_2levenberg__marquardt_8cpp_source.html#l00669">eigen/unsupported/test/levenberg_marquardt.cpp:669</a></div></div>
<div class="ttc" id="struct_bennett5__functor_html"><div class="ttname"><a href="struct_bennett5__functor.html">Bennett5_functor</a></div><div class="ttdef"><b>Definition:</b> <a href="eigen_2unsupported_2test_2levenberg__marquardt_8cpp_source.html#l01102">eigen/unsupported/test/levenberg_marquardt.cpp:1102</a></div></div>
<div class="ttc" id="structmisra1d__functor_html"><div class="ttname"><a href="structmisra1d__functor.html">misra1d_functor</a></div><div class="ttdef"><b>Definition:</b> <a href="eigen_2unsupported_2test_2levenberg__marquardt_8cpp_source.html#l00507">eigen/unsupported/test/levenberg_marquardt.cpp:507</a></div></div>
<div class="ttc" id="struct_m_g_h17__functor_html"><div class="ttname"><a href="struct_m_g_h17__functor.html">MGH17_functor</a></div><div class="ttdef"><b>Definition:</b> <a href="eigen_2unsupported_2test_2levenberg__marquardt_8cpp_source.html#l00928">eigen/unsupported/test/levenberg_marquardt.cpp:928</a></div></div>
<div class="ttc" id="struct_box_b_o_d__functor_html"><div class="ttname"><a href="struct_box_b_o_d__functor.html">BoxBOD_functor</a></div><div class="ttdef"><b>Definition:</b> <a href="eigen_2unsupported_2test_2levenberg__marquardt_8cpp_source.html#l00844">eigen/unsupported/test/levenberg_marquardt.cpp:844</a></div></div>
<div class="ttc" id="struct_m_g_h09__functor_html"><div class="ttname"><a href="struct_m_g_h09__functor.html">MGH09_functor</a></div><div class="ttdef"><b>Definition:</b> <a href="eigen_2unsupported_2test_2levenberg__marquardt_8cpp_source.html#l01015">eigen/unsupported/test/levenberg_marquardt.cpp:1015</a></div></div>
<div class="ttc" id="structlmdif__functor_html"><div class="ttname"><a href="structlmdif__functor.html">lmdif_functor</a></div><div class="ttdef"><b>Definition:</b> <a href="eigen_2unsupported_2test_2levenberg__marquardt_8cpp_source.html#l00141">eigen/unsupported/test/levenberg_marquardt.cpp:141</a></div></div>
<div class="ttc" id="structhahn1__functor_html"><div class="ttname"><a href="structhahn1__functor.html">hahn1_functor</a></div><div class="ttdef"><b>Definition:</b> <a href="eigen_2unsupported_2test_2levenberg__marquardt_8cpp_source.html#l00405">eigen/unsupported/test/levenberg_marquardt.cpp:405</a></div></div>
<div class="ttc" id="structmisra1a__functor_html"><div class="ttname"><a href="structmisra1a__functor.html">misra1a_functor</a></div><div class="ttdef"><b>Definition:</b> <a href="eigen_2unsupported_2test_2levenberg__marquardt_8cpp_source.html#l00331">eigen/unsupported/test/levenberg_marquardt.cpp:331</a></div></div>
<div class="ttc" id="structlmder__functor_html"><div class="ttname"><a href="structlmder__functor.html">lmder_functor</a></div><div class="ttdef"><b>Definition:</b> <a href="eigen_2unsupported_2test_2levenberg__marquardt_8cpp_source.html#l00029">eigen/unsupported/test/levenberg_marquardt.cpp:29</a></div></div>
<div class="ttc" id="struct_m_g_h10__functor_html"><div class="ttname"><a href="struct_m_g_h10__functor.html">MGH10_functor</a></div><div class="ttdef"><b>Definition:</b> <a href="eigen_2unsupported_2test_2levenberg__marquardt_8cpp_source.html#l00748">eigen/unsupported/test/levenberg_marquardt.cpp:748</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
